var BABYLON;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"Version",{get:function(){return"5.57.1 - LTS"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Copyright",{get:function(){return"All rights reserved (c) 2020 Mackey Kinard"},enumerable:!1,configurable:!0}),t.HasAudioContext=function(){return null!=e.Engine.audioEngine&&null!=e.Engine.audioEngine.audioContext&&null!=e.Engine.audioEngine.audioContext.state&&"running"===e.Engine.audioEngine.audioContext.state},t.EnableSceneParsing=function(t){e.SceneManager.SceneParsingEnabled=t},t.IsSceneParsingEnabled=function(){return e.SceneManager.SceneParsingEnabled},t.HasSceneBeenPreLoaded=function(e){var t=e;return null!=t._preloaded&&t._preloaded===!0},t.GetFullscreenUI=function(t,n){return void 0===n&&(n=e.Texture.BILINEAR_SAMPLINGMODE),null==e.SceneManager.AdvDynamicTexture&&(e.SceneManager.AdvDynamicTexture=e.GUI.AdvancedDynamicTexture.CreateFullscreenUI("Default-Screen-UI",!0,t,n)),e.SceneManager.AdvDynamicTexture},t.GetDefaultSkybox=function(e){return e.getMeshById("Default Skybox")},t.GetIntensityFactor=function(){return null!=e.SceneManager.GlobalOptions.intensityFactor?e.SceneManager.GlobalOptions.intensityFactor:2},t.GetRenderQuality=function(){var t=e.RenderQuality.High,n=e.SceneManager.GlobalOptions.renderQuality;return null!=n&&(t=n),t},t.SetRenderQuality=function(t){e.SceneManager.GlobalOptions.renderQuality=t},t.GetWebGLVersionString=function(t){var n="WebGL - Unknown",o=t||e.SceneManager.GetLastCreatedScene();if(null!=o){var i=o.getEngine();if(null!=i){var r=i.getGlInfo();null!=r&&(n=r.version+" - "+r.renderer)}}return n},t.GetWebGLVersionNumber=function(t){var n=0,o=t||e.SceneManager.GetLastCreatedScene();if(null!=o){var i=o.getEngine();null!=i&&(n=i.webGLVersion)}return n},t.SetWindowState=function(t,n){e.SceneManager.WindowState[t]=n},t.GetWindowState=function(t){var n=e.SceneManager.WindowState[t];return null!=n?n:null},t.IsDebugMode=function(){return null!=e.SceneManager.GlobalOptions.debugModeEnabled&&e.SceneManager.GlobalOptions.debugModeEnabled===!0},t.ConsoleLog=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.log.apply(console,t)},t.ConsoleInfo=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.info.apply(console,t)},t.ConsoleWarn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.warn.apply(console,t)},t.ConsoleError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,e)},t.LogMessage=function(t){e.SceneManager.IsDebugMode()&&e.Tools.Log(t)},t.LogWarning=function(t){e.SceneManager.IsDebugMode()&&e.Tools.Warn(t)},t.LogError=function(t){e.Tools.Error(t)},t.ShowSceneLoader=function(){window.showSceneLoader&&window.showSceneLoader()},t.HideSceneLoader=function(){window.hideSceneLoader&&window.hideSceneLoader()},t.UpdateLoaderStatus=function(e,t,n){window.updateStatus&&window.updateStatus(e,t,n)},t.UpdateLoaderDetails=function(e,t){window.updateDetails&&window.updateDetails(e,t)},t.UpdateLoaderProgress=function(e,t){window.updateProgress&&window.updateProgress(e,t)},t.ShowPageErrorMessage=function(e,t,n){void 0===t&&(t="Error"),void 0===n&&(n=0),window.showErrorMessage&&window.showErrorMessage(e,t,n)},t.SetTimeout=function(e,t){return window.setTimeout(t,e)},t.ClearTimeout=function(e){window.clearTimeout(e)},t.SetInterval=function(e,t){return window.setInterval(t,e)},t.ClearInterval=function(e){window.clearInterval(e)},t.GetTimeMilliseconds=function(){return null!=window.performance?window.performance.now():null!=window.Date?Date.now():0},t.GetTime=function(){return.001*e.SceneManager.GetTimeMilliseconds()},t.GetTimeMs=function(){return e.SceneManager.GetTimeMilliseconds()},t.GetGameTime=function(){return.001*(e.SceneManager.GetTimeMilliseconds()-e.SceneManager.GameTimeMilliseconds)},t.GetGameTimeMs=function(){return e.SceneManager.GetTimeMilliseconds()-e.SceneManager.GameTimeMilliseconds},t.GetDeltaSeconds=function(t,n){void 0===n&&(n=!1);var o=t||e.SceneManager.GetLastCreatedScene(),i=.001*Math.max(e.Scene.MinDeltaTime,Math.min(o.getEngine().getDeltaTime(),e.Scene.MaxDeltaTime));return n===!0&&(i*=o.getAnimationRatio()),i},t.GetDeltaMilliseconds=function(t,n){void 0===n&&(n=!1);var o=t||e.SceneManager.GetLastCreatedScene(),i=Math.max(e.Scene.MinDeltaTime,Math.min(o.getEngine().getDeltaTime(),e.Scene.MaxDeltaTime));return n===!0&&(i*=o.getAnimationRatio()),i},t.GetAnimationRatio=function(t){var n=t||e.SceneManager.GetLastCreatedScene();return n.getAnimationRatio()},t.RunOnce=function(e,t,n){e.executeOnceBeforeRender(t,n)},t.DisposeScene=function(t,n){void 0===n&&(n=new e.Color4(0,0,0,1));var o=t.getEngine();t.dispose(),o.clear(n,!0,!0,!0)},t.SafeDestroy=function(t,n,o){void 0===n&&(n=5),void 0===o&&(o=!1),n>0?(o===!0&&t.setEnabled(!1),e.SceneManager.SetTimeout(n,function(){t.dispose(!1,!1)})):t.dispose(!1,!1)},t.GetRootUrl=function(e){return null!=e._rootUrl&&""!==e._rootUrl?e._rootUrl:"/"},t.SetRootUrl=function(e,t){e._rootUrl=t},t.GetSceneFile=function(e){return null!=e._fileName&&""!==e._fileName?e._fileName:null},t.SetSceneFile=function(e,t){e._fileName=t},t.GetEngineInstances=function(){return e.EngineStore.Instances},t.GetLastCreatedEngine=function(){return e.EngineStore.LastCreatedEngine},t.GetLastCreatedScene=function(){return e.EngineStore.LastCreatedScene},t.GetImportMeshes=function(e,t){return null==e||null==t||""===t?null:null!=e.importMeshes?e.importMeshes.get(t.toLowerCase()):null},t.GetImportMeshMap=function(e){return null==e?null:null!=e.importMeshes?e.importMeshes:null},t.ClearImportMeshes=function(e){return null==e?null:(null!=e.importMeshes,void(e.importMeshes=new Map))},t.RegisterImportMeshes=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.importMeshes&&(e.importMeshes=new Map),e.importMeshes.set(t.toLowerCase(),n))},t.GetAssetContainer=function(e,t){return null==e||null==t||""===t?null:null!=e.assetContainers?e.assetContainers.get(t.toLowerCase()):null},t.GetAssetContainerMap=function(e){return null==e?null:null!=e.assetContainers?e.assetContainers:null},t.ClearAssetContainers=function(e){return null==e?null:(null!=e.assetContainers,void(e.assetContainers=new Map))},t.RegisterAssetContainer=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.assetContainers&&(e.assetContainers=new Map),e.assetContainers.set(t.toLowerCase(),n))},t.GetMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetAbstractMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetAbstractMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformNode=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetTransformNodeByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformDetailMesh=function(t){var n=null,o=t.name+".Detail",i=t.getChildren(function(t){return t.name===o&&t instanceof e.AbstractMesh},!0);return null!=i&&i.length>0&&(n=i[0]),n},t.GetSkinnedMesh=function(e){return null!=e._skinnedMesh?e._skinnedMesh:null},t.GetPrimitiveMeshes=function(e){return e.getChildMeshes(!0,function(e){return e.name.indexOf("_primitive")>=0})},t.GetTransformLayer=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.layer?e.metadata.unity.layer:0},t.GetTransformTag=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.group&&""!==e.metadata.unity.group?e.metadata.unity.group:"Untagged"},t.HasTransformTags=function(t,n){return e.Tags.MatchesQuery(t,n)},t.TextureFloatSupported=function(e){var t=!1,n=!1,o=e.getEngine(),i=o.getCaps();return i.textureHalfFloatRender&&i.textureHalfFloatLinearFiltering?t=!0:i.textureFloatRender&&i.textureFloatLinearFiltering&&(n=!0),t||n},t.RegisterClickAction=function(t,n,o){var i=null;return null!=n&&(n.isPickable=!0,null==n.actionManager&&(n.actionManager=new e.ActionManager(t)),i=n.actionManager.registerAction(new e.ExecuteCodeAction({trigger:e.ActionManager.OnPickTrigger},o))),i},t.UnregisterClickAction=function(e,t){var n=!1;return null!=e&&null!=t&&(n=e.actionManager.unregisterAction(t)),n},t.StartTweenAnimation=function(t,n,o,i,r,a,l,s,u,c,p){void 0===l&&(l=1),void 0===s&&(s=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===p&&(p=null);var h=l||1,d=s||30,m=u||e.Animation.ANIMATIONLOOPMODE_CONSTANT,g=e.Utilities.CreateTweenAnimation(n,i,r,a,d,m);null!=c&&g.setEasingFunction(c);var f=e.Utilities.GetLastKeyFrameIndex(g),y=m!=e.Animation.ANIMATIONLOOPMODE_CONSTANT;return t.beginDirectAnimation(o,[g],0,f,y,h,p)},t.StartNativeTween=function(e,t){return createjs.Tween.get(e,t)},t.GetMaterialWithName=function(e,t){var n=null;if(null!=e.materials&&e.materials.length>0)for(var o=(e.materials.length,0);o<e.materials.length;o++){var i=e.materials[o];if(i.name.startsWith(t)){n=i;break}}return n},t.GetAllMaterialsWithName=function(e,t){var n=null;if(null!=e.materials&&e.materials.length>0)for(var o=(e.materials.length,0);o<e.materials.length;o++){var i=e.materials[o];i.name.startsWith(t)&&(null==n&&(n=[]),n.push(i))}return n},t.InstantiatePrefabFromScene=function(t,n,o,i,r,a,l,s){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===s&&(s=!0);var u=null;if(null!=t&&null!=n&&""!==n){var c=t.getNodeByName(n);if(null!=c)if(u=c.clone(o,i,!1),null!=u){null!=r&&(u.position=r.clone()),null!=a&&(u.rotationQuaternion=a.clone()),null!=l&&(u.scaling=l.clone());var p=null,h=u.getChildren(null,!1);null!=h&&(p=h),null==p?p=[u]:p.unshift(u),p.forEach(function(n){if(n.setEnabled(!0),n instanceof e.AbstractMesh&&null!=n.metadata&&null!=n.metadata.shadowCastingMode&&0!==n.metadata.shadowCastingMode&&t.lights.forEach(function(e){var t=e.getShadowGenerator();if(null!=t){var o=null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0;if(o===!1){var i=t.getShadowMap();null==i.renderList&&(i.renderList=[]),i.renderList.indexOf(n)<0&&i.renderList.push(n)}}}),n instanceof e.Mesh)if(null!=n.source){if(null==n.skeleton&&null!=n.source.skeleton){var o=n.source.skeleton.name+".Skeleton",i=o+"."+n.source.skeleton.id;if(n.skeleton=n.source.skeleton.clone(o,i),null!=n.skeleton&&null!=n.skeleton.bones&&null!=n.source.skeleton.bones&&n.skeleton.bones.length===n.source.skeleton.bones.length)for(var r=n.skeleton.bones.length,a=0;a<r;a++)null==n.skeleton.bones[a].metadata&&null!=n.source.skeleton.bones[a].metadata&&(n.skeleton.bones[a].metadata=n.source.skeleton.bones[a].metadata)}}else e.Tools.Warn("Babylon.js encountered a null clone source for: "+n.name)});var d=[];if(p.forEach(function(e){d.push(e)}),null!=d&&d.length>0){var m=[];e.Utilities.PostParseSceneComponents(t,d,null,m),t.onAfterRenderObservable.addOnce(function(){if(null!=m&&m.length>0)for(var e=0;e<m.length;e++){var t=m[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})}}else e.Tools.Warn("Failed to create prefab of: "+n);else e.Tools.Warn("Failed to lookup prefab map: "+n)}else e.Tools.Warn("Unable to locate prefab master: "+n);return u},t.InstantiatePrefabFromContainer=function(t,n,o,i,r,a,l,s,u){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===s&&(s=!0),void 0===u&&(u=!1);var c=e.Utilities.CloneAssetContainerItem(t,n,function(e){return e},i,u,s);if(null!=c){null!=o&&""!==o&&(c.name=o),null!=r&&(c.position=r.clone()),null!=a&&(c.rotationQuaternion=a.clone()),null!=l&&(c.scaling=l.clone());var p=[];p.push(c);var h=c.getChildren(null,!1);null!=h&&h.length>0&&h.forEach(function(e){p.push(e)}),p.forEach(function(t){t.id=e.Utilities.CreateGuid(),t.setEnabled(!0)});var d=[];e.Utilities.PostParseSceneComponents(t.scene,p,null,d),t.scene.onAfterRenderObservable.addOnce(function(){if(null!=d&&d.length>0)for(var e=0;e<d.length;e++){var t=d[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})}return c},t.CloneTransformNode=function(t,n,o,i,r,a,l){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerNode(t,n),u=s.clone(o,i,!0);return null!=u&&(null!=r&&(u.position=r.clone()),null!=a&&(u.rotationQuaternion=a.clone()),null!=l&&(u.scaling=l.clone()),u.setEnabled(!0)),u},t.CloneAbstractMesh=function(t,n,o,i,r,a,l){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerMesh(t,n),u=s.clone(o,i,!0);return null!=u&&(null!=r&&(u.position=r.clone()),null!=a&&(u.rotationQuaternion=a.clone()),null!=l&&(u.scaling=l.clone()),u.setEnabled(!0)),u},t.CreateInstancedMesh=function(t,n,o,i,r,a,l){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerMesh(t,n),u=s.createInstance(o);return null!=u&&(null!=i&&(u.parent=i),null!=r&&(u.position=r.clone()),null!=a&&(u.rotationQuaternion=a.clone()),null!=l&&(u.scaling=l.clone()),u.setEnabled(!0)),u},t.RegisterScriptComponent=function(e,t,n){void 0===n&&(n=!0),null!=e&&e.registerComponentInstance&&e.registerComponentInstance(e,t,n)},t.DestroyScriptComponent=function(e){null!=e&&e.destroyComponentInstance&&e.destroyComponentInstance(e)},t.FindScriptComponent=function(e,t){if(null==e)return null;var n=null;if(null!=e.metadata&&e.metadata.unity){var o=e.metadata.unity;if(null!=o.components&&o.components.length>0)for(var i=0;i<o.components.length;i++){var r=o.components[i];if(null!=r.instance&&r.klass===t){n=r.instance;break}}}return null!=n?n:null},t.FindAllScriptComponents=function(e,t){if(null==e)return null;var n=null;if(null!=e.metadata&&e.metadata.unity){var o=e.metadata.unity;if(null!=o.components&&o.components.length>0)for(var i=0;i<o.components.length;i++){var r=o.components[i];null!=r.instance&&r.klass===t&&(null==n&&(n=[]),n.push(r.instance))}}return null!=n?n:null},t.FindSceneMetadata=function(e){return null==e?null:null!=e.metadata&&e.metadata.unity?e.metadata.unity:null},t.FindSceneCameraRig=function(e){return null==e?null:null!=e.cameraRig?e.cameraRig:null},t.FindSceneLightRig=function(e){return null==e?null:null!=e.lightRig?e.lightRig:null},t.FindTransformWithScript=function(t,n){var o=t.getNodes();return e.Utilities.SearchTransformNodeForScript(n,o)},t.FindAllTransformsWithScript=function(t,n){var o=t.getNodes();return e.Utilities.SearchAllTransformNodesForScript(n,o)},t.FindChildTransformNode=function(t,n,o,i,r){if(void 0===o&&(o=e.SearchType.ExactMatch),void 0===i&&(i=!0),void 0===r&&(r=null),null==t)return null;var a=null!=o?o:e.SearchType.ExactMatch,l=t.getChildren(r,i);return e.Utilities.SearchTransformNodes(n,l,a)},t.FindChildTransformWithTags=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchTransformNodeForTags(n,r)},t.FindAllChildTransformsWithTags=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchAllTransformNodesForTags(n,r)},t.FindChildTransformWithScript=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchTransformNodeForScript(n,r)},t.FindAllChildTransformsWithScript=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchAllTransformNodesForScript(n,r)},t.SearchForScriptComponentByName=function(t,n){var o=t.getNodes(),i=e.Utilities.SearchTransformNodeForScript(n,o);return e.SceneManager.FindScriptComponent(i,n)},t.SearchForAllScriptComponentsByName=function(t,n){var o=null,i=t.getNodes(),r=e.Utilities.SearchAllTransformNodesForScript(n,i);return null!=r&&r.length>0&&r.forEach(function(t){var i=e.SceneManager.FindScriptComponent(t,n);null!=i&&(null==o&&(o=[]),o.push(i))}),null!=o?o:null},t.MoveWithCollisions=function(e,t){return null==e?null:void(null!=t&&e.moveWithCollisions(t))},t.MoveWithTranslation=function(e,t){return null==e?null:void(null!=t&&e.position.addInPlace(t))},t.TurnWithRotation=function(t,n,o){return void 0===o&&(o=e.Space.LOCAL),null==t?null:void(0!=n&&t.rotate(e.Axis.Y,n,o))},t.GetRecastHeapSize=function(){if("undefined"==typeof Recast)return 0;var e=0;return Recast&&Recast.HEAP8&&Recast.HEAP8.length&&(e=Recast.HEAP8.length/1048576),e},t.GetNavigationTools=function(){if("undefined"!=typeof Recast)return null==e.SceneManager.PluginInstance&&(e.SceneManager.PluginInstance=new e.RecastJSPlugin),e.SceneManager.PluginInstance},t.GetCrowdInterface=function(t){if("undefined"==typeof Recast)return null;if(e.SceneManager.HasNavigationData()){var n=e.SceneManager.GetNavigationTools();return null!=n&&null==e.SceneManager.CrowdInterface&&(e.SceneManager.CrowdInterface=n.createCrowd(e.SceneManager.MAX_AGENT_COUNT,e.SceneManager.MAX_AGENT_RADIUS,t)),e.SceneManager.CrowdInterface}return null},t.HasNavigationData=function(){if("undefined"==typeof Recast)return!1;var t=e.SceneManager.GetNavigationTools();return null!=t&&null!=t.navMesh},t.GetNavigationMesh=function(){return"undefined"==typeof Recast?null:e.SceneManager.NavigationMesh},t.BakeNavigationMesh=function(t,n,o,i,r,a){if(void 0===i&&(i=!1),void 0===r&&(r=null),void 0===a&&(a=!1),"undefined"==typeof Recast)return null;e.Tools.Log("Recast.js baking navigation mesh data");var l=e.SceneManager.GetNavigationTools();if(null!=l)if(l.createNavMesh(n,o),null!=l.navMesh){var s="NavigationMesh",u=t.getMaterialByName(s);null==u&&(u=new e.StandardMaterial(s,t),u.diffuseColor=r||new e.Color3(.05,.225,.75),u.alpha=.5),e.SceneManager.NavigationMesh=l.createDebugNavMesh(t),null!=e.SceneManager.NavigationMesh&&(e.SceneManager.NavigationMesh.material=u,e.SceneManager.NavigationMesh.isPickable=!0,e.SceneManager.NavigationMesh.isVisible=!0,e.SceneManager.NavigationMesh.visibility=i===!0?1:0,e.SceneManager.NavigationMesh.renderingGroupId=e.Utilities.ColliderRenderGroup(),e.Tags.AddTagsTo(e.SceneManager.NavigationMesh,"Navigation"),e.Utilities.ValidateTransformMetadata(e.SceneManager.NavigationMesh),a===!0&&(e.SceneManager.NavigationMesh.checkCollisions=!0,e.RigidbodyPhysics&&(e.SceneManager.NavigationMesh.metadata.unity.physics=e.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new e.Vector3(0,0,0)),e.SceneManager.NavigationMesh.metadata.unity.collision=e.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),e.RigidbodyPhysics.SetupPhysicsComponent(t,e.SceneManager.NavigationMesh)))),null!=e.SceneManager.NavigationMesh?e.SceneManager.OnNavMeshReadyObservable.hasObservers()===!0&&e.SceneManager.OnNavMeshReadyObservable.notifyObservers(e.SceneManager.NavigationMesh):e.Tools.Warn("Failed to generate navigation mesh geometry")}else e.Tools.Warn("Failed to create navigation mesh data");return e.SceneManager.NavigationMesh},t.LoadNavigationMesh=function(t,n,o,i,r,a){if(void 0===o&&(o=!1),void 0===i&&(i=null),void 0===r&&(r=0),void 0===a&&(a=!1),"undefined"==typeof Recast)return null;e.Tools.Log("Recast.js loading prebaked navigation mesh");var l=e.SceneManager.GetNavigationTools();if(null!=l)if(l.setTimeStep&&l.setTimeStep(r),l.buildFromNavmeshData(n),null!=l.navMesh){var s="NavigationMesh",u=t.getMaterialByName(s);null==u&&(u=new e.StandardMaterial(s,t),u.diffuseColor=i||new e.Color3(.05,.225,.75),u.alpha=.5),e.SceneManager.NavigationMesh=l.createDebugNavMesh(t),null!=e.SceneManager.NavigationMesh&&(e.SceneManager.NavigationMesh.material=u,e.SceneManager.NavigationMesh.isPickable=!0,e.SceneManager.NavigationMesh.isVisible=!0,e.SceneManager.NavigationMesh.visibility=o===!0?1:0,e.SceneManager.NavigationMesh.renderingGroupId=e.Utilities.ColliderRenderGroup(),e.Tags.AddTagsTo(e.SceneManager.NavigationMesh,"Navigation"),e.Utilities.ValidateTransformMetadata(e.SceneManager.NavigationMesh),a===!0&&(e.SceneManager.NavigationMesh.checkCollisions=!0,e.RigidbodyPhysics&&(e.SceneManager.NavigationMesh.metadata.unity.physics=e.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new e.Vector3(0,0,0)),e.SceneManager.NavigationMesh.metadata.unity.collision=e.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),e.RigidbodyPhysics.SetupPhysicsComponent(t,e.SceneManager.NavigationMesh)))),null!=e.SceneManager.NavigationMesh?e.SceneManager.OnNavMeshReadyObservable.hasObservers()===!0&&e.SceneManager.OnNavMeshReadyObservable.notifyObservers(e.SceneManager.NavigationMesh):e.Tools.Warn("Failed to generate navigation mesh geometry")}else e.Tools.Warn("Failed to build navigation mesh data");return e.SceneManager.NavigationMesh},t.SaveNavigationMesh=function(){if("undefined"==typeof Recast)return null;var t=e.SceneManager.GetNavigationTools();return null!=t&&null!=t.navMesh?t.getNavmeshData():null},t.ComputeNavigationPath=function(t,n,o){if(void 0===o&&(o=!0),"undefined"==typeof Recast)return null;var i=e.SceneManager.GetNavigationTools(),r=o===!0?i.getClosestPoint(t):t,a=o===!0?i.getClosestPoint(n):n;return null!=i&&null!=i.navMesh?i.computePath(r,a):null},t.MoveAlongNavigationPath=function(t,n,o,i,r,a){void 0===r&&(r=null);var l=null;if(o&&o.length>0){for(var s=0,u=[{frame:0,value:n.position}],c=0;c<o.length;c++)s+=e.Vector3.Distance(u[c].value,o[c]),u.push({frame:s,value:o[c]});l=new e.Animation("Navigation","position",3,e.Animation.ANIMATIONTYPE_VECTOR3,e.Animation.ANIMATIONLOOPMODE_CONSTANT),null!=r&&l.setEasingFunction(r),l.setKeys(u),n.animations=[l],t.beginAnimation(n,0,s,!1,i,a)}return l},t.AddNavigationCylinderObstacle=function(t,n,o){if("undefined"==typeof Recast)return null;var i=e.SceneManager.GetNavigationTools();return null!=i&&null!=i.navMesh?i.addCylinderObstacle(t,n,o):null},t.AddNavigationBoxObstacle=function(t,n,o){if("undefined"==typeof Recast)return null;var i=e.SceneManager.GetNavigationTools();return null!=i&&null!=i.navMesh?i.addBoxObstacle(t,n,o):null},t.RemoveNavigationObstacle=function(t){if("undefined"==typeof Recast)return null;var n=e.SceneManager.GetNavigationTools();null!=n&&null!=n.navMesh&&n.removeObstacle(t)},t.ToggleFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().switchFullscreen(t)},t.EnterFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().enterFullscreen(t)},t.ExitFullscreenMode=function(e){e.getEngine().exitFullscreen()},t.WindowState={},t.GlobalOptions={},t.ServerEndPoint="http://127.0.0.1:2567",t.EnableUserInput=!0,t.RenderLoopReady=!0,t.PauseRenderLoop=!1,t.LostRenderContext=!1,t.AutoUpdateProgress=!0,t.PhysicsCapsuleShape=0,t.SupportSRGBBuffers=!1,t.AnimationStartMode=e.GLTFLoaderAnimationStartMode.NONE,t.AnimationTargetFps=60,t.DefaultConvexHullMargin=.001,t.DefaultHeightFieldMargin=.001,t.AmbientLightIntensity=.5,t.PointLightIntensity=1,t.SpotLightIntensity=10,t.DirectionalLightIntensity=2,t.TerrainColorCorrection=2.2,t.AllowCameraMovement=!0,t.AllowCameraRotation=!0,t.VirtualJoystickEnabled=!1,t.GameTimeMilliseconds=0,t.WaitForSeconds=function(t){return new Promise(function(n){return e.SceneManager.SetTimeout(1e3*t,n)})},t.OnPreRenderLoopObservable=new e.Observable,t.OnPostRenderLoopObservable=new e.Observable,t.OnEngineResizeObservable=new e.Observable,t.OnLoadCompleteObservable=new e.Observable,t.OnRebuildContextObservable=new e.Observable,t.OnAssetManagerProgress=null,t.SceneParsingEnabled=!0,t.AdvDynamicTexture=null,t.MAX_AGENT_COUNT=200,t.MAX_AGENT_RADIUS=2,t.NavigationMesh=null,t.CrowdInterface=null,t.PluginInstance=null,t.OnNavMeshReadyObservable=new e.Observable,t}();e.SceneManager=t}(BABYLON||(BABYLON={}));var SM=BABYLON.SceneManager;BABYLON.SceneManager.GameTimeMilliseconds=BABYLON.SceneManager.GetTimeMilliseconds();var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),BABYLON;!function(e){var t;!function(t){t[t.Deg2Rad=2*Math.PI/360]="Deg2Rad",t[t.Rad2Deg=1/e.System.Deg2Rad]="Rad2Deg",t[t.Epsilon=1e-6]="Epsilon",t[t.SingleEpsilon=1.401298e-45]="SingleEpsilon",t[t.EpsilonNormalSqrt=1e-15]="EpsilonNormalSqrt",t[t.Kph2Mph=.621371]="Kph2Mph",t[t.Mph2Kph=1.60934]="Mph2Kph",t[t.Mps2Kph=3.6]="Mps2Kph",t[t.Mps2Mph=2.23694]="Mps2Mph",t[t.Meter2Inch=39.3701]="Meter2Inch",t[t.Inch2Meter=.0254]="Inch2Meter",t[t.Gravity=9.81]="Gravity",t[t.Gravity3G=29.400000000000002]="Gravity3G",t[t.SkidFactor=.25]="SkidFactor",t[t.MaxInteger=2147483647]="MaxInteger",t[t.WalkingVelocity=4.4]="WalkingVelocity",t[t.TerminalVelocity=55]="TerminalVelocity",t[t.SmoothDeltaFactor=.2]="SmoothDeltaFactor",t[t.ToLinearSpace=2.2]="ToLinearSpace",t[t.ToGammaSpace=.45454545454545453]="ToGammaSpace"}(t=e.System||(e.System={}));var n;!function(e){e[e.Default=-1]="Default",e[e.Right=0]="Right",e[e.Left=1]="Left"}(n=e.Handedness||(e.Handedness={}));var o;!function(e){e[e.ExactMatch=0]="ExactMatch",e[e.StartsWith=1]="StartsWith",e[e.EndsWith=2]="EndsWith",e[e.IndexOf=3]="IndexOf"}(o=e.SearchType||(e.SearchType={}));var i;!function(e){e[e.Auto=0]="Auto",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four"}(i=e.PlayerNumber||(e.PlayerNumber={}));var r;!function(e){e[e.FirstPerson=0]="FirstPerson",e[e.ThirdPerson=1]="ThirdPerson"}(r=e.PlayerControl||(e.PlayerControl={}));var a;!function(e){e[e.High=0]="High",e[e.Medium=1]="Medium",e[e.Low=2]="Low"}(a=e.RenderQuality||(e.RenderQuality={}));var l;!function(e){e[e.None=-1]="None",e[e.Generic=0]="Generic",e[e.Xbox360=1]="Xbox360",e[e.DualShock=2]="DualShock",e[e.PoseController=3]="PoseController"}(l=e.GamepadType||(e.GamepadType={}));var s;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(s=e.Xbox360Trigger||(e.Xbox360Trigger={}));var u;!function(e){e[e.DirectVelocity=0]="DirectVelocity",e[e.AppliedForces=1]="AppliedForces"}(u=e.MovementType||(e.MovementType={}));var c;!function(e){e[e.Top=0]="Top",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Bottom=3]="Bottom"}(c=e.CollisionContact||(e.CollisionContact={}));var p;!function(e){e[e.AABB=0]="AABB",e[e.OBB=1]="OBB"}(p=e.IntersectionPrecision||(e.IntersectionPrecision={}));var h;!function(e){e[e.DefaultFilter=1]="DefaultFilter",e[e.StaticFilter=2]="StaticFilter",e[e.KinematicFilter=4]="KinematicFilter",e[e.DebrisFilter=8]="DebrisFilter",e[e.SensorTrigger=16]="SensorTrigger",e[e.CharacterFilter=32]="CharacterFilter",e[e.AllFilter=-1]="AllFilter"}(h=e.CollisionFilters||(e.CollisionFilters={}));var d;!function(e){e[e.ACTIVE_TAG=1]="ACTIVE_TAG",e[e.ISLAND_SLEEPING=2]="ISLAND_SLEEPING",e[e.WANTS_DEACTIVATION=3]="WANTS_DEACTIVATION",e[e.DISABLE_DEACTIVATION=4]="DISABLE_DEACTIVATION",e[e.DISABLE_SIMULATION=5]="DISABLE_SIMULATION"}(d=e.CollisionState||(e.CollisionState={}));var m;!function(e){e[e.CF_STATIC_OBJECT=1]="CF_STATIC_OBJECT",e[e.CF_KINEMATIC_OBJECT=2]="CF_KINEMATIC_OBJECT",e[e.CF_NO_CONTACT_RESPONSE=4]="CF_NO_CONTACT_RESPONSE",e[e.CF_CUSTOM_MATERIAL_CALLBACK=8]="CF_CUSTOM_MATERIAL_CALLBACK",e[e.CF_CHARACTER_OBJECT=16]="CF_CHARACTER_OBJECT",e[e.CF_DISABLE_VISUALIZE_OBJECT=32]="CF_DISABLE_VISUALIZE_OBJECT",e[e.CF_DISABLE_SPU_COLLISION_PROCESSING=64]="CF_DISABLE_SPU_COLLISION_PROCESSING",e[e.CF_HAS_CONTACT_STIFFNESS_DAMPING=128]="CF_HAS_CONTACT_STIFFNESS_DAMPING",e[e.CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR=256]="CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR",e[e.CF_HAS_FRICTION_ANCHOR=512]="CF_HAS_FRICTION_ANCHOR",e[e.CF_HAS_COLLISION_SOUND_TRIGGER=1024]="CF_HAS_COLLISION_SOUND_TRIGGER"}(m=e.CollisionFlags||(e.CollisionFlags={}));var g;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(g=e.UserInputPointer||(e.UserInputPointer={}));var f;!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.ClientX=2]="ClientX",e[e.ClientY=3]="ClientY",e[e.MouseX=4]="MouseX",e[e.MouseY=5]="MouseY",e[e.Wheel=6]="Wheel"}(f=e.UserInputAxis||(e.UserInputAxis={}));var y;!function(e){e[e.BackSpace=8]="BackSpace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Pause=19]="Pause",e[e.Break=19]="Break",e[e.CapsLock=20]="CapsLock",e[e.Escape=27]="Escape",e[e.SpaceBar=32]="SpaceBar",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.LeftArrow=37]="LeftArrow",e[e.UpArrow=38]="UpArrow",e[e.RightArrow=39]="RightArrow",e[e.DownArrow=40]="DownArrow",e[e.Insert=45]="Insert",e[e.Delete=46]="Delete",e[e.Num0=48]="Num0",e[e.Num1=49]="Num1",e[e.Num2=50]="Num2",e[e.Num3=51]="Num3",e[e.Num4=52]="Num4",e[e.Num5=53]="Num5",e[e.Num6=54]="Num6",e[e.Num7=55]="Num7",e[e.Num8=56]="Num8",e[e.Num9=57]="Num9",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.LeftWindowKey=91]="LeftWindowKey",e[e.RightWindowKey=92]="RightWindowKey",e[e.SelectKey=93]="SelectKey",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.Multiply=106]="Multiply",e[e.Add=107]="Add",e[e.Subtract=109]="Subtract",e[e.DecimalPoint=110]="DecimalPoint",e[e.Divide=111]="Divide",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=144]="NumLock",e[e.ScrollLock=145]="ScrollLock",e[e.SemiColon=186]="SemiColon",e[e.EqualSign=187]="EqualSign",e[e.Comma=188]="Comma",e[e.Dash=189]="Dash",e[e.Period=190]="Period",e[e.ForwardSlash=191]="ForwardSlash",e[e.GraveAccent=192]="GraveAccent",e[e.OpenBracket=219]="OpenBracket",e[e.BackSlash=220]="BackSlash",e[e.CloseBraket=221]="CloseBraket",e[e.SingleQuote=222]="SingleQuote"}(y=e.UserInputKey||(e.UserInputKey={}));var _=function(){function e(){}return e.KeyboardSmoothing=!1,e.KeyboardMoveSensibility=3,e.KeyboardMoveDeadZone=.001,e.GamepadDeadStickValue=.25,e.GamepadLStickXInverted=!1,e.GamepadLStickYInverted=!1,e.GamepadRStickXInverted=!1,e.GamepadRStickYInverted=!0,e.GamepadLStickSensibility=1,e.GamepadRStickSensibility=1,e.SupportedInputDevices=null,e.PointerAngularSensibility=.5,e.PointerWheelDeadZone=.1,e.PointerMouseDeadZone=.1,e.PointerMouseInverted=!0,e.UseCanvasElement=!0,e.UseArrowKeyRotation=!1,e}();e.UserInputOptions=_;var v=function(){function e(){}return e}();e.RequestHeader=v;var b=function(){function e(){this.mesh=null,this.state=0}return e}();e.TriggerVolume=b;var C=function(){function e(){}return e}();e.RoomErrorMessage=C;var T=function(){function e(){this.ListenerDictionary={}}return e.prototype.AddListener=function(e,t){var n;null==this.ListenerDictionary[e]?(n=[],this.ListenerDictionary[e]=n):n=this.ListenerDictionary[e],n.push(t)},e.prototype.RemoveListener=function(e,t){var n=this.ListenerDictionary[e];if(null!=n){var o=n.findIndex(function(e){return t==e});o>=0&&n.splice(o,1)}},e.prototype.RaiseMessage=function(e,t){void 0===t&&(t=null);var n=this.ListenerDictionary[e];null!=n&&n.forEach(function(e){e(t)})},e}();e.EventMessageBus=T;var M=function(){function t(e,t,n,o,i,r){void 0===n&&(n=1),void 0===o&&(o=!0),void 0===i&&(i=!1),void 0===r&&(r=!0),this.prefabName=null,this.allowGrowth=!0,this.assetContainer=null,this.cloneAnimations=!0,this.makeNewMaterials=!1,this.availableInstances=null,this.prefabName=t,this.allowGrowth=o,this.assetContainer=e,this.cloneAnimations=r,this.makeNewMaterials=i,this.availableInstances=[],this.populatePool(n)}return t.prototype.getAvailableCount=function(){
return this.availableInstances.length},t.prototype.populatePool=function(e){if(e>0)for(var t=0;t<e;t++){var n=this.createNewInstance();null!=n&&this.freeInstance(n)}},t.prototype.getInstance=function(t,n){void 0===t&&(t=null),void 0===n&&(n=null);var o=this.availableInstances.length>0?this.availableInstances.pop():this.appendNewInstance();return null!=o&&(null!=t?o.position.copyFrom(t):o.position.set(0,0,0),null!=n?null!=o.rotationQuaternion?o.rotationQuaternion.copyFrom(n):o.rotationQuaternion=n.clone():null!=o.rotationQuaternion?o.rotationQuaternion.set(0,0,0,1):o.rotationQuaternion=new e.Quaternion(0,0,0,1),o.name=this.prefabName+".Instance",o.setEnabled(!0)),o},t.prototype.freeInstance=function(t){null!=t&&(t.setEnabled(!1),t.position.set(0,0,0),null!=t.rotationQuaternion?t.rotationQuaternion.set(0,0,0,1):t.rotationQuaternion=new e.Quaternion(0,0,0,1),null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.components&&t.metadata.unity.components.forEach(function(e){if(null!=e)try{e.resetScriptComponent()}catch(t){}}),t.name=this.prefabName+".Unassigned",this.availableInstances.push(t))},t.prototype.appendNewInstance=function(){var e=null;return this.allowGrowth===!0&&(e=this.createNewInstance()),e},t.prototype.createNewInstance=function(t,n,o,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null);var r=null;return null!=this.assetContainer&&null!=this.prefabName&&""!==this.prefabName&&(this.assetContainer instanceof e.AssetContainer?r=e.SceneManager.InstantiatePrefabFromContainer(this.assetContainer,this.prefabName,this.prefabName+".Instance",t,n,o,i,this.cloneAnimations,this.makeNewMaterials):this.assetContainer instanceof e.Scene&&(r=e.SceneManager.InstantiatePrefabFromScene(this.assetContainer,this.prefabName,this.prefabName+".Instance",t,n,o,i,this.cloneAnimations))),r},t}();e.PrefabObjectPool=M;var S=function(){function t(){this._hit=!1,this._dest=new e.Vector3(0,0,0),this._origin=new e.Vector3(0,0,0),this._hitPoint=new e.Vector3(0,0,0),this._hitNormal=new e.Vector3(0,0,0),this._hitDistance=0,this._collisionObject=null,this.reset(e.Vector3.Zero(),e.Vector3.Zero())}return Object.defineProperty(t.prototype,"hasHit",{get:function(){return this._hit},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hitPoint",{get:function(){return this._hitPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hitNormal",{get:function(){return this._hitNormal},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionObject",{get:function(){return this._collisionObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rayDestination",{get:function(){return this._dest},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rayOrigin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),t.prototype.reset=function(e,t){this._hit=!1,this._hitPoint.set(0,0,0),this._hitNormal.set(0,0,0),this._hitDistance=0,this._collisionObject=null,this._origin.copyFrom(e),this._dest.copyFrom(t)},t.prototype.update=function(t,n,o,i,r,a,l,s){void 0===s&&(s=null),this._hit=t,this._hitPoint.set(n,o,i),this._hitNormal.set(r,a,l),this._hitDistance=e.Vector3.Distance(this._origin,this.hitPoint),this._collisionObject=s},t}();e.RaycastHitResult=S;var I=function(){function t(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=.5),this._numPoints=-1,this._pointMesh=null,this._pointSize=.5,this._pointType=0,this._linesName="MeshLines",this._linesMesh=null,this._babylonScene=null,this._pointMesh=null,this._linesMesh=null,this._linesName=e,this._babylonScene=t,this._pointType=n,this._pointSize=o}return Object.defineProperty(t.prototype,"pointMesh",{get:function(){return this._pointMesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linesMesh",{get:function(){return this._linesMesh},enumerable:!1,configurable:!0}),t.prototype.dispose=function(e){void 0===e&&(e=!0),this._babylonScene=null,this._linesName=null,null!=this._pointMesh&&(this._pointMesh.dispose(e),this._pointMesh=null),null!=this._linesMesh&&(this._linesMesh.dispose(e),this._linesMesh=null)},t.prototype.hidePoint=function(e){void 0===e&&(e=!0),null!=this._pointMesh&&(this._pointMesh.isVisible=!e)},t.prototype.drawPoint=function(t){null==this._pointMesh&&(1===this._pointType?(this._pointMesh=e.MeshBuilder.CreateBox(this._linesName+".EndPoint",{size:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25):(this._pointMesh=e.MeshBuilder.CreateSphere(this._linesName+".EndPoint",{segments:24,diameter:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25)),null!=this._pointMesh&&(this._pointMesh.isVisible=!0,this._pointMesh.position.copyFrom(t))},t.prototype.drawLine=function(t,n){void 0===n&&(n=null),null==this._linesMesh?(this._numPoints=t.length,this._linesMesh=e.MeshBuilder.CreateLines(this._linesName,{points:t,updatable:!0},this._babylonScene),this._linesMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),null!=n&&(this._linesMesh.color=n),this._linesMesh.refreshBoundingInfo(!1)):t.length===this._numPoints?(this._linesMesh=e.MeshBuilder.CreateLines(this._linesName,{points:t,instance:this._linesMesh},this._babylonScene),this._linesMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),null!=n&&(this._linesMesh.color=n),this._linesMesh.refreshBoundingInfo(!1)):e.Tools.Warn("Dynamic line mesh point count mismatch for "+this._linesName)},t}();e.LinesMeshRenderer=I;var P=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.addContainerTask=function(t,n,o,i){var r=this,a=new e.ContainerAssetTask(t,n,o,i),l=a;return l._lengthComputable=0,l._loaded=0,l._total=0,l.runTask=function(t,n,o){e.SceneLoader.LoadAssetContainer(a.rootUrl,a.sceneFilename,t,function(e){a.loadedContainer=e,a.loadedMeshes=e.meshes,a.loadedParticleSystems=e.particleSystems,a.loadedSkeletons=e.skeletons,a.loadedAnimationGroups=e.animationGroups,n()},function(e){l._lengthComputable=e.lengthComputable,l._loaded=e.loaded,l._total=e.total,r.handlePreloadingProgress()},function(e,t,n){o(t,n)})},this._tasks.push(a),a},n.prototype.addMeshTask=function(t,n,o,i){var r=this,a=new e.MeshAssetTask(t,n,o,i),l=a;return l._lengthComputable=0,l._loaded=0,l._total=0,l.runTask=function(t,n,o){e.SceneLoader.ImportMesh(a.meshesNames,a.rootUrl,a.sceneFilename,t,function(e,t,o,i){a.loadedMeshes=e,a.loadedParticleSystems=t,a.loadedSkeletons=o,a.loadedAnimationGroups=i,n()},function(e){l._lengthComputable=e.lengthComputable,l._loaded=e.loaded,l._total=e.total,r.handlePreloadingProgress()},function(e,t,n){o(t,n)})},this._tasks.push(a),a},n.prototype.addTextFileTask=function(t,n){var o=this,i=new e.TextFileAssetTask(t,n),r=i;return r._lengthComputable=0,r._loaded=0,r._total=0,r.runTask=function(e,t,n){e._loadFile(i.url,function(e){i.text=e,t()},function(e){r._lengthComputable=e.lengthComputable,r._loaded=e.loaded,r._total=e.total,o.handlePreloadingProgress()},!1,!1,function(e,t){e&&n(e.status+" "+e.statusText,t)})},this._tasks.push(i),i},n.prototype.addBinaryFileTask=function(t,n){var o=this,i=new e.BinaryFileAssetTask(t,n),r=i;return r._lengthComputable=0,r._loaded=0,r._total=0,r.runTask=function(e,t,n){e._loadFile(i.url,function(e){i.data=e,t()},function(e){r._lengthComputable=e.lengthComputable,r._loaded=e.loaded,r._total=e.total,o.handlePreloadingProgress()},!0,!0,function(e,t){e&&n(e.status+" "+e.statusText,t)})},this._tasks.push(i),i},n.prototype.addImageTask=function(t,n){var o=this,i=new e.ImageAssetTask(t,n),r=i;return r._lengthComputable=0,r._loaded=0,r._total=0,r.runTask=function(t,n,a){var l=new Image;e.Tools.SetCorsBehavior(i.url,l),l.onload=function(){i.image=l,n()},l.onerror=function(e){a("Error loading image",e)},l.onprogress=function(e){r._lengthComputable=e.lengthComputable,r._loaded=e.loaded,r._total=e.total,o.handlePreloadingProgress()},l.src=i.url},this._tasks.push(i),i},n.prototype.handlePreloadingProgress=function(){var t=!0,n=0,o=0;if(null!=this._tasks&&this._tasks.length>0)for(var i=0;i<this._tasks.length;i++){var r=this._tasks[i];null!=r._lengthComputable&&null!=r._loaded&&null!=r._total&&(t=t&&r._lengthComputable,n+=r._loaded,o+=r._total)}if(null!=e.SceneManager.OnAssetManagerProgress){var a={lengthComputable:t,loaded:n,total:t?o:0};e.SceneManager.OnAssetManagerProgress(a)}},n}(e.AssetsManager);e.PreloadAssetsManager=P;var A=function(){function e(){}return e.HasNetworkEntity=function(e){return null!=e&&null!=e.networkEntity},e.GetNetworkEntityId=function(e){return null==e?null:null!=e.networkEntity?e.networkEntity.id:null},e.GetNetworkEntityType=function(e){return null==e?0:null!=e.networkEntityType?e.networkEntityType:0},e.GetNetworkEntitySessionId=function(e){return null==e?null:null!=e.networkEntity?e.networkEntity.ownerId:null},e.QueryNetworkAttribute=function(e,t){var n=null;return null!=e&&null!=e.networkEntity&&null!=e.networkEntity.attributes&&(n=e.networkEntity.attributes.get(t)),n},e.QueryBufferedAttribute=function(e,t){var n=0;return null!=e&&null!=e.networkEntityAttributeBuffer&&(n=e.networkEntityAttributeBuffer[t.toFixed(0)]),n},e.PostBufferedAttribute=function(e,t,n){null==e.networkEntityBatch&&(e.networkEntityBatch={}),e.networkEntityBatch[t.toFixed(0)]=n},e}();e.EntityController=A;var x=function(){function t(){}return t.ZeroPad=function(e,t){var n=t-e.toString().length+1;return Array(+(n>0&&n)).join("0")+e},t.ShiftArray=function(e,t){return t?e.unshift(e.pop()):e.push(e.shift()),e},t.IsLayerMasked=function(e,t){return 0!=(e&1<<t)},t.GetLoadingState=function(){return e.Utilities.LoadingState},t.GetRandomRange=function(t,n,o,i){void 0===o&&(o=null),void 0===i&&(i=null);var r=e.Scalar.RandomRange(t,n);if(null!=o){var a=null!=i?i:100;if(r===o)for(var l=0;l<a&&(r=e.Scalar.RandomRange(t,n),r===o);l++);}return r},t.GetRandomFloat=function(t,n,o,i){return void 0===o&&(o=null),void 0===i&&(i=null),parseFloat(e.Utilities.GetRandomRange(t,n,o,i).toFixed(2))},t.GetRandomInteger=function(t,n,o,i){return void 0===o&&(o=null),void 0===i&&(i=null),parseInt(e.Utilities.GetRandomRange(t,n,o,i).toFixed(0))},t.Approximately=function(t,n){return Math.abs(n-t)<Math.max(e.System.Epsilon*Math.max(Math.abs(t),Math.abs(n)),8*e.System.SingleEpsilon)},t.GetVertexDataFromMesh=function(t){var n=t.computeWorldMatrix(!0),o=e.VertexData.ExtractFromMesh(t,!0,!0);return o.transform(n),o},t.UpdateAbstractMeshMaterial=function(t,n,o){if(null!=t){var i=t instanceof e.InstancedMesh;if(i===!1){var r=t.material;if(r instanceof e.MultiMaterial){var a=r.clone(r.name+".Clone");a.subMaterials[o]=n,t.material=a}else t.material=n}else console.warn("Instanced mesh not supported as a node material on mesh: "+t.name)}else console.warn("Null source mesh for mesh: "+t.name)},t.HermiteVector3=function(t,n,o,i,r){var a=new e.Vector3(0,0,0);return e.Utilities.HermiteVector3ToRef(t,n,o,i,r,a),a},t.HermiteVector3ToRef=function(e,t,n,o,i,r){var a=i*i,l=i*a,s=2*l-3*a+1,u=-2*l+3*a,c=l-2*a+i,p=l-a,h=e._x*s+n._x*u+t._x*c+o._x*p,d=e._y*s+n._y*u+t._y*c+o._y*p,m=e._z*s+n._z*u+t._z*c+o._z*p;r.set(h,d,m)},t.LerpLog=function(e,t,n){var o=Math.min(Math.max(n,0),1),i=Math.sin(o*Math.PI*.5);return e+(t-e)*i},t.LerpExp=function(e,t,n){var o=Math.min(Math.max(n,0),1),i=1-Math.cos(o*Math.PI*.5);return e+(t-e)*i},t.LerpUnclamped=function(e,t,n){return e+(t-e)*n},t.LerpUnclampedColor3=function(t,n,o){var i=new e.Color3(0,0,0);return e.Utilities.LerpUnclampedColor3ToRef(t,n,o,i),i},t.LerpUnclampedColor3ToRef=function(e,t,n,o){o.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n)},t.LerpUnclampedColor4=function(t,n,o){var i=new e.Color4(0,0,0,1);return e.Utilities.LerpUnclampedColor4ToRef(t,n,o,i),i},t.LerpUnclampedColor4ToRef=function(e,t,n,o){o.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n,e.a+(t.a-e.a)*n)},t.LerpUnclampedVector2=function(t,n,o){var i=new e.Vector2(0,0);return e.Utilities.LerpUnclampedVector2ToRef(t,n,o,i),i},t.LerpUnclampedVector2ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},t.LerpUnclampedVector3=function(t,n,o){var i=new e.Vector3(0,0,0);return e.Utilities.LerpUnclampedVector3ToRef(t,n,o,i),i},t.LerpUnclampedVector3ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n)},t.LerpUnclampedVector4=function(t,n,o){var i=new e.Vector4(0,0,0,0);return e.Utilities.LerpUnclampedVector4ToRef(t,n,o,i),i},t.LerpUnclampedVector4ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n,e.w+(t.w-e.w)*n)},t.IsEqualUsingDot=function(t){return t>1-e.System.Epsilon},t.QuaternionAngle=function(t,n){var o=Math.min(Math.abs(e.Quaternion.Dot(t,n)),1);return e.Utilities.IsEqualUsingDot(o)?0:2*Math.acos(o)*e.System.Rad2Deg},t.QuaternionLengthSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},t.QuaternionRotateTowards=function(t,n,o){var i=new e.Quaternion(0,0,0,1);return e.Utilities.QuaternionRotateTowardsToRef(t,n,o,i),i},t.QuaternionRotateTowardsToRef=function(t,n,o,i){var r=e.Utilities.QuaternionAngle(t,n);0==r?i.copyFrom(n):e.Utilities.QuaternionSlerpUnclampedToRef(t,n,Math.min(1,o/r),i)},t.QuaternionSlerpUnclamped=function(t,n,o){var i=new e.Quaternion(0,0,0,1);return e.Utilities.QuaternionSlerpUnclampedToRef(t,n,o,i),i},t.QuaternionSlerpUnclampedToRef=function(e,t,n,o){},t.MoveTowardsVector2=function(t,n,o){var i=new e.Vector2(0,0);return e.Utilities.MoveTowardsVector2ToRef(t,n,o,i),i},t.MoveTowardsVector2ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=i*i+r*r;if(0==a||n>=0&&a<=n*n)o.set(t.x,t.y);else{var l=Math.sqrt(a);o.set(e.x+i/l*n,e.y+r/l*n)}},t.MoveTowardsVector3=function(t,n,o){var i=new e.Vector3(0,0,0);return e.Utilities.MoveTowardsVector3ToRef(t,n,o,i),i},t.MoveTowardsVector3ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z,l=i*i+r*r+a*a;if(0==l||n>=0&&l<=n*n)o.set(t.x,t.y,t.z);else{var s=Math.sqrt(l);o.set(e.x+i/s*n,e.y+r/s*n,e.z+a/s*n)}},t.MoveTowardsVector4=function(t,n,o){var i=new e.Vector4(0,0,0,0);return e.Utilities.MoveTowardsVector4ToRef(t,n,o,i),i},t.MoveTowardsVector4ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z,l=t.w-e.w,s=i*i+r*r+a*a+l*l;if(0==s||n>=0&&s<=n*n)o.set(t.x,t.y,t.z,t.w);else{var u=Math.sqrt(s);o.set(e.x+i/u*n,e.y+r/u*n,e.z+a/u*n,e.w+l/u*n)}},t.ClampMagnitudeVector2=function(t,n){var o=new e.Vector2(0,0);return e.Utilities.ClampMagnitudeVector2ToRef(t,n,o),o},t.ClampMagnitudeVector2ToRef=function(e,t,n){var o=e.lengthSquared();if(o>t*t){var i=Math.sqrt(o),r=e.x/i,a=e.y/i;n.set(r*t,a*t)}},t.ClampMagnitudeVector3=function(t,n){var o=new e.Vector3(0,0,0);return e.Utilities.ClampMagnitudeVector3ToRef(t,n,o),o},t.ClampMagnitudeVector3ToRef=function(e,t,n){var o=e.lengthSquared();if(o>t*t){var i=Math.sqrt(o),r=e.x/i,a=e.y/i,l=e.z/i;n.set(r*t,a*t,l*t)}},t.GetAngle=function(t,n){return e.Utilities.GetAngleRadians(t,n)*e.System.Rad2Deg},t.GetAngleRadians=function(t,n){return Math.acos(e.Vector3.Dot(t,n))},t.ClampAngle=function(t,n,o){var i=t;do i<-360&&(i+=360),i>360&&(i-=360);while(i<-360||i>360);return e.Scalar.Clamp(i,n,o)},t.ClampAngle180=function(t,n,o){return t>180&&(t-=360),t=e.Scalar.Clamp(t,n,o),t<0&&(t+=360),t},t.ClampAngle360=function(t,n,o){return(t<90||t>270)&&(t>180&&(t-=360),o>180&&(o-=360),n>180&&(n-=360)),t=e.Scalar.Clamp(t,n,o),t<0&&(t+=360),t},t.SmoothDamp=function(t,n,o,i,r,a){if(!a)return 0;var l=t-n,s=Math.max(1e-4,o),u=2/s,c=u*r,p=1/(1+c+.48*c*c+.235*c*c*c),h=n,d=i*s;l=e.Scalar.Clamp(l,-d,d);var m=t-l,g=(a.x+u*l)*r;a.x=(a.x-u*g)*p;var f=m+(l+g)*p;return h-t>0==f>h&&(f=h,a.x=(f-h)/r),f},t.SmoothDampAngle=function(t,n,o,i,r,a){var l=t+e.Scalar.DeltaAngle(t,n);return e.Utilities.SmoothDamp(t,l,o,i,r,a)},t.SmoothDampVector2=function(t,n,o,i,r,a){var l=new e.Vector2(0,0);return e.Utilities.SmoothDampVector2ToRef(t,n,o,i,r,a,l),l},t.SmoothDampVector2ToRef=function(e,t,n,o,i,r,a){n=Math.max(1e-4,n);var l=2/n,s=l*i,u=1/(1+s+.48*s*s+.235*s*s*s),c=e.x-t.x,p=e.y-t.y,h=t.clone(),d=o*n,m=d*d,g=c*c+p*p;if(g>m){var f=Math.sqrt(g);c=c/f*d,p=p/f*d}t.x=e.x-c,t.y=e.y-p;var y=(r.x+l*c)*i,_=(r.y+l*p)*i;r.x=(r.x-l*y)*u,r.y=(r.y-l*_)*u;var v=t.x+(c+y)*u,b=t.y+(p+_)*u,C=h.x-e.x,T=h.y-e.y,M=v-h.x,S=b-h.y;C*M+T*S>0&&(v=h.x,b=h.y,r.x=(v-h.x)/i,r.y=(b-h.y)/i),a.set(v,b)},t.SmoothDampVector3=function(t,n,o,i,r,a){var l=new e.Vector3(0,0,0);return e.Utilities.SmoothDampVector3ToRef(t,n,o,i,r,a,l),l},t.SmoothDampVector3ToRef=function(e,t,n,o,i,r,a){var l=0,s=0,u=0;n=Math.max(1e-4,n);var c=2/n,p=c*i,h=1/(1+p+.48*p*p+.235*p*p*p),d=e.x-t.x,m=e.y-t.y,g=e.z-t.z,f=t.clone(),y=o*n,_=y*y,v=d*d+m*m+g*g;if(v>_){var b=Math.sqrt(v);d=d/b*y,m=m/b*y,g=g/b*y}t.x=e.x-d,t.y=e.y-m,t.z=e.z-g;var C=(r.x+c*d)*i,T=(r.y+c*m)*i,M=(r.z+c*g)*i;r.x=(r.x-c*C)*h,r.y=(r.y-c*T)*h,r.z=(r.z-c*M)*h,l=t.x+(d+C)*h,s=t.y+(m+T)*h,u=t.z+(g+M)*h;var S=f.x-e.x,I=f.y-e.y,P=f.z-e.z,A=l-f.x,x=s-f.y,O=u-f.z;S*A+I*x+P*O>0&&(l=f.x,s=f.y,u=f.z,r.x=(l-f.x)/i,r.y=(s-f.y)/i,r.z=(u-f.z)/i),a.set(l,s,u)},t.ToMatrix=function(t,n,o){return e.Matrix.RotationYawPitchRoll(e.Tools.ToRadians(n),e.Tools.ToRadians(t),e.Tools.ToRadians(o))},t.ToMatrixToRef=function(t,n,o,i){e.Matrix.RotationYawPitchRollToRef(e.Tools.ToRadians(n),e.Tools.ToRadians(t),e.Tools.ToRadians(o),i)},t.FastMatrixLerp=function(t,n,o,i){e.Matrix.LerpToRef(t,n,o,i)},t.FastMatrixSlerp=function(t,n,o,i){e.Matrix.DecomposeLerpToRef(t,n,o,i)},t.ToEuler=function(t){var n=t.toEulerAngles();return n.x=e.Tools.ToDegrees(n.x),n.y=e.Tools.ToDegrees(n.y),n.z=e.Tools.ToDegrees(n.z),n},t.ToEulerToRef=function(t,n){t.toEulerAnglesToRef(n),n.x=e.Tools.ToDegrees(n.x),n.y=e.Tools.ToDegrees(n.y),n.z=e.Tools.ToDegrees(n.z)},t.FromEuler=function(t,n,o){return e.Quaternion.FromEulerAngles(e.Tools.ToRadians(t),e.Tools.ToRadians(n),e.Tools.ToRadians(o))},t.FromEulerToRef=function(t,n,o,i){e.Quaternion.FromEulerAnglesToRef(e.Tools.ToRadians(t),e.Tools.ToRadians(n),e.Tools.ToRadians(o),i)},t.QuaternionDiff=function(t,n){var o=new e.Quaternion(0,0,0,1);return e.Utilities.QuaternionDiffToRef(t,n,o),o},t.QuaternionDiffToRef=function(t,n,o){e.Quaternion.InverseToRef(n,e.Utilities.TempQuaternion),t.multiplyToRef(e.Utilities.TempQuaternion,o)},t.QuaternionSubtractToRef=function(e,t,n){n.set(e._x-t._x,e._y-t._y,e._z-t._z,e._w-t._w)},t.RotateVector=function(t,n){var o=2*(n.y*t.z-n.z*t.y),i=2*(n.z*t.x-n.x*t.z),r=2*(n.x*t.y-n.y*t.x);return new e.Vector3(t.x+n.w*o+(n.y*r-n.z*i),t.y+n.w*i+(n.z*o-n.x*r),t.z+n.w*r+(n.x*i-n.y*o))},t.RotateVectorToRef=function(e,t,n){var o=2*(t.y*e.z-t.z*e.y),i=2*(t.z*e.x-t.x*e.z),r=2*(t.x*e.y-t.y*e.x);n.x=e.x+t.w*o+(t.y*r-t.z*i),n.y=e.y+t.w*i+(t.z*o-t.x*r),n.z=e.z+t.w*r+(t.x*i-t.y*o)},t.LookRotation=function(t){var n=e.Quaternion.Zero();return e.Utilities.LookRotationToRef(t,n),n},t.LookRotationToRef=function(t,n){e.Utilities.TempMatrix.reset(),e.Matrix.LookAtLHToRef(e.Utilities.ZeroVector,t,e.Utilities.UpVector,e.Utilities.TempMatrix),e.Utilities.TempMatrix.invert(),e.Quaternion.FromRotationMatrixToRef(e.Utilities.TempMatrix,n)},t.Vector3Rad2Deg=function(t){var n=e.Vector3.Zero();return e.Utilities.Vector3Rad2DegToRef(t,n),n},t.Vector3Rad2DegToRef=function(t,n){n.x=e.Tools.ToDegrees(t.x),n.y=e.Tools.ToDegrees(t.y),n.z=e.Tools.ToDegrees(t.z)},t.MultiplyQuaternionByVector=function(t,n){var o=new e.Vector3(0,0,0);return e.Utilities.MultiplyQuaternionByVectorToRef(t,n,o),o},t.MultiplyQuaternionByVectorToRef=function(e,t,n){var o=2*e.x,i=2*e.y,r=2*e.z,a=e.x*o,l=e.y*i,s=e.z*r,u=e.x*i,c=e.x*r,p=e.y*r,h=e.w*o,d=e.w*i,m=e.w*r;n.x=(1-(l+s))*t.x+(u-m)*t.y+(c+d)*t.z,n.y=(u+m)*t.x+(1-(a+s))*t.y+(p-h)*t.z,n.z=(c-d)*t.x+(p+h)*t.y+(1-(a+l))*t.z},t.ValidateTransformRotation=function(e){null!=e.rotationQuaternion&&(e.rotation=e.rotationQuaternion.toEulerAngles(),e.rotationQuaternion=null)},t.ValidateTransformQuaternion=function(t){null==t.rotationQuaternion&&null!=t.rotation&&(t.rotationQuaternion=e.Quaternion.FromEulerAngles(t.rotation.x,t.rotation.y,t.rotation.z),t.rotation.set(0,0,0))},t.GetKeyboardInputValue=function(t,n,o){var i=o;return e.UserInputOptions.KeyboardSmoothing===!0&&(i=e.Scalar.MoveTowards(n,o,e.UserInputOptions.KeyboardMoveSensibility*e.SceneManager.GetDeltaSeconds(t)),Math.abs(i)<e.UserInputOptions.KeyboardMoveDeadZone&&(i=0)),i},t.GenerateRandonNumber=function(e,t,n){void 0===n&&(n=2);var o=(Math.random()*(t-e)+e).toFixed(n);return parseFloat(o)},t.ProjectVector=function(t,n){var o=new e.Vector3(0,0,0);return e.Utilities.ProjectVectorToRef(t,n,o),o},t.ProjectVectorToRef=function(t,n,o){var i=e.Vector3.Dot(n,n);if(i<e.System.Epsilon)o.set(0,0,0);else{var r=e.Vector3.Dot(t,n);o.set(n.x*r/i,n.y*r/i,n.z*r/i)}},t.ProjectVectorOnPlane=function(t,n){var o=new e.Vector3(0,0,0);return e.Utilities.ProjectVectorOnPlaneToRef(t,n,o),o},t.ProjectVectorOnPlaneToRef=function(t,n,o){var i=e.Vector3.Dot(n,n);if(i<e.System.Epsilon)o.copyFrom(t);else{var r=e.Vector3.Dot(t,n);o.set(t.x-n.x*r/i,t.y-n.y*r/i,t.z-n.z*r/i)}},t.AreVectorsEqual=function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n},t.GetVerticalSlopeAngle=function(t,n){void 0===n&&(n=0);var o=Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))*e.System.Rad2Deg;return o=null!=o&&Number.isNaN(o)===!1?o:0,n>0&&o>=n&&(o=0),o},t.DownloadEnvironment=function(t,n,o){void 0===n&&(n=null),void 0===o&&(o=null),e.EnvironmentTextureTools.CreateEnvTextureAsync(t).then(function(o){var i=t.name||"Environment",r=new Blob([o],{type:"octet/stream"});e.Tools.Download(r,i+".env"),null!=n&&n()})["catch"](function(e){console.error(e),null!=o&&o()})},t.HasOwnProperty=function(e,t){return null!=e&&null!=t&&""!==t&&t in e},t.FindMeshCollider=function(t,n){var o=null;if(n instanceof e.TransformNode){var i=null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.renderer&&null!=n.metadata.unity.renderer.hasmeshcollider&&n.metadata.unity.renderer.hasmeshcollider===!0;if(i===!0){var r=n.id+"-collider";o=t.getMeshById(r)}}return o},t.ColliderInstances=function(){return null==e.SceneManager.GlobalOptions.colliderInstances||e.SceneManager.GlobalOptions.colliderInstances},t.ReparentColliders=function(){return null==e.SceneManager.GlobalOptions.reparentColliders||e.SceneManager.GlobalOptions.reparentColliders},t.UseTriangleNormals=function(){return null!=e.SceneManager.GlobalOptions.useTriangleNormals&&e.SceneManager.GlobalOptions.useTriangleNormals},t.UseConvexTriangles=function(){return null!=e.SceneManager.GlobalOptions.useConvexTriangles&&e.SceneManager.GlobalOptions.useConvexTriangles},t.DefaultRenderGroup=function(){return null!=e.SceneManager.GlobalOptions.defaultRenderGroup?e.SceneManager.GlobalOptions.defaultRenderGroup:0},t.ShowDebugColliders=function(){return null!=e.SceneManager.GlobalOptions.showDebugColliders&&e.SceneManager.GlobalOptions.showDebugColliders},t.ColliderVisibility=function(){return null!=e.SceneManager.GlobalOptions.colliderVisibility?e.SceneManager.GlobalOptions.colliderVisibility:0},t.ColliderRenderGroup=function(){return null!=e.SceneManager.GlobalOptions.colliderRenderGroup?e.SceneManager.GlobalOptions.colliderRenderGroup:0},t.CollisionWireframe=function(){return null!=e.SceneManager.GlobalOptions.collisionWireframe&&e.SceneManager.GlobalOptions.collisionWireframe},t.GetColliderMaterial=function(t){var n="Collider-Material",o=t.getMaterialByName(n);if(null==o){var i=new e.PBRMaterial(n,t);i.albedoColor=new e.Color3(0,.75,0),i.wireframe=e.Utilities.CollisionWireframe(),i.unlit=!0,o=i}return o},t.CalculateCombinedFriction=function(e,t){var n=10,o=e*t;return o<-n&&(o=-n),o>n&&(o=n),o},t.CalculateCombinedRestitution=function(e,t){return e*t},t.GetDirectTargetAngle=function(t,n){return e.Utilities.TempVector3.set(0,0,0),e.Utilities.InverseTransformPointToRef(t,n,e.Utilities.TempVector3),Math.atan2(e.Utilities.TempVector3.x,e.Utilities.TempVector3.z)},t.GetSmoothTargetAngle=function(t,n){return e.Utilities.TempVector3.set(0,0,0),e.Utilities.InverseTransformPointToRef(t,n,e.Utilities.TempVector3),e.Utilities.TempVector3.x/e.Utilities.TempVector3.length()},t.CalculatCatmullRom=function(t,n,o,i,r){var a=new e.Vector3(0,0,0);return e.Utilities.CalculatCatmullRomToRef(t,n,o,i,r,a),a},t.CalculatCatmullRomToRef=function(e,t,n,o,i,r){},t.StartsWith=function(e,t){return 0===e.lastIndexOf(t,0)},t.EndsWith=function(e,t){return e.indexOf(t,e.length-t.length)!==-1},t.ReplaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},t.IsNullOrEmpty=function(e){return null==e||""===e},t.SafeStringPush=function(e,t){e.indexOf(t)===-1&&e.push(t)},t.ParseColor3=function(t,n,o){void 0===n&&(n=null),void 0===o&&(o=!1);var i=null;return i=null!=t&&null!=t.r&&null!=t.g&&null!=t.b?o===!0?new e.Color3(t.r,t.g,t.b).toLinearSpace():new e.Color3(t.r,t.g,t.b):n},t.ParseColor4=function(t,n,o){void 0===n&&(n=null),void 0===o&&(o=!1);var i=null;if(null!=t&&null!=t.r&&null!=t.g&&null!=t.b){var r=null!=t.a?t.a:1;i=o===!0?new e.Color4(t.r,t.g,t.b,r).toLinearSpace():new e.Color4(t.r,t.g,t.b,r)}else i=n;return i},t.ParseVector2=function(t,n){void 0===n&&(n=null);var o=null;return o=null!=t&&null!=t.x&&null!=t.y?new e.Vector2(t.x,t.y):n},t.ParseVector3=function(t,n){void 0===n&&(n=null);var o=null;return o=null!=t&&null!=t.x&&null!=t.y&&null!=t.z?new e.Vector3(t.x,t.y,t.z):n},t.ParseVector4=function(t,n){void 0===n&&(n=null);var o=null;return o=null!=t&&null!=t.x&&null!=t.y&&null!=t.z&&null!=t.w?new e.Vector4(t.x,t.y,t.z,t.w):n},t.ParseSound=function(t,n,o,i,r){var a=null;if(null!=t&&null!=t.filename&&""!==t.filename){var l=e.SceneManager.GetRootUrl(n),s=t.filename;a=new e.Sound(o,l+s,n,i,r)}return a},t.ParseTexture=function(t,n,o,i,r,a,l,s,u,c){var p=null;if(null!=t&&null!=t.filename&&""!==t.filename){var h=e.SceneManager.GetRootUrl(n),d=t.filename;p=new e.Texture(h+d,n,o,i,r,a,l,s,u,c)}return p},t.ParseCubemap=function(t,n){var o=null;if(null!=t&&null!=t.info){var i=e.SceneManager.GetRootUrl(n),r=i+t.info.rooturl;o=e.CubeTexture.Parse(t.info,n,r),null!=o&&(o.gammaSpace=!1)}return o},t.ParseTextAsset=function(e,t){void 0===t&&(t=null);var n=null;return n=null!=e&&null!=e.base64&&""!==e.base64?window.atob(e.base64):t},t.ParseJsonAsset=function(t,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var i=e.Utilities.ParseTextAsset(t,n);return null!=i&&""!==i?JSON.parse(i,o):null},t.ParseTransformByID=function(t,n,o){void 0===o&&(o=null);var i=null;return i=null!=t&&null!=t.id?e.SceneManager.GetTransformNodeByID(n,t.id):o},t.ParseTransformByName=function(t,n,o){void 0===o&&(o=null);var i=null;return i=null!=t&&null!=t.id?e.SceneManager.GetTransformNode(n,t.id):o},t.ParseChildTransform=function(t,n,o){void 0===o&&(o=null);var i=null;return i=null!=n&&null!=n.name?e.SceneManager.FindChildTransformNode(t,n.name,e.SearchType.IndexOf,!1):o},t.SetAbsolutePosition=function(e,t){e.setAbsolutePosition(t)},t.GetAbsolutePosition=function(t,n,o){return void 0===n&&(n=null),void 0===o&&(o=!0),e.Utilities.TransformPoint(t,n||e.Utilities.ZeroVector,o)},t.GetAbsolutePositionToRef=function(t,n,o,i){void 0===o&&(o=null),void 0===i&&(i=!0),e.Utilities.TransformPointToRef(t,o||e.Utilities.ZeroVector,n,i)},t.SetAbsoluteRotation=function(t,n){null==t.rotationQuaternion&&(t.rotationQuaternion=t.rotation.toQuaternion()),null!=t.parent&&t.parent instanceof e.TransformNode?(e.Utilities.TempQuaternion2.set(0,0,0,1),e.Utilities.GetAbsoluteRotationToRef(t.parent,e.Utilities.TempQuaternion2),e.Quaternion.InverseToRef(e.Utilities.TempQuaternion2,e.Utilities.TempQuaternion2),e.Utilities.TempQuaternion2.multiplyInPlace(n),t.rotationQuaternion.copyFrom(e.Utilities.TempQuaternion2)):t.rotationQuaternion.copyFrom(n)},t.GetAbsoluteRotation=function(t){var n=new e.Quaternion(0,0,0,1);return e.Utilities.GetAbsoluteRotationToRef(t,n),n},t.GetAbsoluteRotationToRef=function(t,n){if(null!=t.parent&&t.parent instanceof e.TransformNode)return e.Utilities.GetAbsoluteRotationToRef(t.parent,n),null==t.rotationQuaternion&&(t.rotationQuaternion=t.rotation.toQuaternion()),void n.multiplyInPlace(t.rotationQuaternion);var o=t.scaling;if(1==o.x&&1==o.y&&1==o.z)n.copyFrom(t.absoluteRotationQuaternion);else{var i=1/o.x,r=1/o.y,a=1/o.z,l=t.getWorldMatrix()._m;e.Utilities.TempMatrix2.reset(),e.Matrix.FromValuesToRef(l[0]*i,l[1]*i,l[2]*i,0,l[4]*r,l[5]*r,l[6]*r,0,l[8]*a,l[9]*a,l[10]*a,0,0,0,0,1,e.Utilities.TempMatrix2),e.Utilities.TempQuaternion3.set(0,0,0,1),e.Utilities.TempMatrix2.decompose(void 0,e.Utilities.TempQuaternion3,void 0),n.copyFrom(e.Utilities.TempQuaternion3)}},t.TransformPoint=function(t,n,o){return void 0===o&&(o=!0),o===!0&&t.computeWorldMatrix(),e.Vector3.TransformCoordinates(n,t.getWorldMatrix())},t.InverseTransformPoint=function(t,n,o){return void 0===o&&(o=!0),o===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformCoordinates(n,e.Utilities.TempMatrix)},t.TransformPointToRef=function(t,n,o,i){void 0===i&&(i=!0),i===!0&&t.computeWorldMatrix(),e.Vector3.TransformCoordinatesToRef(n,t.getWorldMatrix(),o)},t.InverseTransformPointToRef=function(t,n,o,i){void 0===i&&(i=!0),i===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformCoordinatesToRef(n,e.Utilities.TempMatrix,o)},t.TransformDirection=function(t,n,o){return void 0===o&&(o=!0),o===!0&&t.computeWorldMatrix(),e.Vector3.TransformNormal(n,t.getWorldMatrix())},t.InverseTransformDirection=function(t,n,o){return void 0===o&&(o=!0),o===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformNormal(n,e.Utilities.TempMatrix)},t.TransformDirectionToRef=function(t,n,o,i){void 0===i&&(i=!0),i===!0&&t.computeWorldMatrix(),e.Vector3.TransformNormalToRef(n,t.getWorldMatrix(),o)},t.InverseTransformDirectionToRef=function(t,n,o,i){void 0===i&&(i=!0),i===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformNormalToRef(n,e.Utilities.TempMatrix,o)},t.RecomputeCenterPivotPoint=function(t){var n=t.getBoundingInfo().boundingSphere.center;t.setPivotMatrix(e.Matrix.Translation(-n.x,-n.y,-n.z))},t.GetDirectionVector=function(e,t){return e.getDirection(t)},t.GetDirectionVectorToRef=function(e,t,n){e.getDirectionToRef(t,n)},t.GetForwardVector=function(t){return t.getDirection(e.Vector3.Forward())},t.GetForwardVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Forward(),n)},t.GetRightVector=function(t){return t.getDirection(e.Vector3.Right())},t.GetRightVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Right(),n)},t.GetUpVector=function(t){return t.getDirection(e.Vector3.Up())},t.GetUpVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Up(),n)},t.BlendFloatValue=function(t,n,o){var i=e.Scalar.Clamp(o,0,1);return i>0?e.Scalar.Lerp(t,n,i):t},t.BlendVector2Value=function(t,n,o){var i=e.Scalar.Clamp(o,0,1);if(i>0){var r=e.Vector2.Lerp(t,n,i);t.copyFrom(r)}},t.BlendVector3Value=function(t,n,o){var i=e.Scalar.Clamp(o,0,1);i>0&&e.Vector3.LerpToRef(t,n,i,t)},t.BlendQuaternionValue=function(t,n,o){var i=e.Scalar.Clamp(o,0,1);i>0&&e.Quaternion.SlerpToRef(t,n,i,t)},t.SetAnimationTargetProperty=function(e,t){null!=e&&(e.targetProperty=t,e.targetPropertyPath=e.targetProperty.split("."))},t.SampleAnimationFloat=function(t,n,o,i){void 0===o&&(o=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=0;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_FLOAT&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:e.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationVector2=function(t,n,o,i){void 0===o&&(o=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_VECTOR2&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:e.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationVector3=function(t,n,o,i){
void 0===o&&(o=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_VECTOR3&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:e.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationQuaternion=function(t,n,o,i){void 0===o&&(o=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_QUATERNION&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:e.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationMatrix=function(t,n,o,i){void 0===o&&(o=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_MATRIX&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:e.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.CreateTweenAnimation=function(t,n,o,i,r,a){void 0===r&&(r=30),void 0===a&&(a=e.Animation.ANIMATIONLOOPMODE_RELATIVE);var l=[];l.push({frame:0,value:o}),l.push({frame:r,value:i});var s=new e.Animation(t,n,r,e.Animation.ANIMATIONTYPE_FLOAT,a);return s.setKeys(l),s},t.GetLastKeyFrameIndex=function(e){var t=0;if(null!=e){var n=e.getKeys();if(null!=n&&n.length>0){var o=n[n.length-1];null!=o&&(t=o.frame)}}return t},t.InterpolateAnimation=function(t,n,o,i){void 0===i&&(i=!1);var r=i===!0?n*e.SceneManager.AnimationTargetFps:n;return t._interpolate(r,o)},t.UpdateLoopBlendPositionSettings=function(e,t,n){var o=e;null!=o.metadata&&null!=o.metadata.unity&&null!=o.metadata.unity.settings&&(o.metadata.unity.settings.loopblendpositiony=t,o.metadata.unity.settings.loopblendpositionxz=n)},t.InitializeShaderMaterial=function(t,n,o){void 0===n&&(n=!0),void 0===o&&(o=!1);var i=t,r=e.Utilities.HasOwnProperty(i,"getShaderName")?i.getShaderName():"glsl",a=!!e.Utilities.HasOwnProperty(i,"getAlphaBlending")&&i.getAlphaBlending(),l=!!e.Utilities.HasOwnProperty(i,"getAlphaTesting")&&i.getAlphaTesting(),s=e.Utilities.HasOwnProperty(i,"getDefaultDefines")?i.getDefaultDefines():null,u=e.Utilities.HasOwnProperty(i,"getDefaultAttributes")?i.getDefaultAttributes():null,c=e.Utilities.HasOwnProperty(i,"getDefaultUniforms")?i.getDefaultUniforms():null;(null==s||s.length<=0)&&(s=["#define GAMETIME","#define DELTATIME","#define DIFFUSECOLOR","#define DIFFUSETEXTURE"]),(null==u||u.length<=0)&&(u=["position","normal","uv","uv2","color"]),(null==c||c.length<=0)&&(c=["world","worldView","worldViewProjection","view","projection","viewProjection","gameTime","deltaTime","diffuseColor","diffuseTexture","diffuseTextureInfos","diffuseTextureMatrix"]);var p={vertex:r,fragment:r},h={needAlphaBlending:a,needAlphaTesting:l,attributes:u,uniforms:c,defines:s,useClipPlane:o,samplers:[],uniformBuffers:[],externalTextures:[],samplerObjects:[],storageBuffers:[]};i._shaderPath=p,i._options=h,n===!0&&(i.fn_afterBind=i.bind,i.bind=function(e,n,o){if(void 0===o&&(o=null),null!=i.updateGlobalTime&&i.updateGlobalTime(),i.after&&i.after(),i.fn_afterBind)try{i.fn_afterBind(e,n,o)}catch(r){}var a=null!==o&&void 0!==o?o:i.getEffect(),l=t.getScene();if(l.texturesEnabled&&null!=a)for(var s in i._textures){var u=i._textures[s];null!=u&&(a.setFloat2(s+"Infos",u.coordinatesIndex,u.level),a.setMatrix(s+"Matrix",u.getTextureMatrix()))}}),i.awake&&i.awake()},t.WorldToScreenPoint=function(t,n,o){void 0===o&&(o=null);var i=null,r=null!=o?o.viewport:null!=t.activeCamera?t.activeCamera.viewport:null;return null!=r&&(i=e.Vector3.Project(n,e.Matrix.Identity(),t.getTransformMatrix(),r.toGlobal(t.getEngine().getRenderWidth(),t.getEngine().getRenderHeight()))),i},t.ScreenToWorldPoint=function(t,n){return e.Vector3.Unproject(n,t.getEngine().getRenderWidth(),t.getEngine().getRenderHeight(),e.Matrix.Identity(),t.getViewMatrix(),t.getProjectionMatrix())},t.LoadTextFile=function(t,n,o,i){return e.Tools.LoadFile(t,n,o,null,!1,i)},t.LoadTextFileAsync=function(t){return e.Tools.LoadFileAsync(t,!1)},t.GetHttpRequest=function(e,t,n,o,i,r,a){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=!1),void 0===a&&(a=null);var l=new XMLHttpRequest;return l.open("GET",e,!0),r===!0&&(l.responseType="arraybuffer"),null!=a&&l.overrideMimeType(a),null!=t&&t.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&l.setRequestHeader(e.name,e.value)}),l.onreadystatechange=function(){l.readyState===XMLHttpRequest.DONE&&null!=n&&n(l)},l.onprogress=function(e){null!=i&&i(e)},l.onerror=function(){null!=o&&o("Failed to get data from server.")},l.onabort=function(){null!=o&&o("Aborted get data from server.")},l.send(null),l},t.GetHttpRequestAsync=function(t,n,o,i,r){return void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=!1),void 0===r&&(r=null),new Promise(function(a,l){e.Utilities.GetHttpRequest(t,n,function(e){a(e)},function(e){l(e)},o,i,r)})},t.PostHttpRequest=function(e,t,n,o,i,r,a,l,s){void 0===n&&(n=null),void 0===o&&(o="application/x-www-form-urlencoded"),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=!1),void 0===s&&(s=null);var u=new XMLHttpRequest;return u.open("POST",e,!0),l===!0&&(u.responseType="arraybuffer"),null!=s&&u.overrideMimeType(s),null!=n&&n.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&u.setRequestHeader(e.name,e.value)}),u.setRequestHeader("Content-Type",o),u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&null!=i&&i(u)},u.onprogress=function(e){null!=a&&a(e)},u.onerror=function(){null!=r&&r("Failed to post data to server.")},u.onabort=function(){null!=r&&r("Aborted post data to server.")},u.send(t),u},t.PostHttpRequestAsync=function(t,n,o,i,r,a,l){return void 0===o&&(o=null),void 0===i&&(i="application/x-www-form-urlencoded"),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===l&&(l=null),new Promise(function(s,u){e.Utilities.PostHttpRequest(t,n,o,i,function(e){s(e)},function(e){u(e)},r,a,l)})},t.RemapValueToRange=function(e,t,n,o,i){return o+(e-t)*(i-o)/(n-t)},t.CloneSkeletonPrefab=function(t,n,o,i,r){void 0===r&&(r=null);var a=new e.Skeleton(o,i||o,t);a.needInitialSkinMatrix=n.needInitialSkinMatrix;for(var l=0;l<n.bones.length;l++){var s=n.bones[l],u=null,c=s.getParent();if(c){var p=n.bones.indexOf(c);u=a.bones[p]}var h=new e.Bone(s.name,a,u,s.getBaseMatrix().clone(),s.getRestPose().clone());h._index=s._index,h.metadata=s.metadata,s._linkedTransformNode&&h.linkTransformNode(s._linkedTransformNode),e.DeepCopier.DeepCopy(s.animations,h.animations)}var d=a,m=n;if(m._ranges){d._ranges={};for(var g in m._ranges){var f=m._ranges[g];f&&(d._ranges[g]=f.clone())}}return m._isDirty=!0,a},t.GetSceneTransforms=function(e){var t=null;return null!=e.transformNodes&&e.transformNodes.length>0&&e.transformNodes.forEach(function(e){null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.prefab&&e.metadata.unity.prefab===!1&&(null==t&&(t=[]),t.push(e))}),null!=e.meshes&&e.meshes.length>0&&e.meshes.forEach(function(e){null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.prefab&&e.metadata.unity.prefab===!1&&(null==t&&(t=[]),t.push(e))}),t},t.PostParseSceneComponents=function(t,n,o,i){if(null!=n&&n.length>0){var r=new e.MetadataParser(t);n.forEach(function(e){r.parseSceneComponents(e)}),r.postProcessSceneComponents(o,i)}},t.GetAssetContainerMesh=function(t,n){var o=null,i=n.toLowerCase();if(null==o&&null!=t.meshes&&t.meshes.length>0)for(var r=0;r<t.meshes.length;r++){var a=t.meshes[r];if(a instanceof e.Mesh&&a.name.toLowerCase()===i){o=a;break}}return o},t.GetAssetContainerNode=function(e,t){var n=null,o=t.toLowerCase();if(null==n&&null!=e.transformNodes&&e.transformNodes.length>0)for(var i=0;i<e.transformNodes.length;i++){var r=e.transformNodes[i];if(r.name.toLowerCase()===o){n=r;break}}return n},t.CloneAssetContainerItem=function(t,n,o,i,r,a){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===a&&(a=!0);var l=null,s={},u={},c={},p=null,h=null,d=[],m=[],g=n.toLowerCase(),f=null,y=function(t,n){null==f&&(f=n),s[t.uniqueId]=n.uniqueId,u[n.uniqueId]=n,o&&(n.name=o(t.name)),null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.entity&&(n.metadata=e.Utilities.CloneEntityMetadata(t.metadata));var i=null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.animator?n.metadata.unity.animator:null;if(null!=i&&""!==i&&(null==p&&(p=[]),p.indexOf(i)<0&&p.push(i),n.metadata.unity.animator=e.Utilities.CreateGuid(),c[i]=n.metadata.unity.animator),t instanceof e.AbstractMesh&&null!=t.skeleton&&(null==h&&(h=[]),h.indexOf(t.skeleton)<0&&h.push(t.skeleton)),n instanceof e.Mesh){var r=n;if(r.morphTargetManager){var a=t.morphTargetManager;r.morphTargetManager=a.clone();for(var l=0;l<a.numTargets;l++){var d=a.getTarget(l),m=r.morphTargetManager.getTarget(l);s[d.uniqueId]=m.uniqueId,u[m.uniqueId]=m}}}};if(null==l&&null!=t.transformNodes&&t.transformNodes.length>0)for(var _=0;_<t.transformNodes.length;_++){var v=t.transformNodes[_];if(v.name.toLowerCase()===g){var b=e.Utilities.InstantiateHierarchy(v,i,function(e,t){y(e,t)});if(b){l=b;break}}}if(null==l&&null!=t.meshes&&t.meshes.length>0)for(var C=function(n){var a=t.meshes[n];if(a.name.toLowerCase()===g){var c=e.Utilities.InstantiateHierarchy(a,i,function(e,n){y(e,n);var i=n;if(a.isWorldMatrixFrozen===!0&&i.freezeWorldMatrix&&i.freezeWorldMatrix(),n.material&&i.material)if(r===!0){var l=e.material;if(m.indexOf(l)===-1){var c=l.clone(o?o(l.name):"Clone of "+l.name);if(l.isFrozen===!0&&c.freeze&&c.freeze(),m.push(l),s[l.uniqueId]=c.uniqueId,u[c.uniqueId]=c,"MultiMaterial"===l.getClassName())for(var p=l,h=0,d=p.subMaterials;h<d.length;h++){var g=d[h];g&&(c=g.clone(o?o(g.name):"Clone of "+g.name),g.isFrozen===!0&&c.freeze&&c.freeze(),m.push(g),s[g.uniqueId]=c.uniqueId,u[c.uniqueId]=c)}}i.material=u[s[l.uniqueId]]}else"MultiMaterial"===i.material.getClassName()?t.scene.multiMaterials.indexOf(i.material)===-1&&t.scene.addMultiMaterial(i.material):t.scene.materials.indexOf(i.material)===-1&&t.scene.addMaterial(i.material)});if(c)return l=c,"break"}},_=0;_<t.meshes.length;_++){var T=C(_);if("break"===T)break}if(null!=h&&h.length>0&&h.forEach(function(n){for(var i=o?o(n.name):"Clone of "+n.name,r=e.Utilities.CloneSkeletonPrefab(t.scene,n,i,i,f),a=0,l=t.meshes;a<l.length;a++){var c=l[a];if(c.skeleton===n&&!c.isAnInstance){var p=u[s[c.uniqueId]];if(p.skeleton=r,d.indexOf(r)!==-1)continue;d.push(r);for(var h=0,m=r.bones;h<m.length;h++){var g=m[h];g._linkedTransformNode&&(g._linkedTransformNode=u[s[g._linkedTransformNode.uniqueId]])}}}}),a===!0){var M=null;t.animationGroups.forEach(function(e){var t=e,n=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.source&&""!==t.metadata.unity.source?t.metadata.unity.source:null;if(null!=n&&""!==n&&null!=p&&p.indexOf(n)>=0){var o=e.clone(e.name,function(e){var t=u[s[e.uniqueId]];return t||e}),i=c[n]||n;null!=t.metadata&&(o.metadata={},o.metadata.unity={},o.metadata.unity.id=t.metadata.unity.id,o.metadata.unity.clip=t.metadata.unity.clip,o.metadata.unity.source=i,o.metadata.unity.legacy=t.metadata.unity.legacy,o.metadata.unity.length=t.metadata.unity.length,o.metadata.unity.looping=t.metadata.unity.looping,o.metadata.unity.settings=t.metadata.unity.settings,o.metadata.unity.behavior=t.metadata.unity.behavior,o.metadata.unity.wrapmode=t.metadata.unity.wrapmode,o.metadata.unity.framerate=t.metadata.unity.framerate,o.metadata.unity.humanmotion=t.metadata.unity.humanmotion,o.metadata.unity.averagespeed=t.metadata.unity.averagespeed,o.metadata.unity.averageduration=t.metadata.unity.averageduration,o.metadata.unity.averageangularspeed=t.metadata.unity.averageangularspeed),null==M&&(M=[]),M.push(o)}}),null!=l&&null!=M&&e.Utilities.AssignAnimationGroupsToInstance(l,M)}return l},t.AssignAnimationGroupsToInstance=function(t,n){e.Utilities.AssignAnimationGroupsToNode(t,n);var o=t.getChildren(null,!1);null!=o&&o.length>0&&o.forEach(function(t){e.Utilities.AssignAnimationGroupsToNode(t,n)})},t.AssignAnimationGroupsToNode=function(e,t){if(null!=e&&null!=e.metadata&&e.metadata.unity){var n=e.metadata.unity;if(null!=n.components&&n.components.length>0)for(var o=0;o<n.components.length;o++){var i=n.components[o];if("BABYLON.AnimationState"===i.klass){e.metadata.unity.sourceAnimationGroups=t;break}}}},t.InstantiateHierarchy=function(t,n,o){if(void 0===n&&(n=null),t instanceof e.Mesh){var i=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.instance&&t.metadata.unity.instance===!0;return e.Utilities.InstantiateMeshHierarchy(t,n,i,o)}return e.Utilities.InstantiateNodeHierarchy(t,n,o)},t.InstantiateNodeHierarchy=function(t,n,o){void 0===n&&(n=null);var i=t.clone("Clone of "+(t.name||t.id),n,!0);i&&o&&o(t,i);for(var r=0,a=t.getChildTransformNodes(!0);r<a.length;r++){var l=a[r];e.Utilities.InstantiateHierarchy(l,i,o)}return i},t.InstantiateMeshHierarchy=function(t,n,o,i){void 0===n&&(n=null);var r=t.getTotalVertices()>0&&o===!0?t.createInstance("Instance of "+(t.name||t.id)):t.clone("Clone of "+(t.name||t.id),n||t.parent,!0);r&&(r.parent=n,r.position=t.position.clone(),r.scaling=t.scaling.clone(),t.rotationQuaternion?r.rotationQuaternion=t.rotationQuaternion.clone():r.rotation=t.rotation.clone(),i&&i(t,r));for(var a=0,l=t.getChildTransformNodes(!0);a<l.length;a++){var s=l[a];e.Utilities.InstantiateHierarchy(s,r,i)}return r},t.RetargetAnimationGroupSkeleton=function(e,t,n){void 0===n&&(n=null),null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,o){if(null!=e.target&&null!=e.target.name){var i=t.bones.filter(function(t){return t.name.toLowerCase()===e.target.name.toLowerCase()})[0];if(null!=i){var r=i.getTransformNode();null!=r&&(e.target=i.getTransformNode())}else"Armature"===e.target.name&&null!=n?e.target=n:console.warn("Failed to locate matching animation cloning target: "+e.target.name)}})},t.RetargetAnimationGroupBlendShapes=function(e,t){null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,t){null!=e.target&&null!=e.target.name})},t.LinkSkeletonMeshes=function(t,n){if(null!=t&&null!=t.bones&&t.bones.length>0&&null!=n&&null!=n.bones&&n.bones.length>0)for(var o=n.bones.length,i=0;i<o;i++){var r=n.bones[i];if(null!=r){var a=e.Utilities.FindBoneByName(t,r.name);null!=a?r._linkedTransformNode=a._linkedTransformNode:console.warn("Failed to locate bone on mater rig: "+r.name)}}},t.FindBoneByName=function(e,t){var n=null;if(null!=e&&null!=e.bones)for(var o=0;o<e.bones.length;o++){var i=e.bones[o],r=i.name.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right"),a=t.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right");if(r===a){n=i;break}}return n},t.SwitchHandednessVector3=function(t){return new e.Vector3(t.x,t.y,(-t.z))},t.SwitchHandednessVector4=function(t){return new e.Vector4(t.x,t.y,(-t.z),(-t.w))},t.SwitchHandednessQuaternion=function(t){return new e.Quaternion(t.x,t.y,(-t.z),(-t.w))},t.ComputeBlendingSpeed=function(e,t,n){void 0===n&&(n=!1);var o=1/(e*t);return n===!0&&(o*=.5),o},t.CalculateCameraDistance=function(e,t,n){void 0===n&&(n=1);var o=1;return Math.round(e*n*t*o)},t.InstantiateClass=function(e){for(var t=e.split("."),n=window||this,o=0,i=t.length;o<i;o++)n=n[t[o]];return"function"==typeof n?n:null},t.GetSimpleClassName=function(e){if(e&&e.constructor&&e.constructor.toString){var t=e.constructor.toString().match(/function\s*(\w+)/);if(t&&2==t.length)return t[1]}},t.DisposeEntity=function(t){if(null!=t){if(null!=t.metadata&&t.metadata.unity){var n=t.metadata.unity;null!=n.components&&n.components.length>0&&n.components.forEach(function(t){if(null!=t.instance){try{e.SceneManager.DestroyScriptComponent(t.instance)}catch(n){}t.instance=null}}),delete t.metadata.unity}if(null!=t.metadata&&t.metadata.mixer&&delete t.metadata.mixer,null!=t.metadata&&null!=t.metadata.clone&&delete t.metadata.clone,null!=t.physicsImpostor){var o=t.physicsImpostor;null!=o.onCollideEvent&&(o.onCollideEvent=null),null!=o.tmpCollisionObjects&&delete o.tmpCollisionObjects,null!=t.physicsImpostor.physicsBody&&(null!=t.physicsImpostor.physicsBody.entity&&delete t.physicsImpostor.physicsBody.entity,null!=t.physicsImpostor.physicsBody.triangleMapInfo&&delete t.physicsImpostor.physicsBody.triangleMapInfo),t.physicsImpostor.dispose(),t.physicsImpostor=null}null!=t.skeleton&&(null!=t.skeleton._sockets&&delete t.skeleton._sockets,null!=t.skeleton.bones&&t.skeleton.bones.length>0&&t.skeleton.bones.forEach(function(e){null!=e&&null!=e.metadata&&(e.metadata=null)})),null!=t.cameraRig&&(t.cameraRig.dispose&&t.cameraRig.dispose(),delete t.cameraRig),null!=t.lightRig&&(t.lightRig.dispose&&t.lightRig.dispose(),delete t.lightRig),null!=t.shadowBox&&(t.shadowBox.dispose&&t.shadowBox.dispose(),delete t.shadowBox),null!=t._debugCollider&&(t._debugCollider.dispose&&t._debugCollider.dispose(),delete t._debugCollider),null!=t._meshCollider&&(t._meshCollider=null),null!=t._colliderType&&delete t._colliderType,null!=t._skinnedMesh&&delete t._skinnedMesh}},t.SearchTransformNodes=function(t,n,o){void 0===o&&(o=e.SearchType.ExactMatch);var i=null,r=null!=o?o:e.SearchType.ExactMatch;if(null!=n&&n.length>0)for(var a=0;a<n.length;a++){var l=n[a];if(r===e.SearchType.ExactMatch){if(l.name===t){i=l;break}}else if(r===e.SearchType.StartsWith){if(e.Utilities.StartsWith(l.name,t)){i=l;break}}else if(r===e.SearchType.EndsWith){if(e.Utilities.EndsWith(l.name,t)){i=l;break}}else if(r===e.SearchType.IndexOf){if(l.name.indexOf(t)>=0){i=l;break}}else if(l.name===t){i=l;break}}return i},t.SearchTransformNodeForTags=function(t,n){var o=null;if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var r=n[i];if(r instanceof e.TransformNode&&e.Tags.MatchesQuery(r,t)){o=r;break}}return o},t.SearchAllTransformNodesForTags=function(t,n){var o=null;if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var r=n[i];r instanceof e.TransformNode&&e.Tags.MatchesQuery(r,t)&&(null==o&&(o=[]),o.push(r))}return o},t.SearchTransformNodeForScript=function(t,n){var o=null;if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var r=n[i];if(r instanceof e.TransformNode){var a=e.SceneManager.FindScriptComponent(r,t);if(null!=a){o=r;break}}}return o},t.SearchAllTransformNodesForScript=function(t,n){var o=null;if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var r=n[i];if(r instanceof e.TransformNode){var a=e.SceneManager.FindScriptComponent(r,t);null!=a&&(null==o&&(o=[]),o.push(r))}}return o},t.CreateGuid=function(t){void 0===t&&(t=null);var n=e.Tools.RandomId();return e.Utilities.IsNullOrEmpty(t)||(n+="-"+t),n},t.ValidateTransformGuid=function(e){if(null!=e&&null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.guid&&""!==e.metadata.unity.guid){var t=e.metadata.unity.guid;e.id!==t&&(e.id=t),delete e.metadata.unity.guid}},t.AddShadowCastersToLight=function(t,n,o){void 0===o&&(o=!1);var i=t.getShadowGenerator();if(null!=i){var r=i.getShadowMap();if(null!=r)for(var a=0;a<n.length;a++){var l=n[a];if(l instanceof e.AbstractMesh&&(null!=t.includedOnlyMeshes&&t.includedOnlyMeshes.length>0&&t.includedOnlyMeshes.indexOf(l)<0&&t.includedOnlyMeshes.push(l),null==r.renderList&&(r.renderList=[]),r.renderList.indexOf(l)<0&&r.renderList.push(l)),o===!0){var s=l.getChildMeshes();null!=s&&s.length>0&&s.forEach(function(e){null!=t.includedOnlyMeshes&&t.includedOnlyMeshes.length>0&&t.includedOnlyMeshes.indexOf(e)<0&&t.includedOnlyMeshes.push(e),null==r.renderList&&(r.renderList=[]),r.renderList.indexOf(e)<0&&r.renderList.push(e)})}}}},t.RegisterInstancedMeshBuffers=function(t){var n=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.buffers?t.metadata.unity.buffers:null;null!=n&&(null!=n.floats&&n.floats.length>0&&n.floats.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,1),t.instancedBuffers[e.kind]=e.value)}),null!=n.colors&&n.colors.length>0&&n.colors.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,4),t.instancedBuffers[n.kind]=new e.Color4(n.value.r||0,n.value.g||0,n.value.b||0,n.value.a||1).toLinearSpace())}),null!=n.vector2&&n.vector2.length>0&&n.vector2.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,2),t.instancedBuffers[n.kind]=new e.Vector2(n.value.x||0,n.value.y||0))}),null!=n.vector3&&n.vector3.length>0&&n.vector3.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,3),t.instancedBuffers[n.kind]=new e.Vector3(n.value.x||0,n.value.y||0,n.value.z||0))}),null!=n.vector4&&n.vector4.length>0&&n.vector4.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,4),t.instancedBuffers[n.kind]=new e.Vector4(n.value.x||0,n.value.y||0,n.value.z||0,n.value.w||0))}))},t.CloneValue=function(t,n){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(n):t.clone?t.clone():t:null},t.CloneEntityMetadata=function(t){var n=null;if(null!=t){var o=null;if(null!=t.unity){var i=null!=t.unity.instance&&t.unity.instance,r=null==t.unity.visible||t.unity.visible,a=null!=t.unity.visibility?t.unity.visibility:1,l=null!=t.unity.billboard?t.unity.billboard:0,s=null!=t.unity.tags?t.unity.tags:"Untagged Layer0",u=null!=t.unity.skin&&t.unity.skin,c=null!=t.unity.bone?t.unity.bone:null,p=null!=t.unity.rootbone&&t.unity.rootbone,h=null!=t.unity.rootpos?t.unity.rootpos:null,d=null!=t.unity.rootrot?t.unity.rootrot:null,m=null!=t.unity.group?t.unity.group:"Untagged",g=null!=t.unity.layer?t.unity.layer:0,f=null!=t.unity.layername?t.unity.layername:"Default",y=null!=t.unity.navigation?t.unity.navigation:null,_=null!=t.unity.lightmapped&&t.unity.lightmapped,v=null!=t.unity.lightmapuvs?t.unity.lightmapuvs:null,b=null!=t.unity.animator?t.unity.animator:null,C=null,T=null,M=null,S=null;t.unity.physics&&(C={},e.Utilities.DeepCopyProperties(t.unity.physics,C)),t.unity.renderer&&(T={},e.Utilities.DeepCopyProperties(t.unity.renderer,T)),t.unity.collision&&(M={},e.Utilities.DeepCopyProperties(t.unity.collision,M)),t.unity.properties&&(S={},e.Utilities.DeepCopyProperties(t.unity.properties,S));var I=null;null!=t.unity.wheels&&t.unity.wheels.length>0&&(I=[],t.unity.wheels.forEach(function(t){if(null!=t){var n={};e.Utilities.DeepCopyProperties(t,n),I.push(n)}}));var P=null;null!=t.unity.components&&t.unity.components.length>0&&(P=[],t.unity.components.forEach(function(t){if(null!=t){var n=e.Utilities.FastJsonCopy(t);n.instance=null,P.push(n)}})),o={},o.parsed=!1,o.prefab=!1,o.buffers=null,o.lods=null,o.coverages=null,o.distances=null,o.handlers=null,o.instance=i,o.visible=r,o.visibility=a,o.billboard=l,o.tags=s,o.skin=u,o.bone=c,o.rootbone=p,o.rootpos=h,o.rootrot=d,o.group=m,o.layer=g,o.layername=f,o.navigation=y,o.lightmapped=_,o.lightmapuvs=v,o.animator=b,o.renderer=T,o.physics=C,o.wheels=I,o.collision=M,o.properties=S,o.components=P}null!=o&&(n={unity:o})}return n},t.FastJsonCopy=function(t){if(!t)return t;if(Array.isArray(t)){for(var n=[],o=t.length,i=0;i<o;i++)n.push(e.Utilities.FastJsonCopy(t[i]));return n}if("object"==typeof t){for(var r=Object.keys(t),a={},i=r.length-1;i>-1;i--){var l=r[i];a[l]=e.Utilities.FastJsonCopy(t[l])}return a}return t},t.DeepCopyProperties=function(t,n,o,i){for(var r in t)if(("_"!==r[0]||i&&i.indexOf(r)!==-1)&&(!o||o.indexOf(r)===-1)){var a=t[r],l=typeof a;if("function"!==l)if("object"===l)if(a instanceof Array){if(n[r]=[],a.length>0)if("object"==typeof a[0])for(var s=0;s<a.length;s++){var u=e.Utilities.CloneValue(a[s],n);n[r].indexOf(u)===-1&&n[r].push(u)}else n[r]=a.slice(0)}else n[r]=e.Utilities.CloneValue(a,n);else n[r]=a}},t.ValidateTransformMetadata=function(t){null==t.metadata&&(t.metadata={}),null==t.metadata.unity&&(t.metadata.unity={});var n=t.metadata.unity;e.Utilities.HasOwnProperty(n,"entity")||(t.metadata.unity.entity=!0),e.Utilities.HasOwnProperty(n,"parsed")||(t.metadata.unity.parsed=!1),e.Utilities.HasOwnProperty(n,"prefab")||(t.metadata.unity.prefab=!1),e.Utilities.HasOwnProperty(n,"instance")||(t.metadata.unity.instance=!1),e.Utilities.HasOwnProperty(n,"buffers")||(t.metadata.unity.buffers=null),e.Utilities.HasOwnProperty(n,"visible")||(t.metadata.unity.visible=!0),e.Utilities.HasOwnProperty(n,"visibility")||(t.metadata.unity.visibility=1),e.Utilities.HasOwnProperty(n,"billboard")||(t.metadata.unity.billboard=0),e.Utilities.HasOwnProperty(n,"tags")||(t.metadata.unity.tags="Untagged Layer0"),e.Utilities.HasOwnProperty(n,"skin")||(t.metadata.unity.skin=!1),e.Utilities.HasOwnProperty(n,"bone")||(t.metadata.unity.bone=null),e.Utilities.HasOwnProperty(n,"rootbone")||(t.metadata.unity.rootbone=!1),e.Utilities.HasOwnProperty(n,"rootpos")||(t.metadata.unity.rootpos=null),e.Utilities.HasOwnProperty(n,"rootrot")||(t.metadata.unity.rootrot=null),e.Utilities.HasOwnProperty(n,"group")||(t.metadata.unity.group="Untagged"),e.Utilities.HasOwnProperty(n,"layer")||(t.metadata.unity.layer=0),e.Utilities.HasOwnProperty(n,"layername")||(t.metadata.unity.layername="Default"),e.Utilities.HasOwnProperty(n,"navigation")||(t.metadata.unity.navigation=null),e.Utilities.HasOwnProperty(n,"lightmapped")||(t.metadata.unity.lightmapped=!1),e.Utilities.HasOwnProperty(n,"lightmapuvs")||(t.metadata.unity.lightmapuvs=!1),e.Utilities.HasOwnProperty(n,"animator")||(t.metadata.unity.animator=null),e.Utilities.HasOwnProperty(n,"lods")||(t.metadata.unity.lods=null),e.Utilities.HasOwnProperty(n,"coverages")||(t.metadata.unity.coverages=null),e.Utilities.HasOwnProperty(n,"distances")||(t.metadata.unity.distances=null),e.Utilities.HasOwnProperty(n,"handlers")||(t.metadata.unity.handlers=null),e.Utilities.HasOwnProperty(n,"physics")||(t.metadata.unity.physics=null),e.Utilities.HasOwnProperty(n,"wheels")||(t.metadata.unity.wheels=null),e.Utilities.HasOwnProperty(n,"renderer")||(t.metadata.unity.renderer=null),e.Utilities.HasOwnProperty(n,"collision")||(t.metadata.unity.collision=null),e.Utilities.HasOwnProperty(n,"properties")||(t.metadata.unity.properties=null),e.Utilities.HasOwnProperty(n,"components")||(t.metadata.unity.components=null)},t.UpVector=e.Vector3.Up(),t.AuxVector=e.Vector3.Zero(),t.ZeroVector=e.Vector3.Zero(),t.TempMatrix=e.Matrix.Zero(),t.TempMatrix2=e.Matrix.Zero(),t.TempVector2=e.Vector2.Zero(),t.TempVector3=e.Vector3.Zero(),t.TempQuaternion=e.Quaternion.Zero(),t.TempQuaternion2=e.Quaternion.Zero(),t.TempQuaternion3=e.Quaternion.Zero(),t.LoadingState=-1,t.OnPreloaderProgress=null,t.OnPreloaderComplete=null,t}();e.Utilities=x}(BABYLON||(BABYLON={}));var UTIL=BABYLON.Utilities,__extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),BABYLON;!function(e){var t=function(){function e(){this._defines={},this._defines={}}return e.prototype.getDefines=function(){return this._defines},e.prototype.defineBoolean=function(e){this._defines[e]=!0},e.prototype.defineNumeric=function(e,t){this._defines[e]=t},e.ShaderIndexer=0,e}();e.UniversalShaderDefines=t;var n=function(){function e(){}return e}();e.UniversalAlbedoChunks=n;var o=function(t){function n(n,o,i){void 0===i&&(i=!1);var r=t.call(this,n,o)||this;r.universalMaterial=!0,r.locals=null,r.terrainInfo=null,r._defines=null,r._uniforms=[],r._samplers=[],r._attributes=[],r._textures={},r._vectors4={},r._floats={},r._enableTime=!1,r._timeInitialized=!1,r.dumpEffect=!1,r.locals=new e.UniversalShaderDefines,r._defines=null,r._createdShaderName=null,r.enableShaderChunks=!1,r.materialShaderChunks=new e.UniversalAlbedoChunks,r.customShaderNameResolve=r._buildCustomShader,r.customShaderChunkResolve();var a=r;return a.awake&&a.awake(),r}return __extends(n,t),n.prototype.updateShaderChunks=function(){},n.prototype.getShaderName=function(){return"pbr"},n.prototype.getShaderChunk=function(){return null},n.prototype.getShaderDefines=function(){return this._defines},n.prototype.getCustomAttributes=function(){return null},Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this._timeInitialized===!1?(this._timeInitialized=!0,this.setFloat("gameTime",e.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",e.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},n.prototype.getTexture=function(e){return this._textures[e]},n.prototype.getVector4=function(e){return this._vectors4[e]},n.prototype.getFloat=function(e){return this._floats[e]},n.prototype.setTexture=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkSampler(e),this._textures[e]=t,this},n.prototype.setVector4=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkUniform(e),this._vectors4[e]=t,this},n.prototype.setFloat=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkUniform(e),this._floats[e]=t,this},n.prototype.addAttribute=function(e){this._attributes.indexOf(e)===-1&&this._attributes.push(e)},n.prototype.checkUniform=function(e){this._uniforms.indexOf(e)===-1&&(this._uniforms.push(e),this.locals.defineBoolean(e.toUpperCase()))},n.prototype.checkSampler=function(e){this._samplers.indexOf(e)===-1&&(this._samplers.push(e),this.locals.defineBoolean(e.toUpperCase()),this.checkUniform(e+"Infos"),this.checkUniform(e+"Matrix"))},n.prototype.getAnimatables=function(){var e=t.prototype.getAnimatables.call(this);for(var n in this._textures){var o=this._textures[n];o&&o.animations&&o.animations.length>0&&e.push(o)}return e},n.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);for(var n in this._textures){var o=this._textures[n];o&&e.push(o)}return e},n.prototype.hasTexture=function(e){if(t.prototype.hasTexture.call(this,e))return!0;var n=!1;for(var o in this._textures){var i=this._textures[o];if(i===i){n=!0;break}}return n},n.prototype.dispose=function(e,n){if(n)for(var o in this._textures){var i=this._textures[o];i&&i.dispose(),this._textures[o]=null}this._textures={},t.prototype.dispose.call(this,e,n)},n.prototype.clone=function(t){var n,o=this,i=e.SerializationHelper.Clone(function(){return new e.UniversalAlbedoMaterial(t,o.getScene())},this);i._textures={};for(n in this._textures){var r=this._textures[n];r&&i.setTexture(n,r.clone(),!0)}i._vectors4={};for(n in this._vectors4)i.setVector4(n,this._vectors4[n].clone(),!0);i._floats={};for(n in this._floats)i.setFloat(n,this._floats[n],!0);return i},n.prototype.serialize=function(){var t,n=e.SerializationHelper.Serialize(this);n.customType="BABYLON.UniversalAlbedoMaterial",n.textures={};for(t in this._textures){var o=this._textures[t];o&&(n.textures[t]=o.serialize())}n.vectors4={};for(t in this._vectors4)n.vectors4[t]=this._vectors4[t].asArray();n.floats={};for(t in this._floats)n.floats[t]=this._floats[t];return n},n.Parse=function(t,n,o){var i,r=e.SerializationHelper.Parse(function(){return new e.UniversalAlbedoMaterial(t.name,n)},t,n,o);for(i in t.textures){var a=t.textures[i];a&&r.setTexture(i,e.Texture.Parse(a,n,o),!0)}for(i in t.vectors4)r.setVector4(i,e.Vector4.FromArray(t.vectors4[i]),!0);for(i in t.floats)r.setFloat(i,t.floats[i],!0);return r},n.prototype.customShaderChunkResolve=function(){var t=this.getShaderChunk();if(null!=t&&""!==t){var n=t+"ShaderChunks";if(null!=e.Effect.ShadersStore[n]){var o=e.Effect.ShadersStore[n],i=e.Utilities.HasOwnProperty(o,"VertexBegin")?o.VertexBegin:null;null!=i&&""!==i&&(this.materialShaderChunks.Vertex_Begin=i);var r=e.Utilities.HasOwnProperty(o,"VertexDefinitions")?o.VertexDefinitions:null;null!=r&&""!==r&&(this.materialShaderChunks.Vertex_Definitions=r);var a=e.Utilities.HasOwnProperty(o,"VertexMainBegin")?o.VertexMainBegin:null;
null!=a&&""!==a&&(this.materialShaderChunks.Vertex_MainBegin=a);var l=e.Utilities.HasOwnProperty(o,"VertexUpdatePosition")?o.VertexUpdatePosition:null;null!=l&&""!==l&&(this.materialShaderChunks.Vertex_Before_PositionUpdated=l.replace("result","positionUpdated"));var s=e.Utilities.HasOwnProperty(o,"VertexUpdateNormal")?o.VertexUpdateNormal:null;null!=s&&""!==s&&(this.materialShaderChunks.Vertex_Before_NormalUpdated=s.replace("result","normalUpdated"));var u=e.Utilities.HasOwnProperty(o,"VertexWorldPos")?o.VertexWorldPos:null;null!=u&&""!==u&&(this.materialShaderChunks.Vertex_After_WorldPosComputed=u);var c=e.Utilities.HasOwnProperty(o,"VertexMainEnd")?o.VertexMainEnd:null;null!=c&&""!==c&&(this.materialShaderChunks.Vertex_MainEnd=c);var p=e.Utilities.HasOwnProperty(o,"FragmentBegin")?o.FragmentBegin:null;null!=p&&""!==p&&(this.materialShaderChunks.Fragment_Begin=p);var h=e.Utilities.HasOwnProperty(o,"FragmentDefinitions")?o.FragmentDefinitions:null;null!=h&&""!==h&&(this.materialShaderChunks.Fragment_Definitions=h);var d=e.Utilities.HasOwnProperty(o,"FragmentMainBegin")?o.FragmentMainBegin:null;null!=d&&""!==d&&(this.materialShaderChunks.Fragment_MainBegin=d);var m=e.Utilities.HasOwnProperty(o,"FragmentUpdateAlbedo")?o.FragmentUpdateAlbedo:null;null!=m&&""!==m&&(this.materialShaderChunks.Fragment_Custom_Albedo=m.replace("result","surfaceAlbedo"));var g=e.Utilities.HasOwnProperty(o,"FragmentUpdateAlpha")?o.FragmentUpdateAlpha:null;null!=g&&""!==g&&(this.materialShaderChunks.Fragment_Custom_Alpha=g.replace("result","alpha"));var f=e.Utilities.HasOwnProperty(o,"FragmentMetallicRoughness")?o.FragmentMetallicRoughness:null;null!=f&&""!==f&&(this.materialShaderChunks.Fragment_MetallicRoughness=f);var y=e.Utilities.HasOwnProperty(o,"FragmentMicroSurface")?o.FragmentMicroSurface:null;null!=y&&""!==y&&(this.materialShaderChunks.Fragment_MicroSurface=y);var _=e.Utilities.HasOwnProperty(o,"FragmentBeforeLights")?o.FragmentBeforeLights:null;null!=_&&""!==_&&(this.materialShaderChunks.Fragment_Before_Lights=_);var v=e.Utilities.HasOwnProperty(o,"FragmentBeforeFog")?o.FragmentBeforeFog:null;null!=v&&""!==v&&(this.materialShaderChunks.Fragment_Before_Fog=v);var b=e.Utilities.HasOwnProperty(o,"FragmentBeforeFragColor")?o.FragmentBeforeFragColor:null;null!=b&&""!==b&&(this.materialShaderChunks.Fragment_Before_FragColor=b.replace("result","color"))}else e.Tools.Warn("Failed To Locate Shader Chunk Base: "+n)}},n.prototype._buildCustomShader=function(t,n,o,i,r,a,l){var s=this;null==l||null!=l.processFinalCode&&void 0!=l.processFinalCode||(l.processFinalCode=function(t,n){if("vertex"===t)return n;var o=new e.ShaderCodeInliner(n);return o.inlineToken="#define pbr_inline",o.processCode(),o.code}),this._defines=r;var u=this.locals.getDefines();if(null!=u&&null!=this._defines){var c=Object.keys(u);if(null!=c&&c.length>0){for(var p=this._defines,h=0,d=c;h<d.length;h++){var m=d[h];p[m]=u[m]}this._defines.rebuild()}}var g=0;if(null!=this._uniforms&&this._uniforms.length>0)for(g=0;g<this._uniforms.length;g++){var f=this._uniforms[g];n.indexOf(f)===-1&&n.push(f)}if(g=0,null!=this._samplers&&this._samplers.length>0)for(g=0;g<this._samplers.length;g++){var y=this._samplers[g];i.indexOf(y)===-1&&i.push(y)}if(g=0,null!=this._attributes&&this._attributes.length>0)for(g=0;g<this._attributes.length;g++){var _=this._attributes[g];a.indexOf(_)===-1&&a.push(_)}g=0;var v=this.getCustomAttributes();if(null!=v&&v.length>0)for(g=0;g<v.length;g++){var b=v[g];a.indexOf(b)===-1&&a.push(b)}if(null!=this._createdShaderName&&""!==this._createdShaderName)return this._createdShaderName;var C=this.getShaderName();null!=C&&""!==C||(C=t),null!=C&&""!==C||(C="pbr");var T=this._afterBind.bind(this);return this._afterBind=function(e,t){if(t){s._attachAfterBind(e,t);try{T(e,t)}catch(t){}}},this._createdShaderName=this.enableShaderChunks===!0?this._createShaderChunks(C):C,this._createdShaderName},n.prototype._createShaderChunks=function(t){var n=this.getShaderChunk();null!=n&&""!==n||(n=t),e.UniversalShaderDefines.ShaderIndexer++;var o=(n+"Custom"+e.UniversalShaderDefines.ShaderIndexer).trim(),i=e.Effect.ShadersStore[t+"VertexShader"],r=e.Effect.ShadersStore[t+"PixelShader"];r=r.replace(/#include<pbrBlockAlbedoOpacity>/g,e.Effect.IncludesShadersStore.pbrBlockAlbedoOpacity),r=r.replace(/#include<pbrBlockReflectivity>/g,e.Effect.IncludesShadersStore.pbrBlockReflectivity),r=r.replace(/#include<pbrBlockFinalColorComposition>/g,e.Effect.IncludesShadersStore.pbrBlockFinalColorComposition),this.updateShaderChunks();var a=o+"VertexShader";e.Effect.ShadersStore[a]=i.replace("#define CUSTOM_VERTEX_BEGIN",this.materialShaderChunks.Vertex_Begin?this.materialShaderChunks.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions:"").replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.materialShaderChunks.Vertex_MainBegin?this.materialShaderChunks.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.materialShaderChunks.Vertex_Before_PositionUpdated?this.materialShaderChunks.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.materialShaderChunks.Vertex_Before_NormalUpdated?this.materialShaderChunks.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd:""),this.materialShaderChunks.Vertex_After_WorldPosComputed&&(e.Effect.ShadersStore[a]=e.Effect.ShadersStore[a].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS",this.materialShaderChunks.Vertex_After_WorldPosComputed));var l=o+"PixelShader";return e.Effect.ShadersStore[l]=r.replace("#define CUSTOM_FRAGMENT_BEGIN",this.materialShaderChunks.Fragment_Begin?this.materialShaderChunks.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.materialShaderChunks.Fragment_MainBegin?this.materialShaderChunks.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.materialShaderChunks.Fragment_Custom_Albedo?this.materialShaderChunks.Fragment_Custom_Albedo:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.materialShaderChunks.Fragment_Custom_Alpha?this.materialShaderChunks.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.materialShaderChunks.Fragment_MetallicRoughness?this.materialShaderChunks.Fragment_MetallicRoughness:"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.materialShaderChunks.Fragment_MicroSurface?this.materialShaderChunks.Fragment_MicroSurface:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.materialShaderChunks.Fragment_Before_Lights?this.materialShaderChunks.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog?this.materialShaderChunks.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.materialShaderChunks.Fragment_Before_FragColor?this.materialShaderChunks.Fragment_Before_FragColor:""),this.materialShaderChunks.Fragment_Before_Fog&&(e.Effect.ShadersStore[l]=e.Effect.ShadersStore[l].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog)),o},n.prototype._attachAfterBind=function(e,t){this.updateGlobalTime();var n=this;n.after&&n.after();var o,i=this.getScene();if(i.texturesEnabled)for(o in this._textures){var r=this._textures[o];null!=r&&r.isReady&&r.isReady()&&(null==r.isChecked&&(r.isChecked=!0,("detailsSampler"===o||"normalsSampler"===o||o.indexOf("(Atlas)")>=0)&&r.updateSamplingMode(8)),t.setTexture(o,r),t.setFloat2(o+"Infos",r.coordinatesIndex,r.level),t.setMatrix(o+"Matrix",r.getTextureMatrix()))}for(o in this._vectors4)t.setVector4(o,this._vectors4[o]);for(o in this._floats)t.setFloat(o,this._floats[o])},n}(e.PBRMaterial);e.UniversalAlbedoMaterial=o,e.RegisterClass("BABYLON.UniversalAlbedoMaterial",o);var i=function(t){function n(e,n,o){var i=t.call(this,e,n,null,o)||this;return i._enableTime=!1,i}return __extends(n,t),Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this.setFloat("gameTime",e.SceneManager.GetGameTime()),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene())))},n}(e.ShaderMaterial);e.UniversalShaderMaterial=i,e.RegisterClass("BABYLON.UniversalShaderMaterial",i);var r=function(t){function n(e,n,o){var i=t.call(this,e,n,o)||this;i._textures={},i._vectors4={},i._floats={},i._enableTime=!1,i._timeInitialized=!1;var r=i;return r.awake&&r.awake(),i.onBindObservable.add(function(){i.updateGlobalTime(),r.after&&r.after()}),i}return __extends(n,t),n.prototype.compile=function(){},Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this._timeInitialized===!1?(this._timeInitialized=!0,this.setFloat("gameTime",e.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",e.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},n.prototype.getTexture=function(e){return this._textures[e]},n.prototype.getVector4=function(e){return this._vectors4[e]},n.prototype.getFloat=function(e){return this._floats[e]},n.prototype.setTexture=function(e,t,n){return void 0===n&&(n=!1),this._textures[e]=t,this},n.prototype.setVector4=function(e,t,n){return void 0===n&&(n=!1),this._vectors4[e]=t,this},n.prototype.setFloat=function(e,t,n){return void 0===n&&(n=!1),this._floats[e]=t,this},n.prototype.dispose=function(e,n){if(n)for(var o in this._textures){var i=this._textures[o];i&&i.dispose(),this._textures[o]=null}this._textures={},t.prototype.dispose.call(this,e,n)},n.prototype.clone=function(t){var n,o=this,i=e.SerializationHelper.Clone(function(){return new e.UniversalNodeMaterial(t,o.getScene())},this);i._textures={};for(n in this._textures){var r=this._textures[n];r&&i.setTexture(n,r.clone(),!0)}i._vectors4={};for(n in this._vectors4)i.setVector4(n,this._vectors4[n].clone(),!0);i._floats={};for(n in this._floats)i.setFloat(n,this._floats[n],!0);return i},n.prototype.serialize=function(){var t,n=e.SerializationHelper.Serialize(this);n.customType="BABYLON.UniversalNodeMaterial",n.textures={};for(t in this._textures){var o=this._textures[t];o&&(n.textures[t]=o.serialize())}n.vectors4={};for(t in this._vectors4)n.vectors4[t]=this._vectors4[t].asArray();n.floats={};for(t in this._floats)n.floats[t]=this._floats[t];return n},n.Parse=function(t,n,o){var i,r=e.SerializationHelper.Parse(function(){return new e.UniversalNodeMaterial(t.name,n)},t,n,o);for(i in t.textures){var a=t.textures[i];a&&r.setTexture(i,e.Texture.Parse(a,n,o),!0)}for(i in t.vectors4)r.setVector4(i,e.Vector4.FromArray(t.vectors4[i]),!0);for(i in t.floats)r.setFloat(i,t.floats[i],!0);return r},n}(e.NodeMaterial);e.UniversalNodeMaterial=r,e.RegisterClass("BABYLON.UniversalNodeMaterial",r);var a=function(t){function n(e,n){var o=t.call(this,e,n)||this;o.enableShaderChunks=!0;var i=o;return i.awake&&i.awake(),o.onBindObservable.add(function(){i.after&&i.after()}),o}return __extends(n,t),n.prototype.getShaderName=function(){return"pbr"},n.prototype.getShaderChunk=function(){return null},n.prototype.updateShaderChunks=function(){var t="surfaceAlbedo",n="splatmapSampler",o="detailsSampler",i="normalsSampler",r=e.SceneManager.TerrainColorCorrection;null!=this.materialShaderChunks.Vertex_Definitions&&""!==this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions()+this.materialShaderChunks.Vertex_Definitions:this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions(),null!=this.materialShaderChunks.Vertex_MainEnd&&""!==this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd()+this.materialShaderChunks.Vertex_MainEnd:this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd(),null!=this.materialShaderChunks.Fragment_Definitions&&""!==this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(n,o,i)+this.materialShaderChunks.Fragment_Definitions:this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(n,o,i),null!=this.materialShaderChunks.Fragment_Custom_Albedo&&""!==this.materialShaderChunks.Fragment_Custom_Albedo?this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,t,n,o,i,r)+this.materialShaderChunks.Fragment_Custom_Albedo:this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,t,n,o,i,r)},n.prototype.formatTerrainVertexDefintions=function(){return"\r\n#define TERRAIN_VERTEX_DEFINITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\n\r\n"},n.prototype.formatTerrainVertexMainEnd=function(){return"\r\n#define TERRAIN_VERTEX_MAIN_END\r\n\r\n#ifdef UV1\r\nvSplatmapUV = uv;\r\n#endif\r\n\r\n"},n.prototype.formatTerrainFragmentDefintions=function(e,t,n){return"\r\n#define TERRAIN_FRAGMENT_DEFNITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\nuniform sampler2D "+e+";\r\nuniform sampler2D "+t+";\r\nuniform sampler2D "+n+";\r\n\r\nfloat calculateMipmapLevel(const in vec2 uvs, const in vec2 size)\r\n{\r\n    vec2 dx = dFdx(uvs * size.x);\r\n    vec2 dy = dFdy(uvs * size.y);\r\n    float d = max(dot(dx, dx), dot(dy, dy));\r\n    return 0.4 * log2(d);\r\n}\r\n\r\nvec4 sampleTextureAtlas2D(const in sampler2D atlas, const in float gamma, const in vec2 tile, const in vec4 rect, in vec2 uvs, in float lod)\r\n{\r\n    if (lod < 0.0) lod = clamp(calculateMipmapLevel(uvs, vec2(tile.x, tile.x)), 0.0, tile.y);   // Tile Info (tile.xy)\r\n    float size = pow(2.0, tile.y - lod);                                                        // Tile Bits (tile.y)\r\n    float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n    float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n    uvs = fract(uvs);                                                                           // Perfrom Tiling (fract)\r\n    uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n    uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    vec4 color = texture2DLodEXT(atlas, uvs, lod);\r\n    if (gamma != 1.0) {\r\n        color.r = pow(color.r, gamma);\r\n        color.g = pow(color.g, gamma);\r\n        color.b = pow(color.b, gamma);\r\n    }\r\n    return color;\r\n}\r\n\r\nvec4 sampleSplatmapAtlas2D(const in sampler2D atlas, const in vec2 tile, const in vec4 rect, in vec2 uvs)\r\n{\r\n    float size = pow(2.0, tile.y);                                                              // Tile Bits (tile.y)\r\n\t   float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n\t   float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n\t   uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n\t   uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    return texture2D(atlas, uvs);\r\n}\r\n\r\nvec3 blendSplatmapAtlasColors(const in vec4 splatmap, in vec4 color1, in vec4 color2, in vec4 color3, in vec4 color4, in vec3 mixbuffer)\r\n{\r\n    vec3 buffer1 = mix(mixbuffer, color1.rgb, splatmap.r);\r\n    vec3 buffer2 = mix(buffer1, color2.rgb, splatmap.g);\r\n    vec3 buffer3 = mix(buffer2, color3.rgb, splatmap.b);\r\n    return mix(buffer3, color4.rgb, splatmap.a);\r\n}\r\n\r\nvec3 perturbNormalSamplerColor(mat3 cotangentFrame, vec3 samplerColor, float scale)\r\n{\r\n    vec3 map = samplerColor.xyz;\r\n    map = map * 2.00787402 - 1.00787402;\r\n    #ifdef NORMALXYSCALE\r\n        map = normalize(map * vec3(scale, scale, 1.0));\r\n    #endif\r\n    return normalize(cotangentFrame * map);\r\n}\r\n\r\n\r\n"},n.prototype.formatTerrainFragmentUpdateColor=function(e,t,n,o,i,r){void 0===r&&(r=1);var a="";if(null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0){a="\r\n#define TERRAIN_FRAGMENT_UPDATE_COLOR\r\n\r\nvec3 normalsColor = vec3(0.5, 0.5, 1.0);\r\nvec3 normalsBuffer = normalW.rgb;\r\nvec3 splatmapBuffer = "+t+".rgb;\r\nfloat autoMipMapLevel = -1.0;\r\nfloat normalCorrection = 1.0;\r\nfloat detailCorrection = "+r.toFixed(4)+";\r\n\r\n#if defined(ALBEDO) && defined("+n.toUpperCase()+") && defined("+o.toUpperCase()+")\r\n\r\n// Reset Normal Values\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    uvOffset = vec2(0.0, 0.0);\r\n    #ifdef NORMAL\r\n        normalW = normalize(vNormalW);\r\n    #else\r\n        normalW = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n    #endif\r\n    #ifdef CLEARCOAT\r\n        clearCoatNormalW = normalW;\r\n    #endif\r\n    #if defined(BUMP) || defined(PARALLAX)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV);\r\n        #endif\r\n    #elif defined(ANISOTROPIC)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV, vec2(1.0, 1.0));\r\n        #endif\r\n    #endif\r\n    #ifdef PARALLAX\r\n        invTBN = transposeMat3(TBN);\r\n    #endif\r\n    normalW = perturbNormalSamplerColor(TBN, normalsColor, 1.0);\r\n#endif\r\n\r\n// Global Atlas Values\r\nfloat splatTileSize = "+e.splatmapAtlas[2].toFixed(4)+";\r\nfloat splatTileBits = "+e.splatmapAtlas[3].toFixed(4)+";\r\nfloat detailTileSize = "+e.textureAtlas[2].toFixed(4)+";\r\nfloat detailTileBits = "+e.textureAtlas[3].toFixed(4)+";\r\n\r\n// Sample splatmap textures\r\n";for(var l=0,s=0;s<e.splatmapCount;s++){l=4*s;var u=e["splatmapRect"+s];if(a+="vec4 splatmapRect"+s+" = vec4("+u[0].toFixed(4)+", "+u[1].toFixed(4)+", "+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n",a+="vec4 splatmapAlbedo"+s+" = sampleSplatmapAtlas2D("+n+", vec2(splatTileSize, splatTileBits), splatmapRect"+s+", (vSplatmapUV + uvOffset));\r\n",a+="vec4 textureAlbedo"+(l+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="vec4 textureAlbedo"+(l+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="vec4 textureAlbedo"+(l+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="vec4 textureAlbedo"+(l+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(l+0)]){var c=e["textureRect"+(l+0)],p=e["textureInfo"+(l+0)];a+="vec4 textureRect"+(l+0)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+0)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+0)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+0)+" = ((vSplatmapUV + textureOffset"+(l+0)+") * textureScale"+(l+0)+");\r\n",a+="textureAlbedo"+(l+0)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+0)+", textureTileUV"+(l+0)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(l+1)]){var c=e["textureRect"+(l+1)],p=e["textureInfo"+(l+1)];a+="vec4 textureRect"+(l+1)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+1)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+1)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+1)+" = ((vSplatmapUV + textureOffset"+(l+1)+") * textureScale"+(l+1)+");\r\n",a+="textureAlbedo"+(l+1)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+1)+", textureTileUV"+(l+1)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(l+2)]){var c=e["textureRect"+(l+2)],p=e["textureInfo"+(l+2)];a+="vec4 textureRect"+(l+2)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+2)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+2)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+2)+" = ((vSplatmapUV + textureOffset"+(l+2)+") * textureScale"+(l+2)+");\r\n",a+="textureAlbedo"+(l+2)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+2)+", textureTileUV"+(l+2)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(l+3)]){var c=e["textureRect"+(l+3)],p=e["textureInfo"+(l+3)];a+="vec4 textureRect"+(l+3)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+3)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+3)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+3)+" = ((vSplatmapUV + textureOffset"+(l+3)+") * textureScale"+(l+3)+");\r\n",a+="textureAlbedo"+(l+3)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+3)+", textureTileUV"+(l+3)+", autoMipMapLevel);\r\n"}if(a+="splatmapBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", textureAlbedo"+(l+0)+", textureAlbedo"+(l+1)+", textureAlbedo"+(l+2)+", textureAlbedo"+(l+3)+", splatmapBuffer);\r\n",a+="#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n",a+="    #if defined("+i.toUpperCase()+")\r\n",a+="        vec4 normalColor"+(l+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="        vec4 normalColor"+(l+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="        vec4 normalColor"+(l+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="        vec4 normalColor"+(l+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(l+0)]){var h=e["normalsScale"+(l+0)];a+="        float normalScale"+(l+0)+" = "+h.toFixed(4)+";\r\n",a+="        normalColor"+(l+0)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+0)+", textureTileUV"+(l+0)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+0)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+0)+".rgb, normalScale"+(l+0)+");\r\n"}if(e["textureRect"+(l+1)]){var h=e["normalsScale"+(l+1)];a+="        float normalScale"+(l+1)+" = "+h.toFixed(4)+";\r\n",a+="        normalColor"+(l+1)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+1)+", textureTileUV"+(l+1)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+1)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+1)+".rgb, normalScale"+(l+1)+");\r\n"}if(e["textureRect"+(l+2)]){var h=e["normalsScale"+(l+2)];a+="        float normalScale"+(l+2)+" = "+h.toFixed(4)+";\r\n",a+="        normalColor"+(l+2)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+2)+", textureTileUV"+(l+2)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+2)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+2)+".rgb, normalScale"+(l+2)+");\r\n"}if(e["textureRect"+(l+3)]){var h=e["normalsScale"+(l+3)];a+="        float normalScale"+(l+3)+" = "+h.toFixed(4)+";\r\n",a+="        normalColor"+(l+3)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+3)+", textureTileUV"+(l+3)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+3)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+3)+".rgb, normalScale"+(l+3)+");\r\n"}a+="        normalsBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", normalColor"+(l+0)+", normalColor"+(l+1)+", normalColor"+(l+2)+", normalColor"+(l+3)+", normalsBuffer);\r\n",a+="    #endif\r\n",a+="#endif\r\n",a+="\r\n"}a+="// Update Color Values\r\n"+t+".rgb = splatmapBuffer.rgb;\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    #if defined("+i.toUpperCase()+")\r\n        normalW.rgb = normalsBuffer.rgb;\r\n    #endif\r\n    #if defined(FORCENORMALFORWARD) && defined(NORMAL)\r\n        vec3 faceNormal = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n        #if defined(TWOSIDEDLIGHTING)\r\n            faceNormal = gl_FrontFacing ? faceNormal : -faceNormal;\r\n        #endif\r\n        normalW *= sign(dot(normalW, faceNormal));\r\n    #endif\r\n    #if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\r\n        normalW = gl_FrontFacing ? normalW : -normalW;\r\n    #endif\r\n#endif\r\n\r\n#endif\r\n\r\n"}return a},n}(e.UniversalAlbedoMaterial);e.UniversalTerrainMaterial=a,e.RegisterClass("BABYLON.UniversalTerrainMaterial",a)}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,n,o){if(void 0===o&&(o={}),this._update=null,this._late=null,this._after=null,this._fixed=null,this._ready=null,this._lateUpdate=!1,this._properties=null,this._awoken=!1,this._started=!1,this._scene=null,this._delyed=!1,this._transform=null,this._scriptReady=!1,this._registeredClassname=null,this._lateUpdateObserver=null,this.resetScriptComponent=null,this.onTriggerEnterObservable=new e.Observable,this.onTriggerStayObservable=new e.Observable,this.onTriggerExitObservable=new e.Observable,this.intersectMesh=null,this.triggerVolumeList=null,this.useTriggerVolumePrecision=!1,this.includeTriggerVolumeDescendants=!1,null==t)throw new Error("Null transform object specified.");if(null==n)throw new Error("Null host scene object specified.");this._scene=n,this._transform=t,this._properties=o||{},this._registeredClassname=null;var i=this;i._update=function(){e.ScriptComponent.UpdateInstance(i)},i._late=function(){e.ScriptComponent.LateInstance(i)},i._after=function(){e.ScriptComponent.AfterInstance(i)},i._fixed=function(){e.ScriptComponent.FixedInstance(i)},i._ready=function(){e.ScriptComponent.ReadyInstance(i)},i.resetScriptComponent=function(){e.ScriptComponent.ResetInstance(i)},i.registerComponentInstance&&i.destroyComponentInstance||e.Tools.Warn("Invalid component registration handlers for: "+this._transform.name)}return t.prototype.isReady=function(){return this._scriptReady},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return this._registeredClassname},t.prototype.setProperty=function(e,t){null==this._properties&&(this._properties={}),this._properties[e]=t},t.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=this._properties&&(n=this._properties[e],null==n&&(n=this._properties["auto__"+e])),null==n&&(n=t),null!=n?n:null},t.prototype.getTime=function(){return e.SceneManager.GetTime()},t.prototype.getTimeMs=function(){return e.SceneManager.GetTimeMs()},t.prototype.getGameTime=function(){return e.SceneManager.GetGameTime()},t.prototype.getGameTimeMs=function(){return e.SceneManager.GetGameTimeMs()},t.prototype.getDeltaSeconds=function(){return e.SceneManager.GetDeltaSeconds(this.scene)},t.prototype.getDeltaMilliseconds=function(){return e.SceneManager.GetDeltaMilliseconds(this.scene)},t.prototype.getAnimationRatio=function(){return e.SceneManager.GetAnimationRatio(this.scene)},t.prototype.hasSkinnedMesh=function(){return null!=this.getSkinnedMesh()},t.prototype.getSkinnedMesh=function(){return e.SceneManager.GetSkinnedMesh(this.transform)},t.prototype.getTransformMesh=function(){return this._transform instanceof e.Mesh?this._transform:null},t.prototype.getAbstractMesh=function(){return this._transform instanceof e.AbstractMesh?this._transform:null},t.prototype.getInstancedMesh=function(){return this._transform instanceof e.InstancedMesh?this._transform:null},t.prototype.getPrimitiveMeshes=function(){return e.SceneManager.GetPrimitiveMeshes(this.transform)},t.prototype.getMetadata=function(){return e.SceneManager.FindSceneMetadata(this._transform)},t.prototype.getComponent=function(t){var n=e.SceneManager.FindScriptComponent(this._transform,t);return null!=n?n:null},t.prototype.getComponents=function(t){var n=e.SceneManager.FindAllScriptComponents(this._transform,t);return null!=n?n:null},t.prototype.getLightRig=function(){return e.SceneManager.FindSceneLightRig(this._transform)},t.prototype.getCameraRig=function(){return e.SceneManager.FindSceneCameraRig(this._transform)},t.prototype.getTransformTag=function(){return e.SceneManager.GetTransformTag(this.transform)},t.prototype.hasTransformTags=function(t){return e.SceneManager.HasTransformTags(this._transform,t)},t.prototype.getChildNode=function(t,n,o,i){return void 0===n&&(n=e.SearchType.ExactMatch),void 0===o&&(o=!0),void 0===i&&(i=null),e.SceneManager.FindChildTransformNode(this._transform,t,n,o,i)},t.prototype.getChildWithTags=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindChildTransformWithTags(this._transform,t,n,o)},t.prototype.getChildrenWithTags=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindAllChildTransformsWithTags(this._transform,t,n,o)},t.prototype.getChildWithScript=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindChildTransformWithScript(this._transform,t,n,o)},t.prototype.getChildrenWithScript=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindAllChildTransformsWithScript(this._transform,t,n,o)},t.prototype.registerOnClickAction=function(t){var n=null;return this.transform instanceof e.AbstractMesh&&(n=e.SceneManager.RegisterClickAction(this.scene,this.transform,t)),n},t.prototype.unregisterOnClickAction=function(t){var n=!1;return this.transform instanceof e.AbstractMesh&&(n=e.SceneManager.UnregisterClickAction(this.transform,t)),n},t.prototype.setTriggerIntersectMesh=function(e){this.intersectMesh=e},t.prototype.getTriggerVolumeList=function(){return this.triggerVolumeList},t.prototype.resetTriggerVolumeList=function(){this.triggerVolumeList=null},t.prototype.registerTriggerVolume=function(t){var n=new e.TriggerVolume;n.mesh=t,n.state=0,null==this.triggerVolumeList&&(this.triggerVolumeList=[]),this.triggerVolumeList.push(n)},t.prototype.unregisterTriggerVolume=function(e){if(null!=this.triggerVolumeList&&this.triggerVolumeList.length>0)for(var t=0;t<this.triggerVolumeList.length;t++){var n=this.triggerVolumeList[t];if(n.mesh===e){this.triggerVolumeList.splice(t);break}n=null}},t.prototype.registerComponentInstance=function(t,n,o){if(void 0===o&&(o=!0),o===!0){e.Utilities.ValidateTransformMetadata(this._transform);var i={alias:"script",order:0,klass:n,properties:null,instance:t};null==this._transform.metadata.unity.components&&(this._transform.metadata.unity.components=[]),this._transform.metadata.unity.components.push(i)}t._registeredClassname=n,e.ScriptComponent.RegisterInstance(t),o===!0&&t.scene.onAfterRenderObservable.addOnce(function(){t.delayComponentInstance(t)})},t.prototype.delayComponentInstance=function(t){e.SceneManager.SetTimeout(100,function(){t._delyed=!0})},t.prototype.destroyComponentInstance=function(t){e.ScriptComponent.DestroyInstance(t)},t.prototype.setupFixedComponentInstance=function(e){var t=this.getAbstractMesh();null!=t&&(null!=t.physicsImpostor?t.physicsImpostor.registerAfterPhysicsStep(e._fixed):null!=t.physicsBody)},t.prototype.removeFixedComponentInstance=function(e){var t=this.getAbstractMesh();
null!=t&&(null!=t.physicsImpostor?t.physicsImpostor.unregisterAfterPhysicsStep(e._fixed):null!=t.physicsBody)},t.RegisterInstance=function(e){null!=e&&(null!=e._update&&e.scene.registerBeforeRender(e._update),e.late&&null!=e._late&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&(e._lateUpdateObserver=e.scene.onBeforeRenderTargetsRenderObservable.add(e._late)),e.after&&null!=e._after&&e.scene.registerAfterRender(e._after),e.fixed&&null!=e._fixed&&e.setupFixedComponentInstance(e))},t.UpdateInstance=function(t){null!=t&&null!=t.transform&&t.transform.isEnabled(!1)&&(t._awoken===!1?(t._awoken=!0,e.ScriptComponent.ParseAutoProperties(t),t.awake&&t.awake()):t._started===!1?(t._started=!0,t.start&&t.start()):t._awoken===!0&&t._started===!0&&(t._delyed===!0&&(t._delyed=!1,e.ScriptComponent.ReadyInstance(t)),t.update&&t.update(),t._lateUpdate=!0))},t.LateInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&e._lateUpdate===!0&&(e._lateUpdate=!1,e._started===!0&&e.late&&e.late())},t.AfterInstance=function(e){if(null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&(e._started===!0&&e.after&&e.after(),null!=e.triggerVolumeList&&e.triggerVolumeList.length>0)){var t=e.intersectMesh||e.getAbstractMesh();null!=t&&e.triggerVolumeList.forEach(function(n){if(null!=n.mesh){var o=t.intersectsMesh(n.mesh,e.useTriggerVolumePrecision,e.includeTriggerVolumeDescendants);o===!0?0===n.state?(n.state=1,e.onTriggerEnterObservable.hasObservers()&&e.onTriggerEnterObservable.notifyObservers(n.mesh)):1===n.state&&e.onTriggerStayObservable.hasObservers()&&e.onTriggerStayObservable.notifyObservers(n.mesh):0!==n.state&&(n.state=0,e.onTriggerExitObservable.hasObservers()&&e.onTriggerExitObservable.notifyObservers(n.mesh))}})}},t.FixedInstance=function(e){null!=e&&null!=e.transform&&e._started===!0&&e.fixed&&e.fixed()},t.ReadyInstance=function(e){null!=e&&null!=e.transform&&e._scriptReady===!1&&(e._scriptReady=!0,e.ready&&e.ready())},t.ResetInstance=function(e){null!=e&&null!=e.transform&&e._started===!0&&e.reset&&e.reset()},t.DestroyInstance=function(e){if(null!=e){e.scene.unregisterBeforeRender(e._update),null!=e._lateUpdateObserver&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&e.scene.onBeforeRenderTargetsRenderObservable.remove(e._lateUpdateObserver),e.after&&null!=e._after&&e.scene.unregisterAfterRender(e._after),e.fixed&&null!=e._fixed&&e.removeFixedComponentInstance(e);try{e.destroy&&e.destroy()}catch(t){}e.onTriggerEnterObservable.clear(),e.onTriggerEnterObservable=null,e.onTriggerStayObservable.clear(),e.onTriggerStayObservable=null,e.onTriggerExitObservable.clear(),e.onTriggerExitObservable=null,e._scriptReady=!1,e._transform=null,e._properties=null,e._started=!1,e._delyed=!1,e._update=null,e._late=null,e._after=null,e._ready=null,e._scene=null}},t.ParseAutoProperties=function(t){var n=Object.keys(t._properties);if(null!=n&&n.length>0)for(var o=function(o){var i=n[o];if(e.Utilities.StartsWith(i,"auto__")){var r=i.replace("auto__","");if(e.Utilities.HasOwnProperty(t,r)){var a=t.getProperty(i);if(null!=a){var l=typeof a;if(null!=l&&""!==l)if("object"===l)if(Array.isArray(a)){var s=[],u=a;u.forEach(function(n){if(null!=n){var o=typeof n;"object"===o?s.push(e.ScriptComponent.UnpackObjectProperty(n,t.scene)):s.push(n)}}),t[r]=s}else{var c=t[r],p=e.ScriptComponent.UnpackObjectProperty(a,t.scene);c instanceof e.Color3&&p instanceof e.Color4?t[r]=new e.Color3(p.r,p.g,p.b):t[r]=p}else t[r]=a;else t[r]=a}else t[r]=a}else e.Tools.Warn(t.getClassName()||"Unregistered Class: Auto property '"+r+"' not found for transform '"+t.transform.name+"'")}},i=0;i<n.length;i++)o(i)},t.UnpackObjectProperty=function(t,n){var o=null;if(null!=t)if(void 0!==t.x&&void 0!==t.y)o=void 0!==t.z?void 0!==t.w?new e.Vector4(t.x,t.y,t.z,t.w):new e.Vector3(t.x,t.y,t.z):new e.Vector2(t.x,t.y);else if(void 0!==t.r&&void 0!==t.g&&void 0!==t.b){var i=1;void 0!==t.a&&(i=t.a),o=new e.Color4(t.r,t.g,t.b,i)}else if(void 0!==t.type)switch(t.type){case"UnityEngine.AnimationCurve":var r=t;o=e.Animation.Parse(r.animation);break;case"UnityEngine.Transform":var a=t;o=e.Utilities.ParseTransformByID(a,n);break;case"UnityEngine.Material":var l=t;o=n.getMaterialByName(l.name);break;case"UnityEngine.Texture2D":var s=t;o=e.Utilities.ParseTexture(s,n);break;case"UnityEngine.Cubemap":var u=t;o=e.Utilities.ParseCubemap(u,n);break;case"UnityEngine.AudioClip":var c=t;o=c;break;case"UnityEngine.Video.VideoClip":var p=t;o=p;break;case"UnityEngine.Font":var h=t;o=h;break;case"UnityEngine.TextAsset":var d=t;o=null!=d.base64?d.json===!0?JSON.parse(window.atob(d.base64)):window.atob(d.base64):d;break;case"UnityEditor.DefaultAsset":var m=t;o=null!=m.base64?m.json===!0?JSON.parse(window.atob(m.base64)):window.atob(m.base64):m;break;default:o=t}else o=t;return o},t}();e.ScriptComponent=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._babylonScene=e,this._physicList=[],this._shadowList=[],this._scriptList=[],this._freezeList=[]}return t.prototype.parseSceneComponents=function(t){e.MetadataParser.DoParseSceneComponents(this._babylonScene,t,this._physicList,this._shadowList,this._scriptList,this._freezeList)},t.prototype.postProcessSceneComponents=function(t,n){e.MetadataParser.DoProcessPendingPhysics(this._babylonScene,this._physicList),e.MetadataParser.DoProcessPendingShadows(this._babylonScene,this._shadowList),e.MetadataParser.DoProcessPendingScripts(this._babylonScene,this._scriptList,t,n),e.MetadataParser.DoProcessPendingFreezes(this._freezeList),this._babylonScene=null,this._physicList=null,this._shadowList=null,this._scriptList=null,this._freezeList=null},t.DoParseSceneComponents=function(t,n,o,i,r,a){if(null!=n&&null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.parsed&&n.metadata.unity.parsed===!1){n.onDisposeObservable.addOnce(function(){e.Utilities.DisposeEntity(n)}),n.metadata.unity.parsed=!0,n.metadata.unity.prefab=!1;var l=n.metadata.unity,s=null==n.metadata.unity.visible||n.metadata.unity.visible,u=null!=n.metadata.unity.visibility?n.metadata.unity.visibility:1,c=null!=n.metadata.unity.billboard?n.metadata.unity.billboard:0,p=n instanceof e.AbstractMesh,h=(null!=n.metadata.unity.lightmapped&&n.metadata.unity.lightmapped,l.tags);if(null!=h&&""!==h&&(e.Tags.AddTagsTo(n,h),h.indexOf("NavigationMesh")>=0&&(n.isVisible=!1,n.isPickable=!1,n.useVertexColors=!1)),null!=l.physics&&null!=o&&o.push(n),n.renderingGroupId,null!=l.renderer)if(p===!0)n.isPickable=!0,n.useVertexColors=!1,n.isVisible=s,n.visibility=u,n.billboardMode=c,n.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(n.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.layermask&&(n.layerMask=l.renderer.layermask),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=i&&i.push(n),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(n.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(n.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(n.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(n.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(n.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(n.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(n.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(n.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(n.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=a&&a.push(n);else{var d=e.SceneManager.GetSkinnedMesh(n);if(null!=d)d.isPickable=!0,d.useVertexColors=!1,d.isVisible=s,d.visibility=u,d.billboardMode=c,d.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,d.alwaysSelectAsActiveMesh=!0,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(d.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.layermask&&(d.layerMask=l.renderer.layermask),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=i&&i.push(d),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(d.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(d.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(d.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(d.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(d.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(d.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(d.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(d.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(d.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=a&&a.push(d);else{var m=e.SceneManager.GetPrimitiveMeshes(n);null!=m&&m.length>0&&m.forEach(function(t){var n=e.SceneManager.GetSkinnedMesh(t);null!=n?(n.isPickable=!0,n.useVertexColors=!1,n.isVisible=s,n.visibility=u,n.billboardMode=c,n.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,n.alwaysSelectAsActiveMesh=!0,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(n.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.layermask&&(n.layerMask=l.renderer.layermask),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=i&&i.push(n),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(n.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(n.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(n.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(n.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(n.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(n.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(n.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(n.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(n.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=a&&a.push(n)):(t.isPickable=!0,t.useVertexColors=!1,t.isVisible=s,t.visibility=u,t.billboardMode=c,t.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(t.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.layermask&&(t.layerMask=l.renderer.layermask),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=i&&i.push(t),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(t.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(t.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(t.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(t.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(t.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(t.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(t.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(t.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(t.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=a&&a.push(t))})}}if(null!=l.components){var g=l.components;null!=g&&g.length>0&&g.forEach(function(o){if(null!=o)switch(o.alias){case"camera":e.MetadataParser.SetupCameraComponent(t,n,o);break;case"light":e.MetadataParser.SetupLightComponent(t,n,o);break;case"script":null!=r&&r.push({mesh:n,comp:o})}})}}},t.DoProcessPendingScripts=function(t,n,o,i){null!=n&&n.length>0&&(n.sort(function(e,t){return e.comp.order<t.comp.order?-1:e.comp.order>t.comp.order?1:0}),n.forEach(function(n){if(null!=n.comp.klass&&""!==n.comp.klass&&"BABYLON.ScriptComponent"!==n.comp.klass){var r=e.Utilities.InstantiateClass(n.comp.klass);if(null!=r){var a=new r(n.mesh,t,n.comp.properties);if(null!=a){var l=a instanceof e.ScriptComponent;l===!0?(n.comp.instance=a,null!=i&&i.push(n.comp.instance),n.comp.instance.addPreloaderTasks&&null!=o&&o.push(n.comp.instance),e.SceneManager.RegisterScriptComponent(n.comp.instance,n.comp.klass,!1)):e.Tools.Warn("Non script component instantiated class: "+n.comp.klass)}else e.Tools.Warn("Failed to instantiate script class: "+n.comp.klass)}else e.Tools.Warn("Failed to locate script class: "+n.comp.klass)}}))},t.DoProcessPendingShadows=function(e,t){null!=t&&t.length>0&&null!=e.lights&&e.lights.length>0&&e.lights.forEach(function(e){var n=e.getShadowGenerator();if(null!=n&&null!=e.metadata&&null!=e.metadata.unity&&e.metadata.unity.autorender===!0){var o=n.getShadowMap();null!=o&&t.forEach(function(t){var n=!1;n=!(null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0)||e.includedOnlyMeshes.indexOf(t)>=0,n===!0&&(null==o.renderList&&(o.renderList=[]),o.renderList.indexOf(t)<0&&o.renderList.push(t))})}})},t.DoProcessPendingPhysics=function(t,n){if(null!=n&&n.length>0){var o=t.isPhysicsEnabled(),i=o===!0?t.getPhysicsEngine():null,r=o===!0&&null!=i;r===!0?n.forEach(function(n){e.RigidbodyPhysics?e.RigidbodyPhysics.SetupPhysicsComponent(t,n):e.Tools.Warn("Rigidbody physics system not loaded. Physics impostors will not be created for: "+n.name)}):e.Tools.Warn("Physics engine not loaded. Physics impostors will not be created.")}},t.DoProcessPendingFreezes=function(e){null!=e&&e.length>0&&e.forEach(function(e){e.freezeWorldMatrix()})},t.SetupCameraComponent=function(t,n,o){n.checkCollisions=!1;var i=0,r=n.name+".Rig",a=0,l=null!=o.culling?o.culling:-1,s=null!=o.camerabase?o.camerabase:0,u=(null!=o.clearflags?o.clearflags:0,null!=o.renderlist?o.renderlist:null),c=null!=o.maincamera&&o.maincamera,p=4===s?new e.FreeCamera(r,e.Vector3.Zero(),t):new e.UniversalCamera(r,e.Vector3.Zero(),t);p.checkCollisions=!1,p.rotationQuaternion=e.Quaternion.FromEulerAngles(0,a,0),p.parent=n,c===!0&&(t.activeCamera=p);var h=null!=o.type?o.type:0;switch(h){case 0:p.mode=e.Camera.PERSPECTIVE_CAMERA,null!=o.perspectiveyfov&&(p.fov=o.perspectiveyfov),null!=o.perspectiveznear&&(p.minZ=o.perspectiveznear),null!=o.perspectivezfar&&(p.maxZ=o.perspectivezfar);break;case 1:p.mode=e.Camera.ORTHOGRAPHIC_CAMERA,null!=o.orthoxmag&&(p.orthoLeft=-o.orthoxmag,p.orthoRight=o.orthoxmag),null!=o.orthoymag&&(p.orthoBottom=-o.orthoymag,p.orthoTop=o.orthoymag),null!=o.orthoznear&&(p.minZ=o.orthoznear),null!=o.orthozfar&&(p.maxZ=o.orthozfar)}if(l===-1);else if(0===l);else{var d=u;if(null!=d&&d.length>0){var m=function(){var n=d[i],o=e.SceneManager.GetMeshByID(t,n);if(null!=o){var r=o.name+".Detail",a=o.getChildren(function(e){return e.name===r},!0);null!=a&&a.length>0}};for(i=0;i<d.length;i++)m()}}n.cameraRig=p},t.SetupLightComponent=function(t,n,o){n.checkCollisions=!1;var i,r=n.name+".Rig",a=0,l=1,s=null!=o.culling?o.culling:-1,u=(null!=o.clearflags?o.clearflags:0,null!=o.renderlist?o.renderlist:null),c=null!=o.type?o.type:0,p=e.SceneManager.GetRenderQuality(),h=null!=o.exponentdecayspeed?o.exponentdecayspeed:1,d=!1;switch(c){case 0:var m=e.Vector3.Forward(),g=null!=o.orthoscale?o.orthoscale:.1,f=null!=o.ortholeft?o.ortholeft:Number.MAX_VALUE,y=null!=o.orthoright?o.orthoright:Number.MAX_VALUE,_=null!=o.orthotop?o.orthotop:Number.MAX_VALUE,v=null!=o.orthobottom?o.orthobottom:Number.MAX_VALUE,b=null!=o.calczbounds&&o.calczbounds,C=null!=o.updateextends&&o.updateextends,T=null!=o.shadowfrustumsize?o.shadowfrustumsize:0,M=new e.DirectionalLight(r,m,t);M.shadowFrustumSize=T,M.shadowOrthoScale=g,M.autoCalcShadowZBounds=b,M.autoUpdateExtends=C,M.orthoLeft=f,M.orthoRight=y,M.orthoTop=_,M.orthoBottom=v,i=M,i.falloffType=e.Light.FALLOFF_STANDARD,d=p===e.RenderQuality.High||p===e.RenderQuality.Medium,l=e.SceneManager.DirectionalLightIntensity;break;case 1:var S=i=new e.PointLight(r,e.Vector3.Zero(),t);i=S,i.falloffType=e.Light.FALLOFF_STANDARD,d=p===e.RenderQuality.High||p===e.RenderQuality.Medium,l=e.SceneManager.PointLightIntensity;break;case 2:var m=e.Vector3.Forward(),I=null!=o.spotangle?o.spotangle:Math.PI/4,P=new e.SpotLight(r,e.Vector3.Zero(),m,0,h,t);P.angle=.966*e.Tools.ToRadians(I),P.innerAngle=.8*P.angle,i=P,i.falloffType=e.Light.FALLOFF_GLTF,d=p===e.RenderQuality.High||p===e.RenderQuality.Medium,l=e.SceneManager.SpotLightIntensity}if(null!=i){var A=null!=o.range?o.range:Number.MAX_VALUE,x=null!=o.color?e.Utilities.ParseColor3(o.color,e.Color3.White()):e.Color3.White(),O=null!=o.specular?e.Utilities.ParseColor3(o.specular,e.Color3.White()):e.Color3.White();i.parent=n,i.range=A,i.diffuse=x,i.specular=O,i.intensity=(null!=o.intensity?o.intensity:1)*l,i.lightmapMode=e.Light.LIGHTMAP_DEFAULT,i.intensityMode=e.Light.INTENSITYMODE_AUTOMATIC,i.shadowEnabled=!1;var w=null==o.autorender||o.autorender,R=null!=o.softshadows&&o.softshadows,B=null!=o.numcascades?o.numcascades:0,k=null!=o.cascadelambda?o.cascadelambda:1,L=null!=o.setdepthclamp&&o.setdepthclamp,N=null!=o.blendpertecntage?o.blendpertecntage:1e-8,V=null!=o.boundsrefreshrate?o.boundsrefreshrate:1,U=null!=o.lightcontactratio?o.lightcontactratio:.1,F=null!=o.stabilizecascades&&o.stabilizecascades,E=null!=o.penumbradarkness?o.penumbradarkness:1,D=null!=o.softshadowsfilter?o.softshadowsfilter:99,G=null!=o.freezeshadows&&o.freezeshadows,H=null!=o.calcdepths&&o.calcdepths,z=null!=o.depthscaling?o.depthscaling:50,W=null!=o.blurscaling?o.blurscaling:2,Y=null==o.kernelblur||o.kernelblur,j=null!=o.blurkernelsize?o.blurkernelsize:1,Q=null!=o.blurboxoffset?o.blurboxoffset:1,X=null!=o.shadowmapsize?o.shadowmapsize:1024,K=null!=o.generateshadows&&o.generateshadows,q=null!=o.shadowbiasfactor?o.shadowbiasfactor:.001,Z=null!=o.normalbiasfactor?o.normalbiasfactor:.01,J=null!=o.shadowmapbias?o.shadowmapbias:.05,$=null!=o.normalmapbias?o.normalmapbias:.4,ee=null!=o.shadowstrength?o.shadowstrength:1,te=null!=o.shadowdistance?o.shadowdistance:150,ne=null!=o.shadownearplane?o.shadownearplane:.2,oe=null!=o.shadowfilterquality?o.shadowfilterquality:"Medium",ie=null!=o.transparencyshadow&&o.transparencyshadow,re=null!=o.softtransparency&&o.softtransparency,ae=null==o.forcebackfacesonly||o.forcebackfacesonly,le=null!=o.frustumedgefalloff?o.frustumedgefalloff:0,se=null!=o.usefullfloatfirst&&o.usefullfloatfirst;if(d===!0&&K===!0){var ue=i,ce=e.SceneManager.GetWebGLVersionNumber(t),pe=0===c&&B>=2&&ce>=2,he=pe===!0?new e.CascadedShadowGenerator(X,i,se):new e.ShadowGenerator(X,ue,se);if(he.bias=J*q,he.normalBias=$*Z,he.depthScale=z,he.useKernelBlur=Y,he.blurKernel=j,he.blurScale=W,he.blurBoxOffset=Q,he.frustumEdgeFalloff=le,he.forceBackFacesOnly=ae,he.transparencyShadow=ie,he.enableSoftTransparentShadow=re,he.contactHardeningLightSizeUVRatio=U,R===!0)if(ce<=1)he.usePoissonSampling=!0;else if(pe===!0)he.usePercentageCloserFiltering=!0;else switch(D){case 0:he.usePoissonSampling=!0;break;case 1:he.useExponentialShadowMap=!0;break;case 2:he.useBlurExponentialShadowMap=!0;break;case 3:he.useCloseExponentialShadowMap=!0;break;case 4:he.useBlurCloseExponentialShadowMap=!0;break;case 5:he.useContactHardeningShadow=!0;break;case 99:he.usePercentageCloserFiltering=!0;break;default:he.usePoissonSampling=!0}switch(oe){case"High":he.filteringQuality=e.ShadowGenerator.QUALITY_HIGH;break;case"Medium":he.filteringQuality=e.ShadowGenerator.QUALITY_MEDIUM;break;case"Low":he.filteringQuality=e.ShadowGenerator.QUALITY_LOW}if(pe===!0){var de=he;de.lambda=k,de.depthClamp=L,de.shadowMaxZ=te,de.numCascades=B,de.penumbraDarkness=E,de.autoCalcDepthBounds=H,de.stabilizeCascades=F,de.cascadeBlendPercentage=N,de.autoCalcDepthBoundsRefreshRate=V,de.freezeShadowCastersBoundingInfo=G,de.setDarkness(1-e.Scalar.Clamp(ee)),ue.shadowEnabled=!0,de.splitFrustum()}else{var me=he;me.setDarkness(1-e.Scalar.Clamp(ee)),ue.shadowEnabled=!0,ue.shadowMinZ=ne,ue.shadowMaxZ=te}null==i.metadata&&(i.metadata={}),null==i.metadata.unity&&(i.metadata.unity={}),i.metadata.unity.autorender=w}var ge=n.name+".Holder";if(s===-1)i.includedOnlyMeshes=[];else if(0===s)i.includedOnlyMeshes=[new e.Mesh(ge,t)];else{i.includedOnlyMeshes=[new e.Mesh(ge,t)];var fe=u;if(null!=fe&&fe.length>0){var ye=function(){var n=fe[a],o=e.SceneManager.GetMeshByID(t,n);if(null!=o){var r=o.name+".Detail",l=o.getChildren(function(e){return e.name===r},!0);null!=l&&l.length>0?i.includedOnlyMeshes.push(l[0]):i.includedOnlyMeshes.push(o)}};for(a=0;a<fe.length;a++)ye()}}n.lightRig=i}},t}();e.MetadataParser=t}(BABYLON||(BABYLON={}));var CVTOOLS_NAME="CVTOOLS_unity_metadata",CVTOOLS_MESH="CVTOOLS_babylon_mesh",CVTOOLS_HAND="CVTOOLS_left_handed",CubeTextureLoader=function(){function e(){}return e}(),CVTOOLS_unity_metadata=function(){function e(e){this.name=CVTOOLS_NAME,this.enabled=!1,this._babylonScene=null,this._loaderScene=null,this._assetsManager=null,this._materialMap=null,this._lightmapMap=null,this._reflectionMap=null,this._reflectionCache=null,this._assetContainer=!1,this._activeMeshes=!1,this._parseScene=!1,this._leftHanded=!1,this._disposeRoot=!1,this._sceneParsed=!1,this._preWarmTime=1,this._hideLoader=!1,this._fileName="Unknown",this._rootUrl=null,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND),this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._rootUrl=null,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._readyList=null,this._preloadList=null,this._materialMap=null,this._lightmapMap=null,this._preWarmTime=1,this._hideLoader=!1,this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._animationGroups=null,this._babylonScene=null,this.order=100}return e.prototype.dispose=function(){delete this._loader},e.prototype.onLoading=function(){var e=this;BABYLON.Utilities.LoadingState=0,this._assetContainer=null!=this._loader._assetContainer,this._babylonScene=this._loader.babylonScene,this._loaderScene=null,this._assetsManager=null,this._rootUrl=this._loader._uniqueRootUrl?this._loader._uniqueRootUrl:"/",this._fileName=this._loader._fileName?this._loader._fileName:"Unknown",this._fileName.indexOf("?")>=0&&(this._fileName=this._fileName.split("?")[0]),this._loader.parent.onCompleteObservable.addOnce(function(){e.onComplete()}),this._loader.parent.onValidatedObservable.addOnce(function(){e.onValidate()}),this._parseScene=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND)&&BABYLON.SceneManager.IsSceneParsingEnabled()===!0,this._leftHanded=this._loader.isExtensionUsed(CVTOOLS_HAND),this._disposeRoot=this._sceneParsed=!1,this._animationGroups=[],this._masterList=[],this._detailList=[],this._parserList=[],this._shaderList=[],this._readyList=[],this._preloadList=[],this._materialMap=new Map,this._lightmapMap=new Map,this._preWarmTime=1,this._hideLoader=!1,this._reflectionMap={},this._reflectionCache={},this._babylonScene.getEngine().getCaps().supportSRGBBuffers=BABYLON.SceneManager.SupportSRGBBuffers,this._leftHanded===!0&&null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.rotationQuaternion=BABYLON.Quaternion.Identity(),this._loader.rootBabylonMesh.scaling=BABYLON.Vector3.One()),this._parseScene===!0&&(BABYLON.SceneManager.RenderLoopReady=!1,null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.name="Root."+this._fileName.replace(".gltf","").replace(".glb","")),this.setupLoader())},e.prototype.onReady=function(){this._parseScene===!0&&this._disposeRoot===!0&&null!=this._loader.rootBabylonMesh&&this._loader.rootBabylonMesh.dispose(!0)},e.prototype.onComplete=function(){var e=this;this._parseScene===!0&&(this.startParsing(),BABYLON.SceneManager.RenderLoopReady=!0,this._babylonScene.onAfterRenderObservable.addOnce(function(){BABYLON.Utilities.LoadingState=3,e._processPreloadTimeout()}))},e.prototype.onValidate=function(){this._parseScene===!0},e.prototype.onCleanup=function(){this._rootUrl=null,this._fileName=null,this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._preWarmTime=1,this._readyList=null,this._preloadList=null,this._hideLoader=!1,this._animationGroups=null,null!=this._materialMap&&(this._materialMap.clear(),this._materialMap=null),null!=this._lightmapMap&&(this._lightmapMap.clear(),this._lightmapMap=null),this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._babylonScene=null},e.prototype.setupLoader=function(){var e=this;this._parseScene===!0&&(this._assetsManager=new BABYLON.PreloadAssetsManager(this._babylonScene),this._assetsManager.onProgress=function(e,t,n){if(BABYLON.SceneManager.AutoUpdateProgress===!0){var o=1===t?" ASSET":" ASSETS",i="LOADING "+(t-e)+" OF "+t+o;BABYLON.SceneManager.UpdateLoaderDetails(i,BABYLON.Utilities.LoadingState)}else null!=BABYLON.Utilities.OnPreloaderProgress&&BABYLON.Utilities.OnPreloaderProgress(e,t,n)},this._assetsManager.onFinish=function(t){BABYLON.SceneManager.SetTimeout(1e3,function(){BABYLON.Utilities.LoadingState=4,BABYLON.SceneManager.AutoUpdateProgress===!0&&BABYLON.SceneManager.UpdateLoaderStatus("PLEASE WAIT","PREPARING VIEWPORT",BABYLON.Utilities.LoadingState);var n=e._preWarmTime>0?1e3*(e._preWarmTime+1):1e3;BABYLON.SceneManager.SetTimeout(n,function(){if(null!=BABYLON.Utilities.OnPreloaderComplete&&BABYLON.Utilities.OnPreloaderComplete(t),e._processShaderMaterials(e._babylonScene,e._shaderList),null!=e._readyList&&e._readyList.length>0)for(var n=0;n<e._readyList.length;n++){var o=e._readyList[n];null!=o&&o._ready&&o._ready()}e._babylonScene.onAfterRenderObservable.addOnce(function(){1==e._hideLoader&&BABYLON.SceneManager.HideSceneLoader(),e.onCleanup()})})})})},e.prototype.startParsing=function(){this._parseScene===!0&&(BABYLON.Utilities.LoadingState=2,this._processLevelOfDetail(this._babylonScene,this._detailList),this._processActiveMeshes(this._babylonScene,this._activeMeshes),this._processUnityMeshes(this._masterList),null!=this._loaderScene&&(this.preProcessSceneProperties(this._loaderScene,this._babylonScene),this.postProcessSceneProperties(this._rootUrl,this._loaderScene,this._babylonScene)),this._assetContainer===!1&&null!=this._parserList&&this._parserList.length>0&&BABYLON.Utilities.PostParseSceneComponents(this._babylonScene,this._parserList,this._preloadList,this._readyList))},e.prototype.loadSceneAsync=function(e,t){if(this._parseScene===!0&&(this._loaderScene=t),this._parseScene===!0&&null!=t.extras&&null!=t.extras.metadata){if(null!=t.extras.metadata.rawmaterials){var n=this._loader,o=t.extras.metadata.rawmaterials;this._preloadRawMaterialsAsync(e,n._gltf.materials,o)}BABYLON.Utilities.LoadingState=1;var i=this._loader.loadSceneAsync(e,t);return this.loadSceneExAsync(e,t),i}return BABYLON.Utilities.LoadingState=1,null},e.prototype.loadSceneExAsync=function(e,t){var n=this,o=this._loader,i=new Array;if(o._gltf.nodes)for(var r=0,a=o._gltf.nodes;r<a.length;r++){var l=a[r];if(l._babylonTransformNode&&l._babylonBones)for(var s=0,u=l._babylonBones;s<u.length;s++){var c=u[s];l._babylonTransformNode._linkedBone=c}l._babylonTransformNode&&this._animationGroups&&BABYLON.Utilities.AssignAnimationGroupsToNode(l._babylonTransformNode,this._animationGroups)}if(null!=this._reflectionMap&&null!=this._reflectionCache){var p=0,h=function(e){if(p++,d._reflectionMap.hasOwnProperty(e)){var t=e;if(null!=d._assetsManager){var o=d._assetsManager.addBinaryFileTask("Material.ReflectionTextureTask"+p.toFixed(0),t);o.onSuccess=function(e){if(null!=e.data){var o=new Blob([e.data]),i=n._reflectionMap[t];null!=i&&i.forEach(function(e){if(null!=e&&null!=e.mapkey){var t=n._reflectionCache[e.mapkey];if(null!=t)null!=e.material&&BABYLON.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=t);else{var i=n._babylonScene,r=URL.createObjectURL(o),a=function(){URL.revokeObjectURL(r)},l=new BABYLON.CubeTexture(r,i,null,null,null,a,a,null,e.prefiltered,e.extension);l.name=e.name,null!=e.boundingBoxSize&&(l.boundingBoxSize=e.boundingBoxSize),null!=e.boundingBoxPosition&&(l.boundingBoxPosition=e.boundingBoxPosition),n._reflectionCache[e.mapkey]=l,null!=e.material&&BABYLON.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=l)}}})}else console.error("Failed to load reflection texture task: "+t)},o.onError=function(e,t,n){console.error(t,n)}}}},d=this;for(var m in this._reflectionMap)h(m)}return o.logClose(),Promise.all(i).then(function(){})},e.prototype._processActiveMeshes=function(e,t){t===!0&&e.freeActiveMeshes()},e.prototype._processUnityMeshes=function(e){null!=e&&e.length>0&&e.forEach(function(e){BABYLON.Utilities.RegisterInstancedMeshBuffers(e)})},e.prototype._processPreloadTimeout=function(){if(null!=this._assetsManager){if(null!=this._preloadList&&this._preloadList.length>0)for(var e=0;e<this._preloadList.length;e++){var t=this._preloadList[e];null!=t&&t.addPreloaderTasks&&t.addPreloaderTasks(this._assetsManager)}this._babylonScene._preloaded=!0,this._assetsManager.load()}},e.prototype.loadNodeAsync=function(e,t,n){var o=this;return this._parseScene===!0&&null!=t.extras&&null!=t.extras.metadata?this._loader.loadNodeAsync(e,t,function(e){var i=e,r=t.extras.metadata;null==i.metadata&&(i.metadata={}),i.metadata.unity=r,BABYLON.Utilities.ValidateTransformGuid(i),BABYLON.Utilities.ValidateTransformMetadata(i),BABYLON.Utilities.ValidateTransformQuaternion(i),i.isVisible=null==i.metadata.unity.visible||i.metadata.unity.visible,i.visibility=null!=i.metadata.unity.visibility?i.metadata.unity.visibility:1,i.billboardMode=null!=i.metadata.unity.billboard?i.metadata.unity.billboard:0,o._assetContainer===!0&&(i.metadata.unity.prefab=!0),i.metadata.unity.prefab===!0?i.setEnabled(!1):(o._parserList.push(i),null!=t.extras.metadata.lods&&null!=t.extras.metadata.distances&&null!=o._detailList&&o._detailList.push(i)),o._masterList.push(i),n(i)}):null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){if(this._parseScene===!0){var o=-1;t.index&&(o=t.index,o>=0&&null!=this._materialMap&&(this._materialMap.has(o)||this._materialMap.set(o,n))),n.gltfIndex=o;var i=this._loader,r=new Array;if(n instanceof BABYLON.NodeMaterial)r.push(this._parseNodeMaterialPropertiesAsync("".concat(e,"/nodeMaterial"),t,n));else if(n instanceof BABYLON.ShaderMaterial)r.push(this._parseShaderMaterialPropertiesAsync("".concat(e,"/shaderMaterial"),t,n));else if(n instanceof BABYLON.StandardMaterial)r.push(this._parseDiffuseMaterialPropertiesAsync("".concat(e,"/standardMaterial"),t,n));else{var a=i._extensionsLoadMaterialPropertiesAsync(e,t,n);a?this._parseCommonConstantProperties(r,"".concat(e,"/commonConstant"),t,n):(r.push(i.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&r.push(i._loadMaterialMetallicRoughnessPropertiesAsync("".concat(e,"/pbrMetallicRoughness"),t.pbrMetallicRoughness,n)),i.loadMaterialAlphaProperties(e,t,n),this._parseCommonConstantProperties(r,"".concat(e,"/commonConstant"),t,n))}return Promise.all(r).then(function(){})}return null},e.prototype._getCachedMaterialByIndex=function(e){var t=null;return e>=0&&null!=this._materialMap&&(t=this._materialMap.get(e)||null),t},e.prototype._getCachedLightmapByIndex=function(e){var t=null;return e>=0&&null!=this._lightmapMap&&(t=this._lightmapMap.get(e)||null),t},e.prototype.createMaterial=function(e,t,n){
if(this._parseScene===!0&&t.index){var o=t.index;if(o>=0){var i=this._getCachedMaterialByIndex(o);if(null!=i)return i}}if(this._parseScene===!0){var r=null,a=t.name||"No Name";if(null!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.customMaterial){var l=t.extras.metadata,s=l.customMaterial,u=(l.customShader,BABYLON.Utilities.InstantiateClass(s));if(null!=u){var c=new u(a,this._loader.babylonScene);if(null!=c){var p=c instanceof BABYLON.Material;p===!0?(r=c,r.fillMode=n,r instanceof BABYLON.ShaderMaterial&&BABYLON.Utilities.InitializeShaderMaterial(r)):BABYLON.Tools.Warn("Non material instantiated class: "+s)}else BABYLON.Tools.Warn("Failed to instantiate material class: "+s)}else BABYLON.Tools.Warn("Failed to locate material class: "+s)}return r}return null},e.prototype.loadAnimationAsync=function(e,t){if(this._parseScene===!0){var n=(this._loader,t);this._babylonScene._blockEntityCollection=!!this._assetContainer;var o=new BABYLON.AnimationGroup(t.name||"animation".concat(n.index),this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n._babylonAnimationGroup=o,this._animationGroups.push(o);var i=new Array;BABYLON.GLTF2.ArrayItem.Assign(n.channels),BABYLON.GLTF2.ArrayItem.Assign(n.samplers);for(var r=0,a=t.channels;r<a.length;r++){var l=a[r],s=l;i.push(this._loader._loadAnimationChannelAsync("".concat(e,"/channels/").concat(s.index),e,t,l,function(e,t){e.animations=e.animations||[],e.animations.push(t),o.addTargetedAnimation(t,e)}))}return Promise.all(i).then(function(){if(null!=t.extras&&null!=t.extras.metadata){var e={};e.unity=t.extras.metadata,o.metadata=e,null!=e.label&&""!==e.label&&(o.name=e.label)}return o.normalize(0),o})}return null},e.prototype._loadMeshPrimitiveAsync=function(e,t,n,o,i,r){var a=this;if(this._parseScene===!0){var l=this._loader;l.logOpen("".concat(e));var s,u=0===l._disableInstancedMesh&&l._parent.createInstances&&void 0==n.skin&&!o.primitives[0].targets,c=void 0;if(u&&i._instanceData)l._babylonScene._blockEntityCollection=!!l._assetContainer,s=i._instanceData.babylonSourceMesh.createInstance(t),s._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1,c=i._instanceData.promise;else{var p=new Array;l._babylonScene._blockEntityCollection=!!l._assetContainer;var h=new BABYLON.Mesh(t,l._babylonScene);h._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1,this._leftHanded===!0?h.overrideMaterialSideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:h.overrideMaterialSideOrientation=l._babylonScene.useRightHandedSystem?BABYLON.Material.CounterClockWiseSideOrientation:BABYLON.Material.ClockWiseSideOrientation,l._createMorphTargets(e,n,o,i,h),p.push(l._loadVertexDataAsync(e,i,h).then(function(t){return l._loadMorphTargetsAsync(e,i,h,t).then(function(){l._disposed||(l._babylonScene._blockEntityCollection=!!l._assetContainer,t.applyToMesh(h),a._setupBabylonMesh(h,n,o,i),t._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1)})}));var d=BABYLON.GLTF2.GLTFLoader._GetDrawMode(e,i.mode);if(null!=i.extras&&null!=i.extras.metadata&&null!=i.extras.metadata.multimaterial&&null!=i.extras.metadata.submeshes)this._setupBabylonMaterials(e,p,d,h,o,i);else if(void 0==i.material){var m=l._defaultBabylonMaterialData[d];m||(m=l._createDefaultMaterial("__GLTFLoader._default",d),l._parent.onMaterialLoadedObservable.notifyObservers(m),l._defaultBabylonMaterialData[d]=m),h.material=m}else if(!l.parent.skipMaterials){var g=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),l._gltf.materials,i.material);p.push(l._loadMaterialAsync("/materials/".concat(g.index),g,h,d,function(e){h.material=e}))}c=Promise.all(p),u&&(i._instanceData={babylonSourceMesh:h,promise:c}),s=h}return BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(s,e),l._parent.onMeshLoadedObservable.notifyObservers(s),r(s),l.logClose(),c.then(function(){return s})}return null},e.prototype._setupBabylonMesh=function(e,t,n,o){if(this._parseScene===!0){this._loader;if(null!=o.extras&&null!=o.extras.metadata&&null!=o.extras.metadata.multimaterial&&null!=o.extras.metadata.submeshes){var i=o.extras.metadata.submeshes;e.subMeshes=[];for(var r=0;r<i.length;r++){var a=i[r];BABYLON.SubMesh.AddToMesh(a.materialIndex,a.verticesStart,a.verticesCount,a.indexStart,a.indexCount,e)}}e.computeWorldMatrix(!0)}},e.prototype._setupBabylonMaterials=function(e,t,n,o,i,r){if(this._parseScene===!0){var a=this._loader,l=r.extras.metadata.multimaterial,s=l.materials,u=[],c=l.id||"MM_"+i.name,p=l.name||"MM_"+i.name,h=new BABYLON.MultiMaterial("["+p+"]",a._babylonScene);h.id=c,s.forEach(function(t){if(null!=t){var n=parseInt(t);if(n>=0){var i=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),a._gltf.materials,n);u.push(i)}else console.warn("Invalid Submesh Material Index Encountered For: "+o.name)}else console.warn("Null Submesh Material Encountered For: "+o.name)}),t.push(this._parseMultiMaterialAsync("/materials/".concat(p),u,o,n,function(e){h.subMaterials=e,o.material=h}))}},e.prototype._processLevelOfDetail=function(e,t){null!=t&&t.length>0&&t.forEach(function(e){if(null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.lods&&null!=e.metadata.unity.distances){var t=e.metadata.unity,n=t.lods,o=t.distances;if(o.length>=n.length){var i=null,r=null;if(n.forEach(function(t,n){var o="*"===t?e:SM.FindChildTransformNode(e,t,BABYLON.SearchType.ExactMatch,!1);null!=o&&o instanceof BABYLON.AbstractMesh&&(0===n?i=o:(null==r&&(r=[]),r.push(o)))}),null!=i)if(i instanceof BABYLON.Mesh){var a=o.length>0?o[o.length-1]:0;a>=1/0&&(a=0),null!=r&&r.forEach(function(e,t){i.addLODLevel(o[t],e)}),a>0&&i.addLODLevel(a,null)}else i instanceof BABYLON.InstancedMesh&&null!=r&&r.forEach(function(t,n){try{t.dispose()}catch(o){}BABYLON.Tools.Warn("Destroyed Unused Level Detail: "+t.name+" --> For Transform: "+e.name)})}}})},e.prototype._processShaderMaterials=function(e,t){null!=t&&t.length>0&&t.forEach(function(e){e.freeze()})},e.prototype.preProcessSceneProperties=function(e,t){if(this._assetContainer!==!0&&this._sceneParsed===!1&&null!=e.extras&&null!=e.extras.metadata&&null!=e.extras.metadata.properties&&e.extras.metadata.properties===!0){this._sceneParsed=!0;var n=null!=this._rootUrl?this._rootUrl:"/",o=e.extras.metadata;if(null==t.metadata&&(t.metadata={}),null==t.metadata.unity&&(t.metadata.unity={}),t.metadata.unity=o,this._disposeRoot=null!=o.disposeroot&&o.disposeroot===!0,this._hideLoader=null!=o.hideloader&&o.hideloader===!0,this._preWarmTime=null!=o.prewarmup?o.prewarmup:0,BABYLON.SceneManager.SetRootUrl(t,n),BABYLON.SceneManager.SetSceneFile(t,this._fileName),BABYLON.SceneManager.EnableUserInput=!0,BABYLON.SceneManager.GlobalOptions.ktxtextures=null!=o.ktxtextures&&o.ktxtextures,BABYLON.SceneManager.GlobalOptions.ktxlightmaps=null!=o.ktxlightmaps&&o.ktxlightmaps,BABYLON.SceneManager.GlobalOptions.intensityFactor=null!=o.intensity?o.intensity:1,BABYLON.SceneManager.GlobalOptions.debugModeEnabled=null!=o.debugging&&o.debugging,BABYLON.SceneManager.GlobalOptions.showDebugColliders=null!=o.showdebugcolliders&&o.showdebugcolliders,BABYLON.SceneManager.GlobalOptions.colliderVisibility=null!=o.collidervisibility?o.collidervisibility:0,BABYLON.SceneManager.GlobalOptions.colliderRenderGroup=null!=o.colliderrendergroup?o.colliderrendergroup:0,BABYLON.SceneManager.GlobalOptions.defaultRenderGroup=null!=o.defaultrendergroup?o.defaultrendergroup:0,BABYLON.SceneManager.GlobalOptions.collisionWireframe=null!=o.collisionwireframe&&o.collisionwireframe,BABYLON.SceneManager.GlobalOptions.useTriangleNormals=null!=o.trianglenormals&&o.trianglenormals,BABYLON.SceneManager.GlobalOptions.useConvexTriangles=null==o.convextriangles||o.convextriangles,BABYLON.SceneManager.GlobalOptions.colliderInstances=null==o.colliderinstances||o.colliderinstances,BABYLON.SceneManager.GlobalOptions.reparentColliders=null==o.reparentcolliders||o.reparentcolliders,null!=o.clearcolor&&(t.clearColor=BABYLON.Utilities.ParseColor4(o.clearcolor)),null!=o.autoclear&&o.autoclear===!0&&(t.autoClear=!0,t.autoClearDepthAndStencil=!0),null!=o.rendergroups&&(BABYLON.RenderingManager.MAX_RENDERINGGROUPS=o.rendergroups),null!=o.imageprocessing){var i=o.imageprocessing,r=null!=i.contrast?i.contrast:1,a=null!=i.exposure?i.exposure:1;null!=t.imageProcessingConfiguration&&(t.imageProcessingConfiguration.contrast=r,t.imageProcessingConfiguration.exposure=a)}var l=BABYLON.SceneManager.AmbientLightIntensity;if(null!=o.ambientcoloring&&(t.ambientColor=BABYLON.Utilities.ParseColor3(o.ambientcoloring)),null!=o.ambientlighting&&o.ambientlighting>0){var s=t;null==s._AmbientLight&&(s._AmbientLight=new BABYLON.HemisphericLight("Ambient Lighting",new BABYLON.Vector3(0,1,0),t),s._AmbientLight.falloffType=BABYLON.Light.FALLOFF_STANDARD,s._AmbientLight.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT),null!=s._AmbientLight&&(null!=o.ambientskycolor&&(s._AmbientLight.diffuse=BABYLON.Utilities.ParseColor3(o.ambientskycolor,BABYLON.Color3.Gray())),null!=o.ambientspecularcolor&&(s._AmbientLight.specular=BABYLON.Utilities.ParseColor3(o.ambientspecularcolor,BABYLON.Color3.White())),null!=o.ambientgroundcolor&&(s._AmbientLight.groundColor=BABYLON.Utilities.ParseColor3(o.ambientgroundcolor,BABYLON.Color3.Gray())),null!=o.ambientlightintensity&&(s._AmbientLight.intensity=o.ambientlightintensity),s._AmbientLight.intensity*=l)}if(null!=o.fogmode){var u=o.fogmode;if(u>0){t.fogMode=u,t.fogEnabled=!0;var c=1;1===u?c=.5:2===u&&(c=.75),null!=o.fogdensity&&(t.fogDensity=o.fogdensity*c),null!=o.fogstart&&(t.fogStart=o.fogstart),null!=o.fogend&&(t.fogEnd=o.fogend),null!=o.fogcolor&&(t.fogColor=BABYLON.Utilities.ParseColor3(o.fogcolor))}}var p=new BABYLON.Vector3(0,(-9.81),0),h=null!=o.defaultgravity?BABYLON.Utilities.ParseVector3(o.defaultgravity,p):p;if(t.gravity=h.clone(),t.collisionsEnabled=!0,null!=o.enablephysics){var d=o.enablephysics;if(d===!0){var m=null==o.ccdenabled||o.ccdenabled,g=null!=o.ccdpenetration?o.ccdpenetration:1e-4,f=null!=o.subtimestep?o.subtimestep:0,y=null!=o.maxworldsweep?o.maxworldsweep:0,_=null==o.deltaworldstep||o.deltaworldstep;BABYLON.RigidbodyPhysics?BABYLON.RigidbodyPhysics.ConfigurePhysicsEngine(t,_,f,y,m,g,h):BABYLON.Tools.Warn("Rigidbody physics system not loaded. Physics system not configured")}}if(null!=o.userinput){var v=o.userinput;BABYLON.UserInputOptions.KeyboardSmoothing=v.keyboardSmoothing,BABYLON.UserInputOptions.KeyboardMoveSensibility=v.keyboardSensitivity,BABYLON.UserInputOptions.KeyboardMoveDeadZone=v.keyboardDeadZone,BABYLON.UserInputOptions.GamepadDeadStickValue=v.padDeadStick,BABYLON.UserInputOptions.GamepadLStickXInverted=v.padLStickXInvert,BABYLON.UserInputOptions.GamepadLStickYInverted=v.padLStickYInvert,BABYLON.UserInputOptions.GamepadRStickXInverted=v.padRStickXInvert,BABYLON.UserInputOptions.GamepadRStickYInverted=v.padRStickYInvert,BABYLON.UserInputOptions.GamepadLStickSensibility=v.padLStickLevel,BABYLON.UserInputOptions.GamepadRStickSensibility=v.padRStickLevel,BABYLON.UserInputOptions.SupportedInputDevices=v.supportedDevices,BABYLON.UserInputOptions.PointerAngularSensibility=v.mouseSensitivity,BABYLON.UserInputOptions.PointerWheelDeadZone=v.wheelDeadZone,BABYLON.UserInputOptions.PointerMouseDeadZone=v.mouseDeadZone,BABYLON.UserInputOptions.PointerMouseInverted=v.mouseMoveInvert,BABYLON.UserInputOptions.UseCanvasElement=v.useCanvasElement,BABYLON.UserInputOptions.UseArrowKeyRotation=v.arrowKeyRotation}if(null!=o.enableinput){var b=o.enableinput;if(b===!0){var C=null==o.contextmenu||o.contextmenu,T=null!=o.pointerlock&&o.pointerlock,M=null!=o.preventdefault&&o.preventdefault,S=null!=o.usecapture&&o.usecapture,I={contextMenu:C,pointerLock:T,preventDefault:M,useCapture:S};BABYLON.InputController&&BABYLON.InputController.ConfigureUserInput(t,I)}}null!=o.freezeactivemeshes&&o.freezeactivemeshes===!0&&(this._activeMeshes=!0)}},e.prototype.postProcessSceneProperties=function(e,t,n){var o=this;if(this._assetContainer!==!0&&null!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.properties&&t.extras.metadata.properties===!0){var i=t.extras.metadata;if(null!=i.skybox){var r=i.skybox,a=null!=r.skyfog&&r.skyfog,l=null!=r.skytags?r.skytags:"Untagged",s=null!=r.skysize?r.skysize:1e3,u=null!=r.rotation?r.rotation:0,c=null!=r.basename&&""!==r.basename?e+r.basename:null,p=null!=r.skyfaces?r.skyfaces:null,h=null!=r.rendergroup?r.rendergroup:0,d=null!=r.extensions&&r.extensions.length>0?r.extensions:null,m=null!=r.polynomial?r.polynomial:1;try{if(null!=p&&""!==p&&null!=c&&""!==c){var g=null;if("png"===p)g=new BABYLON.CubeTexture(c,n,d),c.indexOf("_rgbd")>=0?(g.isRGBD=!0,g.gammaSpace=!1):(g.isRGBD=!1,g.gammaSpace=!0);else if("jpg"===p)g=new BABYLON.CubeTexture(c,n,d),g.isRGBD=!1,g.gammaSpace=!0;else if("ktx2"===p)g=new BABYLON.CubeTexture(c,n,d),g.isRGBD=!1,g.gammaSpace=!0;else{var f=!0,y=c+"."+p;g=new BABYLON.CubeTexture(y,n,null,(!0),null,null,null,null,f),g.gammaSpace=!1}g.name=r.basename,g.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,g.rotationY=BABYLON.Tools.ToRadians(u);var _="Default Skybox",v=BABYLON.MeshBuilder.CreateBox(_,{size:s},n);v.renderingGroupId=BABYLON.Utilities.DefaultRenderGroup(),v.id=_,v.infiniteDistance=!0,v.applyFog=a,v.renderingGroupId=h,null!=l&&""!==l&&BABYLON.Tags.AddTagsTo(v,l),n.useRightHandedSystem===!0&&(v.scaling.x*=-1);var b=new BABYLON.StandardMaterial("Skybox-Material",n);b.backFaceCulling=!1,b.disableLighting=!0,b.diffuseColor=new BABYLON.Color3(0,0,0),b.emissiveColor=new BABYLON.Color3(0,0,0),b.specularColor=new BABYLON.Color3(0,0,0),b.ambientColor=new BABYLON.Color3(0,0,0),b.reflectionTexture=g,v.material=b}}catch(C){console.warn(C)}if(null!=r.environment){var T=r.environment;n.environmentIntensity=null!=T.level?BABYLON.Scalar.Clamp(T.level,0,10):1;var M=null!=T.info&&""!==T.info?T.info:null;if(null!=M&&""!==M)try{var S=BABYLON.SceneManager.GetRootUrl(n),I=S+M.rooturl,P=I+M.name;if(null!=this._assetsManager){var A=this._assetsManager.addBinaryFileTask("Global.EnvironmentTextureTask",P);A.onSuccess=function(e){if(null!=e.data){var t=new Blob([e.data]),n=o._babylonScene,i=URL.createObjectURL(t),r=function(){URL.revokeObjectURL(i)},a=new BABYLON.CubeTexture(i,n,null,null,null,r,r,null,(!0),".dds");n.environmentTexture=a,n.environmentTexture.name="assets/"+M.name,null!=n.environmentTexture&&null!=n.environmentTexture.sphericalPolynomial&&(n.isReady()?n.environmentTexture.sphericalPolynomial.scaleInPlace(m):n.onReadyObservable.addOnce(function(){n.environmentTexture.sphericalPolynomial.scaleInPlace(m)}))}else console.error("Failed to load environment texture task: "+P)},A.onError=function(e,t,n){console.error(t,n)}}}catch(x){console.warn(x)}}}if(null!=i.navigation&&null!=i.navigation.prebaked&&""!==i.navigation.prebaked){var O=null!=i.navigation.collision&&i.navigation.collision===!0,w=null!=i.navigation.showdebug&&i.navigation.showdebug===!0,R=null!=i.navigation.debugcolor?i.navigation.debugcolor:[.05,.225,.75],B=new BABYLON.Color3(R[0],R[1],R[2]),k=null!=i.navigation.timesteps?i.navigation.timesteps:0;if(null!=this._assetsManager){var L=i.navigation.prebaked,N=this._assetsManager.addBinaryFileTask("System.NavigationMeshTask",L);N.onSuccess=function(e){if(null!=e.data){var t=new Uint8Array(e.data);BABYLON.SceneManager.LoadNavigationMesh(n,t,w,B,k,O)}else console.error("Failed to load navigation mesh task: "+L)},N.onError=function(e,t,n){console.error(t,n)}}}}},e.prototype._preloadRawMaterialsAsync=function(e,t,n){var o=this._loader,i=new Array,r=BABYLON.Material.TriangleFillMode;return n.forEach(function(n){var a=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),t,n);if(null!=a){var l=o.createMaterial(e,a,r);BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(l,e),o._parent.onMaterialLoadedObservable.notifyObservers(l),i.push(o.loadMaterialPropertiesAsync(e,a,l))}}),Promise.all(i).then(function(){})},e.prototype._parseMultiMaterialAsync=function(e,t,n,o,i){var r=this;void 0===i&&(i=function(){});var a=this._loader,l=t;l._data=l._data||{};var s=l._data[o];if(!s){a.logOpen("".concat(e," ").concat(n.name||""));var u=[],c=new Array;t.forEach(function(t){var n=null;if(t.index){var i=t.index;i>=0&&(n=r._getCachedMaterialByIndex(i))}null==n&&(n=a.createMaterial(e,t,o),BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(n,e),a._parent.onMaterialLoadedObservable.notifyObservers(n),c.push(a.loadMaterialPropertiesAsync(e,t,n))),u.push(n)}),s={babylonMaterials:u,babylonMeshes:[],promises:c},l._data[o]=s,a.logClose()}return s.babylonMeshes.push(n),n.onDisposeObservable.addOnce(function(){var e=s.babylonMeshes.indexOf(n);e!==-1&&s.babylonMeshes.splice(e,1)}),i(s.babylonMaterials),Promise.all(s.promises).then(function(){return s.babylonMaterials})},e.prototype._parseNodeMaterialPropertiesAsync=function(e,t,n){var o=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,i=n,r=new Array;i.backFaceCulling=null==o||null==o.backFaceCulling||o.backFaceCulling,t.doubleSided&&(i.backFaceCulling=!1);var a=1;if(t.pbrMetallicRoughness){var l=t.pbrMetallicRoughness;if(l){if(l.baseColorFactor){var s=BABYLON.Color4.FromArray(l.baseColorFactor);i.setVector4("_Color",new BABYLON.Vector4(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2),s.a)),a=s.a}else i.setVector4("_Color",new BABYLON.Vector4(1,1,1,1));l.baseColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),l.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)");var t=e;t.level=null!=o&&null!=o.diffuseIntensity?o.diffuseIntensity:1,i.setTexture("_MainTex",t)}))}}if(t.normalTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)");var o=e;void 0!=t.normalTexture.scale&&(o.level=t.normalTexture.scale),i.setTexture("_BumpMap",o)})),t.occlusionTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)");var o=e;void 0!=t.occlusionTexture.strength&&(o.level=t.occlusionTexture.strength),i.setTexture("_OcclusionMap",o)})),t.emissiveFactor){var u=BABYLON.Color4.FromArray(t.emissiveFactor);(u.r>0||u.g>0||u.b>0)&&i.setVector4("_EmissionColor",new BABYLON.Vector4(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2),u.a))}if(t.emissiveTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)");var t=e;i.setTexture("_EmissionMap",t)})),null!=o){if(i.wireframe=null!=o.useWireframe&&o.useWireframe,i.needDepthPrePass=null!=o.depthPrepass&&o.depthPrepass,o.customTextures){var c=function(t){var a=o.customTextures[t];null!=a&&r.push(p._loader.loadTextureInfoAsync(e+"/"+t,a,function(e){"detailsSampler"===t||"normalsSampler"===t?e.name="".concat(n.name," (Atlas)"):e.name="".concat(n.name," (Custom)"),i.setTexture(t,e)}))},p=this;for(var h in o.customTextures)c(h)}if(o.customVectors)for(var d in o.customVectors){var m=o.customVectors[d];null!=m&&i.setVector4(d,BABYLON.Vector4.FromArray(m))}if(o.customColors)for(var g in o.customColors){var f=o.customColors[g];null!=f&&i.setVector4(g,BABYLON.Vector4.FromArray(f))}if(o.customFloats)for(var y in o.customFloats){var _=o.customFloats[y];null!=_&&i.setFloat(y,_)}null!=o.freezeMaterial&&o.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(i)}var v=Promise.all(r).then(function(){});return i.compile(),v},e.prototype._parseShaderMaterialPropertiesAsync=function(e,t,n){var o=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,i=n,r=new Array;i.backFaceCulling=null==o||null==o.backFaceCulling||o.backFaceCulling,t.doubleSided&&(i.backFaceCulling=!1),BABYLON.Utilities.HasOwnProperty(i,"ambientColor")&&(i.ambientColor=null!=o&&o.ambientColorFactor?BABYLON.Color3.FromArray(o.ambientColorFactor):BABYLON.Color3.Black());var a=1;if(t.pbrMetallicRoughness){var l=t.pbrMetallicRoughness;if(l){if(l.baseColorFactor){var s=BABYLON.Color4.FromArray(l.baseColorFactor);i.setVector4("diffuseColor",new BABYLON.Vector4(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2),s.a)),a=s.a}else i.setVector4("diffuseColor",new BABYLON.Vector4(1,1,1,1));l.baseColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),l.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)");var t=e;t.level=null!=o&&null!=o.diffuseIntensity?o.diffuseIntensity:1,i.setTexture("diffuseTexture",t)}))}}if(t.normalTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)");var o=e;void 0!=t.normalTexture.scale&&(o.level=t.normalTexture.scale),i.setTexture("bumpTexture",o)})),t.occlusionTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)");var o=e;void 0!=t.occlusionTexture.strength&&(o.level=t.occlusionTexture.strength),i.setTexture("ambientTexture",o)})),t.emissiveFactor){var u=BABYLON.Color4.FromArray(t.emissiveFactor);(u.r>0||u.g>0||u.b>0)&&i.setVector4("emissiveColor",new BABYLON.Vector4(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2),u.a))}t.emissiveTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)");var t=e;i.setTexture("emissiveTexture",t)})),i.alpha=a;var c=t.alphaMode||"OPAQUE";switch(c){case"OPAQUE":i.alpha=1,i.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_OPAQUE;break;case"MASK":i.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHATEST;break;case"BLEND":i.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHABLEND;break;default:throw new Error("".concat(e,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}if(null!=o){if(i.wireframe=null!=o.useWireframe&&o.useWireframe,i.needDepthPrePass=null!=o.depthPrepass&&o.depthPrepass,o.customTextures){var p=function(t){var a=o.customTextures[t];null!=a&&r.push(h._loader.loadTextureInfoAsync(e+"/"+t,a,function(e){"detailsSampler"===t||"normalsSampler"===t?e.name="".concat(n.name," (Atlas)"):e.name="".concat(n.name," (Custom)"),i.setTexture(t,e)}))},h=this;for(var d in o.customTextures)p(d)}if(o.customVectors)for(var m in o.customVectors){var g=o.customVectors[m];null!=g&&i.setVector4(m,BABYLON.Vector4.FromArray(g))}if(o.customColors)for(var f in o.customColors){var y=o.customColors[f];null!=y&&i.setVector4(f,BABYLON.Vector4.FromArray(y))}if(o.customFloats)for(var _ in o.customFloats){var v=o.customFloats[_];null!=v&&i.setFloat(_,v)}null!=o.freezeMaterial&&o.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(i)}return Promise.all(r).then(function(){})},e.prototype._parseDiffuseMaterialPropertiesAsync=function(e,t,n){var o=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,i=n,r=new Array;BABYLON.Utilities.HasOwnProperty(i,"ambientColor")&&(i.ambientColor=null!=o&&o.ambientColorFactor?BABYLON.Color3.FromArray(o.ambientColorFactor):BABYLON.Color3.Black()),BABYLON.Utilities.HasOwnProperty(i,"backFaceCulling")&&(i.backFaceCulling=null==o||null==o.backFaceCulling||o.backFaceCulling),t.doubleSided&&(BABYLON.Utilities.HasOwnProperty(i,"twoSidedLighting")&&(i.twoSidedLighting=!0),BABYLON.Utilities.HasOwnProperty(i,"backFaceCulling")&&(i.backFaceCulling=!1));var a=1;if(t.pbrMetallicRoughness){var l=t.pbrMetallicRoughness;if(l){if(BABYLON.Utilities.HasOwnProperty(i,"diffuseColor"))if(l.baseColorFactor){var s=BABYLON.Color4.FromArray(l.baseColorFactor);i.diffuseColor=new BABYLON.Color3(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2)),a=s.a}else i.diffuseColor=BABYLON.Color3.White();BABYLON.Utilities.HasOwnProperty(i,"diffuseTexture")&&l.baseColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),l.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)"),i.diffuseTexture=e,i.diffuseTexture.level=null!=o&&null!=o.diffuseIntensity?o.diffuseIntensity:1}))}}if(BABYLON.Utilities.HasOwnProperty(i,"bumpTexture")&&t.normalTexture&&(r.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)"),i.bumpTexture=e,void 0!=t.normalTexture.scale&&(i.bumpTexture.level=t.normalTexture.scale)})),BABYLON.Utilities.HasOwnProperty(i,"invertNormalMapX")&&(i.invertNormalMapX=!this._loader.babylonScene.useRightHandedSystem),BABYLON.Utilities.HasOwnProperty(i,"invertNormalMapY")&&(i.invertNormalMapY=this._loader.babylonScene.useRightHandedSystem)),BABYLON.Utilities.HasOwnProperty(i,"ambientTexture")&&t.occlusionTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)"),i.ambientTexture=e,void 0!=t.occlusionTexture.strength&&(i.ambientTexture.level=t.occlusionTexture.strength)})),BABYLON.Utilities.HasOwnProperty(i,"emissiveColor")){var u=t.emissiveFactor?BABYLON.Color4.FromArray(t.emissiveFactor):new BABYLON.Color4(0,0,0,1);i.emissiveColor=new BABYLON.Color3(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2))}BABYLON.Utilities.HasOwnProperty(i,"emissiveTexture")&&t.emissiveTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)"),i.emissiveTexture=e,BABYLON.Utilities.HasOwnProperty(i,"useEmissiveAsIllumination")&&(i.useEmissiveAsIllumination=null!=o&&null!=o.useEmissiveAsIllumination&&o.useEmissiveAsIllumination)})),BABYLON.Utilities.HasOwnProperty(i,"alpha")&&(i.alpha=a);var c=t.alphaMode||"OPAQUE";switch(c){case"OPAQUE":BABYLON.Utilities.HasOwnProperty(i,"alpha")&&(i.alpha=1);break;case"MASK":i.alphaCutOff=void 0==t.alphaCutoff?.5:t.alphaCutoff,i.diffuseTexture&&BABYLON.Utilities.HasOwnProperty(i,"diffuseTexture")&&(i.diffuseTexture.hasAlpha=!0);break;case"BLEND":i.diffuseTexture&&(BABYLON.Utilities.HasOwnProperty(i,"diffuseTexture")&&(i.diffuseTexture.hasAlpha=!0),BABYLON.Utilities.HasOwnProperty(i,"useAlphaFromDiffuseTexture")&&(i.useAlphaFromDiffuseTexture=!0));break;default:throw new Error("".concat(e,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}return this._parseCommonConstantProperties(r,e,t,n),Promise.all(r).then(function(){})},e.prototype._parseCommonConstantProperties=function(e,t,n,o){var i=this,r=null!=n.extras&&null!=n.extras.metadata?n.extras.metadata:null;if(null!=r){var a=o;if(BABYLON.Utilities.HasOwnProperty(a,"alphaMode")&&(a.alphaMode=null!=r&&r.alphaMode?r.alphaMode:BABYLON.Engine.ALPHA_COMBINE),BABYLON.Utilities.HasOwnProperty(a,"ambientColor")&&(a.ambientColor=null!=r&&r.ambientColorFactor?BABYLON.Color3.FromArray(r.ambientColorFactor):BABYLON.Color3.Black()),BABYLON.Utilities.HasOwnProperty(a,"backFaceCulling")&&(a.backFaceCulling=null==r||null==r.backFaceCulling||r.backFaceCulling),o instanceof BABYLON.PBRMaterial&&(o.useMetallnessFromMetallicTextureBlue=!0,o.useRoughnessFromMetallicTextureGreen=!0,o.useRoughnessFromMetallicTextureAlpha=!1,o.useAmbientOcclusionFromMetallicTextureRed=!1,o.directIntensity=null!=r.directIntensity?r.directIntensity:1,o.specularIntensity=null!=r.specularIntensity?r.specularIntensity:1,o.emissiveIntensity=null!=r.emissiveIntensity?r.emissiveIntensity:1,o.environmentIntensity=null!=r.environmentIntensity?r.environmentIntensity:1,o.indexOfRefraction=null!=r.indexOfRefraction?r.indexOfRefraction:1.5,null!=r.useAlphaFromAlbedoTexture&&(o.useAlphaFromAlbedoTexture=r.useAlphaFromAlbedoTexture),null!=r.parallaxBias&&r.parallaxBias>0&&(o.useParallax=!0,o.parallaxScaleBias=.9*r.parallaxBias,o.useParallaxOcclusion=null==r.parallaxOcclusion||r.parallaxOcclusion,o.useParallaxOcclusion===!0&&(o.parallaxScaleBias*=.5))),BABYLON.Utilities.HasOwnProperty(a,"unlit")&&(a.unlit=null!=r.unlitMaterial&&r.unlitMaterial),BABYLON.Utilities.HasOwnProperty(a,"wireframe")&&(a.wireframe=null!=r.useWireframe&&r.useWireframe),BABYLON.Utilities.HasOwnProperty(a,"disableLighting")&&(a.disableLighting=null!=r.disableLighting&&r.disableLighting),BABYLON.Utilities.HasOwnProperty(a,"maxSimultaneousLights")&&(a.maxSimultaneousLights=null!=r.maxSimultaneousLights?r.maxSimultaneousLights:4),BABYLON.Utilities.HasOwnProperty(a,"needDepthPrePass")&&(a.needDepthPrePass=null!=r.depthPrepass&&r.depthPrepass),BABYLON.Utilities.HasOwnProperty(a,"lightmapTexture")&&r.lightmapTexture){r.lightmapTexture.nonColorData=!0;var l=!0;BABYLON.Utilities.HasOwnProperty(a,"useLightmapAsShadowmap")&&(l=null==r.useLightmapAsShadowmap||r.useLightmapAsShadowmap);var s=null,u=null!=r.lightmapTexture.index?r.lightmapTexture.index:-1;u>=0&&(s=this._getCachedLightmapByIndex(u)),null!=s?(a.lightmapTexture=s,a.useLightmapAsShadowmap=l,BABYLON.Utilities.HasOwnProperty(a,"ambientColor")&&(a.ambientColor=BABYLON.Color3.White())):e.push(this._loader.loadTextureInfoAsync(t+"/lightmapTexture",r.lightmapTexture,function(e){e.name="assets/LightmapTexture-".concat(u),e.level=r.lightmapLevel?r.lightmapLevel:1;var t=e,n=null!=BABYLON.SceneManager.GlobalOptions.ktxlightmaps&&BABYLON.SceneManager.GlobalOptions.ktxlightmaps===!0;n===!0?e.gammaSpace=!0:(e.gammaSpace=!1,t.onLoadObservable.addOnce(function(){t.isReady()?t.isRGBD=!0:BABYLON.Tools.Warn("Failed to register texture as RGBD: "+t.name)})),a.lightmapTexture=e,u>=0&&null!=i._lightmapMap&&(i._lightmapMap.has(u)||i._lightmapMap.set(u,t)),a.useLightmapAsShadowmap=l,BABYLON.Utilities.HasOwnProperty(a,"ambientColor")&&(a.ambientColor=BABYLON.Color3.White())}))}o instanceof BABYLON.PBRMaterial&&r.detailMapTexture&&e.push(this._loader.loadTextureInfoAsync(t+"/detailMapTexture",r.detailMapTexture,function(e){e.name="".concat(o.name," (Detail Map)"),e.level=1,o.detailMap.texture=e,o.detailMap.bumpLevel=r.detailBumpLevel?r.detailBumpLevel:1,o.detailMap.diffuseBlendLevel=r.detailBlendLevel?r.detailBlendLevel:.75,o.detailMap.roughnessBlendLevel=r.detailRoughLevel?r.detailRoughLevel:.5,o.detailMap.isEnabled=!0}));var c=BABYLON.SceneManager.GetRenderQuality(),p=c===BABYLON.RenderQuality.High||c===BABYLON.RenderQuality.Medium;if(p===!0&&BABYLON.Utilities.HasOwnProperty(a,"reflectionColor")&&(a.reflectionColor=null!=r&&r.reflectionColorFactor?BABYLON.Color3.FromArray(r.reflectionColorFactor):BABYLON.Color3.White()),p===!0&&BABYLON.Utilities.HasOwnProperty(a,"reflectionTexture")&&r.reflectionCubemapInfo){var h=this._loader._rootUrl,d=(h+r.reflectionCubemapInfo.rooturl+r.reflectionCubemapInfo.name).toLowerCase(),m=d.lastIndexOf("."),g=m>-1?d.substring(m).toLowerCase():"",f=!0,y=new CubeTextureLoader;y.name="assets/"+r.reflectionCubemapInfo.name,y.mapkey=d,y.material=a,y.extension=g,y.prefiltered=f,r.reflectionCubemapInfo.boundingBoxSize&&(y.boundingBoxSize=BABYLON.Vector3.FromArray(r.reflectionCubemapInfo.boundingBoxSize),y.name+=" ("+y.boundingBoxSize.x.toString()+" "+y.boundingBoxSize.y.toString()+" "+y.boundingBoxSize.z.toString()+")",y.mapkey+="_"+y.boundingBoxSize.x.toString()+"_"+y.boundingBoxSize.y.toString()+"_"+y.boundingBoxSize.z.toString()),r.reflectionCubemapInfo.boundingBoxPosition&&(y.boundingBoxPosition=BABYLON.Vector3.FromArray(r.reflectionCubemapInfo.boundingBoxPosition),y.name+=" ("+y.boundingBoxPosition.x.toString()+" "+y.boundingBoxPosition.y.toString()+" "+y.boundingBoxPosition.z.toString()+")",y.mapkey+="_"+y.boundingBoxPosition.x.toString()+"_"+y.boundingBoxPosition.y.toString()+"_"+y.boundingBoxPosition.z.toString());var _=this._reflectionMap[d];null==_?(_=[y],this._reflectionMap[d]=_):_.push(y)}if(BABYLON.Utilities.HasOwnProperty(a,"terrainInfo")&&(a.terrainInfo=null!=r.terrainInfo?r.terrainInfo:null),BABYLON.Utilities.HasOwnProperty(o,"universalMaterial")){var v=o;if(r.customTextures){var b=function(n){var i=r.customTextures[n];null!=i&&(v.checkSampler(n),e.push(C._loader.loadTextureInfoAsync(t+"/"+n,i,function(e){"detailsSampler"===n||"normalsSampler"===n?e.name="".concat(o.name," (Atlas)"):e.name="".concat(o.name," (Custom)"),v.setTexture(n,e,!0)})))},C=this;for(var T in r.customTextures)b(T)}if(r.customVectors)for(var M in r.customVectors){
var S=r.customVectors[M];null!=S&&v.setVector4(M,BABYLON.Vector4.FromArray(S),!0)}if(r.customColors)for(var I in r.customColors){var P=r.customColors[I];null!=P&&v.setVector4(I,BABYLON.Vector4.FromArray(P),!0)}if(r.customFloats)for(var A in r.customFloats){var x=r.customFloats[A];null!=x&&v.setFloat(A,x,!0)}}else{if(r.customTextures){var O=function(n){var i=r.customTextures[n];null!=i&&BABYLON.Utilities.HasOwnProperty(a,n)&&e.push(w._loader.loadTextureInfoAsync(t+"/"+n,i,function(e){"detailsSampler"===n||"normalsSampler"===n?e.name="".concat(o.name," (Atlas)"):e.name="".concat(o.name," (Custom)"),a[n]=e}))},w=this;for(var T in r.customTextures)O(T)}if(r.customVectors)for(var M in r.customVectors){var S=r.customVectors[M];null!=S&&BABYLON.Utilities.HasOwnProperty(a,M)&&(a[M]=BABYLON.Vector4.FromArray(S))}if(r.customColors)for(var I in r.customColors){var P=r.customColors[I];null!=P&&BABYLON.Utilities.HasOwnProperty(a,I)&&(a[I]instanceof BABYLON.Vector4?a[I]=BABYLON.Vector4.FromArray(P):a[I]instanceof BABYLON.Color4?a[I]=BABYLON.Color4.FromArray(P):a[I]=BABYLON.Color3.FromArray(P))}if(r.customFloats)for(var A in r.customFloats){var x=r.customFloats[A];null!=x&&BABYLON.Utilities.HasOwnProperty(a,A)&&(a[A]instanceof Boolean?a[A]=x>0:a[A]=x)}}null!=r.freezeMaterial&&r.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(o)}},e}(),CVTOOLS_babylon_mesh=function(){function e(e){this.name=CVTOOLS_MESH,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_MESH),this.order=101}return e.prototype.dispose=function(){delete this._loader},e}(),CVTOOLS_left_handed=function(){function e(e){this.name=CVTOOLS_HAND,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_HAND),this.order=102}return e.prototype.dispose=function(){delete this._loader},e}();BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_NAME,function(e){return new CVTOOLS_unity_metadata(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_MESH,function(e){return new CVTOOLS_babylon_mesh(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_HAND,function(e){return new CVTOOLS_left_handed(e)}),BABYLON.SceneLoader.OnPluginActivatedObservable.add(function(e){"gltf"===e.name&&e instanceof BABYLON.GLTFFileLoader&&(e.animationStartMode=BABYLON.SceneManager.AnimationStartMode,e.targetFps=BABYLON.SceneManager.AnimationTargetFps,e.onSkinLoadedObservable.add(function(e){if(null!=e){try{null!=e.skinnedNode&&(e.skinnedNode.id+=".Skin")}catch(t){console.warn(t)}try{null!=e.skinnedNode&&(e.skinnedNode.name+=".Skin")}catch(n){console.warn(n)}try{if(null!=e.node&&null!=e.skinnedNode){var o=BABYLON.Tags.GetTags(e.node);null!=o&&BABYLON.Tags.AddTagsTo(e.skinnedNode,o),e.node._skinnedMesh=e.skinnedNode}}catch(i){console.warn(i)}}}))});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),BABYLON;!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n._frametime=0,n._layercount=0,n._updatemode=0,n._hasrootmotion=!1,n._animationplaying=!1,n._initialtargetblending=!1,n._hastransformhierarchy=!1,n._leftfeetbottomheight=0,n._rightfeetbottomheight=0,n._initialRootBonePosition=null,n._runtimecontroller=null,n._executed=!1,n._awakened=!1,n._initialized=!1,n._checkers=new e.TransitionCheck,n._source="",n._machine=null,n._animationmode=0,n._animationrig=null,n._deltaPosition=new e.Vector3(0,0,0),n._deltaRotation=new e.Quaternion(0,0,0,1),n._positionWeight=!1,n._rootBoneWeight=!1,n._rotationWeight=!1,n._rootQuatWeight=!1,n._rootBoneTransform=null,n._angularVelocity=new e.Vector3(0,0,0),n._positionHolder=new e.Vector3(0,0,0),n._rootBoneHolder=new e.Vector3(0,0,0),n._rotationHolder=new e.Quaternion(0,0,0,1),n._rootQuatHolder=new e.Quaternion(0,0,0,1),n._rootMotionMatrix=e.Matrix.Zero(),n._rootMotionScaling=new e.Vector3(0,0,0),n._rootMotionRotation=new e.Quaternion(0,0,0,1),n._rootMotionPosition=new e.Vector3(0,0,0),n._lastMotionRotation=new e.Quaternion(0,0,0,1),n._lastMotionPosition=new e.Vector3(0,0,0),n._dirtyMotionMatrix=null,n._dirtyBlenderMatrix=null,n._targetPosition=new e.Vector3(0,0,0),n._targetRotation=new e.Quaternion(0,0,0,1),n._targetScaling=new e.Vector3(1,1,1),n._updateMatrix=e.Matrix.Zero(),n._blenderMatrix=e.Matrix.Zero(),n._blendWeights=new e.BlendingWeights,n._emptyScaling=new e.Vector3(1,1,1),n._emptyPosition=new e.Vector3(0,0,0),n._emptyRotation=new e.Quaternion(0,0,0,1),n._ikFrameEanbled=!1,n._data=new Map,n._anims=new Map,n._clips=null,n._timers=new Map,n._starts=new Map,n._stops=new Map,n._numbers=new Map,n._booleans=new Map,n._triggers=new Map,n._parameters=new Map,n.speedRatio=1,n.delayUpdateUntilReady=!0,n.enableAnimation=!0,n.applyRootMotion=!1,n.onAnimationAwakeObservable=new e.Observable,n.onAnimationInitObservable=new e.Observable,n.onAnimationIKObservable=new e.Observable,n.onAnimationEndObservable=new e.Observable,n.onAnimationLoopObservable=new e.Observable,n.onAnimationEventObservable=new e.Observable,n.onAnimationUpdateObservable=new e.Observable,n.onAnimationTransitionObservable=new e.Observable,n.m_defaultGroup=null,n.m_animationTargets=null,n.m_characterController=null,n.sourceAnimationGroups=null,n}return __extends(n,t),n.prototype.awakened=function(){return this._awakened},n.prototype.initialized=function(){return this._initialized},n.prototype.hasRootMotion=function(){return this._hasrootmotion},n.prototype.ikFrameEnabled=function(){return this._ikFrameEanbled},n.prototype.getAnimationTime=function(){return this._frametime},n.prototype.getAnimationPlaying=function(){return this._animationplaying},n.prototype.getRootMotionAngle=function(){return this._angularVelocity.y},n.prototype.getRootMotionSpeed=function(){return this._deltaPosition.length()},n.prototype.getRootMotionPosition=function(){return this._deltaPosition},n.prototype.getRootMotionRotation=function(){return this._deltaRotation},n.prototype.getRootBoneTransform=function(){return this._rootBoneTransform},n.prototype.getCharacterController=function(){return this.m_characterController},n.prototype.getRuntimeController=function(){return this._runtimecontroller},n.prototype.awake=function(){this.awakeStateMachine()},n.prototype.update=function(){this.updateStateMachine()},n.prototype.destroy=function(){this.destroyStateMachine()},n.prototype.playDefaultAnimation=function(t,n,o){void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=null);var i=!1;if(this._initialized===!0)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>n){var r=this._machine.layers[n],a=null!=r.animationStateMachine?r.animationStateMachine.rate||e.AnimationState.FPS:e.AnimationState.FPS,l=t>0?e.Utilities.ComputeBlendingSpeed(o||a,t):0;this.playCurrentAnimationState(r,r.entry,l),i=!0}else e.Tools.Warn("No animation state layers on "+this.transform.name);else e.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return i},n.prototype.playAnimation=function(t,n,o,i){void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=null);var r=!1;if(this._initialized===!0)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>o){var a=this._machine.layers[o],l=null!=a.animationStateMachine?a.animationStateMachine.rate||e.AnimationState.FPS:e.AnimationState.FPS,s=n>0?e.Utilities.ComputeBlendingSpeed(i||l,n):0;this.playCurrentAnimationState(a,t,s),r=!0}else e.Tools.Warn("No animation state layers on "+this.transform.name);else e.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return r},n.prototype.stopAnimation=function(t){void 0===t&&(t=0);var n=!1;if(this._initialized===!0)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>t){var o=this._machine.layers[t];this.stopCurrentAnimationState(o),n=!0}else e.Tools.Warn("No animation state layers on "+this.transform.name);else e.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return n},n.prototype.hasBool=function(e){return null!=this._booleans.get(e)},n.prototype.getBool=function(e){return this._booleans.get(e)||!1},n.prototype.setBool=function(e,t){this._booleans.set(e,t)},n.prototype.hasFloat=function(e){return null!=this._numbers.get(e)},n.prototype.getFloat=function(e){return this._numbers.get(e)||0},n.prototype.setFloat=function(e,t){this._numbers.set(e,t)},n.prototype.hasInteger=function(e){return null!=this._numbers.get(e)},n.prototype.getInteger=function(e){return this._numbers.get(e)||0},n.prototype.setInteger=function(e,t){this._numbers.set(e,t)},n.prototype.hasTrigger=function(e){return null!=this._triggers.get(e)},n.prototype.getTrigger=function(e){return this._triggers.get(e)||!1},n.prototype.setTrigger=function(e){this._triggers.set(e,!0)},n.prototype.resetTrigger=function(e){this._triggers.set(e,!1)},n.prototype.setSmoothFloat=function(t,n,o,i){var r=this._timers.get(t)||-1,a=this._starts.get(t)||null,l=this._stops.get(t)||null;if(null!=l&&null!=n&&l!=n&&(r=-1),r<0&&(r=0,a=null,l=null),null==a&&(a=this.getFloat(t)),null==l&&(l=n),r>=0&&null!=a&&null!=l){var s=0;r<o?(s=e.Scalar.Lerp(a,l,r/o),r+=i):(s=l,r=-1,a=null,l=null),this._numbers.set(t,s)}this._timers.set(t,r),this._starts.set(t,a),this._stops.set(t,l)},n.prototype.setSmoothInteger=function(e,t,n,o){this.setSmoothFloat(e,t,n,o)},n.prototype.resetSmoothProperty=function(e){this._timers["delete"](e),this._starts["delete"](e),this._stops["delete"](e),this._numbers["delete"](e)},n.prototype.getMachineState=function(e){return this._data.get(e)},n.prototype.setMachineState=function(e,t){this._data.set(e,t)},n.prototype.getCurrentState=function(e){return null!=this._machine.layers&&this._machine.layers.length>e?this._machine.layers[e].animationStateMachine:null},n.prototype.getDefaultClips=function(){return this._clips},n.prototype.getDefaultSource=function(){return this._source},n.prototype.fixAnimationGroup=function(e){var t=null;if(null!=this._clips&&this._clips.length>0)for(var n=0;n<this._clips.length;n++){var o=this._clips[n];if(null!=o.clip){var i=("."+o.clip).toLowerCase();if(e.name.toLowerCase().endsWith(i)){null==e.metadata&&(e.metadata={}),null==e.metadata.unity&&(e.metadata.unity=o),e.metadata.unity.source=this._source,t=o;break}}}return t},n.prototype.getAnimationGroup=function(e){return this._anims.get(e)},n.prototype.getAnimationGroups=function(){return this.sourceAnimationGroups},n.prototype.setAnimationGroups=function(e){null==this.transform.metadata&&(this.transform.metadata={}),null==this.transform.metadata.unity&&(this.transform.metadata.unity={}),this.transform.metadata.unity.sourceAnimationGroups=e,this.setupSourceAnimationGroups()},n.prototype.updateAnimationGroups=function(t){var n=this;null!=t&&t.length>0&&(this._anims=new Map,this.m_animationTargets=[],this.m_defaultGroup=null,this.sourceAnimationGroups=null,t.forEach(function(t){var o=!1,i=t;if(null!=i&&null!=i.metadata&&null!=i.metadata.unity&&null!=i.metadata.unity.source&&""!==i.metadata.unity.source&&i.metadata.unity.source===n._source&&(o=!0),o===!0&&null!=i&&null!=i.metadata&&null!=i.metadata.unity&&null!=i.metadata.unity.clip&&""!==i.metadata.unity.clip){try{t.stop()}catch(r){}null==n.sourceAnimationGroups&&(n.sourceAnimationGroups=[]),n.sourceAnimationGroups.push(t),n._anims.set(i.metadata.unity.clip,t),null==n.m_defaultGroup&&(n.m_defaultGroup=t),null!=t.targetedAnimations&&t.targetedAnimations.length>0&&t.targetedAnimations.forEach(function(t){for(var o=-1,i=0;i<n.m_animationTargets.length;i++)if(n.m_animationTargets[i].target===t.target){o=i;break}if(o<0)if(n.m_animationTargets.push(t),null==t.target.metadata&&(t.target.metadata={}),t.target instanceof e.TransformNode){e.Utilities.ValidateTransformQuaternion(t.target);for(var r=[],a=0;a<n._layercount;a++){var l=new e.AnimationMixer;l.positionBuffer=null,l.rotationBuffer=null,l.scalingBuffer=null,l.originalMatrix=null,l.blendingFactor=0,l.blendingSpeed=0,l.rootPosition=null,l.rootRotation=null,r.push(l)}t.target.metadata.mixer=r}else if(t.target instanceof e.MorphTarget){for(var s=[],a=0;a<n._layercount;a++){var u=new e.AnimationMixer;u.influenceBuffer=null,s.push(u)}t.target.metadata.mixer=s}})}}))},n.prototype.awakeStateMachine=function(){var t=this;if(e.Utilities.ValidateTransformQuaternion(this.transform),this.m_animationTargets=[],this.m_defaultGroup=null,this.m_characterController=this.getComponent("BABYLON.CharacterController"),this._source=null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.animator&&""!==this.transform.metadata.unity.animator?this.transform.metadata.unity.animator:null,this._clips=this.getProperty("clips",this._clips),this._machine=this.getProperty("machine",this._machine),this._updatemode=this.getProperty("updatemode",this._updatemode),this._animationrig=this.getProperty("animationrig",this._animationrig),this._animationmode=this.getProperty("animationmode",this._animationmode),this._hasrootmotion=this.getProperty("hasrootmotion",this._hasrootmotion),this._runtimecontroller=this.getProperty("runtimecontroller",this._runtimecontroller),this._hastransformhierarchy=this.getProperty("hastransformhierarchy",this._hastransformhierarchy),this._leftfeetbottomheight=this.getProperty("leftfeetbottomheight",this._leftfeetbottomheight),this._rightfeetbottomheight=this.getProperty("rightfeetbottomheight",this._rightfeetbottomheight),this.applyRootMotion=this.getProperty("applyrootmotion",this.applyRootMotion),null!=this._machine){if(null!=this._machine.owner&&void 0!=this._machine.owner&&""!==this._machine.owner&&"*"!==this._machine.owner||(this._machine.owner=null!=this.transform.parent?this.transform.parent.name:this.transform.name),null!=this._machine.speed&&(this.speedRatio=this._machine.speed),null!=this._machine.parameters&&this._machine.parameters.length>0){var n=this._machine.parameters;n.forEach(function(n){var o=n.name,i=n.type,r=(n.curve,n.defaultFloat),a=n.defaultBool,l=n.defaultInt;t._parameters.set(o,i),i===e.AnimatorParameterType.Bool?t.setBool(o,a):i===e.AnimatorParameterType.Float?t.setFloat(o,r):i===e.AnimatorParameterType.Int?t.setInteger(o,l):i===e.AnimatorParameterType.Trigger&&t.resetTrigger(o)})}null!=this._machine.layers&&this._machine.layers.length>0&&(this._layercount=this._machine.layers.length,this._machine.layers.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this._machine.layers.forEach(function(e){if(null==e.owner||void 0==e.owner||""===e.owner||"*"===e.owner,e.animationMaskMap=new Map,null!=e.avatarMask&&null!=e.avatarMask.transformPaths&&e.avatarMask.transformPaths.length>0)for(var t=0;t<e.avatarMask.transformPaths.length;t++)e.animationMaskMap.set(e.avatarMask.transformPaths[t],t)}))}this._awakened=!0,this.onAnimationAwakeObservable&&this.onAnimationAwakeObservable.hasObservers()&&this.onAnimationAwakeObservable.notifyObservers(this.transform)},n.prototype.updateStateMachine=function(e){var t=this;if(void 0===e&&(e=null),(this.delayUpdateUntilReady===!1||this.delayUpdateUntilReady===!0&&this.isReady())&&(null==this.sourceAnimationGroups&&this.setupSourceAnimationGroups(),null!=this.sourceAnimationGroups&&(this._executed===!1&&(this._executed=!0,null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(e){t.playCurrentAnimationState(e,e.entry,0)}),this._initialized=!0,this.onAnimationInitObservable&&this.onAnimationInitObservable.hasObservers()&&this.onAnimationInitObservable.notifyObservers(this.transform)),this.enableAnimation===!0))){var n=e||this.getDeltaSeconds();this.updateAnimationState(n),this.updateAnimationTargets(n),this.onAnimationUpdateObservable&&this.onAnimationUpdateObservable.hasObservers()&&this.onAnimationUpdateObservable.notifyObservers(this.transform)}},n.prototype.setupSourceAnimationGroups=function(){var t=this,n=null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.sourceAnimationGroups?this.transform.metadata.unity.sourceAnimationGroups:null;null!=n&&(this.updateAnimationGroups(n),null!=this.sourceAnimationGroups&&null!=this._machine&&null!=this._machine.states&&this._machine.states.length>0&&this._machine.states.forEach(function(n){null!=n&&null!=n.name&&(null!=n.ccurves&&n.ccurves.length>0&&n.ccurves.forEach(function(t){if(null!=t.animation){var o=e.Animation.Parse(t.animation);null!=o&&(null==n.tcurves&&(n.tcurves=[]),n.tcurves.push(o))}}),t.setupTreeBranches(n.blendtree),t.setMachineState(n.name,n))}))},n.prototype.destroyStateMachine=function(){this._data=null,this._clips=null,this._anims=null,this._numbers=null,this._booleans=null,this._triggers=null,this._parameters=null,this._checkers=null,this._machine=null,this.sourceAnimationGroups=null,this.onAnimationAwakeObservable.clear(),this.onAnimationAwakeObservable=null,this.onAnimationInitObservable.clear(),this.onAnimationInitObservable=null,this.onAnimationIKObservable.clear(),this.onAnimationIKObservable=null,this.onAnimationEndObservable.clear(),this.onAnimationEndObservable=null,this.onAnimationLoopObservable.clear(),this.onAnimationLoopObservable=null,this.onAnimationEventObservable.clear(),this.onAnimationEventObservable=null,this.onAnimationUpdateObservable.clear(),this.onAnimationUpdateObservable=null,this.onAnimationTransitionObservable.clear(),this.onAnimationTransitionObservable=null},n.prototype.updateAnimationState=function(e){var t=this;null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(n){t.checkStateMachine(n,e)})},n.prototype.updateAnimationTargets=function(t){var n=this;this._ikFrameEanbled=!1,this._animationplaying=!1,null!=this.transform.rotationQuaternion||null!=this.transform.rotation,null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(o){if(0===o.index&&(n._frametime=o.animationTime),null!=o.animationStateMachine&&null!=o.animationStateMachine.blendtree){o.iKPass===!0&&(o.animationStateMachine.iKOnFeet===!0&&(n._ikFrameEanbled=!0),n.onAnimationIKObservable&&n.onAnimationIKObservable.hasObservers()&&n.onAnimationIKObservable.notifyObservers(o.index));var i=o.animationStateMachine;if(i.type===e.MotionType.Clip&&i.played!==-1&&(i.played+=t),null!=i.blendtree.children&&i.blendtree.children.length>0){var r=i.blendtree.children[0];if(null!=r)if(i.blendtree.blendType==e.BlendTreeType.Clip){var a=r.track;if(null!=a){var l=a.metadata.unity.length,s=e.AnimationState.TIME/l;o.animationTime+=t*s*Math.abs(i.speed)*Math.abs(n.speedRatio)*e.AnimationState.SPEED,o.animationTime>e.AnimationState.TIME&&(o.animationTime=e.AnimationState.TIME),o.animationNormal=o.animationTime/e.AnimationState.TIME;var u=o.animationNormal>.995?1:o.animationNormal,c=parseFloat(u.toFixed(3));i.speed<0&&(o.animationNormal=1-o.animationNormal);var p=l*o.animationNormal,h=0,d=0,m=0,g=!1,f=0,y=!0,_=!0,v=!0,b=a;null!=b.metadata&&null!=b.metadata.unity&&(null!=b.metadata.unity.averagespeed&&(d=null!=b.metadata.unity.averagespeed.x?b.metadata.unity.averagespeed.x:0,m=null!=b.metadata.unity.averagespeed.z?b.metadata.unity.averagespeed.z:0),null!=b.metadata.unity.settings&&(h=null!=b.metadata.unity.settings.level?b.metadata.unity.settings.level:0,g=null!=b.metadata.unity.settings.looptime&&b.metadata.unity.settings.looptime,f=null!=b.metadata.unity.settings.orientationoffsety?b.metadata.unity.settings.orientationoffsety:0,y=null==b.metadata.unity.settings.loopblendorientation||b.metadata.unity.settings.loopblendorientation,_=null==b.metadata.unity.settings.loopblendpositiony||b.metadata.unity.settings.loopblendpositiony,v=null==b.metadata.unity.settings.loopblendpositionxz||b.metadata.unity.settings.loopblendpositionxz)),f=e.Tools.ToRadians(f),d=Math.abs(d),m=Math.abs(m),h*=-1,o.animationTime>=e.AnimationState.TIME&&(o.animationFirstRun=!1,o.animationLoopFrame=!0,g===!0?(o.animationLoopCount++,n.onAnimationLoopObservable&&n.onAnimationLoopObservable.hasObservers()&&n.onAnimationLoopObservable.notifyObservers(o.index)):o.animationEndFrame===!1&&(o.animationEndFrame=!0,n.onAnimationEndObservable&&n.onAnimationEndObservable.hasObservers()&&n.onAnimationEndObservable.notifyObservers(o.index))),o.animationFirstRun!==!0&&g!==!0||(n._animationplaying=!0,a.targetedAnimations.forEach(function(t){if(t.target instanceof e.TransformNode){var i=t.target;if(0===o.index||null==o.avatarMask||n.filterTargetAvatarMask(o,i)){var r=null!=i.metadata&&null!=i.metadata.unity&&null!=i.metadata.unity.rootbone&&i.metadata.unity.rootbone;if(r===!0&&(null==n._rootBoneTransform&&(n._rootBoneTransform=i),null==n._initialRootBonePosition)){var a=null!=i.metadata&&null!=i.metadata.unity&&null!=i.metadata.unity.rootpos?i.metadata.unity.rootpos:null;null!=a&&(n._initialRootBonePosition=e.Vector3.FromArray(a)),null==n._initialRootBonePosition&&(n._initialRootBonePosition=new e.Vector3(0,0,0))}if(null!=i.metadata&&null!=i.metadata.mixer){var l=i.metadata.mixer[o.index];if(null!=l)if("position"===t.animation.targetProperty)n._targetPosition=e.Utilities.SampleAnimationVector3(t.animation,p,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),r===!0&&null!=n._initialRootBonePosition?(n._positionWeight=!0,n._positionHolder.copyFrom(n._initialRootBonePosition),n._rootBoneWeight=!1,n._rootBoneHolder.set(0,0,0),n.applyRootMotion===!0?_===!0&&v===!0?(n._positionWeight=!0,n._positionHolder.set(n._targetPosition.x,n._targetPosition.y+h,n._targetPosition.z)):_===!1&&v===!1?(n._rootBoneWeight=!0,n._rootBoneHolder.set(n._targetPosition.x,n._targetPosition.y+h,n._targetPosition.z)):_===!0&&v===!1?(n._positionWeight=!0,n._positionHolder.set(n._initialRootBonePosition.x,n._targetPosition.y+h,n._initialRootBonePosition.z),n._rootBoneWeight=!0,n._rootBoneHolder.set(n._targetPosition.x,0,n._targetPosition.z)):v===!0&&_===!1&&(n._positionWeight=!0,n._positionHolder.set(n._targetPosition.x,n._initialRootBonePosition.y,n._targetPosition.z),n._rootBoneWeight=!0,n._rootBoneHolder.set(0,n._targetPosition.y+h,0)):(n._positionWeight=!0,n._positionHolder.set(n._targetPosition.x,n._targetPosition.y+h,n._targetPosition.z)),n._positionWeight===!0&&(null==l.positionBuffer&&(l.positionBuffer=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(l.positionBuffer,n._positionHolder,1)),n._rootBoneWeight===!0&&(null==l.rootPosition&&(l.rootPosition=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(l.rootPosition,n._rootBoneHolder,1))):(null==l.positionBuffer&&(l.positionBuffer=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(l.positionBuffer,n._targetPosition,1));else if("rotationQuaternion"===t.animation.targetProperty)if(n._targetRotation=e.Utilities.SampleAnimationQuaternion(t.animation,p,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),r===!0){n._rotationWeight=!1,n._rotationHolder.set(0,0,0,0),n._rootQuatWeight=!1,n._rootQuatHolder.set(0,0,0,0);var s=n._targetRotation.toEulerAngles(),u=s.y;n.applyRootMotion===!0?y===!0?(n._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(s.x,u+f,s.z,n._rotationHolder)):(n._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(s.x,0,s.z,n._rotationHolder),n._rootQuatWeight=!0,e.Quaternion.FromEulerAnglesToRef(0,u+f,0,n._rootQuatHolder)):(n._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(s.x,u+f,s.z,n._rotationHolder)),n._rotationWeight===!0&&(null==l.rotationBuffer&&(l.rotationBuffer=new e.Quaternion(0,0,0,1)),e.Utilities.BlendQuaternionValue(l.rotationBuffer,n._rotationHolder,1)),n._rootQuatWeight===!0&&(null==l.rootRotation&&(l.rootRotation=new e.Quaternion(0,0,0,1)),e.Utilities.BlendQuaternionValue(l.rootRotation,n._rootQuatHolder,1))}else null==l.rotationBuffer&&(l.rotationBuffer=new e.Quaternion(0,0,0,1)),e.Utilities.BlendQuaternionValue(l.rotationBuffer,n._targetRotation,1);else"scaling"===t.animation.targetProperty&&(n._targetScaling=e.Utilities.SampleAnimationVector3(t.animation,p,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==l.scalingBuffer&&(l.scalingBuffer=new e.Vector3(1,1,1)),e.Utilities.BlendVector3Value(l.scalingBuffer,n._targetScaling,1))}}}else if(t.target instanceof e.MorphTarget){var c=t.target;if(null!=c.metadata&&null!=c.metadata.mixer){var d=c.metadata.mixer[o.index];if("influence"===t.animation.targetProperty){var m=e.Utilities.SampleAnimationFloat(t.animation,p,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0);null==d.influenceBuffer&&(d.influenceBuffer=0),d.influenceBuffer=e.Utilities.BlendFloatValue(d.influenceBuffer,m,1)}}}})),1==n._animationplaying&&(null!=o.animationStateMachine.tcurves&&o.animationStateMachine.tcurves.length>0&&o.animationStateMachine.tcurves.forEach(function(t){if(null!=t.targetProperty&&""!==t.targetProperty){var i=e.Utilities.SampleAnimationFloat(t,o.animationNormal,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0);n.setFloat(t.targetProperty,i)}}),null!=o.animationStateMachine.events&&o.animationStateMachine.events.length>0&&o.animationStateMachine.events.forEach(function(e){if(c>=e.time-.01&&c<=e.time+.01){var t=e["function"]+"_"+e.time;null==o.animationLoopEvents&&(o.animationLoopEvents={}),o.animationLoopEvents[t]||(o.animationLoopEvents[t]=!0,n.onAnimationEventObservable&&n.onAnimationEventObservable.hasObservers()&&n.onAnimationEventObservable.notifyObservers(e))}})),o.animationLoopFrame===!0&&(o.animationTime=0,o.animationNormal=0,o.animationLoopFrame=!1,o.animationLoopEvents=null)}}else{n._animationplaying=!0,n._blendWeights.primary=null,n._blendWeights.secondary=null;var C=[],T=i.blendtree;n.parseTreeBranches(o,T,1,C);var s=n.computeWeightedFrameRatio(C);o.animationTime+=t*s*Math.abs(i.speed)*Math.abs(n.speedRatio)*e.AnimationState.SPEED,o.animationTime>e.AnimationState.TIME&&(o.animationTime=e.AnimationState.TIME),o.animationNormal=o.animationTime/e.AnimationState.TIME;var u=o.animationNormal>.99?1:o.animationNormal,M=parseFloat(u.toFixed(3));i.speed<0&&(o.animationNormal=1-o.animationNormal);var S=o.animationNormal;o.animationTime>=e.AnimationState.TIME&&(o.animationFirstRun=!1,o.animationLoopFrame=!0,o.animationLoopCount++);var I=null!=C&&C.length>0&&null!=C[0].track?C[0].track:null;if(null!=I)for(var P=I.targetedAnimations.length,A=0;A<P;A++){var x=I.targetedAnimations[A];if(x.target instanceof e.TransformNode){var O=x.target;if(0===o.index||null==o.avatarMask||n.filterTargetAvatarMask(o,O)){var w=null!=O.metadata&&null!=O.metadata.unity&&null!=O.metadata.unity.rootbone&&O.metadata.unity.rootbone;if(w===!0&&(null==n._rootBoneTransform&&(n._rootBoneTransform=O),null==n._initialRootBonePosition)){var R=null!=O.metadata&&null!=O.metadata.unity&&null!=O.metadata.unity.rootpos?O.metadata.unity.rootpos:null;null!=R&&(n._initialRootBonePosition=e.Vector3.FromArray(R)),null==n._initialRootBonePosition&&(n._initialRootBonePosition=new e.Vector3(0,0,0))}if(null!=O.metadata&&null!=O.metadata.mixer){n._initialtargetblending=!0;var B=O.metadata.mixer[o.index];n.updateBlendableTargets(t,o,T,x,A,B,S,w,O)}}}}null!=o.animationStateMachine.tcurves&&o.animationStateMachine.tcurves.length>0&&o.animationStateMachine.tcurves.forEach(function(t){if(null!=t.targetProperty&&""!==t.targetProperty){var i=e.Utilities.SampleAnimationFloat(t,o.animationNormal,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0);n.setFloat(t.targetProperty,i)}}),null!=o.animationStateMachine.events&&o.animationStateMachine.events.length>0&&o.animationStateMachine.events.forEach(function(e){if(M>=e.time-.01&&M<=e.time+.01){var t=e["function"]+"_"+e.time;null==o.animationLoopEvents&&(o.animationLoopEvents={}),o.animationLoopEvents[t]||(o.animationLoopEvents[t]=!0,n.onAnimationEventObservable&&n.onAnimationEventObservable.hasObservers()&&n.onAnimationEventObservable.notifyObservers(e))}}),o.animationLoopFrame===!0&&(o.animationTime=0,o.animationNormal=0,o.animationLoopFrame=!1,o.animationLoopEvents=null)}}}}),this.finalizeAnimationTargets()},n.prototype.updateBlendableTargets=function(t,n,o,i,r,a,l,s,u){if(null!=a&&null!=o.children&&o.children.length>0)for(var c=0;c<o.children.length;c++){var p=o.children[c];if(p.weight>0)if(p.type===e.MotionType.Clip){if(null!=p.track){var h=0,d=0,m=0,g=0,f=!0,y=!0,_=!0,v=p.track;null!=v.metadata&&null!=v.metadata.unity&&(null!=v.metadata.unity.averagespeed&&(d=null!=v.metadata.unity.averagespeed.x?v.metadata.unity.averagespeed.x:0,m=null!=v.metadata.unity.averagespeed.z?v.metadata.unity.averagespeed.z:0),null!=v.metadata.unity.settings&&(h=null!=v.metadata.unity.settings.level?v.metadata.unity.settings.level:0,g=null!=v.metadata.unity.settings.orientationoffsety?v.metadata.unity.settings.orientationoffsety:0,f=null==v.metadata.unity.settings.loopblendorientation||v.metadata.unity.settings.loopblendorientation,y=null==v.metadata.unity.settings.loopblendpositiony||v.metadata.unity.settings.loopblendpositiony,_=null==v.metadata.unity.settings.loopblendpositionxz||v.metadata.unity.settings.loopblendpositionxz)),g=e.Tools.ToRadians(g),d=Math.abs(d),m=Math.abs(m),h*=-1;var b=p.track.targetedAnimations[r],C=this._initialtargetblending===!0?1:parseFloat(p.weight.toFixed(2));if(this._initialtargetblending=!1,b.target===i.target&&b.animation.targetProperty===i.animation.targetProperty){var T=l;p.timescale<0&&(T=1-T);var M=p.track.metadata.unity.length,S=M*T;if("position"===i.animation.targetProperty)this._targetPosition=e.Utilities.SampleAnimationVector3(b.animation,S,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),s===!0&&null!=this._initialRootBonePosition?(this._positionWeight=!0,this._positionHolder.copyFrom(this._initialRootBonePosition),this._rootBoneWeight=!1,this._rootBoneHolder.set(0,0,0),this.applyRootMotion===!0?y===!0&&_===!0?(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+h,this._targetPosition.z)):y===!1&&_===!1?(this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this._targetPosition.y+h,this._targetPosition.z)):y===!0&&_===!1?(this._positionWeight=!0,this._positionHolder.set(this._initialRootBonePosition.x,this._targetPosition.y+h,this._initialRootBonePosition.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,0,this._targetPosition.z)):_===!0&&y===!1&&(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._initialRootBonePosition.y,this._targetPosition.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(0,this._targetPosition.y+h,0)):(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+h,this._targetPosition.z)),this._positionWeight===!0&&(null==a.positionBuffer&&(a.positionBuffer=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.positionBuffer,this._positionHolder,C)),this._rootBoneWeight===!0&&(null==a.rootPosition&&(a.rootPosition=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.rootPosition,this._rootBoneHolder,C))):(null==a.positionBuffer&&(a.positionBuffer=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.positionBuffer,this._targetPosition,C));else if("rotationQuaternion"===i.animation.targetProperty)if(this._targetRotation=e.Utilities.SampleAnimationQuaternion(b.animation,S,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),s===!0){this._rotationWeight=!1,this._rotationHolder.set(0,0,0,0),this._rootQuatWeight=!1,this._rootQuatHolder.set(0,0,0,0);var I=this._targetRotation.toEulerAngles(),P=I.y;this.applyRootMotion===!0?f===!0?(this._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(I.x,P+g,I.z,this._rotationHolder)):(this._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(I.x,0,I.z,this._rotationHolder),this._rootQuatWeight=!0,e.Quaternion.FromEulerAnglesToRef(0,P+g,0,this._rootQuatHolder)):(this._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(I.x,P+g,I.z,this._rotationHolder)),this._rotationWeight===!0&&(null==a.rotationBuffer&&(a.rotationBuffer=new e.Quaternion(0,0,0,1)),
e.Utilities.BlendQuaternionValue(a.rotationBuffer,this._rotationHolder,C)),this._rootQuatWeight===!0&&(null==a.rootRotation&&(a.rootRotation=new e.Quaternion(0,0,0,1)),e.Utilities.BlendQuaternionValue(a.rootRotation,this._rootQuatHolder,C))}else null==a.rotationBuffer&&(a.rotationBuffer=new e.Quaternion(0,0,0,1)),e.Utilities.BlendQuaternionValue(a.rotationBuffer,this._targetRotation,C);else"scaling"===i.animation.targetProperty&&(this._targetScaling=e.Utilities.SampleAnimationVector3(b.animation,S,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==a.scalingBuffer&&(a.scalingBuffer=new e.Vector3(1,1,1)),e.Utilities.BlendVector3Value(a.scalingBuffer,this._targetScaling,C))}else e.Tools.Warn(o.name+" - "+p.track.name+" blend tree mismatch ("+r+"): "+i.target.name+" >>> "+b.target.name)}}else p.type===e.MotionType.Tree&&this.updateBlendableTargets(t,n,p.subtree,i,r,a,l,s,u)}},n.prototype.finalizeAnimationTargets=function(){var t=this;this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,1),null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(n){var o=n.target;null!=o.metadata&&null!=o.metadata.mixer&&null!=t._machine.layers&&t._machine.layers.length>0&&(t._blenderMatrix.reset(),t._dirtyBlenderMatrix=null,t._machine.layers.forEach(function(n){var i=o.metadata.mixer[n.index];null!=i&&(o instanceof e.TransformNode?(null==i.positionBuffer&&null==i.rotationBuffer&&null==i.scalingBuffer||(e.Matrix.ComposeToRef(i.scalingBuffer||o.scaling,i.rotationBuffer||o.rotationQuaternion,i.positionBuffer||o.position,t._updateMatrix),i.blendingSpeed>0&&(i.blendingFactor<=1&&null==i.originalMatrix&&(i.originalMatrix=e.Matrix.Compose(o.scaling,o.rotationQuaternion,o.position)),i.blendingFactor<=1&&null!=i.originalMatrix&&(e.Utilities.FastMatrixSlerp(i.originalMatrix,t._updateMatrix,i.blendingFactor,t._updateMatrix),i.blendingFactor+=i.blendingSpeed)),e.Utilities.FastMatrixSlerp(t._blenderMatrix,t._updateMatrix,n.defaultWeight,t._blenderMatrix),t._dirtyBlenderMatrix=!0,i.positionBuffer=null,i.rotationBuffer=null,i.scalingBuffer=null),null==i.rootPosition&&null==i.rootRotation||(e.Matrix.ComposeToRef(t._emptyScaling,i.rootRotation||t._emptyRotation,i.rootPosition||t._emptyPosition,t._updateMatrix),e.Utilities.FastMatrixSlerp(t._rootMotionMatrix,t._updateMatrix,n.defaultWeight,t._rootMotionMatrix),t._dirtyMotionMatrix=!0,i.rootPosition=null,i.rootRotation=null)):o instanceof e.MorphTarget&&null!=i.influenceBuffer&&(o.influence=e.Scalar.Lerp(o.influence,i.influenceBuffer,n.defaultWeight),i.influenceBuffer=null))}),null!=t._dirtyBlenderMatrix&&t._blenderMatrix.decompose(o.scaling,o.rotationQuaternion,o.position))}),this.applyRootMotion===!0&&null!=this._dirtyMotionMatrix&&(this._rootMotionMatrix.decompose(this._rootMotionScaling,this._rootMotionRotation,this._rootMotionPosition),0===this._frametime&&(this._lastMotionPosition.copyFrom(this._rootMotionPosition),this._lastMotionRotation.copyFrom(this._rootMotionRotation)),this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),e.Utilities.QuaternionDiffToRef(this._rootMotionRotation,this._lastMotionRotation,this._deltaRotation),this._deltaRotation.toEulerAnglesToRef(this._angularVelocity),this._lastMotionPosition.copyFrom(this._rootMotionPosition),this._lastMotionRotation.copyFrom(this._rootMotionRotation))},n.prototype.checkStateMachine=function(e,t){var n=this;this._checkers.result=null,this._checkers.offest=0,this._checkers.blending=0,this._checkers.triggered=[],null!=e.animationStateMachine&&(e.animationStateMachine.time+=t,this.checkStateTransitions(e,e.animationStateMachine.transitions),null==this._checkers.result&&null!=this._machine.transitions&&this.checkStateTransitions(e,this._machine.transitions)),null!=this._checkers.triggered&&this._checkers.triggered.length>0&&(this._checkers.triggered.forEach(function(e){n.resetTrigger(e)}),this._checkers.triggered=null),null!=this._checkers.result&&(this.onAnimationTransitionObservable&&this.onAnimationTransitionObservable.hasObservers()&&this.onAnimationTransitionObservable.notifyObservers(this.transform),this.playCurrentAnimationState(e,this._checkers.result,this._checkers.blending,this._checkers.offest))},n.prototype.checkStateTransitions=function(t,n){var o=this,i=t.animationStateMachine.rate,r=t.animationStateMachine.length;if(null!=n&&n.length>0){var a=0,l=-1;for(a=0;a<n.length;a++)if(n[a].solo===!0&&n[a].mute===!1){l=a;break}var s=function(){var s=n[a];if(s.layerIndex!==t.index)return"continue";if(s.mute===!0)return"continue";if(l>=0&&l!==a)return"continue";var c=!1,p=0,h=!0;if(s.exitTime>0&&(p=r*s.exitTime/u.speedRatio,h=s.hasExitTime!==!0||t.animationStateMachine.time>=p),s.hasExitTime===!0&&s.intSource==e.InterruptionSource.None&&h===!1)return"continue";if(null!=s.conditions&&s.conditions.length>0){var d=0,m=s.conditions.length;s.conditions.forEach(function(t){var n=o._parameters.get(t.parameter);if(null!=n)if(n==e.AnimatorParameterType.Float||n==e.AnimatorParameterType.Int){var i=parseFloat(o.getFloat(t.parameter).toFixed(2));t.mode===e.ConditionMode.Greater&&i>t.threshold?d++:t.mode===e.ConditionMode.Less&&i<t.threshold?d++:t.mode===e.ConditionMode.Equals&&i===t.threshold?d++:t.mode===e.ConditionMode.NotEqual&&i!==t.threshold&&d++}else if(n==e.AnimatorParameterType.Bool){var r=o.getBool(t.parameter);t.mode===e.ConditionMode.If&&r===!0?d++:t.mode===e.ConditionMode.IfNot&&r===!1&&d++}else if(n==e.AnimatorParameterType.Trigger){var a=o.getTrigger(t.parameter);if(a===!0){d++;for(var l=-1,s=0;s<o._checkers.triggered.length;s++)if(o._checkers.triggered[s]===t.parameter){l=s;break}l<0&&o._checkers.triggered.push(t.parameter)}}}),c=s.hasExitTime===!0?h===!0&&d===m:d===m}else c=s.hasExitTime===!0&&h===!0;if(c===!0){s.hasExitTime===!0&&h===!0&&u.onAnimationEndObservable&&u.onAnimationEndObservable.hasObservers()&&u.onAnimationEndObservable.notifyObservers(t.index);var g=i>0?i:e.AnimationState.FPS,f=s.isExit===!1?s.destination:e.AnimationState.EXIT,y=s.fixedDuration===!0?s.duration:e.Scalar.Denormalize(s.duration,0,r),_=e.Utilities.ComputeBlendingSpeed(g,y),v=s.offset;return u._checkers.result=f,u._checkers.offest=v,u._checkers.blending=_,"break"}},u=this;for(a=0;a<n.length;a++){var c=s();if("break"===c)break}}},n.prototype.playCurrentAnimationState=function(t,n,o,i){if(void 0===i&&(i=0),null!=t&&null!=n&&""!==n&&n!==e.AnimationState.EXIT&&(null==t.animationStateMachine||t.animationStateMachine.name!==n)){null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(e){var n=e.target;if(null!=n.metadata&&null!=n.metadata.mixer){var i=n.metadata.mixer[t.index];null!=i&&(i.originalMatrix=null,i.blendingFactor=0,i.blendingSpeed=o)}});var r=this.getMachineState(n);null!=r&&r.layerIndex===t.index&&(r.time=0,r.played=0,r.interrupted=!1,t.animationTime=e.Scalar.Clamp(i),t.animationNormal=0,t.animationFirstRun=!0,t.animationEndFrame=!1,t.animationLoopFrame=!1,t.animationLoopCount=0,t.animationLoopEvents=null,t.animationStateMachine=r)}},n.prototype.stopCurrentAnimationState=function(e){null!=e&&(null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(t){var n=t.target;if(null!=n.metadata&&null!=n.metadata.mixer){var o=n.metadata.mixer[e.index];null!=o&&(o.originalMatrix=null,o.blendingFactor=0,o.blendingSpeed=0)}}),e.animationTime=0,e.animationNormal=0,e.animationFirstRun=!0,e.animationEndFrame=!1,e.animationLoopFrame=!1,e.animationLoopCount=0,e.animationLoopEvents=null,e.animationStateMachine=null)},n.prototype.checkAvatarTransformPath=function(e,t){var n=!1;if(null!=e.animationMaskMap){var o=e.animationMaskMap.get(t);null!=o&&o>=0&&(n=!0)}return n},n.prototype.filterTargetAvatarMask=function(e,t){var n=!1;if(null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.bone&&""!==t.metadata.unity.bone){var o=t.metadata.unity.bone;n=this.checkAvatarTransformPath(e,o)}return n},n.prototype.sortWeightedBlendingList=function(e){null!=e&&e.length>0&&e.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0})},n.prototype.computeWeightedFrameRatio=function(t){var n=1;if(null!=t&&t.length>0){this.sortWeightedBlendingList(t),this._blendWeights.primary=t[0];var o=this._blendWeights.primary.weight;if(o<1&&t.length>1&&(this._blendWeights.secondary=t[1]),null!=this._blendWeights.primary&&null!=this._blendWeights.secondary){var i=e.Scalar.Clamp(this._blendWeights.primary.weight);n=e.Scalar.Lerp(this._blendWeights.secondary.ratio,this._blendWeights.primary.ratio,i)}else null!=this._blendWeights.primary&&null==this._blendWeights.secondary&&(n=this._blendWeights.primary.ratio)}return n},n.prototype.setupTreeBranches=function(t){var n=this;null!=t&&null!=t.children&&t.children.length>0&&t.children.forEach(function(t){if(t.type===e.MotionType.Tree)n.setupTreeBranches(t.subtree);else if(t.type===e.MotionType.Clip&&null!=t.motion&&""!==t.motion&&(t.weight=0,t.ratio=0,t.track=n.getAnimationGroup(t.motion),null!=t.track)){var o=t.track.metadata.unity.length;t.ratio=e.AnimationState.TIME/o}})},n.prototype.parseTreeBranches=function(t,n,o,i){if(null!=n)switch(n.valueParameterX=null!=n.blendParameterX?parseFloat(this.getFloat(n.blendParameterX).toFixed(2)):0,n.valueParameterY=null!=n.blendParameterY?parseFloat(this.getFloat(n.blendParameterY).toFixed(2)):0,n.blendType){case e.BlendTreeType.Simple1D:this.parse1DSimpleTreeBranches(t,n,o,i);break;case e.BlendTreeType.SimpleDirectional2D:this.parse2DSimpleDirectionalTreeBranches(t,n,o,i);break;case e.BlendTreeType.FreeformDirectional2D:this.parse2DFreeformDirectionalTreeBranches(t,n,o,i);break;case e.BlendTreeType.FreeformCartesian2D:this.parse2DFreeformCartesianTreeBranches(t,n,o,i)}},n.prototype.parse1DSimpleTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.threshold,posY:e.threshold,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate1DSimpleBlendTree(n.valueParameterX,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.prototype.parse2DSimpleDirectionalTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate2DFreeformDirectional(n.valueParameterX,n.valueParameterY,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.prototype.parse2DFreeformDirectionalTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate2DFreeformDirectional(n.valueParameterX,n.valueParameterY,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.prototype.parse2DFreeformCartesianTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate2DFreeformCartesian(n.valueParameterX,n.valueParameterY,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.FPS=30,n.EXIT="[EXIT]",n.TIME=1,n.SPEED=1.025,n}(e.ScriptComponent);e.AnimationState=t;var n=function(){function e(e){this.source=e.source,this.motion=e.motion,this.posX=e.posX||0,this.posY=e.posY||0,this.weight=e.weight||0}return e}();e.BlendTreeValue=n;var o=function(){function e(){}return e.ClampValue=function(e,t,n){return e<=t?t:e>=n?n:e},e.GetSignedAngle=function(e,t){return Math.atan2(e.x*t.y-e.y*t.x,e.x*t.x+e.y*t.y)},e.GetLinearInterpolation=function(e,t,n,o,i){return t+(i-e)*((o-t)/(n-e))},e.GetRightNeighbourIndex=function(e,t){t.sort(function(e,t){return e.posX-t.posX});for(var n=0;n<t.length;++n)if(t[n].posX>e)return n;return-1},e}();e.BlendTreeUtils=o;var i=function(){function t(){}return t.Calculate1DSimpleBlendTree=function(t,n){var o=n[0],i=n[n.length-1];if(t<=o.posX)o.weight=1;else if(t>=i.posX)i.weight=1;else{var r=e.BlendTreeUtils.GetRightNeighbourIndex(t,n),a=n[r-1],l=n[r],s=e.BlendTreeUtils.GetLinearInterpolation(a.posX,1,l.posX,0,t);a.weight=s,l.weight=1-a.weight}},t.Calculate2DFreeformDirectional=function(t,n,o){e.BlendTreeSystem.TempVector2_IP.set(t,n),e.BlendTreeSystem.TempVector2_POSI.set(0,0),e.BlendTreeSystem.TempVector2_POSJ.set(0,0),e.BlendTreeSystem.TempVector2_POSIP.set(0,0),e.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var i=2,r=0,a=e.BlendTreeSystem.TempVector2_IP.length(),l=0;l<o.length;++l){var s=o[l];e.BlendTreeSystem.TempVector2_POSI.set(s.posX,s.posY);for(var u=e.BlendTreeSystem.TempVector2_POSI.length(),c=a-u,p=e.BlendTreeUtils.GetSignedAngle(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_IP),h=1,d=0;d<o.length;++d)if(d!==l){e.BlendTreeSystem.TempVector2_POSJ.set(o[d].posX,o[d].posY);var m=e.BlendTreeSystem.TempVector2_POSJ.length(),g=(u+m)/2,f=c/g,y=(m-u)/g,_=e.BlendTreeUtils.GetSignedAngle(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSJ);e.BlendTreeSystem.TempVector2_POSIP.set(f,p*i),e.BlendTreeSystem.TempVector2_POSIJ.set(y,_*i);var v=e.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),b=e.Vector2.Dot(e.BlendTreeSystem.TempVector2_POSIP,e.BlendTreeSystem.TempVector2_POSIJ)/v;b=1-b,b=e.BlendTreeUtils.ClampValue(b,0,1),h=Math.min(b,h)}s.weight=h,r+=h}for(var C=0,T=o;C<T.length;C++){var s=T[C];s.weight/=r}},t.Calculate2DFreeformCartesian=function(t,n,o){e.BlendTreeSystem.TempVector2_IP.set(t,n),e.BlendTreeSystem.TempVector2_POSI.set(0,0),e.BlendTreeSystem.TempVector2_POSJ.set(0,0),e.BlendTreeSystem.TempVector2_POSIP.set(0,0),e.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var i=0,r=0;r<o.length;++r){var a=o[r];e.BlendTreeSystem.TempVector2_POSI.set(a.posX,a.posY),e.BlendTreeSystem.TempVector2_IP.subtractToRef(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSIP);for(var l=1,s=0;s<o.length;++s)if(s!==r){e.BlendTreeSystem.TempVector2_POSJ.set(o[s].posX,o[s].posY),e.BlendTreeSystem.TempVector2_POSJ.subtractToRef(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSIJ);var u=e.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),c=e.Vector2.Dot(e.BlendTreeSystem.TempVector2_POSIP,e.BlendTreeSystem.TempVector2_POSIJ)/u;c=1-c,c=e.BlendTreeUtils.ClampValue(c,0,1),l=Math.min(l,c)}a.weight=l,i+=l}for(var p=0,h=o;p<h.length;p++){var a=h[p];a.weight/=i}},t.TempVector2_IP=new e.Vector2(0,0),t.TempVector2_POSI=new e.Vector2(0,0),t.TempVector2_POSJ=new e.Vector2(0,0),t.TempVector2_POSIP=new e.Vector2(0,0),t.TempVector2_POSIJ=new e.Vector2(0,0),t}();e.BlendTreeSystem=i;var r=function(){function e(){}return e}();e.MachineState=r;var a=function(){function e(){}return e}();e.TransitionCheck=a;var l=function(){function e(){}return e}();e.AnimationMixer=l;var s=function(){function e(){}return e}();e.BlendingWeights=s;var u;!function(e){e[e.Clip=0]="Clip",e[e.Tree=1]="Tree"}(u=e.MotionType||(e.MotionType={}));var c;!function(e){e[e.If=1]="If",e[e.IfNot=2]="IfNot",e[e.Greater=3]="Greater",e[e.Less=4]="Less",e[e.Equals=6]="Equals",e[e.NotEqual=7]="NotEqual"}(c=e.ConditionMode||(e.ConditionMode={}));var p;!function(e){e[e.None=0]="None",e[e.Source=1]="Source",e[e.Destination=2]="Destination",e[e.SourceThenDestination=3]="SourceThenDestination",e[e.DestinationThenSource=4]="DestinationThenSource"}(p=e.InterruptionSource||(e.InterruptionSource={}));var h;!function(e){e[e.Simple1D=0]="Simple1D",e[e.SimpleDirectional2D=1]="SimpleDirectional2D",e[e.FreeformDirectional2D=2]="FreeformDirectional2D",e[e.FreeformCartesian2D=3]="FreeformCartesian2D",e[e.Direct=4]="Direct",e[e.Clip=5]="Clip"}(h=e.BlendTreeType||(e.BlendTreeType={}));var d;!function(e){e[e.Lower=0]="Lower",e[e.Upper=1]="Upper"}(d=e.BlendTreePosition||(e.BlendTreePosition={}));var m;!function(e){e[e.Float=1]="Float",e[e.Int=3]="Int",e[e.Bool=4]="Bool",e[e.Trigger=9]="Trigger"}(m=e.AnimatorParameterType||(e.AnimatorParameterType={}))}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),BABYLON;!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n._audio=null,n._name=null,n._loop=!1,n._mute=!1,n._pitch=1,n._volume=1,n._preload=!1,n._playonawake=!0,n._spatialblend=0,n._preloaderUrl=null,n._lastmutedvolume=null,n._priority=128,n._panstereo=0,n._mindistance=10,n._maxdistance=50,n._rolloffmode="linear",n._reverbzonemix=1,n._bypasseffects=!1,n._bypassreverbzones=!1,n._bypasslistenereffects=!1,n._initializedReadyInstance=!1,n.onReadyObservable=new e.Observable,n}return __extends(n,t),n.prototype.getSoundClip=function(){return this._audio},n.prototype.getAudioElement=function(){return null!=this._audio?this._audio._htmlAudioElement:null},n.prototype.awake=function(){this.awakeAudioSource()},n.prototype.start=function(){this.startAudioSource()},n.prototype.destroy=function(){this.destroyAudioSource()},n.prototype.awakeAudioSource=function(){this._name=this.getProperty("name",this._name),this._loop=this.getProperty("loop",this._loop),this._mute=this.getProperty("mute",this._mute),this._pitch=this.getProperty("pitch",this._pitch),this._volume=this.getProperty("volume",this._volume),this._preload=this.getProperty("preload",this._preload),this._priority=this.getProperty("priority",this._priority),this._panstereo=this.getProperty("panstereo",this._panstereo),this._playonawake=this.getProperty("playonawake",this._playonawake),this._mindistance=this.getProperty("mindistance",this._mindistance),this._maxdistance=this.getProperty("maxdistance",this._maxdistance),this._rolloffmode=this.getProperty("rolloffmode",this._rolloffmode),this._spatialblend=this.getProperty("spatialblend",this._spatialblend),this._reverbzonemix=this.getProperty("reverbzonemix",this._reverbzonemix),this._bypasseffects=this.getProperty("bypasseffects",this._bypasseffects),this._bypassreverbzones=this.getProperty("bypassreverbzones",this._bypassreverbzones),this._bypasslistenereffects=this.getProperty("bypasslistenereffects",this._bypasslistenereffects),null!=this._name&&""!==this._name||(this._name="Unknown");var t=this.getProperty("file");if(null!=t&&""!==t){var n=e.SceneManager.GetRootUrl(this.scene),o=n+t;null!=o&&""!==o&&(this._preload===!0?this._preloaderUrl=o:this.setDataSource(o))}},n.prototype.startAudioSource=function(){this._volume>=e.AudioSource.MAX_VOLUME&&(this._volume=e.AudioSource.DEFAULT_LEVEL)},n.prototype.destroyAudioSource=function(){this.onReadyObservable.clear(),this.onReadyObservable=null,null!=this._audio&&(this._audio.dispose(),this._audio=null)},n.prototype.isReady=function(){var e=!1;return null!=this._audio&&(e=this._audio.isReady()),e},n.prototype.isPlaying=function(){var e=!1;return null!=this._audio&&(e=this._audio.isPlaying),e},n.prototype.isPaused=function(){var e=!1;return null!=this._audio&&(e=this._audio.isPaused),e},n.prototype.play=function(t,n,o){var i=this;return e.SceneManager.HasAudioContext()?this.internalPlay(t,n,o):e.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){i.internalPlay(t,n,o)}),!0},n.prototype.internalPlay=function(e,t,n){var o=this;null!=this._audio&&(this._initializedReadyInstance===!0?this._audio.play(e,t,n):this.onReadyObservable.addOnce(function(){o._audio.play(e,t,n)}))},n.prototype.pause=function(){var e=!1;return null!=this._audio&&(this._audio.pause(),e=!0),e},n.prototype.stop=function(e){var t=!1;return null!=this._audio&&(this._audio.stop(e),t=!0),t},n.prototype.mute=function(e){var t=!1;return null!=this._audio&&(this._lastmutedvolume=this._audio.getVolume(),this._audio.setVolume(0,e)),t},n.prototype.unmute=function(e){var t=!1;return null!=this._audio&&null!=this._lastmutedvolume&&(this._audio.setVolume(this._lastmutedvolume,e),this._lastmutedvolume=null),t},n.prototype.getVolume=function(){var e=0;return e=null!=this._audio?this._audio.getVolume():this._volume},n.prototype.setVolume=function(e,t){var n=!1;return this._volume=e,null!=this._audio&&this._audio.setVolume(this._volume,t),n=!0},n.prototype.getSpatialSound=function(){var e=!1;return null!=this._audio&&(e=this._audio.spatialSound),e},n.prototype.setSpatialSound=function(e){null!=this._audio&&(this._audio.spatialSound=e)},n.prototype.setPlaybackSpeed=function(e){null!=this._audio&&this._audio.setPlaybackRate(e)},n.prototype.getCurrentTrackTime=function(){var e=0;return null!=this._audio&&(e=this._audio.currentTime),e},n.prototype.setDataSource=function(t){var n=this;null!=this._audio&&(this._audio.dispose(),this._audio=null);var o=this._spatialblend>=.1,i="logarithmic"===this._rolloffmode?"exponential":"linear",r=null!=this.transform.metadata&&null!=this.transform.metadata.vtt&&this.transform.metadata.vtt===!0;this._initializedReadyInstance=!1,this._audio=new e.Sound(this._name,t,this.scene,function(){n._lastmutedvolume=n._volume,n._audio.setVolume(n._mute===!0?0:n._volume),n._audio.setPlaybackRate(n._pitch),n._initializedReadyInstance=!0,n.onReadyObservable&&n.onReadyObservable.hasObservers()&&n.onReadyObservable.notifyObservers(n._audio),n._playonawake===!0&&n.play()},{loop:this._loop,autoplay:!1,refDistance:this._mindistance,maxDistance:this._maxdistance,rolloffFactor:e.AudioSource.DEFAULT_ROLLOFF,spatialSound:o,distanceModel:i,streaming:r}),this._audio.setPosition(this.transform.position.clone()),o===!0&&this._audio.attachToMesh(this.transform)},n.prototype.addPreloaderTasks=function(e){var t=this;if(this._preload===!0){var n=e.addBinaryFileTask(this.transform.name+".AudioTask",this._preloaderUrl);n.onSuccess=function(e){t.setDataSource(e.data)},n.onError=function(e,t,n){console.error(t,n)}}},n.MAX_VOLUME=1,n.DEFAULT_LEVEL=1,n.DEFAULT_ROLLOFF=1,n}(e.ScriptComponent);e.AudioSource=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),BABYLON;!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n._abstractMesh=null,n._avatarRadius=.5,n._avatarHeight=2,n._centerOffset=new e.Vector3(0,0,0),n._slopeLimit=45,n._skinWidth=.08,n._stepOffset=.3,n._capsuleSegments=16,n._minMoveDistance=.001,n._isPhysicsReady=!1,n._maxCollisions=4,n._createCylinderShape=!1,n._movementVelocity=new e.Vector3(0,0,0),n._tmpPositionBuffer=new e.Vector3(0,0,0),n._tmpCollisionContacts=null,n.updatePosition=!0,n.syncGhostToTransform=!0,n.onUpdatePositionObservable=new e.Observable,n.onCollisionEnterObservable=new e.Observable,n.onCollisionStayObservable=new e.Observable,n.onCollisionExitObservable=new e.Observable,n.m_character=null,n.m_ghostShape=null,n.m_ghostObject=null,n.m_ghostCollision=null,n.m_ghostTransform=null,n.m_ghostPosition=null,n.m_startPosition=null,n.m_startTransform=null,n.m_walkDirection=null,n.m_warpPosition=null,n.m_turningRate=0,n.m_moveDeltaX=0,n.m_moveDeltaZ=0,n.m_capsuleSize=e.Vector3.Zero(),n.m_physicsEngine=null,n.m_characterPosition=e.Vector3.Zero(),n}return __extends(n,t),n.prototype.preCreateCylinderShape=function(){this._createCylinderShape=!0},n.prototype.getInternalCharacter=function(){return this.m_character},n.prototype.getCollisionShape=function(){return this.m_ghostShape},n.prototype.getAvatarRadius=function(){return this._avatarRadius},n.prototype.getAvatarHeight=function(){return this._avatarHeight},n.prototype.getSkinWidth=function(){return this._skinWidth},n.prototype.getStepOffset=function(){return this._stepOffset},n.prototype.getCenterOffset=function(){return this._centerOffset},n.prototype.getCapsuleSize=function(){return this.m_capsuleSize},n.prototype.getMinMoveDistance=function(){return this._minMoveDistance},n.prototype.setMinMoveDistance=function(e){this._minMoveDistance=e},n.prototype.getVerticalVelocity=function(){return null!=this.m_character&&this.m_character.getVerticalVelocity?this.m_character.getVerticalVelocity():0},n.prototype.getAddedMargin=function(){return null!=this.m_character&&this.m_character.getAddedMargin?this.m_character.getAddedMargin():0},n.prototype.setAddedMargin=function(e){null!=this.m_character&&this.m_character.getAddedMargin&&this.m_character.setAddedMargin(e)},n.prototype.setMaxJumpHeight=function(e){null!=this.m_character&&this.m_character.setMaxJumpHeight(e)},n.prototype.setFallingSpeed=function(e){null!=this.m_character&&this.m_character.setFallSpeed(e)},n.prototype.getSlopeLimit=function(){return null!=this.m_character?this.m_character.getMaxSlope():0},n.prototype.setSlopeLimit=function(e){null!=this.m_character&&this.m_character.setMaxSlope(e)},n.prototype.setUpAxis=function(e){null!=this.m_character&&this.m_character.setUpAxis(e)},n.prototype.getGravity=function(){return null!=this.m_character?this.m_character.getGravity():0},n.prototype.setGravity=function(e){null!=this.m_character&&this.m_character.setGravity(e)},n.prototype.isGrounded=function(){return null!=this.m_character&&this.m_character.onGround()},n.prototype.isReady=function(){return null!=this.m_character},n.prototype.canJump=function(){return null!=this.m_character&&this.m_character.canJump()},n.prototype.syncMovementState=function(){this._isPhysicsReady===!0&&(this.m_ghostTransform=this.m_ghostObject.getWorldTransform(),null!=this.m_ghostTransform?this.m_ghostPosition=this.m_ghostTransform.getOrigin():this.m_ghostPosition=null)},n.prototype.syncTransformToGhostPosition=function(){this._isPhysicsReady===!0&&null!=this.m_ghostPosition&&(this.m_characterPosition.set(this.m_ghostPosition.x(),this.m_ghostPosition.y(),this.m_ghostPosition.z()),null!=this.transform.parent&&e.Utilities.InverseTransformDirectionToRef(this.transform.parent,this.m_characterPosition,this.m_characterPosition),null!=this._centerOffset&&this.m_characterPosition.subtractInPlace(this._centerOffset),this.transform.position.copyFrom(this.m_characterPosition))},n.prototype.syncGhostToTransformPosition=function(){this._isPhysicsReady===!0&&(this.m_characterPosition.copyFrom(this.transform.position),null!=this._centerOffset&&this.m_characterPosition.addInPlace(this._centerOffset),null!=this.transform.parent&&e.Utilities.TransformDirectionToRef(this.transform.parent,this.m_characterPosition,this.m_characterPosition),this.setGhostWorldPosition(this.m_characterPosition))},n.prototype.setGhostCollisionState=function(t){t===!0?this.m_ghostObject.setCollisionFlags(e.CollisionFlags.CF_CHARACTER_OBJECT):this.m_ghostObject.setCollisionFlags(e.CollisionFlags.CF_NO_CONTACT_RESPONSE)},n.prototype.internalWarp=function(e){null!=this.m_character&&this.m_character.warp(e)},n.prototype.internalJump=function(){null!=this.m_character&&this.m_character.jump()},n.prototype.internalSetJumpSpeed=function(e){null!=this.m_character&&this.m_character.setJumpSpeed(e)},n.prototype.internalSetWalkDirection=function(e){null!=this.m_character&&this.m_character.setWalkDirection(e)},n.prototype.internalSetVelocityForTimeInterval=function(e,t){null!=this.m_character&&this.m_character.setVelocityForTimeInterval(e,t)},n.prototype.awake=function(){this.awakeMovementState()},n.prototype.start=function(){this.startMovementState()},n.prototype.update=function(){this.updateMovementState()},n.prototype.destroy=function(){this.destroyMovementState()},n.prototype.awakeMovementState=function(){this._abstractMesh=this.getAbstractMesh(),this._avatarRadius=this.getProperty("avatarRadius",this._avatarRadius),this._avatarHeight=this.getProperty("avatarHeight",this._avatarHeight),this._slopeLimit=this.getProperty("slopeLimit",this._slopeLimit),this._skinWidth=this.getProperty("skinWidth",this._skinWidth),this._stepOffset=this.getProperty("stepOffset",this._stepOffset),this._minMoveDistance=this.getProperty("minMoveDistance",this._minMoveDistance),this._capsuleSegments=this.getProperty("capsuleSegments",this._capsuleSegments),this.m_warpPosition=new Ammo.btVector3(0,0,0),this.m_walkDirection=new Ammo.btVector3(0,0,0),this.m_physicsEngine=e.RigidbodyPhysics.GetPhysicsEngine(this.scene);var t=this.getProperty("centerOffset");null!=t&&(this._centerOffset=e.Utilities.ParseVector3(t))},n.prototype.startMovementState=function(){this.setupMovementState(),this.updateMovementState()},n.prototype.setupMovementState=function(){this.setMaxNotifications(this._maxCollisions);var t=e.RigidbodyPhysics.GetPhysicsWorld(this.scene);if(null!=t){var n=e.Utilities.GetAbsolutePosition(this.transform,this._centerOffset);this.m_startPosition=new Ammo.btVector3(n.x,n.y,n.z),this.m_startTransform=new Ammo.btTransform,this.m_startTransform.setIdentity(),this.m_startTransform.setOrigin(this.m_startPosition);var o=new e.Vector3(this._avatarRadius,this._avatarHeight,1);o.x*=Math.max(Math.abs(this.transform.scaling.x),Math.abs(this.transform.scaling.z)),o.y*=this.transform.scaling.y,this.m_capsuleSize.copyFrom(o);var i=e.Utilities.ShowDebugColliders(),r=e.Utilities.ColliderVisibility(),a=e.Utilities.ColliderRenderGroup();if(i===!0&&null==this.transform._debugCollider){var l=this.transform.name+".Debug",s=null;s=this._createCylinderShape===!0?e.MeshBuilder.CreateCylinder(l,{tessellation:this._capsuleSegments,subdivisions:8,height:o.y,diameter:2*o.x},this.scene):e.MeshBuilder.CreateCapsule(l,{tessellation:this._capsuleSegments,subdivisions:8,capSubdivisions:8,height:o.y,radius:o.x},this.scene),s.position.set(0,0,0),s.rotationQuaternion=this.transform.rotationQuaternion.clone(),s.setParent(this.transform),s.position.copyFrom(this._centerOffset),s.visibility=r,s.renderingGroupId=a,s.material=e.Utilities.GetColliderMaterial(this.scene),s.checkCollisions=!1,s.isPickable=!1,this.transform._debugCollider=s}this._createCylinderShape===!0?this.m_ghostShape=new Ammo.btCylinderShape(new Ammo.btVector3(this._avatarRadius,.5*this._avatarHeight,this._avatarRadius)):this.m_ghostShape=new Ammo.btCapsuleShape(this._avatarRadius,.5*this._avatarHeight),this.m_ghostShape.setMargin(this._skinWidth),this.m_ghostObject=new Ammo.btPairCachingGhostObject,this.m_ghostObject.setWorldTransform(this.m_startTransform),this.m_ghostObject.setCollisionShape(this.m_ghostShape),this.m_ghostObject.setCollisionFlags(e.CollisionFlags.CF_CHARACTER_OBJECT),this.m_ghostObject.setActivationState(4),this.m_ghostObject.activate(!0),this.m_ghostCollision=Ammo.castObject(this.m_ghostObject,Ammo.btCollisionObject),this.m_ghostCollision.entity=this._abstractMesh,this.m_character=new Ammo.btKinematicCharacterController(this.m_ghostObject,this.m_ghostShape,this._stepOffset),
this.m_character.setUseGhostSweepTest(!0),this.m_character.setUpInterpolate(!0),this.m_character.setGravity(e.System.Gravity3G),this.m_character.setMaxSlope(e.Tools.ToRadians(this._slopeLimit+1)),t.addCollisionObject(this.m_ghostObject,e.CollisionFilters.CharacterFilter,e.CollisionFilters.AllFilter),t.addAction(this.m_character)}else e.Tools.Warn("Null physics world detected. Failed to create character controller: "+this.transform.name);this._isPhysicsReady=null!=this.m_physicsEngine&&null!=this._tmpCollisionContacts&&null!=this.m_ghostObject&&null!=this._abstractMesh},n.prototype.updateMovementState=function(){this.syncMovementState(),this._isPhysicsReady===!0&&null!=this.m_ghostPosition&&(this.updatePosition===!0?this.syncTransformToGhostPosition():this.syncGhostToTransformPosition(),this.onUpdatePositionObservable&&this.onUpdatePositionObservable.hasObservers()&&this.onUpdatePositionObservable.notifyObservers(this.transform)),this.parseGhostCollisionContacts()},n.prototype.parseGhostCollisionContacts=function(){if(this._isPhysicsReady===!0){var e=!!this.onCollisionEnterObservable&&this.onCollisionEnterObservable.hasObservers(),t=!!this.onCollisionStayObservable&&this.onCollisionStayObservable.hasObservers(),n=!!this.onCollisionExitObservable&&this.onCollisionExitObservable.hasObservers();if(e||t||n){var o=0;for(o=0;o<this._tmpCollisionContacts.length;o++)this._tmpCollisionContacts[o].reset=!0;var i=this.m_ghostObject.getNumOverlappingObjects();if(i>this._maxCollisions&&(i=this._maxCollisions),i>0)for(o=0;o<i;o++){var r=this.m_ghostObject.getOverlappingObject(o);if(null!=r){var a=Ammo.castObject(r,Ammo.btCollisionObject);if(null!=a&&null!=a.entity&&a.isActive()){var l=-1,s=a.entity;for(o=0;o<this._tmpCollisionContacts.length;o++){var u=this._tmpCollisionContacts[o];if(null!=u.mesh&&u.mesh===s){u.state=1,u.reset=!1,l=o;break}}if(l===-1)for(o=0;o<this._tmpCollisionContacts.length;o++){var c=this._tmpCollisionContacts[o];if(null==c.mesh){c.mesh=s,c.state=0,c.reset=!1;break}}}}}for(o=0;o<this._tmpCollisionContacts.length;o++){var p=this._tmpCollisionContacts[o];p.reset===!0?(n&&null!=p.mesh&&this.onCollisionExitObservable.notifyObservers(p.mesh),p.mesh=null,p.state=0,p.reset=!1):0===p.state?e&&null!=p.mesh&&this.onCollisionEnterObservable.notifyObservers(p.mesh):t&&null!=p.mesh&&this.onCollisionStayObservable.notifyObservers(p.mesh)}}}},n.prototype.destroyMovementState=function(){this.m_physicsEngine=null,null!=this.m_character&&(Ammo.destroy(this.m_character),this.m_character=null),null!=this.m_ghostObject&&(Ammo.destroy(this.m_ghostObject),this.m_ghostObject=null),null!=this.m_ghostShape&&(Ammo.destroy(this.m_ghostShape),this.m_ghostShape=null),null!=this.m_ghostCollision&&(Ammo.destroy(this.m_ghostCollision),this.m_ghostCollision=null),null!=this.m_ghostPosition&&(Ammo.destroy(this.m_ghostPosition),this.m_ghostPosition=null),null!=this.m_ghostTransform&&(Ammo.destroy(this.m_ghostTransform),this.m_ghostTransform=null),null!=this.m_startPosition&&(Ammo.destroy(this.m_startPosition),this.m_startPosition=null),null!=this.m_startTransform&&(Ammo.destroy(this.m_startTransform),this.m_startTransform=null),null!=this.m_warpPosition&&(Ammo.destroy(this.m_warpPosition),this.m_warpPosition=null),null!=this.m_walkDirection&&(Ammo.destroy(this.m_walkDirection),this.m_walkDirection=null),this.onUpdatePositionObservable.clear(),this.onUpdatePositionObservable=null,this.onCollisionEnterObservable.clear(),this.onCollisionEnterObservable=null,this.onCollisionStayObservable.clear(),this.onCollisionStayObservable=null,this.onCollisionExitObservable.clear(),this.onCollisionExitObservable=null,this._tmpCollisionContacts=null,this._tmpPositionBuffer=null,this._abstractMesh=null},n.prototype.getLinearVelocity=function(t){var n=new e.Vector3(0,0,0);return this.getLinearVelocityToRef(t,n),n},n.prototype.getLinearVelocityToRef=function(t,n){var o=this.getVerticalVelocity()*t,i=e.Vector3.Up();i.scaleInPlace(o),n.set(this._movementVelocity.x,0,this._movementVelocity.z),n.addInPlace(i),n.x/=t,n.y/=t,n.z/=t},n.prototype.getGhostMargin=function(){var e=0;return null!=this.m_ghostShape&&this.m_ghostShape.getMargin&&(e=this.m_ghostShape.getMargin()),e},n.prototype.setGhostMargin=function(e){null!=this.m_ghostShape&&this.m_ghostShape.setMargin&&this.m_ghostShape.setMargin(e)},n.prototype.getUseSlopeSlidePatch=function(){var e=!1;return null!=this.m_character&&this.m_character.get_m_useSlopeSlidePatch&&(e=this.m_character.get_m_useSlopeSlidePatch()),e},n.prototype.setUseSlopeSlidePatch=function(e){null!=this.m_character&&this.m_character.set_m_useSlopeSlidePatch&&this.m_character.set_m_useSlopeSlidePatch(e)},n.prototype.setMaxNotifications=function(t){this._maxCollisions=t,this._tmpCollisionContacts=[];for(var n=0;n<this._maxCollisions;n++)this._tmpCollisionContacts.push(new e.CollisionContactInfo)},n.prototype.setActivationState=function(e){null!=this.m_ghostCollision&&this.m_ghostCollision.setActivationState&&this.m_ghostCollision.setActivationState(e)},n.prototype.getCollisionFilterGroup=function(){var e=-1;return null!=this.m_ghostCollision&&this.m_ghostCollision.getBroadphaseHandle&&(e=this.m_ghostCollision.getBroadphaseHandle().get_m_collisionFilterGroup()),e},n.prototype.setCollisionFilterGroup=function(e){null!=this.m_ghostCollision&&this.m_ghostCollision.getBroadphaseHandle&&this.m_ghostCollision.getBroadphaseHandle().set_m_collisionFilterGroup(e)},n.prototype.getCollisionFilterMask=function(){var e=-1;return null!=this.m_ghostCollision&&this.m_ghostCollision.getBroadphaseHandle&&(e=this.m_ghostCollision.getBroadphaseHandle().get_m_collisionFilterMask()),e},n.prototype.setCollisionFilterMask=function(e){null!=this.m_ghostCollision&&this.m_ghostCollision.getBroadphaseHandle&&this.m_ghostCollision.getBroadphaseHandle().set_m_collisionFilterMask(e)},n.prototype.getContactProcessingThreshold=function(){var e=-1;return null!=this.m_ghostCollision&&this.m_ghostCollision.getContactProcessingThreshold&&(e=this.m_ghostCollision.getContactProcessingThreshold()),e},n.prototype.setContactProcessingThreshold=function(e){null!=this.m_ghostCollision&&this.m_ghostCollision.setContactProcessingThreshold&&this.m_ghostCollision.setContactProcessingThreshold(e)},n.prototype.getGhostWorldPosition=function(){var t=new e.Vector3(0,0,0);return null!=this.m_ghostPosition&&t.set(this.m_ghostPosition.x(),this.m_ghostPosition.y(),this.m_ghostPosition.z()),t},n.prototype.getGhostWorldPositionToRef=function(e){null!=this.m_ghostPosition&&null!=e&&e.set(this.m_ghostPosition.x(),this.m_ghostPosition.y(),this.m_ghostPosition.z())},n.prototype.setGhostWorldPosition=function(e){null!=this.m_ghostObject&&null!=this.m_ghostTransform&&(null!=this.m_ghostPosition&&null!=e&&(this.m_ghostPosition.setValue(e.x,e.y,e.z),this.m_ghostTransform.setOrigin(this.m_ghostPosition)),this.m_ghostObject.setWorldTransform(this.m_ghostTransform))},n.prototype.scaleGhostCollisionShape=function(e,t,n){this.m_ghostShape.setLocalScaling(new Ammo.btVector3(e,t,n)),null!=this.transform._debugCollider&&null!=this.transform._debugCollider.scaling&&this.transform._debugCollider.scaling.set(e,t,n)},n.prototype.set=function(e,t,n){this._tmpPositionBuffer.set(e,t,n),this.setGhostWorldPosition(this._tmpPositionBuffer)},n.prototype.move=function(e){null!=e&&(this.m_moveDeltaX=e.x,this.m_moveDeltaZ=e.z,Math.abs(e.x)<this._minMoveDistance&&(e.x>0?this.m_moveDeltaX=this._minMoveDistance:e.x<0&&(this.m_moveDeltaX=-this._minMoveDistance)),Math.abs(e.z)<this._minMoveDistance&&(e.z>0?this.m_moveDeltaZ=this._minMoveDistance:e.z<0&&(this.m_moveDeltaZ=-this._minMoveDistance)),null!=this.m_walkDirection&&(this._movementVelocity.set(this.m_moveDeltaX,0,this.m_moveDeltaZ),this.m_walkDirection.setValue(this._movementVelocity.x,this._movementVelocity.y,this._movementVelocity.z),this.internalSetWalkDirection(this.m_walkDirection)))},n.prototype.jump=function(e){this.canJump()&&(this.internalSetJumpSpeed(e),this.internalJump())},n.prototype.warp=function(e){null!=this.m_warpPosition&&(this.m_warpPosition.setValue(e.x,e.y,e.z),this.internalWarp(this.m_warpPosition))},n}(e.ScriptComponent);e.CharacterController=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),BABYLON;!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.distanceToTarget=0,n.teleporting=!1,n.moveDirection=new e.Vector3(0,0,0),n.resetPosition=new e.Vector3(0,0,0),n.lastPosition=new e.Vector3(0,0,0),n.distancePosition=new e.Vector3(0,0,0),n.currentPosition=new e.Vector3(0,0,0),n.currentRotation=new e.Quaternion(0,0,0,1),n.currentVelocity=new e.Vector3(0,0,0),n.currentWaypoint=new e.Vector3(0,0,0),n.heightOffset=0,n.angularSpeed=0,n.updatePosition=!0,n.updateRotation=!0,n.distanceEpsilon=.1,n.velocityEpsilon=1.1,n.offMeshVelocity=1.5,n.stoppingDistance=0,n.onReadyObservable=new e.Observable,n.onPreUpdateObservable=new e.Observable,n.onPostUpdateObservable=new e.Observable,n.onNavCompleteObservable=new e.Observable,n.m_agentState=0,n.m_agentIndex=-1,n.m_agentReady=!1,n.m_agentGhost=null,n.m_agentParams=null,n.m_agentMovement=new e.Vector3(0,0,0),n.m_agentDirection=new e.Vector3(0,0,1),n.m_agentQuaternion=new e.Quaternion(0,0,0,1),n.m_agentDestination=null,n}return __extends(n,t),n.prototype.isReady=function(){return this.m_agentReady},n.prototype.isNavigating=function(){return null!=this.m_agentDestination},n.prototype.isTeleporting=function(){return this.teleporting},n.prototype.isOnOffMeshLink=function(){return this.m_agentState===e.CrowdAgentState.DT_CROWDAGENT_STATE_OFFMESH},n.prototype.getAgentType=function(){return this.type},n.prototype.getAgentState=function(){return this.m_agentState},n.prototype.getAgentIndex=function(){return this.m_agentIndex},n.prototype.getAgentOffset=function(){return this.baseOffset},n.prototype.getTargetDistance=function(){return this.distanceToTarget},n.prototype.getCurrentPosition=function(){return this.currentPosition},n.prototype.getCurrentRotation=function(){return this.currentRotation},n.prototype.getCurrentVelocity=function(){return this.currentVelocity},n.prototype.getAgentParameters=function(){return this.m_agentParams},n.prototype.setAgentParameters=function(e){this.m_agentParams=e,this.updateAgentParameters()},n.prototype.awake=function(){this.awakeNavigationAgent()},n.prototype.update=function(){this.updateNavigationAgent()},n.prototype.destroy=function(){this.destroyNavigationAgent()},n.prototype.awakeNavigationAgent=function(){this.type=this.getProperty("type",this.type),this.speed=this.getProperty("speed",this.speed),this.baseOffset=this.getProperty("offset",this.baseOffset),this.angularSpeed=this.getProperty("angularspeed",this.angularSpeed),this.acceleration=this.getProperty("acceleration",this.acceleration),this.stoppingDistance=this.getProperty("stoppingdistance",this.stoppingDistance),this.autoBraking=this.getProperty("autobraking",this.autoBraking),this.avoidRadius=this.getProperty("avoidradius",this.avoidRadius),this.avoidHeight=this.getProperty("avoidheight",this.avoidHeight),this.obstacleAvoidanceType=this.getProperty("avoidquality",this.obstacleAvoidanceType),this.avoidancePriority=this.getProperty("avoidpriority",this.avoidancePriority),this.autoTraverseOffMeshLink=this.getProperty("autotraverse",this.autoTraverseOffMeshLink),this.autoRepath=this.getProperty("autopepath",this.autoRepath),this.areaMask=this.getProperty("areamask",this.areaMask),e.Utilities.ValidateTransformQuaternion(this.transform),this.m_agentGhost=new e.TransformNode(this.transform.name+".Agent",this.scene),this.m_agentGhost.position=new e.Vector3(0,0,0),this.m_agentGhost.rotation=new e.Vector3(0,0,0),e.Utilities.ValidateTransformQuaternion(this.m_agentGhost),this.m_agentGhost.position.copyFrom(this.transform.position),this.lastPosition.copyFrom(this.transform.position)},n.prototype.updateNavigationAgent=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);if(null!=t){if(this.m_agentIndex<0)return this.m_agentParams={radius:this.avoidRadius,height:this.avoidHeight,maxSpeed:this.speed,maxAcceleration:this.acceleration,collisionQueryRange:2,pathOptimizationRange:20,separationWeight:1},e.Utilities.GetAbsolutePositionToRef(this.transform,this.resetPosition),this.m_agentIndex=t.addAgent(this.resetPosition,this.m_agentParams,this.m_agentGhost),void(this.m_agentIndex>=0&&(this.m_agentReady=!0,this.onReadyObservable&&this.onReadyObservable.hasObservers()&&this.onReadyObservable.notifyObservers(this.transform)));if(this.m_agentState=t.getAgentState(this.m_agentIndex),this.getAgentWaypointToRef(this.currentWaypoint),this.getAgentPositionToRef(this.currentPosition),this.distancePosition.copyFrom(this.currentPosition),this.isOnOffMeshLink()?(this.currentPosition.subtractToRef(this.lastPosition,this.currentVelocity),this.currentVelocity.scaleInPlace(this.speed*this.offMeshVelocity)):this.getAgentVelocityToRef(this.currentVelocity),this.onPreUpdateObservable&&this.onPreUpdateObservable.hasObservers()&&this.onPreUpdateObservable.notifyObservers(this.transform),this.currentPosition.y+=this.baseOffset+this.heightOffset,this.currentVelocity.length()>=this.velocityEpsilon){this.currentVelocity.normalize();var n=this.angularSpeed*e.NavigationAgent.ANGULAR_SPEED_RATIO*this.getDeltaSeconds();if(this.isOnOffMeshLink()){this.moveDirection.copyFrom(this.m_agentDirection),this.m_agentDirection.set(this.moveDirection.x+(this.currentVelocity.x-this.moveDirection.x),this.moveDirection.y+(this.currentVelocity.y-this.moveDirection.y),this.moveDirection.z+(this.currentVelocity.z-this.moveDirection.z)),this.m_agentDirection.normalize();var o=e.NavigationAgent.TARGET_ANGLE_FACTOR-Math.atan2(this.m_agentDirection.x,this.m_agentDirection.z);e.Quaternion.FromEulerAnglesToRef(0,o,0,this.currentRotation),this.isNavigating()&&this.updateRotation===!0&&e.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.currentRotation,n,this.transform.rotationQuaternion)}else this.m_agentQuaternion.copyFrom(this.transform.rotationQuaternion),this.isNavigating()&&this.updateRotation===!0&&this.transform.lookAt(this.currentWaypoint),this.transform.rotationQuaternion.toEulerAnglesToRef(this.m_agentDirection),e.Quaternion.FromEulerAnglesToRef(0,this.m_agentDirection.y,0,this.currentRotation),this.isNavigating()&&this.updateRotation===!0&&e.Quaternion.SlerpToRef(this.m_agentQuaternion,this.currentRotation,n,this.transform.rotationQuaternion)}this.isNavigating()&&this.updatePosition===!0&&this.transform.position.copyFrom(this.currentPosition),this.isNavigating()?(this.distanceToTarget=e.Vector3.Distance(this.distancePosition,this.m_agentDestination),this.distanceToTarget<=Math.max(this.distanceEpsilon,this.stoppingDistance)&&(this.cancelNavigation(),this.onNavCompleteObservable&&this.onNavCompleteObservable.hasObservers()&&this.onNavCompleteObservable.notifyObservers(this.transform))):this.distanceToTarget=0,this.lastPosition.copyFrom(this.currentPosition),this.onPostUpdateObservable&&this.onPostUpdateObservable.hasObservers()&&this.onPostUpdateObservable.notifyObservers(this.transform),this.teleporting=!1}},n.prototype.updateAgentParameters=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);null!=t&&this.m_agentIndex>=0&&t.updateAgentParameters(this.m_agentIndex,this.m_agentParams)},n.prototype.destroyNavigationAgent=function(){this.m_agentIndex=-1,this.m_agentReady=!1,this.m_agentMovement=null,this.m_agentDirection=null,this.m_agentDestination=null,this.moveDirection=null,this.resetPosition=null,this.lastPosition=null,this.currentPosition=null,this.currentRotation=null,this.currentVelocity=null,this.currentWaypoint=null,this.onReadyObservable.clear(),this.onReadyObservable=null,this.onPreUpdateObservable.clear(),this.onPreUpdateObservable=null,this.onPostUpdateObservable.clear(),this.onPostUpdateObservable=null,this.onNavCompleteObservable.clear(),this.onNavCompleteObservable=null,null!=this.m_agentGhost&&(this.m_agentGhost.dispose(),this.m_agentGhost=null)},n.prototype.move=function(t,n){void 0===n&&(n=!0);var o=e.SceneManager.GetNavigationTools(),i=e.SceneManager.GetCrowdInterface(this.scene);null!=o&&null!=i?(i.getAgentPosition(this.m_agentIndex).addToRef(t,this.m_agentMovement),n===!0?this.m_agentDestination=o.getClosestPoint(this.m_agentMovement):this.m_agentDestination=this.m_agentMovement.clone(),this.m_agentIndex>=0&&i.agentGoto(this.m_agentIndex,this.m_agentDestination)):e.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.teleport=function(t,n){void 0===n&&(n=!0);var o=e.SceneManager.GetNavigationTools(),i=e.SceneManager.GetCrowdInterface(this.scene);null!=o&&null!=i?(this.teleporting=!0,n===!0?this.m_agentDestination=o.getClosestPoint(t):this.m_agentDestination=t.clone(),this.m_agentIndex>=0&&i.agentTeleport(this.m_agentIndex,this.m_agentDestination)):e.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.setDestination=function(t,n){void 0===n&&(n=!0);var o=e.SceneManager.GetNavigationTools(),i=e.SceneManager.GetCrowdInterface(this.scene);null!=o&&null!=i?(n===!0?this.m_agentDestination=o.getClosestPoint(t):this.m_agentDestination=t.clone(),this.m_agentIndex>=0&&i.agentGoto(this.m_agentIndex,this.m_agentDestination)):e.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.getAgentVelocity=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);return null!=t&&this.m_agentIndex>=0?t.getAgentVelocity(this.m_agentIndex):null},n.prototype.getAgentVelocityToRef=function(t){var n=e.SceneManager.GetCrowdInterface(this.scene);null!=n&&this.m_agentIndex>=0&&n.getAgentVelocityToRef(this.m_agentIndex,t)},n.prototype.getAgentPosition=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);return null!=t&&this.m_agentIndex>=0?t.getAgentPosition(this.m_agentIndex):null},n.prototype.getAgentPositionToRef=function(t){var n=e.SceneManager.GetCrowdInterface(this.scene);null!=n&&this.m_agentIndex>=0&&n.getAgentPositionToRef(this.m_agentIndex,t)},n.prototype.getAgentWaypoint=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);return null!=t&&this.m_agentIndex>=0?t.getAgentNextTargetPath(this.m_agentIndex):null},n.prototype.getAgentWaypointToRef=function(t){var n=e.SceneManager.GetCrowdInterface(this.scene);null!=n&&this.m_agentIndex>=0&&n.getAgentNextTargetPathToRef(this.m_agentIndex,t)},n.prototype.cancelNavigation=function(){this.m_agentDestination=null;var t=e.SceneManager.GetCrowdInterface(this.scene),n=this.getAgentPosition();null!=n&&null!=t&&this.m_agentIndex>=0&&t.agentTeleport(this.m_agentIndex,n)},n.TARGET_ANGLE_FACTOR=.5*Math.PI,n.ANGULAR_SPEED_RATIO=.05,n}(e.ScriptComponent);e.NavigationAgent=t;var n;!function(e){e[e.DT_CROWDAGENT_STATE_INVALID=0]="DT_CROWDAGENT_STATE_INVALID",e[e.DT_CROWDAGENT_STATE_WALKING=1]="DT_CROWDAGENT_STATE_WALKING",e[e.DT_CROWDAGENT_STATE_OFFMESH=2]="DT_CROWDAGENT_STATE_OFFMESH"}(n=e.CrowdAgentState||(e.CrowdAgentState={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,n,o,i){void 0===i&&(i=null),this._centerMass=new e.Vector3(0,0,0),this._chassisMesh=null,this._tempVectorPos=new e.Vector3(0,0,0),this.lockedWheelIndexes=null,this.m_vehicle=null,this.m_vehicleTuning=null,this.m_vehicleRaycaster=null,this.m_vehicleColliders=null,this.m_tempTransform=null,this.m_tempPosition=null,this.m_wheelDirectionCS0=null,this.m_wheelAxleCS=null,this._chassisMesh=t,this._centerMass=o,this.m_vehicleTuning=new Ammo.btVehicleTuning,this.m_vehicleRaycaster=null!=Ammo.btSmoothVehicleRaycaster?new Ammo.btSmoothVehicleRaycaster(n):new Ammo.btDefaultVehicleRaycaster(n),this.m_vehicleColliders=null!=this._chassisMesh.metadata&&null!=this._chassisMesh.metadata.unity&&null!=this._chassisMesh.metadata.unity.wheels?this._chassisMesh.metadata.unity.wheels:null,this.m_vehicle=new Ammo.btRaycastVehicle(this.m_vehicleTuning,this._chassisMesh.physicsImpostor.physicsBody,this.m_vehicleRaycaster),this.m_vehicle.setCoordinateSystem(0,1,2),this.m_wheelDirectionCS0=new Ammo.btVector3(0,(-1),0),this.m_wheelAxleCS=new Ammo.btVector3((-1),0,0),this.m_tempPosition=null,this.m_tempTransform=null,this.setupWheelInformation(i),n.addAction(this.m_vehicle)}return t.prototype.getCenterMassOffset=function(){return this._centerMass},t.prototype.getInternalVehicle=function(){return this.m_vehicle},t.prototype.getUpAxis=function(){if(null!=this.m_vehicle)return this.m_vehicle.getUpAxis()},t.prototype.getRightAxis=function(){if(null!=this.m_vehicle)return this.m_vehicle.getRightAxis()},t.prototype.getForwardAxis=function(){if(null!=this.m_vehicle)return this.m_vehicle.getForwardAxis()},t.prototype.getForwardVector=function(){if(null!=this.m_vehicle)return this.m_vehicle.getForwardVector()},t.prototype.getNumWheels=function(){if(null!=this.m_vehicle)return this.m_vehicle.getNumWheels()},t.prototype.getWheelInfo=function(e){if(null!=this.m_vehicle)return this.m_vehicle.getWheelInfo(e)},t.prototype.resetSuspension=function(){null!=this.m_vehicle&&this.m_vehicle.resetSuspension()},t.prototype.setPitchControl=function(e){null!=this.m_vehicle&&this.m_vehicle.setPitchControl(e)},t.prototype.setEngineForce=function(e,t){null!=this.m_vehicle&&this.m_vehicle.applyEngineForce(e,t)},t.prototype.setBrakingForce=function(e,t){null!=this.m_vehicle&&this.m_vehicle.setBrake(e,t)},t.prototype.getWheelTransform=function(e){if(null!=this.m_vehicle)return this.m_vehicle.getWheelTransformWS(e)},t.prototype.updateWheelTransform=function(e,t){null!=this.m_vehicle&&this.m_vehicle.updateWheelTransform(e,t)},t.prototype.getUserConstraintType=function(){if(null!=this.m_vehicle)return this.m_vehicle.getUserConstraintType()},t.prototype.setUserConstraintType=function(e){null!=this.m_vehicle&&this.m_vehicle.setUserConstraintType(e)},t.prototype.setUserConstraintId=function(e){null!=this.m_vehicle&&this.m_vehicle.setUserConstraintId(e)},t.prototype.getUserConstraintId=function(){if(null!=this.m_vehicle)return this.m_vehicle.getUserConstraintId()},t.prototype.getRawCurrentSpeedKph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()},t.prototype.getRawCurrentSpeedMph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()*e.System.Kph2Mph},t.prototype.getAbsCurrentSpeedKph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())},t.prototype.getAbsCurrentSpeedMph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())*e.System.Kph2Mph},t.prototype.getVehicleTuningSystem=function(){return this.m_vehicleTuning},t.prototype.getChassisWorldTransform=function(){if(null!=this.m_vehicle)return this.m_vehicle.getChassisWorldTransform()},t.prototype.dispose=function(){this.deleteWheelInformation(),null!=this.m_vehicle&&(Ammo.destroy(this.m_vehicle),this.m_vehicle=null),null!=this.m_vehicleTuning&&(Ammo.destroy(this.m_vehicleTuning),this.m_vehicleTuning=null),null!=this.m_vehicleRaycaster&&(Ammo.destroy(this.m_vehicleRaycaster),this.m_vehicleRaycaster=null),null!=this.m_wheelDirectionCS0&&(Ammo.destroy(this.m_wheelDirectionCS0),this.m_wheelDirectionCS0=null),null!=this.m_wheelAxleCS&&(Ammo.destroy(this.m_wheelAxleCS),this.m_wheelAxleCS=null),null!=this.m_tempPosition&&(this.m_tempPosition=null),null!=this.m_tempTransform&&(this.m_tempTransform=null),this.m_vehicleColliders=null},t.GetInstance=function(t,n,o){void 0===o&&(o=null);var i=n;return null==i.m_raycastVehicle&&(n.hasWheelColliders()?i.m_raycastVehicle=new e.RaycastVehicle(i._abstractMesh,i.m_physicsWorld,i._centerOfMass,o):e.Tools.Warn("No wheel collider metadata found for: "+i._abstractMesh.name)),i.m_raycastVehicle},t.prototype.getEnableMultiRaycast=function(){var e=!1;return null!=this.m_vehicle&&this.m_vehicle.get_m_enableMultiRaycast&&(e=this.m_vehicle.get_m_enableMultiRaycast()),e},t.prototype.setEnableMultiRaycast=function(e){null!=this.m_vehicle&&this.m_vehicle.set_m_enableMultiRaycast&&this.m_vehicle.set_m_enableMultiRaycast(e)},t.prototype.getStabilizingForce=function(){var e=-1;return null!=this.m_vehicle&&this.m_vehicle.get_m_stabilizingForce&&(e=this.m_vehicle.get_m_stabilizingForce()),e},t.prototype.setStabilizingForce=function(e){null!=this.m_vehicle&&this.m_vehicle.set_m_stabilizingForce&&this.m_vehicle.set_m_stabilizingForce(e)},t.prototype.getMaxImpulseForce=function(){var e=-1;return null!=this.m_vehicle&&this.m_vehicle.get_m_maxImpulseForce&&(e=this.m_vehicle.get_m_maxImpulseForce()),e},t.prototype.setMaxImpulseForce=function(e){null!=this.m_vehicle&&this.m_vehicle.set_m_maxImpulseForce&&this.m_vehicle.set_m_maxImpulseForce(e)},t.prototype.getSmoothFlyingImpulse=function(){var e=-1;return null!=this.m_vehicle&&this.m_vehicle.get_m_smoothFlyingImpulse&&(e=this.m_vehicle.get_m_smoothFlyingImpulse()),e},t.prototype.setSmoothFlyingImpulse=function(e){null!=this.m_vehicle&&this.m_vehicle.set_m_smoothFlyingImpulse&&this.m_vehicle.set_m_smoothFlyingImpulse(e)},t.prototype.getTrackConnectionAccel=function(){var e=-1;return null!=this.m_vehicle&&this.m_vehicle.get_m_trackConnectionAccel&&(e=this.m_vehicle.get_m_trackConnectionAccel()),e},t.prototype.setTrackConnectionAccel=function(e){null!=this.m_vehicle&&this.m_vehicle.set_m_trackConnectionAccel&&this.m_vehicle.set_m_trackConnectionAccel(e)},t.prototype.getMinimumWheelContacts=function(){var e=-1;return null!=this.m_vehicle&&this.m_vehicle.get_m_minimumWheelContacts&&(e=this.m_vehicle.get_m_minimumWheelContacts()),e},t.prototype.setMinimumWheelContacts=function(e){null!=this.m_vehicle&&this.m_vehicle.set_m_minimumWheelContacts&&this.m_vehicle.set_m_minimumWheelContacts(e)},t.prototype.getInterpolateNormals=function(){var e=!1;return null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.get_m_interpolateNormals&&(e=this.m_vehicleRaycaster.get_m_interpolateNormals()),e},t.prototype.setInterpolateNormals=function(e){null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.set_m_interpolateNormals&&this.m_vehicleRaycaster.set_m_interpolateNormals(e)},t.prototype.getShapeTestingMode=function(){var e=!1;return null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.get_m_shapeTestingMode&&(e=this.m_vehicleRaycaster.get_m_shapeTestingMode()),e},t.prototype.setShapeTestingMode=function(e){null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.set_m_shapeTestingMode&&this.m_vehicleRaycaster.set_m_shapeTestingMode(e)},t.prototype.getShapeTestingSize=function(){var e=0;return null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.get_m_shapeTestingSize&&(e=this.m_vehicleRaycaster.get_m_shapeTestingSize()),e},t.prototype.setShapeTestingSize=function(e){null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.set_m_shapeTestingSize&&this.m_vehicleRaycaster.set_m_shapeTestingSize(e)},t.prototype.getShapeTestingCount=function(){var e=0;return null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.get_m_testPointCount&&(e=this.m_vehicleRaycaster.get_m_testPointCount()),e},t.prototype.setShapeTestingCount=function(e){null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.set_m_testPointCount&&this.m_vehicleRaycaster.set_m_testPointCount(e)},t.prototype.getSweepPenetration=function(){var e=0;return null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.get_m_sweepPenetration&&(e=this.m_vehicleRaycaster.get_m_sweepPenetration()),e},t.prototype.setSweepPenetration=function(e){null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.set_m_sweepPenetration&&this.m_vehicleRaycaster.set_m_sweepPenetration(e)},t.prototype.getCollisionFilterGroup=function(){var e=-1;return null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.get_m_collisionFilterGroup&&(e=this.m_vehicleRaycaster.get_m_collisionFilterGroup()),e},t.prototype.setCollisionFilterGroup=function(e){null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.set_m_collisionFilterGroup&&this.m_vehicleRaycaster.set_m_collisionFilterGroup(e)},t.prototype.getCollisionFilterMask=function(){var e=-1;return null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.get_m_collisionFilterMask&&(e=this.m_vehicleRaycaster.get_m_collisionFilterMask()),e},t.prototype.setCollisionFilterMask=function(e){null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.set_m_collisionFilterMask&&this.m_vehicleRaycaster.set_m_collisionFilterMask(e)},t.prototype.getWheelIndexByID=function(e){var t=-1;if(null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0)for(var n=0;n<this.m_vehicleColliders.length;n++){var o=this.m_vehicleColliders[n];if(e.toLowerCase()===o.id.toLowerCase()){t=n;break}}return t},t.prototype.getWheelIndexByName=function(e){var t=-1;if(null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0)for(var n=0;n<this.m_vehicleColliders.length;n++){var o=this.m_vehicleColliders[n];if(e.toLowerCase()===o.name.toLowerCase()){t=n;break}}return t},t.prototype.getWheelColliderInfo=function(e){var t=-1;return null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0&&this.m_vehicleColliders.length>e&&(t=this.m_vehicleColliders[e]),t},t.prototype.setWheelTransformMesh=function(e,t){if(null!=t){var n=this.getWheelInfo(e);null!=n&&(n.transform=t)}},t.prototype.getVisualSteeringAngle=function(e){var t=0,n=this.getWheelInfo(e);return null!=n&&null!=n.steeringAngle&&(t=n.steeringAngle),t},t.prototype.setVisualSteeringAngle=function(e,t){var n=this.getWheelInfo(t);null!=n&&(n.steeringAngle=e)},t.prototype.getPhysicsSteeringAngle=function(e){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getSteeringValue(e))},t.prototype.setPhysicsSteeringAngle=function(e,t){null!=this.m_vehicle&&this.m_vehicle.setSteeringValue(e,t)},t.prototype.setupWheelInformation=function(t){if(void 0===t&&(t=null),null!=this._chassisMesh&&null!=this._chassisMesh.physicsImpostor&&null!=this._chassisMesh.physicsImpostor.physicsBody&&(null!=t&&(null==e.RaycastVehicle.TempAmmoVector&&(e.RaycastVehicle.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RaycastVehicle.TempAmmoVector.setValue(t.x,t.y,t.z),this._chassisMesh.physicsImpostor.physicsBody.setAngularFactor(e.RaycastVehicle.TempAmmoVector)),this._chassisMesh.physicsImpostor.physicsBody.setActivationState(e.CollisionState.DISABLE_DEACTIVATION)),null!=this.m_vehicle&&null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0){var n=-1;for(n=0;n<this.m_vehicleColliders.length;n++){var o=this.m_vehicleColliders[n],i=null!=o.name?o.name:"Unknown",r=null!=o.radius?o.radius:.35,a=null!=o.position&&o.position.length>=3?o.position[0]:1,l=null!=o.position&&o.position.length>=3?o.position[2]:-1,s=null!=o.wheelconnectionpoint?o.wheelconnectionpoint:.5,u=null!=o.suspensionrestlength?o.suspensionrestlength:.3,c=null!=o.frontwheel||i.toLowerCase().indexOf("front")>=0,p=l,h=a,d=-this._centerMass.x,m=-this._centerMass.z;null==e.RaycastVehicle.TempAmmoVector&&(e.RaycastVehicle.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RaycastVehicle.TempAmmoVector.setValue(h+d,s,p+m),this.m_vehicle.addWheel(e.RaycastVehicle.TempAmmoVector,this.m_wheelDirectionCS0,this.m_wheelAxleCS,u,r,this.m_vehicleTuning,c)}if(this.m_vehicle.getNumWheels()===this.m_vehicleColliders.length)for(n=0;n<this.m_vehicleColliders.length;n++){var o=this.m_vehicleColliders[n],g=null!=o.totalsuspensionforces?o.totalsuspensionforces:25e3,f=null!=o.suspensiontravelcm?o.suspensiontravelcm:100,y=null!=o.rollinfluence?o.rollinfluence:.2,_=null!=o.frictionslip?o.frictionslip:10,v=null!=o.suspensionstiffness?o.suspensionstiffness:50,b=null!=o.dampingcompression?o.dampingcompression:2.5,C=null!=o.dampingrelaxation?o.dampingrelaxation:4.5,T=this.m_vehicle.getWheelInfo(n);null!=T&&(T.steeringAngle=0,T.rotationBoost=0,
T.defaultFriction=_,T.set_m_frictionSlip(_),T.set_m_rollInfluence(y),T.set_m_maxSuspensionForce(g),T.set_m_maxSuspensionTravelCm(f),T.set_m_suspensionStiffness(v),T.set_m_wheelsDampingCompression(b),T.set_m_wheelsDampingRelaxation(C))}else e.Tools.Warn("Failed to create proper number of wheels for: "+this._chassisMesh.name)}},t.prototype.updateWheelInformation=function(){var t=this.getNumWheels();if(t>0)for(var n=0;n<t;n++){var o=this.getWheelInfo(n);if(null!=o){var i=this.lockedWheelInformation(n);if(this.updateWheelTransform(n,!1),this.m_tempTransform=this.getWheelTransform(n),this.m_tempPosition=this.m_tempTransform.getOrigin(),null!=o.transform){var r=o.transform;if(null!=r.parent){e.RigidbodyPhysics.ConvertAmmoVector3ToRef(this.m_tempPosition,this._tempVectorPos),e.Utilities.InverseTransformPointToRef(r.parent,this._tempVectorPos,this._tempVectorPos),r.position.y=this._tempVectorPos.y;var a=null!=o.steeringAngle?o.steeringAngle:0;if(e.Quaternion.FromEulerAnglesToRef(0,a,0,r.rotationQuaternion),null!=o.spinner&&o.spinner.addRotation&&i===!1){var l=0,s=null!=o.get_m_deltaRotation?o.get_m_deltaRotation():0,u=null!=o.rotationBoost?o.rotationBoost:0;l=s<0?s+-u:s+u,o.spinner.addRotation(l,0,0)}}}}}},t.prototype.lockedWheelInformation=function(e){var t=!1;if(null!=this.lockedWheelIndexes&&this.lockedWheelIndexes.length>0)for(var n=0;n<this.lockedWheelIndexes.length;n++)if(this.lockedWheelIndexes[n]===e){t=!0;break}return t},t.prototype.deleteWheelInformation=function(){var e=this.getNumWheels();if(e>0)for(var t=0;t<e;t++){var n=this.getWheelInfo(t);null!=n&&(null!=n.transform&&delete n.transform,null!=n.spinner&&delete n.spinner,null!=n.steeringAngle&&delete n.steeringAngle,null!=n.rotationBoost&&delete n.rotationBoost,null!=n.defaultFriction&&delete n.defaultFriction)}},t.TempAmmoVector=null,t}();e.RaycastVehicle=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),BABYLON;!function(e){var t=function(t){function o(){var n=null!==t&&t.apply(this,arguments)||this;return n._abstractMesh=null,n._isKinematic=!1,n._maxCollisions=4,n._isPhysicsReady=!1,n._collisionObject=null,n._centerOfMass=new e.Vector3(0,0,0),n._tmpLinearFactor=new e.Vector3(0,0,0),n._tmpAngularFactor=new e.Vector3(0,0,0),n._tmpCenterOfMass=new e.Vector3(0,0,0),n._tmpCollisionContacts=null,n.onCollisionEnterObservable=new e.Observable,n.onCollisionStayObservable=new e.Observable,n.onCollisionExitObservable=new e.Observable,n.m_physicsWorld=null,n.m_physicsEngine=null,n.m_raycastVehicle=null,n}return __extends(o,t),Object.defineProperty(o.prototype,"isKinematic",{get:function(){return this._isKinematic},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"centerOfMass",{get:function(){return this._centerOfMass},enumerable:!1,configurable:!0}),o.prototype.awake=function(){this.awakeRigidbodyState()},o.prototype.update=function(){this.updateRigidbodyState()},o.prototype.after=function(){this.afterRigidbodyState()},o.prototype.destroy=function(){this.destroyRigidbodyState()},o.prototype.awakeRigidbodyState=function(){this._abstractMesh=this.getAbstractMesh(),this._isKinematic=this.getProperty("isKinematic",this._isKinematic),this.m_physicsWorld=e.RigidbodyPhysics.GetPhysicsWorld(this.scene),this.m_physicsEngine=e.RigidbodyPhysics.GetPhysicsEngine(this.scene),null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.physics&&(this._centerOfMass=null!=this.transform.metadata.unity.physics.center?e.Utilities.ParseVector3(this.transform.metadata.unity.physics.center,this._centerOfMass):this._centerOfMass),this.setMaxNotifications(this._maxCollisions),e.Utilities.ValidateTransformQuaternion(this.transform),this._isPhysicsReady=null!=this.m_physicsEngine&&null!=this._tmpCollisionContacts&&null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody,this.resetBodyCollisionContacts()},o.prototype.updateRigidbodyState=function(){this.syncronizeVehicleController()},o.prototype.afterRigidbodyState=function(){this.parseBodyCollisionContacts(),this.resetBodyCollisionContacts()},o.prototype.destroyRigidbodyState=function(){this.m_physicsWorld=null,this.m_physicsEngine=null,null!=this.m_raycastVehicle&&(this.m_raycastVehicle.dispose&&this.m_raycastVehicle.dispose(),this.m_raycastVehicle=null),this.onCollisionEnterObservable.clear(),this.onCollisionEnterObservable=null,this.onCollisionStayObservable.clear(),this.onCollisionStayObservable=null,this.onCollisionExitObservable.clear(),this.onCollisionExitObservable=null,this._tmpCollisionContacts=null,this._collisionObject=null,this._abstractMesh=null},o.prototype.syncronizeVehicleController=function(){null!=this.m_raycastVehicle&&this.m_raycastVehicle.updateWheelInformation&&this.m_raycastVehicle.updateWheelInformation()},o.prototype.parseBodyCollisionContacts=function(){if(this._isPhysicsReady===!0){var e=!!this.onCollisionEnterObservable&&this.onCollisionEnterObservable.hasObservers(),t=!!this.onCollisionStayObservable&&this.onCollisionStayObservable.hasObservers(),n=!!this.onCollisionExitObservable&&this.onCollisionExitObservable.hasObservers();if(e||t||n){var o=0;for(o=0;o<this._tmpCollisionContacts.length;o++)this._tmpCollisionContacts[o].reset=!0;var i=0;if(null!=this._abstractMesh.physicsImpostor.tmpCollisionObjects){var r=this._abstractMesh.physicsImpostor.tmpCollisionObjects;for(var a in r){var l=-1,s=r[a];for(o=0;o<this._tmpCollisionContacts.length;o++){var u=this._tmpCollisionContacts[o];if(null!=u.mesh&&u.mesh===s){u.state=1,u.reset=!1,l=o;break}}if(l===-1)for(o=0;o<this._tmpCollisionContacts.length;o++){var c=this._tmpCollisionContacts[o];if(null==c.mesh){c.mesh=s,c.state=0,c.reset=!1;break}}if(i++,i>this._maxCollisions)break}}for(o=0;o<this._tmpCollisionContacts.length;o++){var p=this._tmpCollisionContacts[o];p.reset===!0?(n&&null!=p.mesh&&this.onCollisionExitObservable.notifyObservers(p.mesh),p.mesh=null,p.state=0,p.reset=!1):0===p.state?e&&null!=p.mesh&&this.onCollisionEnterObservable.notifyObservers(p.mesh):t&&null!=p.mesh&&this.onCollisionStayObservable.notifyObservers(p.mesh)}}}},o.prototype.resetBodyCollisionContacts=function(){if(this._isPhysicsReady===!0){var e=!!this.onCollisionEnterObservable&&this.onCollisionEnterObservable.hasObservers(),t=!!this.onCollisionStayObservable&&this.onCollisionStayObservable.hasObservers(),n=!!this.onCollisionExitObservable&&this.onCollisionExitObservable.hasObservers();e||t||n?this._abstractMesh.physicsImpostor.tmpCollisionObjects={}:this._abstractMesh.physicsImpostor.tmpCollisionObjects=null}},o.prototype.setGravity=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.setGravity&&null!=t&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.setGravity(e.RigidbodyPhysics.TempAmmoVector))},o.prototype.getGravity=function(){var t=new e.Vector3(0,0,0);return this.getGravityToRef(t),t},o.prototype.getGravityToRef=function(t){if(null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getGravity){var n=this._abstractMesh.physicsImpostor.physicsBody.getGravity();e.RigidbodyPhysics.ConvertAmmoVector3ToRef(n,t)}},o.prototype.getMass=function(){var e=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&(e=this._abstractMesh.physicsImpostor.mass),e},o.prototype.setMass=function(e){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&this._abstractMesh.physicsImpostor.mass!==e&&(this._abstractMesh.physicsImpostor.mass=e)},o.prototype.getFriction=function(){var e=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&(e=this._abstractMesh.physicsImpostor.friction),e},o.prototype.setFriction=function(e){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&this._abstractMesh.physicsImpostor.friction!==e&&(this._abstractMesh.physicsImpostor.friction=e)},o.prototype.getRestitution=function(){var e=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&(e=this._abstractMesh.physicsImpostor.restitution),e},o.prototype.setRestitution=function(e){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&this._abstractMesh.physicsImpostor.restitution!==e&&(this._abstractMesh.physicsImpostor.restitution=e)},o.prototype.getLinearVelocity=function(){var e=null;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&(e=this._abstractMesh.physicsImpostor.getLinearVelocity()),e},o.prototype.setLinearVelocity=function(e){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=e&&this._abstractMesh.physicsImpostor.setLinearVelocity(e)},o.prototype.getAngularVelocity=function(){var e=null;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&(e=this._abstractMesh.physicsImpostor.getAngularVelocity()),e},o.prototype.setAngularVelocity=function(e){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=e&&this._abstractMesh.physicsImpostor.setAngularVelocity(e)},o.prototype.getWorldTransform=function(){var e=null;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(null==this._collisionObject&&(this._collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject)),null!=this._collisionObject&&this._collisionObject.getWorldTransform&&(e=this._collisionObject.getWorldTransform())),e},o.prototype.setWorldTransform=function(e){var t=null;if(null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(null==this._collisionObject&&(this._collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject)),null!=this._collisionObject&&this._collisionObject.setWorldTransform&&this._collisionObject.setWorldTransform(e),0===this._abstractMesh.physicsImpostor.mass&&this._abstractMesh.physicsImpostor.physicsBody.getMotionState)){var n=this._abstractMesh.physicsImpostor.physicsBody.getMotionState();null!=n&&n.setWorldTransform&&n.setWorldTransform(e)}return t},o.prototype.clearForces=function(){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.clearForces&&this._abstractMesh.physicsImpostor.physicsBody.clearForces()},o.prototype.applyTorque=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyTorque&&null!=t&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyTorque(e.RigidbodyPhysics.TempAmmoVector))},o.prototype.applyLocalTorque=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyLocalTorque&&null!=t&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyLocalTorque(e.RigidbodyPhysics.TempAmmoVector))},o.prototype.applyImpulse=function(t,n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyImpulse&&null!=t&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TempAmmoVectorAux&&(e.RigidbodyPhysics.TempAmmoVectorAux=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),e.RigidbodyPhysics.TempAmmoVectorAux.setValue(n.x,n.y,n.z),this._abstractMesh.physicsImpostor.physicsBody.applyImpulse(e.RigidbodyPhysics.TempAmmoVector,e.RigidbodyPhysics.TempAmmoVectorAux))},o.prototype.applyCentralImpulse=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralImpulse&&null!=t&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralImpulse(e.RigidbodyPhysics.TempAmmoVector))},o.prototype.applyTorqueImpulse=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyTorqueImpulse&&null!=t&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyTorqueImpulse(e.RigidbodyPhysics.TempAmmoVector))},o.prototype.applyForce=function(t,n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyForce&&null!=t&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TempAmmoVectorAux&&(e.RigidbodyPhysics.TempAmmoVectorAux=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),e.RigidbodyPhysics.TempAmmoVectorAux.setValue(n.x,n.y,n.z),this._abstractMesh.physicsImpostor.physicsBody.applyForce(e.RigidbodyPhysics.TempAmmoVector,e.RigidbodyPhysics.TempAmmoVectorAux))},o.prototype.applyCentralForce=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralForce&&null!=t&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralForce(e.RigidbodyPhysics.TempAmmoVector))},o.prototype.applyCentralLocalForce=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralLocalForce&&null!=t&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralLocalForce(e.RigidbodyPhysics.TempAmmoVector))},o.prototype.getCenterOfMassTransform=function(){if(null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getCenterOfMassTransform){var e=this._abstractMesh.physicsImpostor.physicsBody.getCenterOfMassTransform(),t=e.getOrigin();this._tmpCenterOfMass.set(t.x(),t.y(),t.z())}return this._tmpCenterOfMass},o.prototype.setCenterOfMassTransform=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.setCenterOfMassTransform&&null!=t&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),null==e.RigidbodyPhysics.TempCenterTransform&&(e.RigidbodyPhysics.TempCenterTransform=new Ammo.btTransform),e.RigidbodyPhysics.TempCenterTransform.setIdentity(),e.RigidbodyPhysics.TempCenterTransform.setOrigin(e.RigidbodyPhysics.TempAmmoVector),this._abstractMesh.physicsImpostor.physicsBody.setCenterOfMassTransform(e.RigidbodyPhysics.TempCenterTransform))},o.prototype.getLinearFactor=function(){if(null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getLinearFactor){var e=this._abstractMesh.physicsImpostor.physicsBody.getLinearFactor();this._tmpLinearFactor.set(e.x(),e.y(),e.z())}return this._tmpLinearFactor},o.prototype.setLinearFactor=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.setLinearFactor&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.setLinearFactor(e.RigidbodyPhysics.TempAmmoVector))},o.prototype.getAngularFactor=function(){if(null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getAngularFactor){var e=this._abstractMesh.physicsImpostor.physicsBody.getAngularFactor();this._tmpAngularFactor.set(e.x(),e.y(),e.z())}return this._tmpAngularFactor},o.prototype.setAngularFactor=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.setAngularFactor&&(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.setAngularFactor(e.RigidbodyPhysics.TempAmmoVector))},o.prototype.getAngularDamping=function(){var e=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getAngularDamping&&(e=this._abstractMesh.physicsImpostor.physicsBody.getAngularDamping()),e},o.prototype.getLinearDamping=function(){var e=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getLinearDamping&&(e=this._abstractMesh.physicsImpostor.physicsBody.getLinearDamping()),e},o.prototype.setDamping=function(e,t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.setDamping&&this._abstractMesh.physicsImpostor.physicsBody.setDamping(e,t)},o.prototype.setSleepingThresholds=function(e,t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.setSleepingThresholds&&this._abstractMesh.physicsImpostor.physicsBody.setSleepingThresholds(e,t)},o.prototype.hasWheelColliders=function(){return this._isPhysicsReady===!0&&null!=this._abstractMesh.metadata&&null!=this._abstractMesh.metadata.unity&&null!=this._abstractMesh.metadata.unity.wheels},o.prototype.setMaxNotifications=function(e){this._maxCollisions=e,this._tmpCollisionContacts=[];for(var t=0;t<this._maxCollisions;t++)this._tmpCollisionContacts.push(new n)},o.prototype.setActivationState=function(e){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(null==this._collisionObject&&(this._collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject)),null!=this._collisionObject&&this._collisionObject.setActivationState&&this._collisionObject.setActivationState(e))},o.prototype.getCollisionFilterGroup=function(){var e=-1;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&(e=this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().get_m_collisionFilterGroup()),e},o.prototype.setCollisionFilterGroup=function(e){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().set_m_collisionFilterGroup(e)},o.prototype.getCollisionFilterMask=function(){var e=-1;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&(e=this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().get_m_collisionFilterMask()),e},o.prototype.setCollisionFilterMask=function(e){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().set_m_collisionFilterMask(e)},o.prototype.getCollisionShapeType=function(){var e=-1;if(null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(null==this._collisionObject&&(this._collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject)),null!=this._collisionObject)){var t=this._collisionObject.getCollisionShape();null!=t&&t.getShapeType&&(e=t.getShapeType())}return e},o.prototype.getCollisionShapeMargin=function(){var e=-1;if(null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(null==this._collisionObject&&(this._collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject)),null!=this._collisionObject)){var t=this._collisionObject.getCollisionShape();null!=t&&t.getMargin&&(e=t.getMargin())}return e},o.prototype.setCollisionShapeMargin=function(e){if(null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(null==this._collisionObject&&(this._collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject)),null!=this._collisionObject)){var t=this._collisionObject.getCollisionShape();null!=t&&t.setMargin&&t.setMargin(e)}},o.prototype.setContactProcessingThreshold=function(e){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(null==this._collisionObject&&(this._collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject)),null!=this._collisionObject&&this._collisionObject.setContactProcessingThreshold&&this._collisionObject.setContactProcessingThreshold(e))},o.CreatePhysicsMetadata=function(t,n,o,i){void 0===n&&(n=0),void 0===o&&(o=.05),void 0===i&&(i=null);var r=null!=i?i:new e.Vector3(0,0,0);return{type:"rigidbody",mass:t,ldrag:n,adrag:o,center:{x:r.x,y:r.y,z:r.z}}},o.CreateCollisionMetadata=function(e,t,n,o,i,r){return void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===o&&(o=0),void 0===i&&(i=.6),void 0===r&&(r=.6),{type:e,trigger:t,convexmesh:n,restitution:o,dynamicfriction:i,staticfriction:r,wheelinformation:null}},o.CreatePhysicsProperties=function(e,t,n,o,i){return void 0===t&&(t=0),void 0===n&&(n=.05),void 0===o&&(o=!0),void 0===i&&(i=!1),{mass:e,drag:t,angularDrag:n,useGravity:o,isKinematic:i}},o.SetupPhysicsComponent=function(t,n){var o=null!=n.metadata&&null!=n.metadata.unity?n.metadata.unity:null;if(null!=o&&(null!=o.physics||null!=o.collision)){var i=e.Utilities.ShowDebugColliders(),r=(e.Utilities.ColliderVisibility(),e.Utilities.ColliderRenderGroup()),a=null!=o.physics,l=null!=o.physics&&null!=o.physics.root&&o.physics.root,s=null!=o.collision&&null!=o.collision.compoundcolliders,u=null!=o.physics&&null!=o.physics.mass?o.physics.mass:0,c=0===u;if(a===!0)if(s){var p=o.collision.compoundcolliders;if(null!=p&&p.length>0){var h=0,d=0,m=0,g=!1,f=0;p.forEach(function(a){var l=null!=a.type?a.type:"BoxCollider",s=null!=a.dynamicfriction?a.dynamicfriction:.6,u=null!=a.staticfriction?a.staticfriction:.6,c=null!=a.restitution?a.restitution:0,p=null!=a.trigger&&a.trigger;s>h&&(h=s),u>d&&(d=u),c>m&&(m=c),1==p&&(g=!0);var y=e.PhysicsImpostor.BoxImpostor;y="MeshCollider"===l?e.PhysicsImpostor.ConvexHullImpostor:"CapsuleCollider"===l?1===e.SceneManager.PhysicsCapsuleShape?e.PhysicsImpostor.CylinderImpostor:e.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===l?e.PhysicsImpostor.SphereImpostor:e.PhysicsImpostor.BoxImpostor;var _=a,v=null!=_.center?_.center:{x:0,y:0,z:0},b=null!=_.persist&&_.persist,C=e.RigidbodyPhysics.FormatCollisionMeshKey(t,n,_),T=e.RigidbodyPhysics.GetCachedCollisionMesh(t,n,_,C);if(null!=T&&(T.parent=n,T.position.set(v.x,v.y,v.z),T.renderingGroupId=r,T.isVisible=i,e.RigidbodyPhysics.CreatePhysicsImpostor(t,T,y,{mass:0,friction:0,restitution:0}),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,T,!0,!1,o.physics),f++,!e.Utilities.ShowDebugColliders()&&b===!1)){var M=n;null==M._cleanup&&(M._cleanup={}),M._cleanup[T.uniqueId.toString()]=T}}),f>0&&(e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.RigidbodyPhysics.CreatePhysicsImpostor(t,n,e.PhysicsImpostor.NoImpostor,{mass:u,friction:h,restitution:m}),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,g,o.physics),e.Utilities.ShowDebugColliders()||e.RigidbodyPhysics.DisposeCompoundNodes(n))}}else if(l){var y=null,_=0,v=0,b=0,C=!1,T=0,M=null!=o.physics&&null!=o.physics.center?e.Utilities.ParseVector3(o.physics.center,e.Vector3.Zero()):e.Vector3.Zero(),S=n.getChildren(null,!0);null!=S&&S.length>0&&S.forEach(function(e){e.position.subtractInPlace(M)});var I=n.getChildren(null,!1);null!=I&&I.length>0&&I.forEach(function(a){if(null!=a.metadata&&null!=a.metadata.unity&&null!=a.metadata.unity.collision){var l=a.metadata.unity.collision,s=null!=l.wheelinformation?l.wheelinformation:null;if(null!=s)null==y&&(y=[]),y.push(s);else{var u=null!=l.dynamicfriction?l.dynamicfriction:.6,c=null!=l.staticfriction?l.staticfriction:.6,p=null!=l.restitution?l.restitution:0,h=null!=l.trigger&&l.trigger,d=null!=l.type?l.type:"BoxCollider";u>_&&(_=u),c>v&&(v=c),p>b&&(b=p),1==h&&(C=!0);var m=e.PhysicsImpostor.BoxImpostor;m="MeshCollider"===d?e.PhysicsImpostor.ConvexHullImpostor:"CapsuleCollider"===d?1===e.SceneManager.PhysicsCapsuleShape?e.PhysicsImpostor.CylinderImpostor:e.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===d?e.PhysicsImpostor.SphereImpostor:e.PhysicsImpostor.BoxImpostor;var g=l,f=null!=g.center?g.center:{x:0,y:0,z:0},M=null!=g.persist&&g.persist,S=e.RigidbodyPhysics.FormatCollisionMeshKey(t,a,g),I=e.RigidbodyPhysics.GetCachedCollisionMesh(t,a,g,S);if(null!=I&&(I.parent=n,I.position.set(f.x,f.y,f.z),I.position.addInPlace(a.position),I.renderingGroupId=r,I.isVisible=i,e.RigidbodyPhysics.CreatePhysicsImpostor(t,I,m,{mass:0,friction:0,restitution:0}),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,I,!0,!1,o.physics),T++,!e.Utilities.ShowDebugColliders()&&M===!1)){var P=n;null==P._cleanup&&(P._cleanup={}),P._cleanup[I.uniqueId.toString()]=I}}}}),T>0&&(e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.RigidbodyPhysics.CreatePhysicsImpostor(t,n,e.PhysicsImpostor.NoImpostor,{mass:u,friction:_,restitution:b}),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,C,o.physics),e.Utilities.ShowDebugColliders()||e.RigidbodyPhysics.DisposeCompoundNodes(n)),null!=y&&y.length>0&&(null==n.metadata&&(n.metadata={}),null==n.metadata.unity&&(n.metadata.unity={}),n.metadata.unity.wheels=y),I=null}else if(null!=o.collision){var P=null!=o.collision.type?o.collision.type:"BoxCollider",A=null!=o.collision.convexmesh&&o.collision.convexmesh,x=null!=o.collision.dynamicfriction?o.collision.dynamicfriction:.6,O=null!=o.collision.staticfriction?o.collision.staticfriction:.6,w=null!=o.collision.restitution?o.collision.restitution:0,R=null!=o.collision.terraindata?o.collision.terraindata:null,B=null!=o.collision.trigger&&o.collision.trigger,k=null!=o.collision.persist&&o.collision.persist,L=e.PhysicsImpostor.BoxImpostor;if(L="MeshCollider"===P?A===!0?e.PhysicsImpostor.ConvexHullImpostor:e.PhysicsImpostor.MeshImpostor:"TerrainCollider"===P?e.PhysicsImpostor.HeightmapImpostor:"CapsuleCollider"===P?1===e.SceneManager.PhysicsCapsuleShape?e.PhysicsImpostor.CylinderImpostor:e.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===P?e.PhysicsImpostor.SphereImpostor:e.PhysicsImpostor.BoxImpostor,L==e.PhysicsImpostor.MeshImpostor){var N=e.SceneManager.FindChildTransformNode(n,n.name+".Collider",e.SearchType.ExactMatch,!0);null==N&&(N=n),e.RigidbodyPhysics.CreatePhysicsImpostor(t,N,L,{mass:u,friction:c?O:x,restitution:w}),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,N,!1,B,o.physics)}else if(L==e.PhysicsImpostor.HeightmapImpostor)if(null!=R){var V=n,U=e.RigidbodyPhysics.GetPhysicsWorld(t),F=R.resolution,E=R.resolution,D=0,G=R.height,H=R.width,z=R.length,W=!1,Y=e.RigidbodyPhysics.CreateHeightfieldTerrainShapeFromMesh(V,F,E,D,G,H,z,W);e.Tools.Warn("PHYSICS: Created Terrain Heightmap Collider: "+n.name+" --> At Resolution: "+F+" x "+E);var j=n.absolutePosition.clone(),Q=j.x+.5*H,X=j.y+.5*(G+D),K=j.z+.5*z,q=new Ammo.btTransform;q.setIdentity(),q.setOrigin(new Ammo.btVector3(Q,X,K));var Z=0,J=new Ammo.btVector3(0,0,0),$=new Ammo.btDefaultMotionState(q),ee=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(Z,$,Y,J));ee.setCollisionFlags(e.CollisionFlags.CF_STATIC_OBJECT|e.CollisionFlags.CF_KINEMATIC_OBJECT|e.CollisionFlags.CF_CUSTOM_MATERIAL_CALLBACK),ee.setActivationState(4),U.addRigidBody(ee);var te=Ammo.castObject(ee,Ammo.btCollisionObject);te.entity=n}else e.Tools.Warn("No terrain collision data found for: "+n.name+". No terrain collision impostor will be created.");else if(L==e.PhysicsImpostor.ConvexHullImpostor){var ne=e.SceneManager.FindChildTransformNode(n,n.name+".Collider",e.SearchType.ExactMatch,!0);null!=ne?(e.RigidbodyPhysics.CreatePhysicsImpostor(t,ne,L,{mass:0,friction:0,restitution:0}),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,ne,!0,!1,o.physics),e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.RigidbodyPhysics.CreatePhysicsImpostor(t,n,e.PhysicsImpostor.NoImpostor,{mass:u,friction:x,restitution:w}),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,B,o.physics),e.Utilities.ShowDebugColliders()||k===!1&&ne instanceof e.InstancedMesh&&ne.dispose()):e.Tools.Warn("No convex hull child mesh found for: "+n.name+".")}else{var oe=o.collision,ie=null!=oe.center?oe.center:{x:0,y:0,z:0},re=e.RigidbodyPhysics.FormatCollisionMeshKey(t,n,oe),ae=e.RigidbodyPhysics.GetCachedCollisionMesh(t,n,oe,re);null!=ae?(ae.parent=n,ae.position.set(ie.x,ie.y,ie.z),ae.renderingGroupId=r,ae.isVisible=i,e.RigidbodyPhysics.CreatePhysicsImpostor(t,ae,L,{mass:0,friction:0,restitution:0}),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,ae,!0,!1,o.physics),e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.RigidbodyPhysics.CreatePhysicsImpostor(t,n,e.PhysicsImpostor.NoImpostor,{
mass:u,friction:x,restitution:w}),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,B,o.physics),e.Utilities.ShowDebugColliders()||k===!1&&ae instanceof e.InstancedMesh&&ae.dispose()):e.Tools.Warn("No cached collision child mesh found for: "+n.name+".")}}}},o.ConfigRigidbodyPhysics=function(t,n,o,i,r){null!=n&&(null!=n.physicsImpostor?n.physicsImpostor.executeNativeFunction(function(t,o){var a=Ammo.castObject(o,Ammo.btCollisionObject);null==a.entity&&(a.entity=n);var l=null==r||null==r.gravity||r.gravity;if(l===!1&&(o.setGravity?(null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(0,0,0),o.setGravity(e.RigidbodyPhysics.TempAmmoVector)):e.Tools.Warn("Physics engine set gravity override not supported for: "+n.name)),o.setDamping){var s=null!=r&&null!=r.ldrag?r.ldrag:0,u=null!=r&&null!=r.adrag?r.adrag:.05;o.setDamping(s,u)}else e.Tools.Warn("Physics engine set drag damping not supported for: "+n.name);var c=null!=r&&null!=r.mass?r.mass:0;null!=r&&null!=r.kinematic&&r.kinematic;if(o.setCollisionFlags&&o.getCollisionFlags?(i===!0&&o.setCollisionFlags(o.getCollisionFlags()|e.CollisionFlags.CF_NO_CONTACT_RESPONSE),o.setCollisionFlags(o.getCollisionFlags()|e.CollisionFlags.CF_CUSTOM_MATERIAL_CALLBACK)):e.Tools.Warn("Physics engine set collision flags not supported for: "+n.name),o.getBroadphaseProxy){var p=e.SceneManager.GetTransformTag(n),h=null!=p&&p.toLowerCase().indexOf("obstacle")>=0,d=0===c?e.CollisionFilters.StaticFilter:e.CollisionFilters.DefaultFilter,m=0===c?e.CollisionFilters.AllFilter^e.CollisionFilters.StaticFilter:e.CollisionFilters.AllFilter;0===c&&h===!0&&(d=e.CollisionFilters.KinematicFilter,m=e.CollisionFilters.AllFilter^e.CollisionFilters.StaticFilter),o.getBroadphaseProxy().set_m_collisionFilterGroup(d),o.getBroadphaseProxy().set_m_collisionFilterMask(m)}else e.Tools.Warn("Physics engine set collision masks not supported for: "+n.name);var g=null!=r&&null!=r.freeze?r.freeze:null;if(null!=g){if(o.setLinearFactor){var f=null!=g.positionx&&g.positionx===!0?0:1,y=null!=g.positiony&&g.positiony===!0?0:1,_=null!=g.positionz&&g.positionz===!0?0:1;null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(f,y,_),o.setLinearFactor(e.RigidbodyPhysics.TempAmmoVector)}else e.Tools.Warn("Physics engine set linear factor not supported for: "+n.name);if(o.setAngularFactor){var v=null!=g.rotationx&&g.rotationx===!0?0:1,b=null!=g.rotationy&&g.rotationy===!0?0:1,C=null!=g.rotationz&&g.rotationz===!0?0:1;null==e.RigidbodyPhysics.TempAmmoVector&&(e.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),e.RigidbodyPhysics.TempAmmoVector.setValue(v,b,C),o.setAngularFactor(e.RigidbodyPhysics.TempAmmoVector)}else e.Tools.Warn("Physics engine set angular factor not supported for: "+n.name)}}):e.Tools.Warn("No valid physics impostor to setup for "+n.name))},o.GetCachedCollisionMesh=function(t,n,o,i){var r=null;null==e.RigidbodyPhysics.CollisionMeshCache&&(e.RigidbodyPhysics.CollisionMeshCache=new Map);var a=e.RigidbodyPhysics.CollisionMeshCache.get(i)||null;null==a&&(a=e.RigidbodyPhysics.CreateMasterCollisionMesh(t,n,o,i),null!=a?(a.scaling.set(1,1,1),e.RigidbodyPhysics.CollisionMeshCache.set(i,a)):console.warn("Failed to create master collision mesh for: "+n.name));var l=e.RigidbodyPhysics.CollisionMeshCache.get(i)||null;if(null!=l){var s=o,u=null!=s.type&&""!==s.type?s.type:null;if(r=l.createInstance(n.name+".Collider"),"CapsuleCollider"===u){var c=new e.Quaternion(0,0,0,1);if(1===e.SceneManager.PhysicsCapsuleShape){var p=s.capsulesize?e.Utilities.ParseVector3(s.capsulesize):new e.Vector3(.5,2,1);0!==p.z&&2!==p.z||(0===p.z?e.Utilities.FromEulerToRef(0,0,90,c):2===p.z&&e.Utilities.FromEulerToRef(90,0,0,c)),r.rotationQuaternion=c.clone(),r.scaling.set(1,1,1)}else{var h=s.capsulesize?e.Utilities.ParseVector3(s.capsulesize):new e.Vector3(.5,2,1);0!==h.z&&2!==h.z||(0===h.z?e.Utilities.FromEulerToRef(0,0,90,c):2===h.z&&e.Utilities.FromEulerToRef(90,0,0,c)),r.rotationQuaternion=c.clone(),r.scaling.set(1,1,1)}}else if("SphereCollider"===u){var d=e.Scalar.WithinEpsilon(n.scaling.x,n.scaling.y,1e-4)&&e.Scalar.WithinEpsilon(n.scaling.x,n.scaling.z,1e-4),m=s.sphereradius?s.sphereradius:.5;m*=Math.max(Math.abs(n.scaling.x),Math.abs(n.scaling.y),Math.abs(n.scaling.z));var g=2*m;d===!0?r.scaling.set(g,g,g):r.scaling.set(n.scaling.x*g,n.scaling.y*g,n.scaling.z*g)}else if("BoxCollider"===u){var f=s.boxsize?e.Utilities.ParseVector3(s.boxsize):new e.Vector3(1,1,1);f.x*=parseFloat(n.scaling.x.toFixed(4)),f.y*=parseFloat(n.scaling.y.toFixed(4)),f.z*=parseFloat(n.scaling.z.toFixed(4)),r.scaling.set(f.x,f.y,f.z)}}return r},o.FormatCollisionMeshKey=function(t,n,o){var i=null,r=o,a=null!=r.type&&""!==r.type?r.type:null;if("CapsuleCollider"===a)if(1===e.SceneManager.PhysicsCapsuleShape){var l=r.capsulesize?e.Utilities.ParseVector3(r.capsulesize):new e.Vector3(.5,2,1);l.x*=parseFloat(n.scaling.x.toFixed(4)),l.y*=parseFloat(n.scaling.y.toFixed(4)),i="CylinderCollider_R"+l.x.toFixed(2)+"_H"+l.y.toFixed(2)}else{var s=r.capsulesize?e.Utilities.ParseVector3(r.capsulesize):new e.Vector3(.5,2,1);s.x*=parseFloat(n.scaling.x.toFixed(4)),s.y*=parseFloat(n.scaling.y.toFixed(4)),i="CapsuleCollider_R"+s.x.toFixed(2)+"_H"+s.y.toFixed(2)}else"SphereCollider"===a?i="SphereCollider_R1.00":"BoxCollider"===a&&(i="BoxCollider_X1.00");return i},o.CreateMasterCollisionMesh=function(t,n,o,i){var r=null,a=i,l="Collision Volumes",s=t.getNodeByName(l)||null;null==s&&(s=new e.TransformNode(l,t));var u=o,c=24,p=null!=u.type&&""!==u.type?u.type:null,h=new e.Quaternion(0,0,0,1),d=e.Utilities.ColliderRenderGroup();if("CapsuleCollider"===p)if(1===e.SceneManager.PhysicsCapsuleShape){var m=u.capsulesize?e.Utilities.ParseVector3(u.capsulesize):new e.Vector3(.5,2,1);m.x*=parseFloat(n.scaling.x.toFixed(4)),m.y*=parseFloat(n.scaling.y.toFixed(4));var g=e.MeshBuilder.CreateCylinder(a,{tessellation:c,subdivisions:8,height:m.y,diameter:2*m.x},t);g.position.set(0,0,0),g.rotationQuaternion=h.clone(),g.parent=s,g.material=e.Utilities.GetColliderMaterial(t),g.visibility=e.Utilities.ColliderVisibility(),g.checkCollisions=!1,g.isPickable=!1,g.isVisible=!1,r=g,r.renderingGroupId=d}else{var f=u.capsulesize?e.Utilities.ParseVector3(u.capsulesize):new e.Vector3(.5,2,1);f.x*=parseFloat(n.scaling.x.toFixed(4)),f.y*=parseFloat(n.scaling.y.toFixed(4));var y=e.MeshBuilder.CreateCapsule(a,{tessellation:c,subdivisions:8,capSubdivisions:8,height:f.y,radius:f.x},t);y.position.set(0,0,0),y.rotationQuaternion=h.clone(),y.parent=s,y.material=e.Utilities.GetColliderMaterial(t),y.visibility=e.Utilities.ColliderVisibility(),y.checkCollisions=!1,y.isPickable=!1,y.isVisible=!1,r=y,r.renderingGroupId=d}else if("SphereCollider"===p){var _=e.MeshBuilder.CreateSphere(a,{segments:c,diameter:1},t);_.position.set(0,0,0),_.rotationQuaternion=h.clone(),_.parent=s,_.material=e.Utilities.GetColliderMaterial(t),_.visibility=e.Utilities.ColliderVisibility(),_.checkCollisions=!1,_.isPickable=!1,_.isVisible=!1,r=_,r.renderingGroupId=d}else if("BoxCollider"===p){var v=e.MeshBuilder.CreateBox(a,{width:1,height:1,depth:1},t);v.position.set(0,0,0),v.rotationQuaternion=h.clone(),v.parent=s,v.material=e.Utilities.GetColliderMaterial(t),v.visibility=e.Utilities.ColliderVisibility(),v.checkCollisions=!1,v.isPickable=!1,v.isVisible=!1,r=v,r.renderingGroupId=d}return r},o.DisposeCompoundNodes=function(e){var t=e;if(null!=t._cleanup){var n=Object.keys(t._cleanup);n.forEach(function(e,n){var o=t._cleanup[e];null!=o&&o.dispose()});try{delete t._cleanup}catch(o){}}},o.GetPhysicsHeapSize=function(){if("undefined"==typeof Ammo)return 0;var e=0;return Ammo&&Ammo.HEAP8&&Ammo.HEAP8.length&&(e=Ammo.HEAP8.length/1048576),e},o.ConfigurePhysicsEngine=function(t,n,o,i,r,a,l){if(void 0===n&&(n=!0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===r&&(r=!0),void 0===a&&(a=1e-4),void 0===l&&(l=null),"undefined"!=typeof Ammo){var s=new e.Vector3(0,(-9.81),0),u=null!=l?l:s;if(Ammo&&e.AmmoJSPlugin){var c=t.isPhysicsEnabled(),p=c===!0?t.getPhysicsEngine():null,h=c===!0&&null!=p?p.getPhysicsPlugin():null,d=c===!0&&null!=p&&"AmmoJSPlugin"===p.getPhysicsPluginName();if(d===!1){var m=null,g=e.RigidbodyPhysics.GetPhysicsHeapSize();if(i>0){var f=new Ammo.btAxisSweep3(new Ammo.btVector3((-i),(-i),(-i)),new Ammo.btVector3(i,i,i));m=new e.AmmoJSPlugin(n,Ammo,f),e.Tools.Log("Ammo.js plugin (btAxisSweep3 - "+g+" MB)")}else m=new e.AmmoJSPlugin(n),e.Tools.Log("Ammo.js plugin (btDbvtBroadphase - "+g+" MB)");n===!0?e.Tools.Log("Ammo.js delta world step enabled"):e.Tools.Log("Ammo.js fixed time step enabled"),e.Utilities.UseTriangleNormals()===!0&&e.Tools.Log("Ammo.js triangle normals enabled"),null!=e.RigidbodyPhysics.OnSetupPhysicsPlugin&&e.RigidbodyPhysics.OnSetupPhysicsPlugin(t,m),m.onCreateCustomMeshImpostor=function(t){var n=null,o=null,i=0,r=t.object,a=!0,l=null;if(r instanceof e.InstancedMesh?l=r.sourceMesh:r instanceof e.AbstractMesh&&(l=r),null!=l){if(null==e.RigidbodyPhysics.TriangleMeshCache&&(e.RigidbodyPhysics.TriangleMeshCache=new Map),o=e.RigidbodyPhysics.TriangleMeshCache.get(l.uniqueId)||null,null==o){if(null!=Ammo.btSmoothTriangleMesh){o=new Ammo.btSmoothTriangleMesh;var s=e.Utilities.UseTriangleNormals();o.set_m_useTriangleNormals&&o.set_m_useTriangleNormals(s),t._pluginData.toDispose.push(o),i=e.RigidbodyPhysics.AddMeshVerts(o,r,r,!0)}else o=new Ammo.btTriangleMesh,t._pluginData.toDispose.push(o),i=e.RigidbodyPhysics.AddMeshVerts(o,r,r,!1);e.RigidbodyPhysics.TriangleMeshCache.set(l.uniqueId,o)}null!=o&&(n=new Ammo.btBvhTriangleMeshShape(o,a))}else e.Tools.Warn("No source mesh found for entity: "+r.name);return null==n&&(n=new Ammo.btCompoundShape,e.Tools.Warn("No triangle mesh data found for entity: "+r.name)),r.collisionType="btBvhTriangleMeshShape",r.collisionShape=n,n},m.onCreateCustomConvexHullImpostor=function(t){var n=t.object,o=new Ammo.btConvexHullShape;e.RigidbodyPhysics.AddHullVerts(o,n,n);if(o.initializePolyhedralFeatures(e.SceneManager.DefaultConvexHullMargin),o.setMargin(e.SceneManager.DefaultConvexHullMargin),null!=t.object.parent&&null!=t.object.parent.scaling){var i=t.object.parent.scaling,r=new Ammo.btVector3(i.x,i.y,i.z);o.setLocalScaling&&o.setLocalScaling(r),Ammo.destroy(r)}return n.collisionType="btConvexHullShape",n.collisionShape=o,o},t.enablePhysics(u,m),c=t.isPhysicsEnabled(),p=c===!0?t.getPhysicsEngine():null,h=c===!0&&null!=p?p.getPhysicsPlugin():null,d=c===!0&&null!=p&&"AmmoJSPlugin"===p.getPhysicsPluginName(),null!=p&&o>0&&p.setSubTimeStep(o)}else e.Tools.Warn("Ammo.js plugin enabled");if(d===!0&&null!=p&&null!=h&&null!=h.world){null==Ammo.btSmoothTriangleMesh&&e.Tools.Warn("Ammo.js using default triangle"),null==Ammo.btSmoothVehicleRaycaster&&e.Tools.Warn("Ammo.js using default vehicle raycaster"),h.world.getDispatchInfo().set_m_enableSatConvex(!0),h.world.getDispatchInfo().set_m_allowedCcdPenetration(a),h.world.getBroadphase().getOverlappingPairCache().setInternalGhostPairCallback(new Ammo.btGhostPairCallback);var y=t;y._monitorContactManifolds||(y._monitorContactManifolds=!0,r===!0&&(e.Tools.Log("Ammo.js contact manifolds enabled"),t.registerBeforeRender(function(){var e=h.world.getDispatcher().getNumManifolds();if(e>0)for(var t=0;t<e;t++){var n=h.world.getDispatcher().getManifoldByIndexInternal(t),o=Ammo.castObject(n.getBody0(),Ammo.btCollisionObject),i=Ammo.castObject(n.getBody1(),Ammo.btCollisionObject);null!=o&&null!=o.entity&&null!=o.entity.physicsImpostor&&null!=i&&null!=i.entity&&i.isActive()&&null!=o.entity.physicsImpostor.tmpCollisionObjects&&(o.entity.physicsImpostor.tmpCollisionObjects[i.entity.uniqueId]=i.entity),null!=i&&null!=i.entity&&null!=i.entity.physicsImpostor&&null!=o&&null!=o.entity&&o.isActive()&&null!=i.entity.physicsImpostor.tmpCollisionObjects&&(i.entity.physicsImpostor.tmpCollisionObjects[o.entity.uniqueId]=o.entity)}})))}else e.Tools.Warn("Ammo.js physics plugins are invalid")}else e.Tools.Warn("Ammo.js physics plugin not available")}},o.GetPhysicsEngine=function(e){return"undefined"==typeof Ammo?null:e.getPhysicsEngine()},o.GetPhysicsWorld=function(t){if("undefined"==typeof Ammo)return null;var n=null,o=e.RigidbodyPhysics.GetPhysicsEngine(t);if(null!=o){var i=o.getPhysicsPlugin();null!=i&&(n=i.world)}return n},o.PhysicsRaycast=function(t,n,o,i,r,a){if(void 0===r&&(r=null),void 0===a&&(a=null),null==t)return null;if("undefined"==typeof Ammo)return null;if(null==e.RigidbodyPhysics.TempPhysicsWorld&&(e.RigidbodyPhysics.TempPhysicsWorld=e.RigidbodyPhysics.GetPhysicsWorld(t)),null==e.RigidbodyPhysics.TempPhysicsWorld)return null;null==e.RigidbodyPhysics.TempVRayDest&&(e.RigidbodyPhysics.TempVRayDest=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TempVRayOrigin&&(e.RigidbodyPhysics.TempVRayOrigin=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TempCastEndPoint&&(e.RigidbodyPhysics.TempCastEndPoint=new e.Vector3(0,0,0)),null==e.RigidbodyPhysics.TempRaycastResult&&(e.RigidbodyPhysics.TempRaycastResult=new e.RaycastHitResult),null==e.RigidbodyPhysics.ClosestRayResultCallback&&(e.RigidbodyPhysics.ClosestRayResultCallback=new Ammo.ClosestRayResultCallback(e.RigidbodyPhysics.TempVRayOrigin,e.RigidbodyPhysics.TempVRayDest));var l=Ammo.castObject(e.RigidbodyPhysics.ClosestRayResultCallback,Ammo.RayResultCallback);if(l.set_m_closestHitFraction(1),l.set_m_collisionObject(null),null!=r?l.set_m_collisionFilterGroup(r):l.set_m_collisionFilterGroup(e.CollisionFilters.DefaultFilter),null!=a?l.set_m_collisionFilterMask(a):l.set_m_collisionFilterMask(e.CollisionFilters.AllFilter),e.RigidbodyPhysics.TempCastEndPoint.copyFrom(n),o.scaleAndAddToRef(i,e.RigidbodyPhysics.TempCastEndPoint),e.RigidbodyPhysics.TempVRayOrigin.setValue(n.x,n.y,n.z),e.RigidbodyPhysics.TempVRayDest.setValue(e.RigidbodyPhysics.TempCastEndPoint.x,e.RigidbodyPhysics.TempCastEndPoint.y,e.RigidbodyPhysics.TempCastEndPoint.z),e.RigidbodyPhysics.ClosestRayResultCallback.get_m_rayFromWorld().setValue(n.x,n.y,n.z),e.RigidbodyPhysics.ClosestRayResultCallback.get_m_rayToWorld().setValue(e.RigidbodyPhysics.TempCastEndPoint.x,e.RigidbodyPhysics.TempCastEndPoint.y,e.RigidbodyPhysics.TempCastEndPoint.z),e.RigidbodyPhysics.TempRaycastResult.reset(n,e.RigidbodyPhysics.TempCastEndPoint),e.RigidbodyPhysics.TempPhysicsWorld.rayTest(e.RigidbodyPhysics.TempVRayOrigin,e.RigidbodyPhysics.TempVRayDest,e.RigidbodyPhysics.ClosestRayResultCallback),e.RigidbodyPhysics.ClosestRayResultCallback.hasHit()){var s=e.RigidbodyPhysics.ClosestRayResultCallback.get_m_hitPointWorld(),u=e.RigidbodyPhysics.ClosestRayResultCallback.get_m_hitNormalWorld();e.RigidbodyPhysics.TempRaycastResult.update(!0,s.x(),s.y(),s.z(),u.x(),u.y(),u.z(),l.get_m_collisionObject())}return e.RigidbodyPhysics.TempRaycastResult},o.PhysicsRaycastToPoint=function(t,n,o,i,r){if(void 0===i&&(i=null),void 0===r&&(r=null),null==t)return null;if("undefined"==typeof Ammo)return null;if(null==e.RigidbodyPhysics.TempPhysicsWorld&&(e.RigidbodyPhysics.TempPhysicsWorld=e.RigidbodyPhysics.GetPhysicsWorld(t)),null==e.RigidbodyPhysics.TempPhysicsWorld)return null;null==e.RigidbodyPhysics.TempVRayDest&&(e.RigidbodyPhysics.TempVRayDest=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TempVRayOrigin&&(e.RigidbodyPhysics.TempVRayOrigin=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TempRaycastResult&&(e.RigidbodyPhysics.TempRaycastResult=new e.RaycastHitResult),null==e.RigidbodyPhysics.ClosestRayResultCallback&&(e.RigidbodyPhysics.ClosestRayResultCallback=new Ammo.ClosestRayResultCallback(e.RigidbodyPhysics.TempVRayOrigin,e.RigidbodyPhysics.TempVRayDest));var a=Ammo.castObject(e.RigidbodyPhysics.ClosestRayResultCallback,Ammo.RayResultCallback);if(a.set_m_closestHitFraction(1),a.set_m_collisionObject(null),null!=i?a.set_m_collisionFilterGroup(i):a.set_m_collisionFilterGroup(e.CollisionFilters.DefaultFilter),null!=r?a.set_m_collisionFilterMask(r):a.set_m_collisionFilterMask(e.CollisionFilters.AllFilter),e.RigidbodyPhysics.TempVRayOrigin.setValue(n.x,n.y,n.z),e.RigidbodyPhysics.TempVRayDest.setValue(o.x,o.y,o.z),e.RigidbodyPhysics.ClosestRayResultCallback.get_m_rayFromWorld().setValue(n.x,n.y,n.z),e.RigidbodyPhysics.ClosestRayResultCallback.get_m_rayToWorld().setValue(o.x,o.y,o.z),e.RigidbodyPhysics.TempRaycastResult.reset(n,o),e.RigidbodyPhysics.TempPhysicsWorld.rayTest(e.RigidbodyPhysics.TempVRayOrigin,e.RigidbodyPhysics.TempVRayDest,e.RigidbodyPhysics.ClosestRayResultCallback),e.RigidbodyPhysics.ClosestRayResultCallback.hasHit()){var l=e.RigidbodyPhysics.ClosestRayResultCallback.get_m_hitPointWorld(),s=e.RigidbodyPhysics.ClosestRayResultCallback.get_m_hitNormalWorld();e.RigidbodyPhysics.TempRaycastResult.update(!0,l.x(),l.y(),l.z(),s.x(),s.y(),s.z(),a.get_m_collisionObject())}return e.RigidbodyPhysics.TempRaycastResult},o.PhysicsShapecast=function(t,n,o,i,r,a,l){if(void 0===a&&(a=null),void 0===l&&(l=null),null==t)return null;if("undefined"==typeof Ammo)return null;if(null==e.RigidbodyPhysics.TempPhysicsWorld&&(e.RigidbodyPhysics.TempPhysicsWorld=e.RigidbodyPhysics.GetPhysicsWorld(t)),null==e.RigidbodyPhysics.TempPhysicsWorld)return null;null==e.RigidbodyPhysics.TempVRayDest&&(e.RigidbodyPhysics.TempVRayDest=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TempVRayOrigin&&(e.RigidbodyPhysics.TempVRayOrigin=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TempCastEndPoint&&(e.RigidbodyPhysics.TempCastEndPoint=new e.Vector3(0,0,0)),null==e.RigidbodyPhysics.TempTransformFrom&&(e.RigidbodyPhysics.TempTransformFrom=new Ammo.btTransform),null==e.RigidbodyPhysics.TempTransformTo&&(e.RigidbodyPhysics.TempTransformTo=new Ammo.btTransform),null==e.RigidbodyPhysics.TempRaycastResult&&(e.RigidbodyPhysics.TempRaycastResult=new e.RaycastHitResult),null==e.RigidbodyPhysics.ClosestConvexResultCallback&&(e.RigidbodyPhysics.ClosestConvexResultCallback=new Ammo.ClosestConvexResultCallback(e.RigidbodyPhysics.TempVRayOrigin,e.RigidbodyPhysics.TempVRayDest));var s=Ammo.castObject(e.RigidbodyPhysics.ClosestConvexResultCallback,Ammo.ConvexResultCallback);s.set_m_closestHitFraction(1),null!=a?s.set_m_collisionFilterGroup(a):s.set_m_collisionFilterGroup(e.CollisionFilters.DefaultFilter),null!=l?s.set_m_collisionFilterMask(l):s.set_m_collisionFilterMask(e.CollisionFilters.AllFilter),null!=e.RigidbodyPhysics.ClosestConvexResultCallback.set_m_hitCollisionObject&&e.RigidbodyPhysics.ClosestConvexResultCallback.set_m_hitCollisionObject(null),e.RigidbodyPhysics.TempCastEndPoint.copyFrom(o),i.scaleAndAddToRef(r,e.RigidbodyPhysics.TempCastEndPoint),e.RigidbodyPhysics.TempVRayOrigin.setValue(o.x,o.y,o.z),e.RigidbodyPhysics.TempVRayDest.setValue(e.RigidbodyPhysics.TempCastEndPoint.x,e.RigidbodyPhysics.TempCastEndPoint.y,e.RigidbodyPhysics.TempCastEndPoint.z),e.RigidbodyPhysics.ClosestConvexResultCallback.get_m_convexFromWorld().setValue(o.x,o.y,o.z),e.RigidbodyPhysics.ClosestConvexResultCallback.get_m_convexToWorld().setValue(e.RigidbodyPhysics.TempCastEndPoint.x,e.RigidbodyPhysics.TempCastEndPoint.y,e.RigidbodyPhysics.TempCastEndPoint.z);var u=1e-4;if(e.RigidbodyPhysics.TempRaycastResult.reset(o,e.RigidbodyPhysics.TempCastEndPoint),e.RigidbodyPhysics.TempTransformFrom.setIdentity(),e.RigidbodyPhysics.TempTransformFrom.setOrigin(e.RigidbodyPhysics.TempVRayOrigin),e.RigidbodyPhysics.TempTransformTo.setIdentity(),e.RigidbodyPhysics.TempTransformTo.setOrigin(e.RigidbodyPhysics.TempVRayDest),e.RigidbodyPhysics.TempPhysicsWorld.convexSweepTest(n,e.RigidbodyPhysics.TempTransformFrom,e.RigidbodyPhysics.TempTransformTo,e.RigidbodyPhysics.ClosestConvexResultCallback,u),e.RigidbodyPhysics.ClosestConvexResultCallback.hasHit()){var c=e.RigidbodyPhysics.ClosestConvexResultCallback.get_m_hitPointWorld(),p=e.RigidbodyPhysics.ClosestConvexResultCallback.get_m_hitNormalWorld();e.RigidbodyPhysics.TempRaycastResult.update(!0,c.x(),c.y(),c.z(),p.x(),p.y(),p.z(),e.RigidbodyPhysics.ClosestConvexResultCallback.get_m_hitCollisionObject())}return e.RigidbodyPhysics.TempRaycastResult},o.PhysicsShapecastToPoint=function(t,n,o,i,r,a){if(void 0===r&&(r=null),void 0===a&&(a=null),null==t)return null;if("undefined"==typeof Ammo)return null;if(null==e.RigidbodyPhysics.TempPhysicsWorld&&(e.RigidbodyPhysics.TempPhysicsWorld=e.RigidbodyPhysics.GetPhysicsWorld(t)),null==e.RigidbodyPhysics.TempPhysicsWorld)return null;null==e.RigidbodyPhysics.TempVRayDest&&(e.RigidbodyPhysics.TempVRayDest=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TempVRayOrigin&&(e.RigidbodyPhysics.TempVRayOrigin=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TempTransformFrom&&(e.RigidbodyPhysics.TempTransformFrom=new Ammo.btTransform),null==e.RigidbodyPhysics.TempTransformTo&&(e.RigidbodyPhysics.TempTransformTo=new Ammo.btTransform),null==e.RigidbodyPhysics.TempRaycastResult&&(e.RigidbodyPhysics.TempRaycastResult=new e.RaycastHitResult),null==e.RigidbodyPhysics.ClosestConvexResultCallback&&(e.RigidbodyPhysics.ClosestConvexResultCallback=new Ammo.ClosestConvexResultCallback(e.RigidbodyPhysics.TempVRayOrigin,e.RigidbodyPhysics.TempVRayDest));var l=Ammo.castObject(e.RigidbodyPhysics.ClosestConvexResultCallback,Ammo.ConvexResultCallback);l.set_m_closestHitFraction(1),null!=r?l.set_m_collisionFilterGroup(r):l.set_m_collisionFilterGroup(e.CollisionFilters.DefaultFilter),null!=a?l.set_m_collisionFilterMask(a):l.set_m_collisionFilterMask(e.CollisionFilters.AllFilter),null!=e.RigidbodyPhysics.ClosestConvexResultCallback.set_m_hitCollisionObject&&e.RigidbodyPhysics.ClosestConvexResultCallback.set_m_hitCollisionObject(null),e.RigidbodyPhysics.TempVRayOrigin.setValue(o.x,o.y,o.z),e.RigidbodyPhysics.TempVRayDest.setValue(i.x,i.y,i.z),e.RigidbodyPhysics.ClosestConvexResultCallback.get_m_convexFromWorld().setValue(o.x,o.y,o.z),e.RigidbodyPhysics.ClosestConvexResultCallback.get_m_convexToWorld().setValue(i.x,i.y,i.z);var s=1e-4;if(e.RigidbodyPhysics.TempRaycastResult.reset(o,i),e.RigidbodyPhysics.TempTransformFrom.setIdentity(),e.RigidbodyPhysics.TempTransformFrom.setOrigin(e.RigidbodyPhysics.TempVRayOrigin),e.RigidbodyPhysics.TempTransformTo.setIdentity(),e.RigidbodyPhysics.TempTransformTo.setOrigin(e.RigidbodyPhysics.TempVRayDest),e.RigidbodyPhysics.TempPhysicsWorld.convexSweepTest(n,e.RigidbodyPhysics.TempTransformFrom,e.RigidbodyPhysics.TempTransformTo,e.RigidbodyPhysics.ClosestConvexResultCallback,s),e.RigidbodyPhysics.ClosestConvexResultCallback.hasHit()){var u=e.RigidbodyPhysics.ClosestConvexResultCallback.get_m_hitPointWorld(),c=e.RigidbodyPhysics.ClosestConvexResultCallback.get_m_hitNormalWorld();e.RigidbodyPhysics.TempRaycastResult.update(!0,u.x(),u.y(),u.z(),c.x(),c.y(),c.z(),e.RigidbodyPhysics.ClosestConvexResultCallback.get_m_hitCollisionObject())}return e.RigidbodyPhysics.TempRaycastResult},o.CreatePhysicsImpostor=function(t,n,o,i,r){if(void 0===r&&(r=!0),null!=n&&"undefined"!=typeof Ammo){var a=n.parent,l=(n.scaling.clone(),n.position.clone()),s=null!=n.rotationQuaternion?n.rotationQuaternion.clone():e.Quaternion.FromEulerVector(n.rotation),u=n.absolutePosition.clone(),c=null!=n.absoluteRotationQuaternion?n.absoluteRotationQuaternion.clone():e.Quaternion.FromEulerVector(n.rotation);n.parent=null,n.position.copyFrom(u),n.rotationQuaternion.copyFrom(c),n.checkCollisions=!1;var p=o;switch(o===e.PhysicsImpostor.HeightmapImpostor&&(p=e.PhysicsImpostor.CustomImpostor),n.computeWorldMatrix(!0),n.physicsImpostor=new e.PhysicsImpostor(n,p,i,t),e.Utilities.ReparentColliders()&&r===!0&&null!=a&&(o===e.PhysicsImpostor.ConvexHullImpostor?n.parent=a:n.setParent(a),n.position.copyFrom(l),n.rotationQuaternion.copyFrom(s)),o){case e.PhysicsImpostor.BoxImpostor:case e.PhysicsImpostor.SphereImpostor:case e.PhysicsImpostor.CapsuleImpostor:case e.PhysicsImpostor.ConvexHullImpostor:n.physicsImpostor.setDeltaPosition(e.Vector3.ZeroReadOnly),n.physicsImpostor.setDeltaRotation(e.Quaternion.Identity())}}},o.GetPhysicsImposterType=function(t){if("undefined"==typeof Ammo)return null;var n="Unknown";switch(t){case e.PhysicsImpostor.NoImpostor:n="No";break;case e.PhysicsImpostor.SphereImpostor:n="Sphere";break;case e.PhysicsImpostor.BoxImpostor:n="Box";break;case e.PhysicsImpostor.PlaneImpostor:n="Plane";break;case e.PhysicsImpostor.MeshImpostor:n="Mesh";break;case e.PhysicsImpostor.CapsuleImpostor:n="Capsule";break;case e.PhysicsImpostor.CylinderImpostor:n="Cylinder";break;case e.PhysicsImpostor.ParticleImpostor:n="Particle";break;case e.PhysicsImpostor.HeightmapImpostor:n="Heightmap";break;case e.PhysicsImpostor.ConvexHullImpostor:n="ConvexHull";break;case e.PhysicsImpostor.CustomImpostor:n="CustomShape"}return n},o.CreatePhysicsBoxShape=function(e){return"undefined"==typeof Ammo?null:new Ammo.btBoxShape(new Ammo.btVector3(e.x,e.y,e.z))},o.CreatePhysicsSphereShape=function(e){return"undefined"==typeof Ammo?null:new Ammo.btSphereShape(e)},o.CreatePhysicsEllipsoidShape=function(e){if("undefined"==typeof Ammo)return null;var t=[new Ammo.btVector3(0,0,0)],n=[1],o=new Ammo.btMultiSphereShape(t,n,1);return o.setLocalScaling(new Ammo.btVector3(e.x,e.y,e.z)),o},o.CreatePhysicsCylinderShape=function(e,t){return"undefined"==typeof Ammo?null:new Ammo.btCylinderShape(new Ammo.btVector3(e,t,e))},o.CreatePhysicsCapsuleShape=function(e,t){return"undefined"==typeof Ammo?null:new Ammo.btCapsuleShape(e,t)},o.CreatePhysicsCompoundShape=function(e){return void 0===e&&(e=!1),"undefined"==typeof Ammo?null:new Ammo.btCompoundShape(e)},o.CreatePhysicsEmptyShape=function(){return"undefined"==typeof Ammo?null:new Ammo.btEmptyShape},o.ConvertAmmoVector3=function(t){var n=new e.Vector3(0,0,0);return e.RigidbodyPhysics.ConvertAmmoVector3ToRef(t,n),n},o.ConvertAmmoVector3ToRef=function(e,t){t.set(e.x(),e.y(),e.z())},o.ConvertAmmoQuaternion=function(t){var n=new e.Quaternion(0,0,0,1);return e.RigidbodyPhysics.ConvertAmmoQuaternionToRef(t,n),n},o.ConvertAmmoQuaternionToRef=function(e,t){t.set(e.x(),e.y(),e.z(),e.w())},o.CreateHeightfieldTerrainShape=function(t,n,o,i,r,a,l,s,u){void 0===u&&(u=!1);var c=1,p=1,h="PHY_FLOAT";t.ammoHeightData=Ammo._malloc(4*o*i);for(var d=0,m=0,g=0;g<i;g++)for(var f=0;f<o;f++)Ammo.HEAPF32[t.ammoHeightData+m>>2]=n[d],d++,m+=4;var y=new Ammo.btHeightfieldTerrainShape(o,i,t.ammoHeightData,c,r,a,p,h,u),_=l/(o-1),v=s/(i-1);return y.setLocalScaling(new Ammo.btVector3(_,1,v)),y.setMargin(e.SceneManager.DefaultHeightFieldMargin),y},o.CreateHeightfieldTerrainShapeFromMesh=function(t,n,o,i,r,a,l,s){void 0===s&&(s=!1);var u=1,c=1,p="PHY_FLOAT",h=t.getVerticesData(e.VertexBuffer.PositionKind);t.ammoHeightData=Ammo._malloc(4*n*o);for(var d=0,m=0,g=0;g<h.length/3;g++)d=h[3*g+1],Ammo.HEAPF32[t.ammoHeightData+m>>2]=d,m+=4;var f=new Ammo.btHeightfieldTerrainShape(n,o,t.ammoHeightData,u,i,r,c,p,s),y=a/(n-1),_=l/(o-1);return f.setLocalScaling(new Ammo.btVector3(y,1,_)),f.setMargin(e.SceneManager.DefaultHeightFieldMargin),f},o.AddHullVerts=function(t,n,o){null==e.RigidbodyPhysics.TmpHullMatrix&&(e.RigidbodyPhysics.TmpHullMatrix=new e.Matrix),null==e.RigidbodyPhysics.TmpAmmoVectorA&&(e.RigidbodyPhysics.TmpAmmoVectorA=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TmpAmmoVectorB&&(e.RigidbodyPhysics.TmpAmmoVectorB=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TmpAmmoVectorC&&(e.RigidbodyPhysics.TmpAmmoVectorC=new Ammo.btVector3(0,0,0));var i=o;if(!t.addPoint)return e.Tools.Warn("No AddPoint Function For Convex Hull Shape On: "+i.name),0;var r=0;if(o&&o.getIndices&&o.getWorldMatrix&&o.getChildMeshes){var a=o.getIndices();a||(a=[]);var l=o.getVerticesData(e.VertexBuffer.PositionKind);l||(l=[]),o.computeWorldMatrix(!1);for(var s=a.length/3,u=0;u<s;u++){for(var c=[],p=0;p<3;p++){var h=void 0,d=3*a[3*u+p],m=new e.Vector3(l[d+0],l[d+1],l[d+2]);e.Matrix.ScalingToRef(o.scaling.x,o.scaling.y,o.scaling.z,e.RigidbodyPhysics.TmpHullMatrix),m=e.Vector3.TransformCoordinates(m,e.RigidbodyPhysics.TmpHullMatrix),h=0==p?e.RigidbodyPhysics.TmpAmmoVectorA:1==p?e.RigidbodyPhysics.TmpAmmoVectorB:e.RigidbodyPhysics.TmpAmmoVectorC,h.setValue(m.x,m.y,m.z),c.push(h)}t.addPoint(c[0],!1),t.addPoint(c[1],!1),t.addPoint(c[2],!1),r++}t.recalcLocalAabb()}return r},o.AddMeshVerts=function(t,n,o,i){void 0===i&&(i=!1),null==e.RigidbodyPhysics.TmpHullMatrix&&(e.RigidbodyPhysics.TmpHullMatrix=new e.Matrix),null==e.RigidbodyPhysics.TmpAmmoVectorA&&(e.RigidbodyPhysics.TmpAmmoVectorA=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TmpAmmoVectorB&&(e.RigidbodyPhysics.TmpAmmoVectorB=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TmpAmmoVectorC&&(e.RigidbodyPhysics.TmpAmmoVectorC=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TmpAmmoNormalA&&(e.RigidbodyPhysics.TmpAmmoNormalA=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TmpAmmoNormalB&&(e.RigidbodyPhysics.TmpAmmoNormalB=new Ammo.btVector3(0,0,0)),null==e.RigidbodyPhysics.TmpAmmoNormalC&&(e.RigidbodyPhysics.TmpAmmoNormalC=new Ammo.btVector3(0,0,0));var r=0;if(o&&o.getIndices&&o.getWorldMatrix&&o.getChildMeshes){var a=o.getIndices();a||(a=[]);var l=o.getVerticesData(e.VertexBuffer.PositionKind);l||(l=[]);var s=o.getVerticesData(e.VertexBuffer.NormalKind);s||(s=[]);var u=void 0;if(n&&n!==o){var c=void 0;c=n.rotationQuaternion?n.rotationQuaternion:n.rotation?e.Quaternion.FromEulerAngles(n.rotation.x,n.rotation.y,n.rotation.z):e.Quaternion.Identity();var p=e.Matrix.Compose(e.Vector3.One(),c,n.position);p.invertToRef(e.RigidbodyPhysics.TmpHullMatrix);var h=o.computeWorldMatrix(!1);u=h.multiply(e.RigidbodyPhysics.TmpHullMatrix)}else e.Matrix.ScalingToRef(o.scaling.x,o.scaling.y,o.scaling.z,e.RigidbodyPhysics.TmpHullMatrix),u=e.RigidbodyPhysics.TmpHullMatrix;for(var d=a.length/3,m=0;m<d;m++){for(var g=[],f=[],y=0;y<3;y++){var _=new e.Vector3(l[3*a[3*m+y]+0],l[3*a[3*m+y]+1],l[3*a[3*m+y]+2]),v=new e.Vector3(s[3*a[3*m+y]+0],s[3*a[3*m+y]+1],s[3*a[3*m+y]+2]);_=e.Vector3.TransformCoordinates(_,u);var b,C;0==y?(b=e.RigidbodyPhysics.TmpAmmoVectorA,C=e.RigidbodyPhysics.TmpAmmoNormalA):1==y?(b=e.RigidbodyPhysics.TmpAmmoVectorB,C=e.RigidbodyPhysics.TmpAmmoNormalB):(b=e.RigidbodyPhysics.TmpAmmoVectorC,C=e.RigidbodyPhysics.TmpAmmoNormalC),b.setValue(_.x,_.y,_.z),C.setValue(v.x,v.y,v.z),g.push(b),f.push(C)}i===!0?t.addTriangleNormals(g[0],g[1],g[2],f[0],f[1],f[2]):t.addTriangle(g[0],g[1],g[2]),r++}}return r},o.TempAmmoVector=null,o.TempAmmoVectorAux=null,o.TempCenterTransform=null,o.CollisionMeshCache=null,o.TriangleMeshCache=null,o.OnSetupPhysicsPlugin=null,o.TempVRayDest=null,o.TempVRayOrigin=null,o.TempShapeVector=null,o.TempPhysicsWorld=null,o.TempTransformFrom=null,o.TempTransformTo=null,o.TempCastEndPoint=null,o.TempRaycastResult=null,o.ClosestRayResultCallback=null,o.ClosestConvexResultCallback=null,o.TmpHullMatrix=null,o.TmpAmmoVectorA=null,o.TmpAmmoVectorB=null,o.TmpAmmoVectorC=null,o.TmpAmmoVectorD=null,o.TmpAmmoNormalA=null,o.TmpAmmoNormalB=null,o.TmpAmmoNormalC=null,o}(e.ScriptComponent);e.RigidbodyPhysics=t;var n=function(){function e(){this.mesh=null,this.state=0,this.reset=!1}return e}();e.CollisionContactInfo=n}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),BABYLON;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.awake=function(){},t.prototype.start=function(){},t.prototype.ready=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.fixed=function(){},t.prototype.destroy=function(){},t}(e.ScriptComponent);e.ShurikenParticles=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;
}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),BABYLON;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.awake=function(){},t.prototype.start=function(){},t.prototype.fixed=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.ready=function(){},t.prototype.destroy=function(){},t}(e.ScriptComponent);e.TerrainGenerator=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),BABYLON;!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.videoLoop=!1,n.videoMuted=!1,n.videoAlpha=!1,n.videoFaded=!1,n.videoPoster=null,n.videoInvert=!0,n.videoSample=3,n.videoVolume=1,n.videoMipmaps=!1,n.videoPlayback=1,n.videoPlayOnAwake=!0,n.videoPreloaderUrl=null,n.videoBlobUrl=null,n.videoPreload=!1,n._initializedReadyInstance=!1,n.onReadyObservable=new e.Observable,n.m_abstractMesh=null,n.m_videoTexture=null,n.m_videoMaterial=null,n.m_diffuseIntensity=1,n}return __extends(n,t),n.prototype.getVideoMaterial=function(){return this.m_videoMaterial},n.prototype.getVideoTexture=function(){return this.m_videoTexture},n.prototype.getVideoElement=function(){return null!=this.m_videoTexture?this.m_videoTexture.video:null},n.prototype.getVideoScreen=function(){return this.m_abstractMesh},n.prototype.getVideoBlobUrl=function(){return this.videoBlobUrl},n.prototype.awake=function(){this.awakeWebVideoPlayer()},n.prototype.destroy=function(){this.destroyWebVideoPlayer()},n.prototype.awakeWebVideoPlayer=function(){this.videoLoop=this.getProperty("looping",!1),this.videoMuted=this.getProperty("muted",!1),this.videoInvert=this.getProperty("inverty",!0),this.videoSample=this.getProperty("sampling",3),this.videoVolume=this.getProperty("volume",1),this.videoMipmaps=this.getProperty("mipmaps",!1),this.videoAlpha=this.getProperty("texturealpha",!1),this.videoFaded=this.getProperty("diffusealpha",!1),this.videoPlayback=this.getProperty("playbackspeed",1),this.videoPlayOnAwake=this.getProperty("playonawake",!0),this.videoPreload=this.getProperty("preload",this.videoPreload),this.m_diffuseIntensity=this.getProperty("intensity",1),this.m_abstractMesh=this.getAbstractMesh();var t=this.getProperty("poster");t===!0&&null!=this.m_abstractMesh&&null!=this.m_abstractMesh.material&&(this.m_abstractMesh.material instanceof e.PBRMaterial?null!=this.m_abstractMesh.material.albedoTexture&&null!=this.m_abstractMesh.material.albedoTexture.url&&""!==this.m_abstractMesh.material.albedoTexture.url&&(this.videoPoster=this.m_abstractMesh.material.albedoTexture.url.replace("data:","")):this.m_abstractMesh.material instanceof e.StandardMaterial&&null!=this.m_abstractMesh.material.diffuseTexture&&null!=this.m_abstractMesh.material.diffuseTexture.url&&""!==this.m_abstractMesh.material.diffuseTexture.url&&(this.videoPoster=this.m_abstractMesh.material.diffuseTexture.url.replace("data:","")));var n=this.getProperty("url",null),o=this.getProperty("source",null),i=n;if(null!=o&&null!=o.filename&&""!==o.filename){var r=e.SceneManager.GetRootUrl(this.scene);i=r+o.filename}null!=i&&""!==i&&(this.videoPreload===!0?this.videoPreloaderUrl=i:this.setDataSource(i))},n.prototype.destroyWebVideoPlayer=function(){this.m_abstractMesh=null,null!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),null!=this.m_videoMaterial&&(this.m_videoMaterial.dispose(),this.m_videoMaterial=null),this.revokeVideoBlobUrl()},n.prototype.isReady=function(){return null!=this.getVideoElement()},n.prototype.isPlaying=function(){var e=!1,t=this.getVideoElement();return null!=t&&(e=t.paused===!1),e},n.prototype.isPaused=function(){var e=!1,t=this.getVideoElement();return null!=t&&(e=t.paused===!0),e},n.prototype.play=function(){var t=this;return e.SceneManager.HasAudioContext()?this.internalPlay():e.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){t.internalPlay()}),!0},n.prototype.internalPlay=function(){var e=this;this._initializedReadyInstance===!0?this.checkedPlay():this.onReadyObservable.addOnce(function(){e.checkedPlay()})},n.prototype.checkedPlay=function(){var e=this,t=this.getVideoElement();null!=t&&t.play().then(function(){t.paused===!0&&e.checkedRePlay()})},n.prototype.checkedRePlay=function(){var e=this.getVideoElement();null!=e&&e.play().then(function(){})},n.prototype.pause=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.pause(),e=!0),e},n.prototype.mute=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.muted=!0,e=!0),e},n.prototype.unmute=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.muted=!1,e=!0),e},n.prototype.getVolume=function(){var e=0,t=this.getVideoElement();return null!=t&&(e=t.volume),e},n.prototype.setVolume=function(e){var t=!1,n=this.getVideoElement();return null!=n&&(n.volume=e,t=!0),t},n.prototype.setDataSource=function(t){var n=this;null!=this.m_abstractMesh&&(null==this.m_videoMaterial&&(this.m_videoMaterial=new e.StandardMaterial(this.transform.name+".VideoMat",this.scene),this.m_videoMaterial.roughness=1,this.m_videoMaterial.diffuseColor=new e.Color3(1,1,1),this.m_videoMaterial.emissiveColor=new e.Color3(1,1,1),this.m_videoMaterial.useAlphaFromDiffuseTexture=this.videoFaded,this.m_abstractMesh.material=this.m_videoMaterial),null!=this.m_videoMaterial?(this.m_videoMaterial.diffuseTexture=null,null!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),this._initializedReadyInstance=!1,this.m_videoTexture=new e.VideoTexture(this.transform.name+".VideoTex",t,this.scene,this.videoMipmaps,this.videoInvert,this.videoSample,{autoUpdateTexture:!0,poster:this.videoPoster}),null!=this.m_videoTexture&&(this.m_videoTexture.hasAlpha=this.videoAlpha,null!=this.m_videoTexture.video&&(this.m_videoTexture.video.loop=this.videoLoop,this.m_videoTexture.video.muted=this.videoMuted,this.m_videoTexture.video.volume=this.videoVolume,this.m_videoTexture.video.playbackRate=this.videoPlayback,this.m_videoTexture.video.addEventListener("loadeddata",function(){n._initializedReadyInstance=!0,n.onReadyObservable&&n.onReadyObservable.hasObservers()&&n.onReadyObservable.notifyObservers(n.m_videoTexture),n.videoPlayOnAwake===!0&&n.play()}),this.m_videoTexture.video.load())),null!=this.m_videoTexture&&(this.m_videoTexture.level=this.m_diffuseIntensity,this.m_videoMaterial.diffuseTexture=this.m_videoTexture)):e.Tools.Warn("No video mesh or material available for: "+this.transform.name))},n.prototype.revokeVideoBlobUrl=function(){null!=this.videoBlobUrl&&(URL.revokeObjectURL(this.videoBlobUrl),this.videoBlobUrl=null)},n.prototype.addPreloaderTasks=function(e){var t=this;if(this.videoPreload===!0){var n=e.addBinaryFileTask(this.transform.name+".VideoTask",this.videoPreloaderUrl);n.onSuccess=function(e){t.revokeVideoBlobUrl(),t.videoBlobUrl=URL.createObjectURL(new Blob([e.data])),t.setDataSource(t.videoBlobUrl)},n.onError=function(e,t,n){console.error(t,n)}}},n}(e.ScriptComponent);e.WebVideoPlayer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.ConfigureUserInput=function(t,n){void 0===n&&(n=null);var o=null==n||null==n.contextMenu||n.contextMenu,i=null!=n&&null!=n.pointerLock&&n.pointerLock,r=null!=n&&null!=n.preventDefault&&n.preventDefault,a=null!=n&&null!=n.useCapture&&n.useCapture;if(e.InputController.resetUserInput(),!e.InputController.input){document.documentElement.tabIndex=1,document.documentElement.addEventListener("keyup",e.InputController.inputKeyUpHandler,a),document.documentElement.addEventListener("pointerup",e.InputController.inputPointerUpHandler,a);var l=document.getElementById("renderingCanvas")||t.getEngine().getRenderingCanvas();null!=l&&(o===!0?(e.Tools.Log("Canvas element context menu enabled."),l.oncontextmenu=null):(l.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation()},e.Tools.Log("Canvas element context menu disabled."))),e.UserInputOptions.UseCanvasElement===!0?(l.tabIndex=2,l.addEventListener("focusout",e.InputController.resetKeyMapHandler,a),l.addEventListener("keydown",e.InputController.inputKeyDownHandler,a),l.addEventListener("pointerdown",e.InputController.inputPointerDownHandler,a),l.addEventListener("pointermove",e.InputController.inputPointerMoveHandler,a),l.addEventListener("onwheel"in document?"wheel":"mousewheel",e.InputController.inputPointerWheelHandler,a)):(document.documentElement.addEventListener("focusout",e.InputController.resetKeyMapHandler,a),document.documentElement.addEventListener("keydown",e.InputController.inputKeyDownHandler,a),document.documentElement.addEventListener("pointerdown",e.InputController.inputPointerDownHandler,a),document.documentElement.addEventListener("pointermove",e.InputController.inputPointerMoveHandler,a),document.documentElement.addEventListener("onwheel"in document?"wheel":"mousewheel",e.InputController.inputPointerWheelHandler,a)),e.InputController.preventDefault=r,null==e.InputController.GamepadManager&&(e.InputController.GamepadManager=new e.GamepadManager,e.InputController.GamepadManager.onGamepadConnectedObservable.add(e.InputController.inputManagerGamepadConnected),e.InputController.GamepadManager.onGamepadDisconnectedObservable.add(e.InputController.inputManagerGamepadDisconnected)),e.InputController.input=!0,document.documentElement.focus(),i===!0&&e.InputController.LockMousePointer(t,!0)}t.registerAfterRender(function(){e.InputController.updateUserInput(t)})},t.SetLeftJoystickBuffer=function(t,n,o){void 0===o&&(o=!0),e.InputController.j_horizontal=t,e.InputController.j_vertical=o===!0?-n:n},t.SetRightJoystickBuffer=function(t,n,o){void 0===o&&(o=!0),e.InputController.j_mousex=t,e.InputController.j_mousey=o===!0?-n:n},t.DisableUserInput=function(t,n){void 0===n&&(n=!1),e.InputController.LockMousePointer(t,!1),e.InputController.resetUserInput()},t.LockMousePointer=function(t,n){n===!0?e.InputController.LockMousePointerObserver=t.onPointerObservable.add(function(n,o){n.type==e.PointerEventTypes.POINTERDOWN&&(document.pointerLockElement||t.getEngine().enterPointerlock())}):e.InputController.IsPointerLockHandled()&&(t.onPointerObservable.remove(e.InputController.LockMousePointerObserver),e.InputController.LockMousePointerObserver=null)},t.IsPointerLocked=function(){return e.InputController.PointerLockedFlag},t.IsPointerLockHandled=function(){return null!=e.InputController.LockMousePointerObserver},t.GetUserInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=0;if(e.InputController.input)switch(t){case e.UserInputAxis.Vertical:case e.UserInputAxis.Horizontal:o=n===e.PlayerNumber.Four?t===e.UserInputAxis.Horizontal?e.InputController.horizontal4:e.InputController.vertical4:n===e.PlayerNumber.Three?t===e.UserInputAxis.Horizontal?e.InputController.horizontal3:e.InputController.vertical3:n===e.PlayerNumber.Two?t===e.UserInputAxis.Horizontal?e.InputController.horizontal2:e.InputController.vertical2:t===e.UserInputAxis.Horizontal?e.InputController.horizontal:e.InputController.vertical;break;case e.UserInputAxis.MouseX:case e.UserInputAxis.MouseY:o=n===e.PlayerNumber.Four?t===e.UserInputAxis.MouseX?e.InputController.mousex4:e.InputController.mousey4:n===e.PlayerNumber.Three?t===e.UserInputAxis.MouseX?e.InputController.mousex3:e.InputController.mousey3:n===e.PlayerNumber.Two?t===e.UserInputAxis.MouseX?e.InputController.mousex2:e.InputController.mousey2:t===e.UserInputAxis.MouseX?e.InputController.mousex:e.InputController.mousey;break;case e.UserInputAxis.Wheel:n===e.PlayerNumber.One&&(o=e.InputController.wheel)}return o},t.OnKeyboardUp=function(t){e.InputController.input&&e.InputController.keyButtonUp.push(t)},t.OnKeyboardDown=function(t){e.InputController.input&&e.InputController.keyButtonDown.push(t)},t.OnKeyboardPress=function(t,n){e.InputController.input&&e.InputController.keyButtonPress.push({index:t,action:n})},t.GetKeyboardInput=function(t){var n=!1;if(e.InputController.input){var o="k:"+t.toString();null!=e.InputController.keymap[o]&&(n=e.InputController.keymap[o])}return n},t.OnPointerUp=function(t){e.InputController.input&&e.InputController.mouseButtonUp.push(t)},t.OnPointerDown=function(t){e.InputController.input&&e.InputController.mouseButtonDown.push(t)},t.OnPointerPress=function(t,n){e.InputController.input&&e.InputController.mouseButtonPress.push({index:t,action:n})},t.GetPointerInput=function(t){var n=!1;if(e.InputController.input){var o="p:"+t.toString();null!=e.InputController.keymap[o]&&(n=e.InputController.keymap[o])}return n},t.IsWheelScrolling=function(){return 0!==e.InputController.scroll},t.OnGamepadButtonUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1ButtonUp.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonUp.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonUp.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonUp.push(t)}},t.OnGamepadButtonDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1ButtonDown.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonDown.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonDown.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonDown.push(t)}},t.OnGamepadButtonPress=function(t,n,o){if(void 0===o&&(o=e.PlayerNumber.One),e.InputController.input)switch(o){case e.PlayerNumber.One:e.InputController.gamepad1ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonPress.push({index:t,action:n})}},t.GetGamepadButtonInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="b1:"+t.toString();break;case e.PlayerNumber.Two:i="b2:"+t.toString();break;case e.PlayerNumber.Three:i="b3:"+t.toString();break;case e.PlayerNumber.Four:i="b4:"+t.toString()}null!=i&&null!=e.InputController.keymap[i]&&(o=e.InputController.keymap[i])}return o},t.OnGamepadDirectionUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1DpadUp.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadUp.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadUp.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadUp.push(t)}},t.OnGamepadDirectionDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1DpadDown.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadDown.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadDown.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadDown.push(t)}},t.OnGamepadDirectionPress=function(t,n,o){if(void 0===o&&(o=e.PlayerNumber.One),e.InputController.input)switch(o){case e.PlayerNumber.One:e.InputController.gamepad1DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadPress.push({index:t,action:n})}},t.GetGamepadDirectionInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="d1:"+t.toString();break;case e.PlayerNumber.Two:i="d2:"+t.toString();break;case e.PlayerNumber.Three:i="d3:"+t.toString();break;case e.PlayerNumber.Four:i="d4:"+t.toString()}null!=i&&null!=e.InputController.keymap[i]&&(o=e.InputController.keymap[i])}return o},t.OnGamepadTriggerLeft=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1LeftTrigger.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2LeftTrigger.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3LeftTrigger.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4LeftTrigger.push(t)}},t.OnGamepadTriggerRight=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1RightTrigger.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2RightTrigger.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3RightTrigger.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4RightTrigger.push(t)}},t.GetGamepadTriggerInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=0;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="t1:"+t.toString();break;case e.PlayerNumber.Two:i="t2:"+t.toString();break;case e.PlayerNumber.Three:i="t3:"+t.toString();break;case e.PlayerNumber.Four:i="t4:"+t.toString()}null!=i&&null!=e.InputController.keymap[i]&&(o=e.InputController.keymap[i])}return o},t.GetGamepadType=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=e.GamepadType.None;if(e.InputController.input)switch(t){case e.PlayerNumber.One:n=e.InputController.gamepad1Type;break;case e.PlayerNumber.Two:n=e.InputController.gamepad2Type;break;case e.PlayerNumber.Three:n=e.InputController.gamepad3Type;break;case e.PlayerNumber.Four:n=e.InputController.gamepad4Type}return n},t.GetGamepad=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(e.InputController.input)switch(t){case e.PlayerNumber.One:n=e.InputController.gamepad1;break;case e.PlayerNumber.Two:n=e.InputController.gamepad2;break;case e.PlayerNumber.Three:n=e.InputController.gamepad3;break;case e.PlayerNumber.Four:n=e.InputController.gamepad4}return n},t.tickKeyboardInput=function(t){if(e.SceneManager.EnableUserInput!==!1){var n=e.InputController.GetKeyboardInput(e.UserInputKey.W)||e.InputController.GetKeyboardInput(e.UserInputKey.UpArrow),o=e.InputController.GetKeyboardInput(e.UserInputKey.A),i=e.InputController.GetKeyboardInput(e.UserInputKey.S)||e.InputController.GetKeyboardInput(e.UserInputKey.DownArrow),r=e.InputController.GetKeyboardInput(e.UserInputKey.D),a=e.InputController.GetKeyboardInput(e.UserInputKey.LeftArrow),l=e.InputController.GetKeyboardInput(e.UserInputKey.RightArrow);n===!0?e.InputController.k_vertical=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_vertical,1):i===!0?e.InputController.k_vertical=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_vertical,-1):e.InputController.k_vertical=0,e.UserInputOptions.UseArrowKeyRotation===!0?(r===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,1):o===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,-1):e.InputController.k_horizontal=0,l===!0?e.InputController.a_mousex=1:a===!0?e.InputController.a_mousex=-1:e.InputController.a_mousex=0):r===!0||l===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,1):o===!0||a===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,-1):e.InputController.k_horizontal=0}},t.updateUserInput=function(t){e.SceneManager.EnableUserInput!==!1&&(e.InputController.PointerLockedFlag=t.getEngine().isPointerLock,e.InputController.tickKeyboardInput(t),e.InputController.x_horizontal=0,e.InputController.x_vertical=0,e.InputController.x_mousex=0,e.InputController.x_mousey=0,0!==e.InputController.j_horizontal?e.InputController.x_horizontal=e.InputController.j_horizontal:0!==e.InputController.g_horizontal1?e.InputController.x_horizontal=e.InputController.g_horizontal1:0!==e.InputController.k_horizontal&&(e.InputController.x_horizontal=e.InputController.k_horizontal),0!==e.InputController.j_vertical?e.InputController.x_vertical=e.InputController.j_vertical:0!==e.InputController.g_vertical1?e.InputController.x_vertical=e.InputController.g_vertical1:0!==e.InputController.k_vertical&&(e.InputController.x_vertical=e.InputController.k_vertical),0!==e.InputController.j_mousex?e.InputController.x_mousex=e.InputController.j_mousex:0!==e.InputController.g_mousex1?e.InputController.x_mousex=e.InputController.g_mousex1:0!==e.InputController.a_mousex?e.InputController.x_mousex=e.InputController.a_mousex:0!==e.InputController.k_mousex&&(e.InputController.x_mousex=e.InputController.k_mousex),0!==e.InputController.j_mousey?e.InputController.x_mousey=e.InputController.j_mousey:0!==e.InputController.g_mousey1?e.InputController.x_mousey=e.InputController.g_mousey1:0!==e.InputController.k_mousey&&(e.InputController.x_mousey=e.InputController.k_mousey),e.InputController.horizontal=e.InputController.x_horizontal,e.InputController.vertical=e.InputController.x_vertical,e.InputController.mousex=e.InputController.x_mousex,e.InputController.mousey=e.InputController.x_mousey,e.InputController.scroll=e.InputController.x_scroll,e.InputController.wheel=e.InputController.x_wheel,e.InputController.horizontal2=e.InputController.g_horizontal2,e.InputController.vertical2=e.InputController.g_vertical2,e.InputController.mousex2=e.InputController.g_mousex2,e.InputController.mousey2=e.InputController.g_mousey2,e.InputController.horizontal3=e.InputController.g_horizontal3,e.InputController.vertical3=e.InputController.g_vertical3,e.InputController.mousex3=e.InputController.g_mousex3,e.InputController.mousey3=e.InputController.g_mousey3,e.InputController.horizontal4=e.InputController.g_horizontal4,e.InputController.vertical4=e.InputController.g_vertical4,e.InputController.mousex4=e.InputController.g_mousex4,e.InputController.mousey4=e.InputController.g_mousey4,e.InputController.k_mousex=0,e.InputController.k_mousey=0,e.InputController.x_mousey=0,e.InputController.x_scroll=0)},t.resetUserInput=function(){e.InputController.input=!1,e.InputController.keymap={},e.InputController.scroll=0,e.InputController.wheel=0,e.InputController.mousex=0,e.InputController.mousey=0,e.InputController.vertical=0,e.InputController.horizontal=0,e.InputController.mousex2=0,e.InputController.mousey2=0,e.InputController.vertical2=0,e.InputController.horizontal2=0,e.InputController.mousex3=0,e.InputController.mousey3=0,e.InputController.vertical3=0,e.InputController.horizontal3=0,e.InputController.mousex4=0,e.InputController.mousey4=0,e.InputController.vertical4=0,e.InputController.horizontal4=0,e.InputController.a_mousex=0,e.InputController.x_scroll=0,e.InputController.x_wheel=0,e.InputController.x_mousex=0,e.InputController.x_mousey=0,e.InputController.x_vertical=0,e.InputController.x_horizontal=0,e.InputController.k_mousex=0,e.InputController.k_mousey=0,e.InputController.k_vertical=0,e.InputController.k_horizontal=0,e.InputController.j_mousex=0,e.InputController.j_mousey=0,e.InputController.j_vertical=0,e.InputController.j_horizontal=0,e.InputController.g_mousex1=0,e.InputController.g_mousey1=0,e.InputController.g_vertical1=0,e.InputController.g_horizontal1=0,e.InputController.g_mousex2=0,e.InputController.g_mousey2=0,e.InputController.g_vertical2=0,e.InputController.g_horizontal2=0,e.InputController.g_mousex3=0,e.InputController.g_mousey3=0,e.InputController.g_vertical3=0,e.InputController.g_horizontal3=0,e.InputController.g_mousex4=0,e.InputController.g_mousey4=0,e.InputController.g_vertical4=0,e.InputController.g_horizontal4=0,e.InputController.preventDefault=!1,e.InputController.mouseButtonUp=[],e.InputController.mouseButtonDown=[],e.InputController.mouseButtonPress=[],e.InputController.keyButtonUp=[],e.InputController.keyButtonDown=[],e.InputController.keyButtonPress=[],e.InputController.gamepad1ButtonUp=[],e.InputController.gamepad1ButtonDown=[],e.InputController.gamepad1ButtonPress=[],e.InputController.gamepad1DpadUp=[],e.InputController.gamepad1DpadDown=[],e.InputController.gamepad1DpadPress=[],e.InputController.gamepad1LeftTrigger=[],e.InputController.gamepad1RightTrigger=[],e.InputController.gamepad2ButtonUp=[],e.InputController.gamepad2ButtonDown=[],e.InputController.gamepad2ButtonPress=[],e.InputController.gamepad2DpadUp=[],e.InputController.gamepad2DpadDown=[],e.InputController.gamepad2DpadPress=[],e.InputController.gamepad2LeftTrigger=[],e.InputController.gamepad2RightTrigger=[],e.InputController.gamepad3ButtonUp=[],e.InputController.gamepad3ButtonDown=[],e.InputController.gamepad3ButtonPress=[],e.InputController.gamepad3DpadUp=[],e.InputController.gamepad3DpadDown=[],e.InputController.gamepad3DpadPress=[],e.InputController.gamepad3LeftTrigger=[],e.InputController.gamepad3RightTrigger=[],e.InputController.gamepad4ButtonUp=[],e.InputController.gamepad4ButtonDown=[],e.InputController.gamepad4ButtonPress=[],e.InputController.gamepad4DpadUp=[],e.InputController.gamepad4DpadDown=[],e.InputController.gamepad4DpadPress=[],e.InputController.gamepad4LeftTrigger=[],e.InputController.gamepad4RightTrigger=[],e.InputController.previousPosition=null},t.resetKeyMapHandler=function(t){e.InputController.keymap={}},t.inputKeyDownHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n="k:"+t.keyCode.toString(),o=!1;return null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.keyButtonDown&&e.InputController.keyButtonDown.length>0&&e.InputController.keyButtonDown.forEach(function(e){e(t.keyCode)}),o||null!=e.InputController.keyButtonPress&&e.InputController.keyButtonPress.length>0&&e.InputController.keyButtonPress.forEach(function(e){e.index===t.keyCode&&e.action()}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputKeyUpHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n="k:"+t.keyCode.toString();return e.InputController.keymap[n]=!1,null!=e.InputController.keyButtonUp&&e.InputController.keyButtonUp.length>0&&e.InputController.keyButtonUp.forEach(function(e){e(t.keyCode)}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerWheelHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n=t.deltaY?-t.deltaY:t.wheelDelta/40;return e.InputController.x_scroll=1,e.InputController.x_wheel=Math.abs(n)>e.UserInputOptions.PointerWheelDeadZone?0+n:0,e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerDownHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;e.InputController.previousPosition={x:t.clientX,y:t.clientY};var n="p:"+t.button.toString(),o=!1;return null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.mouseButtonDown&&e.InputController.mouseButtonDown.length>0&&e.InputController.mouseButtonDown.forEach(function(e){e(t.button)}),o||null!=e.InputController.mouseButtonPress&&e.InputController.mouseButtonPress.length>0&&e.InputController.mouseButtonPress.forEach(function(e){e.index===t.button&&e.action()}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerUpHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;e.InputController.previousPosition=null,e.InputController.k_mousex=0,e.InputController.k_mousey=0;var n="p:"+t.button.toString();return e.InputController.keymap[n]=!1,null!=e.InputController.mouseButtonUp&&e.InputController.mouseButtonUp.length>0&&e.InputController.mouseButtonUp.forEach(function(e){e(t.button)}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerMoveHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;if(e.SceneManager.VirtualJoystickEnabled===!1){var n=0,o=0;e.InputController.IsPointerLocked()?(n=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,o=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0,e.InputController.previousPosition=null):null!=e.InputController.previousPosition&&(n=t.clientX-e.InputController.previousPosition.x,o=t.clientY-e.InputController.previousPosition.y,e.InputController.previousPosition={x:t.clientX,y:t.clientY}),e.UserInputOptions.PointerMouseInverted===!0&&(n*=-1,o*=-1),e.InputController.rightHanded&&(n*=-1);var i=n*e.UserInputOptions.PointerAngularSensibility*e.InputController.MOUSE_DAMPENER,r=o*e.UserInputOptions.PointerAngularSensibility*e.InputController.MOUSE_DAMPENER;Math.abs(n)<=e.UserInputOptions.PointerMouseDeadZone&&(i=0),Math.abs(o)<=e.UserInputOptions.PointerMouseDeadZone&&(r=0),i=e.Scalar.Clamp(i,-1,1),r=e.Scalar.Clamp(r,-1,1),e.InputController.k_mousex+=i,e.InputController.k_mousey+=r}return e.InputController.preventDefault&&t.preventDefault(),!0},t.inputOneButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="b1:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1ButtonDown&&e.InputController.gamepad1ButtonDown.length>0&&e.InputController.gamepad1ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad1ButtonPress&&e.InputController.gamepad1ButtonPress.length>0&&e.InputController.gamepad1ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="b1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1ButtonUp&&e.InputController.gamepad1ButtonUp.length>0&&e.InputController.gamepad1ButtonUp.forEach(function(e){e(t)})}},t.inputOneXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1DpadDown&&e.InputController.gamepad1DpadDown.length>0&&e.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad1DpadPress&&e.InputController.gamepad1DpadPress.length>0&&e.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1DpadDown&&e.InputController.gamepad1DpadDown.length>0&&e.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad1DpadPress&&e.InputController.gamepad1DpadPress.length>0&&e.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1DpadUp&&e.InputController.gamepad1DpadUp.length>0&&e.InputController.gamepad1DpadUp.forEach(function(e){e(t)})}},t.inputOneShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1DpadUp&&e.InputController.gamepad1DpadUp.length>0&&e.InputController.gamepad1DpadUp.forEach(function(e){
e(t)})}},t.inputOneXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1&&(e.InputController.keymap["t1:0"]=t,null!=e.InputController.gamepad1LeftTrigger&&e.InputController.gamepad1LeftTrigger.length>0&&e.InputController.gamepad1LeftTrigger.forEach(function(e){e(t)}))},t.inputOneXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1&&(e.InputController.keymap["t1:1"]=t,null!=e.InputController.gamepad1RightTrigger&&e.InputController.gamepad1RightTrigger.length>0&&e.InputController.gamepad1RightTrigger.forEach(function(e){e(t)}))},t.inputOneLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal1=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical1=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputOneRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex1=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey1=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputTwoButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="b2:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2ButtonDown&&e.InputController.gamepad2ButtonDown.length>0&&e.InputController.gamepad2ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad2ButtonPress&&e.InputController.gamepad2ButtonPress.length>0&&e.InputController.gamepad2ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="b2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2ButtonUp&&e.InputController.gamepad2ButtonUp.length>0&&e.InputController.gamepad2ButtonUp.forEach(function(e){e(t)})}},t.inputTwoXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2DpadDown&&e.InputController.gamepad2DpadDown.length>0&&e.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad2DpadPress&&e.InputController.gamepad2DpadPress.length>0&&e.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2DpadDown&&e.InputController.gamepad2DpadDown.length>0&&e.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad2DpadPress&&e.InputController.gamepad2DpadPress.length>0&&e.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2DpadUp&&e.InputController.gamepad2DpadUp.length>0&&e.InputController.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2DpadUp&&e.InputController.gamepad2DpadUp.length>0&&e.InputController.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2&&(e.InputController.keymap["t2:0"]=t,null!=e.InputController.gamepad2LeftTrigger&&e.InputController.gamepad2LeftTrigger.length>0&&e.InputController.gamepad2LeftTrigger.forEach(function(e){e(t)}))},t.inputTwoXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2&&(e.InputController.keymap["t2:1"]=t,null!=e.InputController.gamepad2RightTrigger&&e.InputController.gamepad2RightTrigger.length>0&&e.InputController.gamepad2RightTrigger.forEach(function(e){e(t)}))},t.inputTwoLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal2=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical2=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputTwoRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex2=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey2=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputThreeButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="b3:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3ButtonDown&&e.InputController.gamepad3ButtonDown.length>0&&e.InputController.gamepad3ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad3ButtonPress&&e.InputController.gamepad3ButtonPress.length>0&&e.InputController.gamepad3ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="b3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3ButtonUp&&e.InputController.gamepad3ButtonUp.length>0&&e.InputController.gamepad3ButtonUp.forEach(function(e){e(t)})}},t.inputThreeXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3DpadDown&&e.InputController.gamepad3DpadDown.length>0&&e.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad3DpadPress&&e.InputController.gamepad3DpadPress.length>0&&e.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3DpadDown&&e.InputController.gamepad3DpadDown.length>0&&e.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad3DpadPress&&e.InputController.gamepad3DpadPress.length>0&&e.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3DpadUp&&e.InputController.gamepad3DpadUp.length>0&&e.InputController.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3DpadUp&&e.InputController.gamepad3DpadUp.length>0&&e.InputController.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3&&(e.InputController.keymap["t3:0"]=t,null!=e.InputController.gamepad3LeftTrigger&&e.InputController.gamepad3LeftTrigger.length>0&&e.InputController.gamepad3LeftTrigger.forEach(function(e){e(t)}))},t.inputThreeXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3&&(e.InputController.keymap["t3:1"]=t,null!=e.InputController.gamepad3RightTrigger&&e.InputController.gamepad3RightTrigger.length>0&&e.InputController.gamepad3RightTrigger.forEach(function(e){e(t)}))},t.inputThreeLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal3=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical3=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputThreeRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex3=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey3=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputFourButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="b4:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4ButtonDown&&e.InputController.gamepad4ButtonDown.length>0&&e.InputController.gamepad4ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad4ButtonPress&&e.InputController.gamepad4ButtonPress.length>0&&e.InputController.gamepad4ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="b4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4ButtonUp&&e.InputController.gamepad4ButtonUp.length>0&&e.InputController.gamepad4ButtonUp.forEach(function(e){e(t)})}},t.inputFourXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4DpadDown&&e.InputController.gamepad4DpadDown.length>0&&e.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad4DpadPress&&e.InputController.gamepad4DpadPress.length>0&&e.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4DpadDown&&e.InputController.gamepad4DpadDown.length>0&&e.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad4DpadPress&&e.InputController.gamepad4DpadPress.length>0&&e.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4DpadUp&&e.InputController.gamepad4DpadUp.length>0&&e.InputController.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4DpadUp&&e.InputController.gamepad4DpadUp.length>0&&e.InputController.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4&&(e.InputController.keymap["t4:0"]=t,null!=e.InputController.gamepad4LeftTrigger&&e.InputController.gamepad4LeftTrigger.length>0&&e.InputController.gamepad4LeftTrigger.forEach(function(e){e(t)}))},t.inputFourXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4&&(e.InputController.keymap["t4:1"]=t,null!=e.InputController.gamepad4RightTrigger&&e.InputController.gamepad4RightTrigger.length>0&&e.InputController.gamepad4RightTrigger.forEach(function(e){e(t)}))},t.inputFourLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal4=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical4=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputFourRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex4=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey4=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputManagerGamepadConnected=function(t,n){if(null==e.InputController.gamepad1&&0===t.index)if(e.InputController.gamepad1=t,e.Tools.Log("Gamepad One Connected: "+e.InputController.gamepad1.id),e.InputController.gamepad1 instanceof e.Xbox360Pad){e.InputController.gamepad1Type=e.GamepadType.Xbox360;var o=e.InputController.gamepad1;o.onbuttonup(e.InputController.inputOneButtonUpHandler),o.onbuttondown(e.InputController.inputOneButtonDownHandler),o.onleftstickchanged(e.InputController.inputOneLeftStickHandler),o.onrightstickchanged(e.InputController.inputOneRightStickHandler),o.ondpadup(e.InputController.inputOneXboxDPadUpHandler),o.ondpaddown(e.InputController.inputOneXboxDPadDownHandler),o.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),o.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad1 instanceof e.DualShockPad){e.InputController.gamepad1Type=e.GamepadType.DualShock;var i=e.InputController.gamepad1;i.onbuttonup(e.InputController.inputOneButtonUpHandler),i.onbuttondown(e.InputController.inputOneButtonDownHandler),i.onleftstickchanged(e.InputController.inputOneLeftStickHandler),i.onrightstickchanged(e.InputController.inputOneRightStickHandler),i.ondpadup(e.InputController.inputOneShockDPadUpHandler),i.ondpaddown(e.InputController.inputOneShockDPadDownHandler),i.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),i.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad1 instanceof e.PoseEnabledController);else{e.InputController.gamepad1Type=e.GamepadType.Generic;var r=e.InputController.gamepad1;r.onbuttonup(e.InputController.inputOneButtonUpHandler),r.onbuttondown(e.InputController.inputOneButtonDownHandler),r.onleftstickchanged(e.InputController.inputOneLeftStickHandler),r.onrightstickchanged(e.InputController.inputOneRightStickHandler)}if(null==e.InputController.gamepad2&&1===t.index)if(e.InputController.gamepad2=t,e.Tools.Log("Gamepad Two Connected: "+e.InputController.gamepad2.id),e.InputController.gamepad2 instanceof e.Xbox360Pad){e.InputController.gamepad2Type=e.GamepadType.Xbox360;var a=e.InputController.gamepad2;a.onbuttonup(e.InputController.inputTwoButtonUpHandler),a.onbuttondown(e.InputController.inputTwoButtonDownHandler),a.onleftstickchanged(e.InputController.inputTwoLeftStickHandler),a.onrightstickchanged(e.InputController.inputTwoRightStickHandler),a.ondpadup(e.InputController.inputTwoXboxDPadUpHandler),a.ondpaddown(e.InputController.inputTwoXboxDPadDownHandler),a.onlefttriggerchanged(e.InputController.inputTwoXboxLeftTriggerHandler),a.onrighttriggerchanged(e.InputController.inputTwoXboxRightTriggerHandler)}else if(e.InputController.gamepad2 instanceof e.DualShockPad){e.InputController.gamepad2Type=e.GamepadType.DualShock;var l=e.InputController.gamepad2;l.onbuttonup(e.InputController.inputOneButtonUpHandler),l.onbuttondown(e.InputController.inputOneButtonDownHandler),l.onleftstickchanged(e.InputController.inputOneLeftStickHandler),l.onrightstickchanged(e.InputController.inputOneRightStickHandler),l.ondpadup(e.InputController.inputOneShockDPadUpHandler),l.ondpaddown(e.InputController.inputOneShockDPadDownHandler),l.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),l.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad2 instanceof e.PoseEnabledController);else{e.InputController.gamepad2Type=e.GamepadType.Generic;var s=e.InputController.gamepad2;s.onbuttonup(e.InputController.inputTwoButtonUpHandler),s.onbuttondown(e.InputController.inputTwoButtonDownHandler),s.onleftstickchanged(e.InputController.inputTwoLeftStickHandler),s.onrightstickchanged(e.InputController.inputTwoRightStickHandler)}if(null==e.InputController.gamepad3&&2===t.index)if(e.InputController.gamepad3=t,e.Tools.Log("Gamepad Three Connected: "+e.InputController.gamepad3.id),e.InputController.gamepad3 instanceof e.Xbox360Pad){e.InputController.gamepad3Type=e.GamepadType.Xbox360;var u=e.InputController.gamepad3;u.onbuttonup(e.InputController.inputThreeButtonUpHandler),u.onbuttondown(e.InputController.inputThreeButtonDownHandler),u.onleftstickchanged(e.InputController.inputThreeLeftStickHandler),u.onrightstickchanged(e.InputController.inputThreeRightStickHandler),u.ondpadup(e.InputController.inputThreeXboxDPadUpHandler),u.ondpaddown(e.InputController.inputThreeXboxDPadDownHandler),u.onlefttriggerchanged(e.InputController.inputThreeXboxLeftTriggerHandler),u.onrighttriggerchanged(e.InputController.inputThreeXboxRightTriggerHandler)}else if(e.InputController.gamepad3 instanceof e.DualShockPad){var c=e.InputController.gamepad3;c.onbuttonup(e.InputController.inputOneButtonUpHandler),c.onbuttondown(e.InputController.inputOneButtonDownHandler),c.onleftstickchanged(e.InputController.inputOneLeftStickHandler),c.onrightstickchanged(e.InputController.inputOneRightStickHandler),c.ondpadup(e.InputController.inputOneShockDPadUpHandler),c.ondpaddown(e.InputController.inputOneShockDPadDownHandler),c.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),c.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad3 instanceof e.PoseEnabledController);else{e.InputController.gamepad3Type=e.GamepadType.Generic;var p=e.InputController.gamepad3;p.onbuttonup(e.InputController.inputThreeButtonUpHandler),p.onbuttondown(e.InputController.inputThreeButtonDownHandler),p.onleftstickchanged(e.InputController.inputThreeLeftStickHandler),p.onrightstickchanged(e.InputController.inputThreeRightStickHandler)}if(null==e.InputController.gamepad4&&3===t.index)if(e.InputController.gamepad4=t,e.Tools.Log("Gamepad Four Connected: "+e.InputController.gamepad4.id),e.InputController.gamepad4 instanceof e.Xbox360Pad){e.InputController.gamepad4Type=e.GamepadType.Xbox360;var h=e.InputController.gamepad4;h.onbuttonup(e.InputController.inputFourButtonUpHandler),h.onbuttondown(e.InputController.inputFourButtonDownHandler),h.onleftstickchanged(e.InputController.inputFourLeftStickHandler),h.onrightstickchanged(e.InputController.inputFourRightStickHandler),h.ondpadup(e.InputController.inputFourXboxDPadUpHandler),h.ondpaddown(e.InputController.inputFourXboxDPadDownHandler),h.onlefttriggerchanged(e.InputController.inputFourXboxLeftTriggerHandler),h.onrighttriggerchanged(e.InputController.inputFourXboxRightTriggerHandler)}else if(e.InputController.gamepad4 instanceof e.DualShockPad){var d=e.InputController.gamepad4;d.onbuttonup(e.InputController.inputOneButtonUpHandler),d.onbuttondown(e.InputController.inputOneButtonDownHandler),d.onleftstickchanged(e.InputController.inputOneLeftStickHandler),d.onrightstickchanged(e.InputController.inputOneRightStickHandler),d.ondpadup(e.InputController.inputOneShockDPadUpHandler),d.ondpaddown(e.InputController.inputOneShockDPadDownHandler),d.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),d.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad4 instanceof e.PoseEnabledController);else{e.InputController.gamepad4Type=e.GamepadType.Generic;var m=e.InputController.gamepad4;m.onbuttonup(e.InputController.inputFourButtonUpHandler),m.onbuttondown(e.InputController.inputFourButtonDownHandler),m.onleftstickchanged(e.InputController.inputFourLeftStickHandler),m.onrightstickchanged(e.InputController.inputFourRightStickHandler)}null!=e.InputController.GamepadConnected&&e.InputController.GamepadConnected(t,n)},t.inputManagerGamepadDisconnected=function(t,n){null!=e.InputController.GamepadDisconnected&&e.InputController.GamepadDisconnected(t,n)},t.inputManagerLeftControllerMainButton=function(e,t){},t.inputManagerLeftControllerPadState=function(e,t){},t.inputManagerLeftControllerPadValues=function(e,t){},t.inputManagerLeftControllerAuxButton=function(e,t){},t.inputManagerLeftControllerTriggered=function(e,t){},t.inputManagerRightControllerMainButton=function(e,t){},t.inputManagerRightControllerPadState=function(e,t){},t.inputManagerRightControllerPadValues=function(e,t){},t.inputManagerRightControllerAuxButton=function(e,t){},t.inputManagerRightControllerTriggered=function(e,t){},t.inputManagerControllerConnected=function(e,t){},t.MOUSE_DAMPENER=.5,t.GamepadManager=null,t.GamepadConnected=null,t.GamepadDisconnected=null,t.PointerLockedFlag=!1,t.LockMousePointerObserver=null,t.input=!1,t.keymap={},t.scroll=0,t.wheel=0,t.mousex=0,t.mousey=0,t.vertical=0,t.horizontal=0,t.mousex2=0,t.mousey2=0,t.vertical2=0,t.horizontal2=0,t.mousex3=0,t.mousey3=0,t.vertical3=0,t.horizontal3=0,t.mousex4=0,t.mousey4=0,t.vertical4=0,t.horizontal4=0,t.a_mousex=0,t.x_scroll=0,t.x_wheel=0,t.x_mousex=0,t.x_mousey=0,t.x_vertical=0,t.x_horizontal=0,t.k_mousex=0,t.k_mousey=0,t.k_vertical=0,t.k_horizontal=0,t.j_mousex=0,t.j_mousey=0,t.j_vertical=0,t.j_horizontal=0,t.g_mousex1=0,t.g_mousey1=0,t.g_vertical1=0,t.g_horizontal1=0,t.g_mousex2=0,t.g_mousey2=0,t.g_vertical2=0,t.g_horizontal2=0,t.g_mousex3=0,t.g_mousey3=0,t.g_vertical3=0,t.g_horizontal3=0,t.g_mousex4=0,t.g_mousey4=0,t.g_vertical4=0,t.g_horizontal4=0,t.mouseButtonPress=[],t.mouseButtonDown=[],t.mouseButtonUp=[],t.keyButtonPress=[],t.keyButtonDown=[],t.keyButtonUp=[],t.previousPosition=null,t.preventDefault=!1,t.rightHanded=!0,t.gamepad1=null,t.gamepad1Type=-1,t.gamepad1ButtonPress=[],t.gamepad1ButtonDown=[],t.gamepad1ButtonUp=[],t.gamepad1DpadPress=[],t.gamepad1DpadDown=[],t.gamepad1DpadUp=[],t.gamepad1LeftTrigger=[],t.gamepad1RightTrigger=[],t.gamepad2=null,t.gamepad2Type=-1,t.gamepad2ButtonPress=[],t.gamepad2ButtonDown=[],t.gamepad2ButtonUp=[],t.gamepad2DpadPress=[],t.gamepad2DpadDown=[],t.gamepad2DpadUp=[],t.gamepad2LeftTrigger=[],t.gamepad2RightTrigger=[],t.gamepad3=null,t.gamepad3Type=-1,t.gamepad3ButtonPress=[],t.gamepad3ButtonDown=[],t.gamepad3ButtonUp=[],t.gamepad3DpadPress=[],t.gamepad3DpadDown=[],t.gamepad3DpadUp=[],t.gamepad3LeftTrigger=[],t.gamepad3RightTrigger=[],t.gamepad4=null,t.gamepad4Type=-1,t.gamepad4ButtonPress=[],t.gamepad4ButtonDown=[],t.gamepad4ButtonUp=[],t.gamepad4DpadPress=[],t.gamepad4DpadDown=[],t.gamepad4DpadUp=[],t.gamepad4LeftTrigger=[],t.gamepad4RightTrigger=[],t}();e.InputController=t;var n=function(){function e(e,t,n){var o=this;this.active=!1,this.touchId=null,this.dragStart=null,this.maxDistance=0,this.deadZone=0,this.xvalue=0,this.yvalue=0,this.stick=null,this.touchId=null,this.dragStart=null,this.active=!1,this.xvalue=0,this.yvalue=0,this.deadZone=n,this.maxDistance=t,this.stick=document.getElementById(e),null!=this.stick?(this.stick.addEventListener("mousedown",function(e){o.handleDown(e)}),this.stick.addEventListener("touchstart",function(e){o.handleDown(e)}),document.addEventListener("mousemove",function(e){o.handleMove(e)},{passive:!1}),document.addEventListener("touchmove",function(e){o.handleMove(e)},{passive:!1}),document.addEventListener("mouseup",function(e){o.handleUp(e)}),document.addEventListener("touchend",function(e){o.handleUp(e)})):console.warn("Failed to locate joystick element: "+e)}return e.prototype.getValueX=function(){return this.xvalue},e.prototype.getValueY=function(){return this.yvalue},e.prototype.getStickElement=function(){return this.stick},e.prototype.dispose=function(){},e.prototype.handleDown=function(e){this.active=!0,this.stick.style.transition="0s",e.preventDefault(),e.changedTouches?this.dragStart={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:this.dragStart={x:e.clientX,y:e.clientY},e.changedTouches&&(this.touchId=e.changedTouches[0].identifier)},e.prototype.handleMove=function(e){if(this.active){var t=null;if(e.changedTouches){for(var n=0;n<e.changedTouches.length;n++)this.touchId==e.changedTouches[n].identifier&&(t=n,e.clientX=e.changedTouches[n].clientX,e.clientY=e.changedTouches[n].clientY);if(null==t)return}var o=e.clientX-this.dragStart.x,i=e.clientY-this.dragStart.y,r=Math.atan2(i,o),a=Math.min(this.maxDistance,Math.hypot(o,i)),l=a*Math.cos(r),s=a*Math.sin(r);this.stick.style.transform="translate3d(".concat(l,"px, ").concat(s,"px, 0px)");var u=a<this.deadZone?0:this.maxDistance/(this.maxDistance-this.deadZone)*(a-this.deadZone),c=u*Math.cos(r),p=u*Math.sin(r),h=parseFloat((c/this.maxDistance).toFixed(4)),d=parseFloat((p/this.maxDistance).toFixed(4));this.xvalue=h,this.yvalue=d}},e.prototype.handleUp=function(e){this.active&&(e.changedTouches&&this.touchId!=e.changedTouches[0].identifier||(this.stick.style.transition=".2s",this.stick.style.transform="translate3d(0px, 0px, 0px)",this.xvalue=0,this.yvalue=0,this.touchId=null,this.active=!1))},e}();e.TouchJoystickHandler=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.IsWindows=function(){return"undefined"!=typeof Windows&&"undefined"!=typeof Windows.UI&&"undefined"!=typeof Windows.System&&"undefined"!=typeof Windows.Foundation},t.IsCordova=function(){return null!=window.cordova},t.IsWebAssembly=function(){return window.WebAssembly},t.IsOculusBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/OculusBrowser/i)&&(e=!0),e},t.IsSamsungBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/SamsungBrowser/i)&&(e=!0),e},t.IsWindowsPhone=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Windows Phone/i)&&(e=!0),e},t.IsBlackBerry=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/BlackBerry/i)&&(e=!0),e},t.IsOperaMini=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Opera Mini/i)&&(e=!0),e},t.IsAndroid=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Android/i)&&(e=!0),e},t.IsWebOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/webOS/i)&&(e=!0),e},t.IsIOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone|iPad|iPod/i)&&(e=!0),e},t.IsIPHONE=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone/i)&&(e=!0),e},t.IsIPAD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPad/i)&&(e=!0),e},t.IsIPOD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPod/i)&&(e=!0),e},t.IsIE11=function(){return void 0!==navigator.maxTouchPoints},t.IsMobile=function(){var e=!1;if(null!=navigator&&null!=navigator.userAgent){var t=navigator.userAgent;(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone|iPad|iPod/i)||t.match(/BlackBerry/i)||t.match(/Opera Mini/i)||t.match(/Windows Phone/i))&&(e=!0)}return e},t.IsPlaystation=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Playstation/i)&&(e=!0),e},t.IsXboxConsole=function(){var t=!1;if(e.WindowManager.IsWindows()&&"undefined"!=typeof Windows.System.Profile&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily){var n=Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily;n.match(/Xbox/i)&&(t=!0)}return t},t.IsXboxLive=function(){return e.WindowManager.IsWindows()&&"undefined"!=typeof Microsoft&&"undefined"!=typeof Microsoft.Xbox&&"undefined"!=typeof Microsoft.Xbox.Services},t.IsFrameWindow=function(){return null!=window.parent&&window!==window.parent},t.AlertMessage=function(t,n){void 0===n&&(n="Babylon.js");var o=null;return e.WindowManager.IsWindows()?o=new Windows.UI.Popups.MessageDialog(t,n).showAsync():window.alert(t),o},t.GetQueryStringParam=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=n.exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null},t.PostWindowMessage=function(e,t,n){void 0===t&&(t="*"),void 0===n&&(n=!1),n===!0?window.postMessage(e,t):window.top?window.top.postMessage(e,t):console.warn("No Valid Top Window")},t.SetGameWindowState=function(t,n){null!=window.parent&&null!=window.parent.gameState?window.parent.gameState[t]=n:e.Tools.Warn("Game window required to set state for: "+t)},t.GetGameWindowState=function(t){var n=null;return null!=window.parent&&null!=window.parent.gameState&&null!=window.parent.gameState[t]?n=window.parent.gameState[t]:e.Tools.Warn("Game window required to get state for: "+t),null!=n?n:null},t.IsGameWindowEnabled=function(){return null!=window.parent&&null!=window.parent.setGameWindow},t.LoadSceneFile=function(t,n){if(void 0===n&&(n=null),e.WindowManager.IsGameWindowEnabled()){var o=window.location.protocol+"//"+window.location.host+window.location.pathname+"?scene="+t;null!=n&&""!==n&&(o+=n),null!=window.parent&&null!=window.parent.setGameWindow?window.parent.setGameWindow(o):e.Tools.Warn("Invalid set game window function found to load scene file: "+t);
}else e.Tools.Warn("Game window required to load scene file: "+t)},t.PopupDebug=function(e){e.debugLayer&&(e.debugLayer.hide(),e.debugLayer.show({enablePopup:!0,globalRoot:null}))},t.ToggleDebug=function(t,n,o){if(void 0===n&&(n=!1),void 0===o&&(o=null),t.debugLayer){var i=window;e.WindowManager.debugLayerVisible===!0?(e.WindowManager.debugLayerVisible=!1,i.METER&&i.METER.show&&i.METER.show(),t.debugLayer.hide()):(e.WindowManager.debugLayerVisible=!0,i.METER&&i.METER.hide&&i.METER.hide(),t.debugLayer.show({embedMode:n,globalRoot:o}))}},t.GetLocalStorageItem=function(e){return null!=window.localStorage?window.localStorage.getItem(e):null},t.SetLocalStorageItem=function(e,t){null!=window.localStorage&&window.localStorage.setItem(e,t)},t.GetSessionStorageItem=function(e){return null!=window.sessionStorage?window.sessionStorage.getItem(e):null},t.SetSessionStorageItem=function(e,t){null!=window.sessionStorage&&window.sessionStorage.setItem(e,t)},t.GetFilenameFromUrl=function(e){return e.substring(e.lastIndexOf("/")+1)},t.GetUrlParameter=function(e){var t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\?&]"+t+"=([^&#]*)"),o=n.exec(window.location.search);return null!==o?decodeURIComponent(o[1].replace(/\+/g," ")):null},t.GetVirtualRealityEnabled=function(){var t=e.WindowManager.GetLocalStorageItem("virtualReality");return null!=t&&"true"===t},t.SetVirtualRealityEnabled=function(t){e.WindowManager.SetLocalStorageItem("virtualReality",t.toString().toLowerCase())},t.SetWindowsLaunchMode=function(t){void 0===t&&(t=1),e.WindowManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationView&&(Windows.UI.ViewManagement.ApplicationView.preferredLaunchWindowingMode=t)},t.QuitWindowsApplication=function(){e.WindowManager.IsWindows()&&window.close()},t.PrintToScreen=function(t,n){if(void 0===n&&(n="white"),e.WindowManager.PrintElement=document.getElementById("print"),null==e.WindowManager.PrintElement){var o=document.createElement("div");o.id="print",o.style.position="absolute",o.style.left="6px",o.style.bottom="3px",o.style.fontSize="12px",o.style.zIndex="10000",o.style.color="#0c0",document.body.appendChild(o),e.WindowManager.PrintElement=o}null!=e.WindowManager.PrintElement&&e.WindowManager.PrintElement.innerHTML!==t&&(e.WindowManager.PrintElement.style.color!==n&&(e.WindowManager.PrintElement.style.color=n),e.WindowManager.PrintElement.innerHTML=t)},t.debugLayerVisible=!1,t.PrintElement=null,t}();e.WindowManager=t}(BABYLON||(BABYLON={})),BABYLON.WindowManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow&&Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow),BABYLON.WindowManager.IsXboxConsole()&&navigator.gamepadInputEmulation&&(navigator.gamepadInputEmulation="gamepad");var WM=BABYLON.WindowManager;