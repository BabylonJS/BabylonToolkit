var BABYLON;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"Version",{get:function(){return"6.17.0 - LTS"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Copyright",{get:function(){return"All rights reserved (c) 2020 Mackey Kinard"},enumerable:!1,configurable:!0}),t.HasAudioContext=function(){return null!=e.Engine.audioEngine&&null!=e.Engine.audioEngine.audioContext&&null!=e.Engine.audioEngine.audioContext.state&&"running"===e.Engine.audioEngine.audioContext.state},t.EnableSceneParsing=function(t){e.SceneManager.SceneParsingEnabled=t},t.IsSceneParsingEnabled=function(){return e.SceneManager.SceneParsingEnabled},t.HasSceneBeenPreLoaded=function(e){var t=e;return null!=t._preloaded&&t._preloaded===!0},t.GetFullscreenUI=function(t,n){return void 0===n&&(n=e.Texture.BILINEAR_SAMPLINGMODE),null==e.SceneManager.AdvDynamicTexture&&(e.SceneManager.AdvDynamicTexture=e.GUI.AdvancedDynamicTexture.CreateFullscreenUI("Default-Screen-UI",!0,t,n)),e.SceneManager.AdvDynamicTexture},t.GetDefaultSkybox=function(e){return e.getMeshById("Default Skybox")},t.GetIntensityFactor=function(){return null!=e.SceneManager.GlobalOptions.intensityFactor?e.SceneManager.GlobalOptions.intensityFactor:2},t.GetRenderQuality=function(){var t=e.RenderQuality.High,n=e.SceneManager.GlobalOptions.renderQuality;return null!=n&&(t=n),t},t.SetRenderQuality=function(t){e.SceneManager.GlobalOptions.renderQuality=t},t.GetWebGLVersionString=function(t){var n="WebGL - Unknown",r=t||e.SceneManager.GetLastCreatedScene();if(null!=r){var a=r.getEngine();if(null!=a){var o=a.getGlInfo();null!=o&&(n=o.version+" - "+o.renderer)}}return n},t.GetWebGLVersionNumber=function(t){var n=0,r=t||e.SceneManager.GetLastCreatedScene();if(null!=r){var a=r.getEngine();null!=a&&(n=a.webGLVersion)}return n},t.SetWindowState=function(t,n){e.SceneManager.WindowState[t]=n},t.GetWindowState=function(t){var n=e.SceneManager.WindowState[t];return null!=n?n:null},t.IsDebugMode=function(){return null!=e.SceneManager.GlobalOptions.debugModeEnabled&&e.SceneManager.GlobalOptions.debugModeEnabled===!0},t.ConsoleLog=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.log.apply(console,t)},t.ConsoleInfo=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.info.apply(console,t)},t.ConsoleWarn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.warn.apply(console,t)},t.ConsoleError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,e)},t.LogMessage=function(t){e.SceneManager.IsDebugMode()&&e.Tools.Log(t)},t.LogWarning=function(t){e.SceneManager.IsDebugMode()&&e.Tools.Warn(t)},t.LogError=function(t){e.Tools.Error(t)},t.ShowSceneLoader=function(){window.showSceneLoader&&window.showSceneLoader()},t.HideSceneLoader=function(){window.hideSceneLoader&&window.hideSceneLoader()},t.UpdateLoaderStatus=function(e,t,n){window.updateStatus&&window.updateStatus(e,t,n)},t.UpdateLoaderDetails=function(e,t){window.updateDetails&&window.updateDetails(e,t)},t.UpdateLoaderProgress=function(e,t){window.updateProgress&&window.updateProgress(e,t)},t.ShowPageErrorMessage=function(e,t,n){void 0===t&&(t="Error"),void 0===n&&(n=0),window.showErrorMessage&&window.showErrorMessage(e,t,n)},t.SetTimeout=function(e,t){return window.setTimeout(t,e)},t.ClearTimeout=function(e){window.clearTimeout(e)},t.SetInterval=function(e,t){return window.setInterval(t,e)},t.ClearInterval=function(e){window.clearInterval(e)},t.GetTimeMilliseconds=function(){return null!=window.performance?window.performance.now():null!=window.Date?Date.now():0},t.GetTime=function(){return.001*e.SceneManager.GetTimeMilliseconds()},t.GetTimeMs=function(){return e.SceneManager.GetTimeMilliseconds()},t.GetGameTime=function(){return.001*(e.SceneManager.GetTimeMilliseconds()-e.SceneManager.GameTimeMilliseconds)},t.GetGameTimeMs=function(){return e.SceneManager.GetTimeMilliseconds()-e.SceneManager.GameTimeMilliseconds},t.GetDeltaSeconds=function(t,n){void 0===n&&(n=!1);var r=t||e.SceneManager.GetLastCreatedScene(),a=.001*Math.max(e.Scene.MinDeltaTime,Math.min(r.getEngine().getDeltaTime(),e.Scene.MaxDeltaTime));return n===!0&&(a*=r.getAnimationRatio()),a},t.GetDeltaMilliseconds=function(t,n){void 0===n&&(n=!1);var r=t||e.SceneManager.GetLastCreatedScene(),a=Math.max(e.Scene.MinDeltaTime,Math.min(r.getEngine().getDeltaTime(),e.Scene.MaxDeltaTime));return n===!0&&(a*=r.getAnimationRatio()),a},t.GetAnimationRatio=function(t){var n=t||e.SceneManager.GetLastCreatedScene();return n.getAnimationRatio()},t.RunOnce=function(e,t,n){e.executeOnceBeforeRender(t,n)},t.DisposeScene=function(t,n){void 0===n&&(n=new e.Color4(0,0,0,1));var r=t.getEngine();t.dispose(),r.clear(n,!0,!0,!0)},t.SafeDestroy=function(t,n,r){void 0===n&&(n=5),void 0===r&&(r=!1),n>0?(r===!0&&t.setEnabled(!1),e.SceneManager.SetTimeout(n,function(){t.dispose(!1,!1)})):t.dispose(!1,!1)},t.GetRootUrl=function(e){return null!=e._rootUrl&&""!==e._rootUrl?e._rootUrl:"/"},t.SetRootUrl=function(e,t){e._rootUrl=t},t.GetSceneFile=function(e){return null!=e._fileName&&""!==e._fileName?e._fileName:null},t.SetSceneFile=function(e,t){e._fileName=t},t.GetEngineInstances=function(){return e.EngineStore.Instances},t.GetLastCreatedEngine=function(){return e.EngineStore.LastCreatedEngine},t.GetLastCreatedScene=function(){return e.EngineStore.LastCreatedScene},t.GetImportMeshes=function(e,t){return null==e||null==t||""===t?null:null!=e.importMeshes?e.importMeshes.get(t.toLowerCase()):null},t.GetImportMeshMap=function(e){return null==e?null:null!=e.importMeshes?e.importMeshes:null},t.ClearImportMeshes=function(e){return null==e?null:(null!=e.importMeshes,void(e.importMeshes=new Map))},t.RegisterImportMeshes=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.importMeshes&&(e.importMeshes=new Map),e.importMeshes.set(t.toLowerCase(),n))},t.GetAssetContainer=function(e,t){return null==e||null==t||""===t?null:null!=e.assetContainers?e.assetContainers.get(t.toLowerCase()):null},t.GetAssetContainerMap=function(e){return null==e?null:null!=e.assetContainers?e.assetContainers:null},t.ClearAssetContainers=function(e){return null==e?null:(null!=e.assetContainers,void(e.assetContainers=new Map))},t.RegisterAssetContainer=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.assetContainers&&(e.assetContainers=new Map),e.assetContainers.set(t.toLowerCase(),n))},t.GetMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetAbstractMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetAbstractMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformNode=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetTransformNodeByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformDetailMesh=function(t){var n=null,r=t.name+".Detail",a=t.getChildren(function(t){return t.name===r&&t instanceof e.AbstractMesh},!0);return null!=a&&a.length>0&&(n=a[0]),n},t.GetSkinnedMesh=function(e){return null!=e._skinnedMesh?e._skinnedMesh:null},t.GetPrimitiveMeshes=function(e){return e.getChildMeshes(!0,function(e){return e.name.indexOf("_primitive")>=0})},t.GetTransformLayer=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.layer?e.metadata.unity.layer:0},t.GetTransformTag=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.group&&""!==e.metadata.unity.group?e.metadata.unity.group:"Untagged"},t.HasTransformTags=function(t,n){return e.Tags.MatchesQuery(t,n)},t.TextureFloatSupported=function(e){var t=!1,n=!1,r=e.getEngine(),a=r.getCaps();return a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?t=!0:a.textureFloatRender&&a.textureFloatLinearFiltering&&(n=!0),t||n},t.RegisterClickAction=function(t,n,r){var a=null;return null!=n&&(n.isPickable=!0,null==n.actionManager&&(n.actionManager=new e.ActionManager(t)),a=n.actionManager.registerAction(new e.ExecuteCodeAction({trigger:e.ActionManager.OnPickTrigger},r))),a},t.UnregisterClickAction=function(e,t){var n=!1;return null!=e&&null!=t&&(n=e.actionManager.unregisterAction(t)),n},t.StartTweenAnimation=function(t,n,r,a,o,l,i,s,u,d,p){void 0===i&&(i=1),void 0===s&&(s=null),void 0===u&&(u=null),void 0===d&&(d=null),void 0===p&&(p=null);var c=i||1,m=s||30,f=u||e.Animation.ANIMATIONLOOPMODE_CONSTANT,h=e.Utilities.CreateTweenAnimation(n,a,o,l,m,f);null!=d&&h.setEasingFunction(d);var g=e.Utilities.GetLastKeyFrameIndex(h),v=f!=e.Animation.ANIMATIONLOOPMODE_CONSTANT;return t.beginDirectAnimation(r,[h],0,g,v,c,p)},t.StartNativeTween=function(e,t){return createjs.Tween.get(e)},t.GetMaterialWithName=function(e,t){var n=null;if(null!=e.materials&&e.materials.length>0)for(var r=(e.materials.length,0);r<e.materials.length;r++){var a=e.materials[r];if(a.name.startsWith(t)){n=a;break}}return n},t.GetAllMaterialsWithName=function(e,t){var n=null;if(null!=e.materials&&e.materials.length>0)for(var r=(e.materials.length,0);r<e.materials.length;r++){var a=e.materials[r];a.name.startsWith(t)&&(null==n&&(n=[]),n.push(a))}return n},t.InstantiatePrefabFromScene=function(t,n,r,a,o,l,i,s){void 0===a&&(a=null),void 0===o&&(o=null),void 0===l&&(l=null),void 0===i&&(i=null),void 0===s&&(s=!0);var u=null;if(null!=t&&null!=n&&""!==n){var d=t.getNodeByName(n);if(null!=d)if(u=d.clone(r,a,!1),null!=u){null!=o&&(u.position=o.clone()),null!=l&&(u.rotationQuaternion=l.clone()),null!=i&&(u.scaling=i.clone());var p=null,c=u.getChildren(null,!1);null!=c&&(p=c),null==p?p=[u]:p.unshift(u),p.forEach(function(n){if(n.setEnabled(!0),n instanceof e.AbstractMesh&&null!=n.metadata&&null!=n.metadata.shadowCastingMode&&0!==n.metadata.shadowCastingMode&&t.lights.forEach(function(e){var t=e.getShadowGenerator();if(null!=t){var r=null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0;if(r===!1){var a=t.getShadowMap();null==a.renderList&&(a.renderList=[]),a.renderList.indexOf(n)<0&&a.renderList.push(n)}}}),n instanceof e.Mesh)if(null!=n.source){if(null==n.skeleton&&null!=n.source.skeleton){var r=n.source.skeleton.name+".Skeleton",a=r+"."+n.source.skeleton.id;if(n.skeleton=n.source.skeleton.clone(r,a),null!=n.skeleton&&null!=n.skeleton.bones&&null!=n.source.skeleton.bones&&n.skeleton.bones.length===n.source.skeleton.bones.length)for(var o=n.skeleton.bones.length,l=0;l<o;l++)null==n.skeleton.bones[l].metadata&&null!=n.source.skeleton.bones[l].metadata&&(n.skeleton.bones[l].metadata=n.source.skeleton.bones[l].metadata)}}else e.Tools.Warn("Babylon.js encountered a null clone source for: "+n.name)});var m=[];if(p.forEach(function(e){m.push(e)}),null!=m&&m.length>0){var f=[];e.Utilities.PostParseSceneComponents(t,m,null,f),t.onAfterRenderObservable.addOnce(function(){if(null!=f&&f.length>0)for(var e=0;e<f.length;e++){var t=f[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})}}else e.Tools.Warn("Failed to create prefab of: "+n);else e.Tools.Warn("Failed to lookup prefab map: "+n)}else e.Tools.Warn("Unable to locate prefab master: "+n);return u},t.InstantiatePrefabFromContainer=function(t,n,r,a,o,l,i,s,u){void 0===a&&(a=null),void 0===o&&(o=null),void 0===l&&(l=null),void 0===i&&(i=null),void 0===s&&(s=!0),void 0===u&&(u=!1);var d=e.Utilities.CloneAssetContainerItem(t,n,function(e){return e},a,u,s);if(null!=d){null!=r&&""!==r&&(d.name=r),null!=o&&(d.position=o.clone()),null!=l&&(d.rotationQuaternion=l.clone()),null!=i&&(d.scaling=i.clone());var p=[];p.push(d);var c=d.getChildren(null,!1);null!=c&&c.length>0&&c.forEach(function(e){p.push(e)}),p.forEach(function(t){t.id=e.Utilities.CreateGuid(),t.setEnabled(!0)});var m=[];e.Utilities.PostParseSceneComponents(t.scene,p,null,m),t.scene.onAfterRenderObservable.addOnce(function(){if(null!=m&&m.length>0)for(var e=0;e<m.length;e++){var t=m[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})}return d},t.CloneTransformNode=function(t,n,r,a,o,l,i){void 0===a&&(a=null),void 0===o&&(o=null),void 0===l&&(l=null),void 0===i&&(i=null);var s=e.Utilities.GetAssetContainerNode(t,n),u=s.clone(r,a,!0);return null!=u&&(null!=o&&(u.position=o.clone()),null!=l&&(u.rotationQuaternion=l.clone()),null!=i&&(u.scaling=i.clone()),u.setEnabled(!0)),u},t.CloneAbstractMesh=function(t,n,r,a,o,l,i){void 0===a&&(a=null),void 0===o&&(o=null),void 0===l&&(l=null),void 0===i&&(i=null);var s=e.Utilities.GetAssetContainerMesh(t,n),u=s.clone(r,a,!0);return null!=u&&(null!=o&&(u.position=o.clone()),null!=l&&(u.rotationQuaternion=l.clone()),null!=i&&(u.scaling=i.clone()),u.setEnabled(!0)),u},t.CreateInstancedMesh=function(t,n,r,a,o,l,i){void 0===a&&(a=null),void 0===o&&(o=null),void 0===l&&(l=null),void 0===i&&(i=null);var s=e.Utilities.GetAssetContainerMesh(t,n),u=s.createInstance(r);return null!=u&&(null!=a&&(u.parent=a),null!=o&&(u.position=o.clone()),null!=l&&(u.rotationQuaternion=l.clone()),null!=i&&(u.scaling=i.clone()),u.setEnabled(!0)),u},t.RegisterScriptComponent=function(e,t,n){void 0===n&&(n=!0),null!=e&&e.registerComponentInstance&&e.registerComponentInstance(e,t,n)},t.DestroyScriptComponent=function(e){null!=e&&e.destroyComponentInstance&&e.destroyComponentInstance(e)},t.FindScriptComponent=function(e,t){if(null==e)return null;var n=null;if(null!=e.metadata&&e.metadata.unity){var r=e.metadata.unity;if(null!=r.components&&r.components.length>0)for(var a=0;a<r.components.length;a++){var o=r.components[a];if(null!=o.instance&&o.klass===t){n=o.instance;break}}}return null!=n?n:null},t.FindAllScriptComponents=function(e,t){if(null==e)return null;var n=null;if(null!=e.metadata&&e.metadata.unity){var r=e.metadata.unity;if(null!=r.components&&r.components.length>0)for(var a=0;a<r.components.length;a++){var o=r.components[a];null!=o.instance&&o.klass===t&&(null==n&&(n=[]),n.push(o.instance))}}return null!=n?n:null},t.FindSceneMetadata=function(e){return null==e?null:null!=e.metadata&&e.metadata.unity?e.metadata.unity:null},t.FindSceneCameraRig=function(e){return null==e?null:null!=e.cameraRig?e.cameraRig:null},t.FindSceneLightRig=function(e){return null==e?null:null!=e.lightRig?e.lightRig:null},t.FindTransformWithScript=function(t,n){var r=t.getNodes();return e.Utilities.SearchTransformNodeForScript(n,r)},t.FindAllTransformsWithScript=function(t,n){var r=t.getNodes();return e.Utilities.SearchAllTransformNodesForScript(n,r)},t.FindChildTransformNode=function(t,n,r,a,o){if(void 0===r&&(r=e.SearchType.ExactMatch),void 0===a&&(a=!0),void 0===o&&(o=null),null==t)return null;var l=null!=r?r:e.SearchType.ExactMatch,i=t.getChildren(o,a);return e.Utilities.SearchTransformNodes(n,i,l)},t.FindChildTransformWithTags=function(t,n,r,a){if(void 0===r&&(r=!0),void 0===a&&(a=null),null==t)return null;var o=t.getChildren(a,r);return e.Utilities.SearchTransformNodeForTags(n,o)},t.FindAllChildTransformsWithTags=function(t,n,r,a){if(void 0===r&&(r=!0),void 0===a&&(a=null),null==t)return null;var o=t.getChildren(a,r);return e.Utilities.SearchAllTransformNodesForTags(n,o)},t.FindChildTransformWithScript=function(t,n,r,a){if(void 0===r&&(r=!0),void 0===a&&(a=null),null==t)return null;var o=t.getChildren(a,r);return e.Utilities.SearchTransformNodeForScript(n,o)},t.FindAllChildTransformsWithScript=function(t,n,r,a){if(void 0===r&&(r=!0),void 0===a&&(a=null),null==t)return null;var o=t.getChildren(a,r);return e.Utilities.SearchAllTransformNodesForScript(n,o)},t.SearchForScriptComponentByName=function(t,n){var r=t.getNodes(),a=e.Utilities.SearchTransformNodeForScript(n,r);return e.SceneManager.FindScriptComponent(a,n)},t.SearchForAllScriptComponentsByName=function(t,n){var r=null,a=t.getNodes(),o=e.Utilities.SearchAllTransformNodesForScript(n,a);return null!=o&&o.length>0&&o.forEach(function(t){var a=e.SceneManager.FindScriptComponent(t,n);null!=a&&(null==r&&(r=[]),r.push(a))}),null!=r?r:null},t.MoveWithCollisions=function(e,t){return null==e?null:void(null!=t&&e.moveWithCollisions(t))},t.MoveWithTranslation=function(e,t){return null==e?null:void(null!=t&&e.position.addInPlace(t))},t.TurnWithRotation=function(t,n,r){return void 0===r&&(r=e.Space.LOCAL),null==t?null:void(0!=n&&t.rotate(e.Axis.Y,n,r))},t.GetRecastHeapSize=function(){if("undefined"==typeof Recast)return 0;var e=0;return Recast&&Recast.HEAP8&&Recast.HEAP8.length&&(e=Recast.HEAP8.length/1048576),e},t.GetNavigationTools=function(){if("undefined"!=typeof Recast)return null==e.SceneManager.PluginInstance&&(e.SceneManager.PluginInstance=new e.RecastJSPlugin),e.SceneManager.PluginInstance},t.GetCrowdInterface=function(t){if("undefined"==typeof Recast)return null;if(e.SceneManager.HasNavigationData()){var n=e.SceneManager.GetNavigationTools();return null!=n&&null==e.SceneManager.CrowdInterface&&(e.SceneManager.CrowdInterface=n.createCrowd(e.SceneManager.MAX_AGENT_COUNT,e.SceneManager.MAX_AGENT_RADIUS,t)),e.SceneManager.CrowdInterface}return null},t.HasNavigationData=function(){if("undefined"==typeof Recast)return!1;var t=e.SceneManager.GetNavigationTools();return null!=t&&null!=t.navMesh},t.GetNavigationMesh=function(){return"undefined"==typeof Recast?null:e.SceneManager.NavigationMesh},t.BakeNavigationMesh=function(t,n,r,a,o,l){if(void 0===a&&(a=!1),void 0===o&&(o=null),void 0===l&&(l=!1),"undefined"==typeof Recast)return null;e.Tools.Log("Recast.js baking navigation mesh data");var i=e.SceneManager.GetNavigationTools();if(null!=i)if(i.createNavMesh(n,r),null!=i.navMesh){var s="NavigationMesh",u=t.getMaterialByName(s);null==u&&(u=new e.StandardMaterial(s,t),u.diffuseColor=o||new e.Color3(.05,.225,.75),u.alpha=.5),e.SceneManager.NavigationMesh=i.createDebugNavMesh(t),null!=e.SceneManager.NavigationMesh&&(e.SceneManager.NavigationMesh.material=u,e.SceneManager.NavigationMesh.isPickable=!0,e.SceneManager.NavigationMesh.isVisible=!0,e.SceneManager.NavigationMesh.visibility=a===!0?1:0,e.SceneManager.NavigationMesh.renderingGroupId=e.Utilities.ColliderRenderGroup(),e.Tags.AddTagsTo(e.SceneManager.NavigationMesh,"Navigation"),e.Utilities.ValidateTransformMetadata(e.SceneManager.NavigationMesh),l===!0&&(e.SceneManager.NavigationMesh.checkCollisions=!0,e.RigidbodyPhysics&&(e.SceneManager.NavigationMesh.metadata.unity.physics=e.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new e.Vector3(0,0,0)),e.SceneManager.NavigationMesh.metadata.unity.collision=e.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),e.RigidbodyPhysics.SetupPhysicsComponent(t,e.SceneManager.NavigationMesh)))),null!=e.SceneManager.NavigationMesh?e.SceneManager.OnNavMeshReadyObservable.hasObservers()===!0&&e.SceneManager.OnNavMeshReadyObservable.notifyObservers(e.SceneManager.NavigationMesh):e.Tools.Warn("Failed to generate navigation mesh geometry")}else e.Tools.Warn("Failed to create navigation mesh data");return e.SceneManager.NavigationMesh},t.LoadNavigationMesh=function(t,n,r,a,o,l){if(void 0===r&&(r=!1),void 0===a&&(a=null),void 0===o&&(o=0),void 0===l&&(l=!1),"undefined"==typeof Recast)return null;e.Tools.Log("Recast.js loading prebaked navigation mesh");var i=e.SceneManager.GetNavigationTools();if(null!=i)if(i.setTimeStep&&i.setTimeStep(o),i.buildFromNavmeshData(n),null!=i.navMesh){var s="NavigationMesh",u=t.getMaterialByName(s);null==u&&(u=new e.StandardMaterial(s,t),u.diffuseColor=a||new e.Color3(.05,.225,.75),u.alpha=.5),e.SceneManager.NavigationMesh=i.createDebugNavMesh(t),null!=e.SceneManager.NavigationMesh&&(e.SceneManager.NavigationMesh.material=u,e.SceneManager.NavigationMesh.isPickable=!0,e.SceneManager.NavigationMesh.isVisible=!0,e.SceneManager.NavigationMesh.visibility=r===!0?1:0,e.SceneManager.NavigationMesh.renderingGroupId=e.Utilities.ColliderRenderGroup(),e.Tags.AddTagsTo(e.SceneManager.NavigationMesh,"Navigation"),e.Utilities.ValidateTransformMetadata(e.SceneManager.NavigationMesh),l===!0&&(e.SceneManager.NavigationMesh.checkCollisions=!0,e.RigidbodyPhysics&&(e.SceneManager.NavigationMesh.metadata.unity.physics=e.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new e.Vector3(0,0,0)),e.SceneManager.NavigationMesh.metadata.unity.collision=e.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),e.RigidbodyPhysics.SetupPhysicsComponent(t,e.SceneManager.NavigationMesh)))),null!=e.SceneManager.NavigationMesh?e.SceneManager.OnNavMeshReadyObservable.hasObservers()===!0&&e.SceneManager.OnNavMeshReadyObservable.notifyObservers(e.SceneManager.NavigationMesh):e.Tools.Warn("Failed to generate navigation mesh geometry")}else e.Tools.Warn("Failed to build navigation mesh data");return e.SceneManager.NavigationMesh},t.SaveNavigationMesh=function(){if("undefined"==typeof Recast)return null;var t=e.SceneManager.GetNavigationTools();return null!=t&&null!=t.navMesh?t.getNavmeshData():null},t.ComputeNavigationPath=function(t,n,r){if(void 0===r&&(r=!0),"undefined"==typeof Recast)return null;var a=e.SceneManager.GetNavigationTools(),o=r===!0?a.getClosestPoint(t):t,l=r===!0?a.getClosestPoint(n):n;return null!=a&&null!=a.navMesh?a.computePath(o,l):null},t.MoveAlongNavigationPath=function(t,n,r,a,o,l){void 0===o&&(o=null);var i=null;if(r&&r.length>0){for(var s=0,u=[{frame:0,value:n.position}],d=0;d<r.length;d++)s+=e.Vector3.Distance(u[d].value,r[d]),u.push({frame:s,value:r[d]});i=new e.Animation("Navigation","position",3,e.Animation.ANIMATIONTYPE_VECTOR3,e.Animation.ANIMATIONLOOPMODE_CONSTANT),null!=o&&i.setEasingFunction(o),i.setKeys(u),n.animations=[i],t.beginAnimation(n,0,s,!1,a,l)}return i},t.AddNavigationCylinderObstacle=function(t,n,r){if("undefined"==typeof Recast)return null;var a=e.SceneManager.GetNavigationTools();return null!=a&&null!=a.navMesh?a.addCylinderObstacle(t,n,r):null},t.AddNavigationBoxObstacle=function(t,n,r){if("undefined"==typeof Recast)return null;var a=e.SceneManager.GetNavigationTools();return null!=a&&null!=a.navMesh?a.addBoxObstacle(t,n,r):null},t.RemoveNavigationObstacle=function(t){if("undefined"==typeof Recast)return null;var n=e.SceneManager.GetNavigationTools();null!=n&&null!=n.navMesh&&n.removeObstacle(t)},t.ToggleFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().switchFullscreen(t)},t.EnterFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().enterFullscreen(t)},t.ExitFullscreenMode=function(e){e.getEngine().exitFullscreen()},t.WindowState={},t.GlobalOptions={},t.ServerEndPoint="http://127.0.0.1:2567",t.EnableUserInput=!0,t.RenderLoopReady=!0,t.PauseRenderLoop=!1,t.LostRenderContext=!1,t.AutoUpdateProgress=!0,t.PhysicsCapsuleShape=0,t.SupportSRGBBuffers=!1,t.AnimationStartMode=e.GLTFLoaderAnimationStartMode.NONE,t.AnimationTargetFps=60,t.DefaultConvexHullMargin=.001,t.DefaultHeightFieldMargin=.001,t.AmbientLightIntensity=.5,t.PointLightIntensity=1,t.SpotLightIntensity=10,t.DirectionalLightIntensity=2,t.TerrainColorCorrection=2.2,t.AllowCameraMovement=!0,t.AllowCameraRotation=!0,t.VirtualJoystickEnabled=!1,t.GameTimeMilliseconds=0,t.WaitForSeconds=function(t){return new Promise(function(n){return e.SceneManager.SetTimeout(1e3*t,n)})},t.OnPreRenderLoopObservable=new e.Observable,t.OnPostRenderLoopObservable=new e.Observable,t.OnEngineResizeObservable=new e.Observable,t.OnLoadCompleteObservable=new e.Observable,t.OnRebuildContextObservable=new e.Observable,t.OnAssetManagerProgress=null,t.SceneParsingEnabled=!0,t.AdvDynamicTexture=null,t.MAX_AGENT_COUNT=200,t.MAX_AGENT_RADIUS=2,t.NavigationMesh=null,t.CrowdInterface=null,t.PluginInstance=null,t.OnNavMeshReadyObservable=new e.Observable,t}();e.SceneManager=t}(BABYLON||(BABYLON={}));var SM=BABYLON.SceneManager;BABYLON.SceneManager.GameTimeMilliseconds=BABYLON.SceneManager.GetTimeMilliseconds();var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BABYLON;!function(e){var t;!function(t){t[t.Deg2Rad=2*Math.PI/360]="Deg2Rad",t[t.Rad2Deg=1/e.System.Deg2Rad]="Rad2Deg",t[t.Epsilon=1e-6]="Epsilon",t[t.SingleEpsilon=1.401298e-45]="SingleEpsilon",t[t.EpsilonNormalSqrt=1e-15]="EpsilonNormalSqrt",t[t.Kph2Mph=.621371]="Kph2Mph",t[t.Mph2Kph=1.60934]="Mph2Kph",t[t.Mps2Kph=3.6]="Mps2Kph",t[t.Mps2Mph=2.23694]="Mps2Mph",t[t.Meter2Inch=39.3701]="Meter2Inch",t[t.Inch2Meter=.0254]="Inch2Meter",t[t.Gravity=9.81]="Gravity",t[t.Gravity3G=29.400000000000002]="Gravity3G",t[t.SkidFactor=.25]="SkidFactor",t[t.MaxInteger=2147483647]="MaxInteger",t[t.WalkingVelocity=4.4]="WalkingVelocity",t[t.TerminalVelocity=55]="TerminalVelocity",t[t.SmoothDeltaFactor=.2]="SmoothDeltaFactor",t[t.ToLinearSpace=2.2]="ToLinearSpace",t[t.ToGammaSpace=.45454545454545453]="ToGammaSpace"}(t=e.System||(e.System={}));var n;!function(e){e[e.Default=-1]="Default",e[e.Right=0]="Right",e[e.Left=1]="Left"}(n=e.Handedness||(e.Handedness={}));var r;!function(e){e[e.ExactMatch=0]="ExactMatch",e[e.StartsWith=1]="StartsWith",e[e.EndsWith=2]="EndsWith",e[e.IndexOf=3]="IndexOf"}(r=e.SearchType||(e.SearchType={}));var a;!function(e){e[e.Auto=0]="Auto",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four"}(a=e.PlayerNumber||(e.PlayerNumber={}));var o;!function(e){e[e.FirstPerson=0]="FirstPerson",e[e.ThirdPerson=1]="ThirdPerson"}(o=e.PlayerControl||(e.PlayerControl={}));var l;!function(e){e[e.High=0]="High",e[e.Medium=1]="Medium",e[e.Low=2]="Low"}(l=e.RenderQuality||(e.RenderQuality={}));var i;!function(e){e[e.None=-1]="None",e[e.Generic=0]="Generic",e[e.Xbox360=1]="Xbox360",e[e.DualShock=2]="DualShock",e[e.PoseController=3]="PoseController"}(i=e.GamepadType||(e.GamepadType={}));var s;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(s=e.Xbox360Trigger||(e.Xbox360Trigger={}));var u;!function(e){e[e.DirectVelocity=0]="DirectVelocity",e[e.AppliedForces=1]="AppliedForces"}(u=e.MovementType||(e.MovementType={}));var d;!function(e){e[e.Top=0]="Top",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Bottom=3]="Bottom"}(d=e.CollisionContact||(e.CollisionContact={}));var p;!function(e){e[e.AABB=0]="AABB",e[e.OBB=1]="OBB"}(p=e.IntersectionPrecision||(e.IntersectionPrecision={}));var c;!function(e){e[e.DefaultFilter=1]="DefaultFilter",e[e.StaticFilter=2]="StaticFilter",e[e.KinematicFilter=4]="KinematicFilter",e[e.DebrisFilter=8]="DebrisFilter",e[e.SensorTrigger=16]="SensorTrigger",e[e.CharacterFilter=32]="CharacterFilter",e[e.AllFilter=-1]="AllFilter"}(c=e.CollisionFilters||(e.CollisionFilters={}));var m;!function(e){e[e.ACTIVE_TAG=1]="ACTIVE_TAG",e[e.ISLAND_SLEEPING=2]="ISLAND_SLEEPING",e[e.WANTS_DEACTIVATION=3]="WANTS_DEACTIVATION",e[e.DISABLE_DEACTIVATION=4]="DISABLE_DEACTIVATION",e[e.DISABLE_SIMULATION=5]="DISABLE_SIMULATION"}(m=e.CollisionState||(e.CollisionState={}));var f;!function(e){e[e.CF_STATIC_OBJECT=1]="CF_STATIC_OBJECT",e[e.CF_KINEMATIC_OBJECT=2]="CF_KINEMATIC_OBJECT",e[e.CF_NO_CONTACT_RESPONSE=4]="CF_NO_CONTACT_RESPONSE",e[e.CF_CUSTOM_MATERIAL_CALLBACK=8]="CF_CUSTOM_MATERIAL_CALLBACK",e[e.CF_CHARACTER_OBJECT=16]="CF_CHARACTER_OBJECT",e[e.CF_DISABLE_VISUALIZE_OBJECT=32]="CF_DISABLE_VISUALIZE_OBJECT",e[e.CF_DISABLE_SPU_COLLISION_PROCESSING=64]="CF_DISABLE_SPU_COLLISION_PROCESSING",e[e.CF_HAS_CONTACT_STIFFNESS_DAMPING=128]="CF_HAS_CONTACT_STIFFNESS_DAMPING",e[e.CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR=256]="CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR",e[e.CF_HAS_FRICTION_ANCHOR=512]="CF_HAS_FRICTION_ANCHOR",e[e.CF_HAS_COLLISION_SOUND_TRIGGER=1024]="CF_HAS_COLLISION_SOUND_TRIGGER"}(f=e.CollisionFlags||(e.CollisionFlags={}));var h;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(h=e.UserInputPointer||(e.UserInputPointer={}));var g;!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.ClientX=2]="ClientX",e[e.ClientY=3]="ClientY",e[e.MouseX=4]="MouseX",e[e.MouseY=5]="MouseY",e[e.Wheel=6]="Wheel"}(g=e.UserInputAxis||(e.UserInputAxis={}));var v;!function(e){e[e.BackSpace=8]="BackSpace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Pause=19]="Pause",e[e.Break=19]="Break",e[e.CapsLock=20]="CapsLock",e[e.Escape=27]="Escape",e[e.SpaceBar=32]="SpaceBar",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.LeftArrow=37]="LeftArrow",e[e.UpArrow=38]="UpArrow",e[e.RightArrow=39]="RightArrow",e[e.DownArrow=40]="DownArrow",e[e.Insert=45]="Insert",e[e.Delete=46]="Delete",e[e.Num0=48]="Num0",e[e.Num1=49]="Num1",e[e.Num2=50]="Num2",e[e.Num3=51]="Num3",e[e.Num4=52]="Num4",e[e.Num5=53]="Num5",e[e.Num6=54]="Num6",e[e.Num7=55]="Num7",e[e.Num8=56]="Num8",e[e.Num9=57]="Num9",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.LeftWindowKey=91]="LeftWindowKey",e[e.RightWindowKey=92]="RightWindowKey",e[e.SelectKey=93]="SelectKey",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.Multiply=106]="Multiply",e[e.Add=107]="Add",e[e.Subtract=109]="Subtract",e[e.DecimalPoint=110]="DecimalPoint",e[e.Divide=111]="Divide",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=144]="NumLock",e[e.ScrollLock=145]="ScrollLock",e[e.SemiColon=186]="SemiColon",e[e.EqualSign=187]="EqualSign",e[e.Comma=188]="Comma",e[e.Dash=189]="Dash",e[e.Period=190]="Period",e[e.ForwardSlash=191]="ForwardSlash",e[e.GraveAccent=192]="GraveAccent",e[e.OpenBracket=219]="OpenBracket",e[e.BackSlash=220]="BackSlash",e[e.CloseBraket=221]="CloseBraket",e[e.SingleQuote=222]="SingleQuote"}(v=e.UserInputKey||(e.UserInputKey={}));var y=function(){function e(){}return e.KeyboardSmoothing=!1,e.KeyboardMoveSensibility=3,e.KeyboardMoveDeadZone=.001,e.GamepadDeadStickValue=.25,e.GamepadLStickXInverted=!1,e.GamepadLStickYInverted=!1,e.GamepadRStickXInverted=!1,e.GamepadRStickYInverted=!0,e.GamepadLStickSensibility=1,e.GamepadRStickSensibility=1,e.SupportedInputDevices=null,e.PointerAngularSensibility=.5,e.PointerWheelDeadZone=.1,e.PointerMouseDeadZone=.1,e.PointerMouseInverted=!0,e.UseCanvasElement=!0,e.UseArrowKeyRotation=!1,e}();e.UserInputOptions=y;var C=function(){function e(){}return e}();e.RequestHeader=C;var b=function(){function e(){this.mesh=null,this.state=0}return e}();e.TriggerVolume=b;var I=function(){function e(){}return e}();e.RoomErrorMessage=I;var S=function(){function e(){this.ListenerDictionary={}}return e.prototype.AddListener=function(e,t){var n;null==this.ListenerDictionary[e]?(n=[],this.ListenerDictionary[e]=n):n=this.ListenerDictionary[e],n.push(t)},e.prototype.RemoveListener=function(e,t){var n=this.ListenerDictionary[e];if(null!=n){var r=n.findIndex(function(e){return t==e});r>=0&&n.splice(r,1)}},e.prototype.RaiseMessage=function(e,t){void 0===t&&(t=null);var n=this.ListenerDictionary[e];null!=n&&n.forEach(function(e){e(t)})},e}();e.EventMessageBus=S;var _=function(){function t(e,t,n,r,a,o){void 0===n&&(n=1),void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===o&&(o=!0),this.prefabName=null,this.allowGrowth=!0,this.assetContainer=null,this.cloneAnimations=!0,this.makeNewMaterials=!1,this.availableInstances=null,this.prefabName=t,this.allowGrowth=r,this.assetContainer=e,this.cloneAnimations=o,this.makeNewMaterials=a,this.availableInstances=[],this.populatePool(n)}return t.prototype.getAvailableCount=function(){
return this.availableInstances.length},t.prototype.populatePool=function(e){if(e>0)for(var t=0;t<e;t++){var n=this.createNewInstance();null!=n&&this.freeInstance(n)}},t.prototype.getInstance=function(t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=this.availableInstances.length>0?this.availableInstances.pop():this.appendNewInstance();return null!=r&&(null!=t?r.position.copyFrom(t):r.position.set(0,0,0),null!=n?null!=r.rotationQuaternion?r.rotationQuaternion.copyFrom(n):r.rotationQuaternion=n.clone():null!=r.rotationQuaternion?r.rotationQuaternion.set(0,0,0,1):r.rotationQuaternion=new e.Quaternion(0,0,0,1),r.name=this.prefabName+".Instance",r.setEnabled(!0)),r},t.prototype.freeInstance=function(t){null!=t&&(t.setEnabled(!1),t.position.set(0,0,0),null!=t.rotationQuaternion?t.rotationQuaternion.set(0,0,0,1):t.rotationQuaternion=new e.Quaternion(0,0,0,1),null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.components&&t.metadata.unity.components.forEach(function(e){if(null!=e)try{e.resetScriptComponent()}catch(t){}}),t.name=this.prefabName+".Unassigned",this.availableInstances.push(t))},t.prototype.appendNewInstance=function(){var e=null;return this.allowGrowth===!0&&(e=this.createNewInstance()),e},t.prototype.createNewInstance=function(t,n,r,a){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=null);var o=null;return null!=this.assetContainer&&null!=this.prefabName&&""!==this.prefabName&&(this.assetContainer instanceof e.AssetContainer?o=e.SceneManager.InstantiatePrefabFromContainer(this.assetContainer,this.prefabName,this.prefabName+".Instance",t,n,r,a,this.cloneAnimations,this.makeNewMaterials):this.assetContainer instanceof e.Scene&&(o=e.SceneManager.InstantiatePrefabFromScene(this.assetContainer,this.prefabName,this.prefabName+".Instance",t,n,r,a,this.cloneAnimations))),o},t}();e.PrefabObjectPool=_;var M=function(){function t(){this._hit=!1,this._dest=new e.Vector3(0,0,0),this._origin=new e.Vector3(0,0,0),this._hitPoint=new e.Vector3(0,0,0),this._hitNormal=new e.Vector3(0,0,0),this._hitDistance=0,this._collisionObject=null,this.reset(e.Vector3.Zero(),e.Vector3.Zero())}return Object.defineProperty(t.prototype,"hasHit",{get:function(){return this._hit},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hitPoint",{get:function(){return this._hitPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hitNormal",{get:function(){return this._hitNormal},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionObject",{get:function(){return this._collisionObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rayDestination",{get:function(){return this._dest},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rayOrigin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),t.prototype.reset=function(e,t){this._hit=!1,this._hitPoint.set(0,0,0),this._hitNormal.set(0,0,0),this._hitDistance=0,this._collisionObject=null,this._origin.copyFrom(e),this._dest.copyFrom(t)},t.prototype.update=function(t,n,r,a,o,l,i,s){void 0===s&&(s=null),this._hit=t,this._hitPoint.set(n,r,a),this._hitNormal.set(o,l,i),this._hitDistance=e.Vector3.Distance(this._origin,this.hitPoint),this._collisionObject=s},t}();e.RaycastHitResult=M;var T=function(){function t(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=.5),this._numPoints=-1,this._pointMesh=null,this._pointSize=.5,this._pointType=0,this._linesName="MeshLines",this._linesMesh=null,this._babylonScene=null,this._pointMesh=null,this._linesMesh=null,this._linesName=e,this._babylonScene=t,this._pointType=n,this._pointSize=r}return Object.defineProperty(t.prototype,"pointMesh",{get:function(){return this._pointMesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linesMesh",{get:function(){return this._linesMesh},enumerable:!1,configurable:!0}),t.prototype.dispose=function(e){void 0===e&&(e=!0),this._babylonScene=null,this._linesName=null,null!=this._pointMesh&&(this._pointMesh.dispose(e),this._pointMesh=null),null!=this._linesMesh&&(this._linesMesh.dispose(e),this._linesMesh=null)},t.prototype.hidePoint=function(e){void 0===e&&(e=!0),null!=this._pointMesh&&(this._pointMesh.isVisible=!e)},t.prototype.drawPoint=function(t){null==this._pointMesh&&(1===this._pointType?(this._pointMesh=e.MeshBuilder.CreateBox(this._linesName+".EndPoint",{size:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25):(this._pointMesh=e.MeshBuilder.CreateSphere(this._linesName+".EndPoint",{segments:24,diameter:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25)),null!=this._pointMesh&&(this._pointMesh.isVisible=!0,this._pointMesh.position.copyFrom(t))},t.prototype.drawLine=function(t,n){void 0===n&&(n=null),null==this._linesMesh?(this._numPoints=t.length,this._linesMesh=e.MeshBuilder.CreateLines(this._linesName,{points:t,updatable:!0},this._babylonScene),this._linesMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),null!=n&&(this._linesMesh.color=n),this._linesMesh.refreshBoundingInfo(!1)):t.length===this._numPoints?(this._linesMesh=e.MeshBuilder.CreateLines(this._linesName,{points:t,instance:this._linesMesh},this._babylonScene),this._linesMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),null!=n&&(this._linesMesh.color=n),this._linesMesh.refreshBoundingInfo(!1)):e.Tools.Warn("Dynamic line mesh point count mismatch for "+this._linesName)},t}();e.LinesMeshRenderer=T;var x=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.addContainerTask=function(t,n,r,a){var o=this,l=new e.ContainerAssetTask(t,n,r,a),i=l;return i._lengthComputable=0,i._loaded=0,i._total=0,i.runTask=function(t,n,r){e.SceneLoader.LoadAssetContainer(l.rootUrl,l.sceneFilename,t,function(e){l.loadedContainer=e,l.loadedMeshes=e.meshes,l.loadedParticleSystems=e.particleSystems,l.loadedSkeletons=e.skeletons,l.loadedAnimationGroups=e.animationGroups,n()},function(e){i._lengthComputable=e.lengthComputable,i._loaded=e.loaded,i._total=e.total,o.handlePreloadingProgress()},function(e,t,n){r(t,n)})},this._tasks.push(l),l},n.prototype.addMeshTask=function(t,n,r,a){var o=this,l=new e.MeshAssetTask(t,n,r,a),i=l;return i._lengthComputable=0,i._loaded=0,i._total=0,i.runTask=function(t,n,r){e.SceneLoader.ImportMesh(l.meshesNames,l.rootUrl,l.sceneFilename,t,function(e,t,r,a){l.loadedMeshes=e,l.loadedParticleSystems=t,l.loadedSkeletons=r,l.loadedAnimationGroups=a,n()},function(e){i._lengthComputable=e.lengthComputable,i._loaded=e.loaded,i._total=e.total,o.handlePreloadingProgress()},function(e,t,n){r(t,n)})},this._tasks.push(l),l},n.prototype.addTextFileTask=function(t,n){var r=this,a=new e.TextFileAssetTask(t,n),o=a;return o._lengthComputable=0,o._loaded=0,o._total=0,o.runTask=function(e,t,n){e._loadFile(a.url,function(e){a.text=e,t()},function(e){o._lengthComputable=e.lengthComputable,o._loaded=e.loaded,o._total=e.total,r.handlePreloadingProgress()},!1,!1,function(e,t){e&&n(e.status+" "+e.statusText,t)})},this._tasks.push(a),a},n.prototype.addBinaryFileTask=function(t,n){var r=this,a=new e.BinaryFileAssetTask(t,n),o=a;return o._lengthComputable=0,o._loaded=0,o._total=0,o.runTask=function(e,t,n){e._loadFile(a.url,function(e){a.data=e,t()},function(e){o._lengthComputable=e.lengthComputable,o._loaded=e.loaded,o._total=e.total,r.handlePreloadingProgress()},!0,!0,function(e,t){e&&n(e.status+" "+e.statusText,t)})},this._tasks.push(a),a},n.prototype.addImageTask=function(t,n){var r=this,a=new e.ImageAssetTask(t,n),o=a;return o._lengthComputable=0,o._loaded=0,o._total=0,o.runTask=function(t,n,l){var i=new Image;e.Tools.SetCorsBehavior(a.url,i),i.onload=function(){a.image=i,n()},i.onerror=function(e){l("Error loading image",e)},i.onprogress=function(e){o._lengthComputable=e.lengthComputable,o._loaded=e.loaded,o._total=e.total,r.handlePreloadingProgress()},i.src=a.url},this._tasks.push(a),a},n.prototype.handlePreloadingProgress=function(){var t=!0,n=0,r=0;if(null!=this._tasks&&this._tasks.length>0)for(var a=0;a<this._tasks.length;a++){var o=this._tasks[a];null!=o._lengthComputable&&null!=o._loaded&&null!=o._total&&(t=t&&o._lengthComputable,n+=o._loaded,r+=o._total)}if(null!=e.SceneManager.OnAssetManagerProgress){var l={lengthComputable:t,loaded:n,total:t?r:0};e.SceneManager.OnAssetManagerProgress(l)}},n}(e.AssetsManager);e.PreloadAssetsManager=x;var A=function(){function e(){}return e.HasNetworkEntity=function(e){return null!=e&&null!=e.networkEntity},e.GetNetworkEntityId=function(e){return null==e?null:null!=e.networkEntity?e.networkEntity.id:null},e.GetNetworkEntityType=function(e){return null==e?0:null!=e.networkEntityType?e.networkEntityType:0},e.GetNetworkEntitySessionId=function(e){return null==e?null:null!=e.networkEntity?e.networkEntity.ownerId:null},e.QueryNetworkAttribute=function(e,t){var n=null;return null!=e&&null!=e.networkEntity&&null!=e.networkEntity.attributes&&(n=e.networkEntity.attributes.get(t)),n},e.QueryBufferedAttribute=function(e,t){var n=0;return null!=e&&null!=e.networkEntityAttributeBuffer&&(n=e.networkEntityAttributeBuffer[t.toFixed(0)]),n},e.PostBufferedAttribute=function(e,t,n){null==e.networkEntityBatch&&(e.networkEntityBatch={}),e.networkEntityBatch[t.toFixed(0)]=n},e}();e.EntityController=A;var O=function(){function t(){}return t.ZeroPad=function(e,t){var n=t-e.toString().length+1;return Array(+(n>0&&n)).join("0")+e},t.ShiftArray=function(e,t){return t?e.unshift(e.pop()):e.push(e.shift()),e},t.IsLayerMasked=function(e,t){return 0!=(e&1<<t)},t.GetLoadingState=function(){return e.Utilities.LoadingState},t.GetRandomRange=function(t,n,r,a){void 0===r&&(r=null),void 0===a&&(a=null);var o=e.Scalar.RandomRange(t,n);if(null!=r){var l=null!=a?a:100;if(o===r)for(var i=0;i<l&&(o=e.Scalar.RandomRange(t,n),o===r);i++);}return o},t.GetRandomFloat=function(t,n,r,a){return void 0===r&&(r=null),void 0===a&&(a=null),parseFloat(e.Utilities.GetRandomRange(t,n,r,a).toFixed(2))},t.GetRandomInteger=function(t,n,r,a){return void 0===r&&(r=null),void 0===a&&(a=null),parseInt(e.Utilities.GetRandomRange(t,n,r,a).toFixed(0))},t.Approximately=function(t,n){return Math.abs(n-t)<Math.max(e.System.Epsilon*Math.max(Math.abs(t),Math.abs(n)),8*e.System.SingleEpsilon)},t.GetVertexDataFromMesh=function(t){var n=t.computeWorldMatrix(!0),r=e.VertexData.ExtractFromMesh(t,!0,!0);return r.transform(n),r},t.UpdateAbstractMeshMaterial=function(t,n,r){if(null!=t){var a=t instanceof e.InstancedMesh;if(a===!1){var o=t.material;if(o instanceof e.MultiMaterial){var l=o.clone(o.name+".Clone");l.subMaterials[r]=n,t.material=l}else t.material=n}else console.warn("Instanced mesh not supported as a node material on mesh: "+t.name)}else console.warn("Null source mesh for mesh: "+t.name)},t.HermiteVector3=function(t,n,r,a,o){var l=new e.Vector3(0,0,0);return e.Utilities.HermiteVector3ToRef(t,n,r,a,o,l),l},t.HermiteVector3ToRef=function(e,t,n,r,a,o){var l=a*a,i=a*l,s=2*i-3*l+1,u=-2*i+3*l,d=i-2*l+a,p=i-l,c=e._x*s+n._x*u+t._x*d+r._x*p,m=e._y*s+n._y*u+t._y*d+r._y*p,f=e._z*s+n._z*u+t._z*d+r._z*p;o.set(c,m,f)},t.LerpLog=function(e,t,n){var r=Math.min(Math.max(n,0),1),a=Math.sin(r*Math.PI*.5);return e+(t-e)*a},t.LerpExp=function(e,t,n){var r=Math.min(Math.max(n,0),1),a=1-Math.cos(r*Math.PI*.5);return e+(t-e)*a},t.LerpUnclamped=function(e,t,n){return e+(t-e)*n},t.LerpUnclampedColor3=function(t,n,r){var a=new e.Color3(0,0,0);return e.Utilities.LerpUnclampedColor3ToRef(t,n,r,a),a},t.LerpUnclampedColor3ToRef=function(e,t,n,r){r.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n)},t.LerpUnclampedColor4=function(t,n,r){var a=new e.Color4(0,0,0,1);return e.Utilities.LerpUnclampedColor4ToRef(t,n,r,a),a},t.LerpUnclampedColor4ToRef=function(e,t,n,r){r.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n,e.a+(t.a-e.a)*n)},t.LerpUnclampedVector2=function(t,n,r){var a=new e.Vector2(0,0);return e.Utilities.LerpUnclampedVector2ToRef(t,n,r,a),a},t.LerpUnclampedVector2ToRef=function(e,t,n,r){r.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},t.LerpUnclampedVector3=function(t,n,r){var a=new e.Vector3(0,0,0);return e.Utilities.LerpUnclampedVector3ToRef(t,n,r,a),a},t.LerpUnclampedVector3ToRef=function(e,t,n,r){r.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n)},t.LerpUnclampedVector4=function(t,n,r){var a=new e.Vector4(0,0,0,0);return e.Utilities.LerpUnclampedVector4ToRef(t,n,r,a),a},t.LerpUnclampedVector4ToRef=function(e,t,n,r){r.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n,e.w+(t.w-e.w)*n)},t.IsEqualUsingDot=function(t){return t>1-e.System.Epsilon},t.QuaternionAngle=function(t,n){var r=Math.min(Math.abs(e.Quaternion.Dot(t,n)),1);return e.Utilities.IsEqualUsingDot(r)?0:2*Math.acos(r)*e.System.Rad2Deg},t.QuaternionLengthSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},t.QuaternionRotateTowards=function(t,n,r){var a=new e.Quaternion(0,0,0,1);return e.Utilities.QuaternionRotateTowardsToRef(t,n,r,a),a},t.QuaternionRotateTowardsToRef=function(t,n,r,a){var o=e.Utilities.QuaternionAngle(t,n);0==o?a.copyFrom(n):e.Utilities.QuaternionSlerpUnclampedToRef(t,n,Math.min(1,r/o),a)},t.QuaternionSlerpUnclamped=function(t,n,r){var a=new e.Quaternion(0,0,0,1);return e.Utilities.QuaternionSlerpUnclampedToRef(t,n,r,a),a},t.QuaternionSlerpUnclampedToRef=function(e,t,n,r){},t.MoveTowardsVector2=function(t,n,r){var a=new e.Vector2(0,0);return e.Utilities.MoveTowardsVector2ToRef(t,n,r,a),a},t.MoveTowardsVector2ToRef=function(e,t,n,r){var a=t.x-e.x,o=t.y-e.y,l=a*a+o*o;if(0==l||n>=0&&l<=n*n)r.set(t.x,t.y);else{var i=Math.sqrt(l);r.set(e.x+a/i*n,e.y+o/i*n)}},t.MoveTowardsVector3=function(t,n,r){var a=new e.Vector3(0,0,0);return e.Utilities.MoveTowardsVector3ToRef(t,n,r,a),a},t.MoveTowardsVector3ToRef=function(e,t,n,r){var a=t.x-e.x,o=t.y-e.y,l=t.z-e.z,i=a*a+o*o+l*l;if(0==i||n>=0&&i<=n*n)r.set(t.x,t.y,t.z);else{var s=Math.sqrt(i);r.set(e.x+a/s*n,e.y+o/s*n,e.z+l/s*n)}},t.MoveTowardsVector4=function(t,n,r){var a=new e.Vector4(0,0,0,0);return e.Utilities.MoveTowardsVector4ToRef(t,n,r,a),a},t.MoveTowardsVector4ToRef=function(e,t,n,r){var a=t.x-e.x,o=t.y-e.y,l=t.z-e.z,i=t.w-e.w,s=a*a+o*o+l*l+i*i;if(0==s||n>=0&&s<=n*n)r.set(t.x,t.y,t.z,t.w);else{var u=Math.sqrt(s);r.set(e.x+a/u*n,e.y+o/u*n,e.z+l/u*n,e.w+i/u*n)}},t.ClampMagnitudeVector2=function(t,n){var r=new e.Vector2(0,0);return e.Utilities.ClampMagnitudeVector2ToRef(t,n,r),r},t.ClampMagnitudeVector2ToRef=function(e,t,n){var r=e.lengthSquared();if(r>t*t){var a=Math.sqrt(r),o=e.x/a,l=e.y/a;n.set(o*t,l*t)}},t.ClampMagnitudeVector3=function(t,n){var r=new e.Vector3(0,0,0);return e.Utilities.ClampMagnitudeVector3ToRef(t,n,r),r},t.ClampMagnitudeVector3ToRef=function(e,t,n){var r=e.lengthSquared();if(r>t*t){var a=Math.sqrt(r),o=e.x/a,l=e.y/a,i=e.z/a;n.set(o*t,l*t,i*t)}},t.GetAngle=function(t,n){return e.Utilities.GetAngleRadians(t,n)*e.System.Rad2Deg},t.GetAngleRadians=function(t,n){return Math.acos(e.Vector3.Dot(t,n))},t.ClampAngle=function(t,n,r){var a=t;do a<-360&&(a+=360),a>360&&(a-=360);while(a<-360||a>360);return e.Scalar.Clamp(a,n,r)},t.ClampAngle180=function(t,n,r){return t>180&&(t-=360),t=e.Scalar.Clamp(t,n,r),t<0&&(t+=360),t},t.ClampAngle360=function(t,n,r){return(t<90||t>270)&&(t>180&&(t-=360),r>180&&(r-=360),n>180&&(n-=360)),t=e.Scalar.Clamp(t,n,r),t<0&&(t+=360),t},t.SmoothDamp=function(t,n,r,a,o,l){if(!l)return 0;var i=t-n,s=Math.max(1e-4,r),u=2/s,d=u*o,p=1/(1+d+.48*d*d+.235*d*d*d),c=n,m=a*s;i=e.Scalar.Clamp(i,-m,m);var f=t-i,h=(l.x+u*i)*o;l.x=(l.x-u*h)*p;var g=f+(i+h)*p;return c-t>0==g>c&&(g=c,l.x=(g-c)/o),g},t.SmoothDampAngle=function(t,n,r,a,o,l){var i=t+e.Scalar.DeltaAngle(t,n);return e.Utilities.SmoothDamp(t,i,r,a,o,l)},t.SmoothDampVector2=function(t,n,r,a,o,l){var i=new e.Vector2(0,0);return e.Utilities.SmoothDampVector2ToRef(t,n,r,a,o,l,i),i},t.SmoothDampVector2ToRef=function(e,t,n,r,a,o,l){n=Math.max(1e-4,n);var i=2/n,s=i*a,u=1/(1+s+.48*s*s+.235*s*s*s),d=e.x-t.x,p=e.y-t.y,c=t.clone(),m=r*n,f=m*m,h=d*d+p*p;if(h>f){var g=Math.sqrt(h);d=d/g*m,p=p/g*m}t.x=e.x-d,t.y=e.y-p;var v=(o.x+i*d)*a,y=(o.y+i*p)*a;o.x=(o.x-i*v)*u,o.y=(o.y-i*y)*u;var C=t.x+(d+v)*u,b=t.y+(p+y)*u,I=c.x-e.x,S=c.y-e.y,_=C-c.x,M=b-c.y;I*_+S*M>0&&(C=c.x,b=c.y,o.x=(C-c.x)/a,o.y=(b-c.y)/a),l.set(C,b)},t.SmoothDampVector3=function(t,n,r,a,o,l){var i=new e.Vector3(0,0,0);return e.Utilities.SmoothDampVector3ToRef(t,n,r,a,o,l,i),i},t.SmoothDampVector3ToRef=function(e,t,n,r,a,o,l){var i=0,s=0,u=0;n=Math.max(1e-4,n);var d=2/n,p=d*a,c=1/(1+p+.48*p*p+.235*p*p*p),m=e.x-t.x,f=e.y-t.y,h=e.z-t.z,g=t.clone(),v=r*n,y=v*v,C=m*m+f*f+h*h;if(C>y){var b=Math.sqrt(C);m=m/b*v,f=f/b*v,h=h/b*v}t.x=e.x-m,t.y=e.y-f,t.z=e.z-h;var I=(o.x+d*m)*a,S=(o.y+d*f)*a,_=(o.z+d*h)*a;o.x=(o.x-d*I)*c,o.y=(o.y-d*S)*c,o.z=(o.z-d*_)*c,i=t.x+(m+I)*c,s=t.y+(f+S)*c,u=t.z+(h+_)*c;var M=g.x-e.x,T=g.y-e.y,x=g.z-e.z,A=i-g.x,O=s-g.y,w=u-g.z;M*A+T*O+x*w>0&&(i=g.x,s=g.y,u=g.z,o.x=(i-g.x)/a,o.y=(s-g.y)/a,o.z=(u-g.z)/a),l.set(i,s,u)},t.ToMatrix=function(t,n,r){return e.Matrix.RotationYawPitchRoll(e.Tools.ToRadians(n),e.Tools.ToRadians(t),e.Tools.ToRadians(r))},t.ToMatrixToRef=function(t,n,r,a){e.Matrix.RotationYawPitchRollToRef(e.Tools.ToRadians(n),e.Tools.ToRadians(t),e.Tools.ToRadians(r),a)},t.FastMatrixLerp=function(t,n,r,a){e.Matrix.LerpToRef(t,n,r,a)},t.FastMatrixSlerp=function(t,n,r,a){e.Matrix.DecomposeLerpToRef(t,n,r,a)},t.ToEuler=function(t){var n=t.toEulerAngles();return n.x=e.Tools.ToDegrees(n.x),n.y=e.Tools.ToDegrees(n.y),n.z=e.Tools.ToDegrees(n.z),n},t.ToEulerToRef=function(t,n){t.toEulerAnglesToRef(n),n.x=e.Tools.ToDegrees(n.x),n.y=e.Tools.ToDegrees(n.y),n.z=e.Tools.ToDegrees(n.z)},t.FromEuler=function(t,n,r){return e.Quaternion.FromEulerAngles(e.Tools.ToRadians(t),e.Tools.ToRadians(n),e.Tools.ToRadians(r))},t.FromEulerToRef=function(t,n,r,a){e.Quaternion.FromEulerAnglesToRef(e.Tools.ToRadians(t),e.Tools.ToRadians(n),e.Tools.ToRadians(r),a)},t.QuaternionDiff=function(t,n){var r=new e.Quaternion(0,0,0,1);return e.Utilities.QuaternionDiffToRef(t,n,r),r},t.QuaternionDiffToRef=function(t,n,r){e.Quaternion.InverseToRef(n,e.Utilities.TempQuaternion),t.multiplyToRef(e.Utilities.TempQuaternion,r)},t.QuaternionSubtractToRef=function(e,t,n){n.set(e._x-t._x,e._y-t._y,e._z-t._z,e._w-t._w)},t.RotateVector=function(t,n){var r=2*(n.y*t.z-n.z*t.y),a=2*(n.z*t.x-n.x*t.z),o=2*(n.x*t.y-n.y*t.x);return new e.Vector3(t.x+n.w*r+(n.y*o-n.z*a),t.y+n.w*a+(n.z*r-n.x*o),t.z+n.w*o+(n.x*a-n.y*r))},t.RotateVectorToRef=function(e,t,n){var r=2*(t.y*e.z-t.z*e.y),a=2*(t.z*e.x-t.x*e.z),o=2*(t.x*e.y-t.y*e.x);n.x=e.x+t.w*r+(t.y*o-t.z*a),n.y=e.y+t.w*a+(t.z*r-t.x*o),n.z=e.z+t.w*o+(t.x*a-t.y*r)},t.LookRotation=function(t){var n=e.Quaternion.Zero();return e.Utilities.LookRotationToRef(t,n),n},t.LookRotationToRef=function(t,n){e.Utilities.TempMatrix.reset(),e.Matrix.LookAtLHToRef(e.Utilities.ZeroVector,t,e.Utilities.UpVector,e.Utilities.TempMatrix),e.Utilities.TempMatrix.invert(),e.Quaternion.FromRotationMatrixToRef(e.Utilities.TempMatrix,n)},t.Vector3Rad2Deg=function(t){var n=e.Vector3.Zero();return e.Utilities.Vector3Rad2DegToRef(t,n),n},t.Vector3Rad2DegToRef=function(t,n){n.x=e.Tools.ToDegrees(t.x),n.y=e.Tools.ToDegrees(t.y),n.z=e.Tools.ToDegrees(t.z)},t.MultiplyQuaternionByVector=function(t,n){var r=new e.Vector3(0,0,0);return e.Utilities.MultiplyQuaternionByVectorToRef(t,n,r),r},t.MultiplyQuaternionByVectorToRef=function(e,t,n){var r=2*e.x,a=2*e.y,o=2*e.z,l=e.x*r,i=e.y*a,s=e.z*o,u=e.x*a,d=e.x*o,p=e.y*o,c=e.w*r,m=e.w*a,f=e.w*o;n.x=(1-(i+s))*t.x+(u-f)*t.y+(d+m)*t.z,n.y=(u+f)*t.x+(1-(l+s))*t.y+(p-c)*t.z,n.z=(d-m)*t.x+(p+c)*t.y+(1-(l+i))*t.z},t.ValidateTransformRotation=function(e){null!=e.rotationQuaternion&&(e.rotation=e.rotationQuaternion.toEulerAngles(),e.rotationQuaternion=null)},t.ValidateTransformQuaternion=function(t){null==t.rotationQuaternion&&null!=t.rotation&&(t.rotationQuaternion=e.Quaternion.FromEulerAngles(t.rotation.x,t.rotation.y,t.rotation.z),t.rotation.set(0,0,0))},t.GetKeyboardInputValue=function(t,n,r){var a=r;return e.UserInputOptions.KeyboardSmoothing===!0&&(a=e.Scalar.MoveTowards(n,r,e.UserInputOptions.KeyboardMoveSensibility*e.SceneManager.GetDeltaSeconds(t)),Math.abs(a)<e.UserInputOptions.KeyboardMoveDeadZone&&(a=0)),a},t.GenerateRandonNumber=function(e,t,n){void 0===n&&(n=2);var r=(Math.random()*(t-e)+e).toFixed(n);return parseFloat(r)},t.ProjectVector=function(t,n){var r=new e.Vector3(0,0,0);return e.Utilities.ProjectVectorToRef(t,n,r),r},t.ProjectVectorToRef=function(t,n,r){var a=e.Vector3.Dot(n,n);if(a<e.System.Epsilon)r.set(0,0,0);else{var o=e.Vector3.Dot(t,n);r.set(n.x*o/a,n.y*o/a,n.z*o/a)}},t.ProjectVectorOnPlane=function(t,n){var r=new e.Vector3(0,0,0);return e.Utilities.ProjectVectorOnPlaneToRef(t,n,r),r},t.ProjectVectorOnPlaneToRef=function(t,n,r){var a=e.Vector3.Dot(n,n);if(a<e.System.Epsilon)r.copyFrom(t);else{var o=e.Vector3.Dot(t,n);r.set(t.x-n.x*o/a,t.y-n.y*o/a,t.z-n.z*o/a)}},t.AreVectorsEqual=function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n},t.GetVerticalSlopeAngle=function(t,n){void 0===n&&(n=0);var r=Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))*e.System.Rad2Deg;return r=null!=r&&Number.isNaN(r)===!1?r:0,n>0&&r>=n&&(r=0),r},t.DownloadEnvironment=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=null),e.EnvironmentTextureTools.CreateEnvTextureAsync(t).then(function(r){var a=t.name||"Environment",o=new Blob([r],{type:"octet/stream"});e.Tools.Download(o,a+".env"),null!=n&&n()})["catch"](function(e){console.error(e),null!=r&&r()})},t.HasOwnProperty=function(e,t){return null!=e&&null!=t&&""!==t&&t in e},t.FindMeshCollider=function(t,n){var r=null;if(n instanceof e.TransformNode){var a=null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.renderer&&null!=n.metadata.unity.renderer.hasmeshcollider&&n.metadata.unity.renderer.hasmeshcollider===!0;if(a===!0){var o=n.id+"-collider";r=t.getMeshById(o)}}return r},t.ColliderInstances=function(){return null==e.SceneManager.GlobalOptions.colliderInstances||e.SceneManager.GlobalOptions.colliderInstances},t.ReparentColliders=function(){return null==e.SceneManager.GlobalOptions.reparentColliders||e.SceneManager.GlobalOptions.reparentColliders},t.UseTriangleNormals=function(){return null!=e.SceneManager.GlobalOptions.useTriangleNormals&&e.SceneManager.GlobalOptions.useTriangleNormals},t.UseConvexTriangles=function(){return null!=e.SceneManager.GlobalOptions.useConvexTriangles&&e.SceneManager.GlobalOptions.useConvexTriangles},t.DefaultRenderGroup=function(){return null!=e.SceneManager.GlobalOptions.defaultRenderGroup?e.SceneManager.GlobalOptions.defaultRenderGroup:0},t.ShowDebugColliders=function(){return null!=e.SceneManager.GlobalOptions.showDebugColliders&&e.SceneManager.GlobalOptions.showDebugColliders},t.ColliderVisibility=function(){return null!=e.SceneManager.GlobalOptions.colliderVisibility?e.SceneManager.GlobalOptions.colliderVisibility:0},t.ColliderRenderGroup=function(){return null!=e.SceneManager.GlobalOptions.colliderRenderGroup?e.SceneManager.GlobalOptions.colliderRenderGroup:0},t.CollisionWireframe=function(){return null!=e.SceneManager.GlobalOptions.collisionWireframe&&e.SceneManager.GlobalOptions.collisionWireframe},t.GetColliderMaterial=function(t){var n="Collider-Material",r=t.getMaterialByName(n);if(null==r){var a=new e.PBRMaterial(n,t);a.albedoColor=new e.Color3(0,.75,0),a.wireframe=e.Utilities.CollisionWireframe(),a.unlit=!0,r=a}return r},t.CalculateCombinedFriction=function(e,t){var n=10,r=e*t;return r<-n&&(r=-n),r>n&&(r=n),r},t.CalculateCombinedRestitution=function(e,t){return e*t},t.GetDirectTargetAngle=function(t,n){return e.Utilities.TempVector3.set(0,0,0),e.Utilities.InverseTransformPointToRef(t,n,e.Utilities.TempVector3),Math.atan2(e.Utilities.TempVector3.x,e.Utilities.TempVector3.z)},t.GetSmoothTargetAngle=function(t,n){return e.Utilities.TempVector3.set(0,0,0),e.Utilities.InverseTransformPointToRef(t,n,e.Utilities.TempVector3),e.Utilities.TempVector3.x/e.Utilities.TempVector3.length()},t.CalculatCatmullRom=function(t,n,r,a,o){var l=new e.Vector3(0,0,0);return e.Utilities.CalculatCatmullRomToRef(t,n,r,a,o,l),l},t.CalculatCatmullRomToRef=function(e,t,n,r,a,o){},t.StartsWith=function(e,t){return 0===e.lastIndexOf(t,0)},t.EndsWith=function(e,t){return e.indexOf(t,e.length-t.length)!==-1},t.ReplaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},t.IsNullOrEmpty=function(e){return null==e||""===e},t.SafeStringPush=function(e,t){e.indexOf(t)===-1&&e.push(t)},t.ParseColor3=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=null;return a=null!=t&&null!=t.r&&null!=t.g&&null!=t.b?r===!0?new e.Color3(t.r,t.g,t.b).toLinearSpace():new e.Color3(t.r,t.g,t.b):n},t.ParseColor4=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=null;if(null!=t&&null!=t.r&&null!=t.g&&null!=t.b){var o=null!=t.a?t.a:1;a=r===!0?new e.Color4(t.r,t.g,t.b,o).toLinearSpace():new e.Color4(t.r,t.g,t.b,o)}else a=n;return a},t.ParseVector2=function(t,n){void 0===n&&(n=null);var r=null;return r=null!=t&&null!=t.x&&null!=t.y?new e.Vector2(t.x,t.y):n},t.ParseVector3=function(t,n){void 0===n&&(n=null);var r=null;return r=null!=t&&null!=t.x&&null!=t.y&&null!=t.z?new e.Vector3(t.x,t.y,t.z):n},t.ParseVector4=function(t,n){void 0===n&&(n=null);var r=null;return r=null!=t&&null!=t.x&&null!=t.y&&null!=t.z&&null!=t.w?new e.Vector4(t.x,t.y,t.z,t.w):n},t.ParseSound=function(t,n,r,a,o){var l=null;if(null!=t&&null!=t.filename&&""!==t.filename){var i=e.SceneManager.GetRootUrl(n),s=t.filename;l=new e.Sound(r,i+s,n,a,o)}return l},t.ParseTexture=function(t,n,r,a,o,l,i,s,u,d){var p=null;if(null!=t&&null!=t.filename&&""!==t.filename){var c=e.SceneManager.GetRootUrl(n),m=t.filename;p=new e.Texture(c+m,n,r,a,o,l,i,s,u,d)}return p},t.ParseCubemap=function(t,n){var r=null;if(null!=t&&null!=t.info){var a=e.SceneManager.GetRootUrl(n),o=a+t.info.rooturl;r=e.CubeTexture.Parse(t.info,n,o),null!=r&&(r.gammaSpace=!1)}return r},t.ParseTextAsset=function(e,t){void 0===t&&(t=null);var n=null;return n=null!=e&&null!=e.base64&&""!==e.base64?window.atob(e.base64):t},t.ParseJsonAsset=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=null);var a=e.Utilities.ParseTextAsset(t,n);return null!=a&&""!==a?JSON.parse(a,r):null},t.ParseTransformByID=function(t,n,r){void 0===r&&(r=null);var a=null;return a=null!=t&&null!=t.id?e.SceneManager.GetTransformNodeByID(n,t.id):r},t.ParseTransformByName=function(t,n,r){void 0===r&&(r=null);var a=null;return a=null!=t&&null!=t.id?e.SceneManager.GetTransformNode(n,t.id):r},t.ParseChildTransform=function(t,n,r){void 0===r&&(r=null);var a=null;return a=null!=n&&null!=n.name?e.SceneManager.FindChildTransformNode(t,n.name,e.SearchType.IndexOf,!1):r},t.SetAbsolutePosition=function(e,t){e.setAbsolutePosition(t)},t.GetAbsolutePosition=function(t,n,r){return void 0===n&&(n=null),void 0===r&&(r=!0),e.Utilities.TransformPoint(t,n||e.Utilities.ZeroVector,r)},t.GetAbsolutePositionToRef=function(t,n,r,a){void 0===r&&(r=null),void 0===a&&(a=!0),e.Utilities.TransformPointToRef(t,r||e.Utilities.ZeroVector,n,a)},t.SetAbsoluteRotation=function(t,n){null==t.rotationQuaternion&&(t.rotationQuaternion=t.rotation.toQuaternion()),null!=t.parent&&t.parent instanceof e.TransformNode?(e.Utilities.TempQuaternion2.set(0,0,0,1),e.Utilities.GetAbsoluteRotationToRef(t.parent,e.Utilities.TempQuaternion2),e.Quaternion.InverseToRef(e.Utilities.TempQuaternion2,e.Utilities.TempQuaternion2),e.Utilities.TempQuaternion2.multiplyInPlace(n),t.rotationQuaternion.copyFrom(e.Utilities.TempQuaternion2)):t.rotationQuaternion.copyFrom(n)},t.GetAbsoluteRotation=function(t){var n=new e.Quaternion(0,0,0,1);return e.Utilities.GetAbsoluteRotationToRef(t,n),n},t.GetAbsoluteRotationToRef=function(t,n){if(null!=t.parent&&t.parent instanceof e.TransformNode)return e.Utilities.GetAbsoluteRotationToRef(t.parent,n),null==t.rotationQuaternion&&(t.rotationQuaternion=t.rotation.toQuaternion()),void n.multiplyInPlace(t.rotationQuaternion);var r=t.scaling;if(1==r.x&&1==r.y&&1==r.z)n.copyFrom(t.absoluteRotationQuaternion);else{var a=1/r.x,o=1/r.y,l=1/r.z,i=t.getWorldMatrix()._m;e.Utilities.TempMatrix2.reset(),e.Matrix.FromValuesToRef(i[0]*a,i[1]*a,i[2]*a,0,i[4]*o,i[5]*o,i[6]*o,0,i[8]*l,i[9]*l,i[10]*l,0,0,0,0,1,e.Utilities.TempMatrix2),e.Utilities.TempQuaternion3.set(0,0,0,1),e.Utilities.TempMatrix2.decompose(void 0,e.Utilities.TempQuaternion3,void 0),n.copyFrom(e.Utilities.TempQuaternion3)}},t.TransformPoint=function(t,n,r){return void 0===r&&(r=!0),r===!0&&t.computeWorldMatrix(),e.Vector3.TransformCoordinates(n,t.getWorldMatrix())},t.InverseTransformPoint=function(t,n,r){return void 0===r&&(r=!0),r===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformCoordinates(n,e.Utilities.TempMatrix)},t.TransformPointToRef=function(t,n,r,a){void 0===a&&(a=!0),a===!0&&t.computeWorldMatrix(),e.Vector3.TransformCoordinatesToRef(n,t.getWorldMatrix(),r)},t.InverseTransformPointToRef=function(t,n,r,a){void 0===a&&(a=!0),a===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformCoordinatesToRef(n,e.Utilities.TempMatrix,r)},t.TransformDirection=function(t,n,r){return void 0===r&&(r=!0),r===!0&&t.computeWorldMatrix(),e.Vector3.TransformNormal(n,t.getWorldMatrix())},t.InverseTransformDirection=function(t,n,r){return void 0===r&&(r=!0),r===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformNormal(n,e.Utilities.TempMatrix)},t.TransformDirectionToRef=function(t,n,r,a){void 0===a&&(a=!0),a===!0&&t.computeWorldMatrix(),e.Vector3.TransformNormalToRef(n,t.getWorldMatrix(),r)},t.InverseTransformDirectionToRef=function(t,n,r,a){void 0===a&&(a=!0),a===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformNormalToRef(n,e.Utilities.TempMatrix,r)},t.RecomputeCenterPivotPoint=function(t){var n=t.getBoundingInfo().boundingSphere.center;t.setPivotMatrix(e.Matrix.Translation(-n.x,-n.y,-n.z))},t.GetDirectionVector=function(e,t){return e.getDirection(t)},t.GetDirectionVectorToRef=function(e,t,n){e.getDirectionToRef(t,n)},t.GetForwardVector=function(t){return t.getDirection(e.Vector3.Forward())},t.GetForwardVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Forward(),n)},t.GetRightVector=function(t){return t.getDirection(e.Vector3.Right())},t.GetRightVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Right(),n)},t.GetUpVector=function(t){return t.getDirection(e.Vector3.Up())},t.GetUpVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Up(),n)},t.BlendFloatValue=function(t,n,r){var a=e.Scalar.Clamp(r,0,1);return a>0?e.Scalar.Lerp(t,n,a):t},t.BlendVector2Value=function(t,n,r){var a=e.Scalar.Clamp(r,0,1);if(a>0){var o=e.Vector2.Lerp(t,n,a);t.copyFrom(o)}},t.BlendVector3Value=function(t,n,r){var a=e.Scalar.Clamp(r,0,1);a>0&&e.Vector3.LerpToRef(t,n,a,t)},t.BlendQuaternionValue=function(t,n,r){var a=e.Scalar.Clamp(r,0,1);a>0&&e.Quaternion.SlerpToRef(t,n,a,t)},t.SetAnimationTargetProperty=function(e,t){null!=e&&(e.targetProperty=t,e.targetPropertyPath=e.targetProperty.split("."))},t.SampleAnimationFloat=function(t,n,r,a){void 0===r&&(r=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===a&&(a=!1);var o=0;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_FLOAT&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:r,workValue:e.Matrix.Zero()}),o=e.Utilities.InterpolateAnimation(t,n,t._state,a)),o},t.SampleAnimationVector2=function(t,n,r,a){void 0===r&&(r=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===a&&(a=!1);var o=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_VECTOR2&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:r,workValue:e.Matrix.Zero()}),o=e.Utilities.InterpolateAnimation(t,n,t._state,a)),o},t.SampleAnimationVector3=function(t,n,r,a){
void 0===r&&(r=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===a&&(a=!1);var o=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_VECTOR3&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:r,workValue:e.Matrix.Zero()}),o=e.Utilities.InterpolateAnimation(t,n,t._state,a)),o},t.SampleAnimationQuaternion=function(t,n,r,a){void 0===r&&(r=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===a&&(a=!1);var o=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_QUATERNION&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:r,workValue:e.Matrix.Zero()}),o=e.Utilities.InterpolateAnimation(t,n,t._state,a)),o},t.SampleAnimationMatrix=function(t,n,r,a){void 0===r&&(r=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===a&&(a=!1);var o=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_MATRIX&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:r,workValue:e.Matrix.Zero()}),o=e.Utilities.InterpolateAnimation(t,n,t._state,a)),o},t.CreateTweenAnimation=function(t,n,r,a,o,l){void 0===o&&(o=30),void 0===l&&(l=e.Animation.ANIMATIONLOOPMODE_RELATIVE);var i=[];i.push({frame:0,value:r}),i.push({frame:o,value:a});var s=new e.Animation(t,n,o,e.Animation.ANIMATIONTYPE_FLOAT,l);return s.setKeys(i),s},t.GetLastKeyFrameIndex=function(e){var t=0;if(null!=e){var n=e.getKeys();if(null!=n&&n.length>0){var r=n[n.length-1];null!=r&&(t=r.frame)}}return t},t.InterpolateAnimation=function(t,n,r,a){void 0===a&&(a=!1);var o=a===!0?n*e.SceneManager.AnimationTargetFps:n;return t._interpolate(o,r)},t.UpdateLoopBlendPositionSettings=function(e,t,n){var r=e;null!=r.metadata&&null!=r.metadata.unity&&null!=r.metadata.unity.settings&&(r.metadata.unity.settings.loopblendpositiony=t,r.metadata.unity.settings.loopblendpositionxz=n)},t.InitializeShaderMaterial=function(t,n,r){void 0===n&&(n=!0),void 0===r&&(r=!1);var a=t,o=e.Utilities.HasOwnProperty(a,"getShaderName")?a.getShaderName():"glsl",l=!!e.Utilities.HasOwnProperty(a,"getAlphaBlending")&&a.getAlphaBlending(),i=!!e.Utilities.HasOwnProperty(a,"getAlphaTesting")&&a.getAlphaTesting(),s=e.Utilities.HasOwnProperty(a,"getDefaultDefines")?a.getDefaultDefines():null,u=e.Utilities.HasOwnProperty(a,"getDefaultAttributes")?a.getDefaultAttributes():null,d=e.Utilities.HasOwnProperty(a,"getDefaultUniforms")?a.getDefaultUniforms():null;(null==s||s.length<=0)&&(s=["#define GAMETIME","#define DELTATIME","#define DIFFUSECOLOR","#define DIFFUSETEXTURE"]),(null==u||u.length<=0)&&(u=["position","normal","uv","uv2","color"]),(null==d||d.length<=0)&&(d=["world","worldView","worldViewProjection","view","projection","viewProjection","gameTime","deltaTime","diffuseColor","diffuseTexture","diffuseTextureInfos","diffuseTextureMatrix"]);var p={vertex:o,fragment:o},c={needAlphaBlending:l,needAlphaTesting:i,attributes:u,uniforms:d,defines:s,useClipPlane:r,samplers:[],uniformBuffers:[],externalTextures:[],samplerObjects:[],storageBuffers:[]};a._shaderPath=p,a._options=c,n===!0&&(a.fn_afterBind=a.bind,a.bind=function(e,n,r){if(void 0===r&&(r=null),null!=a.updateGlobalTime&&a.updateGlobalTime(),a.after&&a.after(),a.fn_afterBind)try{a.fn_afterBind(e,n,r)}catch(o){}var l=null!==r&&void 0!==r?r:a.getEffect(),i=t.getScene();if(i.texturesEnabled&&null!=l)for(var s in a._textures){var u=a._textures[s];null!=u&&(l.setFloat2(s+"Infos",u.coordinatesIndex,u.level),l.setMatrix(s+"Matrix",u.getTextureMatrix()))}}),a.awake&&a.awake()},t.WorldToScreenPoint=function(t,n,r){void 0===r&&(r=null);var a=null,o=null!=r?r.viewport:null!=t.activeCamera?t.activeCamera.viewport:null;return null!=o&&(a=e.Vector3.Project(n,e.Matrix.Identity(),t.getTransformMatrix(),o.toGlobal(t.getEngine().getRenderWidth(),t.getEngine().getRenderHeight()))),a},t.ScreenToWorldPoint=function(t,n){return e.Vector3.Unproject(n,t.getEngine().getRenderWidth(),t.getEngine().getRenderHeight(),e.Matrix.Identity(),t.getViewMatrix(),t.getProjectionMatrix())},t.LoadTextFile=function(t,n,r,a){return e.Tools.LoadFile(t,n,r,null,!1,a)},t.LoadTextFileAsync=function(t){return e.Tools.LoadFileAsync(t,!1)},t.GetHttpRequest=function(e,t,n,r,a,o,l){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=!1),void 0===l&&(l=null);var i=new XMLHttpRequest;return i.open("GET",e,!0),o===!0&&(i.responseType="arraybuffer"),null!=l&&i.overrideMimeType(l),null!=t&&t.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&i.setRequestHeader(e.name,e.value)}),i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&null!=n&&n(i)},i.onprogress=function(e){null!=a&&a(e)},i.onerror=function(){null!=r&&r("Failed to get data from server.")},i.onabort=function(){null!=r&&r("Aborted get data from server.")},i.send(null),i},t.GetHttpRequestAsync=function(t,n,r,a,o){return void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===o&&(o=null),new Promise(function(l,i){e.Utilities.GetHttpRequest(t,n,function(e){l(e)},function(e){i(e)},r,a,o)})},t.PostHttpRequest=function(e,t,n,r,a,o,l,i,s){void 0===n&&(n=null),void 0===r&&(r="application/x-www-form-urlencoded"),void 0===a&&(a=null),void 0===o&&(o=null),void 0===l&&(l=null),void 0===i&&(i=!1),void 0===s&&(s=null);var u=new XMLHttpRequest;return u.open("POST",e,!0),i===!0&&(u.responseType="arraybuffer"),null!=s&&u.overrideMimeType(s),null!=n&&n.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&u.setRequestHeader(e.name,e.value)}),u.setRequestHeader("Content-Type",r),u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&null!=a&&a(u)},u.onprogress=function(e){null!=l&&l(e)},u.onerror=function(){null!=o&&o("Failed to post data to server.")},u.onabort=function(){null!=o&&o("Aborted post data to server.")},u.send(t),u},t.PostHttpRequestAsync=function(t,n,r,a,o,l,i){return void 0===r&&(r=null),void 0===a&&(a="application/x-www-form-urlencoded"),void 0===o&&(o=null),void 0===l&&(l=!1),void 0===i&&(i=null),new Promise(function(s,u){e.Utilities.PostHttpRequest(t,n,r,a,function(e){s(e)},function(e){u(e)},o,l,i)})},t.RemapValueToRange=function(e,t,n,r,a){return r+(e-t)*(a-r)/(n-t)},t.CloneSkeletonPrefab=function(t,n,r,a,o){void 0===o&&(o=null);var l=new e.Skeleton(r,a||r,t);l.needInitialSkinMatrix=n.needInitialSkinMatrix;for(var i=0;i<n.bones.length;i++){var s=n.bones[i],u=null,d=s.getParent();if(d){var p=n.bones.indexOf(d);u=l.bones[p]}var c=new e.Bone(s.name,l,u,s.getBaseMatrix().clone(),s.getRestPose().clone());c._index=s._index,c.metadata=s.metadata,s._linkedTransformNode&&c.linkTransformNode(s._linkedTransformNode),e.DeepCopier.DeepCopy(s.animations,c.animations)}var m=l,f=n;if(f._ranges){m._ranges={};for(var h in f._ranges){var g=f._ranges[h];g&&(m._ranges[h]=g.clone())}}return f._isDirty=!0,l},t.GetSceneTransforms=function(e){var t=null;return null!=e.transformNodes&&e.transformNodes.length>0&&e.transformNodes.forEach(function(e){null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.prefab&&e.metadata.unity.prefab===!1&&(null==t&&(t=[]),t.push(e))}),null!=e.meshes&&e.meshes.length>0&&e.meshes.forEach(function(e){null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.prefab&&e.metadata.unity.prefab===!1&&(null==t&&(t=[]),t.push(e))}),t},t.PostParseSceneComponents=function(t,n,r,a){if(null!=n&&n.length>0){var o=new e.MetadataParser(t);n.forEach(function(e){o.parseSceneComponents(e)}),o.postProcessSceneComponents(r,a)}},t.GetAssetContainerMesh=function(t,n){var r=null,a=n.toLowerCase();if(null==r&&null!=t.meshes&&t.meshes.length>0)for(var o=0;o<t.meshes.length;o++){var l=t.meshes[o];if(l instanceof e.Mesh&&l.name.toLowerCase()===a){r=l;break}}return r},t.GetAssetContainerNode=function(e,t){var n=null,r=t.toLowerCase();if(null==n&&null!=e.transformNodes&&e.transformNodes.length>0)for(var a=0;a<e.transformNodes.length;a++){var o=e.transformNodes[a];if(o.name.toLowerCase()===r){n=o;break}}return n},t.CloneAssetContainerItem=function(t,n,r,a,o,l){void 0===a&&(a=null),void 0===o&&(o=!1),void 0===l&&(l=!0);var i=null,s={},u={},d={},p=null,c=null,m=[],f=[],h=n.toLowerCase(),g=null,v=function(t,n){null==g&&(g=n),s[t.uniqueId]=n.uniqueId,u[n.uniqueId]=n,r&&(n.name=r(t.name)),null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.entity&&(n.metadata=e.Utilities.CloneEntityMetadata(t.metadata));var a=null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.animator?n.metadata.unity.animator:null;if(null!=a&&""!==a&&(null==p&&(p=[]),p.indexOf(a)<0&&p.push(a),n.metadata.unity.animator=e.Utilities.CreateGuid(),d[a]=n.metadata.unity.animator),t instanceof e.AbstractMesh&&null!=t.skeleton&&(null==c&&(c=[]),c.indexOf(t.skeleton)<0&&c.push(t.skeleton)),n instanceof e.Mesh){var o=n;if(o.morphTargetManager){var l=t.morphTargetManager;o.morphTargetManager=l.clone();for(var i=0;i<l.numTargets;i++){var m=l.getTarget(i),f=o.morphTargetManager.getTarget(i);s[m.uniqueId]=f.uniqueId,u[f.uniqueId]=f}}}};if(null==i&&null!=t.transformNodes&&t.transformNodes.length>0)for(var y=0;y<t.transformNodes.length;y++){var C=t.transformNodes[y];if(C.name.toLowerCase()===h){var b=e.Utilities.InstantiateHierarchy(C,a,function(e,t){v(e,t)});if(b){i=b;break}}}if(null==i&&null!=t.meshes&&t.meshes.length>0)for(var I=function(n){var l=t.meshes[n];if(l.name.toLowerCase()===h){var d=e.Utilities.InstantiateHierarchy(l,a,function(e,n){v(e,n);var a=n;if(l.isWorldMatrixFrozen===!0&&a.freezeWorldMatrix&&a.freezeWorldMatrix(),n.material&&a.material)if(o===!0){var i=e.material;if(f.indexOf(i)===-1){var d=i.clone(r?r(i.name):"Clone of "+i.name);if(i.isFrozen===!0&&d.freeze&&d.freeze(),f.push(i),s[i.uniqueId]=d.uniqueId,u[d.uniqueId]=d,"MultiMaterial"===i.getClassName())for(var p=i,c=0,m=p.subMaterials;c<m.length;c++){var h=m[c];h&&(d=h.clone(r?r(h.name):"Clone of "+h.name),h.isFrozen===!0&&d.freeze&&d.freeze(),f.push(h),s[h.uniqueId]=d.uniqueId,u[d.uniqueId]=d)}}a.material=u[s[i.uniqueId]]}else"MultiMaterial"===a.material.getClassName()?t.scene.multiMaterials.indexOf(a.material)===-1&&t.scene.addMultiMaterial(a.material):t.scene.materials.indexOf(a.material)===-1&&t.scene.addMaterial(a.material)});if(d)return i=d,"break"}},y=0;y<t.meshes.length;y++){var S=I(y);if("break"===S)break}if(null!=c&&c.length>0&&c.forEach(function(n){for(var a=r?r(n.name):"Clone of "+n.name,o=e.Utilities.CloneSkeletonPrefab(t.scene,n,a,a,g),l=0,i=t.meshes;l<i.length;l++){var d=i[l];if(d.skeleton===n&&!d.isAnInstance){var p=u[s[d.uniqueId]];if(p.skeleton=o,m.indexOf(o)!==-1)continue;m.push(o);for(var c=0,f=o.bones;c<f.length;c++){var h=f[c];h._linkedTransformNode&&(h._linkedTransformNode=u[s[h._linkedTransformNode.uniqueId]])}}}}),l===!0){var _=null;t.animationGroups.forEach(function(e){var t=e,n=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.source&&""!==t.metadata.unity.source?t.metadata.unity.source:null;if(null!=n&&""!==n&&null!=p&&p.indexOf(n)>=0){var r=e.clone(e.name,function(e){var t=u[s[e.uniqueId]];return t||e}),a=d[n]||n;null!=t.metadata&&(r.metadata={},r.metadata.unity={},r.metadata.unity.id=t.metadata.unity.id,r.metadata.unity.clip=t.metadata.unity.clip,r.metadata.unity.source=a,r.metadata.unity.legacy=t.metadata.unity.legacy,r.metadata.unity.length=t.metadata.unity.length,r.metadata.unity.looping=t.metadata.unity.looping,r.metadata.unity.settings=t.metadata.unity.settings,r.metadata.unity.behavior=t.metadata.unity.behavior,r.metadata.unity.wrapmode=t.metadata.unity.wrapmode,r.metadata.unity.framerate=t.metadata.unity.framerate,r.metadata.unity.humanmotion=t.metadata.unity.humanmotion,r.metadata.unity.averagespeed=t.metadata.unity.averagespeed,r.metadata.unity.averageduration=t.metadata.unity.averageduration,r.metadata.unity.averageangularspeed=t.metadata.unity.averageangularspeed),null==_&&(_=[]),_.push(r)}}),null!=i&&null!=_&&e.Utilities.AssignAnimationGroupsToInstance(i,_)}return i},t.AssignAnimationGroupsToInstance=function(t,n){e.Utilities.AssignAnimationGroupsToNode(t,n);var r=t.getChildren(null,!1);null!=r&&r.length>0&&r.forEach(function(t){e.Utilities.AssignAnimationGroupsToNode(t,n)})},t.AssignAnimationGroupsToNode=function(e,t){if(null!=e&&null!=e.metadata&&e.metadata.unity){var n=e.metadata.unity;if(null!=n.components&&n.components.length>0)for(var r=0;r<n.components.length;r++){var a=n.components[r];if("BABYLON.AnimationState"===a.klass){e.metadata.unity.sourceAnimationGroups=t;break}}}},t.InstantiateHierarchy=function(t,n,r){if(void 0===n&&(n=null),t instanceof e.Mesh){var a=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.instance&&t.metadata.unity.instance===!0;return e.Utilities.InstantiateMeshHierarchy(t,n,a,r)}return e.Utilities.InstantiateNodeHierarchy(t,n,r)},t.InstantiateNodeHierarchy=function(t,n,r){void 0===n&&(n=null);var a=t.clone("Clone of "+(t.name||t.id),n,!0);a&&r&&r(t,a);for(var o=0,l=t.getChildTransformNodes(!0);o<l.length;o++){var i=l[o];e.Utilities.InstantiateHierarchy(i,a,r)}return a},t.InstantiateMeshHierarchy=function(t,n,r,a){void 0===n&&(n=null);var o=t.getTotalVertices()>0&&r===!0?t.createInstance("Instance of "+(t.name||t.id)):t.clone("Clone of "+(t.name||t.id),n||t.parent,!0);o&&(o.parent=n,o.position=t.position.clone(),o.scaling=t.scaling.clone(),t.rotationQuaternion?o.rotationQuaternion=t.rotationQuaternion.clone():o.rotation=t.rotation.clone(),a&&a(t,o));for(var l=0,i=t.getChildTransformNodes(!0);l<i.length;l++){var s=i[l];e.Utilities.InstantiateHierarchy(s,o,a)}return o},t.RetargetAnimationGroupSkeleton=function(e,t,n){void 0===n&&(n=null),null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,r){if(null!=e.target&&null!=e.target.name){var a=t.bones.filter(function(t){return t.name.toLowerCase()===e.target.name.toLowerCase()})[0];if(null!=a){var o=a.getTransformNode();null!=o&&(e.target=a.getTransformNode())}else"Armature"===e.target.name&&null!=n?e.target=n:console.warn("Failed to locate matching animation cloning target: "+e.target.name)}})},t.RetargetAnimationGroupBlendShapes=function(e,t){null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,t){null!=e.target&&null!=e.target.name})},t.LinkSkeletonMeshes=function(t,n){if(null!=t&&null!=t.bones&&t.bones.length>0&&null!=n&&null!=n.bones&&n.bones.length>0)for(var r=n.bones.length,a=0;a<r;a++){var o=n.bones[a];if(null!=o){var l=e.Utilities.FindBoneByName(t,o.name);null!=l?o._linkedTransformNode=l._linkedTransformNode:console.warn("Failed to locate bone on mater rig: "+o.name)}}},t.FindBoneByName=function(e,t){var n=null;if(null!=e&&null!=e.bones)for(var r=0;r<e.bones.length;r++){var a=e.bones[r],o=a.name.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right"),l=t.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right");if(o===l){n=a;break}}return n},t.SwitchHandednessVector3=function(t){return new e.Vector3(t.x,t.y,(-t.z))},t.SwitchHandednessVector4=function(t){return new e.Vector4(t.x,t.y,(-t.z),(-t.w))},t.SwitchHandednessQuaternion=function(t){return new e.Quaternion(t.x,t.y,(-t.z),(-t.w))},t.ComputeBlendingSpeed=function(e,t,n){void 0===n&&(n=!1);var r=1/(e*t);return n===!0&&(r*=.5),r},t.CalculateCameraDistance=function(e,t,n){void 0===n&&(n=1);var r=1;return Math.round(e*n*t*r)},t.InstantiateClass=function(e){for(var t=e.split("."),n=window||this,r=0,a=t.length;r<a;r++)n=n[t[r]];return"function"==typeof n?n:null},t.GetSimpleClassName=function(e){if(e&&e.constructor&&e.constructor.toString){var t=e.constructor.toString().match(/function\s*(\w+)/);if(t&&2==t.length)return t[1]}},t.DisposeEntity=function(t){if(null!=t){if(null!=t.metadata&&t.metadata.unity){var n=t.metadata.unity;null!=n.components&&n.components.length>0&&n.components.forEach(function(t){if(null!=t.instance){try{e.SceneManager.DestroyScriptComponent(t.instance)}catch(n){}t.instance=null}}),delete t.metadata.unity}if(null!=t.metadata&&t.metadata.mixer&&delete t.metadata.mixer,null!=t.metadata&&null!=t.metadata.clone&&delete t.metadata.clone,null!=t.physicsImpostor){var r=t.physicsImpostor;null!=r.onCollideEvent&&(r.onCollideEvent=null),null!=r.tmpCollisionObjects&&delete r.tmpCollisionObjects,null!=t.physicsImpostor.physicsBody&&(null!=t.physicsImpostor.physicsBody.entity&&delete t.physicsImpostor.physicsBody.entity,null!=t.physicsImpostor.physicsBody.triangleMapInfo&&delete t.physicsImpostor.physicsBody.triangleMapInfo),t.physicsImpostor.dispose(),t.physicsImpostor=null}null!=t.skeleton&&(null!=t.skeleton._sockets&&delete t.skeleton._sockets,null!=t.skeleton.bones&&t.skeleton.bones.length>0&&t.skeleton.bones.forEach(function(e){null!=e&&null!=e.metadata&&(e.metadata=null)})),null!=t.cameraRig&&(t.cameraRig.dispose&&t.cameraRig.dispose(),delete t.cameraRig),null!=t.lightRig&&(t.lightRig.dispose&&t.lightRig.dispose(),delete t.lightRig),null!=t.shadowBox&&(t.shadowBox.dispose&&t.shadowBox.dispose(),delete t.shadowBox),null!=t._debugCollider&&(t._debugCollider.dispose&&t._debugCollider.dispose(),delete t._debugCollider),null!=t._meshCollider&&(t._meshCollider=null),null!=t._colliderType&&delete t._colliderType,null!=t._skinnedMesh&&delete t._skinnedMesh}},t.SearchTransformNodes=function(t,n,r){void 0===r&&(r=e.SearchType.ExactMatch);var a=null,o=null!=r?r:e.SearchType.ExactMatch;if(null!=n&&n.length>0)for(var l=0;l<n.length;l++){var i=n[l];if(o===e.SearchType.ExactMatch){if(i.name===t){a=i;break}}else if(o===e.SearchType.StartsWith){if(e.Utilities.StartsWith(i.name,t)){a=i;break}}else if(o===e.SearchType.EndsWith){if(e.Utilities.EndsWith(i.name,t)){a=i;break}}else if(o===e.SearchType.IndexOf){if(i.name.indexOf(t)>=0){a=i;break}}else if(i.name===t){a=i;break}}return a},t.SearchTransformNodeForTags=function(t,n){var r=null;if(null!=n&&n.length>0)for(var a=0;a<n.length;a++){var o=n[a];if(o instanceof e.TransformNode&&e.Tags.MatchesQuery(o,t)){r=o;break}}return r},t.SearchAllTransformNodesForTags=function(t,n){var r=null;if(null!=n&&n.length>0)for(var a=0;a<n.length;a++){var o=n[a];o instanceof e.TransformNode&&e.Tags.MatchesQuery(o,t)&&(null==r&&(r=[]),r.push(o))}return r},t.SearchTransformNodeForScript=function(t,n){var r=null;if(null!=n&&n.length>0)for(var a=0;a<n.length;a++){var o=n[a];if(o instanceof e.TransformNode){var l=e.SceneManager.FindScriptComponent(o,t);if(null!=l){r=o;break}}}return r},t.SearchAllTransformNodesForScript=function(t,n){var r=null;if(null!=n&&n.length>0)for(var a=0;a<n.length;a++){var o=n[a];if(o instanceof e.TransformNode){var l=e.SceneManager.FindScriptComponent(o,t);null!=l&&(null==r&&(r=[]),r.push(o))}}return r},t.CreateGuid=function(t){void 0===t&&(t=null);var n=e.Tools.RandomId();return e.Utilities.IsNullOrEmpty(t)||(n+="-"+t),n},t.ValidateTransformGuid=function(e){if(null!=e&&null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.guid&&""!==e.metadata.unity.guid){var t=e.metadata.unity.guid;e.id!==t&&(e.id=t),delete e.metadata.unity.guid}},t.AddShadowCastersToLight=function(t,n,r){void 0===r&&(r=!1);var a=t.getShadowGenerator();if(null!=a){var o=a.getShadowMap();if(null!=o)for(var l=0;l<n.length;l++){var i=n[l];if(i instanceof e.AbstractMesh&&(null!=t.includedOnlyMeshes&&t.includedOnlyMeshes.length>0&&t.includedOnlyMeshes.indexOf(i)<0&&t.includedOnlyMeshes.push(i),null==o.renderList&&(o.renderList=[]),o.renderList.indexOf(i)<0&&o.renderList.push(i)),r===!0){var s=i.getChildMeshes();null!=s&&s.length>0&&s.forEach(function(e){null!=t.includedOnlyMeshes&&t.includedOnlyMeshes.length>0&&t.includedOnlyMeshes.indexOf(e)<0&&t.includedOnlyMeshes.push(e),null==o.renderList&&(o.renderList=[]),o.renderList.indexOf(e)<0&&o.renderList.push(e)})}}}},t.RegisterInstancedMeshBuffers=function(t){var n=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.buffers?t.metadata.unity.buffers:null;null!=n&&(null!=n.floats&&n.floats.length>0&&n.floats.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,1),t.instancedBuffers[e.kind]=e.value)}),null!=n.colors&&n.colors.length>0&&n.colors.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,4),t.instancedBuffers[n.kind]=new e.Color4(n.value.r||0,n.value.g||0,n.value.b||0,n.value.a||1).toLinearSpace())}),null!=n.vector2&&n.vector2.length>0&&n.vector2.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,2),t.instancedBuffers[n.kind]=new e.Vector2(n.value.x||0,n.value.y||0))}),null!=n.vector3&&n.vector3.length>0&&n.vector3.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,3),t.instancedBuffers[n.kind]=new e.Vector3(n.value.x||0,n.value.y||0,n.value.z||0))}),null!=n.vector4&&n.vector4.length>0&&n.vector4.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,4),t.instancedBuffers[n.kind]=new e.Vector4(n.value.x||0,n.value.y||0,n.value.z||0,n.value.w||0))}))},t.CloneValue=function(t,n){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(n):t.clone?t.clone():t:null},t.CloneEntityMetadata=function(t){var n=null;if(null!=t){var r=null;if(null!=t.unity){var a=null!=t.unity.instance&&t.unity.instance,o=null==t.unity.visible||t.unity.visible,l=null!=t.unity.visibility?t.unity.visibility:1,i=null!=t.unity.billboard?t.unity.billboard:0,s=null!=t.unity.tags?t.unity.tags:"Untagged Layer0",u=null!=t.unity.skin&&t.unity.skin,d=null!=t.unity.bone?t.unity.bone:null,p=null!=t.unity.rootbone&&t.unity.rootbone,c=null!=t.unity.rootpos?t.unity.rootpos:null,m=null!=t.unity.rootrot?t.unity.rootrot:null,f=null!=t.unity.group?t.unity.group:"Untagged",h=null!=t.unity.layer?t.unity.layer:0,g=null!=t.unity.layername?t.unity.layername:"Default",v=null!=t.unity.navigation?t.unity.navigation:null,y=null!=t.unity.lightmapped&&t.unity.lightmapped,C=null!=t.unity.lightmapuvs?t.unity.lightmapuvs:null,b=null!=t.unity.animator?t.unity.animator:null,I=null,S=null,_=null,M=null;t.unity.physics&&(I={},e.Utilities.DeepCopyProperties(t.unity.physics,I)),t.unity.renderer&&(S={},e.Utilities.DeepCopyProperties(t.unity.renderer,S)),t.unity.collision&&(_={},e.Utilities.DeepCopyProperties(t.unity.collision,_)),t.unity.properties&&(M={},e.Utilities.DeepCopyProperties(t.unity.properties,M));var T=null;null!=t.unity.wheels&&t.unity.wheels.length>0&&(T=[],t.unity.wheels.forEach(function(t){if(null!=t){var n={};e.Utilities.DeepCopyProperties(t,n),T.push(n)}}));var x=null;null!=t.unity.components&&t.unity.components.length>0&&(x=[],t.unity.components.forEach(function(t){if(null!=t){var n=e.Utilities.FastJsonCopy(t);n.instance=null,x.push(n)}})),r={},r.parsed=!1,r.prefab=!1,r.buffers=null,r.lods=null,r.coverages=null,r.distances=null,r.handlers=null,r.instance=a,r.visible=o,r.visibility=l,r.billboard=i,r.tags=s,r.skin=u,r.bone=d,r.rootbone=p,r.rootpos=c,r.rootrot=m,r.group=f,r.layer=h,r.layername=g,r.navigation=v,r.lightmapped=y,r.lightmapuvs=C,r.animator=b,r.renderer=S,r.physics=I,r.wheels=T,r.collision=_,r.properties=M,r.components=x}null!=r&&(n={unity:r})}return n},t.FastJsonCopy=function(t){if(!t)return t;if(Array.isArray(t)){for(var n=[],r=t.length,a=0;a<r;a++)n.push(e.Utilities.FastJsonCopy(t[a]));return n}if("object"==typeof t){for(var o=Object.keys(t),l={},a=o.length-1;a>-1;a--){var i=o[a];l[i]=e.Utilities.FastJsonCopy(t[i])}return l}return t},t.DeepCopyProperties=function(t,n,r,a){for(var o in t)if(("_"!==o[0]||a&&a.indexOf(o)!==-1)&&(!r||r.indexOf(o)===-1)){var l=t[o],i=typeof l;if("function"!==i)if("object"===i)if(l instanceof Array){if(n[o]=[],l.length>0)if("object"==typeof l[0])for(var s=0;s<l.length;s++){var u=e.Utilities.CloneValue(l[s],n);n[o].indexOf(u)===-1&&n[o].push(u)}else n[o]=l.slice(0)}else n[o]=e.Utilities.CloneValue(l,n);else n[o]=l}},t.ValidateTransformMetadata=function(t){null==t.metadata&&(t.metadata={}),null==t.metadata.unity&&(t.metadata.unity={});var n=t.metadata.unity;e.Utilities.HasOwnProperty(n,"entity")||(t.metadata.unity.entity=!0),e.Utilities.HasOwnProperty(n,"parsed")||(t.metadata.unity.parsed=!1),e.Utilities.HasOwnProperty(n,"prefab")||(t.metadata.unity.prefab=!1),e.Utilities.HasOwnProperty(n,"instance")||(t.metadata.unity.instance=!1),e.Utilities.HasOwnProperty(n,"buffers")||(t.metadata.unity.buffers=null),e.Utilities.HasOwnProperty(n,"visible")||(t.metadata.unity.visible=!0),e.Utilities.HasOwnProperty(n,"visibility")||(t.metadata.unity.visibility=1),e.Utilities.HasOwnProperty(n,"billboard")||(t.metadata.unity.billboard=0),e.Utilities.HasOwnProperty(n,"tags")||(t.metadata.unity.tags="Untagged Layer0"),e.Utilities.HasOwnProperty(n,"skin")||(t.metadata.unity.skin=!1),e.Utilities.HasOwnProperty(n,"bone")||(t.metadata.unity.bone=null),e.Utilities.HasOwnProperty(n,"rootbone")||(t.metadata.unity.rootbone=!1),e.Utilities.HasOwnProperty(n,"rootpos")||(t.metadata.unity.rootpos=null),e.Utilities.HasOwnProperty(n,"rootrot")||(t.metadata.unity.rootrot=null),e.Utilities.HasOwnProperty(n,"group")||(t.metadata.unity.group="Untagged"),e.Utilities.HasOwnProperty(n,"layer")||(t.metadata.unity.layer=0),e.Utilities.HasOwnProperty(n,"layername")||(t.metadata.unity.layername="Default"),e.Utilities.HasOwnProperty(n,"navigation")||(t.metadata.unity.navigation=null),e.Utilities.HasOwnProperty(n,"lightmapped")||(t.metadata.unity.lightmapped=!1),e.Utilities.HasOwnProperty(n,"lightmapuvs")||(t.metadata.unity.lightmapuvs=!1),e.Utilities.HasOwnProperty(n,"animator")||(t.metadata.unity.animator=null),e.Utilities.HasOwnProperty(n,"lods")||(t.metadata.unity.lods=null),e.Utilities.HasOwnProperty(n,"coverages")||(t.metadata.unity.coverages=null),e.Utilities.HasOwnProperty(n,"distances")||(t.metadata.unity.distances=null),e.Utilities.HasOwnProperty(n,"handlers")||(t.metadata.unity.handlers=null),e.Utilities.HasOwnProperty(n,"physics")||(t.metadata.unity.physics=null),e.Utilities.HasOwnProperty(n,"wheels")||(t.metadata.unity.wheels=null),e.Utilities.HasOwnProperty(n,"renderer")||(t.metadata.unity.renderer=null),e.Utilities.HasOwnProperty(n,"collision")||(t.metadata.unity.collision=null),e.Utilities.HasOwnProperty(n,"properties")||(t.metadata.unity.properties=null),e.Utilities.HasOwnProperty(n,"components")||(t.metadata.unity.components=null)},t.UpVector=e.Vector3.Up(),t.AuxVector=e.Vector3.Zero(),t.ZeroVector=e.Vector3.Zero(),t.TempMatrix=e.Matrix.Zero(),t.TempMatrix2=e.Matrix.Zero(),t.TempVector2=e.Vector2.Zero(),t.TempVector3=e.Vector3.Zero(),t.TempQuaternion=e.Quaternion.Zero(),t.TempQuaternion2=e.Quaternion.Zero(),t.TempQuaternion3=e.Quaternion.Zero(),t.LoadingState=-1,t.OnPreloaderProgress=null,t.OnPreloaderComplete=null,t}();e.Utilities=O}(BABYLON||(BABYLON={}));var UTIL=BABYLON.Utilities,__extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BABYLON;!function(e){var t=function(){function e(){this._defines={},this._defines={}}return e.prototype.getDefines=function(){return this._defines},e.prototype.defineBoolean=function(e){this._defines[e]=!0},e.prototype.defineNumeric=function(e,t){this._defines[e]=t},e.ShaderIndexer=0,e}();e.UniversalShaderDefines=t;var n=function(){function e(){}return e}();e.UniversalAlbedoChunks=n;var r=function(t){function n(n,r,a){void 0===a&&(a=!1);var o=t.call(this,n,r)||this;o.universalMaterial=!0,o.locals=null,o.terrainInfo=null,o._defines=null,o._uniforms=[],o._samplers=[],o._attributes=[],o._textures={},o._vectors4={},o._floats={},o._enableTime=!1,o._timeInitialized=!1,o.dumpEffect=!1,o.locals=new e.UniversalShaderDefines,o._defines=null,o._createdShaderName=null,o.enableShaderChunks=!1,o.materialShaderChunks=new e.UniversalAlbedoChunks,o.customShaderNameResolve=o._buildCustomShader,o.customShaderChunkResolve();var l=o;return l.awake&&l.awake(),o}return __extends(n,t),n.prototype.updateShaderChunks=function(){},n.prototype.getShaderName=function(){return"pbr"},n.prototype.getShaderChunk=function(){return null},n.prototype.getShaderDefines=function(){return this._defines},n.prototype.getCustomAttributes=function(){return null},Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this._timeInitialized===!1?(this._timeInitialized=!0,this.setFloat("gameTime",e.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",e.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},n.prototype.getTexture=function(e){return this._textures[e]},n.prototype.getVector4=function(e){return this._vectors4[e]},n.prototype.getFloat=function(e){return this._floats[e]},n.prototype.setTexture=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkSampler(e),this._textures[e]=t,this},n.prototype.setVector4=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkUniform(e),this._vectors4[e]=t,this},n.prototype.setFloat=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkUniform(e),this._floats[e]=t,this},n.prototype.addAttribute=function(e){this._attributes.indexOf(e)===-1&&this._attributes.push(e)},n.prototype.checkUniform=function(e){this._uniforms.indexOf(e)===-1&&(this._uniforms.push(e),this.locals.defineBoolean(e.toUpperCase()))},n.prototype.checkSampler=function(e){this._samplers.indexOf(e)===-1&&(this._samplers.push(e),this.locals.defineBoolean(e.toUpperCase()),this.checkUniform(e+"Infos"),this.checkUniform(e+"Matrix"))},n.prototype.getAnimatables=function(){var e=t.prototype.getAnimatables.call(this);for(var n in this._textures){var r=this._textures[n];r&&r.animations&&r.animations.length>0&&e.push(r)}return e},n.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);for(var n in this._textures){var r=this._textures[n];r&&e.push(r)}return e},n.prototype.hasTexture=function(e){if(t.prototype.hasTexture.call(this,e))return!0;var n=!1;for(var r in this._textures){var a=this._textures[r];if(a===a){n=!0;break}}return n},n.prototype.dispose=function(e,n){if(n)for(var r in this._textures){var a=this._textures[r];a&&a.dispose(),this._textures[r]=null}this._textures={},t.prototype.dispose.call(this,e,n)},n.prototype.clone=function(t){var n,r=this,a=e.SerializationHelper.Clone(function(){return new e.UniversalAlbedoMaterial(t,r.getScene())},this);a._textures={};for(n in this._textures){var o=this._textures[n];o&&a.setTexture(n,o.clone(),!0)}a._vectors4={};for(n in this._vectors4)a.setVector4(n,this._vectors4[n].clone(),!0);a._floats={};for(n in this._floats)a.setFloat(n,this._floats[n],!0);return a},n.prototype.serialize=function(){var t,n=e.SerializationHelper.Serialize(this);n.customType="BABYLON.UniversalAlbedoMaterial",n.textures={};for(t in this._textures){var r=this._textures[t];r&&(n.textures[t]=r.serialize())}n.vectors4={};for(t in this._vectors4)n.vectors4[t]=this._vectors4[t].asArray();n.floats={};for(t in this._floats)n.floats[t]=this._floats[t];return n},n.Parse=function(t,n,r){var a,o=e.SerializationHelper.Parse(function(){return new e.UniversalAlbedoMaterial(t.name,n)},t,n,r);for(a in t.textures){var l=t.textures[a];l&&o.setTexture(a,e.Texture.Parse(l,n,r),!0)}for(a in t.vectors4)o.setVector4(a,e.Vector4.FromArray(t.vectors4[a]),!0);for(a in t.floats)o.setFloat(a,t.floats[a],!0);return o},n.prototype.customShaderChunkResolve=function(){var t=this.getShaderChunk();if(null!=t&&""!==t){var n=t+"ShaderChunks";if(null!=e.Effect.ShadersStore[n]){var r=e.Effect.ShadersStore[n],a=e.Utilities.HasOwnProperty(r,"VertexBegin")?r.VertexBegin:null;null!=a&&""!==a&&(this.materialShaderChunks.Vertex_Begin=a);var o=e.Utilities.HasOwnProperty(r,"VertexDefinitions")?r.VertexDefinitions:null;null!=o&&""!==o&&(this.materialShaderChunks.Vertex_Definitions=o);var l=e.Utilities.HasOwnProperty(r,"VertexMainBegin")?r.VertexMainBegin:null;
null!=l&&""!==l&&(this.materialShaderChunks.Vertex_MainBegin=l);var i=e.Utilities.HasOwnProperty(r,"VertexUpdatePosition")?r.VertexUpdatePosition:null;null!=i&&""!==i&&(this.materialShaderChunks.Vertex_Before_PositionUpdated=i.replace("result","positionUpdated"));var s=e.Utilities.HasOwnProperty(r,"VertexUpdateNormal")?r.VertexUpdateNormal:null;null!=s&&""!==s&&(this.materialShaderChunks.Vertex_Before_NormalUpdated=s.replace("result","normalUpdated"));var u=e.Utilities.HasOwnProperty(r,"VertexWorldPos")?r.VertexWorldPos:null;null!=u&&""!==u&&(this.materialShaderChunks.Vertex_After_WorldPosComputed=u);var d=e.Utilities.HasOwnProperty(r,"VertexMainEnd")?r.VertexMainEnd:null;null!=d&&""!==d&&(this.materialShaderChunks.Vertex_MainEnd=d);var p=e.Utilities.HasOwnProperty(r,"FragmentBegin")?r.FragmentBegin:null;null!=p&&""!==p&&(this.materialShaderChunks.Fragment_Begin=p);var c=e.Utilities.HasOwnProperty(r,"FragmentDefinitions")?r.FragmentDefinitions:null;null!=c&&""!==c&&(this.materialShaderChunks.Fragment_Definitions=c);var m=e.Utilities.HasOwnProperty(r,"FragmentMainBegin")?r.FragmentMainBegin:null;null!=m&&""!==m&&(this.materialShaderChunks.Fragment_MainBegin=m);var f=e.Utilities.HasOwnProperty(r,"FragmentUpdateAlbedo")?r.FragmentUpdateAlbedo:null;null!=f&&""!==f&&(this.materialShaderChunks.Fragment_Custom_Albedo=f.replace("result","surfaceAlbedo"));var h=e.Utilities.HasOwnProperty(r,"FragmentUpdateAlpha")?r.FragmentUpdateAlpha:null;null!=h&&""!==h&&(this.materialShaderChunks.Fragment_Custom_Alpha=h.replace("result","alpha"));var g=e.Utilities.HasOwnProperty(r,"FragmentMetallicRoughness")?r.FragmentMetallicRoughness:null;null!=g&&""!==g&&(this.materialShaderChunks.Fragment_MetallicRoughness=g);var v=e.Utilities.HasOwnProperty(r,"FragmentMicroSurface")?r.FragmentMicroSurface:null;null!=v&&""!==v&&(this.materialShaderChunks.Fragment_MicroSurface=v);var y=e.Utilities.HasOwnProperty(r,"FragmentBeforeLights")?r.FragmentBeforeLights:null;null!=y&&""!==y&&(this.materialShaderChunks.Fragment_Before_Lights=y);var C=e.Utilities.HasOwnProperty(r,"FragmentBeforeFog")?r.FragmentBeforeFog:null;null!=C&&""!==C&&(this.materialShaderChunks.Fragment_Before_Fog=C);var b=e.Utilities.HasOwnProperty(r,"FragmentBeforeFragColor")?r.FragmentBeforeFragColor:null;null!=b&&""!==b&&(this.materialShaderChunks.Fragment_Before_FragColor=b.replace("result","color"))}else e.Tools.Warn("Failed To Locate Shader Chunk Base: "+n)}},n.prototype._buildCustomShader=function(t,n,r,a,o,l,i){var s=this;null==i||null!=i.processFinalCode&&void 0!=i.processFinalCode||(i.processFinalCode=function(t,n){if("vertex"===t)return n;var r=new e.ShaderCodeInliner(n);return r.inlineToken="#define pbr_inline",r.processCode(),r.code}),this._defines=o;var u=this.locals.getDefines();if(null!=u&&null!=this._defines){var d=Object.keys(u);if(null!=d&&d.length>0){for(var p=this._defines,c=0,m=d;c<m.length;c++){var f=m[c];p[f]=u[f]}this._defines.rebuild()}}var h=0;if(null!=this._uniforms&&this._uniforms.length>0)for(h=0;h<this._uniforms.length;h++){var g=this._uniforms[h];n.indexOf(g)===-1&&n.push(g)}if(h=0,null!=this._samplers&&this._samplers.length>0)for(h=0;h<this._samplers.length;h++){var v=this._samplers[h];a.indexOf(v)===-1&&a.push(v)}if(h=0,null!=this._attributes&&this._attributes.length>0)for(h=0;h<this._attributes.length;h++){var y=this._attributes[h];l.indexOf(y)===-1&&l.push(y)}h=0;var C=this.getCustomAttributes();if(null!=C&&C.length>0)for(h=0;h<C.length;h++){var b=C[h];l.indexOf(b)===-1&&l.push(b)}if(null!=this._createdShaderName&&""!==this._createdShaderName)return this._createdShaderName;var I=this.getShaderName();null!=I&&""!==I||(I=t),null!=I&&""!==I||(I="pbr");var S=this._afterBind.bind(this);return this._afterBind=function(e,t){if(t){s._attachAfterBind(e,t);try{S(e,t)}catch(t){}}},this._createdShaderName=this.enableShaderChunks===!0?this._createShaderChunks(I):I,this._createdShaderName},n.prototype._createShaderChunks=function(t){var n=this.getShaderChunk();null!=n&&""!==n||(n=t),e.UniversalShaderDefines.ShaderIndexer++;var r=(n+"Custom"+e.UniversalShaderDefines.ShaderIndexer).trim(),a=e.Effect.ShadersStore[t+"VertexShader"],o=e.Effect.ShadersStore[t+"PixelShader"];o=o.replace(/#include<pbrBlockAlbedoOpacity>/g,e.Effect.IncludesShadersStore.pbrBlockAlbedoOpacity),o=o.replace(/#include<pbrBlockReflectivity>/g,e.Effect.IncludesShadersStore.pbrBlockReflectivity),o=o.replace(/#include<pbrBlockFinalColorComposition>/g,e.Effect.IncludesShadersStore.pbrBlockFinalColorComposition),this.updateShaderChunks();var l=r+"VertexShader";e.Effect.ShadersStore[l]=a.replace("#define CUSTOM_VERTEX_BEGIN",this.materialShaderChunks.Vertex_Begin?this.materialShaderChunks.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions:"").replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.materialShaderChunks.Vertex_MainBegin?this.materialShaderChunks.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.materialShaderChunks.Vertex_Before_PositionUpdated?this.materialShaderChunks.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.materialShaderChunks.Vertex_Before_NormalUpdated?this.materialShaderChunks.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd:""),this.materialShaderChunks.Vertex_After_WorldPosComputed&&(e.Effect.ShadersStore[l]=e.Effect.ShadersStore[l].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS",this.materialShaderChunks.Vertex_After_WorldPosComputed));var i=r+"PixelShader";return e.Effect.ShadersStore[i]=o.replace("#define CUSTOM_FRAGMENT_BEGIN",this.materialShaderChunks.Fragment_Begin?this.materialShaderChunks.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.materialShaderChunks.Fragment_MainBegin?this.materialShaderChunks.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.materialShaderChunks.Fragment_Custom_Albedo?this.materialShaderChunks.Fragment_Custom_Albedo:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.materialShaderChunks.Fragment_Custom_Alpha?this.materialShaderChunks.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.materialShaderChunks.Fragment_MetallicRoughness?this.materialShaderChunks.Fragment_MetallicRoughness:"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.materialShaderChunks.Fragment_MicroSurface?this.materialShaderChunks.Fragment_MicroSurface:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.materialShaderChunks.Fragment_Before_Lights?this.materialShaderChunks.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog?this.materialShaderChunks.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.materialShaderChunks.Fragment_Before_FragColor?this.materialShaderChunks.Fragment_Before_FragColor:""),this.materialShaderChunks.Fragment_Before_Fog&&(e.Effect.ShadersStore[i]=e.Effect.ShadersStore[i].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog)),r},n.prototype._attachAfterBind=function(e,t){this.updateGlobalTime();var n=this;n.after&&n.after();var r,a=this.getScene();if(a.texturesEnabled)for(r in this._textures){var o=this._textures[r];null!=o&&o.isReady&&o.isReady()&&(null==o.isChecked&&(o.isChecked=!0,("detailsSampler"===r||"normalsSampler"===r||r.indexOf("(Atlas)")>=0)&&o.updateSamplingMode(8)),t.setTexture(r,o),t.setFloat2(r+"Infos",o.coordinatesIndex,o.level),t.setMatrix(r+"Matrix",o.getTextureMatrix()))}for(r in this._vectors4)t.setVector4(r,this._vectors4[r]);for(r in this._floats)t.setFloat(r,this._floats[r])},n}(e.PBRMaterial);e.UniversalAlbedoMaterial=r,e.RegisterClass("BABYLON.UniversalAlbedoMaterial",r);var a=function(t){function n(e,n,r){var a=t.call(this,e,n,null,r)||this;return a._enableTime=!1,a}return __extends(n,t),Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this.setFloat("gameTime",e.SceneManager.GetGameTime()),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene())))},n}(e.ShaderMaterial);e.UniversalShaderMaterial=a,e.RegisterClass("BABYLON.UniversalShaderMaterial",a);var o=function(t){function n(e,n,r){var a=t.call(this,e,n,r)||this;a._textures={},a._vectors4={},a._floats={},a._enableTime=!1,a._timeInitialized=!1;var o=a;return o.awake&&o.awake(),a.onBindObservable.add(function(){a.updateGlobalTime(),o.after&&o.after()}),a}return __extends(n,t),n.prototype.compile=function(){},Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this._timeInitialized===!1?(this._timeInitialized=!0,this.setFloat("gameTime",e.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",e.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},n.prototype.getTexture=function(e){return this._textures[e]},n.prototype.getVector4=function(e){return this._vectors4[e]},n.prototype.getFloat=function(e){return this._floats[e]},n.prototype.setTexture=function(e,t,n){return void 0===n&&(n=!1),this._textures[e]=t,this},n.prototype.setVector4=function(e,t,n){return void 0===n&&(n=!1),this._vectors4[e]=t,this},n.prototype.setFloat=function(e,t,n){return void 0===n&&(n=!1),this._floats[e]=t,this},n.prototype.dispose=function(e,n){if(n)for(var r in this._textures){var a=this._textures[r];a&&a.dispose(),this._textures[r]=null}this._textures={},t.prototype.dispose.call(this,e,n)},n.prototype.clone=function(t){var n,r=this,a=e.SerializationHelper.Clone(function(){return new e.UniversalNodeMaterial(t,r.getScene())},this);a._textures={};for(n in this._textures){var o=this._textures[n];o&&a.setTexture(n,o.clone(),!0)}a._vectors4={};for(n in this._vectors4)a.setVector4(n,this._vectors4[n].clone(),!0);a._floats={};for(n in this._floats)a.setFloat(n,this._floats[n],!0);return a},n.prototype.serialize=function(){var t,n=e.SerializationHelper.Serialize(this);n.customType="BABYLON.UniversalNodeMaterial",n.textures={};for(t in this._textures){var r=this._textures[t];r&&(n.textures[t]=r.serialize())}n.vectors4={};for(t in this._vectors4)n.vectors4[t]=this._vectors4[t].asArray();n.floats={};for(t in this._floats)n.floats[t]=this._floats[t];return n},n.Parse=function(t,n,r){var a,o=e.SerializationHelper.Parse(function(){return new e.UniversalNodeMaterial(t.name,n)},t,n,r);for(a in t.textures){var l=t.textures[a];l&&o.setTexture(a,e.Texture.Parse(l,n,r),!0)}for(a in t.vectors4)o.setVector4(a,e.Vector4.FromArray(t.vectors4[a]),!0);for(a in t.floats)o.setFloat(a,t.floats[a],!0);return o},n}(e.NodeMaterial);e.UniversalNodeMaterial=o,e.RegisterClass("BABYLON.UniversalNodeMaterial",o);var l=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.enableShaderChunks=!0;var a=r;return a.awake&&a.awake(),r.onBindObservable.add(function(){a.after&&a.after()}),r}return __extends(n,t),n.prototype.getShaderName=function(){return"pbr"},n.prototype.getShaderChunk=function(){return null},n.prototype.updateShaderChunks=function(){var t="surfaceAlbedo",n="splatmapSampler",r="detailsSampler",a="normalsSampler",o=e.SceneManager.TerrainColorCorrection;null!=this.materialShaderChunks.Vertex_Definitions&&""!==this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions()+this.materialShaderChunks.Vertex_Definitions:this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions(),null!=this.materialShaderChunks.Vertex_MainEnd&&""!==this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd()+this.materialShaderChunks.Vertex_MainEnd:this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd(),null!=this.materialShaderChunks.Fragment_Definitions&&""!==this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(n,r,a)+this.materialShaderChunks.Fragment_Definitions:this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(n,r,a),null!=this.materialShaderChunks.Fragment_Custom_Albedo&&""!==this.materialShaderChunks.Fragment_Custom_Albedo?this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,t,n,r,a,o)+this.materialShaderChunks.Fragment_Custom_Albedo:this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,t,n,r,a,o)},n.prototype.formatTerrainVertexDefintions=function(){return"\r\n#define TERRAIN_VERTEX_DEFINITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\n\r\n"},n.prototype.formatTerrainVertexMainEnd=function(){return"\r\n#define TERRAIN_VERTEX_MAIN_END\r\n\r\n#ifdef UV1\r\nvSplatmapUV = uv;\r\n#endif\r\n\r\n"},n.prototype.formatTerrainFragmentDefintions=function(e,t,n){return"\r\n#define TERRAIN_FRAGMENT_DEFNITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\nuniform sampler2D "+e+";\r\nuniform sampler2D "+t+";\r\nuniform sampler2D "+n+";\r\n\r\nfloat calculateMipmapLevel(const in vec2 uvs, const in vec2 size)\r\n{\r\n    vec2 dx = dFdx(uvs * size.x);\r\n    vec2 dy = dFdy(uvs * size.y);\r\n    float d = max(dot(dx, dx), dot(dy, dy));\r\n    return 0.4 * log2(d);\r\n}\r\n\r\nvec4 sampleTextureAtlas2D(const in sampler2D atlas, const in float gamma, const in vec2 tile, const in vec4 rect, in vec2 uvs, in float lod)\r\n{\r\n    if (lod < 0.0) lod = clamp(calculateMipmapLevel(uvs, vec2(tile.x, tile.x)), 0.0, tile.y);   // Tile Info (tile.xy)\r\n    float size = pow(2.0, tile.y - lod);                                                        // Tile Bits (tile.y)\r\n    float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n    float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n    uvs = fract(uvs);                                                                           // Perfrom Tiling (fract)\r\n    uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n    uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    vec4 color = texture2DLodEXT(atlas, uvs, lod);\r\n    if (gamma != 1.0) {\r\n        color.r = pow(color.r, gamma);\r\n        color.g = pow(color.g, gamma);\r\n        color.b = pow(color.b, gamma);\r\n    }\r\n    return color;\r\n}\r\n\r\nvec4 sampleSplatmapAtlas2D(const in sampler2D atlas, const in vec2 tile, const in vec4 rect, in vec2 uvs)\r\n{\r\n    float size = pow(2.0, tile.y);                                                              // Tile Bits (tile.y)\r\n\t   float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n\t   float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n\t   uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n\t   uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    return texture2D(atlas, uvs);\r\n}\r\n\r\nvec3 blendSplatmapAtlasColors(const in vec4 splatmap, in vec4 color1, in vec4 color2, in vec4 color3, in vec4 color4, in vec3 mixbuffer)\r\n{\r\n    vec3 buffer1 = mix(mixbuffer, color1.rgb, splatmap.r);\r\n    vec3 buffer2 = mix(buffer1, color2.rgb, splatmap.g);\r\n    vec3 buffer3 = mix(buffer2, color3.rgb, splatmap.b);\r\n    return mix(buffer3, color4.rgb, splatmap.a);\r\n}\r\n\r\nvec3 perturbNormalSamplerColor(mat3 cotangentFrame, vec3 samplerColor, float scale)\r\n{\r\n    vec3 map = samplerColor.xyz;\r\n    map = map * 2.00787402 - 1.00787402;\r\n    #ifdef NORMALXYSCALE\r\n        map = normalize(map * vec3(scale, scale, 1.0));\r\n    #endif\r\n    return normalize(cotangentFrame * map);\r\n}\r\n\r\n\r\n"},n.prototype.formatTerrainFragmentUpdateColor=function(e,t,n,r,a,o){void 0===o&&(o=1);var l="";if(null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0){l="\r\n#define TERRAIN_FRAGMENT_UPDATE_COLOR\r\n\r\nvec3 normalsColor = vec3(0.5, 0.5, 1.0);\r\nvec3 normalsBuffer = normalW.rgb;\r\nvec3 splatmapBuffer = "+t+".rgb;\r\nfloat autoMipMapLevel = -1.0;\r\nfloat normalCorrection = 1.0;\r\nfloat detailCorrection = "+o.toFixed(4)+";\r\n\r\n#if defined(ALBEDO) && defined("+n.toUpperCase()+") && defined("+r.toUpperCase()+")\r\n\r\n// Reset Normal Values\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    uvOffset = vec2(0.0, 0.0);\r\n    #ifdef NORMAL\r\n        normalW = normalize(vNormalW);\r\n    #else\r\n        normalW = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n    #endif\r\n    #ifdef CLEARCOAT\r\n        clearCoatNormalW = normalW;\r\n    #endif\r\n    #if defined(BUMP) || defined(PARALLAX)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV);\r\n        #endif\r\n    #elif defined(ANISOTROPIC)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV, vec2(1.0, 1.0));\r\n        #endif\r\n    #endif\r\n    #ifdef PARALLAX\r\n        invTBN = transposeMat3(TBN);\r\n    #endif\r\n    normalW = perturbNormalSamplerColor(TBN, normalsColor, 1.0);\r\n#endif\r\n\r\n// Global Atlas Values\r\nfloat splatTileSize = "+e.splatmapAtlas[2].toFixed(4)+";\r\nfloat splatTileBits = "+e.splatmapAtlas[3].toFixed(4)+";\r\nfloat detailTileSize = "+e.textureAtlas[2].toFixed(4)+";\r\nfloat detailTileBits = "+e.textureAtlas[3].toFixed(4)+";\r\n\r\n// Sample splatmap textures\r\n";for(var i=0,s=0;s<e.splatmapCount;s++){i=4*s;var u=e["splatmapRect"+s];if(l+="vec4 splatmapRect"+s+" = vec4("+u[0].toFixed(4)+", "+u[1].toFixed(4)+", "+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n",l+="vec4 splatmapAlbedo"+s+" = sampleSplatmapAtlas2D("+n+", vec2(splatTileSize, splatTileBits), splatmapRect"+s+", (vSplatmapUV + uvOffset));\r\n",l+="vec4 textureAlbedo"+(i+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",l+="vec4 textureAlbedo"+(i+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",l+="vec4 textureAlbedo"+(i+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",l+="vec4 textureAlbedo"+(i+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(i+0)]){var d=e["textureRect"+(i+0)],p=e["textureInfo"+(i+0)];l+="vec4 textureRect"+(i+0)+" = vec4("+d[0].toFixed(4)+", "+d[1].toFixed(4)+", "+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",l+="vec2 textureScale"+(i+0)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",l+="vec2 textureOffset"+(i+0)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",l+="vec2 textureTileUV"+(i+0)+" = ((vSplatmapUV + textureOffset"+(i+0)+") * textureScale"+(i+0)+");\r\n",l+="textureAlbedo"+(i+0)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(i+0)+", textureTileUV"+(i+0)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(i+1)]){var d=e["textureRect"+(i+1)],p=e["textureInfo"+(i+1)];l+="vec4 textureRect"+(i+1)+" = vec4("+d[0].toFixed(4)+", "+d[1].toFixed(4)+", "+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",l+="vec2 textureScale"+(i+1)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",l+="vec2 textureOffset"+(i+1)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",l+="vec2 textureTileUV"+(i+1)+" = ((vSplatmapUV + textureOffset"+(i+1)+") * textureScale"+(i+1)+");\r\n",l+="textureAlbedo"+(i+1)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(i+1)+", textureTileUV"+(i+1)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(i+2)]){var d=e["textureRect"+(i+2)],p=e["textureInfo"+(i+2)];l+="vec4 textureRect"+(i+2)+" = vec4("+d[0].toFixed(4)+", "+d[1].toFixed(4)+", "+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",l+="vec2 textureScale"+(i+2)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",l+="vec2 textureOffset"+(i+2)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",l+="vec2 textureTileUV"+(i+2)+" = ((vSplatmapUV + textureOffset"+(i+2)+") * textureScale"+(i+2)+");\r\n",l+="textureAlbedo"+(i+2)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(i+2)+", textureTileUV"+(i+2)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(i+3)]){var d=e["textureRect"+(i+3)],p=e["textureInfo"+(i+3)];l+="vec4 textureRect"+(i+3)+" = vec4("+d[0].toFixed(4)+", "+d[1].toFixed(4)+", "+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",l+="vec2 textureScale"+(i+3)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",l+="vec2 textureOffset"+(i+3)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",l+="vec2 textureTileUV"+(i+3)+" = ((vSplatmapUV + textureOffset"+(i+3)+") * textureScale"+(i+3)+");\r\n",l+="textureAlbedo"+(i+3)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(i+3)+", textureTileUV"+(i+3)+", autoMipMapLevel);\r\n"}if(l+="splatmapBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", textureAlbedo"+(i+0)+", textureAlbedo"+(i+1)+", textureAlbedo"+(i+2)+", textureAlbedo"+(i+3)+", splatmapBuffer);\r\n",l+="#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n",l+="    #if defined("+a.toUpperCase()+")\r\n",l+="        vec4 normalColor"+(i+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",l+="        vec4 normalColor"+(i+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",l+="        vec4 normalColor"+(i+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",l+="        vec4 normalColor"+(i+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(i+0)]){var c=e["normalsScale"+(i+0)];l+="        float normalScale"+(i+0)+" = "+c.toFixed(4)+";\r\n",l+="        normalColor"+(i+0)+" = sampleTextureAtlas2D("+a+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(i+0)+", textureTileUV"+(i+0)+", autoMipMapLevel);\r\n",l+="        normalColor"+(i+0)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(i+0)+".rgb, normalScale"+(i+0)+");\r\n"}if(e["textureRect"+(i+1)]){var c=e["normalsScale"+(i+1)];l+="        float normalScale"+(i+1)+" = "+c.toFixed(4)+";\r\n",l+="        normalColor"+(i+1)+" = sampleTextureAtlas2D("+a+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(i+1)+", textureTileUV"+(i+1)+", autoMipMapLevel);\r\n",l+="        normalColor"+(i+1)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(i+1)+".rgb, normalScale"+(i+1)+");\r\n"}if(e["textureRect"+(i+2)]){var c=e["normalsScale"+(i+2)];l+="        float normalScale"+(i+2)+" = "+c.toFixed(4)+";\r\n",l+="        normalColor"+(i+2)+" = sampleTextureAtlas2D("+a+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(i+2)+", textureTileUV"+(i+2)+", autoMipMapLevel);\r\n",l+="        normalColor"+(i+2)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(i+2)+".rgb, normalScale"+(i+2)+");\r\n"}if(e["textureRect"+(i+3)]){var c=e["normalsScale"+(i+3)];l+="        float normalScale"+(i+3)+" = "+c.toFixed(4)+";\r\n",l+="        normalColor"+(i+3)+" = sampleTextureAtlas2D("+a+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(i+3)+", textureTileUV"+(i+3)+", autoMipMapLevel);\r\n",l+="        normalColor"+(i+3)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(i+3)+".rgb, normalScale"+(i+3)+");\r\n"}l+="        normalsBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", normalColor"+(i+0)+", normalColor"+(i+1)+", normalColor"+(i+2)+", normalColor"+(i+3)+", normalsBuffer);\r\n",l+="    #endif\r\n",l+="#endif\r\n",l+="\r\n"}l+="// Update Color Values\r\n"+t+".rgb = splatmapBuffer.rgb;\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    #if defined("+a.toUpperCase()+")\r\n        normalW.rgb = normalsBuffer.rgb;\r\n    #endif\r\n    #if defined(FORCENORMALFORWARD) && defined(NORMAL)\r\n        vec3 faceNormal = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n        #if defined(TWOSIDEDLIGHTING)\r\n            faceNormal = gl_FrontFacing ? faceNormal : -faceNormal;\r\n        #endif\r\n        normalW *= sign(dot(normalW, faceNormal));\r\n    #endif\r\n    #if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\r\n        normalW = gl_FrontFacing ? normalW : -normalW;\r\n    #endif\r\n#endif\r\n\r\n#endif\r\n\r\n"}return l},n}(e.UniversalAlbedoMaterial);e.UniversalTerrainMaterial=l,e.RegisterClass("BABYLON.UniversalTerrainMaterial",l)}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,n,r){if(void 0===r&&(r={}),this._update=null,this._late=null,this._after=null,this._fixed=null,this._ready=null,this._lateUpdate=!1,this._properties=null,this._awoken=!1,this._started=!1,this._scene=null,this._delyed=!1,this._transform=null,this._scriptReady=!1,this._registeredClassname=null,this._lateUpdateObserver=null,this.resetScriptComponent=null,this.onTriggerEnterObservable=new e.Observable,this.onTriggerStayObservable=new e.Observable,this.onTriggerExitObservable=new e.Observable,this.intersectMesh=null,this.triggerVolumeList=null,this.useTriggerVolumePrecision=!1,this.includeTriggerVolumeDescendants=!1,null==t)throw new Error("Null transform object specified.");if(null==n)throw new Error("Null host scene object specified.");this._scene=n,this._transform=t,this._properties=r||{},this._registeredClassname=null;var a=this;a._update=function(){e.ScriptComponent.UpdateInstance(a)},a._late=function(){e.ScriptComponent.LateInstance(a)},a._after=function(){e.ScriptComponent.AfterInstance(a)},a._fixed=function(){e.ScriptComponent.FixedInstance(a)},a._ready=function(){e.ScriptComponent.ReadyInstance(a)},a.resetScriptComponent=function(){e.ScriptComponent.ResetInstance(a)},a.registerComponentInstance&&a.destroyComponentInstance||e.Tools.Warn("Invalid component registration handlers for: "+this._transform.name)}return t.prototype.isReady=function(){return this._scriptReady},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return this._registeredClassname},t.prototype.setProperty=function(e,t){null==this._properties&&(this._properties={}),this._properties[e]=t},t.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=this._properties&&(n=this._properties[e],null==n&&(n=this._properties["auto__"+e])),null==n&&(n=t),null!=n?n:null},t.prototype.getTime=function(){return e.SceneManager.GetTime()},t.prototype.getTimeMs=function(){return e.SceneManager.GetTimeMs()},t.prototype.getGameTime=function(){return e.SceneManager.GetGameTime()},t.prototype.getGameTimeMs=function(){return e.SceneManager.GetGameTimeMs()},t.prototype.getDeltaSeconds=function(){return e.SceneManager.GetDeltaSeconds(this.scene)},t.prototype.getDeltaMilliseconds=function(){return e.SceneManager.GetDeltaMilliseconds(this.scene)},t.prototype.getAnimationRatio=function(){return e.SceneManager.GetAnimationRatio(this.scene)},t.prototype.hasSkinnedMesh=function(){return null!=this.getSkinnedMesh()},t.prototype.getSkinnedMesh=function(){return e.SceneManager.GetSkinnedMesh(this.transform)},t.prototype.getTransformMesh=function(){return this._transform instanceof e.Mesh?this._transform:null},t.prototype.getAbstractMesh=function(){return this._transform instanceof e.AbstractMesh?this._transform:null},t.prototype.getInstancedMesh=function(){return this._transform instanceof e.InstancedMesh?this._transform:null},t.prototype.getPrimitiveMeshes=function(){return e.SceneManager.GetPrimitiveMeshes(this.transform)},t.prototype.getMetadata=function(){return e.SceneManager.FindSceneMetadata(this._transform)},t.prototype.getComponent=function(t){var n=e.SceneManager.FindScriptComponent(this._transform,t);return null!=n?n:null},t.prototype.getComponents=function(t){var n=e.SceneManager.FindAllScriptComponents(this._transform,t);return null!=n?n:null},t.prototype.getLightRig=function(){return e.SceneManager.FindSceneLightRig(this._transform)},t.prototype.getCameraRig=function(){return e.SceneManager.FindSceneCameraRig(this._transform)},t.prototype.getTransformTag=function(){return e.SceneManager.GetTransformTag(this.transform)},t.prototype.hasTransformTags=function(t){return e.SceneManager.HasTransformTags(this._transform,t)},t.prototype.getChildNode=function(t,n,r,a){return void 0===n&&(n=e.SearchType.ExactMatch),void 0===r&&(r=!0),void 0===a&&(a=null),e.SceneManager.FindChildTransformNode(this._transform,t,n,r,a)},t.prototype.getChildWithTags=function(t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=null),e.SceneManager.FindChildTransformWithTags(this._transform,t,n,r)},t.prototype.getChildrenWithTags=function(t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=null),e.SceneManager.FindAllChildTransformsWithTags(this._transform,t,n,r)},t.prototype.getChildWithScript=function(t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=null),e.SceneManager.FindChildTransformWithScript(this._transform,t,n,r)},t.prototype.getChildrenWithScript=function(t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=null),e.SceneManager.FindAllChildTransformsWithScript(this._transform,t,n,r)},t.prototype.registerOnClickAction=function(t){var n=null;return this.transform instanceof e.AbstractMesh&&(n=e.SceneManager.RegisterClickAction(this.scene,this.transform,t)),n},t.prototype.unregisterOnClickAction=function(t){var n=!1;return this.transform instanceof e.AbstractMesh&&(n=e.SceneManager.UnregisterClickAction(this.transform,t)),n},t.prototype.setTriggerIntersectMesh=function(e){this.intersectMesh=e},t.prototype.getTriggerVolumeList=function(){return this.triggerVolumeList},t.prototype.resetTriggerVolumeList=function(){this.triggerVolumeList=null},t.prototype.registerTriggerVolume=function(t){var n=new e.TriggerVolume;n.mesh=t,n.state=0,null==this.triggerVolumeList&&(this.triggerVolumeList=[]),this.triggerVolumeList.push(n)},t.prototype.unregisterTriggerVolume=function(e){if(null!=this.triggerVolumeList&&this.triggerVolumeList.length>0)for(var t=0;t<this.triggerVolumeList.length;t++){var n=this.triggerVolumeList[t];if(n.mesh===e){this.triggerVolumeList.splice(t);break}n=null}},t.prototype.registerComponentInstance=function(t,n,r){if(void 0===r&&(r=!0),r===!0){e.Utilities.ValidateTransformMetadata(this._transform);var a={alias:"script",order:0,klass:n,properties:null,instance:t};null==this._transform.metadata.unity.components&&(this._transform.metadata.unity.components=[]),this._transform.metadata.unity.components.push(a)}t._registeredClassname=n,e.ScriptComponent.RegisterInstance(t),r===!0&&t.scene.onAfterRenderObservable.addOnce(function(){t.delayComponentInstance(t)})},t.prototype.delayComponentInstance=function(t){e.SceneManager.SetTimeout(100,function(){t._delyed=!0})},t.prototype.destroyComponentInstance=function(t){e.ScriptComponent.DestroyInstance(t)},t.prototype.setupFixedComponentInstance=function(e){var t=this.getAbstractMesh();null!=t&&(null!=t.physicsImpostor?t.physicsImpostor.registerAfterPhysicsStep(e._fixed):null!=t.physicsBody)},t.prototype.removeFixedComponentInstance=function(e){var t=this.getAbstractMesh();
null!=t&&(null!=t.physicsImpostor?t.physicsImpostor.unregisterAfterPhysicsStep(e._fixed):null!=t.physicsBody)},t.RegisterInstance=function(e){null!=e&&(null!=e._update&&e.scene.registerBeforeRender(e._update),e.late&&null!=e._late&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&(e._lateUpdateObserver=e.scene.onBeforeRenderTargetsRenderObservable.add(e._late)),e.after&&null!=e._after&&e.scene.registerAfterRender(e._after),e.fixed&&null!=e._fixed&&e.setupFixedComponentInstance(e))},t.UpdateInstance=function(t){null!=t&&null!=t.transform&&t.transform.isEnabled(!1)&&(t._awoken===!1?(t._awoken=!0,e.ScriptComponent.ParseAutoProperties(t),t.awake&&t.awake()):t._started===!1?(t._started=!0,t.start&&t.start()):t._awoken===!0&&t._started===!0&&(t._delyed===!0&&(t._delyed=!1,e.ScriptComponent.ReadyInstance(t)),t.update&&t.update(),t._lateUpdate=!0))},t.LateInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&e._lateUpdate===!0&&(e._lateUpdate=!1,e._started===!0&&e.late&&e.late())},t.AfterInstance=function(e){if(null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&(e._started===!0&&e.after&&e.after(),null!=e.triggerVolumeList&&e.triggerVolumeList.length>0)){var t=e.intersectMesh||e.getAbstractMesh();null!=t&&e.triggerVolumeList.forEach(function(n){if(null!=n.mesh){var r=t.intersectsMesh(n.mesh,e.useTriggerVolumePrecision,e.includeTriggerVolumeDescendants);r===!0?0===n.state?(n.state=1,e.onTriggerEnterObservable.hasObservers()&&e.onTriggerEnterObservable.notifyObservers(n.mesh)):1===n.state&&e.onTriggerStayObservable.hasObservers()&&e.onTriggerStayObservable.notifyObservers(n.mesh):0!==n.state&&(n.state=0,e.onTriggerExitObservable.hasObservers()&&e.onTriggerExitObservable.notifyObservers(n.mesh))}})}},t.FixedInstance=function(e){null!=e&&null!=e.transform&&e._started===!0&&e.fixed&&e.fixed()},t.ReadyInstance=function(e){null!=e&&null!=e.transform&&e._scriptReady===!1&&(e._scriptReady=!0,e.ready&&e.ready())},t.ResetInstance=function(e){null!=e&&null!=e.transform&&e._started===!0&&e.reset&&e.reset()},t.DestroyInstance=function(e){if(null!=e){e.scene.unregisterBeforeRender(e._update),null!=e._lateUpdateObserver&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&e.scene.onBeforeRenderTargetsRenderObservable.remove(e._lateUpdateObserver),e.after&&null!=e._after&&e.scene.unregisterAfterRender(e._after),e.fixed&&null!=e._fixed&&e.removeFixedComponentInstance(e);try{e.destroy&&e.destroy()}catch(t){}e.onTriggerEnterObservable.clear(),e.onTriggerEnterObservable=null,e.onTriggerStayObservable.clear(),e.onTriggerStayObservable=null,e.onTriggerExitObservable.clear(),e.onTriggerExitObservable=null,e._scriptReady=!1,e._transform=null,e._properties=null,e._started=!1,e._delyed=!1,e._update=null,e._late=null,e._after=null,e._ready=null,e._scene=null}},t.ParseAutoProperties=function(t){var n=Object.keys(t._properties);if(null!=n&&n.length>0)for(var r=function(r){var a=n[r];if(e.Utilities.StartsWith(a,"auto__")){var o=a.replace("auto__","");if(e.Utilities.HasOwnProperty(t,o)){var l=t.getProperty(a);if(null!=l){var i=typeof l;if(null!=i&&""!==i)if("object"===i)if(Array.isArray(l)){var s=[],u=l;u.forEach(function(n){if(null!=n){var r=typeof n;"object"===r?s.push(e.ScriptComponent.UnpackObjectProperty(n,t.scene)):s.push(n)}}),t[o]=s}else{var d=t[o],p=e.ScriptComponent.UnpackObjectProperty(l,t.scene);d instanceof e.Color3&&p instanceof e.Color4?t[o]=new e.Color3(p.r,p.g,p.b):t[o]=p}else t[o]=l;else t[o]=l}else t[o]=l}else e.Tools.Warn(t.getClassName()||"Unregistered Class: Auto property '"+o+"' not found for transform '"+t.transform.name+"'")}},a=0;a<n.length;a++)r(a)},t.UnpackObjectProperty=function(t,n){var r=null;if(null!=t)if(void 0!==t.x&&void 0!==t.y)r=void 0!==t.z?void 0!==t.w?new e.Vector4(t.x,t.y,t.z,t.w):new e.Vector3(t.x,t.y,t.z):new e.Vector2(t.x,t.y);else if(void 0!==t.r&&void 0!==t.g&&void 0!==t.b){var a=1;void 0!==t.a&&(a=t.a),r=new e.Color4(t.r,t.g,t.b,a)}else if(void 0!==t.type)switch(t.type){case"UnityEngine.AnimationCurve":var o=t;r=e.Animation.Parse(o.animation);break;case"UnityEngine.Transform":var l=t;r=e.Utilities.ParseTransformByID(l,n);break;case"UnityEngine.Material":var i=t;r=n.getMaterialByName(i.name);break;case"UnityEngine.Texture2D":var s=t;r=e.Utilities.ParseTexture(s,n);break;case"UnityEngine.Cubemap":var u=t;r=e.Utilities.ParseCubemap(u,n);break;case"UnityEngine.AudioClip":var d=t;r=d;break;case"UnityEngine.Video.VideoClip":var p=t;r=p;break;case"UnityEngine.Font":var c=t;r=c;break;case"UnityEngine.TextAsset":var m=t;r=null!=m.base64?m.json===!0?JSON.parse(window.atob(m.base64)):window.atob(m.base64):m;break;case"UnityEditor.DefaultAsset":var f=t;r=null!=f.base64?f.json===!0?JSON.parse(window.atob(f.base64)):window.atob(f.base64):f;break;default:r=t}else r=t;return r},t}();e.ScriptComponent=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._babylonScene=e,this._physicList=[],this._shadowList=[],this._scriptList=[],this._freezeList=[]}return t.prototype.parseSceneComponents=function(t){e.MetadataParser.DoParseSceneComponents(this._babylonScene,t,this._physicList,this._shadowList,this._scriptList,this._freezeList)},t.prototype.postProcessSceneComponents=function(t,n){e.MetadataParser.DoProcessPendingPhysics(this._babylonScene,this._physicList),e.MetadataParser.DoProcessPendingShadows(this._babylonScene,this._shadowList),e.MetadataParser.DoProcessPendingScripts(this._babylonScene,this._scriptList,t,n),e.MetadataParser.DoProcessPendingFreezes(this._freezeList),this._babylonScene=null,this._physicList=null,this._shadowList=null,this._scriptList=null,this._freezeList=null},t.DoParseSceneComponents=function(t,n,r,a,o,l){if(null!=n&&null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.parsed&&n.metadata.unity.parsed===!1){n.onDisposeObservable.addOnce(function(){e.Utilities.DisposeEntity(n)}),n.metadata.unity.parsed=!0,n.metadata.unity.prefab=!1;var i=n.metadata.unity,s=null==n.metadata.unity.visible||n.metadata.unity.visible,u=null!=n.metadata.unity.visibility?n.metadata.unity.visibility:1,d=null!=n.metadata.unity.billboard?n.metadata.unity.billboard:0,p=n instanceof e.AbstractMesh,c=(null!=n.metadata.unity.lightmapped&&n.metadata.unity.lightmapped,i.tags);if(null!=c&&""!==c&&(e.Tags.AddTagsTo(n,c),c.indexOf("NavigationMesh")>=0&&(n.isVisible=!1,n.isPickable=!1,n.useVertexColors=!1)),null!=i.physics&&null!=r&&r.push(n),n.renderingGroupId,null!=i.renderer)if(p===!0)n.isPickable=!0,n.useVertexColors=!1,n.isVisible=s,n.visibility=u,n.billboardMode=d,n.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=i.renderer.cullingstrategy&&i.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(n.cullingStrategy=i.renderer.cullingstrategy),null!=i.renderer.layermask&&(n.layerMask=i.renderer.layermask),null!=i.renderer.castshadows&&i.renderer.castshadows===!0&&null!=a&&a.push(n),null!=i.renderer.receiveshadows&&i.renderer.receiveshadows===!0&&(n.receiveShadows=!0),null!=i.renderer.checkcollisions&&i.renderer.checkcollisions===!0&&(n.checkCollisions=!0),null!=i.renderer.istriggervolume&&i.renderer.istriggervolume===!0&&(n.collisionResponse=!1),null!=i.renderer.usevertexcolors&&(n.useVertexColors=i.renderer.usevertexcolors),null!=i.renderer.setmeshpickable&&(n.isPickable=i.renderer.setmeshpickable),null!=i.renderer.showboundingbox&&(n.showBoundingBox=i.renderer.showboundingbox),null!=i.renderer.defaultellipsoid&&(n.ellipsoid=e.Utilities.ParseVector3(i.renderer.defaultellipsoid)),null!=i.renderer.ellipsoidoffset&&(n.ellipsoidOffset=e.Utilities.ParseVector3(i.renderer.ellipsoidoffset)),null!=i.renderer.rendergroupid&&(n.renderingGroupId=i.renderer.rendergroupid),null!=i.renderer.freezeworldmatrix&&i.renderer.freezeworldmatrix===!0&&null!=l&&l.push(n);else{var m=e.SceneManager.GetSkinnedMesh(n);if(null!=m)m.isPickable=!0,m.useVertexColors=!1,m.isVisible=s,m.visibility=u,m.billboardMode=d,m.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,m.alwaysSelectAsActiveMesh=!0,null!=i.renderer.cullingstrategy&&i.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(m.cullingStrategy=i.renderer.cullingstrategy),null!=i.renderer.layermask&&(m.layerMask=i.renderer.layermask),null!=i.renderer.castshadows&&i.renderer.castshadows===!0&&null!=a&&a.push(m),null!=i.renderer.receiveshadows&&i.renderer.receiveshadows===!0&&(m.receiveShadows=!0),null!=i.renderer.checkcollisions&&i.renderer.checkcollisions===!0&&(m.checkCollisions=!0),null!=i.renderer.istriggervolume&&i.renderer.istriggervolume===!0&&(m.collisionResponse=!1),null!=i.renderer.usevertexcolors&&(m.useVertexColors=i.renderer.usevertexcolors),null!=i.renderer.setmeshpickable&&(m.isPickable=i.renderer.setmeshpickable),null!=i.renderer.showboundingbox&&(m.showBoundingBox=i.renderer.showboundingbox),null!=i.renderer.defaultellipsoid&&(m.ellipsoid=e.Utilities.ParseVector3(i.renderer.defaultellipsoid)),null!=i.renderer.ellipsoidoffset&&(m.ellipsoidOffset=e.Utilities.ParseVector3(i.renderer.ellipsoidoffset)),null!=i.renderer.rendergroupid&&(m.renderingGroupId=i.renderer.rendergroupid),null!=i.renderer.freezeworldmatrix&&i.renderer.freezeworldmatrix===!0&&null!=l&&l.push(m);else{var f=e.SceneManager.GetPrimitiveMeshes(n);null!=f&&f.length>0&&f.forEach(function(t){var n=e.SceneManager.GetSkinnedMesh(t);null!=n?(n.isPickable=!0,n.useVertexColors=!1,n.isVisible=s,n.visibility=u,n.billboardMode=d,n.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,n.alwaysSelectAsActiveMesh=!0,null!=i.renderer.cullingstrategy&&i.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(n.cullingStrategy=i.renderer.cullingstrategy),null!=i.renderer.layermask&&(n.layerMask=i.renderer.layermask),null!=i.renderer.castshadows&&i.renderer.castshadows===!0&&null!=a&&a.push(n),null!=i.renderer.receiveshadows&&i.renderer.receiveshadows===!0&&(n.receiveShadows=!0),null!=i.renderer.checkcollisions&&i.renderer.checkcollisions===!0&&(n.checkCollisions=!0),null!=i.renderer.istriggervolume&&i.renderer.istriggervolume===!0&&(n.collisionResponse=!1),null!=i.renderer.usevertexcolors&&(n.useVertexColors=i.renderer.usevertexcolors),null!=i.renderer.setmeshpickable&&(n.isPickable=i.renderer.setmeshpickable),null!=i.renderer.showboundingbox&&(n.showBoundingBox=i.renderer.showboundingbox),null!=i.renderer.defaultellipsoid&&(n.ellipsoid=e.Utilities.ParseVector3(i.renderer.defaultellipsoid)),null!=i.renderer.ellipsoidoffset&&(n.ellipsoidOffset=e.Utilities.ParseVector3(i.renderer.ellipsoidoffset)),null!=i.renderer.rendergroupid&&(n.renderingGroupId=i.renderer.rendergroupid),null!=i.renderer.freezeworldmatrix&&i.renderer.freezeworldmatrix===!0&&null!=l&&l.push(n)):(t.isPickable=!0,t.useVertexColors=!1,t.isVisible=s,t.visibility=u,t.billboardMode=d,t.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=i.renderer.cullingstrategy&&i.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(t.cullingStrategy=i.renderer.cullingstrategy),null!=i.renderer.layermask&&(t.layerMask=i.renderer.layermask),null!=i.renderer.castshadows&&i.renderer.castshadows===!0&&null!=a&&a.push(t),null!=i.renderer.receiveshadows&&i.renderer.receiveshadows===!0&&(t.receiveShadows=!0),null!=i.renderer.checkcollisions&&i.renderer.checkcollisions===!0&&(t.checkCollisions=!0),null!=i.renderer.istriggervolume&&i.renderer.istriggervolume===!0&&(t.collisionResponse=!1),null!=i.renderer.usevertexcolors&&(t.useVertexColors=i.renderer.usevertexcolors),null!=i.renderer.setmeshpickable&&(t.isPickable=i.renderer.setmeshpickable),null!=i.renderer.showboundingbox&&(t.showBoundingBox=i.renderer.showboundingbox),null!=i.renderer.defaultellipsoid&&(t.ellipsoid=e.Utilities.ParseVector3(i.renderer.defaultellipsoid)),null!=i.renderer.ellipsoidoffset&&(t.ellipsoidOffset=e.Utilities.ParseVector3(i.renderer.ellipsoidoffset)),null!=i.renderer.rendergroupid&&(t.renderingGroupId=i.renderer.rendergroupid),null!=i.renderer.freezeworldmatrix&&i.renderer.freezeworldmatrix===!0&&null!=l&&l.push(t))})}}if(null!=i.components){var h=i.components;null!=h&&h.length>0&&h.forEach(function(r){if(null!=r)switch(r.alias){case"camera":e.MetadataParser.SetupCameraComponent(t,n,r);break;case"light":e.MetadataParser.SetupLightComponent(t,n,r);break;case"script":null!=o&&o.push({mesh:n,comp:r})}})}}},t.DoProcessPendingScripts=function(t,n,r,a){null!=n&&n.length>0&&(n.sort(function(e,t){return e.comp.order<t.comp.order?-1:e.comp.order>t.comp.order?1:0}),n.forEach(function(n){if(null!=n.comp.klass&&""!==n.comp.klass&&"BABYLON.ScriptComponent"!==n.comp.klass){var o=e.Utilities.InstantiateClass(n.comp.klass);if(null!=o){var l=new o(n.mesh,t,n.comp.properties);if(null!=l){var i=l instanceof e.ScriptComponent;i===!0?(n.comp.instance=l,null!=a&&a.push(n.comp.instance),n.comp.instance.addPreloaderTasks&&null!=r&&r.push(n.comp.instance),e.SceneManager.RegisterScriptComponent(n.comp.instance,n.comp.klass,!1)):e.Tools.Warn("Non script component instantiated class: "+n.comp.klass)}else e.Tools.Warn("Failed to instantiate script class: "+n.comp.klass)}else e.Tools.Warn("Failed to locate script class: "+n.comp.klass)}}))},t.DoProcessPendingShadows=function(e,t){null!=t&&t.length>0&&null!=e.lights&&e.lights.length>0&&e.lights.forEach(function(e){var n=e.getShadowGenerator();if(null!=n&&null!=e.metadata&&null!=e.metadata.unity&&e.metadata.unity.autorender===!0){var r=n.getShadowMap();null!=r&&t.forEach(function(t){var n=!1;n=!(null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0)||e.includedOnlyMeshes.indexOf(t)>=0,n===!0&&(null==r.renderList&&(r.renderList=[]),r.renderList.indexOf(t)<0&&r.renderList.push(t))})}})},t.DoProcessPendingPhysics=function(t,n){if(null!=n&&n.length>0){var r=t.isPhysicsEnabled(),a=r===!0?t.getPhysicsEngine():null,o=r===!0&&null!=a;o===!0?n.forEach(function(n){e.RigidbodyPhysics?e.RigidbodyPhysics.SetupPhysicsComponent(t,n):e.Tools.Warn("Rigidbody physics system not loaded. Physics impostors will not be created for: "+n.name)}):e.Tools.Warn("Physics engine not loaded. Physics impostors will not be created.")}},t.DoProcessPendingFreezes=function(e){null!=e&&e.length>0&&e.forEach(function(e){e.freezeWorldMatrix()})},t.SetupCameraComponent=function(t,n,r){n.checkCollisions=!1;var a=0,o=n.name+".Rig",l=0,i=null!=r.culling?r.culling:-1,s=null!=r.camerabase?r.camerabase:0,u=(null!=r.clearflags?r.clearflags:0,null!=r.renderlist?r.renderlist:null),d=null!=r.maincamera&&r.maincamera,p=4===s?new e.FreeCamera(o,e.Vector3.Zero(),t):new e.UniversalCamera(o,e.Vector3.Zero(),t);p.checkCollisions=!1,p.rotationQuaternion=e.Quaternion.FromEulerAngles(0,l,0),p.parent=n,d===!0&&(t.activeCamera=p);var c=null!=r.type?r.type:0;switch(c){case 0:p.mode=e.Camera.PERSPECTIVE_CAMERA,null!=r.perspectiveyfov&&(p.fov=r.perspectiveyfov),null!=r.perspectiveznear&&(p.minZ=r.perspectiveznear),null!=r.perspectivezfar&&(p.maxZ=r.perspectivezfar);break;case 1:p.mode=e.Camera.ORTHOGRAPHIC_CAMERA,null!=r.orthoxmag&&(p.orthoLeft=-r.orthoxmag,p.orthoRight=r.orthoxmag),null!=r.orthoymag&&(p.orthoBottom=-r.orthoymag,p.orthoTop=r.orthoymag),null!=r.orthoznear&&(p.minZ=r.orthoznear),null!=r.orthozfar&&(p.maxZ=r.orthozfar)}if(i===-1);else if(0===i);else{var m=u;if(null!=m&&m.length>0){var f=function(){var n=m[a],r=e.SceneManager.GetMeshByID(t,n);if(null!=r){var o=r.name+".Detail",l=r.getChildren(function(e){return e.name===o},!0);null!=l&&l.length>0}};for(a=0;a<m.length;a++)f()}}n.cameraRig=p},t.SetupLightComponent=function(t,n,r){n.checkCollisions=!1;var a,o=n.name+".Rig",l=0,i=1,s=null!=r.culling?r.culling:-1,u=(null!=r.clearflags?r.clearflags:0,null!=r.renderlist?r.renderlist:null),d=null!=r.type?r.type:0,p=e.SceneManager.GetRenderQuality(),c=null!=r.exponentdecayspeed?r.exponentdecayspeed:1,m=!1;switch(d){case 0:var f=e.Vector3.Forward(),h=null!=r.orthoscale?r.orthoscale:.1,g=null!=r.ortholeft?r.ortholeft:Number.MAX_VALUE,v=null!=r.orthoright?r.orthoright:Number.MAX_VALUE,y=null!=r.orthotop?r.orthotop:Number.MAX_VALUE,C=null!=r.orthobottom?r.orthobottom:Number.MAX_VALUE,b=null!=r.calczbounds&&r.calczbounds,I=null!=r.updateextends&&r.updateextends,S=null!=r.shadowfrustumsize?r.shadowfrustumsize:0,_=new e.DirectionalLight(o,f,t);_.shadowFrustumSize=S,_.shadowOrthoScale=h,_.autoCalcShadowZBounds=b,_.autoUpdateExtends=I,_.orthoLeft=g,_.orthoRight=v,_.orthoTop=y,_.orthoBottom=C,a=_,a.falloffType=e.Light.FALLOFF_STANDARD,m=p===e.RenderQuality.High||p===e.RenderQuality.Medium,i=e.SceneManager.DirectionalLightIntensity;break;case 1:var M=a=new e.PointLight(o,e.Vector3.Zero(),t);a=M,a.falloffType=e.Light.FALLOFF_STANDARD,m=p===e.RenderQuality.High||p===e.RenderQuality.Medium,i=e.SceneManager.PointLightIntensity;break;case 2:var f=e.Vector3.Forward(),T=null!=r.spotangle?r.spotangle:Math.PI/4,x=new e.SpotLight(o,e.Vector3.Zero(),f,0,c,t);x.angle=.966*e.Tools.ToRadians(T),x.innerAngle=.8*x.angle,a=x,a.falloffType=e.Light.FALLOFF_GLTF,m=p===e.RenderQuality.High||p===e.RenderQuality.Medium,i=e.SceneManager.SpotLightIntensity}if(null!=a){var A=null!=r.range?r.range:Number.MAX_VALUE,O=null!=r.color?e.Utilities.ParseColor3(r.color,e.Color3.White()):e.Color3.White(),w=null!=r.specular?e.Utilities.ParseColor3(r.specular,e.Color3.White()):e.Color3.White();a.parent=n,a.range=A,a.diffuse=O,a.specular=w,a.intensity=(null!=r.intensity?r.intensity:1)*i,a.lightmapMode=e.Light.LIGHTMAP_DEFAULT,a.intensityMode=e.Light.INTENSITYMODE_AUTOMATIC,a.shadowEnabled=!1;var B=null==r.autorender||r.autorender,L=null!=r.softshadows&&r.softshadows,P=null!=r.numcascades?r.numcascades:0,N=null!=r.cascadelambda?r.cascadelambda:1,k=null!=r.setdepthclamp&&r.setdepthclamp,U=null!=r.blendpertecntage?r.blendpertecntage:1e-8,D=null!=r.boundsrefreshrate?r.boundsrefreshrate:1,R=null!=r.lightcontactratio?r.lightcontactratio:.1,E=null!=r.stabilizecascades&&r.stabilizecascades,F=null!=r.penumbradarkness?r.penumbradarkness:1,G=null!=r.softshadowsfilter?r.softshadowsfilter:99,V=null!=r.freezeshadows&&r.freezeshadows,H=null!=r.calcdepths&&r.calcdepths,Y=null!=r.depthscaling?r.depthscaling:50,z=null!=r.blurscaling?r.blurscaling:2,W=null==r.kernelblur||r.kernelblur,X=null!=r.blurkernelsize?r.blurkernelsize:1,Q=null!=r.blurboxoffset?r.blurboxoffset:1,j=null!=r.shadowmapsize?r.shadowmapsize:1024,K=null!=r.generateshadows&&r.generateshadows,Z=null!=r.shadowbiasfactor?r.shadowbiasfactor:.001,q=null!=r.normalbiasfactor?r.normalbiasfactor:.01,J=null!=r.shadowmapbias?r.shadowmapbias:.05,$=null!=r.normalmapbias?r.normalmapbias:.4,ee=null!=r.shadowstrength?r.shadowstrength:1,te=null!=r.shadowdistance?r.shadowdistance:150,ne=null!=r.shadownearplane?r.shadownearplane:.2,re=null!=r.shadowfilterquality?r.shadowfilterquality:"Medium",ae=null!=r.transparencyshadow&&r.transparencyshadow,oe=null!=r.softtransparency&&r.softtransparency,le=null==r.forcebackfacesonly||r.forcebackfacesonly,ie=null!=r.frustumedgefalloff?r.frustumedgefalloff:0,se=null!=r.usefullfloatfirst&&r.usefullfloatfirst;if(m===!0&&K===!0){var ue=a,de=e.SceneManager.GetWebGLVersionNumber(t),pe=0===d&&P>=2&&de>=2,ce=pe===!0?new e.CascadedShadowGenerator(j,a,se):new e.ShadowGenerator(j,ue,se);if(ce.bias=J*Z,ce.normalBias=$*q,ce.depthScale=Y,ce.useKernelBlur=W,ce.blurKernel=X,ce.blurScale=z,ce.blurBoxOffset=Q,ce.frustumEdgeFalloff=ie,ce.forceBackFacesOnly=le,ce.transparencyShadow=ae,ce.enableSoftTransparentShadow=oe,ce.contactHardeningLightSizeUVRatio=R,L===!0)if(de<=1)ce.usePoissonSampling=!0;else if(pe===!0)ce.usePercentageCloserFiltering=!0;else switch(G){case 0:ce.usePoissonSampling=!0;break;case 1:ce.useExponentialShadowMap=!0;break;case 2:ce.useBlurExponentialShadowMap=!0;break;case 3:ce.useCloseExponentialShadowMap=!0;break;case 4:ce.useBlurCloseExponentialShadowMap=!0;break;case 5:ce.useContactHardeningShadow=!0;break;case 99:ce.usePercentageCloserFiltering=!0;break;default:ce.usePoissonSampling=!0}switch(re){case"High":ce.filteringQuality=e.ShadowGenerator.QUALITY_HIGH;break;case"Medium":ce.filteringQuality=e.ShadowGenerator.QUALITY_MEDIUM;break;case"Low":ce.filteringQuality=e.ShadowGenerator.QUALITY_LOW}if(pe===!0){var me=ce;me.lambda=N,me.depthClamp=k,me.shadowMaxZ=te,me.numCascades=P,me.penumbraDarkness=F,me.autoCalcDepthBounds=H,me.stabilizeCascades=E,me.cascadeBlendPercentage=U,me.autoCalcDepthBoundsRefreshRate=D,me.freezeShadowCastersBoundingInfo=V,me.setDarkness(1-e.Scalar.Clamp(ee)),ue.shadowEnabled=!0,me.splitFrustum()}else{var fe=ce;fe.setDarkness(1-e.Scalar.Clamp(ee)),ue.shadowEnabled=!0,ue.shadowMinZ=ne,ue.shadowMaxZ=te}null==a.metadata&&(a.metadata={}),null==a.metadata.unity&&(a.metadata.unity={}),a.metadata.unity.autorender=B}var he=n.name+".Holder";if(s===-1)a.includedOnlyMeshes=[];else if(0===s)a.includedOnlyMeshes=[new e.Mesh(he,t)];else{a.includedOnlyMeshes=[new e.Mesh(he,t)];var ge=u;if(null!=ge&&ge.length>0){var ve=function(){var n=ge[l],r=e.SceneManager.GetMeshByID(t,n);if(null!=r){var o=r.name+".Detail",i=r.getChildren(function(e){return e.name===o},!0);null!=i&&i.length>0?a.includedOnlyMeshes.push(i[0]):a.includedOnlyMeshes.push(r)}};for(l=0;l<ge.length;l++)ve()}}n.lightRig=a}},t}();e.MetadataParser=t}(BABYLON||(BABYLON={}));var CVTOOLS_NAME="CVTOOLS_unity_metadata",CVTOOLS_MESH="CVTOOLS_babylon_mesh",CVTOOLS_HAND="CVTOOLS_left_handed",CubeTextureLoader=function(){function e(){}return e}(),CVTOOLS_unity_metadata=function(){function e(e){this.name=CVTOOLS_NAME,this.enabled=!1,this._babylonScene=null,this._loaderScene=null,this._assetsManager=null,this._materialMap=null,this._lightmapMap=null,this._reflectionMap=null,this._reflectionCache=null,this._assetContainer=!1,this._activeMeshes=!1,this._parseScene=!1,this._leftHanded=!1,this._disposeRoot=!1,this._sceneParsed=!1,this._preWarmTime=1,this._hideLoader=!1,this._fileName="Unknown",this._rootUrl=null,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND),this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._rootUrl=null,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._readyList=null,this._preloadList=null,this._materialMap=null,this._lightmapMap=null,this._preWarmTime=1,this._hideLoader=!1,this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._animationGroups=null,this._babylonScene=null,this.order=100}return e.prototype.dispose=function(){delete this._loader},e.prototype.onLoading=function(){var e=this;BABYLON.Utilities.LoadingState=0,this._assetContainer=null!=this._loader._assetContainer,this._babylonScene=this._loader.babylonScene,this._loaderScene=null,this._assetsManager=null,this._rootUrl=this._loader._uniqueRootUrl?this._loader._uniqueRootUrl:"/",this._fileName=this._loader._fileName?this._loader._fileName:"Unknown",this._fileName.indexOf("?")>=0&&(this._fileName=this._fileName.split("?")[0]),this._loader.parent.onCompleteObservable.addOnce(function(){e.onComplete()}),this._loader.parent.onValidatedObservable.addOnce(function(){e.onValidate()}),this._parseScene=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND)&&BABYLON.SceneManager.IsSceneParsingEnabled()===!0,this._leftHanded=this._loader.isExtensionUsed(CVTOOLS_HAND),this._disposeRoot=this._sceneParsed=!1,this._animationGroups=[],this._masterList=[],this._detailList=[],this._parserList=[],this._shaderList=[],this._readyList=[],this._preloadList=[],this._materialMap=new Map,this._lightmapMap=new Map,this._preWarmTime=1,this._hideLoader=!1,this._reflectionMap={},this._reflectionCache={},this._babylonScene.getEngine().getCaps().supportSRGBBuffers=BABYLON.SceneManager.SupportSRGBBuffers,this._leftHanded===!0&&null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.rotationQuaternion=BABYLON.Quaternion.Identity(),this._loader.rootBabylonMesh.scaling=BABYLON.Vector3.One()),this._parseScene===!0&&(BABYLON.SceneManager.RenderLoopReady=!1,null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.name="Root."+this._fileName.replace(".gltf","").replace(".glb","")),this.setupLoader())},e.prototype.onReady=function(){this._parseScene===!0&&this._disposeRoot===!0&&null!=this._loader.rootBabylonMesh&&this._loader.rootBabylonMesh.dispose(!0)},e.prototype.onComplete=function(){var e=this;this._parseScene===!0&&(this.startParsing(),BABYLON.SceneManager.RenderLoopReady=!0,this._babylonScene.onAfterRenderObservable.addOnce(function(){BABYLON.Utilities.LoadingState=3,e._processPreloadTimeout()}))},e.prototype.onValidate=function(){this._parseScene===!0},e.prototype.onCleanup=function(){this._rootUrl=null,this._fileName=null,this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._preWarmTime=1,this._readyList=null,this._preloadList=null,this._hideLoader=!1,this._animationGroups=null,null!=this._materialMap&&(this._materialMap.clear(),this._materialMap=null),null!=this._lightmapMap&&(this._lightmapMap.clear(),this._lightmapMap=null),this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._babylonScene=null},e.prototype.setupLoader=function(){var e=this;this._parseScene===!0&&(this._assetsManager=new BABYLON.PreloadAssetsManager(this._babylonScene),this._assetsManager.onProgress=function(e,t,n){if(BABYLON.SceneManager.AutoUpdateProgress===!0){var r=1===t?" ASSET":" ASSETS",a="LOADING "+(t-e)+" OF "+t+r;BABYLON.SceneManager.UpdateLoaderDetails(a,BABYLON.Utilities.LoadingState)}else null!=BABYLON.Utilities.OnPreloaderProgress&&BABYLON.Utilities.OnPreloaderProgress(e,t,n)},this._assetsManager.onFinish=function(t){BABYLON.SceneManager.SetTimeout(1e3,function(){BABYLON.Utilities.LoadingState=4,BABYLON.SceneManager.AutoUpdateProgress===!0&&BABYLON.SceneManager.UpdateLoaderStatus("PLEASE WAIT","PREPARING VIEWPORT",BABYLON.Utilities.LoadingState);var n=e._preWarmTime>0?1e3*(e._preWarmTime+1):1e3;BABYLON.SceneManager.SetTimeout(n,function(){if(null!=BABYLON.Utilities.OnPreloaderComplete&&BABYLON.Utilities.OnPreloaderComplete(t),e._processShaderMaterials(e._babylonScene,e._shaderList),null!=e._readyList&&e._readyList.length>0)for(var n=0;n<e._readyList.length;n++){var r=e._readyList[n];null!=r&&r._ready&&r._ready()}e._babylonScene.onAfterRenderObservable.addOnce(function(){1==e._hideLoader&&BABYLON.SceneManager.HideSceneLoader(),e.onCleanup()})})})})},e.prototype.startParsing=function(){this._parseScene===!0&&(BABYLON.Utilities.LoadingState=2,this._processLevelOfDetail(this._babylonScene,this._detailList),this._processActiveMeshes(this._babylonScene,this._activeMeshes),this._processUnityMeshes(this._masterList),null!=this._loaderScene&&(this.preProcessSceneProperties(this._loaderScene,this._babylonScene),this.postProcessSceneProperties(this._rootUrl,this._loaderScene,this._babylonScene)),this._assetContainer===!1&&null!=this._parserList&&this._parserList.length>0&&BABYLON.Utilities.PostParseSceneComponents(this._babylonScene,this._parserList,this._preloadList,this._readyList))},e.prototype.loadSceneAsync=function(e,t){if(this._parseScene===!0&&(this._loaderScene=t),this._parseScene===!0&&null!=t.extras&&null!=t.extras.metadata){if(null!=t.extras.metadata.rawmaterials){var n=this._loader,r=t.extras.metadata.rawmaterials;this._preloadRawMaterialsAsync(e,n._gltf.materials,r)}BABYLON.Utilities.LoadingState=1;var a=this._loader.loadSceneAsync(e,t);return this.loadSceneExAsync(e,t),a}return BABYLON.Utilities.LoadingState=1,null},e.prototype.loadSceneExAsync=function(e,t){var n=this,r=this._loader,a=new Array;if(r._gltf.nodes)for(var o=0,l=r._gltf.nodes;o<l.length;o++){var i=l[o];if(i._babylonTransformNode&&i._babylonBones)for(var s=0,u=i._babylonBones;s<u.length;s++){var d=u[s];i._babylonTransformNode._linkedBone=d}i._babylonTransformNode&&this._animationGroups&&BABYLON.Utilities.AssignAnimationGroupsToNode(i._babylonTransformNode,this._animationGroups)}if(null!=this._reflectionMap&&null!=this._reflectionCache){var p=0,c=function(e){if(p++,m._reflectionMap.hasOwnProperty(e)){var t=e;if(null!=m._assetsManager){var r=m._assetsManager.addBinaryFileTask("Material.ReflectionTextureTask"+p.toFixed(0),t);r.onSuccess=function(e){if(null!=e.data){var r=new Blob([e.data]),a=n._reflectionMap[t];null!=a&&a.forEach(function(e){if(null!=e&&null!=e.mapkey){var t=n._reflectionCache[e.mapkey];if(null!=t)null!=e.material&&BABYLON.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=t);else{var a=n._babylonScene,o=URL.createObjectURL(r),l=function(){URL.revokeObjectURL(o)},i=new BABYLON.CubeTexture(o,a,null,null,null,l,l,null,e.prefiltered,e.extension);i.name=e.name,null!=e.boundingBoxSize&&(i.boundingBoxSize=e.boundingBoxSize),null!=e.boundingBoxPosition&&(i.boundingBoxPosition=e.boundingBoxPosition),n._reflectionCache[e.mapkey]=i,null!=e.material&&BABYLON.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=i)}}})}else console.error("Failed to load reflection texture task: "+t)},r.onError=function(e,t,n){console.error(t,n)}}}},m=this;for(var f in this._reflectionMap)c(f)}return r.logClose(),Promise.all(a).then(function(){})},e.prototype._processActiveMeshes=function(e,t){t===!0&&e.freeActiveMeshes()},e.prototype._processUnityMeshes=function(e){null!=e&&e.length>0&&e.forEach(function(e){BABYLON.Utilities.RegisterInstancedMeshBuffers(e)})},e.prototype._processPreloadTimeout=function(){if(null!=this._assetsManager){if(null!=this._preloadList&&this._preloadList.length>0)for(var e=0;e<this._preloadList.length;e++){var t=this._preloadList[e];null!=t&&t.addPreloaderTasks&&t.addPreloaderTasks(this._assetsManager)}this._babylonScene._preloaded=!0,this._assetsManager.load()}},e.prototype.loadNodeAsync=function(e,t,n){var r=this;return this._parseScene===!0&&null!=t.extras&&null!=t.extras.metadata?this._loader.loadNodeAsync(e,t,function(e){var a=e,o=t.extras.metadata;null==a.metadata&&(a.metadata={}),a.metadata.unity=o,BABYLON.Utilities.ValidateTransformGuid(a),BABYLON.Utilities.ValidateTransformMetadata(a),BABYLON.Utilities.ValidateTransformQuaternion(a),a.isVisible=null==a.metadata.unity.visible||a.metadata.unity.visible,a.visibility=null!=a.metadata.unity.visibility?a.metadata.unity.visibility:1,a.billboardMode=null!=a.metadata.unity.billboard?a.metadata.unity.billboard:0,r._assetContainer===!0&&(a.metadata.unity.prefab=!0),a.metadata.unity.prefab===!0?a.setEnabled(!1):(r._parserList.push(a),null!=t.extras.metadata.lods&&null!=t.extras.metadata.distances&&null!=r._detailList&&r._detailList.push(a)),r._masterList.push(a),n(a)}):null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){if(this._parseScene===!0){var r=-1;t.index&&(r=t.index,r>=0&&null!=this._materialMap&&(this._materialMap.has(r)||this._materialMap.set(r,n))),n.gltfIndex=r;var a=this._loader,o=new Array;if(n instanceof BABYLON.NodeMaterial)o.push(this._parseNodeMaterialPropertiesAsync("".concat(e,"/nodeMaterial"),t,n));else if(n instanceof BABYLON.ShaderMaterial)o.push(this._parseShaderMaterialPropertiesAsync("".concat(e,"/shaderMaterial"),t,n));else if(n instanceof BABYLON.StandardMaterial)o.push(this._parseDiffuseMaterialPropertiesAsync("".concat(e,"/standardMaterial"),t,n));else{var l=a._extensionsLoadMaterialPropertiesAsync(e,t,n);l?this._parseCommonConstantProperties(o,"".concat(e,"/commonConstant"),t,n):(o.push(a.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&o.push(a._loadMaterialMetallicRoughnessPropertiesAsync("".concat(e,"/pbrMetallicRoughness"),t.pbrMetallicRoughness,n)),a.loadMaterialAlphaProperties(e,t,n),this._parseCommonConstantProperties(o,"".concat(e,"/commonConstant"),t,n))}return Promise.all(o).then(function(){})}return null},e.prototype._getCachedMaterialByIndex=function(e){var t=null;return e>=0&&null!=this._materialMap&&(t=this._materialMap.get(e)||null),t},e.prototype._getCachedLightmapByIndex=function(e){var t=null;return e>=0&&null!=this._lightmapMap&&(t=this._lightmapMap.get(e)||null),t},e.prototype.createMaterial=function(e,t,n){
if(this._parseScene===!0&&t.index){var r=t.index;if(r>=0){var a=this._getCachedMaterialByIndex(r);if(null!=a)return a}}if(this._parseScene===!0){var o=null,l=t.name||"No Name";if(null!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.customMaterial){var i=t.extras.metadata,s=i.customMaterial,u=(i.customShader,BABYLON.Utilities.InstantiateClass(s));if(null!=u){var d=new u(l,this._loader.babylonScene);if(null!=d){var p=d instanceof BABYLON.Material;p===!0?(o=d,o.fillMode=n,o instanceof BABYLON.ShaderMaterial&&BABYLON.Utilities.InitializeShaderMaterial(o)):BABYLON.Tools.Warn("Non material instantiated class: "+s)}else BABYLON.Tools.Warn("Failed to instantiate material class: "+s)}else BABYLON.Tools.Warn("Failed to locate material class: "+s)}return o}return null},e.prototype.loadAnimationAsync=function(e,t){if(this._parseScene===!0){var n=(this._loader,t);this._babylonScene._blockEntityCollection=!!this._assetContainer;var r=new BABYLON.AnimationGroup(t.name||"animation".concat(n.index),this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n._babylonAnimationGroup=r,this._animationGroups.push(r);var a=new Array;BABYLON.GLTF2.ArrayItem.Assign(n.channels),BABYLON.GLTF2.ArrayItem.Assign(n.samplers);for(var o=0,l=t.channels;o<l.length;o++){var i=l[o],s=i;a.push(this._loader._loadAnimationChannelAsync("".concat(e,"/channels/").concat(s.index),e,t,i,function(e,t){e.animations=e.animations||[],e.animations.push(t),r.addTargetedAnimation(t,e)}))}return Promise.all(a).then(function(){if(null!=t.extras&&null!=t.extras.metadata){var e={};e.unity=t.extras.metadata,r.metadata=e,null!=e.label&&""!==e.label&&(r.name=e.label)}return r.normalize(0),r})}return null},e.prototype._loadMeshPrimitiveAsync=function(e,t,n,r,a,o){var l=this;if(this._parseScene===!0){var i=this._loader;i.logOpen("".concat(e));var s,u=0===i._disableInstancedMesh&&i._parent.createInstances&&void 0==n.skin&&!r.primitives[0].targets,d=void 0;if(u&&a._instanceData)i._babylonScene._blockEntityCollection=!!i._assetContainer,s=a._instanceData.babylonSourceMesh.createInstance(t),s._parentContainer=i._assetContainer,i._babylonScene._blockEntityCollection=!1,d=a._instanceData.promise;else{var p=new Array;i._babylonScene._blockEntityCollection=!!i._assetContainer;var c=new BABYLON.Mesh(t,i._babylonScene);c._parentContainer=i._assetContainer,i._babylonScene._blockEntityCollection=!1,this._leftHanded===!0?c.overrideMaterialSideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:c.overrideMaterialSideOrientation=i._babylonScene.useRightHandedSystem?BABYLON.Material.CounterClockWiseSideOrientation:BABYLON.Material.ClockWiseSideOrientation,i._createMorphTargets(e,n,r,a,c),p.push(i._loadVertexDataAsync(e,a,c).then(function(t){return i._loadMorphTargetsAsync(e,a,c,t).then(function(){i._disposed||(i._babylonScene._blockEntityCollection=!!i._assetContainer,t.applyToMesh(c),l._setupBabylonMesh(c,n,r,a),t._parentContainer=i._assetContainer,i._babylonScene._blockEntityCollection=!1)})}));var m=BABYLON.GLTF2.GLTFLoader._GetDrawMode(e,a.mode);if(null!=a.extras&&null!=a.extras.metadata&&null!=a.extras.metadata.multimaterial&&null!=a.extras.metadata.submeshes)this._setupBabylonMaterials(e,p,m,c,r,a);else if(void 0==a.material){var f=i._defaultBabylonMaterialData[m];f||(f=i._createDefaultMaterial("__GLTFLoader._default",m),i._parent.onMaterialLoadedObservable.notifyObservers(f),i._defaultBabylonMaterialData[m]=f),c.material=f}else if(!i.parent.skipMaterials){var h=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),i._gltf.materials,a.material);p.push(i._loadMaterialAsync("/materials/".concat(h.index),h,c,m,function(e){c.material=e}))}d=Promise.all(p),u&&(a._instanceData={babylonSourceMesh:c,promise:d}),s=c}return BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(s,e),i._parent.onMeshLoadedObservable.notifyObservers(s),o(s),i.logClose(),d.then(function(){return s})}return null},e.prototype._setupBabylonMesh=function(e,t,n,r){if(this._parseScene===!0){this._loader;if(null!=r.extras&&null!=r.extras.metadata&&null!=r.extras.metadata.multimaterial&&null!=r.extras.metadata.submeshes){var a=r.extras.metadata.submeshes;e.subMeshes=[];for(var o=0;o<a.length;o++){var l=a[o];BABYLON.SubMesh.AddToMesh(l.materialIndex,l.verticesStart,l.verticesCount,l.indexStart,l.indexCount,e)}}e.computeWorldMatrix(!0)}},e.prototype._setupBabylonMaterials=function(e,t,n,r,a,o){if(this._parseScene===!0){var l=this._loader,i=o.extras.metadata.multimaterial,s=i.materials,u=[],d=i.id||"MM_"+a.name,p=i.name||"MM_"+a.name,c=new BABYLON.MultiMaterial("["+p+"]",l._babylonScene);c.id=d,s.forEach(function(t){if(null!=t){var n=parseInt(t);if(n>=0){var a=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),l._gltf.materials,n);u.push(a)}else console.warn("Invalid Submesh Material Index Encountered For: "+r.name)}else console.warn("Null Submesh Material Encountered For: "+r.name)}),t.push(this._parseMultiMaterialAsync("/materials/".concat(p),u,r,n,function(e){c.subMaterials=e,r.material=c}))}},e.prototype._processLevelOfDetail=function(e,t){null!=t&&t.length>0&&t.forEach(function(e){if(null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.lods&&null!=e.metadata.unity.distances){var t=e.metadata.unity,n=t.lods,r=t.distances;if(r.length>=n.length){var a=null,o=null;if(n.forEach(function(t,n){var r="*"===t?e:SM.FindChildTransformNode(e,t,BABYLON.SearchType.ExactMatch,!1);null!=r&&r instanceof BABYLON.AbstractMesh&&(0===n?a=r:(null==o&&(o=[]),o.push(r)))}),null!=a)if(a instanceof BABYLON.Mesh){var l=r.length>0?r[r.length-1]:0;l>=1/0&&(l=0),null!=o&&o.forEach(function(e,t){a.addLODLevel(r[t],e)}),l>0&&a.addLODLevel(l,null)}else a instanceof BABYLON.InstancedMesh&&null!=o&&o.forEach(function(t,n){try{t.dispose()}catch(r){}BABYLON.Tools.Warn("Destroyed Unused Level Detail: "+t.name+" --> For Transform: "+e.name)})}}})},e.prototype._processShaderMaterials=function(e,t){null!=t&&t.length>0&&t.forEach(function(e){e.freeze()})},e.prototype.preProcessSceneProperties=function(e,t){if(this._assetContainer!==!0&&this._sceneParsed===!1&&null!=e.extras&&null!=e.extras.metadata&&null!=e.extras.metadata.properties&&e.extras.metadata.properties===!0){this._sceneParsed=!0;var n=null!=this._rootUrl?this._rootUrl:"/",r=e.extras.metadata;if(null==t.metadata&&(t.metadata={}),null==t.metadata.unity&&(t.metadata.unity={}),t.metadata.unity=r,this._disposeRoot=null!=r.disposeroot&&r.disposeroot===!0,this._hideLoader=null!=r.hideloader&&r.hideloader===!0,this._preWarmTime=null!=r.prewarmup?r.prewarmup:0,BABYLON.SceneManager.SetRootUrl(t,n),BABYLON.SceneManager.SetSceneFile(t,this._fileName),BABYLON.SceneManager.EnableUserInput=!0,BABYLON.SceneManager.GlobalOptions.ktxtextures=null!=r.ktxtextures&&r.ktxtextures,BABYLON.SceneManager.GlobalOptions.ktxlightmaps=null!=r.ktxlightmaps&&r.ktxlightmaps,BABYLON.SceneManager.GlobalOptions.intensityFactor=null!=r.intensity?r.intensity:1,BABYLON.SceneManager.GlobalOptions.debugModeEnabled=null!=r.debugging&&r.debugging,BABYLON.SceneManager.GlobalOptions.showDebugColliders=null!=r.showdebugcolliders&&r.showdebugcolliders,BABYLON.SceneManager.GlobalOptions.colliderVisibility=null!=r.collidervisibility?r.collidervisibility:0,BABYLON.SceneManager.GlobalOptions.colliderRenderGroup=null!=r.colliderrendergroup?r.colliderrendergroup:0,BABYLON.SceneManager.GlobalOptions.defaultRenderGroup=null!=r.defaultrendergroup?r.defaultrendergroup:0,BABYLON.SceneManager.GlobalOptions.collisionWireframe=null!=r.collisionwireframe&&r.collisionwireframe,BABYLON.SceneManager.GlobalOptions.useTriangleNormals=null!=r.trianglenormals&&r.trianglenormals,BABYLON.SceneManager.GlobalOptions.useConvexTriangles=null==r.convextriangles||r.convextriangles,BABYLON.SceneManager.GlobalOptions.colliderInstances=null==r.colliderinstances||r.colliderinstances,BABYLON.SceneManager.GlobalOptions.reparentColliders=null==r.reparentcolliders||r.reparentcolliders,null!=r.clearcolor&&(t.clearColor=BABYLON.Utilities.ParseColor4(r.clearcolor)),null!=r.autoclear&&r.autoclear===!0&&(t.autoClear=!0,t.autoClearDepthAndStencil=!0),null!=r.rendergroups&&(BABYLON.RenderingManager.MAX_RENDERINGGROUPS=r.rendergroups),null!=r.imageprocessing){var a=r.imageprocessing,o=null!=a.contrast?a.contrast:1,l=null!=a.exposure?a.exposure:1;null!=t.imageProcessingConfiguration&&(t.imageProcessingConfiguration.contrast=o,t.imageProcessingConfiguration.exposure=l)}var i=BABYLON.SceneManager.AmbientLightIntensity;if(null!=r.ambientcoloring&&(t.ambientColor=BABYLON.Utilities.ParseColor3(r.ambientcoloring)),null!=r.ambientlighting&&r.ambientlighting>0){var s=t;null==s._AmbientLight&&(s._AmbientLight=new BABYLON.HemisphericLight("Ambient Lighting",new BABYLON.Vector3(0,1,0),t),s._AmbientLight.falloffType=BABYLON.Light.FALLOFF_STANDARD,s._AmbientLight.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT),null!=s._AmbientLight&&(null!=r.ambientskycolor&&(s._AmbientLight.diffuse=BABYLON.Utilities.ParseColor3(r.ambientskycolor,BABYLON.Color3.Gray())),null!=r.ambientspecularcolor&&(s._AmbientLight.specular=BABYLON.Utilities.ParseColor3(r.ambientspecularcolor,BABYLON.Color3.White())),null!=r.ambientgroundcolor&&(s._AmbientLight.groundColor=BABYLON.Utilities.ParseColor3(r.ambientgroundcolor,BABYLON.Color3.Gray())),null!=r.ambientlightintensity&&(s._AmbientLight.intensity=r.ambientlightintensity),s._AmbientLight.intensity*=i)}if(null!=r.fogmode){var u=r.fogmode;if(u>0){t.fogMode=u,t.fogEnabled=!0;var d=1;1===u?d=.5:2===u&&(d=.75),null!=r.fogdensity&&(t.fogDensity=r.fogdensity*d),null!=r.fogstart&&(t.fogStart=r.fogstart),null!=r.fogend&&(t.fogEnd=r.fogend),null!=r.fogcolor&&(t.fogColor=BABYLON.Utilities.ParseColor3(r.fogcolor))}}var p=new BABYLON.Vector3(0,(-9.81),0),c=null!=r.defaultgravity?BABYLON.Utilities.ParseVector3(r.defaultgravity,p):p;if(t.gravity=c.clone(),t.collisionsEnabled=!0,null!=r.enablephysics){var m=r.enablephysics;if(m===!0){var f=null==r.ccdenabled||r.ccdenabled,h=null!=r.ccdpenetration?r.ccdpenetration:1e-4,g=null!=r.subtimestep?r.subtimestep:0,v=null!=r.maxworldsweep?r.maxworldsweep:0,y=null==r.deltaworldstep||r.deltaworldstep;BABYLON.RigidbodyPhysics?BABYLON.RigidbodyPhysics.ConfigurePhysicsEngine(t,y,g,v,f,h,c):BABYLON.Tools.Warn("Rigidbody physics system not loaded. Physics system not configured")}}if(null!=r.userinput){var C=r.userinput;BABYLON.UserInputOptions.KeyboardSmoothing=C.keyboardSmoothing,BABYLON.UserInputOptions.KeyboardMoveSensibility=C.keyboardSensitivity,BABYLON.UserInputOptions.KeyboardMoveDeadZone=C.keyboardDeadZone,BABYLON.UserInputOptions.GamepadDeadStickValue=C.padDeadStick,BABYLON.UserInputOptions.GamepadLStickXInverted=C.padLStickXInvert,BABYLON.UserInputOptions.GamepadLStickYInverted=C.padLStickYInvert,BABYLON.UserInputOptions.GamepadRStickXInverted=C.padRStickXInvert,BABYLON.UserInputOptions.GamepadRStickYInverted=C.padRStickYInvert,BABYLON.UserInputOptions.GamepadLStickSensibility=C.padLStickLevel,BABYLON.UserInputOptions.GamepadRStickSensibility=C.padRStickLevel,BABYLON.UserInputOptions.SupportedInputDevices=C.supportedDevices,BABYLON.UserInputOptions.PointerAngularSensibility=C.mouseSensitivity,BABYLON.UserInputOptions.PointerWheelDeadZone=C.wheelDeadZone,BABYLON.UserInputOptions.PointerMouseDeadZone=C.mouseDeadZone,BABYLON.UserInputOptions.PointerMouseInverted=C.mouseMoveInvert,BABYLON.UserInputOptions.UseCanvasElement=C.useCanvasElement,BABYLON.UserInputOptions.UseArrowKeyRotation=C.arrowKeyRotation}if(null!=r.enableinput){var b=r.enableinput;if(b===!0){var I=null==r.contextmenu||r.contextmenu,S=null!=r.pointerlock&&r.pointerlock,_=null!=r.preventdefault&&r.preventdefault,M=null!=r.usecapture&&r.usecapture,T={contextMenu:I,pointerLock:S,preventDefault:_,useCapture:M};BABYLON.InputController&&BABYLON.InputController.ConfigureUserInput(t,T)}}null!=r.freezeactivemeshes&&r.freezeactivemeshes===!0&&(this._activeMeshes=!0)}},e.prototype.postProcessSceneProperties=function(e,t,n){var r=this;if(this._assetContainer!==!0&&null!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.properties&&t.extras.metadata.properties===!0){var a=t.extras.metadata;if(null!=a.skybox){var o=a.skybox,l=null!=o.skyfog&&o.skyfog,i=null!=o.skytags?o.skytags:"Untagged",s=null!=o.skysize?o.skysize:1e3,u=null!=o.rotation?o.rotation:0,d=null!=o.basename&&""!==o.basename?e+o.basename:null,p=null!=o.skyfaces?o.skyfaces:null,c=null!=o.rendergroup?o.rendergroup:0,m=null!=o.extensions&&o.extensions.length>0?o.extensions:null,f=null!=o.polynomial?o.polynomial:1;try{if(null!=p&&""!==p&&null!=d&&""!==d){var h=null;if("png"===p)h=new BABYLON.CubeTexture(d,n,m),d.indexOf("_rgbd")>=0?(h.isRGBD=!0,h.gammaSpace=!1):(h.isRGBD=!1,h.gammaSpace=!0);else if("jpg"===p)h=new BABYLON.CubeTexture(d,n,m),h.isRGBD=!1,h.gammaSpace=!0;else if("ktx2"===p)h=new BABYLON.CubeTexture(d,n,m),h.isRGBD=!1,h.gammaSpace=!0;else{var g=!0,v=d+"."+p;h=new BABYLON.CubeTexture(v,n,null,(!0),null,null,null,null,g),h.gammaSpace=!1}h.name=o.basename,h.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,h.rotationY=BABYLON.Tools.ToRadians(u);var y="Default Skybox",C=BABYLON.MeshBuilder.CreateBox(y,{size:s},n);C.renderingGroupId=BABYLON.Utilities.DefaultRenderGroup(),C.id=y,C.infiniteDistance=!0,C.applyFog=l,C.renderingGroupId=c,null!=i&&""!==i&&BABYLON.Tags.AddTagsTo(C,i),n.useRightHandedSystem===!0&&(C.scaling.x*=-1);var b=new BABYLON.StandardMaterial("Skybox-Material",n);b.backFaceCulling=!1,b.disableLighting=!0,b.diffuseColor=new BABYLON.Color3(0,0,0),b.emissiveColor=new BABYLON.Color3(0,0,0),b.specularColor=new BABYLON.Color3(0,0,0),b.ambientColor=new BABYLON.Color3(0,0,0),b.reflectionTexture=h,C.material=b}}catch(I){console.warn(I)}if(null!=o.environment){var S=o.environment;n.environmentIntensity=null!=S.level?BABYLON.Scalar.Clamp(S.level,0,10):1;var _=null!=S.info&&""!==S.info?S.info:null;if(null!=_&&""!==_)try{var M=BABYLON.SceneManager.GetRootUrl(n),T=M+_.rooturl,x=T+_.name;if(null!=this._assetsManager){var A=this._assetsManager.addBinaryFileTask("Global.EnvironmentTextureTask",x);A.onSuccess=function(e){if(null!=e.data){var t=new Blob([e.data]),n=r._babylonScene,a=URL.createObjectURL(t),o=function(){URL.revokeObjectURL(a)},l=new BABYLON.CubeTexture(a,n,null,null,null,o,o,null,(!0),".dds");n.environmentTexture=l,n.environmentTexture.name="assets/"+_.name,null!=n.environmentTexture&&null!=n.environmentTexture.sphericalPolynomial&&(n.isReady()?n.environmentTexture.sphericalPolynomial.scaleInPlace(f):n.onReadyObservable.addOnce(function(){n.environmentTexture.sphericalPolynomial.scaleInPlace(f)}))}else console.error("Failed to load environment texture task: "+x)},A.onError=function(e,t,n){console.error(t,n)}}}catch(O){console.warn(O)}}}if(null!=a.navigation&&null!=a.navigation.prebaked&&""!==a.navigation.prebaked){var w=null!=a.navigation.collision&&a.navigation.collision===!0,B=null!=a.navigation.showdebug&&a.navigation.showdebug===!0,L=null!=a.navigation.debugcolor?a.navigation.debugcolor:[.05,.225,.75],P=new BABYLON.Color3(L[0],L[1],L[2]),N=null!=a.navigation.timesteps?a.navigation.timesteps:0;if(null!=this._assetsManager){var k=a.navigation.prebaked,U=this._assetsManager.addBinaryFileTask("System.NavigationMeshTask",k);U.onSuccess=function(e){if(null!=e.data){var t=new Uint8Array(e.data);BABYLON.SceneManager.LoadNavigationMesh(n,t,B,P,N,w)}else console.error("Failed to load navigation mesh task: "+k)},U.onError=function(e,t,n){console.error(t,n)}}}}},e.prototype._preloadRawMaterialsAsync=function(e,t,n){var r=this._loader,a=new Array,o=BABYLON.Material.TriangleFillMode;return n.forEach(function(n){var l=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),t,n);if(null!=l){var i=r.createMaterial(e,l,o);BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(i,e),r._parent.onMaterialLoadedObservable.notifyObservers(i),a.push(r.loadMaterialPropertiesAsync(e,l,i))}}),Promise.all(a).then(function(){})},e.prototype._parseMultiMaterialAsync=function(e,t,n,r,a){var o=this;void 0===a&&(a=function(){});var l=this._loader,i=t;i._data=i._data||{};var s=i._data[r];if(!s){l.logOpen("".concat(e," ").concat(n.name||""));var u=[],d=new Array;t.forEach(function(t){var n=null;if(t.index){var a=t.index;a>=0&&(n=o._getCachedMaterialByIndex(a))}null==n&&(n=l.createMaterial(e,t,r),BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(n,e),l._parent.onMaterialLoadedObservable.notifyObservers(n),d.push(l.loadMaterialPropertiesAsync(e,t,n))),u.push(n)}),s={babylonMaterials:u,babylonMeshes:[],promises:d},i._data[r]=s,l.logClose()}return s.babylonMeshes.push(n),n.onDisposeObservable.addOnce(function(){var e=s.babylonMeshes.indexOf(n);e!==-1&&s.babylonMeshes.splice(e,1)}),a(s.babylonMaterials),Promise.all(s.promises).then(function(){return s.babylonMaterials})},e.prototype._parseNodeMaterialPropertiesAsync=function(e,t,n){var r=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,a=n,o=new Array;a.backFaceCulling=null==r||null==r.backFaceCulling||r.backFaceCulling,t.doubleSided&&(a.backFaceCulling=!1);var l=1;if(t.pbrMetallicRoughness){var i=t.pbrMetallicRoughness;if(i){if(i.baseColorFactor){var s=BABYLON.Color4.FromArray(i.baseColorFactor);a.setVector4("_Color",new BABYLON.Vector4(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2),s.a)),l=s.a}else a.setVector4("_Color",new BABYLON.Vector4(1,1,1,1));i.baseColorTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),i.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)");var t=e;t.level=null!=r&&null!=r.diffuseIntensity?r.diffuseIntensity:1,a.setTexture("_MainTex",t)}))}}if(t.normalTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)");var r=e;void 0!=t.normalTexture.scale&&(r.level=t.normalTexture.scale),a.setTexture("_BumpMap",r)})),t.occlusionTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)");var r=e;void 0!=t.occlusionTexture.strength&&(r.level=t.occlusionTexture.strength),a.setTexture("_OcclusionMap",r)})),t.emissiveFactor){var u=BABYLON.Color4.FromArray(t.emissiveFactor);(u.r>0||u.g>0||u.b>0)&&a.setVector4("_EmissionColor",new BABYLON.Vector4(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2),u.a))}if(t.emissiveTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)");var t=e;a.setTexture("_EmissionMap",t)})),null!=r){if(a.wireframe=null!=r.useWireframe&&r.useWireframe,a.needDepthPrePass=null!=r.depthPrepass&&r.depthPrepass,r.customTextures){var d=function(t){var l=r.customTextures[t];null!=l&&o.push(p._loader.loadTextureInfoAsync(e+"/"+t,l,function(e){"detailsSampler"===t||"normalsSampler"===t?e.name="".concat(n.name," (Atlas)"):e.name="".concat(n.name," (Custom)"),a.setTexture(t,e)}))},p=this;for(var c in r.customTextures)d(c)}if(r.customVectors)for(var m in r.customVectors){var f=r.customVectors[m];null!=f&&a.setVector4(m,BABYLON.Vector4.FromArray(f))}if(r.customColors)for(var h in r.customColors){var g=r.customColors[h];null!=g&&a.setVector4(h,BABYLON.Vector4.FromArray(g))}if(r.customFloats)for(var v in r.customFloats){var y=r.customFloats[v];null!=y&&a.setFloat(v,y)}null!=r.freezeMaterial&&r.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(a)}var C=Promise.all(o).then(function(){});return a.compile(),C},e.prototype._parseShaderMaterialPropertiesAsync=function(e,t,n){var r=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,a=n,o=new Array;a.backFaceCulling=null==r||null==r.backFaceCulling||r.backFaceCulling,t.doubleSided&&(a.backFaceCulling=!1),BABYLON.Utilities.HasOwnProperty(a,"ambientColor")&&(a.ambientColor=null!=r&&r.ambientColorFactor?BABYLON.Color3.FromArray(r.ambientColorFactor):BABYLON.Color3.Black());var l=1;if(t.pbrMetallicRoughness){var i=t.pbrMetallicRoughness;if(i){if(i.baseColorFactor){var s=BABYLON.Color4.FromArray(i.baseColorFactor);a.setVector4("diffuseColor",new BABYLON.Vector4(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2),s.a)),l=s.a}else a.setVector4("diffuseColor",new BABYLON.Vector4(1,1,1,1));i.baseColorTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),i.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)");var t=e;t.level=null!=r&&null!=r.diffuseIntensity?r.diffuseIntensity:1,a.setTexture("diffuseTexture",t)}))}}if(t.normalTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)");var r=e;void 0!=t.normalTexture.scale&&(r.level=t.normalTexture.scale),a.setTexture("bumpTexture",r)})),t.occlusionTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)");var r=e;void 0!=t.occlusionTexture.strength&&(r.level=t.occlusionTexture.strength),a.setTexture("ambientTexture",r)})),t.emissiveFactor){var u=BABYLON.Color4.FromArray(t.emissiveFactor);(u.r>0||u.g>0||u.b>0)&&a.setVector4("emissiveColor",new BABYLON.Vector4(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2),u.a))}t.emissiveTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)");var t=e;a.setTexture("emissiveTexture",t)})),a.alpha=l;var d=t.alphaMode||"OPAQUE";switch(d){case"OPAQUE":a.alpha=1,a.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_OPAQUE;break;case"MASK":a.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHATEST;break;case"BLEND":a.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHABLEND;break;default:throw new Error("".concat(e,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}if(null!=r){if(a.wireframe=null!=r.useWireframe&&r.useWireframe,a.needDepthPrePass=null!=r.depthPrepass&&r.depthPrepass,r.customTextures){var p=function(t){var l=r.customTextures[t];null!=l&&o.push(c._loader.loadTextureInfoAsync(e+"/"+t,l,function(e){"detailsSampler"===t||"normalsSampler"===t?e.name="".concat(n.name," (Atlas)"):e.name="".concat(n.name," (Custom)"),a.setTexture(t,e)}))},c=this;for(var m in r.customTextures)p(m)}if(r.customVectors)for(var f in r.customVectors){var h=r.customVectors[f];null!=h&&a.setVector4(f,BABYLON.Vector4.FromArray(h))}if(r.customColors)for(var g in r.customColors){var v=r.customColors[g];null!=v&&a.setVector4(g,BABYLON.Vector4.FromArray(v))}if(r.customFloats)for(var y in r.customFloats){var C=r.customFloats[y];null!=C&&a.setFloat(y,C)}null!=r.freezeMaterial&&r.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(a)}return Promise.all(o).then(function(){})},e.prototype._parseDiffuseMaterialPropertiesAsync=function(e,t,n){var r=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,a=n,o=new Array;BABYLON.Utilities.HasOwnProperty(a,"ambientColor")&&(a.ambientColor=null!=r&&r.ambientColorFactor?BABYLON.Color3.FromArray(r.ambientColorFactor):BABYLON.Color3.Black()),BABYLON.Utilities.HasOwnProperty(a,"backFaceCulling")&&(a.backFaceCulling=null==r||null==r.backFaceCulling||r.backFaceCulling),t.doubleSided&&(BABYLON.Utilities.HasOwnProperty(a,"twoSidedLighting")&&(a.twoSidedLighting=!0),BABYLON.Utilities.HasOwnProperty(a,"backFaceCulling")&&(a.backFaceCulling=!1));var l=1;if(t.pbrMetallicRoughness){var i=t.pbrMetallicRoughness;if(i){if(BABYLON.Utilities.HasOwnProperty(a,"diffuseColor"))if(i.baseColorFactor){var s=BABYLON.Color4.FromArray(i.baseColorFactor);a.diffuseColor=new BABYLON.Color3(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2)),l=s.a}else a.diffuseColor=BABYLON.Color3.White();BABYLON.Utilities.HasOwnProperty(a,"diffuseTexture")&&i.baseColorTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),i.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)"),a.diffuseTexture=e,a.diffuseTexture.level=null!=r&&null!=r.diffuseIntensity?r.diffuseIntensity:1}))}}if(BABYLON.Utilities.HasOwnProperty(a,"bumpTexture")&&t.normalTexture&&(o.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)"),a.bumpTexture=e,void 0!=t.normalTexture.scale&&(a.bumpTexture.level=t.normalTexture.scale)})),BABYLON.Utilities.HasOwnProperty(a,"invertNormalMapX")&&(a.invertNormalMapX=!this._loader.babylonScene.useRightHandedSystem),BABYLON.Utilities.HasOwnProperty(a,"invertNormalMapY")&&(a.invertNormalMapY=this._loader.babylonScene.useRightHandedSystem)),BABYLON.Utilities.HasOwnProperty(a,"ambientTexture")&&t.occlusionTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)"),a.ambientTexture=e,void 0!=t.occlusionTexture.strength&&(a.ambientTexture.level=t.occlusionTexture.strength)})),BABYLON.Utilities.HasOwnProperty(a,"emissiveColor")){var u=t.emissiveFactor?BABYLON.Color4.FromArray(t.emissiveFactor):new BABYLON.Color4(0,0,0,1);a.emissiveColor=new BABYLON.Color3(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2))}BABYLON.Utilities.HasOwnProperty(a,"emissiveTexture")&&t.emissiveTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)"),a.emissiveTexture=e,BABYLON.Utilities.HasOwnProperty(a,"useEmissiveAsIllumination")&&(a.useEmissiveAsIllumination=null!=r&&null!=r.useEmissiveAsIllumination&&r.useEmissiveAsIllumination)})),BABYLON.Utilities.HasOwnProperty(a,"alpha")&&(a.alpha=l);var d=t.alphaMode||"OPAQUE";switch(d){case"OPAQUE":BABYLON.Utilities.HasOwnProperty(a,"alpha")&&(a.alpha=1);break;case"MASK":a.alphaCutOff=void 0==t.alphaCutoff?.5:t.alphaCutoff,a.diffuseTexture&&BABYLON.Utilities.HasOwnProperty(a,"diffuseTexture")&&(a.diffuseTexture.hasAlpha=!0);break;case"BLEND":a.diffuseTexture&&(BABYLON.Utilities.HasOwnProperty(a,"diffuseTexture")&&(a.diffuseTexture.hasAlpha=!0),BABYLON.Utilities.HasOwnProperty(a,"useAlphaFromDiffuseTexture")&&(a.useAlphaFromDiffuseTexture=!0));break;default:throw new Error("".concat(e,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}return this._parseCommonConstantProperties(o,e,t,n),Promise.all(o).then(function(){})},e.prototype._parseCommonConstantProperties=function(e,t,n,r){var a=this,o=null!=n.extras&&null!=n.extras.metadata?n.extras.metadata:null;if(null!=o){var l=r;if(BABYLON.Utilities.HasOwnProperty(l,"alphaMode")&&(l.alphaMode=null!=o&&o.alphaMode?o.alphaMode:BABYLON.Engine.ALPHA_COMBINE),BABYLON.Utilities.HasOwnProperty(l,"ambientColor")&&(l.ambientColor=null!=o&&o.ambientColorFactor?BABYLON.Color3.FromArray(o.ambientColorFactor):BABYLON.Color3.Black()),BABYLON.Utilities.HasOwnProperty(l,"backFaceCulling")&&(l.backFaceCulling=null==o||null==o.backFaceCulling||o.backFaceCulling),r instanceof BABYLON.PBRMaterial&&(r.useMetallnessFromMetallicTextureBlue=!0,r.useRoughnessFromMetallicTextureGreen=!0,r.useRoughnessFromMetallicTextureAlpha=!1,r.useAmbientOcclusionFromMetallicTextureRed=!1,r.directIntensity=null!=o.directIntensity?o.directIntensity:1,r.specularIntensity=null!=o.specularIntensity?o.specularIntensity:1,r.emissiveIntensity=null!=o.emissiveIntensity?o.emissiveIntensity:1,r.environmentIntensity=null!=o.environmentIntensity?o.environmentIntensity:1,r.indexOfRefraction=null!=o.indexOfRefraction?o.indexOfRefraction:1.5,null!=o.useAlphaFromAlbedoTexture&&(r.useAlphaFromAlbedoTexture=o.useAlphaFromAlbedoTexture),null!=o.parallaxBias&&o.parallaxBias>0&&(r.useParallax=!0,r.parallaxScaleBias=.9*o.parallaxBias,r.useParallaxOcclusion=null==o.parallaxOcclusion||o.parallaxOcclusion,r.useParallaxOcclusion===!0&&(r.parallaxScaleBias*=.5))),BABYLON.Utilities.HasOwnProperty(l,"unlit")&&(l.unlit=null!=o.unlitMaterial&&o.unlitMaterial),BABYLON.Utilities.HasOwnProperty(l,"wireframe")&&(l.wireframe=null!=o.useWireframe&&o.useWireframe),BABYLON.Utilities.HasOwnProperty(l,"disableLighting")&&(l.disableLighting=null!=o.disableLighting&&o.disableLighting),BABYLON.Utilities.HasOwnProperty(l,"maxSimultaneousLights")&&(l.maxSimultaneousLights=null!=o.maxSimultaneousLights?o.maxSimultaneousLights:4),BABYLON.Utilities.HasOwnProperty(l,"needDepthPrePass")&&(l.needDepthPrePass=null!=o.depthPrepass&&o.depthPrepass),BABYLON.Utilities.HasOwnProperty(l,"lightmapTexture")&&o.lightmapTexture){o.lightmapTexture.nonColorData=!0;var i=!0;BABYLON.Utilities.HasOwnProperty(l,"useLightmapAsShadowmap")&&(i=null==o.useLightmapAsShadowmap||o.useLightmapAsShadowmap);var s=null,u=null!=o.lightmapTexture.index?o.lightmapTexture.index:-1;u>=0&&(s=this._getCachedLightmapByIndex(u)),null!=s?(l.lightmapTexture=s,l.useLightmapAsShadowmap=i,BABYLON.Utilities.HasOwnProperty(l,"ambientColor")&&(l.ambientColor=BABYLON.Color3.White())):e.push(this._loader.loadTextureInfoAsync(t+"/lightmapTexture",o.lightmapTexture,function(e){e.name="assets/LightmapTexture-".concat(u),e.level=o.lightmapLevel?o.lightmapLevel:1;var t=e,n=null!=BABYLON.SceneManager.GlobalOptions.ktxlightmaps&&BABYLON.SceneManager.GlobalOptions.ktxlightmaps===!0;n===!0?e.gammaSpace=!0:(e.gammaSpace=!1,t.onLoadObservable.addOnce(function(){t.isReady()?t.isRGBD=!0:BABYLON.Tools.Warn("Failed to register texture as RGBD: "+t.name)})),l.lightmapTexture=e,u>=0&&null!=a._lightmapMap&&(a._lightmapMap.has(u)||a._lightmapMap.set(u,t)),l.useLightmapAsShadowmap=i,BABYLON.Utilities.HasOwnProperty(l,"ambientColor")&&(l.ambientColor=BABYLON.Color3.White())}))}r instanceof BABYLON.PBRMaterial&&o.detailMapTexture&&e.push(this._loader.loadTextureInfoAsync(t+"/detailMapTexture",o.detailMapTexture,function(e){e.name="".concat(r.name," (Detail Map)"),e.level=1,r.detailMap.texture=e,r.detailMap.bumpLevel=o.detailBumpLevel?o.detailBumpLevel:1,r.detailMap.diffuseBlendLevel=o.detailBlendLevel?o.detailBlendLevel:.75,r.detailMap.roughnessBlendLevel=o.detailRoughLevel?o.detailRoughLevel:.5,r.detailMap.isEnabled=!0}));var d=BABYLON.SceneManager.GetRenderQuality(),p=d===BABYLON.RenderQuality.High||d===BABYLON.RenderQuality.Medium;if(p===!0&&BABYLON.Utilities.HasOwnProperty(l,"reflectionColor")&&(l.reflectionColor=null!=o&&o.reflectionColorFactor?BABYLON.Color3.FromArray(o.reflectionColorFactor):BABYLON.Color3.White()),p===!0&&BABYLON.Utilities.HasOwnProperty(l,"reflectionTexture")&&o.reflectionCubemapInfo){var c=this._loader._rootUrl,m=(c+o.reflectionCubemapInfo.rooturl+o.reflectionCubemapInfo.name).toLowerCase(),f=m.lastIndexOf("."),h=f>-1?m.substring(f).toLowerCase():"",g=!0,v=new CubeTextureLoader;v.name="assets/"+o.reflectionCubemapInfo.name,v.mapkey=m,v.material=l,v.extension=h,v.prefiltered=g,o.reflectionCubemapInfo.boundingBoxSize&&(v.boundingBoxSize=BABYLON.Vector3.FromArray(o.reflectionCubemapInfo.boundingBoxSize),v.name+=" ("+v.boundingBoxSize.x.toString()+" "+v.boundingBoxSize.y.toString()+" "+v.boundingBoxSize.z.toString()+")",v.mapkey+="_"+v.boundingBoxSize.x.toString()+"_"+v.boundingBoxSize.y.toString()+"_"+v.boundingBoxSize.z.toString()),o.reflectionCubemapInfo.boundingBoxPosition&&(v.boundingBoxPosition=BABYLON.Vector3.FromArray(o.reflectionCubemapInfo.boundingBoxPosition),v.name+=" ("+v.boundingBoxPosition.x.toString()+" "+v.boundingBoxPosition.y.toString()+" "+v.boundingBoxPosition.z.toString()+")",v.mapkey+="_"+v.boundingBoxPosition.x.toString()+"_"+v.boundingBoxPosition.y.toString()+"_"+v.boundingBoxPosition.z.toString());var y=this._reflectionMap[m];null==y?(y=[v],this._reflectionMap[m]=y):y.push(v)}if(BABYLON.Utilities.HasOwnProperty(l,"terrainInfo")&&(l.terrainInfo=null!=o.terrainInfo?o.terrainInfo:null),BABYLON.Utilities.HasOwnProperty(r,"universalMaterial")){var C=r;if(o.customTextures){var b=function(n){var a=o.customTextures[n];null!=a&&(C.checkSampler(n),e.push(I._loader.loadTextureInfoAsync(t+"/"+n,a,function(e){"detailsSampler"===n||"normalsSampler"===n?e.name="".concat(r.name," (Atlas)"):e.name="".concat(r.name," (Custom)"),C.setTexture(n,e,!0)})))},I=this;for(var S in o.customTextures)b(S)}if(o.customVectors)for(var _ in o.customVectors){
var M=o.customVectors[_];null!=M&&C.setVector4(_,BABYLON.Vector4.FromArray(M),!0)}if(o.customColors)for(var T in o.customColors){var x=o.customColors[T];null!=x&&C.setVector4(T,BABYLON.Vector4.FromArray(x),!0)}if(o.customFloats)for(var A in o.customFloats){var O=o.customFloats[A];null!=O&&C.setFloat(A,O,!0)}}else{if(o.customTextures){var w=function(n){var a=o.customTextures[n];null!=a&&BABYLON.Utilities.HasOwnProperty(l,n)&&e.push(B._loader.loadTextureInfoAsync(t+"/"+n,a,function(e){"detailsSampler"===n||"normalsSampler"===n?e.name="".concat(r.name," (Atlas)"):e.name="".concat(r.name," (Custom)"),l[n]=e}))},B=this;for(var S in o.customTextures)w(S)}if(o.customVectors)for(var _ in o.customVectors){var M=o.customVectors[_];null!=M&&BABYLON.Utilities.HasOwnProperty(l,_)&&(l[_]=BABYLON.Vector4.FromArray(M))}if(o.customColors)for(var T in o.customColors){var x=o.customColors[T];null!=x&&BABYLON.Utilities.HasOwnProperty(l,T)&&(l[T]instanceof BABYLON.Vector4?l[T]=BABYLON.Vector4.FromArray(x):l[T]instanceof BABYLON.Color4?l[T]=BABYLON.Color4.FromArray(x):l[T]=BABYLON.Color3.FromArray(x))}if(o.customFloats)for(var A in o.customFloats){var O=o.customFloats[A];null!=O&&BABYLON.Utilities.HasOwnProperty(l,A)&&(l[A]instanceof Boolean?l[A]=O>0:l[A]=O)}}null!=o.freezeMaterial&&o.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(r)}},e}(),CVTOOLS_babylon_mesh=function(){function e(e){this.name=CVTOOLS_MESH,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_MESH),this.order=101}return e.prototype.dispose=function(){delete this._loader},e}(),CVTOOLS_left_handed=function(){function e(e){this.name=CVTOOLS_HAND,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_HAND),this.order=102}return e.prototype.dispose=function(){delete this._loader},e}();BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_NAME,function(e){return new CVTOOLS_unity_metadata(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_MESH,function(e){return new CVTOOLS_babylon_mesh(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_HAND,function(e){return new CVTOOLS_left_handed(e)}),BABYLON.SceneLoader.OnPluginActivatedObservable.add(function(e){"gltf"===e.name&&e instanceof BABYLON.GLTFFileLoader&&(e.animationStartMode=BABYLON.SceneManager.AnimationStartMode,e.targetFps=BABYLON.SceneManager.AnimationTargetFps,e.onSkinLoadedObservable.add(function(e){if(null!=e){try{null!=e.skinnedNode&&(e.skinnedNode.id+=".Skin")}catch(t){console.warn(t)}try{null!=e.skinnedNode&&(e.skinnedNode.name+=".Skin")}catch(n){console.warn(n)}try{if(null!=e.node&&null!=e.skinnedNode){var r=BABYLON.Tags.GetTags(e.node);null!=r&&BABYLON.Tags.AddTagsTo(e.skinnedNode,r),e.node._skinnedMesh=e.skinnedNode}}catch(a){console.warn(a)}}}))});var BABYLON;!function(e){var t=function(){function t(){}return t.ConfigureUserInput=function(t,n){void 0===n&&(n=null);var r=null==n||null==n.contextMenu||n.contextMenu,a=null!=n&&null!=n.pointerLock&&n.pointerLock,o=null!=n&&null!=n.preventDefault&&n.preventDefault,l=null!=n&&null!=n.useCapture&&n.useCapture;if(e.InputController.resetUserInput(),!e.InputController.input){document.documentElement.tabIndex=1,document.documentElement.addEventListener("keyup",e.InputController.inputKeyUpHandler,l),document.documentElement.addEventListener("pointerup",e.InputController.inputPointerUpHandler,l);var i=document.getElementById("renderingCanvas")||t.getEngine().getRenderingCanvas();null!=i&&(r===!0?(e.Tools.Log("Canvas element context menu enabled."),i.oncontextmenu=null):(i.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation()},e.Tools.Log("Canvas element context menu disabled."))),e.UserInputOptions.UseCanvasElement===!0?(i.tabIndex=2,i.addEventListener("focusout",e.InputController.resetKeyMapHandler,l),i.addEventListener("keydown",e.InputController.inputKeyDownHandler,l),i.addEventListener("pointerdown",e.InputController.inputPointerDownHandler,l),i.addEventListener("pointermove",e.InputController.inputPointerMoveHandler,l),i.addEventListener("onwheel"in document?"wheel":"mousewheel",e.InputController.inputPointerWheelHandler,l)):(document.documentElement.addEventListener("focusout",e.InputController.resetKeyMapHandler,l),document.documentElement.addEventListener("keydown",e.InputController.inputKeyDownHandler,l),document.documentElement.addEventListener("pointerdown",e.InputController.inputPointerDownHandler,l),document.documentElement.addEventListener("pointermove",e.InputController.inputPointerMoveHandler,l),document.documentElement.addEventListener("onwheel"in document?"wheel":"mousewheel",e.InputController.inputPointerWheelHandler,l)),e.InputController.preventDefault=o,null==e.InputController.GamepadManager&&(e.InputController.GamepadManager=new e.GamepadManager,e.InputController.GamepadManager.onGamepadConnectedObservable.add(e.InputController.inputManagerGamepadConnected),e.InputController.GamepadManager.onGamepadDisconnectedObservable.add(e.InputController.inputManagerGamepadDisconnected)),e.InputController.input=!0,document.documentElement.focus(),a===!0&&e.InputController.LockMousePointer(t,!0)}t.registerAfterRender(function(){e.InputController.updateUserInput(t)})},t.SetLeftJoystickBuffer=function(t,n,r){void 0===r&&(r=!0),e.InputController.j_horizontal=t,e.InputController.j_vertical=r===!0?-n:n},t.SetRightJoystickBuffer=function(t,n,r){void 0===r&&(r=!0),e.InputController.j_mousex=t,e.InputController.j_mousey=r===!0?-n:n},t.DisableUserInput=function(t,n){void 0===n&&(n=!1),e.InputController.LockMousePointer(t,!1),e.InputController.resetUserInput()},t.LockMousePointer=function(t,n){n===!0?e.InputController.LockMousePointerObserver=t.onPointerObservable.add(function(n,r){n.type==e.PointerEventTypes.POINTERDOWN&&(document.pointerLockElement||t.getEngine().enterPointerlock())}):e.InputController.IsPointerLockHandled()&&(t.onPointerObservable.remove(e.InputController.LockMousePointerObserver),e.InputController.LockMousePointerObserver=null)},t.IsPointerLocked=function(){return e.InputController.PointerLockedFlag},t.IsPointerLockHandled=function(){return null!=e.InputController.LockMousePointerObserver},t.GetUserInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var r=0;if(e.InputController.input)switch(t){case e.UserInputAxis.Vertical:case e.UserInputAxis.Horizontal:r=n===e.PlayerNumber.Four?t===e.UserInputAxis.Horizontal?e.InputController.horizontal4:e.InputController.vertical4:n===e.PlayerNumber.Three?t===e.UserInputAxis.Horizontal?e.InputController.horizontal3:e.InputController.vertical3:n===e.PlayerNumber.Two?t===e.UserInputAxis.Horizontal?e.InputController.horizontal2:e.InputController.vertical2:t===e.UserInputAxis.Horizontal?e.InputController.horizontal:e.InputController.vertical;break;case e.UserInputAxis.MouseX:case e.UserInputAxis.MouseY:r=n===e.PlayerNumber.Four?t===e.UserInputAxis.MouseX?e.InputController.mousex4:e.InputController.mousey4:n===e.PlayerNumber.Three?t===e.UserInputAxis.MouseX?e.InputController.mousex3:e.InputController.mousey3:n===e.PlayerNumber.Two?t===e.UserInputAxis.MouseX?e.InputController.mousex2:e.InputController.mousey2:t===e.UserInputAxis.MouseX?e.InputController.mousex:e.InputController.mousey;break;case e.UserInputAxis.Wheel:n===e.PlayerNumber.One&&(r=e.InputController.wheel)}return r},t.OnKeyboardUp=function(t){e.InputController.input&&e.InputController.keyButtonUp.push(t)},t.OnKeyboardDown=function(t){e.InputController.input&&e.InputController.keyButtonDown.push(t)},t.OnKeyboardPress=function(t,n){e.InputController.input&&e.InputController.keyButtonPress.push({index:t,action:n})},t.GetKeyboardInput=function(t){var n=!1;if(e.InputController.input){var r="k:"+t.toString();null!=e.InputController.keymap[r]&&(n=e.InputController.keymap[r])}return n},t.OnPointerUp=function(t){e.InputController.input&&e.InputController.mouseButtonUp.push(t)},t.OnPointerDown=function(t){e.InputController.input&&e.InputController.mouseButtonDown.push(t)},t.OnPointerPress=function(t,n){e.InputController.input&&e.InputController.mouseButtonPress.push({index:t,action:n})},t.GetPointerInput=function(t){var n=!1;if(e.InputController.input){var r="p:"+t.toString();null!=e.InputController.keymap[r]&&(n=e.InputController.keymap[r])}return n},t.IsWheelScrolling=function(){return 0!==e.InputController.scroll},t.OnGamepadButtonUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1ButtonUp.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonUp.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonUp.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonUp.push(t)}},t.OnGamepadButtonDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1ButtonDown.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonDown.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonDown.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonDown.push(t)}},t.OnGamepadButtonPress=function(t,n,r){if(void 0===r&&(r=e.PlayerNumber.One),e.InputController.input)switch(r){case e.PlayerNumber.One:e.InputController.gamepad1ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonPress.push({index:t,action:n})}},t.GetGamepadButtonInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var r=!1;if(e.InputController.input){var a=null;switch(n){case e.PlayerNumber.One:a="b1:"+t.toString();break;case e.PlayerNumber.Two:a="b2:"+t.toString();break;case e.PlayerNumber.Three:a="b3:"+t.toString();break;case e.PlayerNumber.Four:a="b4:"+t.toString()}null!=a&&null!=e.InputController.keymap[a]&&(r=e.InputController.keymap[a])}return r},t.OnGamepadDirectionUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1DpadUp.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadUp.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadUp.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadUp.push(t)}},t.OnGamepadDirectionDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1DpadDown.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadDown.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadDown.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadDown.push(t)}},t.OnGamepadDirectionPress=function(t,n,r){if(void 0===r&&(r=e.PlayerNumber.One),e.InputController.input)switch(r){case e.PlayerNumber.One:e.InputController.gamepad1DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadPress.push({index:t,action:n})}},t.GetGamepadDirectionInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var r=!1;if(e.InputController.input){var a=null;switch(n){case e.PlayerNumber.One:a="d1:"+t.toString();break;case e.PlayerNumber.Two:a="d2:"+t.toString();break;case e.PlayerNumber.Three:a="d3:"+t.toString();break;case e.PlayerNumber.Four:a="d4:"+t.toString()}null!=a&&null!=e.InputController.keymap[a]&&(r=e.InputController.keymap[a])}return r},t.OnGamepadTriggerLeft=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1LeftTrigger.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2LeftTrigger.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3LeftTrigger.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4LeftTrigger.push(t)}},t.OnGamepadTriggerRight=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1RightTrigger.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2RightTrigger.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3RightTrigger.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4RightTrigger.push(t)}},t.GetGamepadTriggerInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var r=0;if(e.InputController.input){var a=null;switch(n){case e.PlayerNumber.One:a="t1:"+t.toString();break;case e.PlayerNumber.Two:a="t2:"+t.toString();break;case e.PlayerNumber.Three:a="t3:"+t.toString();break;case e.PlayerNumber.Four:a="t4:"+t.toString()}null!=a&&null!=e.InputController.keymap[a]&&(r=e.InputController.keymap[a])}return r},t.GetGamepadType=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=e.GamepadType.None;if(e.InputController.input)switch(t){case e.PlayerNumber.One:n=e.InputController.gamepad1Type;break;case e.PlayerNumber.Two:n=e.InputController.gamepad2Type;break;case e.PlayerNumber.Three:n=e.InputController.gamepad3Type;break;case e.PlayerNumber.Four:n=e.InputController.gamepad4Type}return n},t.GetGamepad=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(e.InputController.input)switch(t){case e.PlayerNumber.One:n=e.InputController.gamepad1;break;case e.PlayerNumber.Two:n=e.InputController.gamepad2;break;case e.PlayerNumber.Three:n=e.InputController.gamepad3;break;case e.PlayerNumber.Four:n=e.InputController.gamepad4}return n},t.tickKeyboardInput=function(t){if(e.SceneManager.EnableUserInput!==!1){var n=e.InputController.GetKeyboardInput(e.UserInputKey.W)||e.InputController.GetKeyboardInput(e.UserInputKey.UpArrow),r=e.InputController.GetKeyboardInput(e.UserInputKey.A),a=e.InputController.GetKeyboardInput(e.UserInputKey.S)||e.InputController.GetKeyboardInput(e.UserInputKey.DownArrow),o=e.InputController.GetKeyboardInput(e.UserInputKey.D),l=e.InputController.GetKeyboardInput(e.UserInputKey.LeftArrow),i=e.InputController.GetKeyboardInput(e.UserInputKey.RightArrow);n===!0?e.InputController.k_vertical=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_vertical,1):a===!0?e.InputController.k_vertical=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_vertical,-1):e.InputController.k_vertical=0,e.UserInputOptions.UseArrowKeyRotation===!0?(o===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,1):r===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,-1):e.InputController.k_horizontal=0,i===!0?e.InputController.a_mousex=1:l===!0?e.InputController.a_mousex=-1:e.InputController.a_mousex=0):o===!0||i===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,1):r===!0||l===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,-1):e.InputController.k_horizontal=0}},t.updateUserInput=function(t){e.SceneManager.EnableUserInput!==!1&&(e.InputController.PointerLockedFlag=t.getEngine().isPointerLock,e.InputController.tickKeyboardInput(t),e.InputController.x_horizontal=0,e.InputController.x_vertical=0,e.InputController.x_mousex=0,e.InputController.x_mousey=0,0!==e.InputController.j_horizontal?e.InputController.x_horizontal=e.InputController.j_horizontal:0!==e.InputController.g_horizontal1?e.InputController.x_horizontal=e.InputController.g_horizontal1:0!==e.InputController.k_horizontal&&(e.InputController.x_horizontal=e.InputController.k_horizontal),0!==e.InputController.j_vertical?e.InputController.x_vertical=e.InputController.j_vertical:0!==e.InputController.g_vertical1?e.InputController.x_vertical=e.InputController.g_vertical1:0!==e.InputController.k_vertical&&(e.InputController.x_vertical=e.InputController.k_vertical),0!==e.InputController.j_mousex?e.InputController.x_mousex=e.InputController.j_mousex:0!==e.InputController.g_mousex1?e.InputController.x_mousex=e.InputController.g_mousex1:0!==e.InputController.a_mousex?e.InputController.x_mousex=e.InputController.a_mousex:0!==e.InputController.k_mousex&&(e.InputController.x_mousex=e.InputController.k_mousex),0!==e.InputController.j_mousey?e.InputController.x_mousey=e.InputController.j_mousey:0!==e.InputController.g_mousey1?e.InputController.x_mousey=e.InputController.g_mousey1:0!==e.InputController.k_mousey&&(e.InputController.x_mousey=e.InputController.k_mousey),e.InputController.horizontal=e.InputController.x_horizontal,e.InputController.vertical=e.InputController.x_vertical,e.InputController.mousex=e.InputController.x_mousex,e.InputController.mousey=e.InputController.x_mousey,e.InputController.scroll=e.InputController.x_scroll,e.InputController.wheel=e.InputController.x_wheel,e.InputController.horizontal2=e.InputController.g_horizontal2,e.InputController.vertical2=e.InputController.g_vertical2,e.InputController.mousex2=e.InputController.g_mousex2,e.InputController.mousey2=e.InputController.g_mousey2,e.InputController.horizontal3=e.InputController.g_horizontal3,e.InputController.vertical3=e.InputController.g_vertical3,e.InputController.mousex3=e.InputController.g_mousex3,e.InputController.mousey3=e.InputController.g_mousey3,e.InputController.horizontal4=e.InputController.g_horizontal4,e.InputController.vertical4=e.InputController.g_vertical4,e.InputController.mousex4=e.InputController.g_mousex4,e.InputController.mousey4=e.InputController.g_mousey4,e.InputController.k_mousex=0,e.InputController.k_mousey=0,e.InputController.x_mousey=0,e.InputController.x_scroll=0)},t.resetUserInput=function(){e.InputController.input=!1,e.InputController.keymap={},e.InputController.scroll=0,e.InputController.wheel=0,e.InputController.mousex=0,e.InputController.mousey=0,e.InputController.vertical=0,e.InputController.horizontal=0,e.InputController.mousex2=0,e.InputController.mousey2=0,e.InputController.vertical2=0,e.InputController.horizontal2=0,e.InputController.mousex3=0,e.InputController.mousey3=0,e.InputController.vertical3=0,e.InputController.horizontal3=0,e.InputController.mousex4=0,e.InputController.mousey4=0,e.InputController.vertical4=0,e.InputController.horizontal4=0,e.InputController.a_mousex=0,e.InputController.x_scroll=0,e.InputController.x_wheel=0,e.InputController.x_mousex=0,e.InputController.x_mousey=0,e.InputController.x_vertical=0,e.InputController.x_horizontal=0,e.InputController.k_mousex=0,e.InputController.k_mousey=0,e.InputController.k_vertical=0,e.InputController.k_horizontal=0,e.InputController.j_mousex=0,e.InputController.j_mousey=0,e.InputController.j_vertical=0,e.InputController.j_horizontal=0,e.InputController.g_mousex1=0,e.InputController.g_mousey1=0,e.InputController.g_vertical1=0,e.InputController.g_horizontal1=0,e.InputController.g_mousex2=0,e.InputController.g_mousey2=0,e.InputController.g_vertical2=0,e.InputController.g_horizontal2=0,e.InputController.g_mousex3=0,e.InputController.g_mousey3=0,e.InputController.g_vertical3=0,e.InputController.g_horizontal3=0,e.InputController.g_mousex4=0,e.InputController.g_mousey4=0,e.InputController.g_vertical4=0,e.InputController.g_horizontal4=0,e.InputController.preventDefault=!1,e.InputController.mouseButtonUp=[],e.InputController.mouseButtonDown=[],e.InputController.mouseButtonPress=[],e.InputController.keyButtonUp=[],e.InputController.keyButtonDown=[],e.InputController.keyButtonPress=[],e.InputController.gamepad1ButtonUp=[],e.InputController.gamepad1ButtonDown=[],e.InputController.gamepad1ButtonPress=[],e.InputController.gamepad1DpadUp=[],e.InputController.gamepad1DpadDown=[],e.InputController.gamepad1DpadPress=[],e.InputController.gamepad1LeftTrigger=[],e.InputController.gamepad1RightTrigger=[],e.InputController.gamepad2ButtonUp=[],e.InputController.gamepad2ButtonDown=[],e.InputController.gamepad2ButtonPress=[],e.InputController.gamepad2DpadUp=[],e.InputController.gamepad2DpadDown=[],e.InputController.gamepad2DpadPress=[],e.InputController.gamepad2LeftTrigger=[],e.InputController.gamepad2RightTrigger=[],e.InputController.gamepad3ButtonUp=[],e.InputController.gamepad3ButtonDown=[],e.InputController.gamepad3ButtonPress=[],e.InputController.gamepad3DpadUp=[],e.InputController.gamepad3DpadDown=[],e.InputController.gamepad3DpadPress=[],e.InputController.gamepad3LeftTrigger=[],e.InputController.gamepad3RightTrigger=[],e.InputController.gamepad4ButtonUp=[],e.InputController.gamepad4ButtonDown=[],e.InputController.gamepad4ButtonPress=[],e.InputController.gamepad4DpadUp=[],e.InputController.gamepad4DpadDown=[],e.InputController.gamepad4DpadPress=[],e.InputController.gamepad4LeftTrigger=[],e.InputController.gamepad4RightTrigger=[],e.InputController.previousPosition=null},t.resetKeyMapHandler=function(t){e.InputController.keymap={}},t.inputKeyDownHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n="k:"+t.keyCode.toString(),r=!1;return null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.keyButtonDown&&e.InputController.keyButtonDown.length>0&&e.InputController.keyButtonDown.forEach(function(e){e(t.keyCode)}),r||null!=e.InputController.keyButtonPress&&e.InputController.keyButtonPress.length>0&&e.InputController.keyButtonPress.forEach(function(e){e.index===t.keyCode&&e.action()}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputKeyUpHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n="k:"+t.keyCode.toString();return e.InputController.keymap[n]=!1,null!=e.InputController.keyButtonUp&&e.InputController.keyButtonUp.length>0&&e.InputController.keyButtonUp.forEach(function(e){e(t.keyCode)}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerWheelHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n=t.deltaY?-t.deltaY:t.wheelDelta/40;return e.InputController.x_scroll=1,e.InputController.x_wheel=Math.abs(n)>e.UserInputOptions.PointerWheelDeadZone?0+n:0,e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerDownHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;e.InputController.previousPosition={x:t.clientX,y:t.clientY};var n="p:"+t.button.toString(),r=!1;return null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.mouseButtonDown&&e.InputController.mouseButtonDown.length>0&&e.InputController.mouseButtonDown.forEach(function(e){e(t.button)}),r||null!=e.InputController.mouseButtonPress&&e.InputController.mouseButtonPress.length>0&&e.InputController.mouseButtonPress.forEach(function(e){e.index===t.button&&e.action()}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerUpHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;e.InputController.previousPosition=null,e.InputController.k_mousex=0,e.InputController.k_mousey=0;var n="p:"+t.button.toString();return e.InputController.keymap[n]=!1,null!=e.InputController.mouseButtonUp&&e.InputController.mouseButtonUp.length>0&&e.InputController.mouseButtonUp.forEach(function(e){e(t.button)}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerMoveHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;if(e.SceneManager.VirtualJoystickEnabled===!1){var n=0,r=0;e.InputController.IsPointerLocked()?(n=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,r=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0,e.InputController.previousPosition=null):null!=e.InputController.previousPosition&&(n=t.clientX-e.InputController.previousPosition.x,r=t.clientY-e.InputController.previousPosition.y,e.InputController.previousPosition={x:t.clientX,y:t.clientY}),e.UserInputOptions.PointerMouseInverted===!0&&(n*=-1,r*=-1),e.InputController.rightHanded&&(n*=-1);var a=n*e.UserInputOptions.PointerAngularSensibility*e.InputController.MOUSE_DAMPENER,o=r*e.UserInputOptions.PointerAngularSensibility*e.InputController.MOUSE_DAMPENER;Math.abs(n)<=e.UserInputOptions.PointerMouseDeadZone&&(a=0),Math.abs(r)<=e.UserInputOptions.PointerMouseDeadZone&&(o=0),a=e.Scalar.Clamp(a,-1,1),o=e.Scalar.Clamp(o,-1,1),e.InputController.k_mousex+=a,e.InputController.k_mousey+=o}return e.InputController.preventDefault&&t.preventDefault(),!0},t.inputOneButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="b1:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1ButtonDown&&e.InputController.gamepad1ButtonDown.length>0&&e.InputController.gamepad1ButtonDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad1ButtonPress&&e.InputController.gamepad1ButtonPress.length>0&&e.InputController.gamepad1ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="b1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1ButtonUp&&e.InputController.gamepad1ButtonUp.length>0&&e.InputController.gamepad1ButtonUp.forEach(function(e){e(t)})}},t.inputOneXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1DpadDown&&e.InputController.gamepad1DpadDown.length>0&&e.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad1DpadPress&&e.InputController.gamepad1DpadPress.length>0&&e.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1DpadDown&&e.InputController.gamepad1DpadDown.length>0&&e.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad1DpadPress&&e.InputController.gamepad1DpadPress.length>0&&e.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1DpadUp&&e.InputController.gamepad1DpadUp.length>0&&e.InputController.gamepad1DpadUp.forEach(function(e){e(t)})}},t.inputOneShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1DpadUp&&e.InputController.gamepad1DpadUp.length>0&&e.InputController.gamepad1DpadUp.forEach(function(e){e(t)})}},t.inputOneXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1&&(e.InputController.keymap["t1:0"]=t,null!=e.InputController.gamepad1LeftTrigger&&e.InputController.gamepad1LeftTrigger.length>0&&e.InputController.gamepad1LeftTrigger.forEach(function(e){e(t)}))},t.inputOneXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1&&(e.InputController.keymap["t1:1"]=t,null!=e.InputController.gamepad1RightTrigger&&e.InputController.gamepad1RightTrigger.length>0&&e.InputController.gamepad1RightTrigger.forEach(function(e){e(t)}))},t.inputOneLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n=t,r=n.x*e.UserInputOptions.GamepadLStickSensibility,a=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?a:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal1=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical1=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputOneRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n=t,r=n.x*e.UserInputOptions.GamepadRStickSensibility,a=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?a:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex1=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey1=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputTwoButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="b2:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2ButtonDown&&e.InputController.gamepad2ButtonDown.length>0&&e.InputController.gamepad2ButtonDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad2ButtonPress&&e.InputController.gamepad2ButtonPress.length>0&&e.InputController.gamepad2ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="b2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2ButtonUp&&e.InputController.gamepad2ButtonUp.length>0&&e.InputController.gamepad2ButtonUp.forEach(function(e){e(t)})}},t.inputTwoXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2DpadDown&&e.InputController.gamepad2DpadDown.length>0&&e.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad2DpadPress&&e.InputController.gamepad2DpadPress.length>0&&e.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2DpadDown&&e.InputController.gamepad2DpadDown.length>0&&e.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad2DpadPress&&e.InputController.gamepad2DpadPress.length>0&&e.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2DpadUp&&e.InputController.gamepad2DpadUp.length>0&&e.InputController.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2DpadUp&&e.InputController.gamepad2DpadUp.length>0&&e.InputController.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2&&(e.InputController.keymap["t2:0"]=t,null!=e.InputController.gamepad2LeftTrigger&&e.InputController.gamepad2LeftTrigger.length>0&&e.InputController.gamepad2LeftTrigger.forEach(function(e){e(t)}))},t.inputTwoXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2&&(e.InputController.keymap["t2:1"]=t,null!=e.InputController.gamepad2RightTrigger&&e.InputController.gamepad2RightTrigger.length>0&&e.InputController.gamepad2RightTrigger.forEach(function(e){
e(t)}))},t.inputTwoLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n=t,r=n.x*e.UserInputOptions.GamepadLStickSensibility,a=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?a:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal2=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical2=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputTwoRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n=t,r=n.x*e.UserInputOptions.GamepadRStickSensibility,a=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?a:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex2=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey2=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputThreeButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="b3:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3ButtonDown&&e.InputController.gamepad3ButtonDown.length>0&&e.InputController.gamepad3ButtonDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad3ButtonPress&&e.InputController.gamepad3ButtonPress.length>0&&e.InputController.gamepad3ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="b3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3ButtonUp&&e.InputController.gamepad3ButtonUp.length>0&&e.InputController.gamepad3ButtonUp.forEach(function(e){e(t)})}},t.inputThreeXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3DpadDown&&e.InputController.gamepad3DpadDown.length>0&&e.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad3DpadPress&&e.InputController.gamepad3DpadPress.length>0&&e.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3DpadDown&&e.InputController.gamepad3DpadDown.length>0&&e.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad3DpadPress&&e.InputController.gamepad3DpadPress.length>0&&e.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3DpadUp&&e.InputController.gamepad3DpadUp.length>0&&e.InputController.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3DpadUp&&e.InputController.gamepad3DpadUp.length>0&&e.InputController.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3&&(e.InputController.keymap["t3:0"]=t,null!=e.InputController.gamepad3LeftTrigger&&e.InputController.gamepad3LeftTrigger.length>0&&e.InputController.gamepad3LeftTrigger.forEach(function(e){e(t)}))},t.inputThreeXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3&&(e.InputController.keymap["t3:1"]=t,null!=e.InputController.gamepad3RightTrigger&&e.InputController.gamepad3RightTrigger.length>0&&e.InputController.gamepad3RightTrigger.forEach(function(e){e(t)}))},t.inputThreeLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n=t,r=n.x*e.UserInputOptions.GamepadLStickSensibility,a=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?a:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal3=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical3=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputThreeRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n=t,r=n.x*e.UserInputOptions.GamepadRStickSensibility,a=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?a:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex3=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey3=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputFourButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="b4:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4ButtonDown&&e.InputController.gamepad4ButtonDown.length>0&&e.InputController.gamepad4ButtonDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad4ButtonPress&&e.InputController.gamepad4ButtonPress.length>0&&e.InputController.gamepad4ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="b4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4ButtonUp&&e.InputController.gamepad4ButtonUp.length>0&&e.InputController.gamepad4ButtonUp.forEach(function(e){e(t)})}},t.inputFourXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4DpadDown&&e.InputController.gamepad4DpadDown.length>0&&e.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad4DpadPress&&e.InputController.gamepad4DpadPress.length>0&&e.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4DpadDown&&e.InputController.gamepad4DpadDown.length>0&&e.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad4DpadPress&&e.InputController.gamepad4DpadPress.length>0&&e.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4DpadUp&&e.InputController.gamepad4DpadUp.length>0&&e.InputController.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4DpadUp&&e.InputController.gamepad4DpadUp.length>0&&e.InputController.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4&&(e.InputController.keymap["t4:0"]=t,null!=e.InputController.gamepad4LeftTrigger&&e.InputController.gamepad4LeftTrigger.length>0&&e.InputController.gamepad4LeftTrigger.forEach(function(e){e(t)}))},t.inputFourXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4&&(e.InputController.keymap["t4:1"]=t,null!=e.InputController.gamepad4RightTrigger&&e.InputController.gamepad4RightTrigger.length>0&&e.InputController.gamepad4RightTrigger.forEach(function(e){e(t)}))},t.inputFourLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n=t,r=n.x*e.UserInputOptions.GamepadLStickSensibility,a=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?a:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal4=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical4=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputFourRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n=t,r=n.x*e.UserInputOptions.GamepadRStickSensibility,a=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?a:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex4=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey4=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputManagerGamepadConnected=function(t,n){if(null==e.InputController.gamepad1&&0===t.index)if(e.InputController.gamepad1=t,e.Tools.Log("Gamepad One Connected: "+e.InputController.gamepad1.id),e.InputController.gamepad1 instanceof e.Xbox360Pad){e.InputController.gamepad1Type=e.GamepadType.Xbox360;var r=e.InputController.gamepad1;r.onbuttonup(e.InputController.inputOneButtonUpHandler),r.onbuttondown(e.InputController.inputOneButtonDownHandler),r.onleftstickchanged(e.InputController.inputOneLeftStickHandler),r.onrightstickchanged(e.InputController.inputOneRightStickHandler),r.ondpadup(e.InputController.inputOneXboxDPadUpHandler),r.ondpaddown(e.InputController.inputOneXboxDPadDownHandler),r.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),r.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad1 instanceof e.DualShockPad){e.InputController.gamepad1Type=e.GamepadType.DualShock;var a=e.InputController.gamepad1;a.onbuttonup(e.InputController.inputOneButtonUpHandler),a.onbuttondown(e.InputController.inputOneButtonDownHandler),a.onleftstickchanged(e.InputController.inputOneLeftStickHandler),a.onrightstickchanged(e.InputController.inputOneRightStickHandler),a.ondpadup(e.InputController.inputOneShockDPadUpHandler),a.ondpaddown(e.InputController.inputOneShockDPadDownHandler),a.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),a.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad1 instanceof e.PoseEnabledController);else{e.InputController.gamepad1Type=e.GamepadType.Generic;var o=e.InputController.gamepad1;o.onbuttonup(e.InputController.inputOneButtonUpHandler),o.onbuttondown(e.InputController.inputOneButtonDownHandler),o.onleftstickchanged(e.InputController.inputOneLeftStickHandler),o.onrightstickchanged(e.InputController.inputOneRightStickHandler)}if(null==e.InputController.gamepad2&&1===t.index)if(e.InputController.gamepad2=t,e.Tools.Log("Gamepad Two Connected: "+e.InputController.gamepad2.id),e.InputController.gamepad2 instanceof e.Xbox360Pad){e.InputController.gamepad2Type=e.GamepadType.Xbox360;var l=e.InputController.gamepad2;l.onbuttonup(e.InputController.inputTwoButtonUpHandler),l.onbuttondown(e.InputController.inputTwoButtonDownHandler),l.onleftstickchanged(e.InputController.inputTwoLeftStickHandler),l.onrightstickchanged(e.InputController.inputTwoRightStickHandler),l.ondpadup(e.InputController.inputTwoXboxDPadUpHandler),l.ondpaddown(e.InputController.inputTwoXboxDPadDownHandler),l.onlefttriggerchanged(e.InputController.inputTwoXboxLeftTriggerHandler),l.onrighttriggerchanged(e.InputController.inputTwoXboxRightTriggerHandler)}else if(e.InputController.gamepad2 instanceof e.DualShockPad){e.InputController.gamepad2Type=e.GamepadType.DualShock;var i=e.InputController.gamepad2;i.onbuttonup(e.InputController.inputOneButtonUpHandler),i.onbuttondown(e.InputController.inputOneButtonDownHandler),i.onleftstickchanged(e.InputController.inputOneLeftStickHandler),i.onrightstickchanged(e.InputController.inputOneRightStickHandler),i.ondpadup(e.InputController.inputOneShockDPadUpHandler),i.ondpaddown(e.InputController.inputOneShockDPadDownHandler),i.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),i.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad2 instanceof e.PoseEnabledController);else{e.InputController.gamepad2Type=e.GamepadType.Generic;var s=e.InputController.gamepad2;s.onbuttonup(e.InputController.inputTwoButtonUpHandler),s.onbuttondown(e.InputController.inputTwoButtonDownHandler),s.onleftstickchanged(e.InputController.inputTwoLeftStickHandler),s.onrightstickchanged(e.InputController.inputTwoRightStickHandler)}if(null==e.InputController.gamepad3&&2===t.index)if(e.InputController.gamepad3=t,e.Tools.Log("Gamepad Three Connected: "+e.InputController.gamepad3.id),e.InputController.gamepad3 instanceof e.Xbox360Pad){e.InputController.gamepad3Type=e.GamepadType.Xbox360;var u=e.InputController.gamepad3;u.onbuttonup(e.InputController.inputThreeButtonUpHandler),u.onbuttondown(e.InputController.inputThreeButtonDownHandler),u.onleftstickchanged(e.InputController.inputThreeLeftStickHandler),u.onrightstickchanged(e.InputController.inputThreeRightStickHandler),u.ondpadup(e.InputController.inputThreeXboxDPadUpHandler),u.ondpaddown(e.InputController.inputThreeXboxDPadDownHandler),u.onlefttriggerchanged(e.InputController.inputThreeXboxLeftTriggerHandler),u.onrighttriggerchanged(e.InputController.inputThreeXboxRightTriggerHandler)}else if(e.InputController.gamepad3 instanceof e.DualShockPad){var d=e.InputController.gamepad3;d.onbuttonup(e.InputController.inputOneButtonUpHandler),d.onbuttondown(e.InputController.inputOneButtonDownHandler),d.onleftstickchanged(e.InputController.inputOneLeftStickHandler),d.onrightstickchanged(e.InputController.inputOneRightStickHandler),d.ondpadup(e.InputController.inputOneShockDPadUpHandler),d.ondpaddown(e.InputController.inputOneShockDPadDownHandler),d.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),d.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad3 instanceof e.PoseEnabledController);else{e.InputController.gamepad3Type=e.GamepadType.Generic;var p=e.InputController.gamepad3;p.onbuttonup(e.InputController.inputThreeButtonUpHandler),p.onbuttondown(e.InputController.inputThreeButtonDownHandler),p.onleftstickchanged(e.InputController.inputThreeLeftStickHandler),p.onrightstickchanged(e.InputController.inputThreeRightStickHandler)}if(null==e.InputController.gamepad4&&3===t.index)if(e.InputController.gamepad4=t,e.Tools.Log("Gamepad Four Connected: "+e.InputController.gamepad4.id),e.InputController.gamepad4 instanceof e.Xbox360Pad){e.InputController.gamepad4Type=e.GamepadType.Xbox360;var c=e.InputController.gamepad4;c.onbuttonup(e.InputController.inputFourButtonUpHandler),c.onbuttondown(e.InputController.inputFourButtonDownHandler),c.onleftstickchanged(e.InputController.inputFourLeftStickHandler),c.onrightstickchanged(e.InputController.inputFourRightStickHandler),c.ondpadup(e.InputController.inputFourXboxDPadUpHandler),c.ondpaddown(e.InputController.inputFourXboxDPadDownHandler),c.onlefttriggerchanged(e.InputController.inputFourXboxLeftTriggerHandler),c.onrighttriggerchanged(e.InputController.inputFourXboxRightTriggerHandler)}else if(e.InputController.gamepad4 instanceof e.DualShockPad){var m=e.InputController.gamepad4;m.onbuttonup(e.InputController.inputOneButtonUpHandler),m.onbuttondown(e.InputController.inputOneButtonDownHandler),m.onleftstickchanged(e.InputController.inputOneLeftStickHandler),m.onrightstickchanged(e.InputController.inputOneRightStickHandler),m.ondpadup(e.InputController.inputOneShockDPadUpHandler),m.ondpaddown(e.InputController.inputOneShockDPadDownHandler),m.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),m.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad4 instanceof e.PoseEnabledController);else{e.InputController.gamepad4Type=e.GamepadType.Generic;var f=e.InputController.gamepad4;f.onbuttonup(e.InputController.inputFourButtonUpHandler),f.onbuttondown(e.InputController.inputFourButtonDownHandler),f.onleftstickchanged(e.InputController.inputFourLeftStickHandler),f.onrightstickchanged(e.InputController.inputFourRightStickHandler)}null!=e.InputController.GamepadConnected&&e.InputController.GamepadConnected(t,n)},t.inputManagerGamepadDisconnected=function(t,n){null!=e.InputController.GamepadDisconnected&&e.InputController.GamepadDisconnected(t,n)},t.inputManagerLeftControllerMainButton=function(e,t){},t.inputManagerLeftControllerPadState=function(e,t){},t.inputManagerLeftControllerPadValues=function(e,t){},t.inputManagerLeftControllerAuxButton=function(e,t){},t.inputManagerLeftControllerTriggered=function(e,t){},t.inputManagerRightControllerMainButton=function(e,t){},t.inputManagerRightControllerPadState=function(e,t){},t.inputManagerRightControllerPadValues=function(e,t){},t.inputManagerRightControllerAuxButton=function(e,t){},t.inputManagerRightControllerTriggered=function(e,t){},t.inputManagerControllerConnected=function(e,t){},t.MOUSE_DAMPENER=.5,t.GamepadManager=null,t.GamepadConnected=null,t.GamepadDisconnected=null,t.PointerLockedFlag=!1,t.LockMousePointerObserver=null,t.input=!1,t.keymap={},t.scroll=0,t.wheel=0,t.mousex=0,t.mousey=0,t.vertical=0,t.horizontal=0,t.mousex2=0,t.mousey2=0,t.vertical2=0,t.horizontal2=0,t.mousex3=0,t.mousey3=0,t.vertical3=0,t.horizontal3=0,t.mousex4=0,t.mousey4=0,t.vertical4=0,t.horizontal4=0,t.a_mousex=0,t.x_scroll=0,t.x_wheel=0,t.x_mousex=0,t.x_mousey=0,t.x_vertical=0,t.x_horizontal=0,t.k_mousex=0,t.k_mousey=0,t.k_vertical=0,t.k_horizontal=0,t.j_mousex=0,t.j_mousey=0,t.j_vertical=0,t.j_horizontal=0,t.g_mousex1=0,t.g_mousey1=0,t.g_vertical1=0,t.g_horizontal1=0,t.g_mousex2=0,t.g_mousey2=0,t.g_vertical2=0,t.g_horizontal2=0,t.g_mousex3=0,t.g_mousey3=0,t.g_vertical3=0,t.g_horizontal3=0,t.g_mousex4=0,t.g_mousey4=0,t.g_vertical4=0,t.g_horizontal4=0,t.mouseButtonPress=[],t.mouseButtonDown=[],t.mouseButtonUp=[],t.keyButtonPress=[],t.keyButtonDown=[],t.keyButtonUp=[],t.previousPosition=null,t.preventDefault=!1,t.rightHanded=!0,t.gamepad1=null,t.gamepad1Type=-1,t.gamepad1ButtonPress=[],t.gamepad1ButtonDown=[],t.gamepad1ButtonUp=[],t.gamepad1DpadPress=[],t.gamepad1DpadDown=[],t.gamepad1DpadUp=[],t.gamepad1LeftTrigger=[],t.gamepad1RightTrigger=[],t.gamepad2=null,t.gamepad2Type=-1,t.gamepad2ButtonPress=[],t.gamepad2ButtonDown=[],t.gamepad2ButtonUp=[],t.gamepad2DpadPress=[],t.gamepad2DpadDown=[],t.gamepad2DpadUp=[],t.gamepad2LeftTrigger=[],t.gamepad2RightTrigger=[],t.gamepad3=null,t.gamepad3Type=-1,t.gamepad3ButtonPress=[],t.gamepad3ButtonDown=[],t.gamepad3ButtonUp=[],t.gamepad3DpadPress=[],t.gamepad3DpadDown=[],t.gamepad3DpadUp=[],t.gamepad3LeftTrigger=[],t.gamepad3RightTrigger=[],t.gamepad4=null,t.gamepad4Type=-1,t.gamepad4ButtonPress=[],t.gamepad4ButtonDown=[],t.gamepad4ButtonUp=[],t.gamepad4DpadPress=[],t.gamepad4DpadDown=[],t.gamepad4DpadUp=[],t.gamepad4LeftTrigger=[],t.gamepad4RightTrigger=[],t}();e.InputController=t;var n=function(){function e(e,t,n){var r=this;this.active=!1,this.touchId=null,this.dragStart=null,this.maxDistance=0,this.deadZone=0,this.xvalue=0,this.yvalue=0,this.stick=null,this.touchId=null,this.dragStart=null,this.active=!1,this.xvalue=0,this.yvalue=0,this.deadZone=n,this.maxDistance=t,this.stick=document.getElementById(e),null!=this.stick?(this.stick.addEventListener("mousedown",function(e){r.handleDown(e)}),this.stick.addEventListener("touchstart",function(e){r.handleDown(e)}),document.addEventListener("mousemove",function(e){r.handleMove(e)},{passive:!1}),document.addEventListener("touchmove",function(e){r.handleMove(e)},{passive:!1}),document.addEventListener("mouseup",function(e){r.handleUp(e)}),document.addEventListener("touchend",function(e){r.handleUp(e)})):console.warn("Failed to locate joystick element: "+e)}return e.prototype.getValueX=function(){return this.xvalue},e.prototype.getValueY=function(){return this.yvalue},e.prototype.getStickElement=function(){return this.stick},e.prototype.dispose=function(){},e.prototype.handleDown=function(e){this.active=!0,this.stick.style.transition="0s",e.preventDefault(),e.changedTouches?this.dragStart={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:this.dragStart={x:e.clientX,y:e.clientY},e.changedTouches&&(this.touchId=e.changedTouches[0].identifier)},e.prototype.handleMove=function(e){if(this.active){var t=null;if(e.changedTouches){for(var n=0;n<e.changedTouches.length;n++)this.touchId==e.changedTouches[n].identifier&&(t=n,e.clientX=e.changedTouches[n].clientX,e.clientY=e.changedTouches[n].clientY);if(null==t)return}var r=e.clientX-this.dragStart.x,a=e.clientY-this.dragStart.y,o=Math.atan2(a,r),l=Math.min(this.maxDistance,Math.hypot(r,a)),i=l*Math.cos(o),s=l*Math.sin(o);this.stick.style.transform="translate3d(".concat(i,"px, ").concat(s,"px, 0px)");var u=l<this.deadZone?0:this.maxDistance/(this.maxDistance-this.deadZone)*(l-this.deadZone),d=u*Math.cos(o),p=u*Math.sin(o),c=parseFloat((d/this.maxDistance).toFixed(4)),m=parseFloat((p/this.maxDistance).toFixed(4));this.xvalue=c,this.yvalue=m}},e.prototype.handleUp=function(e){this.active&&(e.changedTouches&&this.touchId!=e.changedTouches[0].identifier||(this.stick.style.transition=".2s",this.stick.style.transform="translate3d(0px, 0px, 0px)",this.xvalue=0,this.yvalue=0,this.touchId=null,this.active=!1))},e}();e.TouchJoystickHandler=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.IsWindows=function(){return"undefined"!=typeof Windows&&"undefined"!=typeof Windows.UI&&"undefined"!=typeof Windows.System&&"undefined"!=typeof Windows.Foundation},t.IsCordova=function(){return null!=window.cordova},t.IsWebAssembly=function(){return window.WebAssembly},t.IsOculusBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/OculusBrowser/i)&&(e=!0),e},t.IsSamsungBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/SamsungBrowser/i)&&(e=!0),e},t.IsWindowsPhone=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Windows Phone/i)&&(e=!0),e},t.IsBlackBerry=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/BlackBerry/i)&&(e=!0),e},t.IsOperaMini=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Opera Mini/i)&&(e=!0),e},t.IsAndroid=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Android/i)&&(e=!0),e},t.IsWebOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/webOS/i)&&(e=!0),e},t.IsIOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone|iPad|iPod/i)&&(e=!0),e},t.IsIPHONE=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone/i)&&(e=!0),e},t.IsIPAD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPad/i)&&(e=!0),e},t.IsIPOD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPod/i)&&(e=!0),e},t.IsIE11=function(){return void 0!==navigator.maxTouchPoints},t.IsMobile=function(){var e=!1;if(null!=navigator&&null!=navigator.userAgent){var t=navigator.userAgent;(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone|iPad|iPod/i)||t.match(/BlackBerry/i)||t.match(/Opera Mini/i)||t.match(/Windows Phone/i))&&(e=!0)}return e},t.IsPlaystation=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Playstation/i)&&(e=!0),e},t.IsXboxConsole=function(){var t=!1;if(e.WindowManager.IsWindows()&&"undefined"!=typeof Windows.System.Profile&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily){var n=Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily;n.match(/Xbox/i)&&(t=!0)}return t},t.IsXboxLive=function(){return e.WindowManager.IsWindows()&&"undefined"!=typeof Microsoft&&"undefined"!=typeof Microsoft.Xbox&&"undefined"!=typeof Microsoft.Xbox.Services},t.IsFrameWindow=function(){return null!=window.parent&&window!==window.parent},t.AlertMessage=function(t,n){void 0===n&&(n="Babylon.js");var r=null;return e.WindowManager.IsWindows()?r=new Windows.UI.Popups.MessageDialog(t,n).showAsync():window.alert(t),r},t.GetQueryStringParam=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),r=n.exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},t.PostWindowMessage=function(e,t,n){void 0===t&&(t="*"),void 0===n&&(n=!1),n===!0?window.postMessage(e,t):window.top?window.top.postMessage(e,t):console.warn("No Valid Top Window")},t.SetGameWindowState=function(t,n){null!=window.parent&&null!=window.parent.gameState?window.parent.gameState[t]=n:e.Tools.Warn("Game window required to set state for: "+t)},t.GetGameWindowState=function(t){var n=null;return null!=window.parent&&null!=window.parent.gameState&&null!=window.parent.gameState[t]?n=window.parent.gameState[t]:e.Tools.Warn("Game window required to get state for: "+t),null!=n?n:null},t.IsGameWindowEnabled=function(){return null!=window.parent&&null!=window.parent.setGameWindow},t.LoadSceneFile=function(t,n){if(void 0===n&&(n=null),e.WindowManager.IsGameWindowEnabled()){var r=window.location.protocol+"//"+window.location.host+window.location.pathname+"?scene="+t;null!=n&&""!==n&&(r+=n),null!=window.parent&&null!=window.parent.setGameWindow?window.parent.setGameWindow(r):e.Tools.Warn("Invalid set game window function found to load scene file: "+t)}else e.Tools.Warn("Game window required to load scene file: "+t)},t.PopupDebug=function(e){e.debugLayer&&(e.debugLayer.hide(),e.debugLayer.show({enablePopup:!0,globalRoot:null}))},t.ToggleDebug=function(t,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=null),t.debugLayer){var a=window;e.WindowManager.debugLayerVisible===!0?(e.WindowManager.debugLayerVisible=!1,a.METER&&a.METER.show&&a.METER.show(),t.debugLayer.hide()):(e.WindowManager.debugLayerVisible=!0,a.METER&&a.METER.hide&&a.METER.hide(),t.debugLayer.show({embedMode:n,globalRoot:r}))}},t.GetLocalStorageItem=function(e){return null!=window.localStorage?window.localStorage.getItem(e):null},t.SetLocalStorageItem=function(e,t){null!=window.localStorage&&window.localStorage.setItem(e,t)},t.GetSessionStorageItem=function(e){return null!=window.sessionStorage?window.sessionStorage.getItem(e):null},t.SetSessionStorageItem=function(e,t){null!=window.sessionStorage&&window.sessionStorage.setItem(e,t)},t.GetFilenameFromUrl=function(e){return e.substring(e.lastIndexOf("/")+1)},t.GetUrlParameter=function(e){var t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=n.exec(window.location.search);return null!==r?decodeURIComponent(r[1].replace(/\+/g," ")):null},t.GetVirtualRealityEnabled=function(){var t=e.WindowManager.GetLocalStorageItem("virtualReality");return null!=t&&"true"===t},t.SetVirtualRealityEnabled=function(t){e.WindowManager.SetLocalStorageItem("virtualReality",t.toString().toLowerCase())},t.SetWindowsLaunchMode=function(t){void 0===t&&(t=1),e.WindowManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationView&&(Windows.UI.ViewManagement.ApplicationView.preferredLaunchWindowingMode=t)},t.QuitWindowsApplication=function(){e.WindowManager.IsWindows()&&window.close()},t.PrintToScreen=function(t,n){if(void 0===n&&(n="white"),e.WindowManager.PrintElement=document.getElementById("print"),null==e.WindowManager.PrintElement){var r=document.createElement("div");r.id="print",r.style.position="absolute",r.style.left="6px",r.style.bottom="3px",r.style.fontSize="12px",r.style.zIndex="10000",r.style.color="#0c0",document.body.appendChild(r),e.WindowManager.PrintElement=r}null!=e.WindowManager.PrintElement&&e.WindowManager.PrintElement.innerHTML!==t&&(e.WindowManager.PrintElement.style.color!==n&&(e.WindowManager.PrintElement.style.color=n),e.WindowManager.PrintElement.innerHTML=t)},t.debugLayerVisible=!1,t.PrintElement=null,t}();e.WindowManager=t}(BABYLON||(BABYLON={})),BABYLON.WindowManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow&&Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow),BABYLON.WindowManager.IsXboxConsole()&&navigator.gamepadInputEmulation&&(navigator.gamepadInputEmulation="gamepad");var WM=BABYLON.WindowManager;