!function(i){var e;function t(){}e=i.Toolkit||(i.Toolkit={}),t.IsWindows=function(){return"undefined"!=typeof Windows&&void 0!==Windows.UI&&void 0!==Windows.System&&void 0!==Windows.Foundation},t.IsCordova=function(){return null!=window.cordova},t.IsWebAssembly=function(){return window.WebAssembly},t.IsOculusBrowser=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/OculusBrowser/i)?!0:e},t.IsSamsungBrowser=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/SamsungBrowser/i)?!0:e},t.IsWindowsPhone=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Windows Phone/i)?!0:e},t.IsBlackBerry=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/BlackBerry/i)?!0:e},t.IsOperaMini=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Opera Mini/i)?!0:e},t.IsAndroid=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Android/i)?!0:e},t.IsWebOS=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/webOS/i)?!0:e},t.IsIOS=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone|iPad|iPod/i)?!0:e},t.IsIPHONE=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone/i)?!0:e},t.IsIPAD=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPad/i)?!0:e},t.IsIPOD=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPod/i)?!0:e},t.IsIE11=function(){return void 0!==navigator.maxTouchPoints},t.IsMobile=function(){var e,t=!1;return t=null!=navigator&&null!=navigator.userAgent&&((e=navigator.userAgent).match(/Android/i)||e.match(/webOS/i)||e.match(/iPhone|iPad|iPod/i)||e.match(/BlackBerry/i)||e.match(/Opera Mini/i)||e.match(/Windows Phone/i))?!0:t},t.IsPlaystation=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Playstation/i)?!0:e},t.IsXboxConsole=function(){var e=!1;return e=i.Toolkit.WindowManager.IsWindows()&&void 0!==Windows.System.Profile&&void 0!==Windows.System.Profile.AnalyticsInfo&&void 0!==Windows.System.Profile.AnalyticsInfo.versionInfo&&void 0!==Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily&&Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily.match(/Xbox/i)?!0:e},t.IsXboxLive=function(){return i.Toolkit.WindowManager.IsWindows()&&"undefined"!=typeof Microsoft&&void 0!==Microsoft.Xbox&&void 0!==Microsoft.Xbox.Services},t.IsFrameWindow=function(){return null!=window.parent&&window!==window.parent},t.IsPortraitWindow=function(){return"portrait"===i.Toolkit.WindowManager.GetOrientation()},t.IsLandscapeWindow=function(){return"landscape"===i.Toolkit.WindowManager.GetOrientation()},t.IsStandaloneWindow=function(){return!!window.navigator.standalone||!(!window.matchMedia||!window.matchMedia("(display-mode: standalone)").matches)},t.IsFullscreenWindow=function(){return!!window.navigator.standalone||!(!window.matchMedia||!window.matchMedia("(display-mode: fullscreen)").matches)},t.IsProgressiveWindow=function(){return i.Toolkit.WindowManager.IsStandaloneWindow()||i.Toolkit.WindowManager.IsFullscreenWindow()},t.GetDisplayMode=function(){if(window.navigator.standalone)return"standalone";if(window.matchMedia){if(window.matchMedia("(display-mode: fullscreen)").matches)return"fullscreen";if(window.matchMedia("(display-mode: standalone)").matches)return"standalone";if(window.matchMedia("(display-mode: minimal-ui)").matches)return"minimal-ui"}return"browser"},t.GetOrientation=function(){var e,t="portrait";return screen&&screen.orientation?(e=screen.orientation.type).includes("portrait")?t="portrait":e.includes("landscape")&&(t="landscape"):window&&window.orientation&&(0===(e=window.orientation)||180===e?t="portrait":90!==e&&-90!==e||(t="landscape")),t},t.AlertMessage=function(e,t){void 0===t&&(t="Babylon Toolkit");var o=null;return i.Toolkit.WindowManager.IsWindows()?o=new Windows.UI.Popups.MessageDialog(e,t).showAsync():window.alert(e),o},t.GetQueryStringParam=function(e,t){t=t||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");e=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null},t.GetTimeMilliseconds=function(){var e=0;return null!=window.performance?e=window.performance.now():null!=window.Date&&(e=Date.now()),e},t.PostWindowMessage=function(e,t,o){void 0===t&&(t="*"),!0===(o=void 0===o?!1:o)?window.postMessage(e,t):window.top?window.top.postMessage(e,t):console.warn("No Valid Top Window")},t.LoadLevel=function(e,t){var o;return void 0===t&&(t=null),window&&null!=window.BJS&&"engine.html"===window.BJS?(o=window.location.protocol+"//"+window.location.host+":"+window.location.port+window.location.pathname+"?scene="+e,null!=t&&""!==t&&(o+=t),window.location.replace(o)):i.Tools.Warn("Scene viewer engine.html required to load level: "+e),!1},t.ShowSceneLoader=function(){window.showSceneLoader&&window.showSceneLoader()},t.HideSceneLoader=function(){window.hideSceneLoader&&window.hideSceneLoader()},t.UpdateLoaderStatus=function(e,t,o){window.updateStatus&&window.updateStatus(e,t,o)},t.UpdateLoaderDetails=function(e,t){window.updateDetails&&window.updateDetails(e,t)},t.UpdateLoaderProgress=function(e,t){window.updateProgress&&window.updateProgress(e,t)},t.ShowPageErrorMessage=function(e,t,o){void 0===t&&(t="Error"),void 0===o&&(o=0),window.showErrorMessage&&window.showErrorMessage(e,t,o)},t.SetTimeout=function(e,t){return window.setTimeout(t,e)},t.ClearTimeout=function(e){window.clearTimeout(e)},t.SetInterval=function(e,t){return window.setInterval(t,e)},t.ClearInterval=function(e){window.clearInterval(e)},t.Atob=function(e){return window.atob(e)},t.Btoa=function(e){return window.btoa(e)},t.PopupDebug=function(e){e.debugLayer&&(e.debugLayer.hide(),e.debugLayer.show({enablePopup:!0,globalRoot:null}))},t.ToggleDebug=function(e,t,o){var n;void 0===t&&(t=!1),void 0===o&&(o=null),e.debugLayer&&(n=window,!0===i.Toolkit.WindowManager.debugLayerVisible?(i.Toolkit.WindowManager.debugLayerVisible=!1,n.METER&&n.METER.show&&n.METER.show(),e.debugLayer.hide()):(i.Toolkit.WindowManager.debugLayerVisible=!0,n.METER&&n.METER.hide&&n.METER.hide(),e.debugLayer.show({embedMode:t,globalRoot:o})))},t.GetLocalStorageItem=function(e){return null!=window.localStorage?window.localStorage.getItem(e):null},t.SetLocalStorageItem=function(e,t){null!=window.localStorage&&window.localStorage.setItem(e,t)},t.GetSessionStorageItem=function(e){return null!=window.sessionStorage?window.sessionStorage.getItem(e):null},t.SetSessionStorageItem=function(e,t){null!=window.sessionStorage&&window.sessionStorage.setItem(e,t)},t.GetFilenameFromUrl=function(e){return e.substring(e.lastIndexOf("/")+1)},t.GetUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null!==e?decodeURIComponent(e[1].replace(/\+/g," ")):null},t.GetVirtualRealityEnabled=function(){var e=i.Toolkit.WindowManager.GetLocalStorageItem("virtualReality");return null!=e&&"true"===e},t.SetVirtualRealityEnabled=function(e){i.Toolkit.WindowManager.SetLocalStorageItem("virtualReality",e.toString().toLowerCase())},t.SetWindowsLaunchMode=function(e){void 0===e&&(e=1),i.Toolkit.WindowManager.IsWindows()&&void 0!==Windows.UI.ViewManagement&&void 0!==Windows.UI.ViewManagement.ApplicationView&&(Windows.UI.ViewManagement.ApplicationView.preferredLaunchWindowingMode=e)},t.QuitWindowsApplication=function(){i.Toolkit.WindowManager.IsWindows()&&window.close()},t.PrintToScreen=function(e,t){var o;void 0===t&&(t="white"),i.Toolkit.WindowManager.PrintElement=document.getElementById("print"),null==i.Toolkit.WindowManager.PrintElement&&((o=document.createElement("div")).id="print",o.style.position="absolute",o.style.left="6px",o.style.bottom="3px",o.style.fontSize="12px",o.style.zIndex="10000",o.style.color="#0c0",o.style.pointerEvents="none",document.body.appendChild(o),i.Toolkit.WindowManager.PrintElement=o),null!=i.Toolkit.WindowManager.PrintElement&&i.Toolkit.WindowManager.PrintElement.innerHTML!==e&&(i.Toolkit.WindowManager.PrintElement.style.color!==t&&(i.Toolkit.WindowManager.PrintElement.style.color=t),i.Toolkit.WindowManager.PrintElement.innerHTML=e)},t.debugLayerVisible=!1,t.PrintElement=null,e.WindowManager=t}(BABYLON=BABYLON||{}),BABYLON.Toolkit.WindowManager.IsWindows()&&void 0!==Windows.UI.ViewManagement&&void 0!==Windows.UI.ViewManagement.ApplicationViewBoundsMode&&void 0!==Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow&&Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow),BABYLON.Toolkit.WindowManager.IsXboxConsole()&&navigator.gamepadInputEmulation&&(navigator.gamepadInputEmulation="gamepad");var SIMPLEX,BABYLON,WM=BABYLON.Toolkit.WindowManager,IC=(!function(a){var e;function t(){}function o(e,t,o){var n=this;this.active=!1,this.touchId=null,this.dragStart=null,this.maxDistance=0,this.deadZone=0,this.xvalue=0,this.yvalue=0,this.stick=null,this.touchId=null,this.dragStart=null,this.active=!1,this.xvalue=0,this.yvalue=0,this.deadZone=o,this.maxDistance=t,this.stick=document.getElementById(e),null!=this.stick?(this.stick.addEventListener("mousedown",function(e){n.handleDown(e)}),this.stick.addEventListener("touchstart",function(e){n.handleDown(e)}),document.addEventListener("mousemove",function(e){n.handleMove(e)},{passive:!1}),document.addEventListener("touchmove",function(e){n.handleMove(e)},{passive:!1}),document.addEventListener("mouseup",function(e){n.handleUp(e)}),document.addEventListener("touchend",function(e){n.handleUp(e)})):console.warn("Failed to locate joystick element: "+e)}e=a.Toolkit||(a.Toolkit={}),t.GetMouseButtonsDown=function(){return a.Toolkit.InputController.mouseButtonsDown},t.GetLeftButtonDown=function(){return a.Toolkit.InputController.leftButtonDown},t.GetMiddleButtonDown=function(){return a.Toolkit.InputController.middleButtonDown},t.GetRightButtonDown=function(){return a.Toolkit.InputController.rightButtonDown},t.ConfigureUserInput=function(e,t,o){var n=null==(o=void 0===o?null:o)||null==o.contextMenu||o.contextMenu,i=null!=o&&null!=o.pointerLock&&o.pointerLock,l=null!=o&&null!=o.preventDefault&&o.preventDefault,o=null!=o&&null!=o.useCapture&&o.useCapture;a.Toolkit.InputController.resetUserInput(),a.Toolkit.InputController.input||(document.documentElement.tabIndex=1,document.documentElement.addEventListener("keyup",a.Toolkit.InputController.inputKeyUpHandler,o),document.documentElement.addEventListener("pointerup",a.Toolkit.InputController.inputPointerUpHandler,o),null!=(e=document.getElementById("renderingCanvas")||e.getRenderingCanvas())&&(!0===n?(a.Tools.Log("Canvas element context menu enabled."),e.oncontextmenu=null):(e.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation()},a.Tools.Log("Canvas element context menu disabled."))),(!0===a.Toolkit.UserInputOptions.UseCanvasElement?(e.tabIndex=2,e.addEventListener("focusout",a.Toolkit.InputController.resetKeyMapHandler,o),e.addEventListener("keydown",a.Toolkit.InputController.inputKeyDownHandler,o),e.addEventListener("pointerdown",a.Toolkit.InputController.inputPointerDownHandler,o),e.addEventListener("pointermove",a.Toolkit.InputController.inputPointerMoveHandler,o),e):(document.documentElement.addEventListener("focusout",a.Toolkit.InputController.resetKeyMapHandler,o),document.documentElement.addEventListener("keydown",a.Toolkit.InputController.inputKeyDownHandler,o),document.documentElement.addEventListener("pointerdown",a.Toolkit.InputController.inputPointerDownHandler,o),document.documentElement.addEventListener("pointermove",a.Toolkit.InputController.inputPointerMoveHandler,o),document.documentElement)).addEventListener("onwheel"in document?"wheel":"mousewheel",a.Toolkit.InputController.inputPointerWheelHandler,o),a.Toolkit.InputController.preventDefault=l,null==a.Toolkit.InputController.GamepadManager&&(a.Toolkit.InputController.GamepadManager=new a.GamepadManager,a.Toolkit.InputController.GamepadManager.onGamepadConnectedObservable.add(a.Toolkit.InputController.inputManagerGamepadConnected),a.Toolkit.InputController.GamepadManager.onGamepadDisconnectedObservable.add(a.Toolkit.InputController.inputManagerGamepadDisconnected)),a.Toolkit.InputController.input=!0,document.documentElement.focus(),!0===i&&a.Toolkit.InputController.LockMousePointer(t,!0)),t.registerAfterRender(function(){a.Toolkit.InputController.updateUserInput(t)})},t.SetLeftJoystickBuffer=function(e,t,o){void 0===o&&(o=!0),a.Toolkit.InputController.j_horizontal=e,a.Toolkit.InputController.j_vertical=!0===o?-t:t},t.SetRightJoystickBuffer=function(e,t,o){void 0===o&&(o=!0),a.Toolkit.InputController.j_mousex=e,a.Toolkit.InputController.j_mousey=!0===o?-t:t},t.DisableUserInput=function(e,t){void 0===t&&(t=!1),a.Toolkit.InputController.LockMousePointer(e,!1),a.Toolkit.InputController.resetUserInput()},t.LockMousePointer=function(o,e){!0===e?a.Toolkit.InputController.LockMousePointerObserver=o.onPointerObservable.add(function(e,t){e.type!=a.PointerEventTypes.POINTERDOWN||document.pointerLockElement||null!=(e=a.Toolkit.SceneManager.GetEngine(o))&&e.enterPointerlock()}):a.Toolkit.InputController.IsPointerLockHandled()&&(o.onPointerObservable.remove(a.Toolkit.InputController.LockMousePointerObserver),a.Toolkit.InputController.LockMousePointerObserver=null)},t.IsPointerLocked=function(){return a.Toolkit.InputController.PointerLockedFlag},t.IsPointerLockHandled=function(){return null!=a.Toolkit.InputController.LockMousePointerObserver},t.GetUserInput=function(e,t){void 0===t&&(t=a.Toolkit.PlayerNumber.One);var o=0;if(a.Toolkit.InputController.input)switch(e){case a.Toolkit.UserInputAxis.Vertical:case a.Toolkit.UserInputAxis.Horizontal:o=t===a.Toolkit.PlayerNumber.Four?e===a.Toolkit.UserInputAxis.Horizontal?a.Toolkit.InputController.horizontal4:a.Toolkit.InputController.vertical4:t===a.Toolkit.PlayerNumber.Three?e===a.Toolkit.UserInputAxis.Horizontal?a.Toolkit.InputController.horizontal3:a.Toolkit.InputController.vertical3:t===a.Toolkit.PlayerNumber.Two?e===a.Toolkit.UserInputAxis.Horizontal?a.Toolkit.InputController.horizontal2:a.Toolkit.InputController.vertical2:e===a.Toolkit.UserInputAxis.Horizontal?a.Toolkit.InputController.horizontal:a.Toolkit.InputController.vertical;break;case a.Toolkit.UserInputAxis.MouseX:case a.Toolkit.UserInputAxis.MouseY:o=t===a.Toolkit.PlayerNumber.Four?e===a.Toolkit.UserInputAxis.MouseX?a.Toolkit.InputController.mousex4:a.Toolkit.InputController.mousey4:t===a.Toolkit.PlayerNumber.Three?e===a.Toolkit.UserInputAxis.MouseX?a.Toolkit.InputController.mousex3:a.Toolkit.InputController.mousey3:t===a.Toolkit.PlayerNumber.Two?e===a.Toolkit.UserInputAxis.MouseX?a.Toolkit.InputController.mousex2:a.Toolkit.InputController.mousey2:e===a.Toolkit.UserInputAxis.MouseX?a.Toolkit.InputController.mousex:a.Toolkit.InputController.mousey;break;case a.Toolkit.UserInputAxis.Wheel:t===a.Toolkit.PlayerNumber.One&&(o=a.Toolkit.InputController.wheel)}return o},t.OnKeyboardUp=function(e){a.Toolkit.InputController.input&&a.Toolkit.InputController.keyButtonUp.push(e)},t.OnKeyboardDown=function(e){a.Toolkit.InputController.input&&a.Toolkit.InputController.keyButtonDown.push(e)},t.OnKeyboardPress=function(e,t){a.Toolkit.InputController.input&&a.Toolkit.InputController.keyButtonPress.push({index:e,action:t})},t.GetKeyboardInput=function(e){var t=!1;return t=a.Toolkit.InputController.input&&(e="k:"+e.toString(),null!=a.Toolkit.InputController.keymap[e])?null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result:t},t.IsKeyboardButtonHeld=function(e){var t=!1;return t=a.Toolkit.InputController.input&&(e="k:"+e.toString(),null!=a.Toolkit.InputController.keymap[e])&&null!=(e=a.Toolkit.InputController.keymap[e]).pressTime&&null!=e.releaseTime&&!0===(null!=e.result&&e.result)&&0<e.pressTime&&0===e.releaseTime?a.Toolkit.SceneManager.GetTimeMs()-e.pressTime>=a.Toolkit.InputController.TAP_THRESHOLD_MS:t},t.IsKeyboardButtonTapped=function(e){var t=!1;return t=a.Toolkit.InputController.input&&(e="k:"+e.toString(),null!=a.Toolkit.InputController.keymap[e])&&null!=(e=a.Toolkit.InputController.keymap[e]).pressTime&&null!=e.releaseTime&&!1===(null!=e.result&&e.result)&&0<e.pressTime&&0<e.releaseTime?e.releaseTime-e.pressTime<a.Toolkit.InputController.TAP_THRESHOLD_MS:t},t.ResetKeyboardButtonTapped=function(e){a.Toolkit.InputController.input&&(e="k:"+e.toString(),null!=a.Toolkit.InputController.keymap[e])&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0})},t.OnPointerUp=function(e){a.Toolkit.InputController.input&&a.Toolkit.InputController.mouseButtonUp.push(e)},t.OnPointerDown=function(e){a.Toolkit.InputController.input&&a.Toolkit.InputController.mouseButtonDown.push(e)},t.OnPointerPress=function(e,t){a.Toolkit.InputController.input&&a.Toolkit.InputController.mouseButtonPress.push({index:e,action:t})},t.GetPointerInput=function(e){var t=!1;return t=a.Toolkit.InputController.input&&(e="p:"+e.toString(),null!=a.Toolkit.InputController.keymap[e])?null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result:t},t.IsPointerButtonHeld=function(e){var t=!1;return t=a.Toolkit.InputController.input&&(e="p:"+e.toString(),null!=a.Toolkit.InputController.keymap[e])&&null!=(e=a.Toolkit.InputController.keymap[e]).pressTime&&null!=e.releaseTime&&!0===(null!=e.result&&e.result)&&0<e.pressTime&&0===e.releaseTime?a.Toolkit.SceneManager.GetTimeMs()-e.pressTime>=a.Toolkit.InputController.TAP_THRESHOLD_MS:t},t.IsPointerButtonTapped=function(e){var t=!1;return t=a.Toolkit.InputController.input&&(e="p:"+e.toString(),null!=a.Toolkit.InputController.keymap[e])&&null!=(e=a.Toolkit.InputController.keymap[e]).pressTime&&null!=e.releaseTime&&!1===(null!=e.result&&e.result)&&0<e.pressTime&&0<e.releaseTime?e.releaseTime-e.pressTime<a.Toolkit.InputController.TAP_THRESHOLD_MS:t},t.ResetPointerButtonTapped=function(e){a.Toolkit.InputController.input&&(e="p:"+e.toString(),null!=a.Toolkit.InputController.keymap[e])&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0})},t.IsWheelScrolling=function(){return 0!==a.Toolkit.InputController.scroll},t.OnGamepadButtonUp=function(e,t){if(void 0===t&&(t=a.Toolkit.PlayerNumber.One),a.Toolkit.InputController.input)switch(t){case a.Toolkit.PlayerNumber.One:a.Toolkit.InputController.gamepad1ButtonUp.push(e);break;case a.Toolkit.PlayerNumber.Two:a.Toolkit.InputController.gamepad2ButtonUp.push(e);break;case a.Toolkit.PlayerNumber.Three:a.Toolkit.InputController.gamepad3ButtonUp.push(e);break;case a.Toolkit.PlayerNumber.Four:a.Toolkit.InputController.gamepad4ButtonUp.push(e)}},t.OnGamepadButtonDown=function(e,t){if(void 0===t&&(t=a.Toolkit.PlayerNumber.One),a.Toolkit.InputController.input)switch(t){case a.Toolkit.PlayerNumber.One:a.Toolkit.InputController.gamepad1ButtonDown.push(e);break;case a.Toolkit.PlayerNumber.Two:a.Toolkit.InputController.gamepad2ButtonDown.push(e);break;case a.Toolkit.PlayerNumber.Three:a.Toolkit.InputController.gamepad3ButtonDown.push(e);break;case a.Toolkit.PlayerNumber.Four:a.Toolkit.InputController.gamepad4ButtonDown.push(e)}},t.OnGamepadButtonPress=function(e,t,o){if(void 0===o&&(o=a.Toolkit.PlayerNumber.One),a.Toolkit.InputController.input)switch(o){case a.Toolkit.PlayerNumber.One:a.Toolkit.InputController.gamepad1ButtonPress.push({index:e,action:t});break;case a.Toolkit.PlayerNumber.Two:a.Toolkit.InputController.gamepad2ButtonPress.push({index:e,action:t});break;case a.Toolkit.PlayerNumber.Three:a.Toolkit.InputController.gamepad3ButtonPress.push({index:e,action:t});break;case a.Toolkit.PlayerNumber.Four:a.Toolkit.InputController.gamepad4ButtonPress.push({index:e,action:t})}},t.GetGamepadButtonInput=function(e,t){void 0===t&&(t=a.Toolkit.PlayerNumber.One);var o=!1;if(a.Toolkit.InputController.input){var n=null;switch(t){case a.Toolkit.PlayerNumber.One:n="b1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:n="b2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:n="b3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:n="b4:"+e.toString()}null!=n&&null!=a.Toolkit.InputController.keymap[n]&&(o=null!=(t=a.Toolkit.InputController.keymap[n]).result&&t.result)}return o},t.IsGamepadButtonHeld=function(e,t){void 0===t&&(t=a.Toolkit.PlayerNumber.One);var o=!1;if(a.Toolkit.InputController.input){var n=null;switch(t){case a.Toolkit.PlayerNumber.One:n="b1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:n="b2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:n="b3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:n="b4:"+e.toString()}null!=n&&null!=a.Toolkit.InputController.keymap[n]&&null!=(t=a.Toolkit.InputController.keymap[n]).pressTime&&null!=t.releaseTime&&!0===(null!=t.result&&t.result)&&0<t.pressTime&&0===t.releaseTime&&(o=a.Toolkit.SceneManager.GetTimeMs()-t.pressTime>=a.Toolkit.InputController.TAP_THRESHOLD_MS)}return o},t.IsGamepadButtonTapped=function(e,t){void 0===t&&(t=a.Toolkit.PlayerNumber.One);var o=!1;if(a.Toolkit.InputController.input){var n=null;switch(t){case a.Toolkit.PlayerNumber.One:n="b1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:n="b2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:n="b3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:n="b4:"+e.toString()}null!=n&&null!=a.Toolkit.InputController.keymap[n]&&null!=(t=a.Toolkit.InputController.keymap[n]).pressTime&&null!=t.releaseTime&&!1===(null!=t.result&&t.result)&&0<t.pressTime&&0<t.releaseTime&&(o=t.releaseTime-t.pressTime<a.Toolkit.InputController.TAP_THRESHOLD_MS)}return o},t.ResetGamepadButtonTapped=function(e,t){if(void 0===t&&(t=a.Toolkit.PlayerNumber.One),a.Toolkit.InputController.input){var o=null;switch(t){case a.Toolkit.PlayerNumber.One:o="b1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:o="b2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:o="b3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:o="b4:"+e.toString()}null!=o&&null!=a.Toolkit.InputController.keymap[o]&&(a.Toolkit.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0})}},t.OnGamepadDirectionUp=function(e,t){if(void 0===t&&(t=a.Toolkit.PlayerNumber.One),a.Toolkit.InputController.input)switch(t){case a.Toolkit.PlayerNumber.One:a.Toolkit.InputController.gamepad1DpadUp.push(e);break;case a.Toolkit.PlayerNumber.Two:a.Toolkit.InputController.gamepad2DpadUp.push(e);break;case a.Toolkit.PlayerNumber.Three:a.Toolkit.InputController.gamepad3DpadUp.push(e);break;case a.Toolkit.PlayerNumber.Four:a.Toolkit.InputController.gamepad4DpadUp.push(e)}},t.OnGamepadDirectionDown=function(e,t){if(void 0===t&&(t=a.Toolkit.PlayerNumber.One),a.Toolkit.InputController.input)switch(t){case a.Toolkit.PlayerNumber.One:a.Toolkit.InputController.gamepad1DpadDown.push(e);break;case a.Toolkit.PlayerNumber.Two:a.Toolkit.InputController.gamepad2DpadDown.push(e);break;case a.Toolkit.PlayerNumber.Three:a.Toolkit.InputController.gamepad3DpadDown.push(e);break;case a.Toolkit.PlayerNumber.Four:a.Toolkit.InputController.gamepad4DpadDown.push(e)}},t.OnGamepadDirectionPress=function(e,t,o){if(void 0===o&&(o=a.Toolkit.PlayerNumber.One),a.Toolkit.InputController.input)switch(o){case a.Toolkit.PlayerNumber.One:a.Toolkit.InputController.gamepad1DpadPress.push({index:e,action:t});break;case a.Toolkit.PlayerNumber.Two:a.Toolkit.InputController.gamepad2DpadPress.push({index:e,action:t});break;case a.Toolkit.PlayerNumber.Three:a.Toolkit.InputController.gamepad3DpadPress.push({index:e,action:t});break;case a.Toolkit.PlayerNumber.Four:a.Toolkit.InputController.gamepad4DpadPress.push({index:e,action:t})}},t.GetGamepadDirectionInput=function(e,t){void 0===t&&(t=a.Toolkit.PlayerNumber.One);var o=!1;if(a.Toolkit.InputController.input){var n=null;switch(t){case a.Toolkit.PlayerNumber.One:n="d1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:n="d2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:n="d3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:n="d4:"+e.toString()}null!=n&&null!=a.Toolkit.InputController.keymap[n]&&(o=null!=(t=a.Toolkit.InputController.keymap[n]).result&&t.result)}return o},t.IsGamepadDirectionHeld=function(e,t){void 0===t&&(t=a.Toolkit.PlayerNumber.One);var o=!1;if(a.Toolkit.InputController.input){var n=null;switch(t){case a.Toolkit.PlayerNumber.One:n="d1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:n="d2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:n="d3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:n="d4:"+e.toString()}null!=n&&null!=a.Toolkit.InputController.keymap[n]&&null!=(t=a.Toolkit.InputController.keymap[n]).pressTime&&null!=t.releaseTime&&!0===(null!=t.result&&t.result)&&0<t.pressTime&&0===t.releaseTime&&(o=a.Toolkit.SceneManager.GetTimeMs()-t.pressTime>=a.Toolkit.InputController.TAP_THRESHOLD_MS)}return o},t.IsGamepadDirectionTapped=function(e,t){void 0===t&&(t=a.Toolkit.PlayerNumber.One);var o=!1;if(a.Toolkit.InputController.input){var n=null;switch(t){case a.Toolkit.PlayerNumber.One:n="d1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:n="d2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:n="d3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:n="d4:"+e.toString()}null!=n&&null!=a.Toolkit.InputController.keymap[n]&&null!=(t=a.Toolkit.InputController.keymap[n]).pressTime&&null!=t.releaseTime&&!1===(null!=t.result&&t.result)&&0<t.pressTime&&0<t.releaseTime&&(o=t.releaseTime-t.pressTime<a.Toolkit.InputController.TAP_THRESHOLD_MS)}return o},t.ResetGamepadDirectionTapped=function(e,t){void 0===t&&(t=a.Toolkit.PlayerNumber.One);if(a.Toolkit.InputController.input){var o=null;switch(t){case a.Toolkit.PlayerNumber.One:o="d1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:o="d2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:o="d3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:o="d4:"+e.toString()}null!=o&&null!=a.Toolkit.InputController.keymap[o]&&(a.Toolkit.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0})}},t.OnGamepadTriggerLeft=function(e,t){if(void 0===t&&(t=a.Toolkit.PlayerNumber.One),a.Toolkit.InputController.input)switch(t){case a.Toolkit.PlayerNumber.One:a.Toolkit.InputController.gamepad1LeftTrigger.push(e);break;case a.Toolkit.PlayerNumber.Two:a.Toolkit.InputController.gamepad2LeftTrigger.push(e);break;case a.Toolkit.PlayerNumber.Three:a.Toolkit.InputController.gamepad3LeftTrigger.push(e);break;case a.Toolkit.PlayerNumber.Four:a.Toolkit.InputController.gamepad4LeftTrigger.push(e)}},t.OnGamepadTriggerRight=function(e,t){if(void 0===t&&(t=a.Toolkit.PlayerNumber.One),a.Toolkit.InputController.input)switch(t){case a.Toolkit.PlayerNumber.One:a.Toolkit.InputController.gamepad1RightTrigger.push(e);break;case a.Toolkit.PlayerNumber.Two:a.Toolkit.InputController.gamepad2RightTrigger.push(e);break;case a.Toolkit.PlayerNumber.Three:a.Toolkit.InputController.gamepad3RightTrigger.push(e);break;case a.Toolkit.PlayerNumber.Four:a.Toolkit.InputController.gamepad4RightTrigger.push(e)}},t.GetGamepadTriggerInput=function(e,t){void 0===t&&(t=a.Toolkit.PlayerNumber.One);var o=0;if(a.Toolkit.InputController.input){var n=null;switch(t){case a.Toolkit.PlayerNumber.One:n="t1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:n="t2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:n="t3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:n="t4:"+e.toString()}null!=n&&null!=a.Toolkit.InputController.keymap[n]&&(o=null!=(t=a.Toolkit.InputController.keymap[n]).result?t.result:0)}return o},t.IsGamepadTriggerHeld=function(e,t){void 0===t&&(t=a.Toolkit.PlayerNumber.One);var o=!1;if(a.Toolkit.InputController.input){var n=null;switch(t){case a.Toolkit.PlayerNumber.One:n="t1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:n="t2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:n="t3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:n="t4:"+e.toString()}null!=n&&null!=a.Toolkit.InputController.keymap[n]&&null!=(t=a.Toolkit.InputController.keymap[n]).pressTime&&null!=t.releaseTime&&!0===(null!=t.result&&t.result)&&0<t.pressTime&&0===t.releaseTime&&(o=a.Toolkit.SceneManager.GetTimeMs()-t.pressTime>=a.Toolkit.InputController.TAP_THRESHOLD_MS)}return o},t.IsGamepadTriggerTapped=function(e,t){void 0===t&&(t=a.Toolkit.PlayerNumber.One);var o=!1;if(a.Toolkit.InputController.input){var n=null;switch(t){case a.Toolkit.PlayerNumber.One:n="t1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:n="t2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:n="t3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:n="t4:"+e.toString()}null!=n&&null!=a.Toolkit.InputController.keymap[n]&&null!=(t=a.Toolkit.InputController.keymap[n]).pressTime&&null!=t.releaseTime&&!1===(null!=t.result&&t.result)&&0<t.pressTime&&0<t.releaseTime&&(o=t.releaseTime-t.pressTime<a.Toolkit.InputController.TAP_THRESHOLD_MS)}return o},t.ResetGamepadTriggerTapped=function(e,t){if(void 0===t&&(t=a.Toolkit.PlayerNumber.One),a.Toolkit.InputController.input){var o=null;switch(t){case a.Toolkit.PlayerNumber.One:o="t1:"+e.toString();break;case a.Toolkit.PlayerNumber.Two:o="t2:"+e.toString();break;case a.Toolkit.PlayerNumber.Three:o="t3:"+e.toString();break;case a.Toolkit.PlayerNumber.Four:o="t4:"+e.toString()}null!=o&&null!=a.Toolkit.InputController.keymap[o]&&(a.Toolkit.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0})}},t.GetGamepadType=function(e){void 0===e&&(e=a.Toolkit.PlayerNumber.One);var t=a.Toolkit.GamepadType.None;if(a.Toolkit.InputController.input)switch(e){case a.Toolkit.PlayerNumber.One:t=a.Toolkit.InputController.gamepad1Type;break;case a.Toolkit.PlayerNumber.Two:t=a.Toolkit.InputController.gamepad2Type;break;case a.Toolkit.PlayerNumber.Three:t=a.Toolkit.InputController.gamepad3Type;break;case a.Toolkit.PlayerNumber.Four:t=a.Toolkit.InputController.gamepad4Type}return t},t.GetGamepad=function(e){void 0===e&&(e=a.Toolkit.PlayerNumber.One);var t=null;if(a.Toolkit.InputController.input)switch(e){case a.Toolkit.PlayerNumber.One:t=a.Toolkit.InputController.gamepad1;break;case a.Toolkit.PlayerNumber.Two:t=a.Toolkit.InputController.gamepad2;break;case a.Toolkit.PlayerNumber.Three:t=a.Toolkit.InputController.gamepad3;break;case a.Toolkit.PlayerNumber.Four:t=a.Toolkit.InputController.gamepad4}return t},t.InputKeyDownHandler=function(t,e){if(null==t||!1===a.Toolkit.SceneManager.EnableUserInput)return!1;(e=void 0===e?null:e)&&e.preventDefault();var e="k:"+t.toString(),o=!1;return null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.keyButtonDown&&0<a.Toolkit.InputController.keyButtonDown.length&&a.Toolkit.InputController.keyButtonDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.keyButtonPress&&0<a.Toolkit.InputController.keyButtonPress.length&&a.Toolkit.InputController.keyButtonPress.forEach(function(e){e.index===t&&e.action()}),!0},t.InputKeyUpHandler=function(t,e){return void 0===e&&(e=null),null!=t&&!1!==a.Toolkit.SceneManager.EnableUserInput&&(e="k:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.keyButtonUp&&0<a.Toolkit.InputController.keyButtonUp.length&&a.Toolkit.InputController.keyButtonUp.forEach(function(e){e(t)}),!0)},t.tickKeyboardInput=function(e){var t,o,n,i,l,r;!1!==a.Toolkit.SceneManager.EnableUserInput&&(t=a.Toolkit.InputController.GetKeyboardInput(a.Toolkit.UserInputKey.W)||a.Toolkit.InputController.GetKeyboardInput(a.Toolkit.UserInputKey.UpArrow),o=a.Toolkit.InputController.GetKeyboardInput(a.Toolkit.UserInputKey.A),n=a.Toolkit.InputController.GetKeyboardInput(a.Toolkit.UserInputKey.S)||a.Toolkit.InputController.GetKeyboardInput(a.Toolkit.UserInputKey.DownArrow),i=a.Toolkit.InputController.GetKeyboardInput(a.Toolkit.UserInputKey.D),l=a.Toolkit.InputController.GetKeyboardInput(a.Toolkit.UserInputKey.LeftArrow),r=a.Toolkit.InputController.GetKeyboardInput(a.Toolkit.UserInputKey.RightArrow),a.Toolkit.InputController.k_vertical=!0===t?a.Toolkit.Utilities.GetKeyboardInputValue(e,a.Toolkit.InputController.k_vertical,1):!0===n?a.Toolkit.Utilities.GetKeyboardInputValue(e,a.Toolkit.InputController.k_vertical,-1):0,!0===a.Toolkit.UserInputOptions.UseArrowKeyRotation?(a.Toolkit.InputController.k_horizontal=!0===i?a.Toolkit.Utilities.GetKeyboardInputValue(e,a.Toolkit.InputController.k_horizontal,1):!0===o?a.Toolkit.Utilities.GetKeyboardInputValue(e,a.Toolkit.InputController.k_horizontal,-1):0,a.Toolkit.InputController.a_mousex=!0===r?+a.Toolkit.UserInputOptions.KeyboardArrowSensibility:!0===l?-1*a.Toolkit.UserInputOptions.KeyboardArrowSensibility:0):a.Toolkit.InputController.k_horizontal=!0===i||!0===r?a.Toolkit.Utilities.GetKeyboardInputValue(e,a.Toolkit.InputController.k_horizontal,1):!0===o||!0===l?a.Toolkit.Utilities.GetKeyboardInputValue(e,a.Toolkit.InputController.k_horizontal,-1):0)},t.updateUserInput=function(e){var t=a.Toolkit.InputController.GetMouseButtonsDown();a.Toolkit.InputController.leftButtonDown=1==(1&t),a.Toolkit.InputController.middleButtonDown=4==(4&t),a.Toolkit.InputController.rightButtonDown=2==(2&t),!1!==a.Toolkit.SceneManager.EnableUserInput&&(a.Toolkit.InputController.PointerLockedFlag=e.getEngine().isPointerLock,a.Toolkit.InputController.tickKeyboardInput(e),a.Toolkit.InputController.x_horizontal=0,a.Toolkit.InputController.x_vertical=0,a.Toolkit.InputController.x_mousex=0,(a.Toolkit.InputController.x_mousey=0)!==a.Toolkit.InputController.j_horizontal?a.Toolkit.InputController.x_horizontal=a.Toolkit.InputController.j_horizontal:0!==a.Toolkit.InputController.g_horizontal1?a.Toolkit.InputController.x_horizontal=a.Toolkit.InputController.g_horizontal1:0!==a.Toolkit.InputController.k_horizontal&&(a.Toolkit.InputController.x_horizontal=a.Toolkit.InputController.k_horizontal),0!==a.Toolkit.InputController.j_vertical?a.Toolkit.InputController.x_vertical=a.Toolkit.InputController.j_vertical:0!==a.Toolkit.InputController.g_vertical1?a.Toolkit.InputController.x_vertical=a.Toolkit.InputController.g_vertical1:0!==a.Toolkit.InputController.k_vertical&&(a.Toolkit.InputController.x_vertical=a.Toolkit.InputController.k_vertical),0!==a.Toolkit.InputController.j_mousex?a.Toolkit.InputController.x_mousex=a.Toolkit.InputController.j_mousex:0!==a.Toolkit.InputController.g_mousex1?a.Toolkit.InputController.x_mousex=a.Toolkit.InputController.g_mousex1:0!==a.Toolkit.InputController.a_mousex?a.Toolkit.InputController.x_mousex=a.Toolkit.InputController.a_mousex:0!==a.Toolkit.InputController.k_mousex&&(a.Toolkit.InputController.x_mousex=a.Toolkit.InputController.k_mousex),0!==a.Toolkit.InputController.j_mousey?a.Toolkit.InputController.x_mousey=a.Toolkit.InputController.j_mousey:0!==a.Toolkit.InputController.g_mousey1?a.Toolkit.InputController.x_mousey=a.Toolkit.InputController.g_mousey1:0!==a.Toolkit.InputController.k_mousey&&(a.Toolkit.InputController.x_mousey=a.Toolkit.InputController.k_mousey),a.Toolkit.InputController.horizontal=a.Toolkit.InputController.x_horizontal,a.Toolkit.InputController.vertical=a.Toolkit.InputController.x_vertical,a.Toolkit.InputController.mousex=a.Toolkit.InputController.x_mousex,a.Toolkit.InputController.mousey=a.Toolkit.InputController.x_mousey,a.Toolkit.InputController.scroll=a.Toolkit.InputController.x_scroll,a.Toolkit.InputController.wheel=a.Toolkit.InputController.x_wheel,a.Toolkit.InputController.horizontal2=a.Toolkit.InputController.g_horizontal2,a.Toolkit.InputController.vertical2=a.Toolkit.InputController.g_vertical2,a.Toolkit.InputController.mousex2=a.Toolkit.InputController.g_mousex2,a.Toolkit.InputController.mousey2=a.Toolkit.InputController.g_mousey2,a.Toolkit.InputController.horizontal3=a.Toolkit.InputController.g_horizontal3,a.Toolkit.InputController.vertical3=a.Toolkit.InputController.g_vertical3,a.Toolkit.InputController.mousex3=a.Toolkit.InputController.g_mousex3,a.Toolkit.InputController.mousey3=a.Toolkit.InputController.g_mousey3,a.Toolkit.InputController.horizontal4=a.Toolkit.InputController.g_horizontal4,a.Toolkit.InputController.vertical4=a.Toolkit.InputController.g_vertical4,a.Toolkit.InputController.mousex4=a.Toolkit.InputController.g_mousex4,a.Toolkit.InputController.mousey4=a.Toolkit.InputController.g_mousey4,a.Toolkit.InputController.k_mousex=0,a.Toolkit.InputController.k_mousey=0,a.Toolkit.InputController.x_mousey=0,a.Toolkit.InputController.x_scroll=0)},t.resetUserInput=function(){a.Toolkit.InputController.input=!1,a.Toolkit.InputController.keymap={},a.Toolkit.InputController.scroll=0,a.Toolkit.InputController.wheel=0,a.Toolkit.InputController.mousex=0,a.Toolkit.InputController.mousey=0,a.Toolkit.InputController.vertical=0,a.Toolkit.InputController.horizontal=0,a.Toolkit.InputController.mousex2=0,a.Toolkit.InputController.mousey2=0,a.Toolkit.InputController.vertical2=0,a.Toolkit.InputController.horizontal2=0,a.Toolkit.InputController.mousex3=0,a.Toolkit.InputController.mousey3=0,a.Toolkit.InputController.vertical3=0,a.Toolkit.InputController.horizontal3=0,a.Toolkit.InputController.mousex4=0,a.Toolkit.InputController.mousey4=0,a.Toolkit.InputController.vertical4=0,a.Toolkit.InputController.horizontal4=0,a.Toolkit.InputController.a_mousex=0,a.Toolkit.InputController.x_scroll=0,a.Toolkit.InputController.x_wheel=0,a.Toolkit.InputController.x_mousex=0,a.Toolkit.InputController.x_mousey=0,a.Toolkit.InputController.x_vertical=0,a.Toolkit.InputController.x_horizontal=0,a.Toolkit.InputController.k_mousex=0,a.Toolkit.InputController.k_mousey=0,a.Toolkit.InputController.k_vertical=0,a.Toolkit.InputController.k_horizontal=0,a.Toolkit.InputController.j_mousex=0,a.Toolkit.InputController.j_mousey=0,a.Toolkit.InputController.j_vertical=0,a.Toolkit.InputController.j_horizontal=0,a.Toolkit.InputController.g_mousex1=0,a.Toolkit.InputController.g_mousey1=0,a.Toolkit.InputController.g_vertical1=0,a.Toolkit.InputController.g_horizontal1=0,a.Toolkit.InputController.g_mousex2=0,a.Toolkit.InputController.g_mousey2=0,a.Toolkit.InputController.g_vertical2=0,a.Toolkit.InputController.g_horizontal2=0,a.Toolkit.InputController.g_mousex3=0,a.Toolkit.InputController.g_mousey3=0,a.Toolkit.InputController.g_vertical3=0,a.Toolkit.InputController.g_horizontal3=0,a.Toolkit.InputController.g_mousex4=0,a.Toolkit.InputController.g_mousey4=0,a.Toolkit.InputController.g_vertical4=0,a.Toolkit.InputController.g_horizontal4=0,a.Toolkit.InputController.preventDefault=!1,a.Toolkit.InputController.leftButtonDown=!1,a.Toolkit.InputController.middleButtonDown=!1,a.Toolkit.InputController.rightButtonDown=!1,a.Toolkit.InputController.mouseButtonsDown=0,a.Toolkit.InputController.mouseButtonUp=[],a.Toolkit.InputController.mouseButtonDown=[],a.Toolkit.InputController.mouseButtonPress=[],a.Toolkit.InputController.keyButtonUp=[],a.Toolkit.InputController.keyButtonDown=[],a.Toolkit.InputController.keyButtonPress=[],a.Toolkit.InputController.gamepad1ButtonUp=[],a.Toolkit.InputController.gamepad1ButtonDown=[],a.Toolkit.InputController.gamepad1ButtonPress=[],a.Toolkit.InputController.gamepad1DpadUp=[],a.Toolkit.InputController.gamepad1DpadDown=[],a.Toolkit.InputController.gamepad1DpadPress=[],a.Toolkit.InputController.gamepad1LeftTrigger=[],a.Toolkit.InputController.gamepad1RightTrigger=[],a.Toolkit.InputController.gamepad2ButtonUp=[],a.Toolkit.InputController.gamepad2ButtonDown=[],a.Toolkit.InputController.gamepad2ButtonPress=[],a.Toolkit.InputController.gamepad2DpadUp=[],a.Toolkit.InputController.gamepad2DpadDown=[],a.Toolkit.InputController.gamepad2DpadPress=[],a.Toolkit.InputController.gamepad2LeftTrigger=[],a.Toolkit.InputController.gamepad2RightTrigger=[],a.Toolkit.InputController.gamepad3ButtonUp=[],a.Toolkit.InputController.gamepad3ButtonDown=[],a.Toolkit.InputController.gamepad3ButtonPress=[],a.Toolkit.InputController.gamepad3DpadUp=[],a.Toolkit.InputController.gamepad3DpadDown=[],a.Toolkit.InputController.gamepad3DpadPress=[],a.Toolkit.InputController.gamepad3LeftTrigger=[],a.Toolkit.InputController.gamepad3RightTrigger=[],a.Toolkit.InputController.gamepad4ButtonUp=[],a.Toolkit.InputController.gamepad4ButtonDown=[],a.Toolkit.InputController.gamepad4ButtonPress=[],a.Toolkit.InputController.gamepad4DpadUp=[],a.Toolkit.InputController.gamepad4DpadDown=[],a.Toolkit.InputController.gamepad4DpadPress=[],a.Toolkit.InputController.gamepad4LeftTrigger=[],a.Toolkit.InputController.gamepad4RightTrigger=[],a.Toolkit.InputController.previousPosition=null},t.resetKeyMapHandler=function(e){a.Toolkit.InputController.keymap={}},t.inputKeyDownHandler=function(e){return a.Toolkit.InputController.InputKeyDownHandler(e.keyCode,e)},t.inputKeyUpHandler=function(e){return a.Toolkit.InputController.InputKeyUpHandler(e.keyCode,e)},t.inputPointerWheelHandler=function(e){var t;return!1!==a.Toolkit.SceneManager.EnableUserInput&&(t=e.deltaY?-e.deltaY:e.wheelDelta/40,a.Toolkit.InputController.x_scroll=1,a.Toolkit.InputController.x_wheel=Math.abs(t)>a.Toolkit.UserInputOptions.PointerWheelDeadZone?0+t:0,a.Toolkit.InputController.preventDefault&&e.preventDefault(),!0)},t.inputPointerDownHandler=function(t){if(a.Toolkit.InputController.mouseButtonsDown=t.buttons,!1===a.Toolkit.SceneManager.EnableUserInput)return!1;a.Toolkit.InputController.previousPosition={x:t.clientX,y:t.clientY};var e="p:"+t.button.toString(),o=!1;return null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.mouseButtonDown&&0<a.Toolkit.InputController.mouseButtonDown.length&&a.Toolkit.InputController.mouseButtonDown.forEach(function(e){e(t.button)}),o||null!=a.Toolkit.InputController.mouseButtonPress&&0<a.Toolkit.InputController.mouseButtonPress.length&&a.Toolkit.InputController.mouseButtonPress.forEach(function(e){e.index===t.button&&e.action()}),a.Toolkit.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerUpHandler=function(t){if(a.Toolkit.InputController.mouseButtonsDown=t.buttons,!1===a.Toolkit.SceneManager.EnableUserInput)return!1;a.Toolkit.InputController.previousPosition=null,a.Toolkit.InputController.k_mousex=0,a.Toolkit.InputController.k_mousey=0;var e="p:"+t.button.toString();return null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.mouseButtonUp&&0<a.Toolkit.InputController.mouseButtonUp.length&&a.Toolkit.InputController.mouseButtonUp.forEach(function(e){e(t.button)}),a.Toolkit.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerMoveHandler=function(e){var t,o,n,i;return a.Toolkit.InputController.mouseButtonsDown=e.buttons,!1!==a.Toolkit.SceneManager.EnableUserInput&&(!1===a.Toolkit.SceneManager.VirtualJoystickEnabled&&(o=t=0,a.Toolkit.InputController.IsPointerLocked()?(t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,o=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0,a.Toolkit.InputController.previousPosition=null):null!=a.Toolkit.InputController.previousPosition&&(t=e.clientX-a.Toolkit.InputController.previousPosition.x,o=e.clientY-a.Toolkit.InputController.previousPosition.y,a.Toolkit.InputController.previousPosition={x:e.clientX,y:e.clientY}),!0===a.Toolkit.UserInputOptions.PointerMouseInverted&&(t*=-1,o*=-1),!0===a.Toolkit.InputController.rightHanded&&(t*=-1),!0===a.Toolkit.UserInputOptions.EnableBabylonRotation?(a.Toolkit.InputController.k_mousex=t/a.Toolkit.UserInputOptions.BabylonAngularSensibility,a.Toolkit.InputController.k_mousey=o/a.Toolkit.UserInputOptions.BabylonAngularSensibility):(n=t*a.Toolkit.UserInputOptions.DefaultAngularSensibility*a.Toolkit.InputController.MOUSE_DAMPENER,i=o*a.Toolkit.UserInputOptions.DefaultAngularSensibility*a.Toolkit.InputController.MOUSE_DAMPENER,Math.abs(t)<=a.Toolkit.UserInputOptions.PointerMouseDeadZone&&(n=0),Math.abs(o)<=a.Toolkit.UserInputOptions.PointerMouseDeadZone&&(i=0),a.Toolkit.InputController.k_mousex+=n,a.Toolkit.InputController.k_mousey+=i,a.Toolkit.InputController.k_mousex=a.Scalar.Clamp(a.Toolkit.InputController.k_mousex,-1,1),a.Toolkit.InputController.k_mousey=a.Scalar.Clamp(a.Toolkit.InputController.k_mousey,-1,1))),a.Toolkit.InputController.preventDefault&&e.preventDefault(),!0)},t.inputOneButtonDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad1&&(e="b1:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad1ButtonDown&&0<a.Toolkit.InputController.gamepad1ButtonDown.length&&a.Toolkit.InputController.gamepad1ButtonDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad1ButtonPress&&0<a.Toolkit.InputController.gamepad1ButtonPress.length&&a.Toolkit.InputController.gamepad1ButtonPress.forEach(function(e){e.index===t&&e.action()}))},t.inputOneButtonUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad1&&(e="b1:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad1ButtonUp)&&0<a.Toolkit.InputController.gamepad1ButtonUp.length&&a.Toolkit.InputController.gamepad1ButtonUp.forEach(function(e){e(t)})},t.inputOneXboxDPadDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad1&&(e="d1:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad1DpadDown&&0<a.Toolkit.InputController.gamepad1DpadDown.length&&a.Toolkit.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad1DpadPress&&0<a.Toolkit.InputController.gamepad1DpadPress.length&&a.Toolkit.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()}))},t.inputOneShockDPadDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad1&&(e="d1:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad1DpadDown&&0<a.Toolkit.InputController.gamepad1DpadDown.length&&a.Toolkit.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad1DpadPress&&0<a.Toolkit.InputController.gamepad1DpadPress.length&&a.Toolkit.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()}))},t.inputOneXboxDPadUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad1&&(e="d1:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad1DpadUp)&&0<a.Toolkit.InputController.gamepad1DpadUp.length&&a.Toolkit.InputController.gamepad1DpadUp.forEach(function(e){e(t)})},t.inputOneShockDPadUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad1&&(e="d1:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad1DpadUp)&&0<a.Toolkit.InputController.gamepad1DpadUp.length&&a.Toolkit.InputController.gamepad1DpadUp.forEach(function(e){e(t)})},t.inputOneXboxLeftTriggerHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad1&&(e="t1:0",0<t?(null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!0,o.pressTime=a.Toolkit.SceneManager.GetTimeMs(),o.releaseTime=0)):null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!1,o.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad1LeftTrigger)&&0<a.Toolkit.InputController.gamepad1LeftTrigger.length&&a.Toolkit.InputController.gamepad1LeftTrigger.forEach(function(e){e(t)})},t.inputOneXboxRightTriggerHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad1&&(e="t1:1",0<t?(null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!0,o.pressTime=a.Toolkit.SceneManager.GetTimeMs(),o.releaseTime=0)):null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!1,o.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad1RightTrigger)&&0<a.Toolkit.InputController.gamepad1RightTrigger.length&&a.Toolkit.InputController.gamepad1RightTrigger.forEach(function(e){e(t)})},t.inputOneLeftStickHandler=function(e){var t,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad1&&(t=(e=e).x*a.Toolkit.UserInputOptions.GamepadLStickSensibility,o=e.y*a.Toolkit.UserInputOptions.GamepadLStickSensibility,e.x=Math.abs(t)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(o)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?o:0,e.x=a.Scalar.Clamp(e.x,-1,1),e.y=a.Scalar.Clamp(e.y,-1,1),a.Toolkit.InputController.g_horizontal1=a.Toolkit.UserInputOptions.GamepadLStickXInverted?-e.x:e.x,a.Toolkit.InputController.g_vertical1=a.Toolkit.UserInputOptions.GamepadLStickYInverted?e.y:-e.y)},t.inputOneRightStickHandler=function(e){var t,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad1&&(t=(e=e).x*a.Toolkit.UserInputOptions.GamepadRStickSensibility,o=e.y*a.Toolkit.UserInputOptions.GamepadRStickSensibility,e.x=Math.abs(t)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(o)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?o:0,e.x=a.Scalar.Clamp(e.x,-1,1),e.y=a.Scalar.Clamp(e.y,-1,1),a.Toolkit.InputController.g_mousex1=a.Toolkit.UserInputOptions.GamepadRStickXInverted?-e.x:e.x,a.Toolkit.InputController.g_mousey1=a.Toolkit.UserInputOptions.GamepadRStickYInverted?-e.y:e.y)},t.inputTwoButtonDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad2&&(e="b2:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad2ButtonDown&&0<a.Toolkit.InputController.gamepad2ButtonDown.length&&a.Toolkit.InputController.gamepad2ButtonDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad2ButtonPress&&0<a.Toolkit.InputController.gamepad2ButtonPress.length&&a.Toolkit.InputController.gamepad2ButtonPress.forEach(function(e){e.index===t&&e.action()}))},t.inputTwoButtonUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad2&&(e="b2:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad2ButtonUp)&&0<a.Toolkit.InputController.gamepad2ButtonUp.length&&a.Toolkit.InputController.gamepad2ButtonUp.forEach(function(e){e(t)})},t.inputTwoXboxDPadDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad2&&(e="d2:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad2DpadDown&&0<a.Toolkit.InputController.gamepad2DpadDown.length&&a.Toolkit.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad2DpadPress&&0<a.Toolkit.InputController.gamepad2DpadPress.length&&a.Toolkit.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()}))},t.inputTwoShockDPadDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad2&&(e="d2:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad2DpadDown&&0<a.Toolkit.InputController.gamepad2DpadDown.length&&a.Toolkit.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad2DpadPress&&0<a.Toolkit.InputController.gamepad2DpadPress.length&&a.Toolkit.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()}))},t.inputTwoXboxDPadUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad2&&(e="d2:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad2DpadUp)&&0<a.Toolkit.InputController.gamepad2DpadUp.length&&a.Toolkit.InputController.gamepad2DpadUp.forEach(function(e){e(t)})},t.inputTwoShockDPadUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad2&&(e="d2:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad2DpadUp)&&0<a.Toolkit.InputController.gamepad2DpadUp.length&&a.Toolkit.InputController.gamepad2DpadUp.forEach(function(e){e(t)})},t.inputTwoXboxLeftTriggerHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad2&&(e="t2:0",0<t?(null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!0,o.pressTime=a.Toolkit.SceneManager.GetTimeMs(),o.releaseTime=0)):null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!1,o.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad2LeftTrigger)&&0<a.Toolkit.InputController.gamepad2LeftTrigger.length&&a.Toolkit.InputController.gamepad2LeftTrigger.forEach(function(e){e(t)})},t.inputTwoXboxRightTriggerHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad2&&(e="t2:1",0<t?(null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!0,o.pressTime=a.Toolkit.SceneManager.GetTimeMs(),o.releaseTime=0)):null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!1,o.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad2RightTrigger)&&0<a.Toolkit.InputController.gamepad2RightTrigger.length&&a.Toolkit.InputController.gamepad2RightTrigger.forEach(function(e){e(t)})},t.inputTwoLeftStickHandler=function(e){var t,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad2&&(t=(e=e).x*a.Toolkit.UserInputOptions.GamepadLStickSensibility,o=e.y*a.Toolkit.UserInputOptions.GamepadLStickSensibility,e.x=Math.abs(t)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(o)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?o:0,e.x=a.Scalar.Clamp(e.x,-1,1),e.y=a.Scalar.Clamp(e.y,-1,1),a.Toolkit.InputController.g_horizontal2=a.Toolkit.UserInputOptions.GamepadLStickXInverted?-e.x:e.x,a.Toolkit.InputController.g_vertical2=a.Toolkit.UserInputOptions.GamepadLStickYInverted?e.y:-e.y)},t.inputTwoRightStickHandler=function(e){var t,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad2&&(t=(e=e).x*a.Toolkit.UserInputOptions.GamepadRStickSensibility,o=e.y*a.Toolkit.UserInputOptions.GamepadRStickSensibility,e.x=Math.abs(t)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(o)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?o:0,e.x=a.Scalar.Clamp(e.x,-1,1),e.y=a.Scalar.Clamp(e.y,-1,1),a.Toolkit.InputController.g_mousex2=a.Toolkit.UserInputOptions.GamepadRStickXInverted?-e.x:e.x,a.Toolkit.InputController.g_mousey2=a.Toolkit.UserInputOptions.GamepadRStickYInverted?-e.y:e.y)},t.inputThreeButtonDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad3&&(e="b3:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad3ButtonDown&&0<a.Toolkit.InputController.gamepad3ButtonDown.length&&a.Toolkit.InputController.gamepad3ButtonDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad3ButtonPress&&0<a.Toolkit.InputController.gamepad3ButtonPress.length&&a.Toolkit.InputController.gamepad3ButtonPress.forEach(function(e){e.index===t&&e.action()}))},t.inputThreeButtonUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad3&&(e="b3:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad3ButtonUp)&&0<a.Toolkit.InputController.gamepad3ButtonUp.length&&a.Toolkit.InputController.gamepad3ButtonUp.forEach(function(e){e(t)})},t.inputThreeXboxDPadDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad3&&(e="d3:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad3DpadDown&&0<a.Toolkit.InputController.gamepad3DpadDown.length&&a.Toolkit.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad3DpadPress&&0<a.Toolkit.InputController.gamepad3DpadPress.length&&a.Toolkit.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()}))},t.inputThreeShockDPadDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad3&&(e="d3:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad3DpadDown&&0<a.Toolkit.InputController.gamepad3DpadDown.length&&a.Toolkit.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad3DpadPress&&0<a.Toolkit.InputController.gamepad3DpadPress.length&&a.Toolkit.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()}))},t.inputThreeXboxDPadUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad3&&(e="d3:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad3DpadUp)&&0<a.Toolkit.InputController.gamepad3DpadUp.length&&a.Toolkit.InputController.gamepad3DpadUp.forEach(function(e){e(t)})},t.inputThreeShockDPadUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad3&&(e="d3:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad3DpadUp)&&0<a.Toolkit.InputController.gamepad3DpadUp.length&&a.Toolkit.InputController.gamepad3DpadUp.forEach(function(e){e(t)})},t.inputThreeXboxLeftTriggerHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad3&&(e="t3:0",0<t?(null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!0,o.pressTime=a.Toolkit.SceneManager.GetTimeMs(),o.releaseTime=0)):null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!1,o.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad3LeftTrigger)&&0<a.Toolkit.InputController.gamepad3LeftTrigger.length&&a.Toolkit.InputController.gamepad3LeftTrigger.forEach(function(e){e(t)})},t.inputThreeXboxRightTriggerHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad3&&(e="t3:1",0<t?(null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!0,o.pressTime=a.Toolkit.SceneManager.GetTimeMs(),o.releaseTime=0)):null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!1,o.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad3RightTrigger)&&0<a.Toolkit.InputController.gamepad3RightTrigger.length&&a.Toolkit.InputController.gamepad3RightTrigger.forEach(function(e){e(t)})},t.inputThreeLeftStickHandler=function(e){var t,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad3&&(t=(e=e).x*a.Toolkit.UserInputOptions.GamepadLStickSensibility,o=e.y*a.Toolkit.UserInputOptions.GamepadLStickSensibility,e.x=Math.abs(t)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(o)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?o:0,e.x=a.Scalar.Clamp(e.x,-1,1),e.y=a.Scalar.Clamp(e.y,-1,1),a.Toolkit.InputController.g_horizontal3=a.Toolkit.UserInputOptions.GamepadLStickXInverted?-e.x:e.x,a.Toolkit.InputController.g_vertical3=a.Toolkit.UserInputOptions.GamepadLStickYInverted?e.y:-e.y)},t.inputThreeRightStickHandler=function(e){var t,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad3&&(t=(e=e).x*a.Toolkit.UserInputOptions.GamepadRStickSensibility,o=e.y*a.Toolkit.UserInputOptions.GamepadRStickSensibility,e.x=Math.abs(t)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(o)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?o:0,e.x=a.Scalar.Clamp(e.x,-1,1),e.y=a.Scalar.Clamp(e.y,-1,1),a.Toolkit.InputController.g_mousex3=a.Toolkit.UserInputOptions.GamepadRStickXInverted?-e.x:e.x,a.Toolkit.InputController.g_mousey3=a.Toolkit.UserInputOptions.GamepadRStickYInverted?-e.y:e.y)},t.inputFourButtonDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad4&&(e="b4:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad4ButtonDown&&0<a.Toolkit.InputController.gamepad4ButtonDown.length&&a.Toolkit.InputController.gamepad4ButtonDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad4ButtonPress&&0<a.Toolkit.InputController.gamepad4ButtonPress.length&&a.Toolkit.InputController.gamepad4ButtonPress.forEach(function(e){e.index===t&&e.action()}))},t.inputFourButtonUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad4&&(e="b4:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad4ButtonUp)&&0<a.Toolkit.InputController.gamepad4ButtonUp.length&&a.Toolkit.InputController.gamepad4ButtonUp.forEach(function(e){e(t)})},t.inputFourXboxDPadDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad4&&(e="d4:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad4DpadDown&&0<a.Toolkit.InputController.gamepad4DpadDown.length&&a.Toolkit.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad4DpadPress&&0<a.Toolkit.InputController.gamepad4DpadPress.length&&a.Toolkit.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()}))},t.inputFourShockDPadDownHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad4&&(e="d4:"+t.toString(),o=!1,null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(o=null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!0,e.pressTime=a.Toolkit.SceneManager.GetTimeMs(),e.releaseTime=0),null!=a.Toolkit.InputController.gamepad4DpadDown&&0<a.Toolkit.InputController.gamepad4DpadDown.length&&a.Toolkit.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),o||null!=a.Toolkit.InputController.gamepad4DpadPress&&0<a.Toolkit.InputController.gamepad4DpadPress.length&&a.Toolkit.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()}))},t.inputFourXboxDPadUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad4&&(e="d4:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad4DpadUp)&&0<a.Toolkit.InputController.gamepad4DpadUp.length&&a.Toolkit.InputController.gamepad4DpadUp.forEach(function(e){e(t)})},t.inputFourShockDPadUpHandler=function(t){var e;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad4&&(e="d4:"+t.toString(),null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(e=a.Toolkit.InputController.keymap[e]).result&&e.result)&&(e.result=!1,e.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad4DpadUp)&&0<a.Toolkit.InputController.gamepad4DpadUp.length&&a.Toolkit.InputController.gamepad4DpadUp.forEach(function(e){e(t)})},t.inputFourXboxLeftTriggerHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad4&&(e="t4:0",0<t?(null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!0,o.pressTime=a.Toolkit.SceneManager.GetTimeMs(),o.releaseTime=0)):null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!1,o.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad4LeftTrigger)&&0<a.Toolkit.InputController.gamepad4LeftTrigger.length&&a.Toolkit.InputController.gamepad4LeftTrigger.forEach(function(e){e(t)})},t.inputFourXboxRightTriggerHandler=function(t){var e,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad4&&(e="t4:1",0<t?(null==a.Toolkit.InputController.keymap[e]&&(a.Toolkit.InputController.keymap[e]={result:!1,pressTime:0,releaseTime:0}),null!=a.Toolkit.InputController.keymap[e]&&!1===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!0,o.pressTime=a.Toolkit.SceneManager.GetTimeMs(),o.releaseTime=0)):null!=a.Toolkit.InputController.keymap[e]&&!0===(null!=(o=a.Toolkit.InputController.keymap[e]).result&&o.result)&&(o.result=!1,o.releaseTime=a.Toolkit.SceneManager.GetTimeMs()),null!=a.Toolkit.InputController.gamepad4RightTrigger)&&0<a.Toolkit.InputController.gamepad4RightTrigger.length&&a.Toolkit.InputController.gamepad4RightTrigger.forEach(function(e){e(t)})},t.inputFourLeftStickHandler=function(e){var t,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad4&&(t=(e=e).x*a.Toolkit.UserInputOptions.GamepadLStickSensibility,o=e.y*a.Toolkit.UserInputOptions.GamepadLStickSensibility,e.x=Math.abs(t)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(o)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?o:0,e.x=a.Scalar.Clamp(e.x,-1,1),e.y=a.Scalar.Clamp(e.y,-1,1),a.Toolkit.InputController.g_horizontal4=a.Toolkit.UserInputOptions.GamepadLStickXInverted?-e.x:e.x,a.Toolkit.InputController.g_vertical4=a.Toolkit.UserInputOptions.GamepadLStickYInverted?e.y:-e.y)},t.inputFourRightStickHandler=function(e){var t,o;!1!==a.Toolkit.SceneManager.EnableUserInput&&null!=a.Toolkit.InputController.gamepad4&&(t=(e=e).x*a.Toolkit.UserInputOptions.GamepadRStickSensibility,o=e.y*a.Toolkit.UserInputOptions.GamepadRStickSensibility,e.x=Math.abs(t)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(o)>a.Toolkit.UserInputOptions.GamepadDeadStickValue?o:0,e.x=a.Scalar.Clamp(e.x,-1,1),e.y=a.Scalar.Clamp(e.y,-1,1),a.Toolkit.InputController.g_mousex4=a.Toolkit.UserInputOptions.GamepadRStickXInverted?-e.x:e.x,a.Toolkit.InputController.g_mousey4=a.Toolkit.UserInputOptions.GamepadRStickYInverted?-e.y:e.y)},t.inputManagerGamepadConnected=function(e,t){var o;null==a.Toolkit.InputController.gamepad1&&0===e.index&&(a.Toolkit.InputController.gamepad1=e,a.Tools.Log("Gamepad One Connected: "+a.Toolkit.InputController.gamepad1.id),a.Toolkit.InputController.gamepad1 instanceof a.Xbox360Pad?(a.Toolkit.InputController.gamepad1Type=a.Toolkit.GamepadType.Xbox360,(o=a.Toolkit.InputController.gamepad1).onbuttonup(a.Toolkit.InputController.inputOneButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputOneButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputOneLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputOneRightStickHandler),o.ondpadup(a.Toolkit.InputController.inputOneXboxDPadUpHandler),o.ondpaddown(a.Toolkit.InputController.inputOneXboxDPadDownHandler),o.onlefttriggerchanged(a.Toolkit.InputController.inputOneXboxLeftTriggerHandler),o.onrighttriggerchanged(a.Toolkit.InputController.inputOneXboxRightTriggerHandler)):a.Toolkit.InputController.gamepad1 instanceof a.DualShockPad?(a.Toolkit.InputController.gamepad1Type=a.Toolkit.GamepadType.DualShock,(o=a.Toolkit.InputController.gamepad1).onbuttonup(a.Toolkit.InputController.inputOneButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputOneButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputOneLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputOneRightStickHandler),o.ondpadup(a.Toolkit.InputController.inputOneShockDPadUpHandler),o.ondpaddown(a.Toolkit.InputController.inputOneShockDPadDownHandler),o.onlefttriggerchanged(a.Toolkit.InputController.inputOneXboxLeftTriggerHandler),o.onrighttriggerchanged(a.Toolkit.InputController.inputOneXboxRightTriggerHandler)):(a.Toolkit.InputController.gamepad1Type=a.Toolkit.GamepadType.Generic,(o=a.Toolkit.InputController.gamepad1).onbuttonup(a.Toolkit.InputController.inputOneButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputOneButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputOneLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputOneRightStickHandler))),null==a.Toolkit.InputController.gamepad2&&1===e.index&&(a.Toolkit.InputController.gamepad2=e,a.Tools.Log("Gamepad Two Connected: "+a.Toolkit.InputController.gamepad2.id),a.Toolkit.InputController.gamepad2 instanceof a.Xbox360Pad?(a.Toolkit.InputController.gamepad2Type=a.Toolkit.GamepadType.Xbox360,(o=a.Toolkit.InputController.gamepad2).onbuttonup(a.Toolkit.InputController.inputTwoButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputTwoButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputTwoLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputTwoRightStickHandler),o.ondpadup(a.Toolkit.InputController.inputTwoXboxDPadUpHandler),o.ondpaddown(a.Toolkit.InputController.inputTwoXboxDPadDownHandler),o.onlefttriggerchanged(a.Toolkit.InputController.inputTwoXboxLeftTriggerHandler),o.onrighttriggerchanged(a.Toolkit.InputController.inputTwoXboxRightTriggerHandler)):a.Toolkit.InputController.gamepad2 instanceof a.DualShockPad?(a.Toolkit.InputController.gamepad2Type=a.Toolkit.GamepadType.DualShock,(o=a.Toolkit.InputController.gamepad2).onbuttonup(a.Toolkit.InputController.inputOneButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputOneButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputOneLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputOneRightStickHandler),o.ondpadup(a.Toolkit.InputController.inputOneShockDPadUpHandler),o.ondpaddown(a.Toolkit.InputController.inputOneShockDPadDownHandler),o.onlefttriggerchanged(a.Toolkit.InputController.inputOneXboxLeftTriggerHandler),o.onrighttriggerchanged(a.Toolkit.InputController.inputOneXboxRightTriggerHandler)):(a.Toolkit.InputController.gamepad2Type=a.Toolkit.GamepadType.Generic,(o=a.Toolkit.InputController.gamepad2).onbuttonup(a.Toolkit.InputController.inputTwoButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputTwoButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputTwoLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputTwoRightStickHandler))),null==a.Toolkit.InputController.gamepad3&&2===e.index&&(a.Toolkit.InputController.gamepad3=e,a.Tools.Log("Gamepad Three Connected: "+a.Toolkit.InputController.gamepad3.id),a.Toolkit.InputController.gamepad3 instanceof a.Xbox360Pad?(a.Toolkit.InputController.gamepad3Type=a.Toolkit.GamepadType.Xbox360,(o=a.Toolkit.InputController.gamepad3).onbuttonup(a.Toolkit.InputController.inputThreeButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputThreeButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputThreeLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputThreeRightStickHandler),o.ondpadup(a.Toolkit.InputController.inputThreeXboxDPadUpHandler),o.ondpaddown(a.Toolkit.InputController.inputThreeXboxDPadDownHandler),o.onlefttriggerchanged(a.Toolkit.InputController.inputThreeXboxLeftTriggerHandler),o.onrighttriggerchanged(a.Toolkit.InputController.inputThreeXboxRightTriggerHandler)):a.Toolkit.InputController.gamepad3 instanceof a.DualShockPad?((o=a.Toolkit.InputController.gamepad3).onbuttonup(a.Toolkit.InputController.inputOneButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputOneButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputOneLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputOneRightStickHandler),o.ondpadup(a.Toolkit.InputController.inputOneShockDPadUpHandler),o.ondpaddown(a.Toolkit.InputController.inputOneShockDPadDownHandler),o.onlefttriggerchanged(a.Toolkit.InputController.inputOneXboxLeftTriggerHandler),o.onrighttriggerchanged(a.Toolkit.InputController.inputOneXboxRightTriggerHandler)):(a.Toolkit.InputController.gamepad3Type=a.Toolkit.GamepadType.Generic,(o=a.Toolkit.InputController.gamepad3).onbuttonup(a.Toolkit.InputController.inputThreeButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputThreeButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputThreeLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputThreeRightStickHandler))),null==a.Toolkit.InputController.gamepad4&&3===e.index&&(a.Toolkit.InputController.gamepad4=e,a.Tools.Log("Gamepad Four Connected: "+a.Toolkit.InputController.gamepad4.id),a.Toolkit.InputController.gamepad4 instanceof a.Xbox360Pad?(a.Toolkit.InputController.gamepad4Type=a.Toolkit.GamepadType.Xbox360,(o=a.Toolkit.InputController.gamepad4).onbuttonup(a.Toolkit.InputController.inputFourButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputFourButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputFourLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputFourRightStickHandler),o.ondpadup(a.Toolkit.InputController.inputFourXboxDPadUpHandler),o.ondpaddown(a.Toolkit.InputController.inputFourXboxDPadDownHandler),o.onlefttriggerchanged(a.Toolkit.InputController.inputFourXboxLeftTriggerHandler),o.onrighttriggerchanged(a.Toolkit.InputController.inputFourXboxRightTriggerHandler)):a.Toolkit.InputController.gamepad4 instanceof a.DualShockPad?((o=a.Toolkit.InputController.gamepad4).onbuttonup(a.Toolkit.InputController.inputOneButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputOneButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputOneLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputOneRightStickHandler),o.ondpadup(a.Toolkit.InputController.inputOneShockDPadUpHandler),o.ondpaddown(a.Toolkit.InputController.inputOneShockDPadDownHandler),o.onlefttriggerchanged(a.Toolkit.InputController.inputOneXboxLeftTriggerHandler),o.onrighttriggerchanged(a.Toolkit.InputController.inputOneXboxRightTriggerHandler)):(a.Toolkit.InputController.gamepad4Type=a.Toolkit.GamepadType.Generic,(o=a.Toolkit.InputController.gamepad4).onbuttonup(a.Toolkit.InputController.inputFourButtonUpHandler),o.onbuttondown(a.Toolkit.InputController.inputFourButtonDownHandler),o.onleftstickchanged(a.Toolkit.InputController.inputFourLeftStickHandler),o.onrightstickchanged(a.Toolkit.InputController.inputFourRightStickHandler))),null!=a.Toolkit.InputController.GamepadConnected&&a.Toolkit.InputController.GamepadConnected(e,t)},t.inputManagerGamepadDisconnected=function(e,t){null!=a.Toolkit.InputController.GamepadDisconnected&&a.Toolkit.InputController.GamepadDisconnected(e,t)},t.MOUSE_DAMPENER=.5,t.TAP_THRESHOLD_MS=200,t.GamepadManager=null,t.GamepadConnected=null,t.GamepadDisconnected=null,t.AllowMobileControls=!0,t.MobileControlsActive=!1,t.PointerLockedFlag=!1,t.LockMousePointerObserver=null,t.input=!1,t.keymap={},t.scroll=0,t.wheel=0,t.mousex=0,t.mousey=0,t.vertical=0,t.horizontal=0,t.mousex2=0,t.mousey2=0,t.vertical2=0,t.horizontal2=0,t.mousex3=0,t.mousey3=0,t.vertical3=0,t.horizontal3=0,t.mousex4=0,t.mousey4=0,t.vertical4=0,t.horizontal4=0,t.a_mousex=0,t.x_scroll=0,t.x_wheel=0,t.x_mousex=0,t.x_mousey=0,t.x_vertical=0,t.x_horizontal=0,t.k_mousex=0,t.k_mousey=0,t.k_vertical=0,t.k_horizontal=0,t.j_mousex=0,t.j_mousey=0,t.j_vertical=0,t.j_horizontal=0,t.g_mousex1=0,t.g_mousey1=0,t.g_vertical1=0,t.g_horizontal1=0,t.g_mousex2=0,t.g_mousey2=0,t.g_vertical2=0,t.g_horizontal2=0,t.g_mousex3=0,t.g_mousey3=0,t.g_vertical3=0,t.g_horizontal3=0,t.g_mousex4=0,t.g_mousey4=0,t.g_vertical4=0,t.g_horizontal4=0,t.leftButtonDown=!1,t.middleButtonDown=!1,t.rightButtonDown=!1,t.mouseButtonsDown=0,t.mouseButtonPress=[],t.mouseButtonDown=[],t.mouseButtonUp=[],t.keyButtonPress=[],t.keyButtonDown=[],t.keyButtonUp=[],t.previousPosition=null,t.preventDefault=!1,t.rightHanded=!0,t.gamepad1=null,t.gamepad1Type=-1,t.gamepad1ButtonPress=[],t.gamepad1ButtonDown=[],t.gamepad1ButtonUp=[],t.gamepad1DpadPress=[],t.gamepad1DpadDown=[],t.gamepad1DpadUp=[],t.gamepad1LeftTrigger=[],t.gamepad1RightTrigger=[],t.gamepad2=null,t.gamepad2Type=-1,t.gamepad2ButtonPress=[],t.gamepad2ButtonDown=[],t.gamepad2ButtonUp=[],t.gamepad2DpadPress=[],t.gamepad2DpadDown=[],t.gamepad2DpadUp=[],t.gamepad2LeftTrigger=[],t.gamepad2RightTrigger=[],t.gamepad3=null,t.gamepad3Type=-1,t.gamepad3ButtonPress=[],t.gamepad3ButtonDown=[],t.gamepad3ButtonUp=[],t.gamepad3DpadPress=[],t.gamepad3DpadDown=[],t.gamepad3DpadUp=[],t.gamepad3LeftTrigger=[],t.gamepad3RightTrigger=[],t.gamepad4=null,t.gamepad4Type=-1,t.gamepad4ButtonPress=[],t.gamepad4ButtonDown=[],t.gamepad4ButtonUp=[],t.gamepad4DpadPress=[],t.gamepad4DpadDown=[],t.gamepad4DpadUp=[],t.gamepad4LeftTrigger=[],t.gamepad4RightTrigger=[],e.InputController=t,o.prototype.getValueX=function(){return this.xvalue},o.prototype.getValueY=function(){return this.yvalue},o.prototype.getStickElement=function(){return this.stick},o.prototype.dispose=function(){},o.prototype.handleDown=function(e){this.active=!0,this.stick.style.transition="0s",e.preventDefault(),e.changedTouches?this.dragStart={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:this.dragStart={x:e.clientX,y:e.clientY},e.changedTouches&&(this.touchId=e.changedTouches[0].identifier)},o.prototype.handleMove=function(e){if(this.active){var t=null;if(e.changedTouches){for(var o=0;o<e.changedTouches.length;o++)this.touchId==e.changedTouches[o].identifier&&(t=o,e.clientX=e.changedTouches[o].clientX,e.clientY=e.changedTouches[o].clientY);if(null==t)return}var n=e.clientX-this.dragStart.x,i=e.clientY-this.dragStart.y,l=Math.atan2(i,n),n=Math.min(this.maxDistance,Math.hypot(n,i)),i=n*Math.cos(l),r=n*Math.sin(l),i=(this.stick.style.transform="translate3d(".concat(i,"px, ").concat(r,"px, 0px)"),n<this.deadZone?0:this.maxDistance/(this.maxDistance-this.deadZone)*(n-this.deadZone)),r=i*Math.cos(l),n=i*Math.sin(l),i=parseFloat((r/this.maxDistance).toFixed(4)),l=parseFloat((n/this.maxDistance).toFixed(4));this.xvalue=i,this.yvalue=l}},o.prototype.handleUp=function(e){!this.active||e.changedTouches&&this.touchId!=e.changedTouches[0].identifier||(this.stick.style.transition=".2s",this.stick.style.transform="translate3d(0px, 0px, 0px)",this.xvalue=0,this.yvalue=0,this.touchId=null,this.active=!1)},e.TouchJoystickHandler=o}(BABYLON=BABYLON||{}),BABYLON.Toolkit.InputController),__awaiter=this&&this.__awaiter||function(e,r,a,s){return new(a=a||Promise)(function(o,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function i(e){try{l(s.throw(e))}catch(e){t(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,i)}l((s=s.apply(e,r||[])).next())})},__generator=this&&this.__generator||function(n,i){var l,r,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},u={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function e(o){return function(e){var t=[o,e];if(l)throw new TypeError("Generator is already executing.");for(;s=u&&t[u=0]?0:s;)try{if(l=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3]))s.label=t[1];else if(6===t[0]&&s.label<a[1])s.label=a[1],a=t;else{if(!(a&&s.label<a[2])){a[2]&&s.ops.pop(),s.trys.pop();continue}s.label=a[2],s.ops.push(t)}}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},SM=(!function(p){var e;function t(){}e=p.Toolkit||(p.Toolkit={}),Object.defineProperty(t,"Version",{get:function(){return"7.15.0 - R1"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Copyright",{get:function(){return"All rights reserved (c) 2024 Mackey Kinard"},enumerable:!1,configurable:!0}),t.HasAudioContext=function(){return null!=p.Engine.audioEngine&&null!=p.Engine.audioEngine.audioContext&&null!=p.Engine.audioEngine.audioContext.state&&"running"===p.Engine.audioEngine.audioContext.state},t.GetEngine=function(e){var t=null,e=e.getEngine();return t=null!=e&&(e instanceof p.Engine||e instanceof p.WebGPUEngine)?e:t},Object.defineProperty(t,"EventBus",{get:function(){return null==p.Toolkit.SceneManager._EventBus&&(p.Toolkit.SceneManager._EventBus=new p.Toolkit.GlobalMessageBus),p.Toolkit.SceneManager._EventBus},enumerable:!1,configurable:!0}),Object.defineProperty(t,"PlaygroundCdn",{get:function(){return"https://cdn.jsdelivr.net/gh/BabylonJS/BabylonToolkit@master/Runtime/"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"PlaygroundRepo",{get:function(){return"https://www.babylontoolkit.com/playground/"},enumerable:!1,configurable:!0}),t.InitializePlayground=function(e){return __awaiter(this,arguments,void 0,function(t,o){var n,i,l,r,a;return void 0===o&&(o=null),__generator(this,function(e){switch(e.label){case 0:return(p.Tools.Log("Babylon Toolkit Playground: "+p.Toolkit.SceneManager.Version),i=p.Toolkit.SceneManager.PlaygroundCdn+"default.playground.js",n=null==o||null==o.loadProjectScriptBundle||o.loadProjectScriptBundle,i=null!=o&&null!=o.projectScriptBundleUrl?o.projectScriptBundleUrl:i,a=null!=o&&null!=o.showDefaultLoadingScreen&&o.showDefaultLoadingScreen,l=null==o||null==o.hideLoadingUIWithEngine||o.hideLoadingUIWithEngine,r=null!=o&&null!=o.defaultLoadingUIMarginTop?o.defaultLoadingUIMarginTop:"150px",!0===a&&p.Toolkit.SceneManager.ShowLoadingScreen(t,l,r),!0!==n||null==i||""===i)?[3,2]:(a=i.substring(i.lastIndexOf("/")+1).toLowerCase(),[4,p.Tools.LoadScriptAsync(i,a)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.LoadRuntimeAssets=function(e,t,o){return __awaiter(this,arguments,void 0,function(t,o,n,i,l){return void 0===i&&(i=10),void 0===l&&(l=!1),__generator(this,function(e){switch(e.label){case 0:return p.Toolkit.SceneManager.SetOnSceneReadyHandler(o,n,i,l),null==t?[3,2]:[4,t.loadAsync()];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.ShowLoadingScreen=function(e,t,o){void 0===t&&(t=!0),void 0===o&&(o="150px"),null!=e.loadingScreen&&(!1===t&&(e.loadingScreen.hideLoadingUI=function(){}),e.displayLoadingUI(),null!=(t=e.loadingScreen)._loadingTextDiv)&&null!=t._loadingTextDiv.style&&(t._loadingTextDiv.style.marginTop=o)},t.HideLoadingScreen=function(e){var t;e.loadingScreen instanceof p.DefaultLoadingScreen&&(t=e.loadingScreen)&&t._loadingDiv&&(t._loadingDiv.style.opacity="0",t._loadingDiv.addEventListener("transitionend",function(){t._loadingTextDiv&&(t._loadingTextDiv.remove(),t._loadingTextDiv=null),t._loadingDiv&&(t._loadingDiv.remove(),t._loadingDiv=null),t._style&&(t._style.remove(),t._style=null),t._resizeLoadingUI&&window.removeEventListener("resize",t._resizeLoadingUI)}))},t.FocusRenderCanvas=function(e){e.getEngine().getRenderingCanvas().focus()},t.SetOnSceneReadyHandler=function(e,t,o,n){void 0===o&&(o=10),void 0===n&&(n=!1),p.Toolkit.SceneManager.SceneLoaderPropertyBag={},p.Toolkit.SceneManager.SceneLoaderHandledFlag=!1,p.Toolkit.SceneManager.SceneLoaderFileNames=e,p.Toolkit.SceneManager.SceneLoaderFileNames.forEach(function(e){p.Toolkit.SceneManager.SceneLoaderPropertyBag[e.toLowerCase()]=!1}),p.Toolkit.SceneManager.OnSceneReadyObservable.clear(),p.Toolkit.SceneManager.OnSceneReadyObservable.add(function(e){!0===n&&console.log("OnSceneReady(): "+e),p.Toolkit.SceneManager.SceneLoaderPropertyBag[e.toLowerCase()]=!0;e=Object.values(p.Toolkit.SceneManager.SceneLoaderPropertyBag).every(function(e){return!0===e});if(t&&!0===e)try{t()}catch(e){console.warn(e)}finally{p.Toolkit.SceneManager.SceneLoaderHandledFlag=!0}}),p.Toolkit.WindowManager.SetTimeout(1e3*o,function(){if(t&&!1===p.Toolkit.SceneManager.SceneLoaderHandledFlag)try{t()}catch(e){console.warn(e)}finally{p.Toolkit.SceneManager.SceneLoaderHandledFlag=!0}})},t.EnableSceneParsing=function(e){p.Toolkit.SceneManager.SceneParsingEnabled=e},t.IsSceneParsingEnabled=function(){return p.Toolkit.SceneManager.SceneParsingEnabled},t.HasSceneBeenPreLoaded=function(e){return null!=e._preloaded&&!0===e._preloaded},t.GetFullscreenUI=function(e,t){return void 0===t&&(t=p.Texture.BILINEAR_SAMPLINGMODE),null==p.Toolkit.SceneManager.AdvDynamicTexture&&(p.Toolkit.SceneManager.AdvDynamicTexture=p.GUI.AdvancedDynamicTexture.CreateFullscreenUI("Default-Screen-UI",!0,e,t)),p.Toolkit.SceneManager.AdvDynamicTexture},t.GetDefaultSkybox=function(e){return e.getMeshById("Default Skybox")},t.GetIntensityFactor=function(){return null!=p.Toolkit.SceneManager.GlobalOptions.intensityFactor?p.Toolkit.SceneManager.GlobalOptions.intensityFactor:2},t.GetRenderQuality=function(){var e=p.Toolkit.RenderQuality.High,t=p.Toolkit.SceneManager.GlobalOptions.renderQuality;return e=null!=t?t:e},t.SetRenderQuality=function(e){p.Toolkit.SceneManager.GlobalOptions.renderQuality=e},t.GetEngineVersionString=function(e){var t="Unknown",e=e||p.Toolkit.SceneManager.GetLastCreatedScene();return t=null!=e&&null!=(e=p.Toolkit.SceneManager.GetEngine(e))&&null!=(e=e.getInfo())?e.version+" - "+e.renderer:t},t.SetWindowState=function(e,t){p.Toolkit.SceneManager.WindowState[e]=t},t.GetWindowState=function(e){e=p.Toolkit.SceneManager.WindowState[e];return null!=e?e:null},t.IsDebugMode=function(){return null!=p.Toolkit.SceneManager.GlobalOptions.debugModeEnabled&&!0===p.Toolkit.SceneManager.GlobalOptions.debugModeEnabled},t.ConsoleLog=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.Toolkit.SceneManager.IsDebugMode()&&console.log.apply(console,e)},t.ConsoleInfo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.Toolkit.SceneManager.IsDebugMode()&&console.info.apply(console,e)},t.ConsoleWarn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.Toolkit.SceneManager.IsDebugMode()&&console.warn.apply(console,e)},t.ConsoleError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,e)},t.LogMessage=function(e){p.Toolkit.SceneManager.IsDebugMode()&&p.Tools.Log(e)},t.LogWarning=function(e){p.Toolkit.SceneManager.IsDebugMode()&&p.Tools.Warn(e)},t.LogError=function(e){p.Tools.Error(e)},t.GetTime=function(){return.001*p.Toolkit.WindowManager.GetTimeMilliseconds()},t.GetTimeMs=function(){return p.Toolkit.WindowManager.GetTimeMilliseconds()},t.GetGameTime=function(){return.001*(p.Toolkit.WindowManager.GetTimeMilliseconds()-p.Toolkit.SceneManager.GameTimeMilliseconds)},t.GetGameTimeMs=function(){return p.Toolkit.WindowManager.GetTimeMilliseconds()-p.Toolkit.SceneManager.GameTimeMilliseconds},t.GetDeltaSeconds=function(e,t){void 0===t&&(t=!1);var e=e||p.Toolkit.SceneManager.GetLastCreatedScene(),o=.001*Math.max(p.Scene.MinDeltaTime,Math.min(e.getEngine().getDeltaTime(),p.Scene.MaxDeltaTime));return!0===t&&(o*=e.getAnimationRatio()),o},t.GetDeltaMilliseconds=function(e,t){void 0===t&&(t=!1);var e=e||p.Toolkit.SceneManager.GetLastCreatedScene(),o=Math.max(p.Scene.MinDeltaTime,Math.min(e.getEngine().getDeltaTime(),p.Scene.MaxDeltaTime));return!0===t&&(o*=e.getAnimationRatio()),o},t.GetAnimationRatio=function(e){return(e||p.Toolkit.SceneManager.GetLastCreatedScene()).getAnimationRatio()},t.RunOnce=function(e,t,o){e.executeOnceBeforeRender(t,o)},t.DisposeScene=function(e,t){void 0===t&&(t=new p.Color4(0,0,0,1));var o=e.getEngine();e.dispose(),o.clear(t,!0,!0,!0)},t.SafeDestroy=function(e,t,o){void 0===o&&(o=!1),0<(t=void 0===t?5:t)?(!0===o&&e.setEnabled(!1),p.Toolkit.WindowManager.SetTimeout(t,function(){e.dispose(!1,!1)})):e.dispose(!1,!1)},t.GetRootUrl=function(e){return null!=e._rootUrl&&""!==e._rootUrl?e._rootUrl:"/"},t.SetRootUrl=function(e,t){e._rootUrl=t},t.GetSceneFile=function(e){return null!=e._fileName&&""!==e._fileName?e._fileName:null},t.SetSceneFile=function(e,t){e._fileName=t},t.GetEngineInstances=function(){return p.EngineStore.Instances},t.GetLastCreatedEngine=function(){return p.EngineStore.LastCreatedEngine},t.GetLastCreatedScene=function(){return p.EngineStore.LastCreatedScene},t.AddShadowCaster=function(e,t,o){void 0===o&&(o=!1);var n=(null==e?void 0:e.getShadowGenerator()).getShadowMap();null==n.renderList&&(n.renderList=[]),t instanceof p.AbstractMesh&&n.renderList.indexOf(t)<0&&n.renderList.push(t),!0===o&&null!=(e=t.getChildMeshes(!1))&&e.forEach(function(e){n.renderList.indexOf(e)<0&&n.renderList.push(e)})},t.IsPhysicsViewerEnabled=function(){return p.Toolkit.SceneManager.PhysicsViewersEnabled},t.TogglePhysicsViewer=function(e){if(p.Toolkit.SceneManager.PhysicsViewersEnabled=!p.Toolkit.SceneManager.PhysicsViewersEnabled,p.Toolkit.SceneManager.PhysicsViewersEnabled){var t=new p.Debug.PhysicsViewer(e);null==e.reservedDataStore&&(e.reservedDataStore={}),e.reservedDataStore.physicsViewer=t;for(var o=0,n=e.meshes;o<n.length;o++){var i=n[o];i.physicsImpostor?(a=t.showImpostor(i.physicsImpostor,i))&&(a.reservedDataStore={hidden:!0},a.material)&&(a.material.reservedDataStore={hidden:!0}):i.physicsBody&&(a=t.showBody(i.physicsBody))&&(a.reservedDataStore={hidden:!0},a.material)&&(a.material.reservedDataStore={hidden:!0})}for(var l=0,r=e.transformNodes;l<r.length;l++){var a,s=r[l];s.physicsBody&&(a=t.showBody(s.physicsBody))&&(a.reservedDataStore={hidden:!0},a.material)&&(a.material.reservedDataStore={hidden:!0})}}else e.reservedDataStore&&e.reservedDataStore.physicsViewer&&(e.reservedDataStore.physicsViewer.dispose(),e.reservedDataStore.physicsViewer=null)},t.GetImportMeshes=function(e,t){return null!=e&&null!=t&&""!==t&&null!=e.importMeshes?e.importMeshes.get(t.toLowerCase()):null},t.GetImportMeshMap=function(e){return null!=e&&null!=e.importMeshes?e.importMeshes:null},t.ClearImportMeshes=function(e){if(null==e)return null;e.importMeshes,e.importMeshes=new Map},t.RegisterImportMeshes=function(e,t,o){null!=e&&null!=t&&""!==t&&null!=o&&(null==e.importMeshes&&(e.importMeshes=new Map),e.importMeshes.set(t.toLowerCase(),o))},t.GetAssetContainer=function(e,t){return null!=e&&null!=t&&""!==t&&null!=e.assetContainers?e.assetContainers.get(t.toLowerCase()):null},t.GetAssetContainerMap=function(e){return null!=e&&null!=e.assetContainers?e.assetContainers:null},t.ClearAssetContainers=function(e){if(null==e)return null;e.assetContainers,e.assetContainers=new Map},t.RegisterAssetContainer=function(e,t,o){null!=e&&null!=t&&""!==t&&null!=o&&(null==e.assetContainers&&(e.assetContainers=new Map),e.assetContainers.set(t.toLowerCase(),o))},t.GetMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetAbstractMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetAbstractMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformNode=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetTransformNodeByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformDetailMesh=function(e){var t=null,o=e.name+".Detail",e=e.getChildren(function(e){return e.name===o&&e instanceof p.AbstractMesh},!0);return t=null!=e&&0<e.length?e[0]:t},t.GetSkinnedMesh=function(e){return null!=e._skinnedMesh?e._skinnedMesh:null},t.GetPrimitiveMeshes=function(e){return e.getChildMeshes(!0,function(e){return 0<=e.name.indexOf("_primitive")})},t.GetTransformLayer=function(e){return null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.layer?e.metadata.toolkit.layer:0},t.GetTransformLayerMask=function(e){return null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.layermask?e.metadata.toolkit.layermask:1},t.GetTransformLayerName=function(e){return null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.layername&&""!==e.metadata.toolkit.layername?e.metadata.toolkit.layername:"Default"},t.GetTransformTag=function(e){return null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.group&&""!==e.metadata.toolkit.group?e.metadata.toolkit.group:"Untagged"},t.HasTransformTags=function(e,t){return p.Tags.MatchesQuery(e,t)},t.TextureFloatSupported=function(e){var t=!1,o=!1,e=e.getEngine().getCaps();return e.textureHalfFloatRender&&e.textureHalfFloatLinearFiltering?t=!0:e.textureFloatRender&&e.textureFloatLinearFiltering&&(o=!0),t||o},t.RegisterClickAction=function(e,t,o){var n=null;return null!=t&&(t.isPickable=!0,null==t.actionManager&&(t.actionManager=new p.ActionManager(e)),n=t.actionManager.registerAction(new p.ExecuteCodeAction({trigger:p.ActionManager.OnPickTrigger},o))),n},t.UnregisterClickAction=function(e,t){var o=!1;return o=null!=e&&null!=t?e.actionManager.unregisterAction(t):o},t.StartTweenAnimation=function(e,t,o,n,i,l,r,a,s,u,c){void 0===u&&(u=null),void 0===c&&(c=null);r=(r=void 0===r?1:r)||1,s=(s=void 0===s?null:s)||p.Animation.ANIMATIONLOOPMODE_CONSTANT,t=p.Toolkit.Utilities.CreateTweenAnimation(t,n,i,l,(a=void 0===a?null:a)||30,s),null!=u&&t.setEasingFunction(u),n=p.Toolkit.Utilities.GetLastKeyFrameIndex(t),i=s!=p.Animation.ANIMATIONLOOPMODE_CONSTANT;return e.beginDirectAnimation(o,[t],0,n,i,r,c)},t.StartNativeTween=function(e,t){return createjs.Tween.get(e,t)},t.GetMaterialWithName=function(e,t){var o=null;if(null!=e.materials&&0<e.materials.length){e.materials.length;for(var n=0;n<e.materials.length;n++){var i=e.materials[n];if(i.name.startsWith(t)){o=i;break}}}return o},t.GetAllMaterialsWithName=function(e,t){var o=null;if(null!=e.materials&&0<e.materials.length){e.materials.length;for(var n=0;n<e.materials.length;n++){var i=e.materials[n];i.name.startsWith(t)&&(o=null==o?[]:o).push(i)}}return o},t.InstantiatePrefabFromScene=function(l,e,t,o,n,i,r,a){void 0===o&&(o=null),void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=!0);var s,u,c,a=null;return null!=l&&null!=e&&""!==e?null!=(s=l.getNodeByName(e))?null!=(a=s.clone(t,o,!1))?(null!=n&&(a.position=n.clone()),null!=i&&(a.rotationQuaternion=i.clone()),null!=r&&(a.scaling=r.clone()),null==(s=null!=(t=a.getChildren(s=null,!1))?t:s)?s=[a]:s.unshift(a),s.forEach(function(o){if(o.setEnabled(!0),o instanceof p.AbstractMesh&&null!=o.metadata&&null!=o.metadata.shadowCastingMode&&0!==o.metadata.shadowCastingMode&&l.lights.forEach(function(e){var t=e.getShadowGenerator();null!=t&&!1==(null!=e.includedOnlyMeshes&&0<e.includedOnlyMeshes.length)&&(null==(e=t.getShadowMap()).renderList&&(e.renderList=[]),e.renderList.indexOf(o)<0)&&e.renderList.push(o)}),o instanceof p.Mesh)if(null!=o.source){if(null==o.skeleton&&null!=o.source.skeleton){var e=o.source.skeleton.name+".Skeleton",t=e+"."+o.source.skeleton.id;if(o.skeleton=o.source.skeleton.clone(e,t),null!=o.skeleton&&null!=o.skeleton.bones&&null!=o.source.skeleton.bones&&o.skeleton.bones.length===o.source.skeleton.bones.length)for(var n=o.skeleton.bones.length,i=0;i<n;i++)null==o.skeleton.bones[i].metadata&&null!=o.source.skeleton.bones[i].metadata&&(o.skeleton.bones[i].metadata=o.source.skeleton.bones[i].metadata)}}else p.Tools.Warn("Babylon.js encountered a null clone source for: "+o.name)}),u=[],s.forEach(function(e){u.push(e)}),null!=u&&0<u.length&&(p.Toolkit.Utilities.PostParseSceneComponents(l,u,null,c=[]),l.onAfterRenderObservable.addOnce(function(){if(null!=c&&0<c.length)for(var e=0;e<c.length;e++){var t=c[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}}))):p.Tools.Warn("Failed to create prefab of: "+e):p.Tools.Warn("Failed to lookup prefab map: "+e):p.Tools.Warn("Unable to locate prefab master: "+e),a},t.InstantiatePrefabFromContainer=function(e,t,o,n,i,l,r,a,s){void 0===i&&(i=null),void 0===l&&(l=null),void 0===r&&(r=null);var u,c,t=p.Toolkit.Utilities.CloneAssetContainerItem(e,t,function(e){return e},n=void 0===n?null:n,s=void 0===s?!1:s,a=void 0===a?!0:a);return null!=t&&(null!=o&&""!==o&&(t.name=o),null!=i&&(t.position=i.clone()),null!=l&&(t.rotationQuaternion=l.clone()),null!=r&&(t.scaling=r.clone()),(u=[]).push(t),null!=(n=t.getChildren(null,!1))&&0<n.length&&n.forEach(function(e){u.push(e)}),u.forEach(function(e){e.id=p.Toolkit.Utilities.CreateGuid(),e.setEnabled(!0)}),p.Toolkit.Utilities.PostParseSceneComponents(e.scene,u,null,c=[]),e.scene.onAfterRenderObservable.addOnce(function(){if(null!=c&&0<c.length)for(var e=0;e<c.length;e++){var t=c[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})),t},t.CloneTransformNode=function(e,t,o,n,i,l,r){void 0===n&&(n=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===r&&(r=null);e=p.Toolkit.Utilities.GetAssetContainerNode(e,t).clone(o,n,!0);return null!=e&&(null!=i&&(e.position=i.clone()),null!=l&&(e.rotationQuaternion=l.clone()),null!=r&&(e.scaling=r.clone()),e.setEnabled(!0)),e},t.CloneAbstractMesh=function(e,t,o,n,i,l,r){void 0===n&&(n=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===r&&(r=null);e=p.Toolkit.Utilities.GetAssetContainerMesh(e,t).clone(o,n,!0);return null!=e&&(null!=i&&(e.position=i.clone()),null!=l&&(e.rotationQuaternion=l.clone()),null!=r&&(e.scaling=r.clone()),e.setEnabled(!0)),e},t.CreateInstancedMesh=function(e,t,o,n,i,l,r){void 0===n&&(n=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===r&&(r=null);e=p.Toolkit.Utilities.GetAssetContainerMesh(e,t).createInstance(o);return null!=e&&(null!=n&&(e.parent=n),null!=i&&(e.position=i.clone()),null!=l&&(e.rotationQuaternion=l.clone()),null!=r&&(e.scaling=r.clone()),e.setEnabled(!0)),e},t.AttachScriptComponent=function(e,t,o){void 0===o&&(o=!0),null!=e&&e.registerComponentInstance&&e.registerComponentInstance(e,t,o)},t.DestroyScriptComponent=function(e){null!=e&&e.destroyComponentInstance&&e.destroyComponentInstance(e)},t.FindScriptComponent=function(e,t,o){if(void 0===o&&(o=!1),null==e)return null;var n=null;if(null!=e.metadata&&e.metadata.toolkit){var i=e.metadata.toolkit;if(null!=i.components&&0<i.components.length)for(var l=0;l<i.components.length;l++){var r=i.components[l];if(null!=r.instance&&r.klass===t){n=r.instance;break}}}if(null==n&&!0===o){var a=e.getChildren(null,!1);if(null!=a)for(var s=0;s<a.length;s++){var u=a[s];if(null!=(n=p.Toolkit.SceneManager.FindScriptComponent(u,t,!1)))break}}return null!=n?n:null},t.FindAllScriptComponents=function(e,t,o){if(void 0===o&&(o=!1),null==e)return null;var n=null;if(null!=e.metadata&&e.metadata.toolkit){var i=e.metadata.toolkit;if(null!=i.components&&0<i.components.length)for(var l=0;l<i.components.length;l++){var r=i.components[l];null!=r.instance&&r.klass===t&&(n=null==n?[]:n).push(r.instance)}}if(!0===o){var a=e.getChildren(null,!1);if(null!=a)for(var s=0;s<a.length;s++){var u=a[s],u=p.Toolkit.SceneManager.FindAllScriptComponents(u,t,!1);null!=u&&(n=null==n?[]:n).push.apply(n,u)}}return null!=n?n:null},t.FindSceneMetadata=function(e){return null!=e&&null!=e.metadata&&e.metadata.toolkit?e.metadata.toolkit:null},t.FindSceneCameraRig=function(e){return null!=e&&null!=e.cameraRig?e.cameraRig:null},t.FindSceneLightRig=function(e){return null!=e&&null!=e.lightRig?e.lightRig:null},t.FindTransformWithScript=function(e,t){e=e.getNodes();return p.Toolkit.Utilities.SearchTransformNodeForScript(t,e)},t.FindAllTransformsWithScript=function(e,t){e=e.getNodes();return p.Toolkit.Utilities.SearchAllTransformNodesForScript(t,e)},t.FindChildTransformNode=function(e,t,o,n,i){return void 0===o&&(o=p.Toolkit.SearchType.ExactMatch),void 0===n&&(n=!0),void 0===i&&(i=null),null==e?null:(o=null!=o?o:p.Toolkit.SearchType.ExactMatch,e=e.getChildren(i,n),p.Toolkit.Utilities.SearchTransformNodes(t,e,o))},t.FindChildTransformWithTags=function(e,t,o,n){return void 0===o&&(o=!0),void 0===n&&(n=null),null==e?null:(e=e.getChildren(n,o),p.Toolkit.Utilities.SearchTransformNodeForTags(t,e))},t.FindAllChildTransformsWithTags=function(e,t,o,n){return void 0===o&&(o=!0),void 0===n&&(n=null),null==e?null:(e=e.getChildren(n,o),p.Toolkit.Utilities.SearchAllTransformNodesForTags(t,e))},t.FindChildTransformWithScript=function(e,t,o,n){return void 0===o&&(o=!0),void 0===n&&(n=null),null==e?null:(e=e.getChildren(n,o),p.Toolkit.Utilities.SearchTransformNodeForScript(t,e))},t.FindAllChildTransformsWithScript=function(e,t,o,n){return void 0===o&&(o=!0),void 0===n&&(n=null),null==e?null:(e=e.getChildren(n,o),p.Toolkit.Utilities.SearchAllTransformNodesForScript(t,e))},t.SearchForScriptComponentByName=function(e,t){e=e.getNodes(),e=p.Toolkit.Utilities.SearchTransformNodeForScript(t,e);return p.Toolkit.SceneManager.FindScriptComponent(e,t)},t.SearchForAllScriptComponentsByName=function(e,t){var o=null,e=e.getNodes(),e=p.Toolkit.Utilities.SearchAllTransformNodesForScript(t,e);return null!=e&&0<e.length&&e.forEach(function(e){e=p.Toolkit.SceneManager.FindScriptComponent(e,t);null!=e&&(o=null==o?[]:o).push(e)}),null!=o?o:null},t.MoveWithCollisions=function(e,t){if(null==e)return null;null!=t&&e.moveWithCollisions(t)},t.MoveWithTranslation=function(e,t){if(null==e)return null;null!=t&&e.position.addInPlace(t)},t.TurnWithRotation=function(e,t,o){if(void 0===o&&(o=p.Space.LOCAL),null==e)return null;0!=t&&e.rotate(p.Axis.Y,t,o)},t.GetRecastHeapSize=function(){var e;return"undefined"==typeof Recast?0:(e=0,Recast&&Recast.HEAP8&&Recast.HEAP8.length?Recast.HEAP8.length/1048576:e)},t.GetNavigationTools=function(){if("undefined"!=typeof Recast)return null==p.Toolkit.SceneManager.PluginInstance&&(p.Toolkit.SceneManager.PluginInstance=new p.RecastJSPlugin),p.Toolkit.SceneManager.PluginInstance},t.GetCrowdInterface=function(e){var t;return"undefined"!=typeof Recast&&p.Toolkit.SceneManager.HasNavigationData()?(null!=(t=p.Toolkit.SceneManager.GetNavigationTools())&&null==p.Toolkit.SceneManager.CrowdInterface&&(p.Toolkit.SceneManager.CrowdInterface=t.createCrowd(p.Toolkit.SceneManager.MAX_AGENT_COUNT,p.Toolkit.SceneManager.MAX_AGENT_RADIUS,e)),p.Toolkit.SceneManager.CrowdInterface):null},t.HasNavigationData=function(){var e;return"undefined"!=typeof Recast&&null!=(e=p.Toolkit.SceneManager.GetNavigationTools())&&null!=e.navMesh},t.GetNavigationMesh=function(){return"undefined"==typeof Recast?null:p.Toolkit.SceneManager.NavigationMesh},t.BakeNavigationMesh=function(e,t,o,n,i,l){if(void 0===n&&(n=!1),void 0===i&&(i=null),void 0===l&&(l=!1),"undefined"==typeof Recast)return null;p.Tools.Log("Recast.js baking navigation mesh data");var r=p.Toolkit.SceneManager.GetNavigationTools();return null!=r&&(r.createNavMesh(t,o),null!=r.navMesh?(null==(o=e.getMaterialByName(t="NavigationMesh"))&&((o=new p.StandardMaterial(t,e)).diffuseColor=i||new p.Color3(.05,.225,.75),o.alpha=.5),p.Toolkit.SceneManager.NavigationMesh=r.createDebugNavMesh(e),null!=p.Toolkit.SceneManager.NavigationMesh&&(p.Toolkit.SceneManager.NavigationMesh.material=o,p.Toolkit.SceneManager.NavigationMesh.isPickable=!0,p.Toolkit.SceneManager.NavigationMesh.isVisible=!0,p.Toolkit.SceneManager.NavigationMesh.visibility=!0===n?1:0,p.Toolkit.SceneManager.NavigationMesh.renderingGroupId=p.Toolkit.Utilities.ColliderRenderGroup(),p.Tags.AddTagsTo(p.Toolkit.SceneManager.NavigationMesh,"Navigation"),p.Toolkit.Utilities.ValidateTransformMetadata(p.Toolkit.SceneManager.NavigationMesh),!0===l)&&(p.Toolkit.SceneManager.NavigationMesh.checkCollisions=!0,p.Toolkit.SceneManager.NavigationMesh.metadata.toolkit.physics=p.Toolkit.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new p.Vector3(0,0,0)),p.Toolkit.SceneManager.NavigationMesh.metadata.toolkit.collision=p.Toolkit.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),p.Toolkit.RigidbodyPhysics.SetupPhysicsComponent(e,p.Toolkit.SceneManager.NavigationMesh)),null!=p.Toolkit.SceneManager.NavigationMesh?!0===p.Toolkit.SceneManager.OnNavMeshReadyObservable.hasObservers()&&p.Toolkit.SceneManager.OnNavMeshReadyObservable.notifyObservers(p.Toolkit.SceneManager.NavigationMesh):p.Tools.Warn("Failed to generate navigation mesh geometry")):p.Tools.Warn("Failed to create navigation mesh data")),p.Toolkit.SceneManager.NavigationMesh},t.LoadNavigationMesh=function(e,t,o,n,i,l){if(void 0===o&&(o=!1),void 0===n&&(n=null),void 0===i&&(i=0),void 0===l&&(l=!1),"undefined"==typeof Recast)return null;p.Tools.Log("Recast.js loading prebaked navigation mesh");var r=p.Toolkit.SceneManager.GetNavigationTools();return null!=r&&(r.setTimeStep&&r.setTimeStep(i),r.buildFromNavmeshData(t),null!=r.navMesh?(null==(t=e.getMaterialByName(i="NavigationMesh"))&&((t=new p.StandardMaterial(i,e)).diffuseColor=n||new p.Color3(.05,.225,.75),t.alpha=.5),p.Toolkit.SceneManager.NavigationMesh=r.createDebugNavMesh(e),null!=p.Toolkit.SceneManager.NavigationMesh&&(p.Toolkit.SceneManager.NavigationMesh.material=t,p.Toolkit.SceneManager.NavigationMesh.isPickable=!0,p.Toolkit.SceneManager.NavigationMesh.isVisible=!0,p.Toolkit.SceneManager.NavigationMesh.visibility=!0===o?1:0,p.Toolkit.SceneManager.NavigationMesh.renderingGroupId=p.Toolkit.Utilities.ColliderRenderGroup(),p.Tags.AddTagsTo(p.Toolkit.SceneManager.NavigationMesh,"Navigation"),p.Toolkit.Utilities.ValidateTransformMetadata(p.Toolkit.SceneManager.NavigationMesh),!0===l)&&(p.Toolkit.SceneManager.NavigationMesh.checkCollisions=!0,p.Toolkit.SceneManager.NavigationMesh.metadata.toolkit.physics=p.Toolkit.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new p.Vector3(0,0,0)),p.Toolkit.SceneManager.NavigationMesh.metadata.toolkit.collision=p.Toolkit.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),p.Toolkit.RigidbodyPhysics.SetupPhysicsComponent(e,p.Toolkit.SceneManager.NavigationMesh)),null!=p.Toolkit.SceneManager.NavigationMesh?!0===p.Toolkit.SceneManager.OnNavMeshReadyObservable.hasObservers()&&p.Toolkit.SceneManager.OnNavMeshReadyObservable.notifyObservers(p.Toolkit.SceneManager.NavigationMesh):p.Tools.Warn("Failed to generate navigation mesh geometry")):p.Tools.Warn("Failed to build navigation mesh data")),p.Toolkit.SceneManager.NavigationMesh},t.SaveNavigationMesh=function(){var e;return"undefined"!=typeof Recast&&null!=(e=p.Toolkit.SceneManager.GetNavigationTools())&&null!=e.navMesh?e.getNavmeshData():null},t.ComputeNavigationPath=function(e,t,o){var n;return void 0===o&&(o=!0),"undefined"!=typeof Recast&&(n=p.Toolkit.SceneManager.GetNavigationTools(),e=!0===o?n.getClosestPoint(e):e,o=!0===o?n.getClosestPoint(t):t,null!=n)&&null!=n.navMesh?n.computePath(e,o):null},t.MoveAlongNavigationPath=function(e,t,o,n,i,l){void 0===i&&(i=null);var r=null;if(o&&0<o.length){for(var a=0,s=[{frame:0,value:t.position}],u=0;u<o.length;u++)a+=p.Vector3.Distance(s[u].value,o[u]),s.push({frame:a,value:o[u]});r=new p.Animation("Navigation","position",3,p.Animation.ANIMATIONTYPE_VECTOR3,p.Animation.ANIMATIONLOOPMODE_CONSTANT),null!=i&&r.setEasingFunction(i),r.setKeys(s),t.animations=[r],e.beginAnimation(t,0,a,!1,n,l)}return r},t.AddNavigationCylinderObstacle=function(e,t,o){var n;return"undefined"!=typeof Recast&&null!=(n=p.Toolkit.SceneManager.GetNavigationTools())&&null!=n.navMesh?n.addCylinderObstacle(e,t,o):null},t.AddNavigationBoxObstacle=function(e,t,o){var n;return"undefined"!=typeof Recast&&null!=(n=p.Toolkit.SceneManager.GetNavigationTools())&&null!=n.navMesh?n.addBoxObstacle(e,t,o):null},t.RemoveNavigationObstacle=function(e){if("undefined"==typeof Recast)return null;var t=p.Toolkit.SceneManager.GetNavigationTools();null!=t&&null!=t.navMesh&&t.removeObstacle(e)},t.ToggleFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().switchFullscreen(t)},t.EnterFullscreenMode=function(e,t){p.Toolkit.SceneManager.GotoFullscreenBrowser(e,t=void 0===t?!0:t)},t.ExitFullscreenMode=function(e){p.Toolkit.SceneManager.ExitFromFullscreenBrowser(e)},t.GotoFullscreenBrowser=function(e,t){void 0===t&&(t=!0);var o=document.documentElement;o.requestFullscreen?o.requestFullscreen().then(function(){!0===t&&p.Toolkit.SceneManager.RequestBrowserPointerLock(o)}).catch(function(e){console.error("Error attempting to enable full-screen mode: ".concat(e.message," (").concat(e.name,")"))}):o.mozRequestFullScreen?(o.mozRequestFullScreen(),!0===t&&p.Toolkit.SceneManager.RequestBrowserPointerLock(o)):o.webkitRequestFullscreen?(o.webkitRequestFullscreen(),!0===t&&p.Toolkit.SceneManager.RequestBrowserPointerLock(o)):o.msRequestFullscreen?(o.msRequestFullscreen(),!0===t&&p.Toolkit.SceneManager.RequestBrowserPointerLock(o)):e.getEngine().enterFullscreen(t)},t.RequestBrowserPointerLock=function(e){e.requestPointerLock?e.requestPointerLock():e.mozRequestPointerLock?e.mozRequestPointerLock():e.webkitRequestPointerLock&&e.webkitRequestPointerLock()},t.ExitFromFullscreenBrowser=function(e){var t=document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen?t.webkitExitFullscreen():t.msExitFullscreen?t.msExitFullscreen():e.getEngine().exitFullscreen()},t.GlobalOptions={},t.WindowState={},t.ServerEndPoint="http://127.0.0.1:2567",t.EnableDebugMode=!1,t.EnableUserInput=!0,t.RenderLoopReady=!0,t.PauseRenderLoop=!1,t.LostRenderContext=!1,t.AutoUpdateProgress=!0,t.PhysicsCapsuleShape=0,t.SupportSRGBBuffers=!1,t.AnimationStartMode=0,t.AnimationTargetFps=30,t.DefaultConvexHullMargin=.001,t.DefaultHeightFieldMargin=.001,t.AmbientLightIntensity=.5,t.PointLightIntensity=1,t.SpotLightIntensity=10,t.DirectionalLightIntensity=1,t.TerrainColorCorrection=2.2,t.AllowCameraMovement=!0,t.AllowCameraRotation=!0,t.VirtualJoystickEnabled=!1,t.GameTimeMilliseconds=0,t.ParseScriptComponents=!0,t.AutoLoadScriptBundles=!0,t.WaitForSeconds=function(t){return new Promise(function(e){return p.Toolkit.WindowManager.SetTimeout(1e3*t,e)})},t.OnPreRenderLoopObservable=new p.Observable,t.OnPostRenderLoopObservable=new p.Observable,t.OnSceneReadyObservable=new p.Observable,t.OnEngineResizeObservable=new p.Observable,t.OnLoadCompleteObservable=new p.Observable,t.OnRebuildContextObservable=new p.Observable,t.OnAssetManagerProgress=null,t._EventBus=null,t.SceneLoaderFileNames=[],t.SceneLoaderPropertyBag={},t.SceneLoaderHandledFlag=!1,t.SceneParsingEnabled=!0,t.AdvDynamicTexture=null,t.PhysicsViewersEnabled=!1,t.MAX_AGENT_COUNT=200,t.MAX_AGENT_RADIUS=2,t.NavigationMesh=null,t.CrowdInterface=null,t.PluginInstance=null,t.OnNavMeshReadyObservable=new p.Observable,e.SceneManager=t}(BABYLON=BABYLON||{}),BABYLON.Toolkit.SceneManager),__extends=(BABYLON.Toolkit.SceneManager.GameTimeMilliseconds=BABYLON.Toolkit.WindowManager.GetTimeMilliseconds(),this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}()),UTIL=(!function(M){var e=M.Toolkit||(M.Toolkit={}),t=((t=e.System||(e.System={}))[t.Deg2Rad=2*Math.PI/360]="Deg2Rad",t[t.Rad2Deg=1/M.Toolkit.System.Deg2Rad]="Rad2Deg",t[t.Epsilon=1e-6]="Epsilon",t[t.SingleEpsilon=1401298e-51]="SingleEpsilon",t[t.EpsilonNormalSqrt=1e-15]="EpsilonNormalSqrt",t[t.Kph2Mph=.621371]="Kph2Mph",t[t.Mph2Kph=1.60934]="Mph2Kph",t[t.Mps2Kph=3.6]="Mps2Kph",t[t.Mps2Mph=2.23694]="Mps2Mph",t[t.Meter2Inch=39.3701]="Meter2Inch",t[t.Inch2Meter=.0254]="Inch2Meter",t[t.Gravity=9.81]="Gravity",t[t.Gravity3G=29.400000000000002]="Gravity3G",t[t.SkidFactor=.25]="SkidFactor",t[t.MaxInteger=2147483647]="MaxInteger",t[t.WalkingVelocity=4.4]="WalkingVelocity",t[t.TerminalVelocity=55]="TerminalVelocity",t[t.SmoothDeltaFactor=.2]="SmoothDeltaFactor",t[t.ToLinearSpace=2.2]="ToLinearSpace",t[t.ToGammaSpace=.45454545454545453]="ToGammaSpace",(t=e.Handedness||(e.Handedness={}))[t.Default=-1]="Default",t[t.Right=0]="Right",t[t.Left=1]="Left",(t=e.SearchType||(e.SearchType={}))[t.ExactMatch=0]="ExactMatch",t[t.StartsWith=1]="StartsWith",t[t.EndsWith=2]="EndsWith",t[t.IndexOf=3]="IndexOf",(t=e.PlayerNumber||(e.PlayerNumber={}))[t.Auto=0]="Auto",t[t.One=1]="One",t[t.Two=2]="Two",t[t.Three=3]="Three",t[t.Four=4]="Four",(t=e.PlayerControl||(e.PlayerControl={}))[t.FirstPerson=0]="FirstPerson",t[t.ThirdPerson=1]="ThirdPerson",(t=e.RenderQuality||(e.RenderQuality={}))[t.High=0]="High",t[t.Medium=1]="Medium",t[t.Low=2]="Low",(t=e.GamepadType||(e.GamepadType={}))[t.None=-1]="None",t[t.Generic=0]="Generic",t[t.Xbox360=1]="Xbox360",t[t.DualShock=2]="DualShock",t[t.PoseController=3]="PoseController",(t=e.Xbox360Trigger||(e.Xbox360Trigger={}))[t.Left=0]="Left",t[t.Right=1]="Right",(t=e.MovementType||(e.MovementType={}))[t.DirectVelocity=0]="DirectVelocity",t[t.AppliedForces=1]="AppliedForces",(t=e.CollisionContact||(e.CollisionContact={}))[t.Top=0]="Top",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Bottom=3]="Bottom",(t=e.IntersectionPrecision||(e.IntersectionPrecision={}))[t.AABB=0]="AABB",t[t.OBB=1]="OBB",(t=e.CollisionFilters||(e.CollisionFilters={}))[t.DefaultFilter=1]="DefaultFilter",t[t.StaticFilter=2]="StaticFilter",t[t.KinematicFilter=4]="KinematicFilter",t[t.DebrisFilter=8]="DebrisFilter",t[t.SensorTrigger=16]="SensorTrigger",t[t.CharacterFilter=32]="CharacterFilter",t[t.AllFilter=-1]="AllFilter",(t=e.CollisionState||(e.CollisionState={}))[t.ACTIVE_TAG=1]="ACTIVE_TAG",t[t.ISLAND_SLEEPING=2]="ISLAND_SLEEPING",t[t.WANTS_DEACTIVATION=3]="WANTS_DEACTIVATION",t[t.DISABLE_DEACTIVATION=4]="DISABLE_DEACTIVATION",t[t.DISABLE_SIMULATION=5]="DISABLE_SIMULATION",(t=e.CollisionFlags||(e.CollisionFlags={}))[t.CF_STATIC_OBJECT=1]="CF_STATIC_OBJECT",t[t.CF_KINEMATIC_OBJECT=2]="CF_KINEMATIC_OBJECT",t[t.CF_NO_CONTACT_RESPONSE=4]="CF_NO_CONTACT_RESPONSE",t[t.CF_CUSTOM_MATERIAL_CALLBACK=8]="CF_CUSTOM_MATERIAL_CALLBACK",t[t.CF_CHARACTER_OBJECT=16]="CF_CHARACTER_OBJECT",t[t.CF_DISABLE_VISUALIZE_OBJECT=32]="CF_DISABLE_VISUALIZE_OBJECT",t[t.CF_DISABLE_SPU_COLLISION_PROCESSING=64]="CF_DISABLE_SPU_COLLISION_PROCESSING",t[t.CF_HAS_CONTACT_STIFFNESS_DAMPING=128]="CF_HAS_CONTACT_STIFFNESS_DAMPING",t[t.CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR=256]="CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR",t[t.CF_HAS_FRICTION_ANCHOR=512]="CF_HAS_FRICTION_ANCHOR",t[t.CF_HAS_COLLISION_SOUND_TRIGGER=1024]="CF_HAS_COLLISION_SOUND_TRIGGER",(t=e.UserInputPointer||(e.UserInputPointer={}))[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",(t=e.UserInputAxis||(e.UserInputAxis={}))[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.ClientX=2]="ClientX",t[t.ClientY=3]="ClientY",t[t.MouseX=4]="MouseX",t[t.MouseY=5]="MouseY",t[t.Wheel=6]="Wheel",(t=e.UserInputKey||(e.UserInputKey={}))[t.BackSpace=8]="BackSpace",t[t.Tab=9]="Tab",t[t.Enter=13]="Enter",t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Pause=19]="Pause",t[t.Break=19]="Break",t[t.CapsLock=20]="CapsLock",t[t.Escape=27]="Escape",t[t.SpaceBar=32]="SpaceBar",t[t.PageUp=33]="PageUp",t[t.PageDown=34]="PageDown",t[t.End=35]="End",t[t.Home=36]="Home",t[t.LeftArrow=37]="LeftArrow",t[t.UpArrow=38]="UpArrow",t[t.RightArrow=39]="RightArrow",t[t.DownArrow=40]="DownArrow",t[t.Insert=45]="Insert",t[t.Delete=46]="Delete",t[t.Num0=48]="Num0",t[t.Num1=49]="Num1",t[t.Num2=50]="Num2",t[t.Num3=51]="Num3",t[t.Num4=52]="Num4",t[t.Num5=53]="Num5",t[t.Num6=54]="Num6",t[t.Num7=55]="Num7",t[t.Num8=56]="Num8",t[t.Num9=57]="Num9",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.LeftWindowKey=91]="LeftWindowKey",t[t.RightWindowKey=92]="RightWindowKey",t[t.SelectKey=93]="SelectKey",t[t.Numpad0=96]="Numpad0",t[t.Numpad1=97]="Numpad1",t[t.Numpad2=98]="Numpad2",t[t.Numpad3=99]="Numpad3",t[t.Numpad4=100]="Numpad4",t[t.Numpad5=101]="Numpad5",t[t.Numpad6=102]="Numpad6",t[t.Numpad7=103]="Numpad7",t[t.Numpad8=104]="Numpad8",t[t.Numpad9=105]="Numpad9",t[t.Multiply=106]="Multiply",t[t.Add=107]="Add",t[t.Subtract=109]="Subtract",t[t.DecimalPoint=110]="DecimalPoint",t[t.Divide=111]="Divide",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NumLock=144]="NumLock",t[t.ScrollLock=145]="ScrollLock",t[t.SemiColon=186]="SemiColon",t[t.EqualSign=187]="EqualSign",t[t.Comma=188]="Comma",t[t.Dash=189]="Dash",t[t.Period=190]="Period",t[t.ForwardSlash=191]="ForwardSlash",t[t.GraveAccent=192]="GraveAccent",t[t.OpenBracket=219]="OpenBracket",t[t.BackSlash=220]="BackSlash",t[t.CloseBraket=221]="CloseBraket",t[t.SingleQuote=222]="SingleQuote",o.KeyboardSmoothing=!1,o.KeyboardMoveSensibility=3,o.KeyboardArrowSensibility=1,o.KeyboardMoveDeadZone=.001,o.GamepadDeadStickValue=.15,o.GamepadLStickXInverted=!1,o.GamepadLStickYInverted=!1,o.GamepadRStickXInverted=!1,o.GamepadRStickYInverted=!0,o.GamepadLStickSensibility=1,o.GamepadRStickSensibility=1,o.SupportedInputDevices=null,o.BabylonAngularSensibility=2e3,o.DefaultAngularSensibility=.5,o.PointerWheelDeadZone=.1,o.PointerMouseDeadZone=.1,o.PointerMouseInverted=!1,o.UseCanvasElement=!0,o.UseArrowKeyRotation=!1,o.EnableBabylonRotation=!1,o);function o(){}function n(){this.mesh=null,this.state=0}function i(){}function l(e,t,o,n,i){void 0===o&&(o=!0),void 0===n&&(n=null),void 0===i&&(i=null),this.loadingDivId=e,this.loadingUIText=t,this.hideLoadingUIWithEngine=o,this.customInnerHtml=n,this.customInnerCss=i,this.loadingUIBackgroundColor="#000000",null!=this.loadingDivId&&""!==this.loadingDivId||(this.loadingDivId="customLoadingScreen"),null!=this.loadingUIText&&""!==this.loadingUIText||(this.loadingUIText="Please Wait")}function r(){this.ListenerDictionary={}}function a(){this.ListenerDictionary={},window&&window.top?(this.HandleWindowMessage=this.HandleWindowMessage.bind(this),window.top.addEventListener("message",this.HandleWindowMessage)):console.warn("GlobalMessageBus: No Top Window Available")}function s(e,t,o,n,i,l){void 0===o&&(o=1),void 0===n&&(n=!0),void 0===i&&(i=!1),void 0===l&&(l=!0),this.prefabName=null,this.allowGrowth=!0,this.assetContainer=null,this.cloneAnimations=!0,this.makeNewMaterials=!1,this.availableInstances=null,this.prefabName=t,this.allowGrowth=n,this.assetContainer=e,this.cloneAnimations=l,this.makeNewMaterials=i,this.availableInstances=[],this.populatePool(o)}function u(){this._hit=!1,this._dest=new M.Vector3(0,0,0),this._origin=new M.Vector3(0,0,0),this._hitPoint=new M.Vector3(0,0,0),this._hitNormal=new M.Vector3(0,0,0),this._hitDistance=0,this._collisionObject=null,this.reset(M.Vector3.Zero(),M.Vector3.Zero())}function c(e,t,o,n){void 0===o&&(o=0),void 0===n&&(n=.5),this._numPoints=-1,this._pointMesh=null,this._pointSize=.5,this._pointType=0,this._linesName="MeshLines",this._linesMesh=null,this._babylonScene=null,this._pointMesh=null,this._linesMesh=null,this._linesName=e,this._babylonScene=t,this._pointType=o,this._pointSize=n}e.UserInputOptions=t,e.RequestHeader=function(){},e.TriggerVolume=n,e.RoomErrorMessage=i,l.prototype.displayLoadingUI=function(){var e,t;this.hasLoadingDiv()?this.showLoadingDiv(!0):((e=document.createElement("style")).type="text/css",e.innerHTML=this.customInnerCss||"",document.getElementsByTagName("head")[0].appendChild(e),e=this.loadingUIText,(t=document.createElement("div")).id=this.loadingDivId,t.innerHTML=this.customInnerHtml||e,document.body.appendChild(t))},l.prototype.hideLoadingUI=function(){!0===this.hideLoadingUIWithEngine&&this.showLoadingDiv(!1)},l.prototype.showLoadingDiv=function(e){var t=this.getLoadingDiv();null!=t&&(t.style.display=e?"initial":"none")},l.prototype.getLoadingDiv=function(){return document.getElementById(this.loadingDivId)},l.prototype.hasLoadingDiv=function(){return null!=document.getElementById(this.loadingDivId)},t=l,e.CustomLoadingScreen=t,r.prototype.OnMessage=function(e,t){var o;null==this.ListenerDictionary[e]?this.ListenerDictionary[e]=o=[]:o=this.ListenerDictionary[e],o.findIndex(function(e){return t==e})<0&&o.push(t)},r.prototype.PostMessage=function(e,t){void 0===t&&(t=null);e=this.ListenerDictionary[e];null!=e&&e.forEach(function(e){try{e&&e(t)}catch(e){console.warn(e)}})},r.prototype.RemoveHandler=function(e,t){var o,e=this.ListenerDictionary[e];null!=e&&0<=(o=e.findIndex(function(e){return t==e}))&&e.splice(o,1)},r.prototype.ResetHandlers=function(){this.ListenerDictionary={}},r.prototype.Dispose=function(){this.ResetHandlers()},e.LocalMessageBus=r,a.prototype.OnMessage=function(e,t){var o;null==this.ListenerDictionary[e]?this.ListenerDictionary[e]=o=[]:o=this.ListenerDictionary[e],o.findIndex(function(e){return t==e})<0&&o.push(t)},a.prototype.PostMessage=function(e,t,o,n){void 0===t&&(t=null),void 0===o&&(o="*"),window&&window.top?window.top.postMessage({source:"eventbus",message:e,data:t},o,n):console.warn("GlobalMessageBus: No Top Window Available")},a.prototype.RemoveHandler=function(e,t){var o,e=this.ListenerDictionary[e];null!=e&&0<=(o=e.findIndex(function(e){return t==e}))&&e.splice(o,1)},a.prototype.ResetHandlers=function(){this.ListenerDictionary={}},a.prototype.Dispose=function(){this.ResetHandlers(),window&&window.top&&window.top.removeEventListener("message",this.HandleWindowMessage)},a.prototype.HandleWindowMessage=function(e){null!=e&&null!=e.data&&null!=e.data.message&&null!=e.data.source&&"eventbus"==e.data.source&&this.OnDispatchMessage(e.data.message,null!=e.data.data?e.data.data:null)},a.prototype.OnDispatchMessage=function(e,t){void 0===t&&(t=null);e=this.ListenerDictionary[e];null!=e&&e.forEach(function(e){try{e&&e(t)}catch(e){console.warn(e)}})},e.GlobalMessageBus=a,s.prototype.getAvailableCount=function(){return this.availableInstances.length},s.prototype.populatePool=function(e){if(0<e)for(var t=0;t<e;t++){var o=this.createNewInstance();null!=o&&this.freeInstance(o)}},s.prototype.getInstance=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var o=0<this.availableInstances.length?this.availableInstances.pop():this.appendNewInstance();return null!=o&&(null!=e?o.position.copyFrom(e):o.position.set(0,0,0),null!=t?null!=o.rotationQuaternion?o.rotationQuaternion.copyFrom(t):o.rotationQuaternion=t.clone():null!=o.rotationQuaternion?o.rotationQuaternion.set(0,0,0,1):o.rotationQuaternion=new M.Quaternion(0,0,0,1),o.name=this.prefabName+".Instance",o.setEnabled(!0)),o},s.prototype.freeInstance=function(e){null!=e&&(e.setEnabled(!1),e.position.set(0,0,0),null!=e.rotationQuaternion?e.rotationQuaternion.set(0,0,0,1):e.rotationQuaternion=new M.Quaternion(0,0,0,1),null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.components&&e.metadata.toolkit.components.forEach(function(e){if(null!=e)try{e.resetScriptComponent()}catch(e){}}),e.name=this.prefabName+".Unassigned",this.availableInstances.push(e))},s.prototype.appendNewInstance=function(){var e=null;return e=!0===this.allowGrowth?this.createNewInstance():e},s.prototype.createNewInstance=function(e,t,o,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===o&&(o=null),void 0===n&&(n=null);var i=null;return null!=this.assetContainer&&null!=this.prefabName&&""!==this.prefabName&&(this.assetContainer instanceof M.AssetContainer?i=M.Toolkit.SceneManager.InstantiatePrefabFromContainer(this.assetContainer,this.prefabName,this.prefabName+".Instance",e,t,o,n,this.cloneAnimations,this.makeNewMaterials):this.assetContainer instanceof M.Scene&&(i=M.Toolkit.SceneManager.InstantiatePrefabFromScene(this.assetContainer,this.prefabName,this.prefabName+".Instance",e,t,o,n,this.cloneAnimations))),i},e.PrefabObjectPool=s,Object.defineProperty(u.prototype,"hasHit",{get:function(){return this._hit},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"hitPoint",{get:function(){return this._hitPoint},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"hitNormal",{get:function(){return this._hitNormal},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"collisionObject",{get:function(){return this._collisionObject},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"rayDestination",{get:function(){return this._dest},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"rayOrigin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),u.prototype.reset=function(e,t){this._hit=!1,this._hitPoint.set(0,0,0),this._hitNormal.set(0,0,0),this._hitDistance=0,this._collisionObject=null,this._origin.copyFrom(e),this._dest.copyFrom(t)},u.prototype.update=function(e,t,o,n,i,l,r,a){void 0===a&&(a=null),this._hit=e,this._hitPoint.set(t,o,n),this._hitNormal.set(i,l,r),this._hitDistance=M.Vector3.Distance(this._origin,this.hitPoint),this._collisionObject=a},e.RaycastHitResult=u,Object.defineProperty(c.prototype,"pointMesh",{get:function(){return this._pointMesh},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"linesMesh",{get:function(){return this._linesMesh},enumerable:!1,configurable:!0}),c.prototype.dispose=function(e){void 0===e&&(e=!0),this._babylonScene=null,(this._linesName=null)!=this._pointMesh&&(this._pointMesh.dispose(e),this._pointMesh=null),null!=this._linesMesh&&(this._linesMesh.dispose(e),this._linesMesh=null)},c.prototype.hidePoint=function(e){void 0===e&&(e=!0),null!=this._pointMesh&&(this._pointMesh.isVisible=!e)},c.prototype.drawPoint=function(e){null==this._pointMesh&&(1===this._pointType?this._pointMesh=M.MeshBuilder.CreateBox(this._linesName+".EndPoint",{size:2*this._pointSize},this._babylonScene):this._pointMesh=M.MeshBuilder.CreateSphere(this._linesName+".EndPoint",{segments:24,diameter:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=M.Toolkit.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25),null!=this._pointMesh&&(this._pointMesh.isVisible=!0,this._pointMesh.position.copyFrom(e))},c.prototype.drawLine=function(e,t){void 0===t&&(t=null),null==this._linesMesh?(this._numPoints=e.length,this._linesMesh=M.MeshBuilder.CreateLines(this._linesName,{points:e,updatable:!0},this._babylonScene),this._linesMesh.renderingGroupId=M.Toolkit.Utilities.DefaultRenderGroup(),null!=t&&(this._linesMesh.color=t),this._linesMesh.refreshBoundingInfo(!1)):e.length===this._numPoints?(this._linesMesh=M.MeshBuilder.CreateLines(this._linesName,{points:e,instance:this._linesMesh},this._babylonScene),this._linesMesh.renderingGroupId=M.Toolkit.Utilities.DefaultRenderGroup(),null!=t&&(this._linesMesh.color=t),this._linesMesh.refreshBoundingInfo(!1)):M.Tools.Warn("Dynamic line mesh point count mismatch for "+this._linesName)},e.LinesMeshRenderer=c,p=M.AssetsManager,__extends(d,p),d.prototype.addContainerTask=function(e,t,o,n){var i=this,l=new M.ContainerAssetTask(e,t,o,n),r=l;return r._lengthComputable=0,r._loaded=0,r._total=0,r.runTask=function(e,t,n){M.SceneLoader.LoadAssetContainer(l.rootUrl,l.sceneFilename,e,function(e){l.loadedContainer=e,l.loadedMeshes=e.meshes,l.loadedParticleSystems=e.particleSystems,l.loadedSkeletons=e.skeletons,l.loadedAnimationGroups=e.animationGroups,t()},function(e){r._lengthComputable=e.lengthComputable,r._loaded=e.loaded,r._total=e.total,i.handlePreloadingProgress()},function(e,t,o){n(t,o)})},this._tasks.push(l),l},d.prototype.addMeshTask=function(e,t,o,n){var l=this,r=new M.MeshAssetTask(e,t,o,n),a=r;return a._lengthComputable=0,a._loaded=0,a._total=0,a.runTask=function(e,i,n){M.SceneLoader.ImportMesh(r.meshesNames,r.rootUrl,r.sceneFilename,e,function(e,t,o,n){r.loadedMeshes=e,r.loadedParticleSystems=t,r.loadedSkeletons=o,r.loadedAnimationGroups=n,i()},function(e){a._lengthComputable=e.lengthComputable,a._loaded=e.loaded,a._total=e.total,l.handlePreloadingProgress()},function(e,t,o){n(t,o)})},this._tasks.push(r),r},d.prototype.addTextFileTask=function(e,t){var n=this,i=new M.TextFileAssetTask(e,t),l=i;return l._lengthComputable=0,l._loaded=0,l._total=0,l.runTask=function(e,t,o){e._loadFile(i.url,function(e){i.text=e,t()},function(e){l._lengthComputable=e.lengthComputable,l._loaded=e.loaded,l._total=e.total,n.handlePreloadingProgress()},!1,!1,function(e,t){e&&o(e.status+" "+e.statusText,t)})},this._tasks.push(i),i},d.prototype.addBinaryFileTask=function(e,t){var n=this,i=new M.BinaryFileAssetTask(e,t),l=i;return l._lengthComputable=0,l._loaded=0,l._total=0,l.runTask=function(e,t,o){e._loadFile(i.url,function(e){i.data=e,t()},function(e){l._lengthComputable=e.lengthComputable,l._loaded=e.loaded,l._total=e.total,n.handlePreloadingProgress()},!0,!0,function(e,t){e&&o(e.status+" "+e.statusText,t)})},this._tasks.push(i),i},d.prototype.addImageTask=function(e,t){var i=this,l=new M.ImageAssetTask(e,t),r=l;return r._lengthComputable=0,r._loaded=0,r._total=0,r.runTask=function(e,t,o){var n=new Image;M.Tools.SetCorsBehavior(l.url,n),n.onload=function(){l.image=n,t()},n.onerror=function(e){o("Error loading image",e)},n.onprogress=function(e){r._lengthComputable=e.lengthComputable,r._loaded=e.loaded,r._total=e.total,i.handlePreloadingProgress()},n.src=l.url},this._tasks.push(l),l},d.prototype.handlePreloadingProgress=function(){var e=!0,t=0,o=0;if(null!=this._tasks&&0<this._tasks.length)for(var n=0;n<this._tasks.length;n++){var i=this._tasks[n];null!=i._lengthComputable&&null!=i._loaded&&null!=i._total&&(e=e&&i._lengthComputable,t+=i._loaded,o+=i._total)}null!=M.Toolkit.SceneManager.OnAssetManagerProgress&&M.Toolkit.SceneManager.OnAssetManagerProgress({lengthComputable:e,loaded:t,total:e?o:0})};var p,t=d;function d(){return null!==p&&p.apply(this,arguments)||this}function h(){}function m(){}e.PreloadAssetsManager=t,h.HasNetworkEntity=function(e){return null!=e&&null!=e.networkEntity},h.GetNetworkEntityId=function(e){return null!=e&&null!=e.networkEntity?e.networkEntity.id:null},h.GetNetworkEntityType=function(e){return null!=e&&null!=e.networkEntityType?e.networkEntityType:0},h.GetNetworkEntitySessionId=function(e){return null!=e&&null!=e.networkEntity?e.networkEntity.ownerId:null},h.QueryNetworkAttribute=function(e,t){var o=null;return o=null!=e&&null!=e.networkEntity&&null!=e.networkEntity.attributes?e.networkEntity.attributes.get(t):o},h.QueryBufferedAttribute=function(e,t){var o=0;return o=null!=e&&null!=e.networkEntityAttributeBuffer?e.networkEntityAttributeBuffer[t.toFixed(0)]:o},h.PostBufferedAttribute=function(e,t,o){null==e.networkEntityBatch&&(e.networkEntityBatch={}),e.networkEntityBatch[t.toFixed(0)]=o},e.EntityController=h,m.ZeroPad=function(e,t){t=t-e.toString().length+1;return Array(+(0<t&&t)).join("0")+e},m.ShiftArray=function(e,t){return t?e.unshift(e.pop()):e.push(e.shift()),e},m.GetLayerMask=function(e){return 1<<e},m.IsLayerMasked=function(e,t){return 0!=(e&1<<t)},m.GetLoadingState=function(){return M.Toolkit.Utilities.LoadingState},m.GetRandomRange=function(e,t,o,n){void 0===o&&(o=null),void 0===n&&(n=null);var i=M.Scalar.RandomRange(e,t);if(null!=o){var l=null!=n?n:100;if(i===o)for(var r=0;r<l&&(i=M.Scalar.RandomRange(e,t))===o;r++);}return i},m.GetRandomFloat=function(e,t,o,n){return void 0===o&&(o=null),void 0===n&&(n=null),parseFloat(M.Toolkit.Utilities.GetRandomRange(e,t,o,n).toFixed(2))},m.GetRandomInteger=function(e,t,o,n){return void 0===o&&(o=null),void 0===n&&(n=null),parseInt(M.Toolkit.Utilities.GetRandomRange(e,t,o,n).toFixed(0))},m.Approximately=function(e,t){return Math.abs(t-e)<Math.max(M.Toolkit.System.Epsilon*Math.max(Math.abs(e),Math.abs(t)),8*M.Toolkit.System.SingleEpsilon)},m.GetVertexDataFromMesh=function(e){var t=e.computeWorldMatrix(!0),e=M.VertexData.ExtractFromMesh(e,!0,!0);return e.transform(t),e},m.CalculateDestinationPoint=function(e,t,o){var n=new M.Vector3(0,0,0);return M.Toolkit.Utilities.CalculateDestinationPointToRef(e,t,o,n),n},m.CalculateDestinationPointToRef=function(e,t,o,n){null==M.Toolkit.Utilities.TempDirectionBuffer&&(M.Toolkit.Utilities.TempDirectionBuffer=new M.Vector3(0,0,0)),M.Toolkit.Utilities.TempDirectionBuffer.set(0,0,0),t.scaleToRef(o,M.Toolkit.Utilities.TempDirectionBuffer),e.addToRef(M.Toolkit.Utilities.TempDirectionBuffer,n)},m.UpdateAbstractMeshMaterial=function(e,t,o){var n;null!=e?!1==e instanceof M.InstancedMesh?(n=e.material)instanceof M.MultiMaterial?((n=n.clone(n.name+".Clone")).subMaterials[o]=t,e.material=n):e.material=t:console.warn("Instanced mesh not supported as a node material on mesh: "+e.name):console.warn("Null source mesh for mesh: "+e.name)},m.HermiteVector3=function(e,t,o,n,i){var l=new M.Vector3(0,0,0);return M.Toolkit.Utilities.HermiteVector3ToRef(e,t,o,n,i,l),l},m.HermiteVector3ToRef=function(e,t,o,n,i,l){var r=i*i,a=i*r,s=2*a-3*r+1,u=-2*a+3*r,i=a-2*r+i,a=a-r,r=e._x*s+o._x*u+t._x*i+n._x*a,c=e._y*s+o._y*u+t._y*i+n._y*a,e=e._z*s+o._z*u+t._z*i+n._z*a;l.set(r,c,e)},m.LerpLog=function(e,t,o){o=Math.min(Math.max(o,0),1);return e+(t-e)*Math.sin(o*Math.PI*.5)},m.LerpExp=function(e,t,o){o=Math.min(Math.max(o,0),1);return e+(t-e)*(1-Math.cos(o*Math.PI*.5))},m.LerpUnclamped=function(e,t,o){return e+(t-e)*o},m.LerpUnclampedColor3=function(e,t,o){var n=new M.Color3(0,0,0);return M.Toolkit.Utilities.LerpUnclampedColor3ToRef(e,t,o,n),n},m.LerpUnclampedColor3ToRef=function(e,t,o,n){n.set(e.r+(t.r-e.r)*o,e.g+(t.g-e.g)*o,e.b+(t.b-e.b)*o)},m.LerpUnclampedColor4=function(e,t,o){var n=new M.Color4(0,0,0,1);return M.Toolkit.Utilities.LerpUnclampedColor4ToRef(e,t,o,n),n},m.LerpUnclampedColor4ToRef=function(e,t,o,n){n.set(e.r+(t.r-e.r)*o,e.g+(t.g-e.g)*o,e.b+(t.b-e.b)*o,e.a+(t.a-e.a)*o)},m.LerpUnclampedVector2=function(e,t,o){var n=new M.Vector2(0,0);return M.Toolkit.Utilities.LerpUnclampedVector2ToRef(e,t,o,n),n},m.LerpUnclampedVector2ToRef=function(e,t,o,n){n.set(e.x+(t.x-e.x)*o,e.y+(t.y-e.y)*o)},m.LerpUnclampedVector3=function(e,t,o){var n=new M.Vector3(0,0,0);return M.Toolkit.Utilities.LerpUnclampedVector3ToRef(e,t,o,n),n},m.LerpUnclampedVector3ToRef=function(e,t,o,n){n.set(e.x+(t.x-e.x)*o,e.y+(t.y-e.y)*o,e.z+(t.z-e.z)*o)},m.LerpUnclampedVector4=function(e,t,o){var n=new M.Vector4(0,0,0,0);return M.Toolkit.Utilities.LerpUnclampedVector4ToRef(e,t,o,n),n},m.LerpUnclampedVector4ToRef=function(e,t,o,n){n.set(e.x+(t.x-e.x)*o,e.y+(t.y-e.y)*o,e.z+(t.z-e.z)*o,e.w+(t.w-e.w)*o)},m.IsEqualUsingDot=function(e){return e>1-M.Toolkit.System.Epsilon},m.QuaternionAngle=function(e,t){e=Math.min(Math.abs(M.Quaternion.Dot(e,t)),1);return M.Toolkit.Utilities.IsEqualUsingDot(e)?0:2*Math.acos(e)*M.Toolkit.System.Rad2Deg},m.QuaternionLengthSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},m.QuaternionRotateTowards=function(e,t,o){var n=new M.Quaternion(0,0,0,1);return M.Toolkit.Utilities.QuaternionRotateTowardsToRef(e,t,o,n),n},m.QuaternionRotateTowardsToRef=function(e,t,o,n){var i=M.Toolkit.Utilities.QuaternionAngle(e,t);0==i?n.copyFrom(t):M.Toolkit.Utilities.QuaternionSlerpUnclampedToRef(e,t,Math.min(1,o/i),n)},m.QuaternionSlerpUnclamped=function(e,t,o){var n=new M.Quaternion(0,0,0,1);return M.Toolkit.Utilities.QuaternionSlerpUnclampedToRef(e,t,o,n),n},m.QuaternionSlerpUnclampedToRef=function(e,t,o,n){},m.MoveTowardsVector2=function(e,t,o){var n=new M.Vector2(0,0);return M.Toolkit.Utilities.MoveTowardsVector2ToRef(e,t,o,n),n},m.MoveTowardsVector2ToRef=function(e,t,o,n){var i=t.x-e.x,l=t.y-e.y,r=i*i+l*l;0==r||0<=o&&r<=o*o?n.set(t.x,t.y):(t=Math.sqrt(r),n.set(e.x+i/t*o,e.y+l/t*o))},m.MoveTowardsVector3=function(e,t,o){var n=new M.Vector3(0,0,0);return M.Toolkit.Utilities.MoveTowardsVector3ToRef(e,t,o,n),n},m.MoveTowardsVector3ToRef=function(e,t,o,n){var i=t.x-e.x,l=t.y-e.y,r=t.z-e.z,a=i*i+l*l+r*r;0==a||0<=o&&a<=o*o?n.set(t.x,t.y,t.z):(t=Math.sqrt(a),n.set(e.x+i/t*o,e.y+l/t*o,e.z+r/t*o))},m.MoveTowardsVector4=function(e,t,o){var n=new M.Vector4(0,0,0,0);return M.Toolkit.Utilities.MoveTowardsVector4ToRef(e,t,o,n),n},m.MoveTowardsVector4ToRef=function(e,t,o,n){var i=t.x-e.x,l=t.y-e.y,r=t.z-e.z,a=t.w-e.w,s=i*i+l*l+r*r+a*a;0==s||0<=o&&s<=o*o?n.set(t.x,t.y,t.z,t.w):(t=Math.sqrt(s),n.set(e.x+i/t*o,e.y+l/t*o,e.z+r/t*o,e.w+a/t*o))},m.ClampMagnitudeVector2=function(e,t){var o=new M.Vector2(0,0);return M.Toolkit.Utilities.ClampMagnitudeVector2ToRef(e,t,o),o},m.ClampMagnitudeVector2ToRef=function(e,t,o){var n,i=e.lengthSquared();t*t<i&&(i=Math.sqrt(i),n=e.x/i,e=e.y/i,o.set(n*t,e*t))},m.ClampMagnitudeVector3=function(e,t){var o=new M.Vector3(0,0,0);return M.Toolkit.Utilities.ClampMagnitudeVector3ToRef(e,t,o),o},m.ClampMagnitudeVector3ToRef=function(e,t,o){var n,i,l=e.lengthSquared();t*t<l&&(l=Math.sqrt(l),n=e.x/l,i=e.y/l,e=e.z/l,o.set(n*t,i*t,e*t))},m.GetAngle=function(e,t){return M.Toolkit.Utilities.GetAngleRadians(e,t)*M.Toolkit.System.Rad2Deg},m.GetAngleRadians=function(e,t){return Math.acos(M.Vector3.Dot(e,t))},m.ClampAngle=function(e,t,o){for(var n=e;n<-360&&(n+=360),360<n&&(n-=360),n<-360||360<n;);return M.Scalar.Clamp(n,t,o)},m.ClampAngle180=function(e,t,o){return 180<e&&(e-=360),(e=M.Scalar.Clamp(e,t,o))<0&&(e+=360),e},m.ClampAngle360=function(e,t,o){return(e<90||270<e)&&(180<e&&(e-=360),180<o&&(o-=360),180<t)&&(t-=360),(e=M.Scalar.Clamp(e,t,o))<0&&(e+=360),e},m.SmoothDamp=function(e,t,o,n,i,l){var r,a,s;return l?(a=e-t,r=1/(1+(r=(s=2/(o=Math.max(1e-4,o)))*i)+.48*r*r+.235*r*r*r),t=t,o=e-(a=M.Scalar.Clamp(a,-(n=n*o),n)),n=(l.x+s*a)*i,l.x=(l.x-s*n)*r,0<t-e==t<(s=o+(a+n)*r)&&(l.x=((s=t)-t)/i),s):0},m.SmoothDampAngle=function(e,t,o,n,i,l){t=e+M.Scalar.DeltaAngle(e,t);return M.Toolkit.Utilities.SmoothDamp(e,t,o,n,i,l)},m.SmoothDampVector2=function(e,t,o,n,i,l){var r=new M.Vector2(0,0);return M.Toolkit.Utilities.SmoothDampVector2ToRef(e,t,o,n,i,l,r),r},m.SmoothDampVector2ToRef=function(e,t,o,n,i,l,r){var a=2/(o=Math.max(1e-4,o)),s=a*i,s=1/(1+s+.48*s*s+.235*s*s*s),u=e.x-t.x,c=e.y-t.y,p=t.clone(),n=n*o,o=u*u+c*c,o=(n*n<o&&(u=u/(o=Math.sqrt(o))*n,c=c/o*n),t.x=e.x-u,t.y=e.y-c,(l.x+a*u)*i),n=(l.y+a*c)*i,a=(l.x=(l.x-a*o)*s,l.y=(l.y-a*n)*s,t.x+(u+o)*s),u=t.y+(c+n)*s,o=p.x-e.x,t=p.y-e.y;0<o*(a-p.x)+t*(u-p.y)&&(a=p.x,u=p.y,l.x=(a-p.x)/i,l.y=(u-p.y)/i),r.set(a,u)},m.SmoothDampVector3=function(e,t,o,n,i,l){var r=new M.Vector3(0,0,0);return M.Toolkit.Utilities.SmoothDampVector3ToRef(e,t,o,n,i,l,r),r},m.SmoothDampVector3ToRef=function(e,t,o,n,i,l,r){var a=0,s=0,u=0,c=2/(o=Math.max(1e-4,o)),p=c*i,p=1/(1+p+.48*p*p+.235*p*p*p),d=e.x-t.x,h=e.y-t.y,m=e.z-t.z,g=t.clone(),n=n*o,o=d*d+h*h+m*m,o=(n*n<o&&(d=d/(o=Math.sqrt(o))*n,h=h/o*n,m=m/o*n),t.x=e.x-d,t.y=e.y-h,t.z=e.z-m,(l.x+c*d)*i),n=(l.y+c*h)*i,T=(l.z+c*m)*i,c=(l.x=(l.x-c*o)*p,l.y=(l.y-c*n)*p,l.z=(l.z-c*T)*p,a=t.x+(d+o)*p,s=t.y+(h+n)*p,u=t.z+(m+T)*p,g.x-e.x),d=g.y-e.y,o=g.z-e.z;0<c*(a-g.x)+d*(s-g.y)+o*(u-g.z)&&(a=g.x,s=g.y,u=g.z,l.x=(a-g.x)/i,l.y=(s-g.y)/i,l.z=(u-g.z)/i),r.set(a,s,u)},m.ToMatrix=function(e,t,o){return M.Matrix.RotationYawPitchRoll(M.Tools.ToRadians(t),M.Tools.ToRadians(e),M.Tools.ToRadians(o))},m.ToMatrixToRef=function(e,t,o,n){M.Matrix.RotationYawPitchRollToRef(M.Tools.ToRadians(t),M.Tools.ToRadians(e),M.Tools.ToRadians(o),n)},m.FastMatrixLerp=function(e,t,o,n){M.Matrix.LerpToRef(e,t,o,n)},m.FastMatrixSlerp=function(e,t,o,n){M.Matrix.DecomposeLerpToRef(e,t,o,n)},m.ToEuler=function(e){e=e.toEulerAngles();return e.x=M.Tools.ToDegrees(e.x),e.y=M.Tools.ToDegrees(e.y),e.z=M.Tools.ToDegrees(e.z),e},m.ToEulerToRef=function(e,t){e.toEulerAnglesToRef(t),t.x=M.Tools.ToDegrees(t.x),t.y=M.Tools.ToDegrees(t.y),t.z=M.Tools.ToDegrees(t.z)},m.FromEuler=function(e,t,o){return M.Quaternion.FromEulerAngles(M.Tools.ToRadians(e),M.Tools.ToRadians(t),M.Tools.ToRadians(o))},m.FromEulerToRef=function(e,t,o,n){M.Quaternion.FromEulerAnglesToRef(M.Tools.ToRadians(e),M.Tools.ToRadians(t),M.Tools.ToRadians(o),n)},m.QuaternionDiff=function(e,t){var o=new M.Quaternion(0,0,0,1);return M.Toolkit.Utilities.QuaternionDiffToRef(e,t,o),o},m.QuaternionDiffToRef=function(e,t,o){M.Quaternion.InverseToRef(t,M.Toolkit.Utilities.TempQuaternion),M.Toolkit.Utilities.TempQuaternion.multiplyToRef(e,o)},m.QuaternionSubtractToRef=function(e,t,o){o.set(e._x-t._x,e._y-t._y,e._z-t._z,e._w-t._w)},m.RotateVector=function(e,t){var o=2*(t.y*e.z-t.z*e.y),n=2*(t.z*e.x-t.x*e.z),i=2*(t.x*e.y-t.y*e.x);return new M.Vector3(e.x+t.w*o+(t.y*i-t.z*n),e.y+t.w*n+(t.z*o-t.x*i),e.z+t.w*i+(t.x*n-t.y*o))},m.RotateVectorToRef=function(e,t,o){var n=2*(t.y*e.z-t.z*e.y),i=2*(t.z*e.x-t.x*e.z),l=2*(t.x*e.y-t.y*e.x);o.x=e.x+t.w*n+(t.y*l-t.z*i),o.y=e.y+t.w*i+(t.z*n-t.x*l),o.z=e.z+t.w*l+(t.x*i-t.y*n)},m.LookRotation=function(e){var t=M.Quaternion.Zero();return M.Toolkit.Utilities.LookRotationToRef(e,t),t},m.LookRotationToRef=function(e,t){M.Toolkit.Utilities.TempMatrix.reset(),M.Matrix.LookAtLHToRef(M.Toolkit.Utilities.ZeroVector,e,M.Toolkit.Utilities.UpVector,M.Toolkit.Utilities.TempMatrix),M.Toolkit.Utilities.TempMatrix.invert(),M.Quaternion.FromRotationMatrixToRef(M.Toolkit.Utilities.TempMatrix,t)},m.Vector3Rad2Deg=function(e){var t=M.Vector3.Zero();return M.Toolkit.Utilities.Vector3Rad2DegToRef(e,t),t},m.Vector3Rad2DegToRef=function(e,t){t.x=M.Tools.ToDegrees(e.x),t.y=M.Tools.ToDegrees(e.y),t.z=M.Tools.ToDegrees(e.z)},m.MultiplyQuaternionByVector=function(e,t){var o=new M.Vector3(0,0,0);return M.Toolkit.Utilities.MultiplyQuaternionByVectorToRef(e,t,o),o},m.MultiplyQuaternionByVectorToRef=function(e,t,o){var n=2*e.x,i=2*e.y,l=2*e.z,r=e.x*n,a=e.y*i,s=e.z*l,u=e.x*i,c=e.x*l,p=e.y*l,n=e.w*n,i=e.w*i,e=e.w*l;o.x=(1-(a+s))*t.x+(u-e)*t.y+(c+i)*t.z,o.y=(u+e)*t.x+(1-(r+s))*t.y+(p-n)*t.z,o.z=(c-i)*t.x+(p+n)*t.y+(1-(r+a))*t.z},m.ValidateTransformRotation=function(e){null!=e.rotationQuaternion&&(e.rotation=e.rotationQuaternion.toEulerAngles(),e.rotationQuaternion=null)},m.ValidateTransformQuaternion=function(e){null==e.rotationQuaternion&&null!=e.rotation&&(e.rotationQuaternion=M.Quaternion.FromEulerAngles(e.rotation.x,e.rotation.y,e.rotation.z),e.rotation.set(0,0,0))},m.GetKeyboardInputValue=function(e,t,o){var n=o;return n=!0===M.Toolkit.UserInputOptions.KeyboardSmoothing&&(n=M.Scalar.MoveTowards(t,o,M.Toolkit.UserInputOptions.KeyboardMoveSensibility*M.Toolkit.SceneManager.GetDeltaSeconds(e)),Math.abs(n)<M.Toolkit.UserInputOptions.KeyboardMoveDeadZone)?0:n},m.GenerateRandonNumber=function(e,t,o){void 0===o&&(o=2);t=(Math.random()*(t-e)+e).toFixed(o);return parseFloat(t)},m.ProjectVector=function(e,t){var o=new M.Vector3(0,0,0);return M.Toolkit.Utilities.ProjectVectorToRef(e,t,o),o},m.ProjectVectorToRef=function(e,t,o){var n=M.Vector3.Dot(t,t);n<M.Toolkit.System.Epsilon?o.set(0,0,0):(e=M.Vector3.Dot(e,t),o.set(t.x*e/n,t.y*e/n,t.z*e/n))},m.ProjectVectorOnPlane=function(e,t){var o=new M.Vector3(0,0,0);return M.Toolkit.Utilities.ProjectVectorOnPlaneToRef(e,t,o),o},m.ProjectVectorOnPlaneToRef=function(e,t,o){var n,i=M.Vector3.Dot(t,t);i<M.Toolkit.System.Epsilon?o.copyFrom(e):(n=M.Vector3.Dot(e,t),o.set(e.x-t.x*n/i,e.y-t.y*n/i,e.z-t.z*n/i))},m.AreVectorsEqual=function(e,t,o){return Math.abs(e.x-t.x)<o&&Math.abs(e.y-t.y)<o&&Math.abs(e.z-t.z)<o},m.GetVerticalSlopeAngle=function(e,t){void 0===t&&(t=0);e=null!=(e=Math.atan(Math.abs(e.y/Math.sqrt(e.x*e.x+e.z*e.z)))*M.Toolkit.System.Rad2Deg)&&!1===Number.isNaN(e)?e:0;return e=0<t&&t<=e?0:e},m.DownloadEnvironment=function(o,n,t){void 0===n&&(n=null),void 0===t&&(t=null),M.EnvironmentTextureTools.CreateEnvTextureAsync(o).then(function(e){var t=o.name||"Environment",e=new Blob([e],{type:"octet/stream"});M.Tools.Download(e,t+".env"),null!=n&&n()}).catch(function(e){console.error(e),null!=t&&t()})},m.HasOwnProperty=function(e,t){return null!=e&&null!=t&&""!==t&&t in e},m.FindMeshCollider=function(e,t){var o=null;return t instanceof M.TransformNode&&!0==(null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.renderer&&null!=t.metadata.toolkit.renderer.hasmeshcollider&&!0===t.metadata.toolkit.renderer.hasmeshcollider)&&(t=t.id+"-collider",o=e.getMeshById(t)),o},m.ColliderInstances=function(){return null==M.Toolkit.SceneManager.GlobalOptions.colliderInstances||M.Toolkit.SceneManager.GlobalOptions.colliderInstances},m.ReparentColliders=function(){return null==M.Toolkit.SceneManager.GlobalOptions.reparentColliders||M.Toolkit.SceneManager.GlobalOptions.reparentColliders},m.UseTriangleNormals=function(){return null!=M.Toolkit.SceneManager.GlobalOptions.useTriangleNormals&&M.Toolkit.SceneManager.GlobalOptions.useTriangleNormals},m.UseConvexTriangles=function(){return null!=M.Toolkit.SceneManager.GlobalOptions.useConvexTriangles&&M.Toolkit.SceneManager.GlobalOptions.useConvexTriangles},m.DefaultRenderGroup=function(){return null!=M.Toolkit.SceneManager.GlobalOptions.defaultRenderGroup?M.Toolkit.SceneManager.GlobalOptions.defaultRenderGroup:0},m.ShowDebugColliders=function(){return!0===M.Toolkit.SceneManager.EnableDebugMode||null!=M.Toolkit.SceneManager.GlobalOptions.showDebugColliders&&M.Toolkit.SceneManager.GlobalOptions.showDebugColliders},m.ColliderVisibility=function(){return null!=M.Toolkit.SceneManager.GlobalOptions.colliderVisibility?M.Toolkit.SceneManager.GlobalOptions.colliderVisibility:0},m.ColliderRenderGroup=function(){return null!=M.Toolkit.SceneManager.GlobalOptions.colliderRenderGroup?M.Toolkit.SceneManager.GlobalOptions.colliderRenderGroup:0},m.CollisionWireframe=function(){return null!=M.Toolkit.SceneManager.GlobalOptions.collisionWireframe&&M.Toolkit.SceneManager.GlobalOptions.collisionWireframe},m.GetColliderMaterial=function(e){var t="Collider-Material",o=e.getMaterialByName(t);return null==o&&((t=new M.PBRMaterial(t,e)).albedoColor=new M.Color3(0,.75,0),t.wireframe=M.Toolkit.Utilities.CollisionWireframe(),t.unlit=!0,o=t),o},m.CalculateCombinedFriction=function(e,t){e*=t;return e=10<(e=e<-10?-10:e)?10:e},m.CalculateCombinedRestitution=function(e,t){return e*t},m.AddLoaderItemMarkedForDisposal=function(e){null==M.Toolkit.Utilities.LoaderItemsMarkedForDisposal&&(M.Toolkit.Utilities.LoaderItemsMarkedForDisposal=[]),M.Toolkit.Utilities.LoaderItemsMarkedForDisposal.push(e)},m.ResetLoaderItemsMarkedForDisposal=function(){M.Toolkit.Utilities.LoaderItemsMarkedForDisposal=[]},m.RemoveLoaderItemsMarkedForDisposal=function(){null!=M.Toolkit.Utilities.LoaderItemsMarkedForDisposal&&0<M.Toolkit.Utilities.LoaderItemsMarkedForDisposal.length&&M.Toolkit.Utilities.LoaderItemsMarkedForDisposal.forEach(function(e){try{e.dispose()}catch(e){console.warn(e)}}),M.Toolkit.Utilities.ResetLoaderItemsMarkedForDisposal()},m.GetDirectTargetAngle=function(e,t){return M.Toolkit.Utilities.TempVector3.set(0,0,0),M.Toolkit.Utilities.InverseTransformPointToRef(e,t,M.Toolkit.Utilities.TempVector3),Math.atan2(M.Toolkit.Utilities.TempVector3.x,M.Toolkit.Utilities.TempVector3.z)},m.GetSmoothTargetAngle=function(e,t){return M.Toolkit.Utilities.TempVector3.set(0,0,0),M.Toolkit.Utilities.InverseTransformPointToRef(e,t,M.Toolkit.Utilities.TempVector3),M.Toolkit.Utilities.TempVector3.x/M.Toolkit.Utilities.TempVector3.length()},m.CalculatCatmullRom=function(e,t,o,n,i){var l=new M.Vector3(0,0,0);return M.Toolkit.Utilities.CalculatCatmullRomToRef(e,t,o,n,i,l),l},m.CalculatCatmullRomToRef=function(e,t,o,n,i,l){},m.StartsWith=function(e,t){return 0===e.lastIndexOf(t,0)},m.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},m.ReplaceAll=function(e,t,o){return e.replace(new RegExp(t,"g"),o)},m.IsNullOrEmpty=function(e){return null==e||""===e},m.SafeStringPush=function(e,t){-1===e.indexOf(t)&&e.push(t)},m.ParseColor3=function(e,t,o){void 0===t&&(t=null),void 0===o&&(o=!1);return null!=e&&null!=e.r&&null!=e.g&&null!=e.b?!0===o?new M.Color3(e.r,e.g,e.b).toLinearSpace():new M.Color3(e.r,e.g,e.b):t},m.ParseColor4=function(e,t,o){void 0===t&&(t=null),void 0===o&&(o=!1);var n;return null!=e&&null!=e.r&&null!=e.g&&null!=e.b?(n=null!=e.a?e.a:1,!0===o?new M.Color4(e.r,e.g,e.b,n).toLinearSpace():new M.Color4(e.r,e.g,e.b,n)):t},m.ParseVector2=function(e,t){void 0===t&&(t=null);return null!=e&&null!=e.x&&null!=e.y?new M.Vector2(e.x,e.y):t},m.ParseVector3=function(e,t){void 0===t&&(t=null);return null!=e&&null!=e.x&&null!=e.y&&null!=e.z?new M.Vector3(e.x,e.y,e.z):t},m.ParseVector4=function(e,t){void 0===t&&(t=null);return null!=e&&null!=e.x&&null!=e.y&&null!=e.z&&null!=e.w?new M.Vector4(e.x,e.y,e.z,e.w):t},m.ParseSound=function(e,t,o,n,i){var l,r=null;return null!=e&&null!=e.filename&&""!==e.filename&&(l=M.Toolkit.SceneManager.GetRootUrl(t),e=e.filename,r=new M.Sound(o,l+e,t,n,i)),r},m.ParseTexture=function(e,t,o,n,i,l,r,a,s,u){var c,p=null;return null!=e&&null!=e.filename&&""!==e.filename&&(c=M.Toolkit.SceneManager.GetRootUrl(t),e=e.filename,p=new M.Texture(c+e,t,o,n,i,l,r,a,s,u)),p},m.ParseCubemap=function(e,t){var o,n=null;return null!=e&&null!=e.info&&(o=M.Toolkit.SceneManager.GetRootUrl(t)+e.info.rooturl,null!=(n=M.CubeTexture.Parse(e.info,t,o)))&&(n.gammaSpace=!1),n},m.ParseTextAsset=function(e,t){void 0===t&&(t=null);return null!=e&&null!=e.base64&&""!==e.base64?M.Toolkit.WindowManager.Atob(e.base64):t},m.ParseJsonAsset=function(e,t,o){void 0===o&&(o=null);e=M.Toolkit.Utilities.ParseTextAsset(e,t=void 0===t?null:t);return null!=e&&""!==e?JSON.parse(e,o):null},m.ParseTransformByID=function(e,t,o){void 0===o&&(o=null);return null!=e&&null!=e.id?M.Toolkit.SceneManager.GetTransformNodeByID(t,e.id):o},m.ParseTransformByName=function(e,t,o){void 0===o&&(o=null);return null!=e&&null!=e.id?M.Toolkit.SceneManager.GetTransformNode(t,e.id):o},m.ParseChildTransform=function(e,t,o){void 0===o&&(o=null);return null!=t&&null!=t.name?M.Toolkit.SceneManager.FindChildTransformNode(e,t.name,M.Toolkit.SearchType.IndexOf,!1):o},m.SetAbsolutePosition=function(e,t){e.setAbsolutePosition(t)},m.GetAbsolutePosition=function(e,t,o){return M.Toolkit.Utilities.TransformPoint(e,(t=void 0===t?null:t)||M.Toolkit.Utilities.ZeroVector,o=void 0===o?!0:o)},m.GetAbsolutePositionToRef=function(e,t,o,n){M.Toolkit.Utilities.TransformPointToRef(e,(o=void 0===o?null:o)||M.Toolkit.Utilities.ZeroVector,t,n=void 0===n?!0:n)},m.SetAbsoluteRotation=function(e,t){null==e.rotationQuaternion&&(e.rotationQuaternion=e.rotation.toQuaternion()),null!=e.parent&&e.parent instanceof M.TransformNode?(M.Toolkit.Utilities.TempQuaternion2.set(0,0,0,1),M.Toolkit.Utilities.GetAbsoluteRotationToRef(e.parent,M.Toolkit.Utilities.TempQuaternion2),M.Quaternion.InverseToRef(M.Toolkit.Utilities.TempQuaternion2,M.Toolkit.Utilities.TempQuaternion2),M.Toolkit.Utilities.TempQuaternion2.multiplyInPlace(t),e.rotationQuaternion.copyFrom(M.Toolkit.Utilities.TempQuaternion2)):e.rotationQuaternion.copyFrom(t)},m.GetAbsoluteRotation=function(e){var t=new M.Quaternion(0,0,0,1);return M.Toolkit.Utilities.GetAbsoluteRotationToRef(e,t),t},m.GetAbsoluteRotationToRef=function(e,t){var o,n,i;null!=e.parent&&e.parent instanceof M.TransformNode?(M.Toolkit.Utilities.GetAbsoluteRotationToRef(e.parent,t),null==e.rotationQuaternion&&(e.rotationQuaternion=e.rotation.toQuaternion()),t.multiplyInPlace(e.rotationQuaternion)):1==(i=e.scaling).x&&1==i.y&&1==i.z?t.copyFrom(e.absoluteRotationQuaternion):(o=1/i.x,n=1/i.y,i=1/i.z,e=e.getWorldMatrix()._m,M.Toolkit.Utilities.TempMatrix2.reset(),M.Matrix.FromValuesToRef(e[0]*o,e[1]*o,e[2]*o,0,e[4]*n,e[5]*n,e[6]*n,0,e[8]*i,e[9]*i,e[10]*i,0,0,0,0,1,M.Toolkit.Utilities.TempMatrix2),M.Toolkit.Utilities.TempQuaternion3.set(0,0,0,1),M.Toolkit.Utilities.TempMatrix2.decompose(void 0,M.Toolkit.Utilities.TempQuaternion3,void 0),t.copyFrom(M.Toolkit.Utilities.TempQuaternion3))},m.TransformPoint=function(e,t,o){return!0===(o=void 0===o?!0:o)&&e.computeWorldMatrix(),M.Vector3.TransformCoordinates(t,e.getWorldMatrix())},m.InverseTransformPoint=function(e,t,o){return!0===(o=void 0===o?!0:o)&&e.computeWorldMatrix(),M.Toolkit.Utilities.TempMatrix.reset(),e.getWorldMatrix().invertToRef(M.Toolkit.Utilities.TempMatrix),M.Vector3.TransformCoordinates(t,M.Toolkit.Utilities.TempMatrix)},m.TransformPointToRef=function(e,t,o,n){!0===(n=void 0===n?!0:n)&&e.computeWorldMatrix(),M.Vector3.TransformCoordinatesToRef(t,e.getWorldMatrix(),o)},m.InverseTransformPointToRef=function(e,t,o,n){!0===(n=void 0===n?!0:n)&&e.computeWorldMatrix(),M.Toolkit.Utilities.TempMatrix.reset(),e.getWorldMatrix().invertToRef(M.Toolkit.Utilities.TempMatrix),M.Vector3.TransformCoordinatesToRef(t,M.Toolkit.Utilities.TempMatrix,o)},m.TransformDirection=function(e,t,o){return!0===(o=void 0===o?!0:o)&&e.computeWorldMatrix(),M.Vector3.TransformNormal(t,e.getWorldMatrix())},m.InverseTransformDirection=function(e,t,o){return!0===(o=void 0===o?!0:o)&&e.computeWorldMatrix(),M.Toolkit.Utilities.TempMatrix.reset(),e.getWorldMatrix().invertToRef(M.Toolkit.Utilities.TempMatrix),M.Vector3.TransformNormal(t,M.Toolkit.Utilities.TempMatrix)},m.TransformDirectionToRef=function(e,t,o,n){!0===(n=void 0===n?!0:n)&&e.computeWorldMatrix(),M.Vector3.TransformNormalToRef(t,e.getWorldMatrix(),o)},m.InverseTransformDirectionToRef=function(e,t,o,n){!0===(n=void 0===n?!0:n)&&e.computeWorldMatrix(),M.Toolkit.Utilities.TempMatrix.reset(),e.getWorldMatrix().invertToRef(M.Toolkit.Utilities.TempMatrix),M.Vector3.TransformNormalToRef(t,M.Toolkit.Utilities.TempMatrix,o)},m.RecomputeCenterPivotPoint=function(e){var t=e.getBoundingInfo().boundingSphere.center;e.setPivotMatrix(M.Matrix.Translation(-t.x,-t.y,-t.z))},m.GetDirectionVector=function(e,t){return e.getDirection(t)},m.GetDirectionVectorToRef=function(e,t,o){e.getDirectionToRef(t,o)},m.GetForwardVector=function(e){return e.getDirection(M.Vector3.Forward())},m.GetForwardVectorToRef=function(e,t){e.getDirectionToRef(M.Vector3.Forward(),t)},m.GetRightVector=function(e){return e.getDirection(M.Vector3.Right())},m.GetRightVectorToRef=function(e,t){e.getDirectionToRef(M.Vector3.Right(),t)},m.GetUpVector=function(e){return e.getDirection(M.Vector3.Up())},m.GetUpVectorToRef=function(e,t){e.getDirectionToRef(M.Vector3.Up(),t)},m.BlendFloatValue=function(e,t,o){o=M.Scalar.Clamp(o,0,1);return 0<o?M.Scalar.Lerp(e,t,o):e},m.BlendVector2Value=function(e,t,o){o=M.Scalar.Clamp(o,0,1);0<o&&(t=M.Vector2.Lerp(e,t,o),e.copyFrom(t))},m.BlendVector3Value=function(e,t,o){o=M.Scalar.Clamp(o,0,1);0<o&&M.Vector3.LerpToRef(e,t,o,e)},m.BlendQuaternionValue=function(e,t,o){o=M.Scalar.Clamp(o,0,1);0<o&&M.Quaternion.SlerpToRef(e,t,o,e)},m.SetAnimationTargetProperty=function(e,t){null!=e&&(e.targetProperty=t,e.targetPropertyPath=e.targetProperty.split("."))},m.SampleAnimationFloat=function(e,t,o,n){void 0===o&&(o=M.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===n&&(n=!1);var i=0;return null!=e&&e.dataType===M.Animation.ANIMATIONTYPE_FLOAT&&(null==e._state&&(e._state={key:0,repeatCount:0,loopMode:o,workValue:M.Matrix.Zero()}),i=M.Toolkit.Utilities.InterpolateAnimation(e,t,e._state,n)),i},m.SampleAnimationVector2=function(e,t,o,n){void 0===o&&(o=M.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===n&&(n=!1);var i=null;return null!=e&&e.dataType===M.Animation.ANIMATIONTYPE_VECTOR2&&(null==e._state&&(e._state={key:0,repeatCount:0,loopMode:o,workValue:M.Matrix.Zero()}),i=M.Toolkit.Utilities.InterpolateAnimation(e,t,e._state,n)),i},m.SampleAnimationVector3=function(e,t,o,n){void 0===o&&(o=M.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===n&&(n=!1);var i=null;return null!=e&&e.dataType===M.Animation.ANIMATIONTYPE_VECTOR3&&(null==e._state&&(e._state={key:0,repeatCount:0,loopMode:o,workValue:M.Matrix.Zero()}),i=M.Toolkit.Utilities.InterpolateAnimation(e,t,e._state,n)),i},m.SampleAnimationQuaternion=function(e,t,o,n){void 0===o&&(o=M.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===n&&(n=!1);var i=null;return null!=e&&e.dataType===M.Animation.ANIMATIONTYPE_QUATERNION&&(null==e._state&&(e._state={key:0,repeatCount:0,loopMode:o,workValue:M.Matrix.Zero()}),i=M.Toolkit.Utilities.InterpolateAnimation(e,t,e._state,n)),i},m.SampleAnimationMatrix=function(e,t,o,n){void 0===o&&(o=M.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===n&&(n=!1);var i=null;return null!=e&&e.dataType===M.Animation.ANIMATIONTYPE_MATRIX&&(null==e._state&&(e._state={key:0,repeatCount:0,loopMode:o,workValue:M.Matrix.Zero()}),i=M.Toolkit.Utilities.InterpolateAnimation(e,t,e._state,n)),i},m.CreateTweenAnimation=function(e,t,o,n,i,l){void 0===i&&(i=30),void 0===l&&(l=M.Animation.ANIMATIONLOOPMODE_RELATIVE);var r=[],o=(r.push({frame:0,value:o}),r.push({frame:i,value:n}),new M.Animation(e,t,i,M.Animation.ANIMATIONTYPE_FLOAT,l));return o.setKeys(r),o},m.GetLastKeyFrameIndex=function(e){var t=0;return t=null!=e&&null!=(e=e.getKeys())&&0<e.length&&null!=(e=e[e.length-1])?e.frame:t},m.InterpolateAnimation=function(e,t,o,n){n=!0===(n=void 0===n?!1:n)?t*M.Toolkit.SceneManager.AnimationTargetFps:t;return e._interpolate(n,o)},m.UpdateLoopBlendPositionSettings=function(e,t,o){null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.settings&&(e.metadata.toolkit.settings.loopblendpositiony=t,e.metadata.toolkit.settings.loopblendpositionxz=o)},m.InitializeShaderMaterial=function(r,e,t){void 0===e&&(e=!0),void 0===t&&(t=!1);var a=r,o=M.Toolkit.Utilities.HasOwnProperty(a,"getShaderName")?a.getShaderName():"glsl",n=!!M.Toolkit.Utilities.HasOwnProperty(a,"getAlphaBlending")&&a.getAlphaBlending(),i=!!M.Toolkit.Utilities.HasOwnProperty(a,"getAlphaTesting")&&a.getAlphaTesting(),l=M.Toolkit.Utilities.HasOwnProperty(a,"getDefaultDefines")?a.getDefaultDefines():null,s=M.Toolkit.Utilities.HasOwnProperty(a,"getDefaultAttributes")?a.getDefaultAttributes():null,u=M.Toolkit.Utilities.HasOwnProperty(a,"getDefaultUniforms")?a.getDefaultUniforms():null,o=((null==l||l.length<=0)&&(l=["#define GAMETIME","#define DELTATIME","#define DIFFUSECOLOR","#define DIFFUSETEXTURE"]),{vertex:o,fragment:o}),n={needAlphaBlending:n,needAlphaTesting:i,attributes:s=null==s||s.length<=0?["position","normal","uv","uv2","color"]:s,uniforms:u=null==u||u.length<=0?["world","worldView","worldViewProjection","view","projection","viewProjection","gameTime","deltaTime","diffuseColor","diffuseTexture","diffuseTextureInfos","diffuseTextureMatrix"]:u,defines:l,useClipPlane:t,samplers:[],uniformBuffers:[],externalTextures:[],samplerObjects:[],storageBuffers:[]};a._shaderPath=o,a._options=n,!0===e&&(a.fn_afterBind=a.bind,a.bind=function(e,t,o){if(void 0===o&&(o=null),null!=a.updateGlobalTime&&a.updateGlobalTime(),a.after&&a.after(),a.fn_afterBind)try{a.fn_afterBind(e,t,o)}catch(e){}var n=null!=o?o:a.getEffect();if(r.getScene().texturesEnabled&&null!=n)for(var i in a._textures){var l=a._textures[i];null!=l&&(n.setFloat2(i+"Infos",l.coordinatesIndex,l.level),n.setMatrix(i+"Matrix",l.getTextureMatrix()))}}),a.awake&&a.awake()},m.WorldToScreenPoint=function(e,t,o){var n=null,o=null!=(o=void 0===o?null:o)?o.viewport:null!=e.activeCamera?e.activeCamera.viewport:null;return n=null!=o?M.Vector3.Project(t,M.Matrix.Identity(),e.getTransformMatrix(),o.toGlobal(e.getEngine().getRenderWidth(),e.getEngine().getRenderHeight())):n},m.ScreenToWorldPoint=function(e,t){return M.Vector3.Unproject(t,e.getEngine().getRenderWidth(),e.getEngine().getRenderHeight(),M.Matrix.Identity(),e.getViewMatrix(),e.getProjectionMatrix())},m.LoadTextFile=function(e,t,o,n){return M.Tools.LoadFile(e,t,o,null,!1,n)},m.LoadTextFileAsync=function(e){return M.Tools.LoadFileAsync(e,!1)},m.GetHttpRequest=function(e,t,o,n,i,l,r){void 0===t&&(t=null),void 0===o&&(o=null),void 0===n&&(n=null),void 0===i&&(i=null),void 0===l&&(l=!1),void 0===r&&(r=null);var a=new XMLHttpRequest;return a.open("GET",e,!0),!0===l&&(a.responseType="arraybuffer"),null!=r&&a.overrideMimeType(r),null!=t&&t.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&a.setRequestHeader(e.name,e.value)}),a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&null!=o&&o(a)},a.onprogress=function(e){null!=i&&i(e)},a.onerror=function(){null!=n&&n("Failed to get data from server.")},a.onabort=function(){null!=n&&n("Aborted get data from server.")},a.send(null),a},m.GetHttpRequestAsync=function(e,n,i,l,r){return void 0===n&&(n=null),void 0===i&&(i=null),void 0===l&&(l=!1),void 0===r&&(r=null),new Promise(function(t,o){M.Toolkit.Utilities.GetHttpRequest(e,n,function(e){t(e)},function(e){o(e)},i,l,r)})},m.PostHttpRequest=function(e,t,o,n,i,l,r,a,s){void 0===o&&(o=null),void 0===n&&(n="application/x-www-form-urlencoded"),void 0===i&&(i=null),void 0===l&&(l=null),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===s&&(s=null);var u=new XMLHttpRequest;return u.open("POST",e,!0),!0===a&&(u.responseType="arraybuffer"),null!=s&&u.overrideMimeType(s),null!=o&&o.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&u.setRequestHeader(e.name,e.value)}),u.setRequestHeader("Content-Type",n),u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&null!=i&&i(u)},u.onprogress=function(e){null!=r&&r(e)},u.onerror=function(){null!=l&&l("Failed to post data to server.")},u.onabort=function(){null!=l&&l("Aborted post data to server.")},u.send(t),u},m.PostHttpRequestAsync=function(e,n,i,l,r,a,s){return void 0===i&&(i=null),void 0===l&&(l="application/x-www-form-urlencoded"),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===s&&(s=null),new Promise(function(t,o){M.Toolkit.Utilities.PostHttpRequest(e,n,i,l,function(e){t(e)},function(e){o(e)},r,a,s)})},m.RemapValueToRange=function(e,t,o,n,i){return n+(e-t)*(i-n)/(o-t)},m.CloneSkeletonPrefab=function(e,t,o,n,i){void 0===i&&(i=null);var l=new M.Skeleton(o,n||o,e);l.needInitialSkinMatrix=t.needInitialSkinMatrix;for(var r=0;r<t.bones.length;r++){var a=t.bones[r],s=null,u=a.getParent(),u=(u&&(u=t.bones.indexOf(u),s=l.bones[u]),new M.Bone(a.name,l,s,a.getBaseMatrix().clone(),a.getRestPose().clone()));u._index=a._index,u.metadata=a.metadata,a._linkedTransformNode&&u.linkTransformNode(a._linkedTransformNode),M.DeepCopier.DeepCopy(a.animations,u.animations)}var c=l,p=t;if(p._ranges)for(var d in c._ranges={},p._ranges){var h=p._ranges[d];h&&(c._ranges[d]=h.clone())}return p._isDirty=!0,l},m.GetSceneTransforms=function(e){var t=null;return null!=e.transformNodes&&0<e.transformNodes.length&&e.transformNodes.forEach(function(e){null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.prefab&&!1===e.metadata.toolkit.prefab&&(t=null==t?[]:t).push(e)}),null!=e.meshes&&0<e.meshes.length&&e.meshes.forEach(function(e){null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.prefab&&!1===e.metadata.toolkit.prefab&&(t=null==t?[]:t).push(e)}),t},m.PostParseSceneComponents=function(e,t,o,n){var i=new M.Toolkit.MetadataParser(e);return null!=t&&0<t.length&&(t.forEach(function(e){i.parseSceneComponents(e)}),i.postProcessSceneComponents(o,n)),i},m.GetAssetContainerMesh=function(e,t){var o=null,n=t.toLowerCase();if(null==o&&null!=e.meshes&&0<e.meshes.length)for(var i=0;i<e.meshes.length;i++){var l=e.meshes[i];if(l instanceof M.Mesh&&l.name.toLowerCase()===n){o=l;break}}return o},m.GetAssetContainerNode=function(e,t){var o=null,n=t.toLowerCase();if(null==o&&null!=e.transformNodes&&0<e.transformNodes.length)for(var i=0;i<e.transformNodes.length;i++){var l=e.transformNodes[i];if(l.name.toLowerCase()===n){o=l;break}}return o},m.CloneAssetContainerItem=function(u,e,c,t,s,o){void 0===t&&(t=null),void 0===s&&(s=!1),void 0===o&&(o=!0);function p(e,t){null==k&&(k=t),d[e.uniqueId]=t.uniqueId,h[t.uniqueId]=t,c&&(t.name=c(e.name)),null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.entity&&(t.metadata=M.Toolkit.Utilities.CloneEntityMetadata(e.metadata));var o=null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.animator?t.metadata.toolkit.animator:null;if(null!=o&&""!==o&&((g=null==g?[]:g).indexOf(o)<0&&g.push(o),t.metadata.toolkit.animator=M.Toolkit.Utilities.CreateGuid(),m[o]=t.metadata.toolkit.animator),e instanceof M.AbstractMesh&&null!=e.skeleton&&(T=null==T?[]:T).indexOf(e.skeleton)<0&&T.push(e.skeleton),t instanceof M.Mesh){var n=t;if(n.morphTargetManager){var i=e.morphTargetManager;n.morphTargetManager=i.clone();for(var l=0;l<i.numTargets;l++){var r=i.getTarget(l),a=n.morphTargetManager.getTarget(l);d[r.uniqueId]=a.uniqueId,h[a.uniqueId]=a}}}}var n,i=null,d={},h={},m={},g=null,T=null,f=[],y=[],l=e.toLowerCase(),k=null;if(null==i&&null!=u.transformNodes&&0<u.transformNodes.length)for(var r=0;r<u.transformNodes.length;r++){var a=u.transformNodes[r];if(a.name.toLowerCase()===l){a=M.Toolkit.Utilities.InstantiateHierarchy(a,t,function(e,t){p(e,t)});if(a){i=a;break}}}if(null==i&&null!=u.meshes&&0<u.meshes.length)for(r=0;r<u.meshes.length;r++)if("break"===function(e){var a=u.meshes[e];if(a.name.toLowerCase()===l){e=M.Toolkit.Utilities.InstantiateHierarchy(a,t,function(e,t){p(e,t);var o=t;if(!0===a.isWorldMatrixFrozen&&o.freezeWorldMatrix&&o.freezeWorldMatrix(),t.material&&o.material)if(!0===s){t=e.material;if(-1===y.indexOf(t)){var n=t.clone(c?c(t.name):"Clone of "+t.name);if(!0===t.isFrozen&&n.freeze&&n.freeze(),y.push(t),d[t.uniqueId]=n.uniqueId,h[n.uniqueId]=n,"MultiMaterial"===t.getClassName())for(var i=0,l=t.subMaterials;i<l.length;i++){var r=l[i];r&&(n=r.clone(c?c(r.name):"Clone of "+r.name),!0===r.isFrozen&&n.freeze&&n.freeze(),y.push(r),d[r.uniqueId]=n.uniqueId,h[n.uniqueId]=n)}}o.material=h[d[t.uniqueId]]}else"MultiMaterial"===o.material.getClassName()?-1===u.scene.multiMaterials.indexOf(o.material)&&u.scene.addMultiMaterial(o.material):-1===u.scene.materials.indexOf(o.material)&&u.scene.addMaterial(o.material)});if(e)return i=e,"break"}}(r))break;return null!=T&&0<T.length&&T.forEach(function(e){for(var t=c?c(e.name):"Clone of "+e.name,o=M.Toolkit.Utilities.CloneSkeletonPrefab(u.scene,e,t,t,k),n=0,i=u.meshes;n<i.length;n++){var l=i[n];if(l.skeleton===e&&!l.isAnInstance){l=h[d[l.uniqueId]];if(l.skeleton=o,-1===f.indexOf(o)){f.push(o);for(var r=0,a=o.bones;r<a.length;r++){var s=a[r];s._linkedTransformNode&&(s._linkedTransformNode=h[d[s._linkedTransformNode.uniqueId]])}}}}}),!0===o&&(n=null,u.animationGroups.forEach(function(e){var t=e,o=null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.source&&""!==t.metadata.toolkit.source?t.metadata.toolkit.source:null;null!=o&&""!==o&&null!=g&&0<=g.indexOf(o)&&(e=e.clone(e.name,function(e){return h[d[e.uniqueId]]||e}),o=m[o]||o,null!=t.metadata&&(e.metadata={},e.metadata.toolkit={},e.metadata.toolkit.id=t.metadata.toolkit.id,e.metadata.toolkit.clip=t.metadata.toolkit.clip,e.metadata.toolkit.source=o,e.metadata.toolkit.legacy=t.metadata.toolkit.legacy,e.metadata.toolkit.length=t.metadata.toolkit.length,e.metadata.toolkit.looping=t.metadata.toolkit.looping,e.metadata.toolkit.settings=t.metadata.toolkit.settings,e.metadata.toolkit.behavior=t.metadata.toolkit.behavior,e.metadata.toolkit.wrapmode=t.metadata.toolkit.wrapmode,e.metadata.toolkit.framerate=t.metadata.toolkit.framerate,e.metadata.toolkit.humanmotion=t.metadata.toolkit.humanmotion,e.metadata.toolkit.averagespeed=t.metadata.toolkit.averagespeed,e.metadata.toolkit.averageduration=t.metadata.toolkit.averageduration,e.metadata.toolkit.averageangularspeed=t.metadata.toolkit.averageangularspeed),(n=null==n?[]:n).push(e))}),null!=i)&&null!=n&&M.Toolkit.Utilities.AssignAnimationGroupsToInstance(i,n),i},m.AssignAnimationGroupsToInstance=function(e,t){M.Toolkit.Utilities.AssignAnimationGroupsToNode(e,t);e=e.getChildren(null,!1);null!=e&&0<e.length&&e.forEach(function(e){M.Toolkit.Utilities.AssignAnimationGroupsToNode(e,t)})},m.AssignAnimationGroupsToNode=function(e,t){if(null!=e&&null!=e.metadata&&e.metadata.toolkit){var o=e.metadata.toolkit;if(null!=o.components&&0<o.components.length)for(var n=0;n<o.components.length;n++)if("BABYLON.Toolkit.AnimationState"===o.components[n].klass){e.metadata.toolkit.sourceAnimationGroups=t;break}}},m.InstantiateHierarchy=function(e,t,o){var n;return void 0===t&&(t=null),e instanceof M.Mesh?(n=null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.instance&&!0===e.metadata.toolkit.instance,M.Toolkit.Utilities.InstantiateMeshHierarchy(e,t,n,o)):M.Toolkit.Utilities.InstantiateNodeHierarchy(e,t,o)},m.InstantiateNodeHierarchy=function(e,t,o){var n=e.clone("Clone of "+(e.name||e.id),t=void 0===t?null:t,!0);n&&o&&o(e,n);for(var i=0,l=e.getChildTransformNodes(!0);i<l.length;i++){var r=l[i];M.Toolkit.Utilities.InstantiateHierarchy(r,n,o)}return n},m.InstantiateMeshHierarchy=function(e,t,o,n){void 0===t&&(t=null);var i=0<e.getTotalVertices()&&!0===o?e.createInstance("Instance of "+(e.name||e.id)):e.clone("Clone of "+(e.name||e.id),t||e.parent,!0);i&&(i.parent=t,i.position=e.position.clone(),i.scaling=e.scaling.clone(),e.rotationQuaternion?i.rotationQuaternion=e.rotationQuaternion.clone():i.rotation=e.rotation.clone(),n)&&n(e,i);for(var l=0,r=e.getChildTransformNodes(!0);l<r.length;l++){var a=r[l];M.Toolkit.Utilities.InstantiateHierarchy(a,i,n)}return i},m.RetargetAnimationGroupSkeleton=function(e,n,i){void 0===i&&(i=null),null!=e&&null!=n&&e.targetedAnimations.forEach(function(t,e){var o;null!=t.target&&null!=t.target.name&&(null!=(o=n.bones.filter(function(e){return e.name.toLowerCase()===t.target.name.toLowerCase()})[0])?null!=o.getTransformNode()&&(t.target=o.getTransformNode()):"Armature"===t.target.name&&null!=i?t.target=i:console.warn("Failed to locate matching animation cloning target: "+t.target.name))})},m.RetargetAnimationGroupBlendShapes=function(e,t){null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,t){null!=e.target&&e.target.name})},m.LinkSkeletonMeshes=function(e,t){if(null!=e&&null!=e.bones&&0<e.bones.length&&null!=t&&null!=t.bones&&0<t.bones.length)for(var o=t.bones.length,n=0;n<o;n++){var i,l=t.bones[n];null!=l&&(null!=(i=M.Toolkit.Utilities.FindBoneByName(e,l.name))?l._linkedTransformNode=i._linkedTransformNode:console.warn("Failed to locate bone on mater rig: "+l.name))}},m.FindBoneByName=function(e,t){var o=null;if(null!=e&&null!=e.bones)for(var n=0;n<e.bones.length;n++){var i=e.bones[n];if(i.name.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right")===t.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right")){o=i;break}}return o},m.SwitchHandednessVector3=function(e){return new M.Vector3(e.x,e.y,-e.z)},m.SwitchHandednessVector4=function(e){return new M.Vector4(e.x,e.y,-e.z,-e.w)},m.SwitchHandednessQuaternion=function(e){return new M.Quaternion(e.x,e.y,-e.z,-e.w)},m.ComputeBlendingSpeed=function(e,t,o){e=1/(e*t);return!0===(o=void 0===o?!1:o)&&(e*=.5),e},m.CalculateCameraDistance=function(e,t,o){void 0===o&&(o=1);return Math.round(e*o*t*1)},m.InstantiateClass=function(e){for(var t=e.split("."),o=window||globalThis||this,n=0,i=t.length;n<i;n++)o=o[t[n]];return"function"==typeof o?o:null},m.GetSimpleClassName=function(e){if(e&&e.constructor&&e.constructor.toString){e=e.constructor.toString().match(/function\s*(\w+)/);if(e&&2==e.length)return e[1]}},m.DisposeEntity=function(e){var t;null!=e&&(null!=e.metadata&&e.metadata.toolkit&&(null!=(t=e.metadata.toolkit).components&&0<t.components.length&&t.components.forEach(function(e){if(null!=e.instance){try{M.Toolkit.SceneManager.DestroyScriptComponent(e.instance)}catch(e){}e.instance=null}}),delete e.metadata.toolkit),null!=e.metadata&&e.metadata.mixer&&delete e.metadata.mixer,null!=e.metadata&&null!=e.metadata.clone&&delete e.metadata.clone,null!=e.physicsImpostor&&(null!=(t=e.physicsImpostor).onCollideEvent&&(t.onCollideEvent=null),null!=t.tmpCollisionObjects&&delete t.tmpCollisionObjects,null!=e.physicsImpostor.physicsBody&&(null!=e.physicsImpostor.physicsBody.entity&&delete e.physicsImpostor.physicsBody.entity,null!=e.physicsImpostor.physicsBody.triangleMapInfo)&&delete e.physicsImpostor.physicsBody.triangleMapInfo,e.physicsImpostor.dispose(),e.physicsImpostor=null),null!=e.skeleton&&(null!=e.skeleton._sockets&&delete e.skeleton._sockets,null!=e.skeleton.bones)&&0<e.skeleton.bones.length&&e.skeleton.bones.forEach(function(e){null!=e&&null!=e.metadata&&(e.metadata=null)}),null!=e.cameraRig&&(e.cameraRig.dispose&&e.cameraRig.dispose(),delete e.cameraRig),null!=e.lightRig&&(e.lightRig.dispose&&e.lightRig.dispose(),delete e.lightRig),null!=e.shadowBox&&(e.shadowBox.dispose&&e.shadowBox.dispose(),delete e.shadowBox),null!=e._debugCollider&&(e._debugCollider.dispose&&e._debugCollider.dispose(),delete e._debugCollider),null!=e._meshCollider&&(e._meshCollider=null),null!=e._colliderType&&delete e._colliderType,null!=e._skinnedMesh)&&delete e._skinnedMesh},m.SearchTransformNodes=function(e,t,o){var n=null,i=null!=(o=void 0===o?M.Toolkit.SearchType.ExactMatch:o)?o:M.Toolkit.SearchType.ExactMatch;if(null!=t&&0<t.length)for(var l=0;l<t.length;l++){var r=t[l];if(i===M.Toolkit.SearchType.ExactMatch){if(r.name===e){n=r;break}}else if(i===M.Toolkit.SearchType.StartsWith){if(M.Toolkit.Utilities.StartsWith(r.name,e)){n=r;break}}else if(i===M.Toolkit.SearchType.EndsWith){if(M.Toolkit.Utilities.EndsWith(r.name,e)){n=r;break}}else if(i===M.Toolkit.SearchType.IndexOf){if(0<=r.name.indexOf(e)){n=r;break}}else if(r.name===e){n=r;break}}return n},m.SearchTransformNodeForTags=function(e,t){var o=null;if(null!=t&&0<t.length)for(var n=0;n<t.length;n++){var i=t[n];if(i instanceof M.TransformNode&&M.Tags.MatchesQuery(i,e)){o=i;break}}return o},m.SearchAllTransformNodesForTags=function(e,t){var o=null;if(null!=t&&0<t.length)for(var n=0;n<t.length;n++){var i=t[n];i instanceof M.TransformNode&&M.Tags.MatchesQuery(i,e)&&(o=null==o?[]:o).push(i)}return o},m.SearchTransformNodeForScript=function(e,t){var o=null;if(null!=t&&0<t.length)for(var n=0;n<t.length;n++){var i=t[n];if(i instanceof M.TransformNode)if(null!=M.Toolkit.SceneManager.FindScriptComponent(i,e)){o=i;break}}return o},m.SearchAllTransformNodesForScript=function(e,t){var o=null;if(null!=t&&0<t.length)for(var n=0;n<t.length;n++){var i=t[n];i instanceof M.TransformNode&&null!=M.Toolkit.SceneManager.FindScriptComponent(i,e)&&(o=null==o?[]:o).push(i)}return o},m.CreateGuid=function(e){void 0===e&&(e=null);var t=M.Tools.RandomId();return M.Toolkit.Utilities.IsNullOrEmpty(e)||(t+="-"+e),t},m.ValidateTransformGuid=function(e){var t;null!=e&&null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.guid&&""!==e.metadata.toolkit.guid&&(t=e.metadata.toolkit.guid,e.id!==t&&(e.id=t),delete e.metadata.toolkit.guid)},m.AddShadowCastersToLight=function(t,e,o){void 0===o&&(o=!1);var n=t.getShadowGenerator();if(null!=n){var i=n.getShadowMap();if(null!=i)for(var l=0;l<e.length;l++){var r=e[l];r instanceof M.AbstractMesh&&(null!=t.includedOnlyMeshes&&0<t.includedOnlyMeshes.length&&t.includedOnlyMeshes.indexOf(r)<0&&t.includedOnlyMeshes.push(r),null==i.renderList&&(i.renderList=[]),i.renderList.indexOf(r)<0)&&i.renderList.push(r),!0===o&&null!=(r=r.getChildMeshes())&&0<r.length&&r.forEach(function(e){null!=t.includedOnlyMeshes&&0<t.includedOnlyMeshes.length&&t.includedOnlyMeshes.indexOf(e)<0&&t.includedOnlyMeshes.push(e),null==i.renderList&&(i.renderList=[]),i.renderList.indexOf(e)<0&&i.renderList.push(e)})}}},m.RegisterInstancedMeshBuffers=function(t){var e=null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.buffers?t.metadata.toolkit.buffers:null;null!=e&&(null!=e.floats&&0<e.floats.length&&e.floats.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,1),t.instancedBuffers[e.kind]=e.value)}),null!=e.colors&&0<e.colors.length&&e.colors.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,4),t.instancedBuffers[e.kind]=new M.Color4(e.value.r||0,e.value.g||0,e.value.b||0,e.value.a||1).toLinearSpace())}),null!=e.vector2&&0<e.vector2.length&&e.vector2.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,2),t.instancedBuffers[e.kind]=new M.Vector2(e.value.x||0,e.value.y||0))}),null!=e.vector3&&0<e.vector3.length&&e.vector3.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,3),t.instancedBuffers[e.kind]=new M.Vector3(e.value.x||0,e.value.y||0,e.value.z||0))}),null!=e.vector4)&&0<e.vector4.length&&e.vector4.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,4),t.instancedBuffers[e.kind]=new M.Vector4(e.value.x||0,e.value.y||0,e.value.z||0,e.value.w||0))})},m.CloneValue=function(e,t){return!e||e instanceof M.Mesh?null:e instanceof M.SubMesh?e.clone(t):e.clone?e.clone():e},m.CloneEntityMetadata=function(e){var t,o,n,i,l,r,a,s,u,c,p,d,h,m,g,T,f,y,k,_,v,b,C,S,I=null;return I=null!=e&&((t=null)!=e.toolkit&&(o=null!=e.toolkit.instance&&e.toolkit.instance,n=null==e.toolkit.visible||e.toolkit.visible,i=null!=e.toolkit.visibility?e.toolkit.visibility:1,l=null!=e.toolkit.billboard?e.toolkit.billboard:0,r=null!=e.toolkit.tags?e.toolkit.tags:"Untagged Layer0",a=null!=e.toolkit.skin&&e.toolkit.skin,s=null!=e.toolkit.bone?e.toolkit.bone:null,u=null!=e.toolkit.rootbone&&e.toolkit.rootbone,c=null!=e.toolkit.rootpos?e.toolkit.rootpos:null,p=null!=e.toolkit.rootrot?e.toolkit.rootrot:null,d=null!=e.toolkit.group?e.toolkit.group:"Untagged",h=null!=e.toolkit.layer?e.toolkit.layer:0,m=null!=e.toolkit.layername?e.toolkit.layername:"Default",g=null!=e.toolkit.navigation?e.toolkit.navigation:null,T=null!=e.toolkit.lightmapped&&e.toolkit.lightmapped,f=null!=e.toolkit.lightmapuvs?e.toolkit.lightmapuvs:null,y=null!=e.toolkit.animator?e.toolkit.animator:null,b=v=_=k=null,e.toolkit.physics&&M.Toolkit.Utilities.DeepCopyProperties(e.toolkit.physics,k={}),e.toolkit.renderer&&M.Toolkit.Utilities.DeepCopyProperties(e.toolkit.renderer,_={}),e.toolkit.collision&&M.Toolkit.Utilities.DeepCopyProperties(e.toolkit.collision,v={}),e.toolkit.properties&&M.Toolkit.Utilities.DeepCopyProperties(e.toolkit.properties,b={}),(C=null)!=e.toolkit.wheels&&0<e.toolkit.wheels.length&&(C=[],e.toolkit.wheels.forEach(function(e){null!=e&&(M.Toolkit.Utilities.DeepCopyProperties(e,e={}),C.push(e))})),(S=null)!=e.toolkit.components&&0<e.toolkit.components.length&&(S=[],e.toolkit.components.forEach(function(e){null!=e&&((e=M.Toolkit.Utilities.FastJsonCopy(e)).instance=null,S.push(e))})),(t={parsed:!1,prefab:!1,buffers:null,lods:null,coverages:null,distances:null,handlers:null}).instance=o,t.visible=n,t.visibility=i,t.billboard=l,t.tags=r,t.skin=a,t.bone=s,t.rootbone=u,t.rootpos=c,t.rootrot=p,t.group=d,t.layer=h,t.layername=m,t.navigation=g,t.lightmapped=T,t.lightmapuvs=f,t.animator=y,t.renderer=_,t.physics=k,t.wheels=C,t.collision=v,t.properties=b,t.components=S),null!=t)?{toolkit:t}:I},m.FastJsonCopy=function(e){if(!e)return e;if(Array.isArray(e)){for(var t=[],o=e.length,n=0;n<o;n++)t.push(M.Toolkit.Utilities.FastJsonCopy(e[n]));return t}if("object"!=typeof e)return e;for(var i=Object.keys(e),l={},n=i.length-1;-1<n;n--){var r=i[n];l[r]=M.Toolkit.Utilities.FastJsonCopy(e[r])}return l},m.DeepCopyProperties=function(e,t,o,n){for(var i in e)if(("_"!==i[0]||n&&-1!==n.indexOf(i))&&(!o||-1===o.indexOf(i))){var l=e[i],r=typeof l;if("function"!=r)if("object"==r)if(l instanceof Array){if(t[i]=[],0<l.length)if("object"==typeof l[0])for(var a=0;a<l.length;a++){var s=M.Toolkit.Utilities.CloneValue(l[a],t);-1===t[i].indexOf(s)&&t[i].push(s)}else t[i]=l.slice(0)}else t[i]=M.Toolkit.Utilities.CloneValue(l,t);else t[i]=l}},m.ValidateTransformMetadata=function(e){null==e.metadata&&(e.metadata={}),null==e.metadata.toolkit&&(e.metadata.toolkit={});var t=e.metadata.toolkit;M.Toolkit.Utilities.HasOwnProperty(t,"entity")||(e.metadata.toolkit.entity=!0),M.Toolkit.Utilities.HasOwnProperty(t,"parsed")||(e.metadata.toolkit.parsed=!1),M.Toolkit.Utilities.HasOwnProperty(t,"prefab")||(e.metadata.toolkit.prefab=!1),M.Toolkit.Utilities.HasOwnProperty(t,"instance")||(e.metadata.toolkit.instance=!1),M.Toolkit.Utilities.HasOwnProperty(t,"buffers")||(e.metadata.toolkit.buffers=null),M.Toolkit.Utilities.HasOwnProperty(t,"visible")||(e.metadata.toolkit.visible=!0),M.Toolkit.Utilities.HasOwnProperty(t,"visibility")||(e.metadata.toolkit.visibility=1),M.Toolkit.Utilities.HasOwnProperty(t,"billboard")||(e.metadata.toolkit.billboard=0),M.Toolkit.Utilities.HasOwnProperty(t,"tags")||(e.metadata.toolkit.tags="Untagged Layer0"),M.Toolkit.Utilities.HasOwnProperty(t,"skin")||(e.metadata.toolkit.skin=!1),M.Toolkit.Utilities.HasOwnProperty(t,"bone")||(e.metadata.toolkit.bone=null),M.Toolkit.Utilities.HasOwnProperty(t,"rootbone")||(e.metadata.toolkit.rootbone=!1),M.Toolkit.Utilities.HasOwnProperty(t,"rootpos")||(e.metadata.toolkit.rootpos=null),M.Toolkit.Utilities.HasOwnProperty(t,"rootrot")||(e.metadata.toolkit.rootrot=null),M.Toolkit.Utilities.HasOwnProperty(t,"group")||(e.metadata.toolkit.group="Untagged"),M.Toolkit.Utilities.HasOwnProperty(t,"layer")||(e.metadata.toolkit.layer=0),M.Toolkit.Utilities.HasOwnProperty(t,"layername")||(e.metadata.toolkit.layername="Default"),M.Toolkit.Utilities.HasOwnProperty(t,"navigation")||(e.metadata.toolkit.navigation=null),M.Toolkit.Utilities.HasOwnProperty(t,"lightmapped")||(e.metadata.toolkit.lightmapped=!1),M.Toolkit.Utilities.HasOwnProperty(t,"lightmapuvs")||(e.metadata.toolkit.lightmapuvs=!1),M.Toolkit.Utilities.HasOwnProperty(t,"animator")||(e.metadata.toolkit.animator=null),M.Toolkit.Utilities.HasOwnProperty(t,"lods")||(e.metadata.toolkit.lods=null),M.Toolkit.Utilities.HasOwnProperty(t,"coverages")||(e.metadata.toolkit.coverages=null),M.Toolkit.Utilities.HasOwnProperty(t,"distances")||(e.metadata.toolkit.distances=null),M.Toolkit.Utilities.HasOwnProperty(t,"handlers")||(e.metadata.toolkit.handlers=null),M.Toolkit.Utilities.HasOwnProperty(t,"physics")||(e.metadata.toolkit.physics=null),M.Toolkit.Utilities.HasOwnProperty(t,"wheels")||(e.metadata.toolkit.wheels=null),M.Toolkit.Utilities.HasOwnProperty(t,"renderer")||(e.metadata.toolkit.renderer=null),M.Toolkit.Utilities.HasOwnProperty(t,"collision")||(e.metadata.toolkit.collision=null),M.Toolkit.Utilities.HasOwnProperty(t,"properties")||(e.metadata.toolkit.properties=null),M.Toolkit.Utilities.HasOwnProperty(t,"components")||(e.metadata.toolkit.components=null)},m.UpVector=M.Vector3.Up(),m.AuxVector=M.Vector3.Zero(),m.ZeroVector=M.Vector3.Zero(),m.TempMatrix=M.Matrix.Zero(),m.TempMatrix2=M.Matrix.Zero(),m.TempVector2=M.Vector2.Zero(),m.TempVector3=M.Vector3.Zero(),m.TempQuaternion=M.Quaternion.Zero(),m.TempQuaternion2=M.Quaternion.Zero(),m.TempQuaternion3=M.Quaternion.Zero(),m.TempDirectionBuffer=M.Vector3.Zero(),m.LoadingState=-1,m.OnPreloaderProgress=null,m.OnPreloaderComplete=null,m.LoaderItemsMarkedForDisposal=[],e.Utilities=m}(BABYLON=BABYLON||{}),BABYLON.Toolkit.Utilities),__extends=(BABYLON.Bone.prototype.linkTransformNode=function(e){(e._linkedBone=this)._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}()),CVTOOLS_NAME=(!function(_){var e=_.Toolkit||(_.Toolkit={});function t(){this._defines={},this._defines={}}t.prototype.getDefines=function(){return this._defines},t.prototype.defineBoolean=function(e){this._defines[e]=!0},t.prototype.defineNumeric=function(e,t){this._defines[e]=t},t.ShaderIndexer=0,e.UniversalShaderDefines=t,e.UniversalAlbedoChunks=function(){},i=_.PBRMaterial,__extends(n,i),n.prototype.updateShaderChunks=function(){},n.prototype.getShaderName=function(){return"pbr"},n.prototype.getShaderChunk=function(){return null},n.prototype.getShaderDefines=function(){return this._defines},n.prototype.getCustomAttributes=function(){return null},Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){!0===this._enableTime&&(!1===this._timeInitialized?(this._timeInitialized=!0,this.setFloat("gameTime",_.Toolkit.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",_.Toolkit.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",_.Toolkit.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",_.Toolkit.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},n.prototype.getTexture=function(e){return this._textures[e]},n.prototype.getVector4=function(e){return this._vectors4[e]},n.prototype.getFloat=function(e){return this._floats[e]},n.prototype.setTexture=function(e,t,o){return!0===(o=void 0===o?!1:o)&&this.checkSampler(e),this._textures[e]=t,this},n.prototype.setVector4=function(e,t,o){return!0===(o=void 0===o?!1:o)&&this.checkUniform(e),this._vectors4[e]=t,this},n.prototype.setFloat=function(e,t,o){return!0===(o=void 0===o?!1:o)&&this.checkUniform(e),this._floats[e]=t,this},n.prototype.addAttribute=function(e){-1===this._attributes.indexOf(e)&&this._attributes.push(e)},n.prototype.checkUniform=function(e){-1===this._uniforms.indexOf(e)&&(this._uniforms.push(e),this.locals.defineBoolean(e.toUpperCase()))},n.prototype.checkSampler=function(e){-1===this._samplers.indexOf(e)&&(this._samplers.push(e),this.locals.defineBoolean(e.toUpperCase()),this.checkUniform(e+"Infos"),this.checkUniform(e+"Matrix"))},n.prototype.getAnimatables=function(){var e,t=i.prototype.getAnimatables.call(this);for(e in this._textures){var o=this._textures[e];o&&o.animations&&0<o.animations.length&&t.push(o)}return t},n.prototype.getActiveTextures=function(){var e,t=i.prototype.getActiveTextures.call(this);for(e in this._textures){var o=this._textures[e];o&&t.push(o)}return t},n.prototype.hasTexture=function(e){if(i.prototype.hasTexture.call(this,e))return!0;var t,o=!1;for(t in this._textures){var n=this._textures[t];if(n==n){o=!0;break}}return o},n.prototype.dispose=function(e,t){if(t)for(var o in this._textures){var n=this._textures[o];n&&n.dispose(),this._textures[o]=null}this._textures={},i.prototype.dispose.call(this,e,t)},n.prototype.clone=function(e){var t,o=this,n=_.SerializationHelper.Clone(function(){return new _.Toolkit.UniversalAlbedoMaterial(e,o.getScene())},this);for(t in n._textures={},this._textures){var i=this._textures[t];i&&n.setTexture(t,i.clone(),!0)}for(t in n._vectors4={},this._vectors4)n.setVector4(t,this._vectors4[t].clone(),!0);for(t in n._floats={},this._floats)n.setFloat(t,this._floats[t],!0);return n},n.prototype.serialize=function(){var e,t=_.SerializationHelper.Serialize(this);for(e in t.customType="BABYLON.Toolkit.UniversalAlbedoMaterial",t.textures={},this._textures){var o=this._textures[e];o&&(t.textures[e]=o.serialize())}for(e in t.vectors4={},this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();for(e in t.floats={},this._floats)t.floats[e]=this._floats[e];return t},n.Parse=function(e,t,o){var n,i=_.SerializationHelper.Parse(function(){return new _.Toolkit.UniversalAlbedoMaterial(e.name,t)},e,t,o);for(n in e.textures){var l=e.textures[n];l&&i.setTexture(n,_.Texture.Parse(l,t,o),!0)}for(n in e.vectors4)i.setVector4(n,_.Vector4.FromArray(e.vectors4[n]),!0);for(n in e.floats)i.setFloat(n,e.floats[n],!0);return i},n.prototype.customShaderChunkResolve=function(){var e,t,o=this.getShaderChunk();null!=o&&""!==o&&(null!=_.Effect.ShadersStore[o=o+"ShaderChunks"]?(e=_.Effect.ShadersStore[o],null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"VertexBegin")?e.VertexBegin:null)&&""!==t&&(this.materialShaderChunks.Vertex_Begin=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"VertexDefinitions")?e.VertexDefinitions:null)&&""!==t&&(this.materialShaderChunks.Vertex_Definitions=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"VertexMainBegin")?e.VertexMainBegin:null)&&""!==t&&(this.materialShaderChunks.Vertex_MainBegin=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"VertexUpdatePosition")?e.VertexUpdatePosition:null)&&""!==t&&(this.materialShaderChunks.Vertex_Before_PositionUpdated=t.replace("result","positionUpdated")),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"VertexUpdateNormal")?e.VertexUpdateNormal:null)&&""!==t&&(this.materialShaderChunks.Vertex_Before_NormalUpdated=t.replace("result","normalUpdated")),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"VertexWorldPos")?e.VertexWorldPos:null)&&""!==t&&(this.materialShaderChunks.Vertex_After_WorldPosComputed=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"VertexMainEnd")?e.VertexMainEnd:null)&&""!==t&&(this.materialShaderChunks.Vertex_MainEnd=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"FragmentBegin")?e.FragmentBegin:null)&&""!==t&&(this.materialShaderChunks.Fragment_Begin=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"FragmentDefinitions")?e.FragmentDefinitions:null)&&""!==t&&(this.materialShaderChunks.Fragment_Definitions=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"FragmentMainBegin")?e.FragmentMainBegin:null)&&""!==t&&(this.materialShaderChunks.Fragment_MainBegin=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"FragmentUpdateAlbedo")?e.FragmentUpdateAlbedo:null)&&""!==t&&(this.materialShaderChunks.Fragment_Custom_Albedo=t.replace("result","surfaceAlbedo")),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"FragmentUpdateAlpha")?e.FragmentUpdateAlpha:null)&&""!==t&&(this.materialShaderChunks.Fragment_Custom_Alpha=t.replace("result","alpha")),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"FragmentMetallicRoughness")?e.FragmentMetallicRoughness:null)&&""!==t&&(this.materialShaderChunks.Fragment_MetallicRoughness=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"FragmentMicroSurface")?e.FragmentMicroSurface:null)&&""!==t&&(this.materialShaderChunks.Fragment_MicroSurface=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"FragmentBeforeLights")?e.FragmentBeforeLights:null)&&""!==t&&(this.materialShaderChunks.Fragment_Before_Lights=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"FragmentBeforeFog")?e.FragmentBeforeFog:null)&&""!==t&&(this.materialShaderChunks.Fragment_Before_Fog=t),null!=(t=_.Toolkit.Utilities.HasOwnProperty(e,"FragmentBeforeFragColor")?e.FragmentBeforeFragColor:null)&&""!==t&&(this.materialShaderChunks.Fragment_Before_FragColor=t.replace("result","color"))):_.Tools.Warn("Failed To Locate Shader Chunk Base: "+o))},n.prototype._buildCustomShader=function(e,t,o,n,i,l,r){var a=this,s=(null==r||null!=r.processFinalCode&&null!=r.processFinalCode||(r.processFinalCode=function(e,t){return"vertex"===e?t:((e=new _.ShaderCodeInliner(t)).inlineToken="#define pbr_inline",e.processCode(),e.code)}),this._defines=i,this.locals.getDefines());if(null!=s&&null!=this._defines){r=Object.keys(s);if(null!=r&&0<r.length){for(var u=this._defines,c=0,p=r;c<p.length;c++){var d=p[c];u[d]=s[d]}this._defines.rebuild()}}var h=0;if(null!=this._uniforms&&0<this._uniforms.length)for(h=0;h<this._uniforms.length;h++){var m=this._uniforms[h];-1===t.indexOf(m)&&t.push(m)}if(h=0,null!=this._samplers&&0<this._samplers.length)for(h=0;h<this._samplers.length;h++){var g=this._samplers[h];-1===n.indexOf(g)&&n.push(g)}if(h=0,null!=this._attributes&&0<this._attributes.length)for(h=0;h<this._attributes.length;h++){var T=this._attributes[h];-1===l.indexOf(T)&&l.push(T)}var f,h=0,y=this.getCustomAttributes();if(null!=y&&0<y.length)for(h=0;h<y.length;h++){var k=y[h];-1===l.indexOf(k)&&l.push(k)}return null!=this._createdShaderName&&""!==this._createdShaderName||(null!=(i=null!=(i=this.getShaderName())&&""!==i?i:e)&&""!==i||(i="pbr"),f=this._afterBind.bind(this),this._afterBind=function(e,t){if(t){a._attachAfterBind(e,t);try{f(e,t)}catch(t){}}},this._createdShaderName=!0===this.enableShaderChunks?this._createShaderChunks(i):i),this._createdShaderName},n.prototype._createShaderChunks=function(e){var t=this.getShaderChunk(),t=(null!=t&&""!==t||(t=e),_.Toolkit.UniversalShaderDefines.ShaderIndexer++,(t+"Custom"+_.Toolkit.UniversalShaderDefines.ShaderIndexer).trim()),o=_.Effect.ShadersStore[e+"VertexShader"],e=_.Effect.ShadersStore[e+"PixelShader"],n=(e=(e=(e=e.replace(/#include<pbrBlockAlbedoOpacity>/g,_.Effect.IncludesShadersStore.pbrBlockAlbedoOpacity)).replace(/#include<pbrBlockReflectivity>/g,_.Effect.IncludesShadersStore.pbrBlockReflectivity)).replace(/#include<pbrBlockFinalColorComposition>/g,_.Effect.IncludesShadersStore.pbrBlockFinalColorComposition),this.updateShaderChunks(),t+"VertexShader"),o=(_.Effect.ShadersStore[n]=o.replace("#define CUSTOM_VERTEX_BEGIN",this.materialShaderChunks.Vertex_Begin||"").replace("#define CUSTOM_VERTEX_DEFINITIONS",this.materialShaderChunks.Vertex_Definitions||"").replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.materialShaderChunks.Vertex_MainBegin||"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.materialShaderChunks.Vertex_Before_PositionUpdated||"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.materialShaderChunks.Vertex_Before_NormalUpdated||"").replace("#define CUSTOM_VERTEX_MAIN_END",this.materialShaderChunks.Vertex_MainEnd||""),this.materialShaderChunks.Vertex_After_WorldPosComputed&&(_.Effect.ShadersStore[n]=_.Effect.ShadersStore[n].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS",this.materialShaderChunks.Vertex_After_WorldPosComputed)),t+"PixelShader");return _.Effect.ShadersStore[o]=e.replace("#define CUSTOM_FRAGMENT_BEGIN",this.materialShaderChunks.Fragment_Begin||"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",this.materialShaderChunks.Fragment_Definitions||"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.materialShaderChunks.Fragment_MainBegin||"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.materialShaderChunks.Fragment_Custom_Albedo||"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.materialShaderChunks.Fragment_Custom_Alpha||"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.materialShaderChunks.Fragment_MetallicRoughness||"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.materialShaderChunks.Fragment_MicroSurface||"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.materialShaderChunks.Fragment_Before_Lights||"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog||"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.materialShaderChunks.Fragment_Before_FragColor||""),this.materialShaderChunks.Fragment_Before_Fog&&(_.Effect.ShadersStore[o]=_.Effect.ShadersStore[o].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog)),t},n.prototype._attachAfterBind=function(e,t){this.updateGlobalTime();if(this.after&&this.after(),this.getScene().texturesEnabled)for(var o in this._textures){var n=this._textures[o];null!=n&&n.isReady&&n.isReady()&&(null==n.isChecked&&(n.isChecked=!0,"detailsSampler"===o||"normalsSampler"===o||0<=o.indexOf("(Atlas)"))&&n.updateSamplingMode(8),t.setTexture(o,n),t.setFloat2(o+"Infos",n.coordinatesIndex,n.level),t.setMatrix(o+"Matrix",n.getTextureMatrix()))}for(o in this._vectors4)t.setVector4(o,this._vectors4[o]);for(o in this._floats)t.setFloat(o,this._floats[o])};var i,o=n;function n(e,t,o){void 0===o&&(o=!1);o=i.call(this,e,t)||this,o.universalMaterial=!0,o.locals=null,o.terrainInfo=null,o._defines=null,o._uniforms=[],o._samplers=[],o._attributes=[],o._textures={},o._vectors4={},o._floats={},o._enableTime=!1,o._timeInitialized=!1,o.dumpEffect=!1,o.locals=new _.Toolkit.UniversalShaderDefines,o._defines=null,o._createdShaderName=null,o.enableShaderChunks=!1,o.materialShaderChunks=new _.Toolkit.UniversalAlbedoChunks,o.customShaderNameResolve=o._buildCustomShader,o.customShaderChunkResolve(),e=o;return e.awake&&e.awake(),o}e.UniversalAlbedoMaterial=o,_.RegisterClass("BABYLON.Toolkit.UniversalAlbedoMaterial",o),l=_.ShaderMaterial,__extends(r,l),Object.defineProperty(r.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),r.prototype.updateGlobalTime=function(){!0===this._enableTime&&(this.setFloat("gameTime",_.Toolkit.SceneManager.GetGameTime()),this.setFloat("deltaTime",_.Toolkit.SceneManager.GetDeltaSeconds(this.getScene())))};var l,o=r;function r(e,t,o){e=l.call(this,e,t,null,o)||this;return e._enableTime=!1,e}e.UniversalShaderMaterial=o,_.RegisterClass("BABYLON.Toolkit.UniversalShaderMaterial",o),a=_.NodeMaterial,__extends(s,a),s.prototype.compile=function(){},Object.defineProperty(s.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),s.prototype.updateGlobalTime=function(){!0===this._enableTime&&(!1===this._timeInitialized?(this._timeInitialized=!0,this.setFloat("gameTime",_.Toolkit.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",_.Toolkit.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",_.Toolkit.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",_.Toolkit.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},s.prototype.getTexture=function(e){return this._textures[e]},s.prototype.getVector4=function(e){return this._vectors4[e]},s.prototype.getFloat=function(e){return this._floats[e]},s.prototype.setTexture=function(e,t,o){return void 0===o&&(o=!1),this._textures[e]=t,this},s.prototype.setVector4=function(e,t,o){return void 0===o&&(o=!1),this._vectors4[e]=t,this},s.prototype.setFloat=function(e,t,o){return void 0===o&&(o=!1),this._floats[e]=t,this},s.prototype.dispose=function(e,t){if(t)for(var o in this._textures){var n=this._textures[o];n&&n.dispose(),this._textures[o]=null}this._textures={},a.prototype.dispose.call(this,e,t)},s.prototype.clone=function(e){var t,o=this,n=_.SerializationHelper.Clone(function(){return new _.Toolkit.UniversalNodeMaterial(e,o.getScene())},this);for(t in n._textures={},this._textures){var i=this._textures[t];i&&n.setTexture(t,i.clone(),!0)}for(t in n._vectors4={},this._vectors4)n.setVector4(t,this._vectors4[t].clone(),!0);for(t in n._floats={},this._floats)n.setFloat(t,this._floats[t],!0);return n},s.prototype.serialize=function(){var e,t=_.SerializationHelper.Serialize(this);for(e in t.customType="BABYLON.Toolkit.UniversalNodeMaterial",t.textures={},this._textures){var o=this._textures[e];o&&(t.textures[e]=o.serialize())}for(e in t.vectors4={},this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();for(e in t.floats={},this._floats)t.floats[e]=this._floats[e];return t},s.Parse=function(e,t,o){var n,i=_.SerializationHelper.Parse(function(){return new _.Toolkit.UniversalNodeMaterial(e.name,t)},e,t,o);for(n in e.textures){var l=e.textures[n];l&&i.setTexture(n,_.Texture.Parse(l,t,o),!0)}for(n in e.vectors4)i.setVector4(n,_.Vector4.FromArray(e.vectors4[n]),!0);for(n in e.floats)i.setFloat(n,e.floats[n],!0);return i};var a,o=s;function s(e,t,o){var n=a.call(this,e,t,o)||this,i=(n._textures={},n._vectors4={},n._floats={},n._enableTime=!1,n._timeInitialized=!1,n);return i.awake&&i.awake(),n.onBindObservable.add(function(){n.updateGlobalTime(),i.after&&i.after()}),n}e.UniversalNodeMaterial=o,_.RegisterClass("BABYLON.Toolkit.UniversalNodeMaterial",o),u=_.Toolkit.UniversalAlbedoMaterial,__extends(c,u),c.prototype.getShaderName=function(){return"pbr"},c.prototype.getShaderChunk=function(){return null},c.prototype.updateShaderChunks=function(){var e="surfaceAlbedo",t="splatmapSampler",o="detailsSampler",n="normalsSampler",i=_.Toolkit.SceneManager.TerrainColorCorrection;null!=this.materialShaderChunks.Vertex_Definitions&&""!==this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions()+this.materialShaderChunks.Vertex_Definitions:this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions(),null!=this.materialShaderChunks.Vertex_MainEnd&&""!==this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd()+this.materialShaderChunks.Vertex_MainEnd:this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd(),null!=this.materialShaderChunks.Fragment_Definitions&&""!==this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(t,o,n)+this.materialShaderChunks.Fragment_Definitions:this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(t,o,n),null!=this.materialShaderChunks.Fragment_Custom_Albedo&&""!==this.materialShaderChunks.Fragment_Custom_Albedo?this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,e,t,o,n,i)+this.materialShaderChunks.Fragment_Custom_Albedo:this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,e,t,o,n,i)},c.prototype.formatTerrainVertexDefintions=function(){return"\r\n#define TERRAIN_VERTEX_DEFINITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\n\r\n"},c.prototype.formatTerrainVertexMainEnd=function(){return"\r\n#define TERRAIN_VERTEX_MAIN_END\r\n\r\n#ifdef UV1\r\nvSplatmapUV = uv;\r\n#endif\r\n\r\n"},c.prototype.formatTerrainFragmentDefintions=function(e,t,o){return"\r\n#define TERRAIN_FRAGMENT_DEFNITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\nuniform sampler2D "+e+";\r\nuniform sampler2D "+t+";\r\nuniform sampler2D "+o+";\r\n\r\nfloat calculateMipmapLevel(const in vec2 uvs, const in vec2 size)\r\n{\r\n    vec2 dx = dFdx(uvs * size.x);\r\n    vec2 dy = dFdy(uvs * size.y);\r\n    float d = max(dot(dx, dx), dot(dy, dy));\r\n    return 0.4 * log2(d);\r\n}\r\n\r\nvec4 sampleTextureAtlas2D(const in sampler2D atlas, const in float gamma, const in vec2 tile, const in vec4 rect, in vec2 uvs, in float lod)\r\n{\r\n    if (lod < 0.0) lod = clamp(calculateMipmapLevel(uvs, vec2(tile.x, tile.x)), 0.0, tile.y);   // Tile Info (tile.xy)\r\n    float size = pow(2.0, tile.y - lod);                                                        // Tile Bits (tile.y)\r\n    float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n    float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n    uvs = fract(uvs);                                                                           // Perfrom Tiling (fract)\r\n    uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n    uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    vec4 color = texture2DLodEXT(atlas, uvs, lod);\r\n    if (gamma != 1.0) {\r\n        color.r = pow(color.r, gamma);\r\n        color.g = pow(color.g, gamma);\r\n        color.b = pow(color.b, gamma);\r\n    }\r\n    return color;\r\n}\r\n\r\nvec4 sampleSplatmapAtlas2D(const in sampler2D atlas, const in vec2 tile, const in vec4 rect, in vec2 uvs)\r\n{\r\n    float size = pow(2.0, tile.y);                                                              // Tile Bits (tile.y)\r\n\t   float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n\t   float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n\t   uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n\t   uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    return texture2D(atlas, uvs);\r\n}\r\n\r\nvec3 blendSplatmapAtlasColors(const in vec4 splatmap, in vec4 color1, in vec4 color2, in vec4 color3, in vec4 color4, in vec3 mixbuffer)\r\n{\r\n    vec3 buffer1 = mix(mixbuffer, color1.rgb, splatmap.r);\r\n    vec3 buffer2 = mix(buffer1, color2.rgb, splatmap.g);\r\n    vec3 buffer3 = mix(buffer2, color3.rgb, splatmap.b);\r\n    return mix(buffer3, color4.rgb, splatmap.a);\r\n}\r\n\r\nvec3 perturbNormalSamplerColor(mat3 cotangentFrame, vec3 samplerColor, float scale)\r\n{\r\n    vec3 map = samplerColor.xyz;\r\n    map = map * 2.00787402 - 1.00787402;\r\n    #ifdef NORMALXYSCALE\r\n        map = normalize(map * vec3(scale, scale, 1.0));\r\n    #endif\r\n    return normalize(cotangentFrame * map);\r\n}\r\n\r\n\r\n"},c.prototype.formatTerrainFragmentUpdateColor=function(e,t,o,n,i,l){void 0===l&&(l=1);var r="";if(null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&0<e.splatmapCount){r="\r\n#define TERRAIN_FRAGMENT_UPDATE_COLOR\r\n\r\nvec3 normalsColor = vec3(0.5, 0.5, 1.0);\r\nvec3 normalsBuffer = normalW.rgb;\r\nvec3 splatmapBuffer = "+t+".rgb;\r\nfloat autoMipMapLevel = -1.0;\r\nfloat normalCorrection = 1.0;\r\nfloat detailCorrection = "+l.toFixed(4)+";\r\n\r\n#if defined(ALBEDO) && defined("+o.toUpperCase()+") && defined("+n.toUpperCase()+")\r\n\r\n// Reset Normal Values\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    uvOffset = vec2(0.0, 0.0);\r\n    #ifdef NORMAL\r\n        normalW = normalize(vNormalW);\r\n    #else\r\n        normalW = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n    #endif\r\n    #ifdef CLEARCOAT\r\n        clearCoatNormalW = normalW;\r\n    #endif\r\n    #if defined(BUMP) || defined(PARALLAX)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV);\r\n        #endif\r\n    #elif defined(ANISOTROPIC)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV, vec2(1.0, 1.0));\r\n        #endif\r\n    #endif\r\n    #ifdef PARALLAX\r\n        invTBN = transposeMat3(TBN);\r\n    #endif\r\n    normalW = perturbNormalSamplerColor(TBN, normalsColor, 1.0);\r\n#endif\r\n\r\n// Global Atlas Values\r\nfloat splatTileSize = "+e.splatmapAtlas[2].toFixed(4)+";\r\nfloat splatTileBits = "+e.splatmapAtlas[3].toFixed(4)+";\r\nfloat detailTileSize = "+e.textureAtlas[2].toFixed(4)+";\r\nfloat detailTileBits = "+e.textureAtlas[3].toFixed(4)+";\r\n\r\n// Sample splatmap textures\r\n";for(var a=0;a<e.splatmapCount;a++){var s,u,c=4*a,p=e["splatmapRect"+a];r=(r=(r=r+("vec4 splatmapRect"+a+" = vec4("+p[0].toFixed(4)+", "+p[1].toFixed(4)+", "+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n")+("vec4 splatmapAlbedo"+a+" = sampleSplatmapAtlas2D("+o+", vec2(splatTileSize, splatTileBits), splatmapRect"+a+", (vSplatmapUV + uvOffset));\r\n"))+("vec4 textureAlbedo"+(0+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n")+("vec4 textureAlbedo"+(1+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n"))+("vec4 textureAlbedo"+(2+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n")+("vec4 textureAlbedo"+(3+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n"),e["textureRect"+(0+c)]&&(s=e["textureRect"+(0+c)],u=e["textureInfo"+(0+c)],r=(r=(r=(r+="vec4 textureRect"+(0+c)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n")+"vec2 textureScale"+(0+c)+" = vec2("+u[0].toFixed(4)+", "+u[1].toFixed(4)+");\r\n")+"vec2 textureOffset"+(0+c)+" = vec2("+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n")+"vec2 textureTileUV"+(0+c)+" = ((vSplatmapUV + textureOffset"+(0+c)+") * textureScale"+(0+c)+");\r\ntextureAlbedo"+(0+c)+" = sampleTextureAtlas2D("+n+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(0+c)+", textureTileUV"+(0+c)+", autoMipMapLevel);\r\n"),e["textureRect"+(1+c)]&&(s=e["textureRect"+(1+c)],u=e["textureInfo"+(1+c)],r=(r=(r=(r+="vec4 textureRect"+(1+c)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n")+"vec2 textureScale"+(1+c)+" = vec2("+u[0].toFixed(4)+", "+u[1].toFixed(4)+");\r\n")+"vec2 textureOffset"+(1+c)+" = vec2("+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n")+"vec2 textureTileUV"+(1+c)+" = ((vSplatmapUV + textureOffset"+(1+c)+") * textureScale"+(1+c)+");\r\ntextureAlbedo"+(1+c)+" = sampleTextureAtlas2D("+n+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(1+c)+", textureTileUV"+(1+c)+", autoMipMapLevel);\r\n"),e["textureRect"+(2+c)]&&(s=e["textureRect"+(2+c)],u=e["textureInfo"+(2+c)],r=(r=(r=(r+="vec4 textureRect"+(2+c)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n")+"vec2 textureScale"+(2+c)+" = vec2("+u[0].toFixed(4)+", "+u[1].toFixed(4)+");\r\n")+"vec2 textureOffset"+(2+c)+" = vec2("+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n")+"vec2 textureTileUV"+(2+c)+" = ((vSplatmapUV + textureOffset"+(2+c)+") * textureScale"+(2+c)+");\r\ntextureAlbedo"+(2+c)+" = sampleTextureAtlas2D("+n+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(2+c)+", textureTileUV"+(2+c)+", autoMipMapLevel);\r\n"),e["textureRect"+(3+c)]&&(s=e["textureRect"+(3+c)],u=e["textureInfo"+(3+c)],r=(r=(r=(r+="vec4 textureRect"+(3+c)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n")+"vec2 textureScale"+(3+c)+" = vec2("+u[0].toFixed(4)+", "+u[1].toFixed(4)+");\r\n")+"vec2 textureOffset"+(3+c)+" = vec2("+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n")+"vec2 textureTileUV"+(3+c)+" = ((vSplatmapUV + textureOffset"+(3+c)+") * textureScale"+(3+c)+");\r\ntextureAlbedo"+(3+c)+" = sampleTextureAtlas2D("+n+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(3+c)+", textureTileUV"+(3+c)+", autoMipMapLevel);\r\n"),r=(r=(r=(r=r+("splatmapBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+a+", textureAlbedo"+(0+c)+", textureAlbedo"+(1+c)+", textureAlbedo"+(2+c)+", textureAlbedo"+(3+c)+", splatmapBuffer);\r\n")+"#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n")+("    #if defined("+i.toUpperCase()+")\r\n"))+("        vec4 normalColor"+(0+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n")+("        vec4 normalColor"+(1+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n"))+("        vec4 normalColor"+(2+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n")+("        vec4 normalColor"+(3+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n"),e["textureRect"+(0+c)]&&(r=(r+="        float normalScale"+(0+c)+" = "+e["normalsScale"+(0+c)].toFixed(4)+";\r\n")+"        normalColor"+(0+c)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(0+c)+", textureTileUV"+(0+c)+", autoMipMapLevel);\r\n        normalColor"+(0+c)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(0+c)+".rgb, normalScale"+(0+c)+");\r\n"),e["textureRect"+(1+c)]&&(r=(r+="        float normalScale"+(1+c)+" = "+e["normalsScale"+(1+c)].toFixed(4)+";\r\n")+"        normalColor"+(1+c)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(1+c)+", textureTileUV"+(1+c)+", autoMipMapLevel);\r\n        normalColor"+(1+c)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(1+c)+".rgb, normalScale"+(1+c)+");\r\n"),e["textureRect"+(2+c)]&&(r=(r+="        float normalScale"+(2+c)+" = "+e["normalsScale"+(2+c)].toFixed(4)+";\r\n")+"        normalColor"+(2+c)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(2+c)+", textureTileUV"+(2+c)+", autoMipMapLevel);\r\n        normalColor"+(2+c)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(2+c)+".rgb, normalScale"+(2+c)+");\r\n"),r=(r=(r=e["textureRect"+(3+c)]?(r+="        float normalScale"+(3+c)+" = "+e["normalsScale"+(3+c)].toFixed(4)+";\r\n")+"        normalColor"+(3+c)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(3+c)+", textureTileUV"+(3+c)+", autoMipMapLevel);\r\n        normalColor"+(3+c)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(3+c)+".rgb, normalScale"+(3+c)+");\r\n":r)+("        normalsBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+a+", normalColor"+(0+c)+", normalColor"+(1+c)+", normalColor"+(2+c)+", normalColor"+(3+c)+", normalsBuffer);\r\n")+"    #endif\r\n")+"#endif\r\n"+"\r\n"}r+="// Update Color Values\r\n"+t+".rgb = splatmapBuffer.rgb;\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    #if defined("+i.toUpperCase()+")\r\n        normalW.rgb = normalsBuffer.rgb;\r\n    #endif\r\n    #if defined(FORCENORMALFORWARD) && defined(NORMAL)\r\n        vec3 faceNormal = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n        #if defined(TWOSIDEDLIGHTING)\r\n            faceNormal = gl_FrontFacing ? faceNormal : -faceNormal;\r\n        #endif\r\n        normalW *= sign(dot(normalW, faceNormal));\r\n    #endif\r\n    #if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\r\n        normalW = gl_FrontFacing ? normalW : -normalW;\r\n    #endif\r\n#endif\r\n\r\n#endif\r\n\r\n"}return r};var u,o=c;function c(e,t){var e=u.call(this,e,t)||this,o=(e.enableShaderChunks=!0,e);return o.awake&&o.awake(),e.onBindObservable.add(function(){o.after&&o.after()}),e}e.UniversalTerrainMaterial=o,_.RegisterClass("BABYLON.Toolkit.UniversalTerrainMaterial",o)}(BABYLON=BABYLON||{}),!function(a){var e;function t(e,t,o,n){if(void 0===o&&(o={}),void 0===n&&(n=null),this._update=null,this._late=null,this._step=null,this._fixed=null,this._after=null,this._ready=null,this._lateUpdate=!1,this._properties=null,this._awoken=!1,this._started=!1,this._scene=null,this._delyed=!1,this._transform=null,this._scriptReady=!1,this._registeredClassname=null,this._lateUpdateObserver=null,this.resetScriptComponent=null,this._worldCollisionObserver=null,this._worldCollisionEndedObserver=null,this._worldTriggerEventObserver=null,this.onCollisionEnterObservable=new a.Observable,this.onCollisionStayObservable=new a.Observable,this.onCollisionExitObservable=new a.Observable,this.onTriggerEnterObservable=new a.Observable,this.onTriggerExitObservable=new a.Observable,null==e)throw new Error("Null transform object specified.");if(null==t)throw new Error("Null host scene object specified.");this._scene=t,this._transform=e,this._properties=o||{},this._registeredClassname=null;var i=this;i._update=function(){a.Toolkit.ScriptComponent.UpdateInstance(i)},i._late=function(){a.Toolkit.ScriptComponent.LateInstance(i)},i._step=function(){a.Toolkit.ScriptComponent.StepInstance(i)},i._fixed=function(){a.Toolkit.ScriptComponent.FixedInstance(i)},i._after=function(){a.Toolkit.ScriptComponent.AfterInstance(i)},i._ready=function(){a.Toolkit.ScriptComponent.ReadyInstance(i)},i.resetScriptComponent=function(){a.Toolkit.ScriptComponent.ResetInstance(i)},i.registerComponentInstance&&i.destroyComponentInstance||a.Tools.Warn("Invalid component registration handlers for: "+this._transform.name),null!=i.registerComponentInstance&&null!=n&&""!==n&&i.registerComponentInstance(i,n)}e=a.Toolkit||(a.Toolkit={}),t.prototype.isReady=function(){return this._scriptReady},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return this._registeredClassname},t.prototype.setProperty=function(e,t){null==this._properties&&(this._properties={}),this._properties[e]=t},t.prototype.getProperty=function(e,t){void 0===t&&(t=null);var o=null;return null!=(o=null==(o=null!=this._properties&&null==(o=this._properties[e])?this._properties["auto__"+e]:o)?t:o)?o:null},t.prototype.getTime=function(){return a.Toolkit.SceneManager.GetTime()},t.prototype.getTimeMs=function(){return a.Toolkit.SceneManager.GetTimeMs()},t.prototype.getGameTime=function(){return a.Toolkit.SceneManager.GetGameTime()},t.prototype.getGameTimeMs=function(){return a.Toolkit.SceneManager.GetGameTimeMs()},t.prototype.getDeltaSeconds=function(){return a.Toolkit.SceneManager.GetDeltaSeconds(this.scene)},t.prototype.getDeltaMilliseconds=function(){return a.Toolkit.SceneManager.GetDeltaMilliseconds(this.scene)},t.prototype.getAnimationRatio=function(){return a.Toolkit.SceneManager.GetAnimationRatio(this.scene)},t.prototype.hasSkinnedMesh=function(){return null!=this.getSkinnedMesh()},t.prototype.getSkinnedMesh=function(){return a.Toolkit.SceneManager.GetSkinnedMesh(this.transform)},t.prototype.getTransformMesh=function(){return this._transform instanceof a.Mesh?this._transform:null},t.prototype.getAbstractMesh=function(){return this._transform instanceof a.AbstractMesh?this._transform:null},t.prototype.getInstancedMesh=function(){return this._transform instanceof a.InstancedMesh?this._transform:null},t.prototype.getPrimitiveMeshes=function(){return a.Toolkit.SceneManager.GetPrimitiveMeshes(this.transform)},t.prototype.getMetadata=function(){return a.Toolkit.SceneManager.FindSceneMetadata(this._transform)},t.prototype.getComponent=function(e,t){e=a.Toolkit.SceneManager.FindScriptComponent(this._transform,e,t=void 0===t?!1:t);return null!=e?e:null},t.prototype.getComponents=function(e,t){e=a.Toolkit.SceneManager.FindAllScriptComponents(this._transform,e,t=void 0===t?!1:t);return null!=e?e:null},t.prototype.getLightRig=function(){return a.Toolkit.SceneManager.FindSceneLightRig(this._transform)},t.prototype.getCameraRig=function(){return a.Toolkit.SceneManager.FindSceneCameraRig(this._transform)},t.prototype.getTransformTag=function(){return a.Toolkit.SceneManager.GetTransformTag(this.transform)},t.prototype.hasTransformTags=function(e){return a.Toolkit.SceneManager.HasTransformTags(this._transform,e)},t.prototype.getChildNode=function(e,t,o,n){return void 0===t&&(t=a.Toolkit.SearchType.ExactMatch),a.Toolkit.SceneManager.FindChildTransformNode(this._transform,e,t,o=void 0===o?!0:o,n=void 0===n?null:n)},t.prototype.getChildWithTags=function(e,t,o){return a.Toolkit.SceneManager.FindChildTransformWithTags(this._transform,e,t=void 0===t?!0:t,o=void 0===o?null:o)},t.prototype.getChildrenWithTags=function(e,t,o){return a.Toolkit.SceneManager.FindAllChildTransformsWithTags(this._transform,e,t=void 0===t?!0:t,o=void 0===o?null:o)},t.prototype.getChildWithScript=function(e,t,o){return a.Toolkit.SceneManager.FindChildTransformWithScript(this._transform,e,t=void 0===t?!0:t,o=void 0===o?null:o)},t.prototype.getChildrenWithScript=function(e,t,o){return a.Toolkit.SceneManager.FindAllChildTransformsWithScript(this._transform,e,t=void 0===t?!0:t,o=void 0===o?null:o)},t.prototype.enableCollisionEvents=function(){var o=this,e=a.Toolkit.RigidbodyPhysics.GetHavokPlugin();null!=e&&null!=this.transform.physicsBody&&(this.transform.physicsBody.setCollisionCallbackEnabled(!0),this.transform.physicsBody.setCollisionEndedCallbackEnabled(!0),null==this._worldCollisionObserver&&(this._worldCollisionObserver=e.onCollisionObservable.add(function(e){var t;e.collider!==o.transform.physicsBody&&e.collidedAgainst!==o.transform.physicsBody||(t=e.collider===o.transform.physicsBody?e.collidedAgainst:e.collider,"COLLISION_STARTED"===e.type?o.onCollisionEnterObservable.notifyObservers(t.transformNode):"COLLISION_CONTINUED"===e.type&&o.onCollisionStayObservable.notifyObservers(t.transformNode))})),null==this._worldCollisionEndedObserver&&(this._worldCollisionEndedObserver=e.onCollisionEndedObservable.add(function(e){var t;e.collider!==o.transform.physicsBody&&e.collidedAgainst!==o.transform.physicsBody||(t=e.collider===o.transform.physicsBody?e.collidedAgainst:e.collider,"COLLISION_FINISHED"===e.type&&o.onCollisionExitObservable.notifyObservers(t.transformNode))})),null==this._worldTriggerEventObserver)&&(this._worldTriggerEventObserver=e.onTriggerCollisionObservable.add(function(e){var t;e.collider!==o.transform.physicsBody&&e.collidedAgainst!==o.transform.physicsBody||(t=e.collider===o.transform.physicsBody?e.collidedAgainst:e.collider,"TRIGGER_ENTERED"===e.type?o.onTriggerEnterObservable.notifyObservers(t.transformNode):"TRIGGER_EXITED"===e.type&&o.onTriggerExitObservable.notifyObservers(t.transformNode))}))},t.prototype.disableCollisionEvents=function(){null!=a.Toolkit.RigidbodyPhysics.GetHavokPlugin()&&null!=this.transform.physicsBody&&(this.transform.physicsBody.setCollisionCallbackEnabled(!1),this.transform.physicsBody.setCollisionEndedCallbackEnabled(!1))},t.prototype.setTransformPosition=function(e){this.transform.physicsBody&&(this.transform.physicsBody.disablePreStep=!1),null!=this.transform.position&&this.transform.position.copyFrom(e)},t.prototype.setTransformRotation=function(e){this.transform.physicsBody&&(this.transform.physicsBody.disablePreStep=!1),null!=this.transform.rotationQuaternion&&this.transform.rotationQuaternion.copyFrom(e)},t.prototype.registerOnClickAction=function(e){var t=null;return t=this.transform instanceof a.AbstractMesh?a.Toolkit.SceneManager.RegisterClickAction(this.scene,this.transform,e):t},t.prototype.unregisterOnClickAction=function(e){var t=!1;return t=this.transform instanceof a.AbstractMesh?a.Toolkit.SceneManager.UnregisterClickAction(this.transform,e):t},t.prototype.registerComponentInstance=function(e,t,o){var n;!0===(o=void 0===o?!0:o)&&(a.Toolkit.Utilities.ValidateTransformMetadata(this._transform),n={alias:"script",order:0,klass:t,properties:null,instance:e},null==this._transform.metadata.toolkit.components&&(this._transform.metadata.toolkit.components=[]),this._transform.metadata.toolkit.components.push(n)),e._registeredClassname=t,a.Toolkit.ScriptComponent.RegisterInstance(e),!0===o&&e.scene.onAfterRenderObservable.addOnce(function(){e.delayComponentInstance(e)})},t.prototype.delayComponentInstance=function(e){a.Toolkit.WindowManager.SetTimeout(100,function(){e._delyed=!0})},t.prototype.destroyComponentInstance=function(e){a.Toolkit.ScriptComponent.DestroyInstance(e)},t.prototype.setupStepComponentInstance=function(e){e.scene.onBeforePhysicsObservable&&e.scene.onBeforePhysicsObservable.add(e._step)},t.prototype.removeStepComponentInstance=function(e){e.scene.onBeforePhysicsObservable&&e.scene.onBeforePhysicsObservable.removeCallback(e._step)},t.prototype.setupFixedComponentInstance=function(e){e.scene.onAfterPhysicsObservable&&e.scene.onAfterPhysicsObservable.add(e._fixed)},t.prototype.removeFixedComponentInstance=function(e){e.scene.onAfterPhysicsObservable&&e.scene.onAfterPhysicsObservable.removeCallback(e._fixed)},t.RegisterInstance=function(e){null!=e&&(null!=e._update&&e.scene.registerBeforeRender(e._update),e.late&&null!=e._late&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&(e._lateUpdateObserver=e.scene.onBeforeRenderTargetsRenderObservable.add(e._late)),e.after&&null!=e._after&&e.scene.registerAfterRender(e._after),e.step&&null!=e._step&&e.setupStepComponentInstance(e),e.fixed)&&null!=e._fixed&&e.setupFixedComponentInstance(e)},t.UpdateInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&(!1===e._awoken?(e._awoken=!0,a.Toolkit.ScriptComponent.ParseAutoProperties(e),e.awake&&e.awake()):!1===e._started?(e._started=!0,e.start&&e.start()):!0===e._awoken&&!0===e._started&&(!0===e._delyed&&(e._delyed=!1,a.Toolkit.ScriptComponent.ReadyInstance(e)),e.update&&e.update(),e._lateUpdate=!0))},t.LateInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&!0===e._lateUpdate&&!(e._lateUpdate=!1)===e._started&&e.late&&e.late()},t.AfterInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&!0===e._started&&e.after&&e.after()},t.StepInstance=function(e){null!=e&&null!=e.transform&&!0===e._started&&e.step&&e.step()},t.FixedInstance=function(e){null!=e&&null!=e.transform&&!0===e._started&&e.fixed&&e.fixed()},t.ReadyInstance=function(e){null!=e&&null!=e.transform&&!1===e._scriptReady&&(e._scriptReady=!0,e.ready)&&e.ready()},t.ResetInstance=function(e){null!=e&&null!=e.transform&&!0===e._started&&e.reset&&e.reset()},t.DestroyInstance=function(e){if(null!=e){e.scene.unregisterBeforeRender(e._update),null!=e._lateUpdateObserver&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&e.scene.onBeforeRenderTargetsRenderObservable.remove(e._lateUpdateObserver),e.after&&null!=e._after&&e.scene.unregisterAfterRender(e._after),e.step&&null!=e._step&&e.removeStepComponentInstance(e),e.fixed&&null!=e._fixed&&e.removeFixedComponentInstance(e);var t=a.Toolkit.RigidbodyPhysics.GetHavokPlugin();if(null!=t){if(null!=e._worldCollisionObserver)try{t.onCollisionObservable.remove(e._worldCollisionObserver)}catch(e){}if(null!=e._worldCollisionEndedObserver)try{t.onCollisionEndedObservable.remove(e._worldCollisionEndedObserver)}catch(e){}if(null!=e._worldTriggerEventObserver)try{t.onTriggerCollisionObservable.remove(e._worldTriggerEventObserver)}catch(e){}}try{e.onCollisionEnterObservable.clear()}catch(e){}try{e.onCollisionStayObservable.clear()}catch(e){}try{e.onCollisionExitObservable.clear()}catch(e){}try{e.onTriggerEnterObservable.clear()}catch(e){}try{e.onTriggerExitObservable.clear()}catch(e){}try{e.destroy&&e.destroy()}catch(e){}e._scriptReady=!1,e._transform=null,e._properties=null,e._started=!1,e._delyed=!1,e._update=null,e._late=null,e._step=null,e._fixed=null,e._after=null,e._ready=null,e._scene=null}},t.ParseAutoProperties=function(l){var r=Object.keys(l._properties);if(null!=r&&0<r.length)for(var e=0;e<r.length;e++)!function(e){var t,o,n,i,e=r[e];a.Toolkit.Utilities.StartsWith(e,"auto__")&&(t=e.replace("auto__",""),a.Toolkit.Utilities.HasOwnProperty(l,t)?null!=(e=l.getProperty(e))&&null!=(n=typeof e)&&n&&"object"==n?Array.isArray(e)?(o=[],e.forEach(function(e){null!=e&&o.push("object"==typeof e?a.Toolkit.ScriptComponent.UnpackObjectProperty(e,l.scene):e)}),l[t]=o):(n=l[t],i=a.Toolkit.ScriptComponent.UnpackObjectProperty(e,l.scene),n instanceof a.Color3&&i instanceof a.Color4?l[t]=new a.Color3(i.r,i.g,i.b):l[t]=i):l[t]=e:a.Tools.Warn(l.getClassName()||"Unregistered Class: Auto property '"+t+"' not found for transform '"+l.transform.name+"'"))}(e)},t.UnpackObjectProperty=function(e,t){var o=null;if(null!=e)if(void 0!==e.x&&void 0!==e.y)o=void 0!==e.z?void 0!==e.w?new a.Vector4(e.x,e.y,e.z,e.w):new a.Vector3(e.x,e.y,e.z):new a.Vector2(e.x,e.y);else if(void 0!==e.r&&void 0!==e.g&&void 0!==e.b){var n=1;void 0!==e.a&&(n=e.a),o=new a.Color4(e.r,e.g,e.b,n)}else if(void 0!==e.type)switch(e.type){case"UnityEngine.AnimationCurve":o=a.Animation.Parse(e.animation);break;case"UnityEngine.Transform":o=a.Toolkit.Utilities.ParseTransformByID(e,t);break;case"UnityEngine.Material":o=t.getMaterialByName(e.name);break;case"UnityEngine.Texture2D":o=a.Toolkit.Utilities.ParseTexture(e,t);break;case"UnityEngine.Cubemap":o=a.Toolkit.Utilities.ParseCubemap(e,t);break;case"UnityEngine.AudioClip":o=e;break;case"UnityEngine.Video.VideoClip":o=e;break;case"UnityEngine.Font":o=e;break;case"UnityEngine.TextAsset":var i=e;o=null!=i.base64?!0===i.json?JSON.parse(a.Toolkit.WindowManager.Atob(i.base64)):a.Toolkit.WindowManager.Atob(i.base64):i;break;case"UnityEditor.DefaultAsset":i=e;o=null!=i.base64?!0===i.json?JSON.parse(a.Toolkit.WindowManager.Atob(i.base64)):a.Toolkit.WindowManager.Atob(i.base64):i;break;default:o=e}else o=e;return o},e.ScriptComponent=t}(BABYLON=BABYLON||{}),!function(le){var e;function t(e){this._babylonScene=e,this._physicList=[],this._shadowList=[],this._scriptList=[],this._freezeList=[]}e=le.Toolkit||(le.Toolkit={}),t.prototype.parseSceneComponents=function(e){le.Toolkit.MetadataParser.DoParseSceneComponents(this._babylonScene,e,this._physicList,this._shadowList,this._scriptList,this._freezeList)},t.prototype.postProcessSceneComponents=function(e,t){le.Toolkit.MetadataParser.DoProcessPendingPhysics(this._babylonScene,this._physicList),le.Toolkit.MetadataParser.DoProcessPendingShadows(this._babylonScene,this._shadowList),le.Toolkit.MetadataParser.DoProcessPendingScripts(this._babylonScene,this._scriptList,e,t),le.Toolkit.MetadataParser.DoProcessPendingFreezes(this._freezeList),this._babylonScene=null,this._physicList=null,this._shadowList=null,this._scriptList=null,this._freezeList=null},t.DoParseSceneComponents=function(t,o,e,n,i,l){var r,a,s,u,c,p;null!=o&&null!=o.metadata&&null!=o.metadata.toolkit&&null!=o.metadata.toolkit.parsed&&!1===o.metadata.toolkit.parsed&&(o.onDisposeObservable.addOnce(function(){le.Toolkit.Utilities.DisposeEntity(o)}),o.metadata.toolkit.parsed=!0,o.metadata.toolkit.prefab=!1,r=o.metadata.toolkit,a=null==o.metadata.toolkit.visible||o.metadata.toolkit.visible,s=null!=o.metadata.toolkit.visibility?o.metadata.toolkit.visibility:1,u=null!=o.metadata.toolkit.billboard?o.metadata.toolkit.billboard:0,p=o instanceof le.AbstractMesh,null!=o.metadata.toolkit.lightmapped&&o.metadata.toolkit.lightmapped,null!=(c=r.tags)&&""!==c&&(le.Tags.AddTagsTo(o,c),0<=c.indexOf("NavigationMesh"))&&(o.isVisible=!1,o.isPickable=!1,o.useVertexColors=!1),null!=r.physics&&null!=e&&e.push(o),o.renderingGroupId,null!=r.renderer&&(!0==p?(o.isPickable=!0,o.useVertexColors=!1,o.isVisible=a,o.visibility=s,o.billboardMode=u,o.cullingStrategy=le.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=r.renderer.cullingstrategy&&r.renderer.cullingstrategy!==le.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(o.cullingStrategy=r.renderer.cullingstrategy),null!=r.renderer.castshadows&&!0===r.renderer.castshadows&&null!=n&&n.push(o),null!=r.renderer.receiveshadows&&!0===r.renderer.receiveshadows&&(o.receiveShadows=!0),null!=r.renderer.checkcollisions&&!0===r.renderer.checkcollisions&&(o.checkCollisions=!0),null!=r.renderer.istriggervolume&&!0===r.renderer.istriggervolume&&(o.collisionResponse=!1),null!=r.renderer.usevertexcolors&&(o.useVertexColors=r.renderer.usevertexcolors),null!=r.renderer.setmeshpickable&&(o.isPickable=r.renderer.setmeshpickable),null!=r.renderer.showboundingbox&&(o.showBoundingBox=r.renderer.showboundingbox),null!=r.renderer.defaultellipsoid&&(o.ellipsoid=le.Toolkit.Utilities.ParseVector3(r.renderer.defaultellipsoid)),null!=r.renderer.ellipsoidoffset&&(o.ellipsoidOffset=le.Toolkit.Utilities.ParseVector3(r.renderer.ellipsoidoffset)),null!=r.renderer.rendergroupid&&(o.renderingGroupId=r.renderer.rendergroupid),null!=r.renderer.freezeworldmatrix&&!0===r.renderer.freezeworldmatrix&&null!=l&&l.push(o)):null!=(c=le.Toolkit.SceneManager.GetSkinnedMesh(o))?(c.isPickable=!0,c.useVertexColors=!1,c.isVisible=a,c.visibility=s,c.billboardMode=u,c.cullingStrategy=le.AbstractMesh.CULLINGSTRATEGY_STANDARD,c.alwaysSelectAsActiveMesh=!0,null!=r.renderer.cullingstrategy&&r.renderer.cullingstrategy!==le.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(c.cullingStrategy=r.renderer.cullingstrategy),null!=r.renderer.castshadows&&!0===r.renderer.castshadows&&null!=n&&n.push(c),null!=r.renderer.receiveshadows&&!0===r.renderer.receiveshadows&&(c.receiveShadows=!0),null!=r.renderer.checkcollisions&&!0===r.renderer.checkcollisions&&(c.checkCollisions=!0),null!=r.renderer.istriggervolume&&!0===r.renderer.istriggervolume&&(c.collisionResponse=!1),null!=r.renderer.usevertexcolors&&(c.useVertexColors=r.renderer.usevertexcolors),null!=r.renderer.setmeshpickable&&(c.isPickable=r.renderer.setmeshpickable),null!=r.renderer.showboundingbox&&(c.showBoundingBox=r.renderer.showboundingbox),null!=r.renderer.defaultellipsoid&&(c.ellipsoid=le.Toolkit.Utilities.ParseVector3(r.renderer.defaultellipsoid)),null!=r.renderer.ellipsoidoffset&&(c.ellipsoidOffset=le.Toolkit.Utilities.ParseVector3(r.renderer.ellipsoidoffset)),null!=r.renderer.rendergroupid&&(c.renderingGroupId=r.renderer.rendergroupid),null!=r.renderer.freezeworldmatrix&&!0===r.renderer.freezeworldmatrix&&null!=l&&l.push(c)):null!=(e=le.Toolkit.SceneManager.GetPrimitiveMeshes(o))&&0<e.length&&e.forEach(function(e){var t=le.Toolkit.SceneManager.GetSkinnedMesh(e);null!=t?(t.isPickable=!0,t.useVertexColors=!1,t.isVisible=a,t.visibility=s,t.billboardMode=u,t.cullingStrategy=le.AbstractMesh.CULLINGSTRATEGY_STANDARD,t.alwaysSelectAsActiveMesh=!0,null!=r.renderer.cullingstrategy&&r.renderer.cullingstrategy!==le.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(t.cullingStrategy=r.renderer.cullingstrategy),null!=r.renderer.castshadows&&!0===r.renderer.castshadows&&null!=n&&n.push(t),null!=r.renderer.receiveshadows&&!0===r.renderer.receiveshadows&&(t.receiveShadows=!0),null!=r.renderer.checkcollisions&&!0===r.renderer.checkcollisions&&(t.checkCollisions=!0),null!=r.renderer.istriggervolume&&!0===r.renderer.istriggervolume&&(t.collisionResponse=!1),null!=r.renderer.usevertexcolors&&(t.useVertexColors=r.renderer.usevertexcolors),null!=r.renderer.setmeshpickable&&(t.isPickable=r.renderer.setmeshpickable),null!=r.renderer.showboundingbox&&(t.showBoundingBox=r.renderer.showboundingbox),null!=r.renderer.defaultellipsoid&&(t.ellipsoid=le.Toolkit.Utilities.ParseVector3(r.renderer.defaultellipsoid)),null!=r.renderer.ellipsoidoffset&&(t.ellipsoidOffset=le.Toolkit.Utilities.ParseVector3(r.renderer.ellipsoidoffset)),null!=r.renderer.rendergroupid&&(t.renderingGroupId=r.renderer.rendergroupid),null!=r.renderer.freezeworldmatrix&&!0===r.renderer.freezeworldmatrix&&null!=l&&l.push(t)):(e.isPickable=!0,e.useVertexColors=!1,e.isVisible=a,e.visibility=s,e.billboardMode=u,e.cullingStrategy=le.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=r.renderer.cullingstrategy&&r.renderer.cullingstrategy!==le.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(e.cullingStrategy=r.renderer.cullingstrategy),null!=r.renderer.castshadows&&!0===r.renderer.castshadows&&null!=n&&n.push(e),null!=r.renderer.receiveshadows&&!0===r.renderer.receiveshadows&&(e.receiveShadows=!0),null!=r.renderer.checkcollisions&&!0===r.renderer.checkcollisions&&(e.checkCollisions=!0),null!=r.renderer.istriggervolume&&!0===r.renderer.istriggervolume&&(e.collisionResponse=!1),null!=r.renderer.usevertexcolors&&(e.useVertexColors=r.renderer.usevertexcolors),null!=r.renderer.setmeshpickable&&(e.isPickable=r.renderer.setmeshpickable),null!=r.renderer.showboundingbox&&(e.showBoundingBox=r.renderer.showboundingbox),null!=r.renderer.defaultellipsoid&&(e.ellipsoid=le.Toolkit.Utilities.ParseVector3(r.renderer.defaultellipsoid)),null!=r.renderer.ellipsoidoffset&&(e.ellipsoidOffset=le.Toolkit.Utilities.ParseVector3(r.renderer.ellipsoidoffset)),null!=r.renderer.rendergroupid&&(e.renderingGroupId=r.renderer.rendergroupid),null!=r.renderer.freezeworldmatrix&&!0===r.renderer.freezeworldmatrix&&null!=l&&l.push(e))})),null!=r.components)&&null!=(p=r.components)&&0<p.length&&p.forEach(function(e){if(null!=e)switch(e.alias){case"camera":le.Toolkit.MetadataParser.SetupCameraComponent(t,o,e);break;case"light":le.Toolkit.MetadataParser.SetupLightComponent(t,o,e);break;case"script":null!=i&&i.push({mesh:o,comp:e})}})},t.DoProcessPendingScripts=function(o,e,n,i){null!=e&&0<e.length&&(e.sort(function(e,t){return e.comp.order<t.comp.order?-1:e.comp.order>t.comp.order?1:0}),e.forEach(function(e){var t;null!=e.comp.klass&&""!==e.comp.klass&&"BABYLON.Toolkit.ScriptComponent"!==e.comp.klass&&(null!=(t=le.Toolkit.Utilities.InstantiateClass(e.comp.klass))?null!=(t=new t(e.mesh,o,e.comp.properties))?!0==t instanceof le.Toolkit.ScriptComponent?(e.comp.instance=t,null!=i&&i.push(e.comp.instance),e.comp.instance.addPreloaderTasks&&null!=n&&n.push(e.comp.instance),le.Toolkit.SceneManager.AttachScriptComponent(e.comp.instance,e.comp.klass,!1)):le.Tools.Warn("Non script component instantiated class: "+e.comp.klass):le.Tools.Warn("Failed to instantiate script class: "+e.comp.klass):le.Tools.Warn("Failed to locate script class: "+e.comp.klass))}))},t.DoProcessPendingShadows=function(e,n){null!=n&&0<n.length&&null!=e.lights&&0<e.lights.length&&e.lights.forEach(function(t){var o,e=t.getShadowGenerator();null!=e&&null!=t.metadata&&null!=t.metadata.toolkit&&!0===t.metadata.toolkit.autorender&&null!=(o=e.getShadowMap())&&n.forEach(function(e){!0===(!(null!=t.includedOnlyMeshes&&0<t.includedOnlyMeshes.length)||0<=t.includedOnlyMeshes.indexOf(e))&&(null==o.renderList&&(o.renderList=[]),o.renderList.indexOf(e)<0)&&o.renderList.push(e)})})},t.DoProcessPendingPhysics=function(t,e){var o,n;null!=e&&0<e.length&&(n=!0===(o=t.isPhysicsEnabled())?t.getPhysicsEngine():null,!0==(!0===o&&null!=n)?e.forEach(function(e){le.Toolkit.RigidbodyPhysics.SetupPhysicsComponent(t,e)}):le.Tools.Warn("Physics engine not loaded. Physics impostors will not be created."))},t.DoProcessPendingFreezes=function(e){null!=e&&0<e.length&&e.forEach(function(e){e.freezeWorldMatrix()})},t.SetupCameraComponent=function(o,e,t){e.checkCollisions=!1;var n=0,i=e.name+".Rig",l=null!=t.culling?t.culling:-1,r=null!=t.camerabase?t.camerabase:0,a=(null!=t.clearflags&&t.clearflags,null!=t.renderlist?t.renderlist:null),s=null!=t.maincamera&&t.maincamera,u=new(4===r?le.FreeCamera:le.UniversalCamera)(i,le.Vector3.Zero(),o);switch(u.checkCollisions=!1,u.rotationQuaternion=le.Quaternion.FromEulerAngles(0,0,0),u.parent=e,!0===s&&(o.activeCamera=u),null!=t.type?t.type:0){case 0:u.mode=le.Camera.PERSPECTIVE_CAMERA,null!=t.perspectiveyfov&&(u.fov=t.perspectiveyfov),null!=t.perspectiveznear&&(u.minZ=t.perspectiveznear),null!=t.perspectivezfar&&(u.maxZ=t.perspectivezfar);break;case 1:u.mode=le.Camera.ORTHOGRAPHIC_CAMERA,null!=t.orthoxmag&&(u.orthoLeft=-t.orthoxmag,u.orthoRight=t.orthoxmag),null!=t.orthoymag&&(u.orthoBottom=-t.orthoymag,u.orthoTop=t.orthoymag),null!=t.orthoznear&&(u.minZ=t.orthoznear),null!=t.orthozfar&&(u.maxZ=t.orthozfar)}if(-1!==l&&0!==l){var c=a;if(null!=c&&0<c.length)for(n=0;n<c.length;n++)!function(){var t,e=c[n],e=le.Toolkit.SceneManager.GetMeshByID(o,e);null!=e&&(t=e.name+".Detail",null!=(e=e.getChildren(function(e){return e.name===t},!0)))&&e.length}()}e.cameraRig=u},t.SetupLightComponent=function(n,e,t){e.checkCollisions=!1;var o=e.name+".Rig",i=0,l=1,r=null!=t.culling?t.culling:-1,a=(null!=t.clearflags&&t.clearflags,null!=t.renderlist?t.renderlist:null),s=null!=t.type?t.type:0,u=le.Toolkit.SceneManager.GetRenderQuality(),c=null!=t.exponentdecayspeed?t.exponentdecayspeed:1,p=!1;switch(s){case 0:var d=le.Vector3.Forward(),h=null!=t.orthoscale?t.orthoscale:.1,m=null!=t.ortholeft?t.ortholeft:Number.MAX_VALUE,g=null!=t.orthoright?t.orthoright:Number.MAX_VALUE,T=null!=t.orthotop?t.orthotop:Number.MAX_VALUE,f=null!=t.orthobottom?t.orthobottom:Number.MAX_VALUE,y=null!=t.calczbounds&&t.calczbounds,k=null!=t.updateextends&&t.updateextends,_=null!=t.shadowfrustumsize?t.shadowfrustumsize:0,v=new le.DirectionalLight(o,d,n);v.shadowFrustumSize=_,v.shadowOrthoScale=h,v.autoCalcShadowZBounds=y,v.autoUpdateExtends=k,v.orthoLeft=m,v.orthoRight=g,v.orthoTop=T,v.orthoBottom=f,(b=v).falloffType=le.Light.FALLOFF_STANDARD,p=u===le.Toolkit.RenderQuality.High||u===le.Toolkit.RenderQuality.Medium,l=le.Toolkit.SceneManager.DirectionalLightIntensity;break;case 1:var b;b=new le.PointLight(o,le.Vector3.Zero(),n);(b=b).falloffType=le.Light.FALLOFF_STANDARD,p=u===le.Toolkit.RenderQuality.High||u===le.Toolkit.RenderQuality.Medium,l=le.Toolkit.SceneManager.PointLightIntensity;break;case 2:d=le.Vector3.Forward(),_=null!=t.spotangle?t.spotangle:Math.PI/4,h=new le.SpotLight(o,le.Vector3.Zero(),d,0,c,n);h.angle=.966*le.Tools.ToRadians(_),h.innerAngle=.8*h.angle,(b=h).falloffType=le.Light.FALLOFF_GLTF,p=u===le.Toolkit.RenderQuality.High||u===le.Toolkit.RenderQuality.Medium,l=le.Toolkit.SceneManager.SpotLightIntensity}if(null!=b){var C=null!=t.range?t.range:Number.MAX_VALUE,S=null!=t.color?le.Toolkit.Utilities.ParseColor3(t.color,le.Color3.White()):le.Color3.White(),I=null!=t.specular?le.Toolkit.Utilities.ParseColor3(t.specular,le.Color3.White()):le.Color3.White(),C=(b.parent=e,b.range=C,b.diffuse=S,b.specular=I,b.intensity=(null!=t.intensity?t.intensity:1)*l,b.lightmapMode=le.Light.LIGHTMAP_DEFAULT,b.intensityMode=le.Light.INTENSITYMODE_AUTOMATIC,b.shadowEnabled=!1,null==t.autorender||t.autorender),S=null!=t.softshadows&&t.softshadows,I=null!=t.numcascades?t.numcascades:0,M=null!=t.cascadelambda?t.cascadelambda:1,w=null!=t.setdepthclamp&&t.setdepthclamp,N=null!=t.blendpertecntage?t.blendpertecntage:1e-8,U=null!=t.boundsrefreshrate?t.boundsrefreshrate:1,F=null!=t.lightcontactratio?t.lightcontactratio:.1,V=null!=t.stabilizecascades&&t.stabilizecascades,E=null!=t.penumbradarkness?t.penumbradarkness:1,G=null!=t.softshadowsfilter?t.softshadowsfilter:99,H=null!=t.freezeshadows&&t.freezeshadows,W=null!=t.calcdepths&&t.calcdepths,z=null!=t.depthscaling?t.depthscaling:50,Y=null!=t.blurscaling?t.blurscaling:2,Q=null==t.kernelblur||t.kernelblur,X=null!=t.blurkernelsize?t.blurkernelsize:1,j=null!=t.blurboxoffset?t.blurboxoffset:1,x=null!=t.shadowmapsize?t.shadowmapsize:1024,P=null!=t.generateshadows&&t.generateshadows,K=null!=t.shadowbiasfactor?t.shadowbiasfactor:.001,q=null!=t.normalbiasfactor?t.normalbiasfactor:.1,Z=null!=t.shadowmapbias?t.shadowmapbias:.05,J=null!=t.normalmapbias?t.normalmapbias:.4,A=null!=t.shadowstrength?t.shadowstrength:1,O=null!=t.shadowdistance?t.shadowdistance:150,$=null!=t.shadownearplane?t.shadownearplane:.2,ee=null!=t.shadowfilterquality?t.shadowfilterquality:"Medium",te=null!=t.transparencyshadow&&t.transparencyshadow,oe=null!=t.softtransparency&&t.softtransparency,ne=null==t.forcebackfacesonly||t.forcebackfacesonly,ie=null!=t.frustumedgefalloff?t.frustumedgefalloff:0,B=null!=t.usefullfloatfirst&&t.usefullfloatfirst;if(!0===p&&!0===P){var P=b,R=le.Toolkit.SceneManager.GetEngine(n),R=R instanceof le.Engine?R.webGLVersion:0,s=0===s&&2<=I&&2<=R,L=!0==s?new le.CascadedShadowGenerator(x,b,B):new le.ShadowGenerator(x,P,B);if(L.bias=Z*K,L.normalBias=J*q,L.depthScale=z,L.useKernelBlur=Q,L.blurKernel=X,L.blurScale=Y,L.blurBoxOffset=j,L.frustumEdgeFalloff=ie,L.forceBackFacesOnly=ne,L.transparencyShadow=te,L.enableSoftTransparentShadow=oe,L.contactHardeningLightSizeUVRatio=F,!0===S)if(R<=1)L.usePoissonSampling=!0;else if(!0==s)L.usePercentageCloserFiltering=!0;else switch(G){case 0:L.usePoissonSampling=!0;break;case 1:L.useExponentialShadowMap=!0;break;case 2:L.useBlurExponentialShadowMap=!0;break;case 3:L.useCloseExponentialShadowMap=!0;break;case 4:L.useBlurCloseExponentialShadowMap=!0;break;case 5:L.useContactHardeningShadow=!0;break;case 99:L.usePercentageCloserFiltering=!0;break;default:L.usePoissonSampling=!0}switch(ee){case"High":L.filteringQuality=le.ShadowGenerator.QUALITY_HIGH;break;case"Medium":L.filteringQuality=le.ShadowGenerator.QUALITY_MEDIUM;break;case"Low":L.filteringQuality=le.ShadowGenerator.QUALITY_LOW}!0==s?((x=L).lambda=M,x.depthClamp=w,x.shadowMaxZ=O,x.numCascades=I,x.penumbraDarkness=E,x.autoCalcDepthBounds=W,x.stabilizeCascades=V,x.cascadeBlendPercentage=N,x.autoCalcDepthBoundsRefreshRate=U,x.freezeShadowCastersBoundingInfo=H,x.setDarkness(1-le.Scalar.Clamp(A)),P.shadowEnabled=!0,x.splitFrustum()):(L.setDarkness(1-le.Scalar.Clamp(A)),P.shadowEnabled=!0,P.shadowMinZ=$,P.shadowMaxZ=O),null==b.metadata&&(b.metadata={}),null==b.metadata.toolkit&&(b.metadata.toolkit={}),b.metadata.toolkit.autorender=C}B=e.name+".Holder";if(-1===r)b.includedOnlyMeshes=[];else if(0===r)b.includedOnlyMeshes=[new le.Mesh(B,n)];else{b.includedOnlyMeshes=[new le.Mesh(B,n)];var D=a;if(null!=D&&0<D.length)for(i=0;i<D.length;i++)!function(){var t,e,o=D[i],o=le.Toolkit.SceneManager.GetMeshByID(n,o);null!=o&&(t=o.name+".Detail",null!=(e=o.getChildren(function(e){return e.name===t},!0))&&0<e.length?b.includedOnlyMeshes.push(e[0]):b.includedOnlyMeshes.push(o))}()}e.lightRig=b}},e.MetadataParser=t}(BABYLON=BABYLON||{}),"CVTOOLS_unity_metadata"),CVTOOLS_MESH="CVTOOLS_babylon_mesh",CVTOOLS_HAND="CVTOOLS_left_handed",CubeTextureLoader=function(){},CVTOOLS_unity_metadata=function(){function e(e){this.name=CVTOOLS_NAME,this.enabled=!1,this._babylonScene=null,this._metadataParser=null,this._loaderScene=null,this._assetsManager=null,this._materialMap=null,this._lightmapMap=null,this._reflectionMap=null,this._reflectionCache=null,this._assetContainer=!1,this._activeMeshes=!1,this._parseScene=!1,this._leftHanded=!1,this._disposeRoot=!1,this._sceneParsed=!1,this._preWarmTime=1,this._hideLoader=!1,this._rootUrl=null,this._fileName="Unknown",this._licenseName="Unknown",this._licenseType="standard",this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND),this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._rootUrl=null,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._readyList=null,this._preloadList=null,this._materialMap=null,this._lightmapMap=null,this._preWarmTime=1,this._hideLoader=!1,this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._animationGroups=null,this._metadataParser=null,this._babylonScene=null,this.order=100}return e.prototype.dispose=function(){delete this._loader},e.prototype.onLoading=function(){var e=this;BABYLON.Toolkit.Utilities.LoadingState=0,this._assetContainer=null!=this._loader._assetContainer,this._metadataParser=null,this._babylonScene=this._loader.babylonScene,this._loaderScene=null,this._assetsManager=null,this._rootUrl=this._loader._uniqueRootUrl||"/",this._fileName=this._loader._fileName||"Unknown",0<=this._fileName.indexOf("?")&&(this._fileName=this._fileName.split("?")[0]),this._loader.parent.onCompleteObservable.addOnce(function(){e.onComplete()}),this._loader.parent.onValidatedObservable.addOnce(function(){e.onValidate()}),this._parseScene=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND)&&!0===BABYLON.Toolkit.SceneManager.IsSceneParsingEnabled(),this._leftHanded=this._loader.isExtensionUsed(CVTOOLS_HAND),this._disposeRoot=this._sceneParsed=!1,this._animationGroups=[],this._masterList=[],this._detailList=[],this._parserList=[],this._shaderList=[],this._readyList=[],this._preloadList=[],this._materialMap=new Map,this._lightmapMap=new Map,this._preWarmTime=1,this._hideLoader=!1,this._reflectionMap={},this._reflectionCache={},BABYLON.Toolkit.Utilities.ResetLoaderItemsMarkedForDisposal(),this._babylonScene.getEngine().getCaps().supportSRGBBuffers=BABYLON.Toolkit.SceneManager.SupportSRGBBuffers,!0===this._leftHanded&&null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.rotationQuaternion=BABYLON.Quaternion.Identity(),this._loader.rootBabylonMesh.scaling=BABYLON.Vector3.One()),!0===this._parseScene&&(BABYLON.Toolkit.SceneManager.RenderLoopReady=!1,null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.name="Root."+this._fileName.replace(".gltf","").replace(".glb","")),this.setupLoader())},e.prototype.onReady=function(){!0===this._parseScene&&!0===this._disposeRoot&&null!=this._loader.rootBabylonMesh&&this._loader.rootBabylonMesh.dispose(!0)},e.prototype.onComplete=function(){this._parseScene,this.finishComplete()},e.prototype.getScriptBundleTag=function(){var e,t=null,o=this._loaderScene,o=null!=o&&null!=o.extras&&null!=o.extras.metadata?o.extras.metadata:null;return t=null!=o&&(null!=this._rootUrl&&this._rootUrl,e=null!=o.script?o.script:null,o=null!=o.project?o.project:null,null!=e)&&""!==e&&null!=o&&""!==o?o.toLocaleLowerCase():t},e.prototype.getScriptBundleUrl=function(){var e,t,o=null,n=this._loaderScene,n=null!=n&&null!=n.extras&&null!=n.extras.metadata?n.extras.metadata:null;return o=null!=n&&(e=null!=this._rootUrl?this._rootUrl:"/",t=null!=n.script?n.script:null,n=null!=n.project?n.project:null,null!=t)&&""!==t&&null!=n&&""!==n?e+n:o},e.prototype.finishComplete=function(){var e=this;!0===this._parseScene&&(this.startParsing(),BABYLON.Toolkit.SceneManager.RenderLoopReady=!0,this._babylonScene.onAfterRenderObservable.addOnce(function(){BABYLON.Toolkit.Utilities.LoadingState=3,e._processPreloadTimeout()}))},e.prototype.onValidate=function(){this._parseScene},e.prototype.onCleanup=function(){this._fileName=null,this._rootUrl=null,this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._preWarmTime=1,this._readyList=null,this._preloadList=null,this._hideLoader=!1,(this._animationGroups=null)!=this._materialMap&&(this._materialMap.clear(),this._materialMap=null),null!=this._lightmapMap&&(this._lightmapMap.clear(),this._lightmapMap=null),this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._metadataParser=null,this._babylonScene=null},e.prototype.setupLoader=function(){var n=this,i=this._fileName;!0===this._parseScene&&(this._assetsManager=new BABYLON.Toolkit.PreloadAssetsManager(this._babylonScene),this._assetsManager.onProgress=function(e,t,o){!0===BABYLON.Toolkit.SceneManager.AutoUpdateProgress?BABYLON.Toolkit.WindowManager.UpdateLoaderDetails("LOADING "+(t-e)+" OF "+t+(1===t?" ASSET":" ASSETS"),BABYLON.Toolkit.Utilities.LoadingState):null!=BABYLON.Toolkit.Utilities.OnPreloaderProgress&&BABYLON.Toolkit.Utilities.OnPreloaderProgress(e,t,o)},this._assetsManager.onFinish=function(o){BABYLON.Toolkit.WindowManager.SetTimeout(100,function(){BABYLON.Toolkit.Utilities.LoadingState=4,!0===BABYLON.Toolkit.SceneManager.AutoUpdateProgress&&BABYLON.Toolkit.WindowManager.UpdateLoaderStatus("PLEASE WAIT","PREPARING SCENE VIEW",BABYLON.Toolkit.Utilities.LoadingState);var e=0<n._preWarmTime?1e3*n._preWarmTime:100;BABYLON.Toolkit.WindowManager.SetTimeout(e,function(){if(null!=BABYLON.Toolkit.Utilities.OnPreloaderComplete&&BABYLON.Toolkit.Utilities.OnPreloaderComplete(o),n._processShaderMaterials(n._babylonScene,n._shaderList),BABYLON.Toolkit.Utilities.RemoveLoaderItemsMarkedForDisposal(),null!=n._readyList&&0<n._readyList.length)for(var e=0;e<n._readyList.length;e++){var t=n._readyList[e];null!=t&&t._ready&&t._ready()}n._babylonScene.onAfterRenderObservable.addOnce(function(){console.warn("CVTOOLS: OnSceneReady: "+i),null!=BABYLON.Toolkit.SceneManager.OnSceneReadyObservable&&BABYLON.Toolkit.SceneManager.OnSceneReadyObservable.notifyObservers(null!=i&&""!==i?i:"Unknown"),1==n._hideLoader&&BABYLON.Toolkit.WindowManager.HideSceneLoader(),n.onCleanup()})})})})},e.prototype.startParsing=function(){!0===this._parseScene&&(BABYLON.Toolkit.Utilities.LoadingState=2,this._processLevelOfDetail(this._babylonScene,this._detailList),this._processActiveMeshes(this._babylonScene,this._activeMeshes),this._processUnityMeshes(this._masterList),null!=this._loaderScene&&(this.preProcessSceneProperties(this._loaderScene,this._babylonScene),this.postProcessSceneProperties(this._rootUrl,this._loaderScene,this._babylonScene)),!1===this._assetContainer)&&null!=this._parserList&&0<this._parserList.length&&(this._metadataParser=BABYLON.Toolkit.Utilities.PostParseSceneComponents(this._babylonScene,this._parserList,this._preloadList,this._readyList))},e.prototype.loadSceneAsync=function(e,t){var o,n;return!0===this._parseScene&&(this._loaderScene=t),!0===this._parseScene&&null!=t.extras&&null!=t.extras.metadata?(null!=t.extras.metadata.rawmaterials&&(n=this._loader,o=t.extras.metadata.rawmaterials,this._preloadRawMaterialsAsync(e,n._gltf.materials,o)),BABYLON.Toolkit.Utilities.LoadingState=1,n=this._loader.loadSceneAsync(e,t),this.loadSceneExAsync(e,t),n):(BABYLON.Toolkit.Utilities.LoadingState=1,null)},e.prototype.loadSceneExAsync=function(e,t){var i=this,o=this._loader,n=new Array;if(o._gltf.nodes)for(var l=0,r=o._gltf.nodes;l<r.length;l++){var a=r[l];a._babylonTransformNode&&this._animationGroups&&BABYLON.Toolkit.Utilities.AssignAnimationGroupsToNode(a._babylonTransformNode,this._animationGroups)}if(null!=this._reflectionMap&&null!=this._reflectionCache){var s,u=0,c=this;for(s in this._reflectionMap)!function(e){var t;u++,c._reflectionMap.hasOwnProperty(e)&&(t=e,null!=c._assetsManager)&&((e=c._assetsManager.addBinaryFileTask("Material.ReflectionTextureTask"+u.toFixed(0),t)).onSuccess=function(e){var n;null!=e.data?(n=new Blob([e.data]),null!=(e=i._reflectionMap[t])&&e.forEach(function(e){var t,o;null!=e&&null!=e.mapkey&&(null!=(o=i._reflectionCache[e.mapkey])?null!=e.material&&BABYLON.Toolkit.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=o):(o=i._babylonScene,t=URL.createObjectURL(n),(o=new BABYLON.CubeTexture(t,o,null,null,null,o=function(){URL.revokeObjectURL(t)},o,null,e.prefiltered,e.extension)).name=e.name,null!=e.boundingBoxSize&&(o.boundingBoxSize=e.boundingBoxSize),null!=e.boundingBoxPosition&&(o.boundingBoxPosition=e.boundingBoxPosition),i._reflectionCache[e.mapkey]=o,null!=e.material&&BABYLON.Toolkit.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=o)))})):console.error("Failed to load reflection texture task: "+t)},e.onError=function(e,t,o){console.error(t,o)})}(s)}return o.logClose(),Promise.all(n).then(function(){})},e.prototype._processActiveMeshes=function(e,t){!0===t&&e.freeActiveMeshes()},e.prototype._processUnityMeshes=function(e){null!=e&&0<e.length&&e.forEach(function(e){BABYLON.Toolkit.Utilities.RegisterInstancedMeshBuffers(e)})},e.prototype._processPreloadTimeout=function(){if(null!=this._assetsManager){if(null!=this._preloadList&&0<this._preloadList.length)for(var e=0;e<this._preloadList.length;e++){var t=this._preloadList[e];null!=t&&t.addPreloaderTasks&&t.addPreloaderTasks(this._assetsManager)}this._babylonScene._preloaded=!0,this._assetsManager.load()}},e.prototype.loadNodeAsync=function(e,o,n){var i=this;return!0===this._parseScene&&null!=o.extras&&null!=o.extras.metadata?this._loader.loadNodeAsync(e,o,function(e){var t=o.extras.metadata;null==e.metadata&&(e.metadata={}),e.metadata.toolkit=t,BABYLON.Toolkit.Utilities.ValidateTransformGuid(e),BABYLON.Toolkit.Utilities.ValidateTransformMetadata(e),BABYLON.Toolkit.Utilities.ValidateTransformQuaternion(e),e.isVisible=null==e.metadata.toolkit.visible||e.metadata.toolkit.visible,e.visibility=null!=e.metadata.toolkit.visibility?e.metadata.toolkit.visibility:1,e.billboardMode=null!=e.metadata.toolkit.billboard?e.metadata.toolkit.billboard:0,!0===i._assetContainer&&(e.metadata.toolkit.prefab=!0),!0===e.metadata.toolkit.prefab?e.setEnabled(!1):(i._parserList.push(e),null!=o.extras.metadata.lods&&null!=o.extras.metadata.distances&&null!=i._detailList&&i._detailList.push(e)),i._masterList.push(e),n(e)}):null},e.prototype.loadMaterialPropertiesAsync=function(e,t,o){var n,i;return!0===this._parseScene?(n=-1,t.index&&0<=(n=t.index)&&null!=this._materialMap&&(this._materialMap.has(n)||this._materialMap.set(n,o)),o.gltfIndex=n,n=this._loader,i=new Array,o instanceof BABYLON.NodeMaterial?i.push(this._parseNodeMaterialPropertiesAsync("".concat(e,"/nodeMaterial"),t,o)):o instanceof BABYLON.ShaderMaterial?i.push(this._parseShaderMaterialPropertiesAsync("".concat(e,"/shaderMaterial"),t,o)):o instanceof BABYLON.StandardMaterial?i.push(this._parseDiffuseMaterialPropertiesAsync("".concat(e,"/standardMaterial"),t,o)):(n._extensionsLoadMaterialPropertiesAsync(e,t,o)||(i.push(n.loadMaterialBasePropertiesAsync(e,t,o)),t.pbrMetallicRoughness&&i.push(n._loadMaterialMetallicRoughnessPropertiesAsync("".concat(e,"/pbrMetallicRoughness"),t.pbrMetallicRoughness,o)),n.loadMaterialAlphaProperties(e,t,o)),this._parseCommonConstantProperties(i,"".concat(e,"/commonConstant"),t,o)),Promise.all(i).then(function(){})):null},e.prototype._getCachedMaterialByIndex=function(e){var t=null;return t=0<=e&&null!=this._materialMap?this._materialMap.get(e)||null:t},e.prototype._getCachedLightmapByIndex=function(e){var t=null;return t=0<=e&&null!=this._lightmapMap?this._lightmapMap.get(e)||null:t},e.prototype.createMaterial=function(e,t,o){if(!0===this._parseScene&&t.index){var n=t.index;if(0<=n){n=this._getCachedMaterialByIndex(n);if(null!=n)return n}}var i,l;return!0===this._parseScene?(n=t.name||"No Name",(i=null)!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.customMaterial&&(l=(t=t.extras.metadata).customMaterial,t.customShader,null!=(t=BABYLON.Toolkit.Utilities.InstantiateClass(l))?null!=(t=new t(n,this._loader.babylonScene))?!0==t instanceof BABYLON.Material?((i=t).fillMode=o,i instanceof BABYLON.ShaderMaterial&&BABYLON.Toolkit.Utilities.InitializeShaderMaterial(i)):BABYLON.Tools.Warn("Non material instantiated class: "+l):BABYLON.Tools.Warn("Failed to instantiate material class: "+l):BABYLON.Tools.Warn("Failed to locate material class: "+l)),i):null},e.prototype.loadAnimationAsync=function(e,t){if(!0!==this._parseScene)return null;this._loader;var o=t,n=(this._babylonScene._blockEntityCollection=!!this._assetContainer,new BABYLON.AnimationGroup(t.name||"animation".concat(o.index),this._babylonScene)),i=(n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o._babylonAnimationGroup=n,this._animationGroups.push(n),new Array);BABYLON.GLTF2.ArrayItem.Assign(o.channels),BABYLON.GLTF2.ArrayItem.Assign(o.samplers);for(var l=0,r=t.channels;l<r.length;l++){var a=r[l],s=a;i.push(this._loader._loadAnimationChannelAsync("".concat(e,"/channels/").concat(s.index),e,t,a,function(e,t){e.animations=e.animations||[],e.animations.push(t),n.addTargetedAnimation(t,e)}))}return Promise.all(i).then(function(){var e;return null!=t.extras&&null!=t.extras.metadata&&((e={}).toolkit=t.extras.metadata,null!=(n.metadata=e).label)&&""!==e.label&&(n.name=e.label),n.normalize(0),n})},e.prototype._loadMeshPrimitiveAsync=function(t,e,o,n,i,l){var r,a,s,u,c,p,d,h=this;return!0===this._parseScene?((r=this._loader).logOpen("".concat(t)),u=void 0,(a=0===r._disableInstancedMesh&&r._parent.createInstances&&null==o.skin&&!n.primitives[0].targets)&&i._instanceData?(r._babylonScene._blockEntityCollection=!!r._assetContainer,(s=i._instanceData.babylonSourceMesh.createInstance(e))._parentContainer=r._assetContainer,r._babylonScene._blockEntityCollection=!1,u=i._instanceData.promise):(c=new Array,r._babylonScene._blockEntityCollection=!!r._assetContainer,(p=new BABYLON.Mesh(e,r._babylonScene))._parentContainer=r._assetContainer,!(r._babylonScene._blockEntityCollection=!1)===this._leftHanded?p.overrideMaterialSideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:p.overrideMaterialSideOrientation=r._babylonScene.useRightHandedSystem?BABYLON.Material.CounterClockWiseSideOrientation:BABYLON.Material.ClockWiseSideOrientation,r._createMorphTargets(t,o,n,i,p),c.push(r._loadVertexDataAsync(t,i,p).then(function(e){return r._loadMorphTargetsAsync(t,i,p,e).then(function(){r._disposed||(r._babylonScene._blockEntityCollection=!!r._assetContainer,e.applyToMesh(p),h._setupBabylonMesh(p,o,n,i),e._parentContainer=r._assetContainer,r._babylonScene._blockEntityCollection=!1)})})),e=BABYLON.GLTF2.GLTFLoader._GetDrawMode(t,i.mode),null!=i.extras&&null!=i.extras.metadata&&null!=i.extras.metadata.multimaterial&&null!=i.extras.metadata.submeshes?this._setupBabylonMaterials(t,c,e,p,n,i):null==i.material?((d=r._defaultBabylonMaterialData[e])||(d=r._createDefaultMaterial("__GLTFLoader._default",e),r._parent.onMaterialLoadedObservable.notifyObservers(d),r._defaultBabylonMaterialData[e]=d),p.material=d):r.parent.skipMaterials||(d=BABYLON.GLTF2.ArrayItem.Get("".concat(t,"/material"),r._gltf.materials,i.material),c.push(r._loadMaterialAsync("/materials/".concat(d.index),d,p,e,function(e){p.material=e}))),u=Promise.all(c),a&&(i._instanceData={babylonSourceMesh:p,promise:u}),s=p),BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(s,t),r._parent.onMeshLoadedObservable.notifyObservers(s),l(s),r.logClose(),u.then(function(){return s})):null},e.prototype._setupBabylonMesh=function(e,t,o,n){if(!0===this._parseScene){this._loader;if(null!=n.extras&&null!=n.extras.metadata&&null!=n.extras.metadata.multimaterial&&null!=n.extras.metadata.submeshes){var i=n.extras.metadata.submeshes;e.subMeshes=[];for(var l=0;l<i.length;l++){var r=i[l];BABYLON.SubMesh.AddToMesh(r.materialIndex,r.verticesStart,r.verticesCount,r.indexStart,r.indexCount,e)}}e.computeWorldMatrix(!0)}},e.prototype._setupBabylonMaterials=function(t,e,o,n,i,l){var r,a,s,u,c;!0===this._parseScene&&(r=this._loader,a=(l=l.extras.metadata.multimaterial).materials,s=[],u=l.id||"MM_"+i.name,l=l.name||"MM_"+i.name,(c=new BABYLON.MultiMaterial("["+l+"]",r._babylonScene)).id=u,a.forEach(function(e){null!=e?0<=(e=parseInt(e))?(e=BABYLON.GLTF2.ArrayItem.Get("".concat(t,"/material"),r._gltf.materials,e),s.push(e)):console.warn("Invalid Submesh Material Index Encountered For: "+n.name):console.warn("Null Submesh Material Encountered For: "+n.name)}),e.push(this._parseMultiMaterialAsync("/materials/".concat(l),s,n,o,function(e){c.subMaterials=e,n.material=c})))},e.prototype._processLevelOfDetail=function(e,t){null!=t&&0<t.length&&t.forEach(function(o){var e,n,i,l,t;null!=o.metadata&&null!=o.metadata.toolkit&&null!=o.metadata.toolkit.lods&&null!=o.metadata.toolkit.distances&&(e=(t=o.metadata.toolkit).lods,(n=t.distances).length>=e.length)&&(l=i=null,e.forEach(function(e,t){e="*"===e?o:SM.FindChildTransformNode(o,e,BABYLON.Toolkit.SearchType.ExactMatch,!1);null!=e&&e instanceof BABYLON.AbstractMesh&&(0===t?i=e:(l=null==l?[]:l).push(e))}),null!=i)&&(i instanceof BABYLON.Mesh?(1/0<=(t=0<n.length?n[n.length-1]:0)&&(t=0),null!=l&&l.forEach(function(e,t){i.addLODLevel(n[t],e)}),0<t&&i.addLODLevel(t,null)):i instanceof BABYLON.InstancedMesh&&null!=l&&l.forEach(function(e,t){try{e.dispose()}catch(e){}BABYLON.Tools.Warn("Destroyed Unused Level Detail: "+e.name+" --\x3e For Transform: "+o.name)}))})},e.prototype._processShaderMaterials=function(e,t){null!=t&&0<t.length&&t.forEach(function(e){e.freeze()})},e.prototype.preProcessSceneProperties=function(e,t){var o,n,i,l,r,a;!0!==this._assetContainer&&!1===this._sceneParsed&&null!=e.extras&&null!=e.extras.metadata&&null!=e.extras.metadata.properties&&!0===e.extras.metadata.properties&&(this._sceneParsed=!0,n=null!=this._rootUrl?this._rootUrl:"/",e=e.extras.metadata,null==t.metadata&&(t.metadata={}),null==t.metadata.toolkit&&(t.metadata.toolkit={}),t.metadata.toolkit=e,this._disposeRoot=null!=e.disposeroot&&!0===e.disposeroot,this._hideLoader=null!=e.hideloader&&!0===e.hideloader,this._preWarmTime=null!=e.prewarmup?e.prewarmup:0,this._licenseType=null!=e.license?e.license:"standard",this._licenseName=null!=e.licensee?e.licensee:"Unknown",BABYLON.Toolkit.SceneManager.SetRootUrl(t,n),BABYLON.Toolkit.SceneManager.SetSceneFile(t,this._fileName),BABYLON.Toolkit.SceneManager.EnableUserInput=!0,null!=this._licenseName&&""!==this._licenseName&&"Unknown"!==this._licenseName&&"DefaultCompany"!==this._licenseName&&"Default Company"!==this._licenseName&&console.log("LICENSE: The '"+this._fileName+"' interactive content file is licensed to "+this._licenseName+"."),BABYLON.Toolkit.SceneManager.GlobalOptions.ktxtextures=null!=e.ktxtextures&&e.ktxtextures,BABYLON.Toolkit.SceneManager.GlobalOptions.ktxlightmaps=null!=e.ktxlightmaps&&e.ktxlightmaps,BABYLON.Toolkit.SceneManager.GlobalOptions.intensityFactor=null!=e.intensity?e.intensity:1,BABYLON.Toolkit.SceneManager.GlobalOptions.debugModeEnabled=null!=e.debugging&&e.debugging,BABYLON.Toolkit.SceneManager.GlobalOptions.showDebugColliders=null!=e.showdebugcolliders&&e.showdebugcolliders,BABYLON.Toolkit.SceneManager.GlobalOptions.colliderVisibility=null!=e.collidervisibility?e.collidervisibility:0,BABYLON.Toolkit.SceneManager.GlobalOptions.colliderRenderGroup=null!=e.colliderrendergroup?e.colliderrendergroup:0,BABYLON.Toolkit.SceneManager.GlobalOptions.defaultRenderGroup=null!=e.defaultrendergroup?e.defaultrendergroup:0,BABYLON.Toolkit.SceneManager.GlobalOptions.collisionWireframe=null!=e.collisionwireframe&&e.collisionwireframe,BABYLON.Toolkit.SceneManager.GlobalOptions.useTriangleNormals=null!=e.trianglenormals&&e.trianglenormals,BABYLON.Toolkit.SceneManager.GlobalOptions.useConvexTriangles=null==e.convextriangles||e.convextriangles,BABYLON.Toolkit.SceneManager.GlobalOptions.colliderInstances=null==e.colliderinstances||e.colliderinstances,BABYLON.Toolkit.SceneManager.GlobalOptions.reparentColliders=null==e.reparentcolliders||e.reparentcolliders,null!=e.clearcolor&&(t.clearColor=BABYLON.Toolkit.Utilities.ParseColor4(e.clearcolor)),null!=e.autoclear&&!0===e.autoclear&&(t.autoClear=!0,t.autoClearDepthAndStencil=!0),null!=e.rendergroups&&(BABYLON.RenderingManager.MAX_RENDERINGGROUPS=e.rendergroups),null!=e.imageprocessing&&(o=null!=(n=e.imageprocessing).contrast?n.contrast:1,n=null!=n.exposure?n.exposure:1,null!=t.imageProcessingConfiguration)&&(t.imageProcessingConfiguration.contrast=o,t.imageProcessingConfiguration.exposure=n),o=BABYLON.Toolkit.SceneManager.AmbientLightIntensity,null!=e.ambientcoloring&&(t.ambientColor=BABYLON.Toolkit.Utilities.ParseColor3(e.ambientcoloring)),null!=e.ambientlighting&&0<e.ambientlighting&&(null==(n=t)._AmbientLight&&(n._AmbientLight=new BABYLON.HemisphericLight("Ambient Lighting",new BABYLON.Vector3(0,1,0),t),n._AmbientLight.falloffType=BABYLON.Light.FALLOFF_STANDARD,n._AmbientLight.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT),null!=n._AmbientLight)&&(null!=e.ambientskycolor&&(n._AmbientLight.diffuse=BABYLON.Toolkit.Utilities.ParseColor3(e.ambientskycolor,BABYLON.Color3.Gray())),null!=e.ambientspecularcolor&&(n._AmbientLight.specular=BABYLON.Toolkit.Utilities.ParseColor3(e.ambientspecularcolor,BABYLON.Color3.White())),null!=e.ambientgroundcolor&&(n._AmbientLight.groundColor=BABYLON.Toolkit.Utilities.ParseColor3(e.ambientgroundcolor,BABYLON.Color3.Gray())),null!=e.ambientlightintensity&&(n._AmbientLight.intensity=e.ambientlightintensity),n._AmbientLight.intensity*=o),null!=e.fogmode&&0<(n=e.fogmode)&&(t.fogMode=n,t.fogEnabled=!0,(o=1)===n?o=.5:2===n&&(o=.75),null!=e.fogdensity&&(t.fogDensity=e.fogdensity*o),null!=e.fogstart&&(t.fogStart=e.fogstart),null!=e.fogend&&(t.fogEnd=e.fogend),null!=e.fogcolor)&&(t.fogColor=BABYLON.Toolkit.Utilities.ParseColor3(e.fogcolor)),n=new BABYLON.Vector3(0,-9.81,0),o=null!=e.defaultgravity?BABYLON.Toolkit.Utilities.ParseVector3(e.defaultgravity,n):n,t.gravity=o.clone(),t.collisionsEnabled=!0,null!=e.enablephysics&&!0===e.enablephysics&&(n=null==e.ccdenabled||e.ccdenabled,i=null!=e.ccdpenetration?e.ccdpenetration:1e-4,a=null!=e.subtimestep?e.subtimestep:0,l=null!=e.maxworldsweep?e.maxworldsweep:0,r=null==e.deltaworldstep||e.deltaworldstep,BABYLON.Toolkit.RigidbodyPhysics.ConfigurePhysicsEngine(t,r,a,l,n,i,o)),null!=e.userinput&&(r=e.userinput,BABYLON.Toolkit.UserInputOptions.KeyboardSmoothing=r.keyboardSmoothing,BABYLON.Toolkit.UserInputOptions.KeyboardMoveSensibility=r.keyboardSensitivity,BABYLON.Toolkit.UserInputOptions.KeyboardArrowSensibility=1,BABYLON.Toolkit.UserInputOptions.KeyboardMoveDeadZone=r.keyboardDeadZone,BABYLON.Toolkit.UserInputOptions.GamepadDeadStickValue=r.padDeadStick,BABYLON.Toolkit.UserInputOptions.GamepadLStickXInverted=r.padLStickXInvert,BABYLON.Toolkit.UserInputOptions.GamepadLStickYInverted=r.padLStickYInvert,BABYLON.Toolkit.UserInputOptions.GamepadRStickXInverted=r.padRStickXInvert,BABYLON.Toolkit.UserInputOptions.GamepadRStickYInverted=r.padRStickYInvert,BABYLON.Toolkit.UserInputOptions.GamepadLStickSensibility=r.padLStickLevel,BABYLON.Toolkit.UserInputOptions.GamepadRStickSensibility=r.padRStickLevel,BABYLON.Toolkit.UserInputOptions.SupportedInputDevices=r.supportedDevices,BABYLON.Toolkit.UserInputOptions.BabylonAngularSensibility=2e3,BABYLON.Toolkit.UserInputOptions.DefaultAngularSensibility=r.mouseSensitivity,BABYLON.Toolkit.UserInputOptions.PointerWheelDeadZone=r.wheelDeadZone,BABYLON.Toolkit.UserInputOptions.PointerMouseDeadZone=r.mouseDeadZone,BABYLON.Toolkit.UserInputOptions.PointerMouseInverted=r.mouseMoveInvert,BABYLON.Toolkit.UserInputOptions.UseCanvasElement=r.useCanvasElement,BABYLON.Toolkit.UserInputOptions.UseArrowKeyRotation=r.arrowKeyRotation,BABYLON.Toolkit.UserInputOptions.EnableBabylonRotation=!1),null!=e.enableinput&&!0===e.enableinput&&(a={contextMenu:null==e.contextmenu||e.contextmenu,pointerLock:null!=e.pointerlock&&e.pointerlock,preventDefault:null!=e.preventdefault&&e.preventdefault,useCapture:null!=e.usecapture&&e.usecapture},BABYLON.Toolkit.InputController.ConfigureUserInput(t.getEngine(),t,a)),null!=e.freezeactivemeshes&&!0===e.freezeactivemeshes&&(this._activeMeshes=!0),null!=e.performancepriority)&&(t.performancePriority=e.performancepriority)},e.prototype.postProcessSceneProperties=function(e,t,o){var i=this;if(!0!==this._assetContainer&&null!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.properties&&!0===t.extras.metadata.properties){var n,l,r,a,s,t=t.extras.metadata;if(null!=t.skybox){var u,c,p,d,h,m=t.skybox,g=null!=m.skyfog&&m.skyfog,T=null!=m.skytags?m.skytags:"Untagged",f=null!=m.skysize?m.skysize:1e3,y=null!=m.rotation?m.rotation:0,e=null!=m.basename&&""!==m.basename?e+m.basename:null,k=null!=m.skyfaces?m.skyfaces:null,_=null!=m.rendergroup?m.rendergroup:0,v=null!=m.extensions&&0<m.extensions.length?m.extensions:null,b=null!=m.polynomial?m.polynomial:1;try{null!=k&&""!==k&&null!=e&&""!==e&&(c=null,"png"===k?(c=new BABYLON.CubeTexture(e,o,v),0<=e.indexOf("_rgbd")?(c.isRGBD=!0,c.gammaSpace=!1):(c.isRGBD=!1,c.gammaSpace=!0)):"jpg"===k||"ktx2"===k||"webp"===k?((c=new BABYLON.CubeTexture(e,o,v)).isRGBD=!1,c.gammaSpace=!0):(u=e+"."+k,(c=new BABYLON.CubeTexture(u,o,null,!0,null,null,null,null,!0)).gammaSpace=!1),c.name=m.basename,c.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,c.rotationY=BABYLON.Tools.ToRadians(y),p="Default Skybox",(d=BABYLON.MeshBuilder.CreateBox(p,{size:f},o)).renderingGroupId=BABYLON.Toolkit.Utilities.DefaultRenderGroup(),d.id=p,d.infiniteDistance=!0,d.applyFog=g,d.renderingGroupId=_,null!=T&&""!==T&&BABYLON.Tags.AddTagsTo(d,T),!0===o.useRightHandedSystem&&(d.scaling.x*=-1),(h=new BABYLON.StandardMaterial("Skybox-Material",o)).backFaceCulling=!1,h.disableLighting=!0,h.diffuseColor=new BABYLON.Color3(0,0,0),h.emissiveColor=new BABYLON.Color3(0,0,0),h.specularColor=new BABYLON.Color3(0,0,0),h.ambientColor=new BABYLON.Color3(0,0,0),h.reflectionTexture=c,d.material=h)}catch(e){console.warn(e)}if(null!=m.environment){var v=m.environment,C=(o.environmentIntensity=null!=v.level?BABYLON.Scalar.Clamp(v.level,0,10):1,null!=v.info&&""!==v.info?v.info:null);if(null!=C&&""!==C)try{var S,I=BABYLON.Toolkit.SceneManager.GetRootUrl(o)+C.rooturl+C.name;null!=this._assetsManager&&((S=this._assetsManager.addBinaryFileTask("Global.EnvironmentTextureTask",I)).onSuccess=function(e){var t,o,n;null!=e.data?(e=new Blob([e.data]),t=i._babylonScene,o=URL.createObjectURL(e),e=function(){URL.revokeObjectURL(o)},n=I.toLowerCase().endsWith(".env")?".env":".dds",e=new BABYLON.CubeTexture(o,t,null,null,null,e,e,null,!0,n),t.environmentTexture=e,t.environmentTexture.name="assets/"+C.name,null!=t.environmentTexture&&null!=t.environmentTexture.sphericalPolynomial&&(t.isReady()?t.environmentTexture.sphericalPolynomial.scaleInPlace(b):t.onReadyObservable.addOnce(function(){t.environmentTexture.sphericalPolynomial.scaleInPlace(b)}))):console.error("Failed to load environment texture task: "+I)},S.onError=function(e,t,o){console.error(t,o)})}catch(e){console.warn(e)}}}null!=t.navigation&&null!=t.navigation.prebaked&&""!==t.navigation.prebaked&&(n=null!=t.navigation.collision&&!0===t.navigation.collision,l=null!=t.navigation.showdebug&&!0===t.navigation.showdebug,e=null!=t.navigation.debugcolor?t.navigation.debugcolor:[.05,.225,.75],r=new BABYLON.Color3(e[0],e[1],e[2]),a=null!=t.navigation.timesteps?t.navigation.timesteps:0,null!=this._assetsManager)&&(s=t.navigation.prebaked,(k=this._assetsManager.addBinaryFileTask("System.NavigationMeshTask",s)).onSuccess=function(e){null!=e.data?(e=new Uint8Array(e.data),BABYLON.Toolkit.SceneManager.LoadNavigationMesh(o,e,l,r,a,n)):console.error("Failed to load navigation mesh task: "+s)},k.onError=function(e,t,o){console.error(t,o)})}},e.prototype._preloadRawMaterialsAsync=function(o,n,e){var i=this._loader,l=new Array,r=BABYLON.Material.TriangleFillMode;return e.forEach(function(e){var t,e=BABYLON.GLTF2.ArrayItem.Get("".concat(o,"/material"),n,e);null!=e&&(t=i.createMaterial(o,e,r),BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(t,o),i._parent.onMaterialLoadedObservable.notifyObservers(t),l.push(i.loadMaterialPropertiesAsync(o,e,t)))}),Promise.all(l).then(function(){})},e.prototype._parseMultiMaterialAsync=function(n,e,t,i,o){var l,r,a=this,s=(void 0===o&&(o=function(){}),this._loader),u=e,c=(u._data=u._data||{},u._data[i]);return c||(s.logOpen("".concat(n," ").concat(t.name||"")),l=[],r=new Array,e.forEach(function(e){var t,o=null;null==(o=e.index&&0<=(t=e.index)?a._getCachedMaterialByIndex(t):o)&&(o=s.createMaterial(n,e,i),BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(o,n),s._parent.onMaterialLoadedObservable.notifyObservers(o),r.push(s.loadMaterialPropertiesAsync(n,e,o))),l.push(o)}),c={babylonMaterials:l,babylonMeshes:[],promises:r},u._data[i]=c,s.logClose()),c.babylonMeshes.push(t),t.onDisposeObservable.addOnce(function(){var e=c.babylonMeshes.indexOf(t);-1!==e&&c.babylonMeshes.splice(e,1)}),o(c.babylonMaterials),Promise.all(c.promises).then(function(){return c.babylonMaterials})},e.prototype._parseNodeMaterialPropertiesAsync=function(o,t,n){var e,i=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,l=n,r=new Array;l.backFaceCulling=null==i||null==i.backFaceCulling||i.backFaceCulling,t.doubleSided&&(l.backFaceCulling=!1);if(t.pbrMetallicRoughness&&(g=t.pbrMetallicRoughness)&&(g.baseColorFactor?(e=BABYLON.Color4.FromArray(g.baseColorFactor),l.setVector4("_Color",new BABYLON.Vector4(Math.pow(e.r,1/2.2),Math.pow(e.g,1/2.2),Math.pow(e.b,1/2.2),e.a)),e.a):l.setVector4("_Color",new BABYLON.Vector4(1,1,1,1)),g.baseColorTexture)&&r.push(this._loader.loadTextureInfoAsync("".concat(o,"/baseColorTexture"),g.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)");e.level=null!=i&&null!=i.diffuseIntensity?i.diffuseIntensity:1,l.setTexture("_MainTex",e)})),t.normalTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(o,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)");null!=t.normalTexture.scale&&(e.level=t.normalTexture.scale),l.setTexture("_BumpMap",e)})),t.occlusionTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(o,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)");null!=t.occlusionTexture.strength&&(e.level=t.occlusionTexture.strength),l.setTexture("_OcclusionMap",e)})),t.emissiveFactor&&(0<(e=BABYLON.Color4.FromArray(t.emissiveFactor)).r||0<e.g||0<e.b)&&l.setVector4("_EmissionColor",new BABYLON.Vector4(Math.pow(e.r,1/2.2),Math.pow(e.g,1/2.2),Math.pow(e.b,1/2.2),e.a)),t.emissiveTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(o,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)"),l.setTexture("_EmissionMap",e)})),null!=i){if(l.wireframe=null!=i.useWireframe&&i.useWireframe,l.needDepthPrePass=null!=i.depthPrepass&&i.depthPrepass,i.customTextures){var a,s=this;for(a in i.customTextures)!function(t){var e=i.customTextures[t];null!=e&&r.push(s._loader.loadTextureInfoAsync(o+"/"+t,e,function(e){e.name="".concat(n.name,"detailsSampler"===t||"normalsSampler"===t?" (Atlas)":" (Custom)"),l.setTexture(t,e)}))}(a)}if(i.customVectors)for(var u in i.customVectors){var c=i.customVectors[u];null!=c&&l.setVector4(u,BABYLON.Vector4.FromArray(c))}if(i.customColors)for(var p in i.customColors){var d=i.customColors[p];null!=d&&l.setVector4(p,BABYLON.Vector4.FromArray(d))}if(i.customFloats)for(var h in i.customFloats){var m=i.customFloats[h];null!=m&&l.setFloat(h,m)}null!=i.freezeMaterial&&!0===i.freezeMaterial&&null!=this._shaderList&&this._shaderList.push(l)}var g=Promise.all(r).then(function(){});return l.compile(),g},e.prototype._parseShaderMaterialPropertiesAsync=function(o,t,n){var e,i,l=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,r=n,a=new Array,s=(r.backFaceCulling=null==l||null==l.backFaceCulling||l.backFaceCulling,t.doubleSided&&(r.backFaceCulling=!1),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"ambientColor")&&(r.ambientColor=null!=l&&l.ambientColorFactor?BABYLON.Color3.FromArray(l.ambientColorFactor):BABYLON.Color3.Black()),1);switch(t.pbrMetallicRoughness&&(e=t.pbrMetallicRoughness)&&(e.baseColorFactor?(i=BABYLON.Color4.FromArray(e.baseColorFactor),r.setVector4("diffuseColor",new BABYLON.Vector4(Math.pow(i.r,1/2.2),Math.pow(i.g,1/2.2),Math.pow(i.b,1/2.2),i.a)),s=i.a):r.setVector4("diffuseColor",new BABYLON.Vector4(1,1,1,1)),e.baseColorTexture)&&a.push(this._loader.loadTextureInfoAsync("".concat(o,"/baseColorTexture"),e.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)");e.level=null!=l&&null!=l.diffuseIntensity?l.diffuseIntensity:1,r.setTexture("diffuseTexture",e)})),t.normalTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(o,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)");null!=t.normalTexture.scale&&(e.level=t.normalTexture.scale),r.setTexture("bumpTexture",e)})),t.occlusionTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(o,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)");null!=t.occlusionTexture.strength&&(e.level=t.occlusionTexture.strength),r.setTexture("ambientTexture",e)})),t.emissiveFactor&&(0<(i=BABYLON.Color4.FromArray(t.emissiveFactor)).r||0<i.g||0<i.b)&&r.setVector4("emissiveColor",new BABYLON.Vector4(Math.pow(i.r,1/2.2),Math.pow(i.g,1/2.2),Math.pow(i.b,1/2.2),i.a)),t.emissiveTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(o,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)"),r.setTexture("emissiveTexture",e)})),r.alpha=s,t.alphaMode||"OPAQUE"){case"OPAQUE":r.alpha=1,r.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_OPAQUE;break;case"MASK":r.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHATEST;break;case"BLEND":r.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHABLEND;break;default:throw new Error("".concat(o,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}if(null!=l){if(r.wireframe=null!=l.useWireframe&&l.useWireframe,r.needDepthPrePass=null!=l.depthPrepass&&l.depthPrepass,l.customTextures){var u,c=this;for(u in l.customTextures)!function(t){var e=l.customTextures[t];null!=e&&a.push(c._loader.loadTextureInfoAsync(o+"/"+t,e,function(e){e.name="".concat(n.name,"detailsSampler"===t||"normalsSampler"===t?" (Atlas)":" (Custom)"),r.setTexture(t,e)}))}(u)}if(l.customVectors)for(var p in l.customVectors){var d=l.customVectors[p];null!=d&&r.setVector4(p,BABYLON.Vector4.FromArray(d))}if(l.customColors)for(var h in l.customColors){var m=l.customColors[h];null!=m&&r.setVector4(h,BABYLON.Vector4.FromArray(m))}if(l.customFloats)for(var g in l.customFloats){var T=l.customFloats[g];null!=T&&r.setFloat(g,T)}null!=l.freezeMaterial&&!0===l.freezeMaterial&&null!=this._shaderList&&this._shaderList.push(r)}return Promise.all(a).then(function(){})},e.prototype._parseDiffuseMaterialPropertiesAsync=function(e,t,o){var n,i,l=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,r=o,a=new Array,s=(BABYLON.Toolkit.Utilities.HasOwnProperty(r,"ambientColor")&&(r.ambientColor=null!=l&&l.ambientColorFactor?BABYLON.Color3.FromArray(l.ambientColorFactor):BABYLON.Color3.Black()),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"backFaceCulling")&&(r.backFaceCulling=null==l||null==l.backFaceCulling||l.backFaceCulling),t.doubleSided&&(BABYLON.Toolkit.Utilities.HasOwnProperty(r,"twoSidedLighting")&&(r.twoSidedLighting=!0),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"backFaceCulling"))&&(r.backFaceCulling=!1),1);switch(t.pbrMetallicRoughness&&(n=t.pbrMetallicRoughness)&&(BABYLON.Toolkit.Utilities.HasOwnProperty(r,"diffuseColor")&&(n.baseColorFactor?(i=BABYLON.Color4.FromArray(n.baseColorFactor),r.diffuseColor=new BABYLON.Color3(Math.pow(i.r,1/2.2),Math.pow(i.g,1/2.2),Math.pow(i.b,1/2.2)),s=i.a):r.diffuseColor=BABYLON.Color3.White()),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"diffuseTexture"))&&n.baseColorTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),n.baseColorTexture,function(e){e.name="".concat(o.name," (Base Color)"),r.diffuseTexture=e,r.diffuseTexture.level=null!=l&&null!=l.diffuseIntensity?l.diffuseIntensity:1})),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"bumpTexture")&&t.normalTexture&&(a.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(o.name," (Normal)"),r.bumpTexture=e,null!=t.normalTexture.scale&&(r.bumpTexture.level=t.normalTexture.scale)})),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"invertNormalMapX")&&(r.invertNormalMapX=!this._loader.babylonScene.useRightHandedSystem),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"invertNormalMapY"))&&(r.invertNormalMapY=this._loader.babylonScene.useRightHandedSystem),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"ambientTexture")&&t.occlusionTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(o.name," (Occlusion)"),r.ambientTexture=e,null!=t.occlusionTexture.strength&&(r.ambientTexture.level=t.occlusionTexture.strength)})),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"emissiveColor")&&(i=t.emissiveFactor?BABYLON.Color4.FromArray(t.emissiveFactor):new BABYLON.Color4(0,0,0,1),r.emissiveColor=new BABYLON.Color3(Math.pow(i.r,1/2.2),Math.pow(i.g,1/2.2),Math.pow(i.b,1/2.2))),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"emissiveTexture")&&t.emissiveTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(o.name," (Emissive)"),r.emissiveTexture=e,BABYLON.Toolkit.Utilities.HasOwnProperty(r,"useEmissiveAsIllumination")&&(r.useEmissiveAsIllumination=null!=l&&null!=l.useEmissiveAsIllumination&&l.useEmissiveAsIllumination)})),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"alpha")&&(r.alpha=s),t.alphaMode||"OPAQUE"){case"OPAQUE":BABYLON.Toolkit.Utilities.HasOwnProperty(r,"alpha")&&(r.alpha=1);break;case"MASK":r.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff,r.diffuseTexture&&BABYLON.Toolkit.Utilities.HasOwnProperty(r,"diffuseTexture")&&(r.diffuseTexture.hasAlpha=!0);break;case"BLEND":r.diffuseTexture&&(BABYLON.Toolkit.Utilities.HasOwnProperty(r,"diffuseTexture")&&(r.diffuseTexture.hasAlpha=!0),BABYLON.Toolkit.Utilities.HasOwnProperty(r,"useAlphaFromDiffuseTexture"))&&(r.useAlphaFromDiffuseTexture=!0);break;default:throw new Error("".concat(e,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}return this._parseCommonConstantProperties(a,e,t,o),Promise.all(a).then(function(){})},e.prototype._parseCommonConstantProperties=function(o,n,e,i){var l=this,r=null!=e.extras&&null!=e.extras.metadata?e.extras.metadata:null;if(null!=r){var a,s,t,u,c=i,e=(BABYLON.Toolkit.Utilities.HasOwnProperty(c,"alphaMode")&&(c.alphaMode=null!=r&&r.alphaMode?r.alphaMode:BABYLON.Engine.ALPHA_COMBINE),BABYLON.Toolkit.Utilities.HasOwnProperty(c,"ambientColor")&&(c.ambientColor=null!=r&&r.ambientColorFactor?BABYLON.Color3.FromArray(r.ambientColorFactor):BABYLON.Color3.Black()),BABYLON.Toolkit.Utilities.HasOwnProperty(c,"backFaceCulling")&&(c.backFaceCulling=null==r||null==r.backFaceCulling||r.backFaceCulling),i instanceof BABYLON.PBRMaterial&&(i.useMetallnessFromMetallicTextureBlue=!0,i.useRoughnessFromMetallicTextureGreen=!0,i.useRoughnessFromMetallicTextureAlpha=!1,i.useAmbientOcclusionFromMetallicTextureRed=!1,i.directIntensity=null!=r.directIntensity?r.directIntensity:1,i.specularIntensity=null!=r.specularIntensity?r.specularIntensity:1,i.emissiveIntensity=null!=r.emissiveIntensity?r.emissiveIntensity:1,i.environmentIntensity=null!=r.environmentIntensity?r.environmentIntensity:1,i.indexOfRefraction=null!=r.indexOfRefraction?r.indexOfRefraction:1.5,0<(e=null!=r.clearCoatIntensity?r.clearCoatIntensity:0)&&(i.clearCoat.isEnabled=!0,i.clearCoat.intensity=e),null!=r.useAlphaFromAlbedoTexture&&(i.useAlphaFromAlbedoTexture=r.useAlphaFromAlbedoTexture),null!=r.parallaxBias)&&0<r.parallaxBias&&(i.useParallax=!0,i.parallaxScaleBias=.9*r.parallaxBias,i.useParallaxOcclusion=null==r.parallaxOcclusion||r.parallaxOcclusion,!0===i.useParallaxOcclusion)&&(i.parallaxScaleBias*=.5),BABYLON.Toolkit.Utilities.HasOwnProperty(c,"unlit")&&(c.unlit=null!=r.unlitMaterial&&r.unlitMaterial),BABYLON.Toolkit.Utilities.HasOwnProperty(c,"wireframe")&&(c.wireframe=null!=r.useWireframe&&r.useWireframe),BABYLON.Toolkit.Utilities.HasOwnProperty(c,"disableLighting")&&(c.disableLighting=null!=r.disableLighting&&r.disableLighting),BABYLON.Toolkit.Utilities.HasOwnProperty(c,"maxSimultaneousLights")&&(c.maxSimultaneousLights=null!=r.maxSimultaneousLights?r.maxSimultaneousLights:4),BABYLON.Toolkit.Utilities.HasOwnProperty(c,"needDepthPrePass")&&(c.needDepthPrePass=null!=r.depthPrepass&&r.depthPrepass),BABYLON.Toolkit.Utilities.HasOwnProperty(c,"lightmapTexture")&&r.lightmapTexture&&(a=r.lightmapTexture.nonColorData=!0,BABYLON.Toolkit.Utilities.HasOwnProperty(c,"useLightmapAsShadowmap")&&(a=null==r.useLightmapAsShadowmap||r.useLightmapAsShadowmap),(e=null)!=(e=0<=(s=null!=r.lightmapTexture.index?r.lightmapTexture.index:-1)?this._getCachedLightmapByIndex(s):e)?(c.lightmapTexture=e,c.useLightmapAsShadowmap=a,BABYLON.Toolkit.Utilities.HasOwnProperty(c,"ambientColor")&&(c.ambientColor=BABYLON.Color3.White())):o.push(this._loader.loadTextureInfoAsync(n+"/lightmapTexture",r.lightmapTexture,function(e){e.name="assets/LightmapTexture-".concat(s),e.level=r.lightmapLevel||1;var t=e;!0==(null!=BABYLON.Toolkit.SceneManager.GlobalOptions.ktxlightmaps&&!0===BABYLON.Toolkit.SceneManager.GlobalOptions.ktxlightmaps)?e.gammaSpace=!0:(e.gammaSpace=!1,t.onLoadObservable.addOnce(function(){t.isReady()?t.isRGBD=!0:BABYLON.Tools.Warn("Failed to register texture as RGBD: "+t.name)})),c.lightmapTexture=e,0<=s&&null!=l._lightmapMap&&(l._lightmapMap.has(s)||l._lightmapMap.set(s,t)),c.useLightmapAsShadowmap=a,BABYLON.Toolkit.Utilities.HasOwnProperty(c,"ambientColor")&&(c.ambientColor=BABYLON.Color3.White())}))),i instanceof BABYLON.PBRMaterial&&r.detailMapTexture&&o.push(this._loader.loadTextureInfoAsync(n+"/detailMapTexture",r.detailMapTexture,function(e){e.name="".concat(i.name," (Detail Map)"),e.level=1,i.detailMap.texture=e,i.detailMap.bumpLevel=r.detailBumpLevel||1,i.detailMap.diffuseBlendLevel=r.detailBlendLevel||.75,i.detailMap.roughnessBlendLevel=r.detailRoughLevel||.5,i.detailMap.isEnabled=!0})),BABYLON.Toolkit.SceneManager.GetRenderQuality()),e=e===BABYLON.Toolkit.RenderQuality.High||e===BABYLON.Toolkit.RenderQuality.Medium;if(!0==e&&BABYLON.Toolkit.Utilities.HasOwnProperty(c,"reflectionColor")&&(c.reflectionColor=null!=r&&r.reflectionColorFactor?BABYLON.Color3.FromArray(r.reflectionColorFactor):BABYLON.Color3.White()),!0==e&&BABYLON.Toolkit.Utilities.HasOwnProperty(c,"reflectionTexture")&&r.reflectionCubemapInfo&&(u=-1<(u=(e=(this._loader._rootUrl+r.reflectionCubemapInfo.rooturl+r.reflectionCubemapInfo.name).toLowerCase()).lastIndexOf("."))?e.substring(u).toLowerCase():"",(t=new CubeTextureLoader).name="assets/"+r.reflectionCubemapInfo.name,t.mapkey=e,t.material=c,t.extension=u,t.prefiltered=!0,r.reflectionCubemapInfo.boundingBoxSize&&(t.boundingBoxSize=BABYLON.Vector3.FromArray(r.reflectionCubemapInfo.boundingBoxSize),t.name+=" ("+t.boundingBoxSize.x.toString()+" "+t.boundingBoxSize.y.toString()+" "+t.boundingBoxSize.z.toString()+")",t.mapkey+="_"+t.boundingBoxSize.x.toString()+"_"+t.boundingBoxSize.y.toString()+"_"+t.boundingBoxSize.z.toString()),r.reflectionCubemapInfo.boundingBoxPosition&&(t.boundingBoxPosition=BABYLON.Vector3.FromArray(r.reflectionCubemapInfo.boundingBoxPosition),t.name+=" ("+t.boundingBoxPosition.x.toString()+" "+t.boundingBoxPosition.y.toString()+" "+t.boundingBoxPosition.z.toString()+")",t.mapkey+="_"+t.boundingBoxPosition.x.toString()+"_"+t.boundingBoxPosition.y.toString()+"_"+t.boundingBoxPosition.z.toString()),null==(u=this._reflectionMap[e])?this._reflectionMap[e]=u=[t]:u.push(t)),BABYLON.Toolkit.Utilities.HasOwnProperty(c,"terrainInfo")&&(c.terrainInfo=null!=r.terrainInfo?r.terrainInfo:null),BABYLON.Toolkit.Utilities.HasOwnProperty(i,"universalMaterial")){var p,d,h,m=i;if(r.customTextures){var g=this;for(k in r.customTextures)!function(t){var e=r.customTextures[t];null!=e&&(m.checkSampler(t),o.push(g._loader.loadTextureInfoAsync(n+"/"+t,e,function(e){e.name="".concat(i.name,"detailsSampler"===t||"normalsSampler"===t?" (Atlas)":" (Custom)"),m.setTexture(t,e,!0)})))}(k)}if(r.customVectors)for(var T in r.customVectors)null!=(p=r.customVectors[T])&&m.setVector4(T,BABYLON.Vector4.FromArray(p),!0);if(r.customColors)for(var f in r.customColors)null!=(d=r.customColors[f])&&m.setVector4(f,BABYLON.Vector4.FromArray(d),!0);if(r.customFloats)for(var y in r.customFloats)null!=(h=r.customFloats[y])&&m.setFloat(y,h,!0)}else{if(r.customTextures){var k,_=this;for(k in r.customTextures)!function(t){var e=r.customTextures[t];null!=e&&BABYLON.Toolkit.Utilities.HasOwnProperty(c,t)&&o.push(_._loader.loadTextureInfoAsync(n+"/"+t,e,function(e){e.name="".concat(i.name,"detailsSampler"===t||"normalsSampler"===t?" (Atlas)":" (Custom)"),c[t]=e}))}(k)}if(r.customVectors)for(var T in r.customVectors)null!=(p=r.customVectors[T])&&BABYLON.Toolkit.Utilities.HasOwnProperty(c,T)&&(c[T]=BABYLON.Vector4.FromArray(p));if(r.customColors)for(var f in r.customColors)null!=(d=r.customColors[f])&&BABYLON.Toolkit.Utilities.HasOwnProperty(c,f)&&(c[f]instanceof BABYLON.Vector4?c[f]=BABYLON.Vector4.FromArray(d):c[f]instanceof BABYLON.Color4?c[f]=BABYLON.Color4.FromArray(d):c[f]=BABYLON.Color3.FromArray(d));if(r.customFloats)for(var y in r.customFloats)null!=(h=r.customFloats[y])&&BABYLON.Toolkit.Utilities.HasOwnProperty(c,y)&&(c[y]instanceof Boolean?c[y]=0<h:c[y]=h)}null!=r.freezeMaterial&&!0===r.freezeMaterial&&null!=this._shaderList&&this._shaderList.push(i)}},e.ScriptBundleCache={},e}(),CVTOOLS_babylon_mesh=function(){function e(e){this.name=CVTOOLS_MESH,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_MESH),this.order=101}return e.prototype.dispose=function(){delete this._loader},e}(),CVTOOLS_left_handed=function(){function e(e){this.name=CVTOOLS_HAND,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_HAND),this.order=102}return e.prototype.dispose=function(){delete this._loader},e}(),__extends=(BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_NAME,function(e){return new CVTOOLS_unity_metadata(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_MESH,function(e){return new CVTOOLS_babylon_mesh(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_HAND,function(e){return new CVTOOLS_left_handed(e)}),BABYLON.SceneLoader.OnPluginActivatedObservable.add(function(e){"gltf"===e.name&&e instanceof BABYLON.GLTFFileLoader&&(e.animationStartMode=BABYLON.Toolkit.SceneManager.AnimationStartMode,e.targetFps=BABYLON.Toolkit.SceneManager.AnimationTargetFps,e.onSkinLoadedObservable.add(function(e){if(null!=e){try{null!=e.skinnedNode&&(e.skinnedNode.id+=".Skin")}catch(e){console.warn(e)}try{null!=e.skinnedNode&&(e.skinnedNode.name+=".Skin")}catch(e){console.warn(e)}try{var t;null!=e.node&&null!=e.skinnedNode&&(null!=(t=BABYLON.Tags.GetTags(e.node))&&BABYLON.Tags.AddTagsTo(e.skinnedNode,t),e.node._skinnedMesh=e.skinnedNode)}catch(e){console.warn(e)}}}))}),!function(e){function X(e){return 0|Math.floor(e)}var y=.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,A=1/6,j=(Math.sqrt(5)-1)/4,K=(5-Math.sqrt(5))/20,t=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),o=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),n=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function i(e){for(var t=new Uint8Array(512),o=0;o<256;o++)t[o]=o;for(o=0;o<255;o++){var n=o+~~(e()*(256-o)),i=t[o];t[o]=t[n],t[n]=i}for(o=256;o<512;o++)t[o]=t[o-256];return t}e.createNoise2D=function(e){var g=i(e=void 0===e?Math.random:e),T=new Float64Array(g).map(function(e){return t[e%12*2]}),f=new Float64Array(g).map(function(e){return t[e%12*2+1]});return function(e,t){var o,n=0,i=0,l=0,r=(e+t)*y,a=X(e+r),r=X(t+r),s=(a+r)*k,e=e-(a-s),t=t-(r-s),s=t<e?(o=1,0):(o=0,1),u=e-o+k,c=t-s+k,p=e-1+2*k,d=t-1+2*k,a=255&a,r=255&r,h=.5-e*e-t*t,h=(0<=h&&(m=a+g[r],n=(h*=h)*h*(T[m]*e+f[m]*t)),.5-u*u-c*c),m=(0<=h&&(e=a+o+g[r+s],i=(h*=h)*h*(T[e]*u+f[e]*c)),.5-p*p-d*d);return 0<=m&&(t=1+a+g[1+r],l=(m*=m)*m*(T[t]*p+f[t]*d)),70*(n+i+l)}},e.createNoise3D=function(e){var M=i(e=void 0===e?Math.random:e),w=new Float64Array(M).map(function(e){return o[e%12*3]}),x=new Float64Array(M).map(function(e){return o[e%12*3+1]}),P=new Float64Array(M).map(function(e){return o[e%12*3+2]});return function(e,t,o){var n,i,l,r,a,s,u=(e+t+o)*(1/3),c=X(e+u),p=X(t+u),u=X(o+u),d=(c+p+u)*A,e=e-(c-d),t=t-(p-d),o=o-(u-d),d=t<=e?o<=t?(a=r=n=1,l=i=0):r=o<=e?(a=l=i=0,n=1):(a=i=n=0,l=1):t<o?(r=i=n=0,a=l=1):e<o?(r=l=n=0,a=i=1):(a=r=i=1,l=n=0),h=e-n+A,m=t-i+A,g=o-l+A,T=e-r+2*A,f=t-a+2*A,y=o-d+2*A,k=e-1+.5,_=t-1+.5,v=o-1+.5,c=255&c,p=255&p,u=255&u,b=.6-e*e-t*t-o*o,C=.6-h*h-m*m-g*g,S=.6-T*T-f*f-y*y,I=.6-k*k-_*_-v*v;return 32*((b<0?0:(s=c+M[p+M[u]],(b*=b)*b*(w[s]*e+x[s]*t+P[s]*o)))+(C<0?0:(b=c+n+M[p+i+M[u+l]],(C*=C)*C*(w[b]*h+x[b]*m+P[b]*g)))+(S<0?0:(e=c+r+M[p+a+M[u+d]],(S*=S)*S*(w[e]*T+x[e]*f+P[e]*y)))+(I<0?0:(t=1+c+M[1+p+M[1+u]],(I*=I)*I*(w[t]*k+x[t]*_+P[t]*v))))}},e.createNoise4D=function(e){var H=i(e=void 0===e?Math.random:e),W=new Float64Array(H).map(function(e){return n[e%32*4]}),z=new Float64Array(H).map(function(e){return n[e%32*4+1]}),Y=new Float64Array(H).map(function(e){return n[e%32*4+2]}),Q=new Float64Array(H).map(function(e){return n[e%32*4+3]});return function(e,t,o,n){var i,l=(e+t+o+n)*j,r=X(e+l),a=X(t+l),s=X(o+l),l=X(n+l),u=(r+a+s+l)*K,e=e-(r-u),t=t-(a-u),o=o-(s-u),n=n-(l-u),u=0,c=0,p=0,d=0,h=(t<e?u++:c++,o<e?u++:p++,n<e?u++:d++,o<t?c++:p++,n<t?c++:d++,n<o?p++:d++,3<=u?1:0),m=3<=c?1:0,N=3<=p?1:0,U=3<=d?1:0,F=2<=u?1:0,V=2<=c?1:0,E=2<=p?1:0,G=2<=d?1:0,u=1<=u?1:0,c=1<=c?1:0,p=1<=p?1:0,d=1<=d?1:0,g=e-h+K,T=t-m+K,f=o-N+K,y=n-U+K,k=e-F+2*K,_=t-V+2*K,v=o-E+2*K,b=n-G+2*K,C=e-u+3*K,S=t-c+3*K,I=o-p+3*K,M=n-d+3*K,w=e-1+4*K,x=t-1+4*K,P=o-1+4*K,A=n-1+4*K,r=255&r,a=255&a,s=255&s,l=255&l,O=.6-e*e-t*t-o*o-n*n,B=.6-g*g-T*T-f*f-y*y,R=.6-k*k-_*_-v*v-b*b,L=.6-C*C-S*S-I*I-M*M,D=.6-w*w-x*x-P*P-A*A;return 27*((O<0?0:(i=r+H[a+H[s+H[l]]],(O*=O)*O*(W[i]*e+z[i]*t+Y[i]*o+Q[i]*n)))+(B<0?0:(O=r+h+H[a+m+H[s+N+H[l+U]]],(B*=B)*B*(W[O]*g+z[O]*T+Y[O]*f+Q[O]*y)))+(R<0?0:(e=r+F+H[a+V+H[s+E+H[l+G]]],(R*=R)*R*(W[e]*k+z[e]*_+Y[e]*v+Q[e]*b)))+(L<0?0:(t=r+u+H[a+c+H[s+p+H[l+d]]],(L*=L)*L*(W[t]*C+z[t]*S+Y[t]*I+Q[t]*M)))+(D<0?0:(o=1+r+H[1+a+H[1+s+H[1+l]]],(D*=D)*D*(W[o]*w+z[o]*x+Y[o]*P+Q[o]*A))))}},e.buildPermutationTable=i}(SIMPLEX=SIMPLEX||{}),this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}()),__extends=(!function(x){var e=x.Toolkit||(x.Toolkit={});t=x.Toolkit.ScriptComponent,__extends(n,t),n.prototype.awakened=function(){return this._awakened},n.prototype.initialized=function(){return this._initialized},n.prototype.hasRootMotion=function(){return this._hasrootmotion},n.prototype.isFirstFrame=function(){return 0===this._frametime},n.prototype.isLastFrame=function(){return.985<=this._frametime},n.prototype.ikFrameEnabled=function(){return this._ikFrameEanbled},n.prototype.getAnimationTime=function(){return this._frametime},n.prototype.getFrameLoopTime=function(){return this._looptime},n.prototype.getFrameLoopBlend=function(){return this._loopblend},n.prototype.getAnimationPlaying=function(){return this._animationplaying},n.prototype.getRuntimeController=function(){return this._runtimecontroller},n.prototype.getRootBoneTransform=function(){return this._rootBoneTransform},n.prototype.getDeltaRootMotionAngle=function(){return this._angularVelocity.y},n.prototype.getDeltaRootMotionSpeed=function(){return this._rootMotionSpeed},n.prototype.getDeltaRootMotionPosition=function(){return this._deltaPosition},n.prototype.getDeltaRootMotionRotation=function(){return this._deltaRotation},n.prototype.getFixedRootMotionPosition=function(){return null!=this._dirtyMotionMatrix?this._rootMotionPosition:null},n.prototype.getFixedRootMotionRotation=function(){return null!=this._dirtyMotionMatrix?this._rootMotionRotation:null},n.prototype.awake=function(){this.awakeStateMachine()},n.prototype.update=function(){this.updateStateMachine()},n.prototype.destroy=function(){this.destroyStateMachine()},n.prototype.playDefaultAnimation=function(e,t,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===o&&(o=null);var n,i=!1;return!0===this._initialized?null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>t?(n=null!=(t=this._machine.layers[t]).animationStateMachine&&t.animationStateMachine.rate||x.Toolkit.AnimationState.FPS,o=0<e?x.Toolkit.Utilities.ComputeBlendingSpeed(o||n,e):0,this.playCurrentAnimationState(t,t.entry,o),i=!0):x.Tools.Warn("No animation state layers on "+this.transform.name):x.Tools.Warn("Animation state machine not initialized for "+this.transform.name),i},n.prototype.playAnimation=function(e,t,o,n){void 0===t&&(t=0),void 0===o&&(o=0),void 0===n&&(n=null);var i,l=!1;return!0===this._initialized?null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>o?(i=null!=(o=this._machine.layers[o]).animationStateMachine&&o.animationStateMachine.rate||x.Toolkit.AnimationState.FPS,n=0<t?x.Toolkit.Utilities.ComputeBlendingSpeed(n||i,t):0,this.playCurrentAnimationState(o,e,n),l=!0):x.Tools.Warn("No animation state layers on "+this.transform.name):x.Tools.Warn("Animation state machine not initialized for "+this.transform.name),l},n.prototype.stopAnimation=function(e){void 0===e&&(e=0);var t=!1;return!0===this._initialized?null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>e?(e=this._machine.layers[e],this.stopCurrentAnimationState(e),t=!0):x.Tools.Warn("No animation state layers on "+this.transform.name):x.Tools.Warn("Animation state machine not initialized for "+this.transform.name),t},n.prototype.killAnimations=function(){var t=this,o=!1;return!0===this._initialized?null!=this._machine&&null!=this._machine.layers?this._machine.layers.forEach(function(e){t.stopCurrentAnimationState(e),o=!0}):x.Tools.Warn("No animation state layers on "+this.transform.name):x.Tools.Warn("Animation state machine not initialized for "+this.transform.name),o},n.prototype.hasBool=function(e){return null!=this._booleans.get(e)},n.prototype.getBool=function(e){return this._booleans.get(e)||!1},n.prototype.setBool=function(e,t){this._booleans.set(e,t)},n.prototype.hasFloat=function(e){return null!=this._numbers.get(e)},n.prototype.getFloat=function(e){return this._numbers.get(e)||0},n.prototype.setFloat=function(e,t){this._numbers.set(e,t)},n.prototype.hasInteger=function(e){return null!=this._numbers.get(e)},n.prototype.getInteger=function(e){return this._numbers.get(e)||0},n.prototype.setInteger=function(e,t){this._numbers.set(e,t)},n.prototype.hasTrigger=function(e){return null!=this._triggers.get(e)},n.prototype.getTrigger=function(e){return this._triggers.get(e)||!1},n.prototype.setTrigger=function(e){this._triggers.set(e,!0)},n.prototype.resetTrigger=function(e){this._triggers.set(e,!1)},n.prototype.setSmoothFloat=function(e,t,o,n){var i=this._timers.get(e)||-1,l=this._starts.get(e)||null,r=this._stops.get(e)||null;(i=null!=r&&null!=t&&r!=t?-1:i)<0&&(i=0,r=l=null),null==l&&(l=this.getFloat(e)),null==r&&(r=t),0<=i&&null!=l&&null!=r&&(t=0,i<o?(t=x.Scalar.Lerp(l,r,i/o),i+=n):(t=r,i=-1,r=l=null),this._numbers.set(e,t)),this._timers.set(e,i),this._starts.set(e,l),this._stops.set(e,r)},n.prototype.setSmoothInteger=function(e,t,o,n){this.setSmoothFloat(e,t,o,n)},n.prototype.resetSmoothProperty=function(e){this._timers.delete(e),this._starts.delete(e),this._stops.delete(e),this._numbers.delete(e)},n.prototype.getMachineState=function(e){return this._data.get(e)},n.prototype.setMachineState=function(e,t){this._data.set(e,t)},n.prototype.getCurrentState=function(e){return null!=this._machine.layers&&this._machine.layers.length>e?this._machine.layers[e].animationStateMachine:null},n.prototype.getDefaultClips=function(){return this._clips},n.prototype.getDefaultSource=function(){return this._source},n.prototype.fixAnimationGroup=function(e){var t=null;if(null!=this._clips&&0<this._clips.length)for(var o=0;o<this._clips.length;o++){var n=this._clips[o];if(null!=n.clip){var i=("."+n.clip).toLowerCase();if(e.name.toLowerCase().endsWith(i)){null==e.metadata&&(e.metadata={}),null==e.metadata.toolkit&&(e.metadata.toolkit=n),e.metadata.toolkit.source=this._source,t=n;break}}}return t},n.prototype.getAnimationGroup=function(e){return this._anims.get(e)},n.prototype.getAnimationGroups=function(){return this.sourceAnimationGroups},n.prototype.setAnimationGroups=function(e){null==this.transform.metadata&&(this.transform.metadata={}),null==this.transform.metadata.toolkit&&(this.transform.metadata.toolkit={}),this.transform.metadata.toolkit.sourceAnimationGroups=e,this.setupSourceAnimationGroups()},n.prototype.updateAnimationGroups=function(e){var s=this;null!=e&&0<e.length&&(this._anims=new Map,this.m_animationTargets=[],this.m_defaultGroup=null,this.sourceAnimationGroups=null,e.forEach(function(e){var t=!1,o=e;if(!0===(t=null!=o&&null!=o.metadata&&null!=o.metadata.toolkit&&null!=o.metadata.toolkit.source&&""!==o.metadata.toolkit.source&&o.metadata.toolkit.source===s._source?!0:t)&&null!=o&&null!=o.metadata&&null!=o.metadata.toolkit&&null!=o.metadata.toolkit.clip&&""!==o.metadata.toolkit.clip){try{e.stop()}catch(e){}null==s.sourceAnimationGroups&&(s.sourceAnimationGroups=[]),s.sourceAnimationGroups.push(e),s._anims.set(o.metadata.toolkit.clip,e),null==s.m_defaultGroup&&(s.m_defaultGroup=e),null!=e.targetedAnimations&&0<e.targetedAnimations.length&&e.targetedAnimations.forEach(function(e){for(var t=-1,o=0;o<s.m_animationTargets.length;o++)if(s.m_animationTargets[o].target===e.target){t=o;break}if(t<0)if(s.m_animationTargets.push(e),null==e.target.metadata&&(e.target.metadata={}),e.target instanceof x.TransformNode){x.Toolkit.Utilities.ValidateTransformQuaternion(e.target);for(var n=[],i=0;i<s._layercount;i++){var l=new x.Toolkit.AnimationMixer;l.positionBuffer=null,l.rotationBuffer=null,l.scalingBuffer=null,l.originalMatrix=null,l.blendingFactor=0,l.blendingSpeed=0,l.rootPosition=null,l.rootRotation=null,n.push(l)}e.target.metadata.mixer=n}else if(e.target instanceof x.MorphTarget){for(var r=[],i=0;i<s._layercount;i++){var a=new x.Toolkit.AnimationMixer;a.influenceBuffer=null,r.push(a)}e.target.metadata.mixer=r}})}}))},n.prototype.awakeStateMachine=function(){var l=this;x.Toolkit.Utilities.ValidateTransformQuaternion(this.transform),this.m_animationTargets=[],this.m_defaultGroup=null,this.m_rotationIdentity=x.Quaternion.Identity(),this._source=null!=this.transform.metadata&&null!=this.transform.metadata.toolkit&&null!=this.transform.metadata.toolkit.animator&&""!==this.transform.metadata.toolkit.animator?this.transform.metadata.toolkit.animator:null,this._clips=this.getProperty("clips",this._clips),this._machine=this.getProperty("machine",this._machine),this._updatemode=this.getProperty("updatemode",this._updatemode),this._animationrig=this.getProperty("animationrig",this._animationrig),this._animationmode=this.getProperty("animationmode",this._animationmode),this._hasrootmotion=this.getProperty("hasrootmotion",this._hasrootmotion),this._runtimecontroller=this.getProperty("runtimecontroller",this._runtimecontroller),this._hastransformhierarchy=this.getProperty("hastransformhierarchy",this._hastransformhierarchy),this._leftfeetbottomheight=this.getProperty("leftfeetbottomheight",this._leftfeetbottomheight),this._rightfeetbottomheight=this.getProperty("rightfeetbottomheight",this._rightfeetbottomheight),this.applyRootMotion=this.getProperty("applyrootmotion",this.applyRootMotion),null!=this._machine&&(null!=this._machine.owner&&null!=this._machine.owner&&""!==this._machine.owner&&"*"!==this._machine.owner||(this._machine.owner=(null!=this.transform.parent?this.transform.parent:this.transform).name),null!=this._machine.speed&&(this.speedRatio=this._machine.speed),null!=this._machine.parameters&&0<this._machine.parameters.length&&this._machine.parameters.forEach(function(e){var t=e.name,o=e.type,n=(e.curve,e.defaultFloat),i=e.defaultBool,e=e.defaultInt;l._parameters.set(t,o),o===x.Toolkit.AnimatorParameterType.Bool?l.setBool(t,i):o===x.Toolkit.AnimatorParameterType.Float?l.setFloat(t,n):o===x.Toolkit.AnimatorParameterType.Int?l.setInteger(t,e):o===x.Toolkit.AnimatorParameterType.Trigger&&l.resetTrigger(t)}),null!=this._machine.layers)&&0<this._machine.layers.length&&(this._layercount=this._machine.layers.length,this._machine.layers.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this._machine.layers.forEach(function(e){if(null!=e.owner&&null!=e.owner&&""!==e.owner&&e.owner,e.animationMaskMap=new Map,null!=e.avatarMask&&null!=e.avatarMask.transformPaths&&0<e.avatarMask.transformPaths.length)for(var t=0;t<e.avatarMask.transformPaths.length;t++)e.animationMaskMap.set(e.avatarMask.transformPaths[t],t)})),this._awakened=!0,this.onAnimationAwakeObservable&&this.onAnimationAwakeObservable.hasObservers()&&this.onAnimationAwakeObservable.notifyObservers(this.transform)},n.prototype.updateStateMachine=function(e){var t=this;void 0===e&&(e=null),(!1===this.delayUpdateUntilReady||!0===this.delayUpdateUntilReady&&this.isReady())&&(null==this.sourceAnimationGroups&&this.setupSourceAnimationGroups(),null!=this.sourceAnimationGroups)&&(!1===this._executed&&(this._executed=!0,null!=this._machine.layers&&0<this._machine.layers.length&&this._machine.layers.forEach(function(e){t.playCurrentAnimationState(e,e.entry,0)}),this._initialized=!0,this.onAnimationInitObservable)&&this.onAnimationInitObservable.hasObservers()&&this.onAnimationInitObservable.notifyObservers(this.transform),!0===this.enableAnimation)&&(e=e||this.getDeltaSeconds(),this.updateAnimationState(e),this.updateAnimationTargets(e),this.onAnimationUpdateObservable)&&this.onAnimationUpdateObservable.hasObservers()&&this.onAnimationUpdateObservable.notifyObservers(this.transform)},n.prototype.setupSourceAnimationGroups=function(){var e=this,t=null!=this.transform.metadata&&null!=this.transform.metadata.toolkit&&null!=this.transform.metadata.toolkit.sourceAnimationGroups?this.transform.metadata.toolkit.sourceAnimationGroups:null;null!=t&&(this.updateAnimationGroups(t),null!=this.sourceAnimationGroups)&&null!=this._machine&&null!=this._machine.states&&0<this._machine.states.length&&this._machine.states.forEach(function(t){null!=t&&null!=t.name&&(null!=t.ccurves&&0<t.ccurves.length&&t.ccurves.forEach(function(e){null!=e.animation&&null!=(e=x.Animation.Parse(e.animation))&&(null==t.tcurves&&(t.tcurves=[]),t.tcurves.push(e))}),e.setupTreeBranches(t.blendtree),e.setMachineState(t.name,t))})},n.prototype.destroyStateMachine=function(){this._data=null,this._clips=null,this._anims=null,this._numbers=null,this._booleans=null,this._triggers=null,this._parameters=null,this._checkers=null,this._machine=null,this.sourceAnimationGroups=null,this.onAnimationAwakeObservable.clear(),this.onAnimationAwakeObservable=null,this.onAnimationInitObservable.clear(),this.onAnimationInitObservable=null,this.onAnimationIKObservable.clear(),this.onAnimationIKObservable=null,this.onAnimationEndObservable.clear(),this.onAnimationEndObservable=null,this.onAnimationLoopObservable.clear(),this.onAnimationLoopObservable=null,this.onAnimationEventObservable.clear(),this.onAnimationEventObservable=null,this.onAnimationUpdateObservable.clear(),this.onAnimationUpdateObservable=null,this.onAnimationTransitionObservable.clear(),this.onAnimationTransitionObservable=null},n.prototype.updateAnimationState=function(t){var o=this;null!=this._machine.layers&&0<this._machine.layers.length&&this._machine.layers.forEach(function(e){o.checkStateMachine(e,t)})},n.prototype.updateAnimationTargets=function(M){var w=this;this._looptime=!1,this._loopblend=!1,this._ikFrameEanbled=!1,this._animationplaying=!1,null!=this._machine.layers&&0<this._machine.layers.length&&this._machine.layers.forEach(function(i){if(0===i.index&&(w._frametime=i.animationTime),null!=i.animationStateMachine&&null!=i.animationStateMachine.blendtree){!0===i.animationStateMachine.iKOnFeet&&(w._ikFrameEanbled=!0),!0===i.iKPass&&w.onAnimationIKObservable&&w.onAnimationIKObservable.hasObservers()&&w.onAnimationIKObservable.notifyObservers(i.index);var e=i.animationStateMachine;if(e.type===x.Toolkit.MotionType.Clip&&-1!==e.played&&(e.played+=M),null!=e.blendtree.children&&0<e.blendtree.children.length){var t=e.blendtree.children[0];if(null!=t)if(e.blendtree.blendType==x.Toolkit.BlendTreeType.Clip){var o,l,r,n,a,s,u,c,p,d,t=t.track;null!=t&&(s=t.metadata.toolkit.length,g=x.Toolkit.AnimationState.TIME/s,i.animationTime+=M*g*Math.abs(e.speed)*Math.abs(w.speedRatio)*x.Toolkit.AnimationState.SPEED,i.animationTime>x.Toolkit.AnimationState.TIME&&(i.animationTime=x.Toolkit.AnimationState.TIME),i.animationNormal=0<i.animationTime?x.Scalar.Clamp(i.animationTime/x.Toolkit.AnimationState.TIME,0,1):0,T=.99<=i.animationNormal?1:i.animationNormal,o=parseFloat(T.toFixed(3)),e.speed<0&&(i.animationNormal=1-i.animationNormal),l=s*i.animationNormal,h=s=!1,d=p=c=!(u=a=n=r=0),null!=t.metadata&&null!=t.metadata.toolkit&&(null!=t.metadata.toolkit.averagespeed&&(n=null!=t.metadata.toolkit.averagespeed.x?t.metadata.toolkit.averagespeed.x:0,a=null!=t.metadata.toolkit.averagespeed.z?t.metadata.toolkit.averagespeed.z:0),null!=t.metadata.toolkit.settings)&&(r=null!=t.metadata.toolkit.settings.level?t.metadata.toolkit.settings.level:0,s=null!=t.metadata.toolkit.settings.looptime&&t.metadata.toolkit.settings.looptime,h=null!=t.metadata.toolkit.settings.loopblend&&t.metadata.toolkit.settings.loopblend,u=null!=t.metadata.toolkit.settings.orientationoffsety?t.metadata.toolkit.settings.orientationoffsety:0,c=null==t.metadata.toolkit.settings.loopblendorientation||t.metadata.toolkit.settings.loopblendorientation,p=null==t.metadata.toolkit.settings.loopblendpositiony||t.metadata.toolkit.settings.loopblendpositiony,d=null==t.metadata.toolkit.settings.loopblendpositionxz||t.metadata.toolkit.settings.loopblendpositionxz),0===i.index&&(w._looptime=s,w._loopblend=h),u=x.Tools.ToRadians(u),n=Math.abs(n),a=Math.abs(a),r*=-1,i.animationTime>=x.Toolkit.AnimationState.TIME&&(i.animationFirstRun=!1,(i.animationLoopFrame=!0)===s?(i.animationLoopCount++,w.onAnimationLoopObservable&&w.onAnimationLoopObservable.hasObservers()&&w.onAnimationLoopObservable.notifyObservers(i.index)):!1===i.animationEndFrame&&(i.animationEndFrame=!0,w.onAnimationEndObservable)&&w.onAnimationEndObservable.hasObservers()&&w.onAnimationEndObservable.notifyObservers(i.index)),!0!==i.animationFirstRun&&!0!==s||(w._animationplaying=!0,t.targetedAnimations.forEach(function(e){var t,o,n;e.target instanceof x.TransformNode?(n=e.target,0!==i.index&&null!=i.avatarMask&&!w.filterTargetAvatarMask(i,n)||(!0===(t=null!=n.metadata&&null!=n.metadata.toolkit&&null!=n.metadata.toolkit.rootbone&&n.metadata.toolkit.rootbone)&&null==w._rootBoneTransform&&(w._rootBoneTransform=n),null==n.metadata)||null==n.metadata.mixer||null==(n=n.metadata.mixer[i.index])||("position"===e.animation.targetProperty?(w._targetPosition=x.Toolkit.Utilities.SampleAnimationVector3(e.animation,l,x.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===t&&null!=w._rootBoneTransform?(w._positionWeight=!0,w._positionHolder.set(0,0,0),w._rootBoneWeight=!1,w._rootBoneHolder.set(0,0,0),!0!==w.applyRootMotion||!0===p&&!0===d?(w._positionWeight=!0,w._positionHolder.set(w._targetPosition.x,w._targetPosition.y+r,w._targetPosition.z)):!1===p&&!1===d?(w._rootBoneWeight=!0,w._rootBoneHolder.set(w._targetPosition.x,w._targetPosition.y+r,w._targetPosition.z)):!0===p&&!1===d?(w._positionWeight=!0,w._positionHolder.set(w.m_zeroVector.x,w._targetPosition.y+r,w.m_zeroVector.z),w._rootBoneWeight=!0,w._rootBoneHolder.set(w._targetPosition.x,w.m_zeroVector.y,w._targetPosition.z)):!0===d&&!1===p&&(w._positionWeight=!0,w._positionHolder.set(w._targetPosition.x,w.m_zeroVector.y,w._targetPosition.z),w._rootBoneWeight=!0,w._rootBoneHolder.set(w.m_zeroVector.x,w._targetPosition.y+r,w.m_zeroVector.z)),!0===w._positionWeight&&(null==n.positionBuffer&&(n.positionBuffer=new x.Vector3(0,0,0)),x.Toolkit.Utilities.BlendVector3Value(n.positionBuffer,w._positionHolder,1)),!0===w._rootBoneWeight&&(null==n.rootPosition&&(n.rootPosition=new x.Vector3(0,0,0)),x.Toolkit.Utilities.BlendVector3Value(n.rootPosition,w._rootBoneHolder,1))):(null==n.positionBuffer&&(n.positionBuffer=new x.Vector3(0,0,0)),x.Toolkit.Utilities.BlendVector3Value(n.positionBuffer,w._targetPosition,1))):"rotationQuaternion"===e.animation.targetProperty?(w._targetRotation=x.Toolkit.Utilities.SampleAnimationQuaternion(e.animation,l,x.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===t&&null!=w._rootBoneTransform?(w._rotationWeight=!1,w._rotationHolder.copyFrom(w.m_rotationIdentity),w._rootQuatWeight=!1,w._rootQuatHolder.copyFrom(w.m_rotationIdentity),o=(t=w._targetRotation.toEulerAngles()).y,!0!==w.applyRootMotion||!0===c?(w._rotationWeight=!0,x.Quaternion.FromEulerAnglesToRef(t.x,o+u,t.z,w._rotationHolder)):(w._rotationWeight=!0,x.Quaternion.FromEulerAnglesToRef(t.x,w.m_zeroVector.y,t.z,w._rotationHolder),w._rootQuatWeight=!0,x.Quaternion.FromEulerAnglesToRef(w.m_zeroVector.x,o+u,w.m_zeroVector.z,w._rootQuatHolder)),!0===w._rotationWeight&&(null==n.rotationBuffer&&(n.rotationBuffer=new x.Quaternion(0,0,0,0)),x.Toolkit.Utilities.BlendQuaternionValue(n.rotationBuffer,w._rotationHolder,1)),!0===w._rootQuatWeight&&(null==n.rootRotation&&(n.rootRotation=new x.Quaternion(0,0,0,0)),x.Toolkit.Utilities.BlendQuaternionValue(n.rootRotation,w._rootQuatHolder,1))):(null==n.rotationBuffer&&(n.rotationBuffer=new x.Quaternion(0,0,0,0)),x.Toolkit.Utilities.BlendQuaternionValue(n.rotationBuffer,w._targetRotation,1))):"scaling"===e.animation.targetProperty&&(w._targetScaling=x.Toolkit.Utilities.SampleAnimationVector3(e.animation,l,x.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==n.scalingBuffer&&(n.scalingBuffer=new x.Vector3(1,1,1)),x.Toolkit.Utilities.BlendVector3Value(n.scalingBuffer,w._targetScaling,1)))):e.target instanceof x.MorphTarget&&null!=(t=e.target).metadata&&null!=t.metadata.mixer&&(o=t.metadata.mixer[i.index],"influence"===e.animation.targetProperty)&&(n=x.Toolkit.Utilities.SampleAnimationFloat(e.animation,l,x.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==o.influenceBuffer&&(o.influenceBuffer=0),o.influenceBuffer=x.Toolkit.Utilities.BlendFloatValue(o.influenceBuffer,n,1))})),1==w._animationplaying&&(null!=i.animationStateMachine.tcurves&&0<i.animationStateMachine.tcurves.length&&i.animationStateMachine.tcurves.forEach(function(e){var t;null!=e.targetProperty&&""!==e.targetProperty&&(t=x.Toolkit.Utilities.SampleAnimationFloat(e,i.animationNormal,x.Animation.ANIMATIONLOOPMODE_CYCLE,!0),w.setFloat(e.targetProperty,t))}),null!=i.animationStateMachine.events)&&0<i.animationStateMachine.events.length&&i.animationStateMachine.events.forEach(function(e){var t;o>=e.time-.01&&o<=e.time+.01&&(t=e.function+"_"+e.time,null==i.animationLoopEvents&&(i.animationLoopEvents={}),i.animationLoopEvents[t]||(i.animationLoopEvents[t]=!0,w.onAnimationEventObservable&&w.onAnimationEventObservable.hasObservers()&&w.onAnimationEventObservable.notifyObservers(e)))}),!0===i.animationLoopFrame)&&(i.animationTime=0,i.animationNormal=0,i.animationLoopFrame=!1,i.animationLoopEvents=null)}else{w._animationplaying=!0,w._blendWeights.primary=null,w._blendWeights.secondary=null;var h=[],m=e.blendtree,g=(w.parseTreeBranches(i,m,1,h),w.computeWeightedFrameRatio(h)),T=(i.animationTime+=M*g*Math.abs(e.speed)*Math.abs(w.speedRatio)*x.Toolkit.AnimationState.SPEED,i.animationTime>x.Toolkit.AnimationState.TIME&&(i.animationTime=x.Toolkit.AnimationState.TIME),i.animationNormal=0<i.animationTime?x.Scalar.Clamp(i.animationTime/x.Toolkit.AnimationState.TIME,0,1):0,.99<=i.animationNormal?1:i.animationNormal),f=parseFloat(T.toFixed(3)),y=(e.speed<0&&(i.animationNormal=1-i.animationNormal),i.animationNormal),k=(i.animationTime>=x.Toolkit.AnimationState.TIME&&(i.animationFirstRun=!1,i.animationLoopFrame=!0,i.animationLoopCount++),null!=h&&0<h.length&&null!=h[0].track?h[0].track:null);if(null!=k)for(var _=k.targetedAnimations.length,v=0;v<_;v++){var b,C,S,I=k.targetedAnimations[v];I.target instanceof x.TransformNode&&(b=I.target,0!==i.index&&null!=i.avatarMask&&!w.filterTargetAvatarMask(i,b)||(!0===(C=null!=b.metadata&&null!=b.metadata.toolkit&&null!=b.metadata.toolkit.rootbone&&b.metadata.toolkit.rootbone)&&null==w._rootBoneTransform&&(w._rootBoneTransform=b),null==b.metadata)||null==b.metadata.mixer||(w._initialtargetblending=!0,S=b.metadata.mixer[i.index],w.updateBlendableTargets(M,i,m,I,v,S,y,C,b)))}null!=i.animationStateMachine.tcurves&&0<i.animationStateMachine.tcurves.length&&i.animationStateMachine.tcurves.forEach(function(e){var t;null!=e.targetProperty&&""!==e.targetProperty&&(t=x.Toolkit.Utilities.SampleAnimationFloat(e,i.animationNormal,x.Animation.ANIMATIONLOOPMODE_CYCLE,!0),w.setFloat(e.targetProperty,t))}),null!=i.animationStateMachine.events&&0<i.animationStateMachine.events.length&&i.animationStateMachine.events.forEach(function(e){var t;f>=e.time-.01&&f<=e.time+.01&&(t=e.function+"_"+e.time,null==i.animationLoopEvents&&(i.animationLoopEvents={}),i.animationLoopEvents[t]||(i.animationLoopEvents[t]=!0,w.onAnimationEventObservable&&w.onAnimationEventObservable.hasObservers()&&w.onAnimationEventObservable.notifyObservers(e)))}),!0===i.animationLoopFrame&&(i.animationTime=0,i.animationNormal=0,i.animationLoopFrame=!1,i.animationLoopEvents=null)}}}}),this.finalizeAnimationTargets(M)},n.prototype.updateBlendableTargets=function(e,t,o,n,i,l,r,a,s){if(null!=l&&null!=o.children&&0<o.children.length)for(var u=0;u<o.children.length;u++){var c,p,d,h,m,g,T,f,y,k=o.children[u];0<k.weight&&(k.type===x.Toolkit.MotionType.Clip?null!=k.track&&(g=!1,y=h=d=!(p=T=f=c=0),null!=(m=k.track).metadata&&null!=m.metadata.toolkit&&(null!=m.metadata.toolkit.averagespeed&&(f=null!=m.metadata.toolkit.averagespeed.x?m.metadata.toolkit.averagespeed.x:0,T=null!=m.metadata.toolkit.averagespeed.z?m.metadata.toolkit.averagespeed.z:0),null!=m.metadata.toolkit.settings)&&(c=null!=m.metadata.toolkit.settings.level?m.metadata.toolkit.settings.level:0,g=null!=m.metadata.toolkit.settings.loopblend&&m.metadata.toolkit.settings.loopblend,p=null!=m.metadata.toolkit.settings.orientationoffsety?m.metadata.toolkit.settings.orientationoffsety:0,d=null==m.metadata.toolkit.settings.loopblendorientation||m.metadata.toolkit.settings.loopblendorientation,h=null==m.metadata.toolkit.settings.loopblendpositiony||m.metadata.toolkit.settings.loopblendpositiony,y=null==m.metadata.toolkit.settings.loopblendpositionxz||m.metadata.toolkit.settings.loopblendpositionxz),0===t.index&&(this._looptime=!0,this._loopblend=g),p=x.Tools.ToRadians(p),f=Math.abs(f),T=Math.abs(T),c*=-1,m=k.track.targetedAnimations[i],g=!0===this._initialtargetblending?1:parseFloat(k.weight.toFixed(2)),this._initialtargetblending=!1,m.target===n.target&&m.animation.targetProperty===n.animation.targetProperty?(f=r,k.timescale<0&&(f=1-r),T=k.track.metadata.toolkit.length*f,"position"===n.animation.targetProperty?(this._targetPosition=x.Toolkit.Utilities.SampleAnimationVector3(m.animation,T,x.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===a&&null!=this._rootBoneTransform?(this._positionWeight=!0,this._positionHolder.set(0,0,0),this._rootBoneWeight=!1,this._rootBoneHolder.set(0,0,0),!0!==this.applyRootMotion||!0===h&&!0===y?(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+c,this._targetPosition.z)):!1===h&&!1===y?(this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this._targetPosition.y+c,this._targetPosition.z)):!0===h&&!1===y?(this._positionWeight=!0,this._positionHolder.set(this.m_zeroVector.x,this._targetPosition.y+c,this.m_zeroVector.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this.m_zeroVector.y,this._targetPosition.z)):!0===y&&!1===h&&(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this.m_zeroVector.y,this._targetPosition.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(this.m_zeroVector.x,this._targetPosition.y+c,this.m_zeroVector.z)),!0===this._positionWeight&&(null==l.positionBuffer&&(l.positionBuffer=new x.Vector3(0,0,0)),x.Toolkit.Utilities.BlendVector3Value(l.positionBuffer,this._positionHolder,g)),!0===this._rootBoneWeight&&(null==l.rootPosition&&(l.rootPosition=new x.Vector3(0,0,0)),x.Toolkit.Utilities.BlendVector3Value(l.rootPosition,this._rootBoneHolder,g))):(null==l.positionBuffer&&(l.positionBuffer=new x.Vector3(0,0,0)),x.Toolkit.Utilities.BlendVector3Value(l.positionBuffer,this._targetPosition,g))):"rotationQuaternion"===n.animation.targetProperty?(this._targetRotation=x.Toolkit.Utilities.SampleAnimationQuaternion(m.animation,T,x.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===a&&null!=this._rootBoneTransform?(this._rotationWeight=!1,this._rotationHolder.copyFrom(this.m_rotationIdentity),this._rootQuatWeight=!1,this._rootQuatHolder.copyFrom(this.m_rotationIdentity),y=(f=this._targetRotation.toEulerAngles()).y,!0!==this.applyRootMotion||!0===d?(this._rotationWeight=!0,x.Quaternion.FromEulerAnglesToRef(f.x,y+p,f.z,this._rotationHolder)):(this._rotationWeight=!0,x.Quaternion.FromEulerAnglesToRef(f.x,this.m_zeroVector.y,f.z,this._rotationHolder),this._rootQuatWeight=!0,x.Quaternion.FromEulerAnglesToRef(this.m_zeroVector.x,y+p,this.m_zeroVector.z,this._rootQuatHolder)),!0===this._rotationWeight&&(null==l.rotationBuffer&&(l.rotationBuffer=new x.Quaternion(0,0,0,0)),x.Toolkit.Utilities.BlendQuaternionValue(l.rotationBuffer,this._rotationHolder,g)),!0===this._rootQuatWeight&&(null==l.rootRotation&&(l.rootRotation=new x.Quaternion(0,0,0,0)),x.Toolkit.Utilities.BlendQuaternionValue(l.rootRotation,this._rootQuatHolder,g))):(null==l.rotationBuffer&&(l.rotationBuffer=new x.Quaternion(0,0,0,0)),x.Toolkit.Utilities.BlendQuaternionValue(l.rotationBuffer,this._targetRotation,g))):"scaling"===n.animation.targetProperty&&(this._targetScaling=x.Toolkit.Utilities.SampleAnimationVector3(m.animation,T,x.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==l.scalingBuffer&&(l.scalingBuffer=new x.Vector3(1,1,1)),x.Toolkit.Utilities.BlendVector3Value(l.scalingBuffer,this._targetScaling,g))):x.Tools.Warn(o.name+" - "+k.track.name+" blend tree mismatch ("+i+"): "+n.target.name+" >>> "+m.target.name)):k.type===x.Toolkit.MotionType.Tree&&this.updateBlendableTargets(e,t,k.subtree,n,i,l,r,a,s))}},n.prototype.finalizeAnimationTargets=function(e){var t,n=this;this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),null!=this.m_animationTargets&&0<this.m_animationTargets.length&&this.m_animationTargets.forEach(function(e){var o=e.target;null!=o.metadata&&null!=o.metadata.mixer&&null!=n._machine.layers&&0<n._machine.layers.length&&(n._blenderMatrix.reset(),n._dirtyBlenderMatrix=null,n._machine.layers.forEach(function(e){var t=o.metadata.mixer[e.index];null!=t&&(o instanceof x.TransformNode?(null==t.positionBuffer&&null==t.rotationBuffer&&null==t.scalingBuffer||(x.Matrix.ComposeToRef(t.scalingBuffer||o.scaling,t.rotationBuffer||o.rotationQuaternion,t.positionBuffer||o.position,n._updateMatrix),0<t.blendingSpeed&&(t.blendingFactor<=1&&null==t.originalMatrix&&(t.originalMatrix=x.Matrix.Compose(o.scaling,o.rotationQuaternion,o.position)),t.blendingFactor<=1)&&null!=t.originalMatrix&&(x.Toolkit.Utilities.FastMatrixSlerp(t.originalMatrix,n._updateMatrix,t.blendingFactor,n._updateMatrix),t.blendingFactor+=t.blendingSpeed),x.Toolkit.Utilities.FastMatrixSlerp(n._blenderMatrix,n._updateMatrix,e.defaultWeight,n._blenderMatrix),n._dirtyBlenderMatrix=!0,t.positionBuffer=null,t.rotationBuffer=null,t.scalingBuffer=null),null==t.rootPosition&&null==t.rootRotation||(x.Matrix.ComposeToRef(n._emptyScaling,t.rootRotation||n._emptyRotation,t.rootPosition||n._emptyPosition,n._updateMatrix),x.Toolkit.Utilities.FastMatrixSlerp(n._rootMotionMatrix,n._updateMatrix,e.defaultWeight,n._rootMotionMatrix),n._dirtyMotionMatrix=!0,t.rootPosition=null,t.rootRotation=null)):o instanceof x.MorphTarget&&null!=t.influenceBuffer&&(o.influence=x.Scalar.Lerp(o.influence,t.influenceBuffer,e.defaultWeight),t.influenceBuffer=null))}),null!=n._dirtyBlenderMatrix)&&n._blenderMatrix.decompose(o.scaling,o.rotationQuaternion,o.position)}),!0===this.applyRootMotion&&null!=this._dirtyMotionMatrix&&(this._rootMotionMatrix.decompose(this._rootMotionScaling,this._rootMotionRotation,this._rootMotionPosition),!0===this.isFirstFrame()?(this._deltaPosition.copyFrom(this._rootMotionPosition),this._deltaRotation.copyFrom(this._rootMotionRotation)):!0===this.isLastFrame()?(this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),x.Toolkit.Utilities.QuaternionDiffToRef(this._rootMotionRotation,this._lastMotionRotation,this._deltaRotation),!0===this._looptime&&!0===this._loopblend&&(0!==(t=this._loopMotionSpeed+this._lastMotionSpeed)&&(t/=2),this._deltaPosition.normalize(),this._deltaPosition.scaleInPlace(t*e),0!==(t=this._loopRotateSpeed+this._lastRotateSpeed)&&(t/=2),this._deltaRotation.toEulerAnglesToRef(this._angularVelocity),x.Quaternion.FromEulerAnglesToRef(this._angularVelocity.x,t,this._angularVelocity.z,this._deltaRotation))):(this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),x.Toolkit.Utilities.QuaternionDiffToRef(this._rootMotionRotation,this._lastMotionRotation,this._deltaRotation)),t=this._deltaPosition.length(),this._rootMotionSpeed=0<t?t/e:t,this._deltaRotation.toEulerAnglesToRef(this._angularVelocity),this._lastMotionPosition.copyFrom(this._rootMotionPosition),this._lastMotionRotation.copyFrom(this._rootMotionRotation),this._lastMotionSpeed=this._rootMotionSpeed,this._lastRotateSpeed=this._angularVelocity.y,0===this._frametime)&&(this._loopMotionSpeed=this._rootMotionSpeed,this._loopRotateSpeed=this._angularVelocity.y)},n.prototype.checkStateMachine=function(e,t){var o=this;this._checkers.result=null,this._checkers.offest=0,this._checkers.blending=0,this._checkers.triggered=[],null!=e.animationStateMachine&&(e.animationStateMachine.time+=t,this.checkStateTransitions(e,e.animationStateMachine.transitions),null==this._checkers.result)&&null!=this._machine.transitions&&this.checkStateTransitions(e,this._machine.transitions),null!=this._checkers.triggered&&0<this._checkers.triggered.length&&(this._checkers.triggered.forEach(function(e){o.resetTrigger(e)}),this._checkers.triggered=null),null!=this._checkers.result&&(this.onAnimationTransitionObservable&&this.onAnimationTransitionObservable.hasObservers()&&this.onAnimationTransitionObservable.notifyObservers(this.transform),this.playCurrentAnimationState(e,this._checkers.result,this._checkers.blending,this._checkers.offest))},n.prototype.checkStateTransitions=function(i,r){var a=this,s=i.animationStateMachine.rate,u=i.animationStateMachine.length;if(null!=r&&0<r.length){for(var c=0,p=-1,c=0;c<r.length;c++)if(!0===r[c].solo&&!1===r[c].mute){p=c;break}var d=this;for(c=0;c<r.length;c++)if("break"===function(){var l,e,t,o,n=r[c];return n.layerIndex!==i.index||!0===n.mute||0<=p&&p!==c||(e=!(t=0),0<n.exitTime&&(t=u*n.exitTime/d.speedRatio,e=!0!==n.hasExitTime||i.animationStateMachine.time>=t),!!1===n.hasExitTime&&n.intSource==x.Toolkit.InterruptionSource.None&&!1===e)?"continue":!0===(null!=n.conditions&&0<n.conditions.length?(l=0,t=n.conditions.length,n.conditions.forEach(function(e){var t=a._parameters.get(e.parameter);if(null!=t)if(t==x.Toolkit.AnimatorParameterType.Float||t==x.Toolkit.AnimatorParameterType.Int){var o=parseFloat(a.getFloat(e.parameter).toFixed(2));(e.mode===x.Toolkit.ConditionMode.Greater&&o>e.threshold||e.mode===x.Toolkit.ConditionMode.Less&&o<e.threshold||e.mode===x.Toolkit.ConditionMode.Equals&&o===e.threshold||e.mode===x.Toolkit.ConditionMode.NotEqual&&o!==e.threshold)&&l++}else if(t==x.Toolkit.AnimatorParameterType.Bool){o=a.getBool(e.parameter);(e.mode===x.Toolkit.ConditionMode.If&&!0===o||e.mode===x.Toolkit.ConditionMode.IfNot&&!1===o)&&l++}else if(t==x.Toolkit.AnimatorParameterType.Trigger)if(!0===a.getTrigger(e.parameter)){l++;for(var n=-1,i=0;i<a._checkers.triggered.length;i++)if(a._checkers.triggered[i]===e.parameter){n=i;break}n<0&&a._checkers.triggered.push(e.parameter)}}),(!0!==n.hasExitTime||!0===e)&&l===t):!0===n.hasExitTime&&!0===e)?(!0===n.hasExitTime&&!0===e&&d.onAnimationEndObservable&&d.onAnimationEndObservable.hasObservers()&&d.onAnimationEndObservable.notifyObservers(i.index),t=0<s?s:x.Toolkit.AnimationState.FPS,e=!1===n.isExit?n.destination:x.Toolkit.AnimationState.EXIT,o=!0===n.fixedDuration?n.duration:x.Scalar.Denormalize(n.duration,0,u),t=x.Toolkit.Utilities.ComputeBlendingSpeed(t,o),o=n.offset,d._checkers.result=e,d._checkers.offest=o,d._checkers.blending=t,"break"):void 0}())break}},n.prototype.playCurrentAnimationState=function(t,e,o,n){void 0===n&&(n=0),null==t||null==e||""===e||e===x.Toolkit.AnimationState.EXIT||null!=t.animationStateMachine&&t.animationStateMachine.name===e||(null!=this.m_animationTargets&&0<this.m_animationTargets.length&&this.m_animationTargets.forEach(function(e){var e=e.target;null!=e.metadata&&null!=e.metadata.mixer&&null!=(e=e.metadata.mixer[t.index])&&(e.originalMatrix=null,e.blendingFactor=0,e.blendingSpeed=o)}),null!=(e=this.getMachineState(e))&&e.layerIndex===t.index&&(e.time=0,e.played=0,e.interrupted=!1,t.animationTime=x.Scalar.Clamp(n),t.animationNormal=0,t.animationFirstRun=!0,t.animationEndFrame=!1,t.animationLoopFrame=!1,t.animationLoopCount=0,t.animationLoopEvents=null,t.animationStateMachine=e,this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),this._lastMotionPosition.set(0,0,0),this._lastMotionRotation.set(0,0,0,0)))},n.prototype.stopCurrentAnimationState=function(t){null!=t&&(null!=this.m_animationTargets&&0<this.m_animationTargets.length&&this.m_animationTargets.forEach(function(e){var e=e.target;null!=e.metadata&&null!=e.metadata.mixer&&null!=(e=e.metadata.mixer[t.index])&&(e.originalMatrix=null,e.blendingFactor=0,e.blendingSpeed=0)}),t.animationTime=0,t.animationNormal=0,t.animationFirstRun=!0,t.animationEndFrame=!1,t.animationLoopFrame=!1,t.animationLoopCount=0,t.animationLoopEvents=null,t.animationStateMachine=null,this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),this._lastMotionPosition.set(0,0,0),this._lastMotionRotation.set(0,0,0,0))},n.prototype.checkAvatarTransformPath=function(e,t){var o=!1;return o=null!=e.animationMaskMap&&null!=(e=e.animationMaskMap.get(t))&&0<=e?!0:o},n.prototype.filterTargetAvatarMask=function(e,t){var o=!1;return null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.bone&&""!==t.metadata.toolkit.bone&&(t=t.metadata.toolkit.bone,o=this.checkAvatarTransformPath(e,t)),o},n.prototype.sortWeightedBlendingList=function(e){null!=e&&0<e.length&&e.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0})},n.prototype.computeWeightedFrameRatio=function(e){var t=1;return null!=e&&0<e.length&&(this.sortWeightedBlendingList(e),this._blendWeights.primary=e[0],this._blendWeights.primary.weight<1&&1<e.length&&(this._blendWeights.secondary=e[1]),null!=this._blendWeights.primary&&null!=this._blendWeights.secondary?(e=x.Scalar.Clamp(this._blendWeights.primary.weight),t=x.Scalar.Lerp(this._blendWeights.secondary.ratio,this._blendWeights.primary.ratio,e)):null!=this._blendWeights.primary&&null==this._blendWeights.secondary&&(t=this._blendWeights.primary.ratio)),t},n.prototype.setupTreeBranches=function(e){var o=this;null!=e&&null!=e.children&&0<e.children.length&&e.children.forEach(function(e){var t;e.type===x.Toolkit.MotionType.Tree?o.setupTreeBranches(e.subtree):e.type===x.Toolkit.MotionType.Clip&&null!=e.motion&&""!==e.motion&&(e.weight=0,e.ratio=0,e.track=o.getAnimationGroup(e.motion),null!=e.track)&&(t=e.track.metadata.toolkit.length,e.ratio=x.Toolkit.AnimationState.TIME/t)})},n.prototype.parseTreeBranches=function(e,t,o,n){if(null!=t)switch(t.valueParameterX=null!=t.blendParameterX?parseFloat(this.getFloat(t.blendParameterX).toFixed(2)):0,t.valueParameterY=null!=t.blendParameterY?parseFloat(this.getFloat(t.blendParameterY).toFixed(2)):0,t.blendType){case x.Toolkit.BlendTreeType.Simple1D:this.parse1DSimpleTreeBranches(e,t,o,n);break;case x.Toolkit.BlendTreeType.SimpleDirectional2D:this.parse2DSimpleDirectionalTreeBranches(e,t,o,n);break;case x.Toolkit.BlendTreeType.FreeformDirectional2D:this.parse2DFreeformDirectionalTreeBranches(e,t,o,n);break;case x.Toolkit.BlendTreeType.FreeformCartesian2D:this.parse2DFreeformCartesianTreeBranches(e,t,o,n)}},n.prototype.parse1DSimpleTreeBranches=function(t,e,o,n){var i,l=this;null!=e&&null!=e.children&&0<e.children.length&&(i=[],e.children.forEach(function(e){e.weight=0;e={source:e,motion:e.motion,posX:e.threshold,posY:e.threshold,weight:e.weight};i.push(e)}),x.Toolkit.BlendTreeSystem.Calculate1DSimpleBlendTree(e.valueParameterX,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),e.children.forEach(function(e){e.weight*=o,e.type===x.Toolkit.MotionType.Clip&&0<e.weight&&n.push(e),e.type===x.Toolkit.MotionType.Tree&&l.parseTreeBranches(t,e.subtree,e.weight,n)}))},n.prototype.parse2DSimpleDirectionalTreeBranches=function(t,e,o,n){var i,l=this;null!=e&&null!=e.children&&0<e.children.length&&(i=[],e.children.forEach(function(e){e.weight=0;e={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};i.push(e)}),x.Toolkit.BlendTreeSystem.Calculate2DFreeformDirectional(e.valueParameterX,e.valueParameterY,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),e.children.forEach(function(e){e.weight*=o,e.type===x.Toolkit.MotionType.Clip&&0<e.weight&&n.push(e),e.type===x.Toolkit.MotionType.Tree&&l.parseTreeBranches(t,e.subtree,e.weight,n)}))},n.prototype.parse2DFreeformDirectionalTreeBranches=function(t,e,o,n){var i,l=this;null!=e&&null!=e.children&&0<e.children.length&&(i=[],e.children.forEach(function(e){e.weight=0;e={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};i.push(e)}),x.Toolkit.BlendTreeSystem.Calculate2DFreeformDirectional(e.valueParameterX,e.valueParameterY,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),e.children.forEach(function(e){e.weight*=o,e.type===x.Toolkit.MotionType.Clip&&0<e.weight&&n.push(e),e.type===x.Toolkit.MotionType.Tree&&l.parseTreeBranches(t,e.subtree,e.weight,n)}))},n.prototype.parse2DFreeformCartesianTreeBranches=function(t,e,o,n){var i,l=this;null!=e&&null!=e.children&&0<e.children.length&&(i=[],e.children.forEach(function(e){e.weight=0;e={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};i.push(e)}),x.Toolkit.BlendTreeSystem.Calculate2DFreeformCartesian(e.valueParameterX,e.valueParameterY,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),e.children.forEach(function(e){e.weight*=o,e.type===x.Toolkit.MotionType.Clip&&0<e.weight&&n.push(e),e.type===x.Toolkit.MotionType.Tree&&l.parseTreeBranches(t,e.subtree,e.weight,n)}))},n.FPS=30,n.EXIT="[EXIT]",n.TIME=1,n.SPEED=1;var t,o=n;function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._looptime=!1,e._loopblend=!1,e._frametime=0,e._layercount=0,e._updatemode=0,e._hasrootmotion=!1,e._animationplaying=!1,e._initialtargetblending=!1,e._hastransformhierarchy=!1,e._leftfeetbottomheight=0,e._rightfeetbottomheight=0,e._runtimecontroller=null,e._executed=!1,e._awakened=!1,e._initialized=!1,e._checkers=new x.Toolkit.TransitionCheck,e._source="",e._machine=null,e._animationmode=0,e._animationrig=null,e._deltaPosition=new x.Vector3(0,0,0),e._deltaRotation=new x.Quaternion(0,0,0,0),e._angularVelocity=new x.Vector3(0,0,0),e._rootMotionSpeed=0,e._lastMotionSpeed=0,e._loopMotionSpeed=0,e._lastRotateSpeed=0,e._loopRotateSpeed=0,e._lastMotionRotation=new x.Quaternion(0,0,0,0),e._lastMotionPosition=new x.Vector3(0,0,0),e._positionWeight=!1,e._rootBoneWeight=!1,e._rotationWeight=!1,e._rootQuatWeight=!1,e._rootBoneTransform=null,e._positionHolder=new x.Vector3(0,0,0),e._rootBoneHolder=new x.Vector3(0,0,0),e._rotationHolder=new x.Quaternion(0,0,0,0),e._rootQuatHolder=new x.Quaternion(0,0,0,0),e._rootMotionMatrix=x.Matrix.Zero(),e._rootMotionScaling=new x.Vector3(0,0,0),e._rootMotionRotation=new x.Quaternion(0,0,0,0),e._rootMotionPosition=new x.Vector3(0,0,0),e._dirtyMotionMatrix=null,e._dirtyBlenderMatrix=null,e._targetPosition=new x.Vector3(0,0,0),e._targetRotation=new x.Quaternion(0,0,0,0),e._targetScaling=new x.Vector3(1,1,1),e._updateMatrix=x.Matrix.Zero(),e._blenderMatrix=x.Matrix.Zero(),e._blendWeights=new x.Toolkit.BlendingWeights,e._emptyScaling=new x.Vector3(1,1,1),e._emptyPosition=new x.Vector3(0,0,0),e._emptyRotation=new x.Quaternion(0,0,0,0),e._ikFrameEanbled=!1,e._data=new Map,e._anims=new Map,e._clips=null,e._timers=new Map,e._starts=new Map,e._stops=new Map,e._numbers=new Map,e._booleans=new Map,e._triggers=new Map,e._parameters=new Map,e.speedRatio=1,e.delayUpdateUntilReady=!0,e.enableAnimation=!0,e.applyRootMotion=!1,e.onAnimationAwakeObservable=new x.Observable,e.onAnimationInitObservable=new x.Observable,e.onAnimationIKObservable=new x.Observable,e.onAnimationEndObservable=new x.Observable,e.onAnimationLoopObservable=new x.Observable,e.onAnimationEventObservable=new x.Observable,e.onAnimationUpdateObservable=new x.Observable,e.onAnimationTransitionObservable=new x.Observable,e.m_zeroVector=new x.Vector3(0,0,0),e.m_defaultGroup=null,e.m_animationTargets=null,e.m_rotationIdentity=new x.Quaternion(0,0,0,0),e.sourceAnimationGroups=null,e}function i(){}function l(){}function r(){}function a(){}function s(){}e.AnimationState=o,e.BlendTreeValue=function(e){this.source=e.source,this.motion=e.motion,this.posX=e.posX||0,this.posY=e.posY||0,this.weight=e.weight||0},i.ClampValue=function(e,t,o){return e<=t?t:o<=e?o:e},i.GetSignedAngle=function(e,t){return Math.atan2(e.x*t.y-e.y*t.x,e.x*t.x+e.y*t.y)},i.GetLinearInterpolation=function(e,t,o,n,i){return t+(n-t)/(o-e)*(i-e)},i.GetRightNeighbourIndex=function(e,t){t.sort(function(e,t){return e.posX-t.posX});for(var o=0;o<t.length;++o)if(t[o].posX>e)return o;return-1},o=i,e.BlendTreeUtils=o,l.Calculate1DSimpleBlendTree=function(e,t){var o=t[0],n=t[t.length-1];e<=o.posX?o.weight=1:e>=n.posX?n.weight=1:(n=t[(o=x.Toolkit.BlendTreeUtils.GetRightNeighbourIndex(e,t))-1],t=t[o],o=x.Toolkit.BlendTreeUtils.GetLinearInterpolation(n.posX,1,t.posX,0,e),n.weight=o,t.weight=1-n.weight)},l.Calculate2DFreeformDirectional=function(e,t,o){x.Toolkit.BlendTreeSystem.TempVector2_IP.set(e,t),x.Toolkit.BlendTreeSystem.TempVector2_POSI.set(0,0),x.Toolkit.BlendTreeSystem.TempVector2_POSJ.set(0,0),x.Toolkit.BlendTreeSystem.TempVector2_POSIP.set(0,0),x.Toolkit.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var n=0,i=x.Toolkit.BlendTreeSystem.TempVector2_IP.length(),l=0;l<o.length;++l){for(var r,a,s,u=o[l],c=(x.Toolkit.BlendTreeSystem.TempVector2_POSI.set(u.posX,u.posY),x.Toolkit.BlendTreeSystem.TempVector2_POSI.length()),p=i-c,d=x.Toolkit.BlendTreeUtils.GetSignedAngle(x.Toolkit.BlendTreeSystem.TempVector2_POSI,x.Toolkit.BlendTreeSystem.TempVector2_IP),h=1,m=0;m<o.length;++m)m!==l&&(x.Toolkit.BlendTreeSystem.TempVector2_POSJ.set(o[m].posX,o[m].posY),a=p/(r=(c+(s=x.Toolkit.BlendTreeSystem.TempVector2_POSJ.length()))/2),s=(s-c)/r,r=x.Toolkit.BlendTreeUtils.GetSignedAngle(x.Toolkit.BlendTreeSystem.TempVector2_POSI,x.Toolkit.BlendTreeSystem.TempVector2_POSJ),x.Toolkit.BlendTreeSystem.TempVector2_POSIP.set(a,2*d),x.Toolkit.BlendTreeSystem.TempVector2_POSIJ.set(s,2*r),a=x.Toolkit.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),s=x.Vector2.Dot(x.Toolkit.BlendTreeSystem.TempVector2_POSIP,x.Toolkit.BlendTreeSystem.TempVector2_POSIJ)/a,s=x.Toolkit.BlendTreeUtils.ClampValue(s=1-s,0,1),h=Math.min(s,h));n+=u.weight=h}for(var g=0,T=o;g<T.length;g++)(u=T[g]).weight/=n},l.Calculate2DFreeformCartesian=function(e,t,o){x.Toolkit.BlendTreeSystem.TempVector2_IP.set(e,t),x.Toolkit.BlendTreeSystem.TempVector2_POSI.set(0,0),x.Toolkit.BlendTreeSystem.TempVector2_POSJ.set(0,0),x.Toolkit.BlendTreeSystem.TempVector2_POSIP.set(0,0),x.Toolkit.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var n=0,i=0;i<o.length;++i){for(var l,r=o[i],a=(x.Toolkit.BlendTreeSystem.TempVector2_POSI.set(r.posX,r.posY),x.Toolkit.BlendTreeSystem.TempVector2_IP.subtractToRef(x.Toolkit.BlendTreeSystem.TempVector2_POSI,x.Toolkit.BlendTreeSystem.TempVector2_POSIP),1),s=0;s<o.length;++s)s!==i&&(x.Toolkit.BlendTreeSystem.TempVector2_POSJ.set(o[s].posX,o[s].posY),x.Toolkit.BlendTreeSystem.TempVector2_POSJ.subtractToRef(x.Toolkit.BlendTreeSystem.TempVector2_POSI,x.Toolkit.BlendTreeSystem.TempVector2_POSIJ),l=x.Toolkit.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),l=x.Vector2.Dot(x.Toolkit.BlendTreeSystem.TempVector2_POSIP,x.Toolkit.BlendTreeSystem.TempVector2_POSIJ)/l,l=x.Toolkit.BlendTreeUtils.ClampValue(l=1-l,0,1),a=Math.min(a,l));n+=r.weight=a}for(var u=0,c=o;u<c.length;u++)(r=c[u]).weight/=n},l.TempVector2_IP=new x.Vector2(0,0),l.TempVector2_POSI=new x.Vector2(0,0),l.TempVector2_POSJ=new x.Vector2(0,0),l.TempVector2_POSIP=new x.Vector2(0,0),l.TempVector2_POSIJ=new x.Vector2(0,0),e.BlendTreeSystem=l,e.MachineState=function(){},e.TransitionCheck=r,e.AnimationMixer=a,e.BlendingWeights=s,(o=e.MotionType||(e.MotionType={}))[o.Clip=0]="Clip",o[o.Tree=1]="Tree",(o=e.ConditionMode||(e.ConditionMode={}))[o.If=1]="If",o[o.IfNot=2]="IfNot",o[o.Greater=3]="Greater",o[o.Less=4]="Less",o[o.Equals=6]="Equals",o[o.NotEqual=7]="NotEqual",(o=e.InterruptionSource||(e.InterruptionSource={}))[o.None=0]="None",o[o.Source=1]="Source",o[o.Destination=2]="Destination",o[o.SourceThenDestination=3]="SourceThenDestination",o[o.DestinationThenSource=4]="DestinationThenSource",(o=e.BlendTreeType||(e.BlendTreeType={}))[o.Simple1D=0]="Simple1D",o[o.SimpleDirectional2D=1]="SimpleDirectional2D",o[o.FreeformDirectional2D=2]="FreeformDirectional2D",o[o.FreeformCartesian2D=3]="FreeformCartesian2D",o[o.Direct=4]="Direct",o[o.Clip=5]="Clip",(o=e.BlendTreePosition||(e.BlendTreePosition={}))[o.Lower=0]="Lower",o[o.Upper=1]="Upper",(o=e.AnimatorParameterType||(e.AnimatorParameterType={}))[o.Float=1]="Float",o[o.Int=3]="Int",o[o.Bool=4]="Bool",o[o.Trigger=9]="Trigger"}(BABYLON=BABYLON||{}),this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}()),__extends=(!function(l){var e,t;function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._audio=null,e._name=null,e._loop=!1,e._mute=!1,e._pitch=1,e._volume=1,e._preload=!1,e._playonawake=!0,e._spatialblend=0,e._preloaderUrl=null,e._lastmutedvolume=null,e._priority=128,e._panstereo=0,e._mindistance=10,e._maxdistance=50,e._rolloffmode="linear",e._reverbzonemix=1,e._bypasseffects=!1,e._bypassreverbzones=!1,e._bypasslistenereffects=!1,e._initializedReadyInstance=!1,e.onReadyObservable=new l.Observable,e}e=l.Toolkit||(l.Toolkit={}),t=l.Toolkit.ScriptComponent,__extends(o,t),o.prototype.getSoundClip=function(){return this._audio},o.prototype.getAudioElement=function(){return null!=this._audio?this._audio._htmlAudioElement:null},o.prototype.awake=function(){this.awakeAudioSource()},o.prototype.start=function(){this.startAudioSource()},o.prototype.destroy=function(){this.destroyAudioSource()},o.prototype.awakeAudioSource=function(){this._name=this.getProperty("name",this._name),this._loop=this.getProperty("loop",this._loop),this._mute=this.getProperty("mute",this._mute),this._pitch=this.getProperty("pitch",this._pitch),this._volume=this.getProperty("volume",this._volume),this._preload=this.getProperty("preload",this._preload),this._priority=this.getProperty("priority",this._priority),this._panstereo=this.getProperty("panstereo",this._panstereo),this._playonawake=this.getProperty("playonawake",this._playonawake),this._mindistance=this.getProperty("mindistance",this._mindistance),this._maxdistance=this.getProperty("maxdistance",this._maxdistance),this._rolloffmode=this.getProperty("rolloffmode",this._rolloffmode),this._spatialblend=this.getProperty("spatialblend",this._spatialblend),this._reverbzonemix=this.getProperty("reverbzonemix",this._reverbzonemix),this._bypasseffects=this.getProperty("bypasseffects",this._bypasseffects),this._bypassreverbzones=this.getProperty("bypassreverbzones",this._bypassreverbzones),this._bypasslistenereffects=this.getProperty("bypasslistenereffects",this._bypasslistenereffects),null!=this._name&&""!==this._name||(this._name="Unknown");var e=this.getProperty("file");null!=e&&""!==e&&null!=(e=l.Toolkit.SceneManager.GetRootUrl(this.scene)+e)&&""!==e&&(!0===this._preload?this._preloaderUrl=e:this.setDataSource(e))},o.prototype.startAudioSource=function(){this._volume>=l.Toolkit.AudioSource.MAX_VOLUME&&(this._volume=l.Toolkit.AudioSource.DEFAULT_LEVEL)},o.prototype.destroyAudioSource=function(){this.onReadyObservable.clear(),(this.onReadyObservable=null)!=this._audio&&(this._audio.dispose(),this._audio=null)},o.prototype.isReady=function(){var e=!1;return e=null!=this._audio?this._audio.isReady():e},o.prototype.isPlaying=function(){var e=!1;return e=null!=this._audio?this._audio.isPlaying:e},o.prototype.isPaused=function(){var e=!1;return e=null!=this._audio?this._audio.isPaused:e},o.prototype.play=function(e,t,o){var n=this;return l.Toolkit.SceneManager.HasAudioContext()?this.internalPlay(e,t,o):l.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){n.internalPlay(e,t,o)}),!0},o.prototype.internalPlay=function(e,t,o){var n=this;null!=this._audio&&(!0===this._initializedReadyInstance?this._audio.play(e,t,o):this.onReadyObservable.addOnce(function(){n._audio.play(e,t,o)}))},o.prototype.pause=function(){var e=!1;return null!=this._audio&&(this._audio.pause(),e=!0),e},o.prototype.stop=function(e){var t=!1;return null!=this._audio&&(this._audio.stop(e),t=!0),t},o.prototype.mute=function(e){return null!=this._audio&&(this._lastmutedvolume=this._audio.getVolume(),this._audio.setVolume(0,e)),!1},o.prototype.unmute=function(e){return null!=this._audio&&null!=this._lastmutedvolume&&(this._audio.setVolume(this._lastmutedvolume,e),this._lastmutedvolume=null),!1},o.prototype.getVolume=function(){return null!=this._audio?this._audio.getVolume():this._volume},o.prototype.setVolume=function(e,t){return this._volume=e,null!=this._audio&&this._audio.setVolume(this._volume,t),!0},o.prototype.getSpatialSound=function(){var e=!1;return e=null!=this._audio?this._audio.spatialSound:e},o.prototype.setSpatialSound=function(e){null!=this._audio&&(this._audio.spatialSound=e)},o.prototype.setPlaybackSpeed=function(e){null!=this._audio&&this._audio.setPlaybackRate(e)},o.prototype.getCurrentTrackTime=function(){var e=0;return e=null!=this._audio?this._audio.currentTime:e},o.prototype.setDataSource=function(e){var t=this,o=(null!=this._audio&&(this._audio.dispose(),this._audio=null),.1<=this._spatialblend),n="logarithmic"===this._rolloffmode?"exponential":"linear",i=null!=this.transform.metadata&&null!=this.transform.metadata.vtt&&!0===this.transform.metadata.vtt;this._initializedReadyInstance=!1,this._audio=new l.Sound(this._name,e,this.scene,function(){t._lastmutedvolume=t._volume,t._audio.setVolume(!0===t._mute?0:t._volume),t._audio.setPlaybackRate(t._pitch),t._initializedReadyInstance=!0,t.onReadyObservable&&t.onReadyObservable.hasObservers()&&t.onReadyObservable.notifyObservers(t._audio),!0===t._playonawake&&t.play()},{loop:this._loop,autoplay:!1,refDistance:this._mindistance,maxDistance:this._maxdistance,rolloffFactor:l.Toolkit.AudioSource.DEFAULT_ROLLOFF,spatialSound:o,distanceModel:n,streaming:i}),this._audio.setPosition(this.transform.position.clone()),!0==o&&this._audio.attachToMesh(this.transform)},o.prototype.addPreloaderTasks=function(e){var t=this;!0===this._preload&&((e=e.addBinaryFileTask(this.transform.name+".AudioTask",this._preloaderUrl)).onSuccess=function(e){t.setDataSource(e.data)},e.onError=function(e,t,o){console.error(t,o)})},o.MAX_VOLUME=1,o.DEFAULT_LEVEL=1,o.DEFAULT_ROLLOFF=1,e.AudioSource=o}(BABYLON=BABYLON||{}),this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}()),__extends=(!function(a){var t,e=a.Toolkit||(a.Toolkit={});function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._avatarRadius=.28,e._avatarHeight=1.8,e._centerOffset=new a.Vector3(0,.94,0),e._slopeLimit=45,e._skinWidth=.025,e._stepHeight=.25,e._minMoveDistance=.001,e._slopeSlideSpeed=10,e._slopeAngleRadians=0,e._slopeAngleDegrees=0,e._slopeMoveDirection=0,e._verticalVelocity=0,e._verticalStepSpeed=1,e._minimumStepHeight=.15,e._currentVelocity=new a.Vector3(0,0,0),e._inputVelocity=new a.Vector3(0,0,0),e._angluarVelocity=new a.Quaternion(0,0,0,1),e._eulerAngles=new a.Vector3(0,0,0),e._gravityFactor=3,e._minJumpTimer=0,e._maxSlopeTimer=0,e._isSliding=!1,e._isGrounded=!1,e._isSteppingUp=!1,e._hitColor=new a.Color3(0,1,0),e._noHitColor=new a.Color3(1,0,0),e._groundRay=null,e._groundRayHelper=null,e._groundRaycastShape=null,e._groundHitPointMesh=null,e._groundCollisionNode=null,e._groundRaycastOffset=new a.Vector3(0,0,0),e._groundRaycastOrigin=new a.Vector3(0,0,0),e._groundRaycastDirection=new a.Vector3(0,-1,0),e._groundRaycastDestination=new a.Vector3(0,0,0),e._localGroundShapecastResult=null,e._worldGroundShapecastResult=null,e._stepCheckRaycastOrigin=new a.Vector3(0,0,0),e._stepCheckRaycastDestination=new a.Vector3(0,0,0),e._stepCheckRaycastHitPoint=new a.Vector3(0,0,0),e._stepCheckRaycastResult=null,e._stepCheckOriginMesh=null,e._stepCheckHitPointMesh=null,e._stepCheckDestinationMesh=null,e._stepCheckRayHelper=null,e._stepCheckRay=null,e.m_moveDeltaX=0,e.m_moveDeltaZ=0,e.m_havokplugin=null,e.onUpdatePositionObservable=new a.Observable,e.onUpdateVelocityObservable=new a.Observable,e.verticalVelocityOffset=0,e.enableStepOffset=!0,e.enableGravity=!0,e.downwardForce=0,e.showRaycasts=!1,e}t=a.Toolkit.ScriptComponent,__extends(o,t),o.prototype.getAvatarRadius=function(){return this._avatarRadius},o.prototype.getAvatarHeight=function(){return this._avatarHeight},o.prototype.getCenterOffset=function(){return this._centerOffset},o.prototype.getSkinWidth=function(){return this._skinWidth},o.prototype.getStepHeight=function(){return this._stepHeight},o.prototype.getGravityFactor=function(){return this._gravityFactor},o.prototype.setGravityFactor=function(e){this._gravityFactor=e},o.prototype.getInputVelocity=function(){return this._inputVelocity},o.prototype.getVerticalVelocity=function(){return!0===this._isGrounded?0:this._currentVelocity.y},o.prototype.getSlopeAngleRadians=function(){return this._slopeAngleRadians},o.prototype.getSlopeAngleDegrees=function(){return this._slopeAngleDegrees},o.prototype.getGroundCollisionNode=function(){return this._groundCollisionNode},o.prototype.getVerticalStepSpeed=function(){return this._verticalStepSpeed},o.prototype.setVerticalStepSpeed=function(e){this._verticalStepSpeed=e},o.prototype.getMinimumStepHeight=function(){return this._minimumStepHeight},o.prototype.setMinimumStepHeight=function(e){this._minimumStepHeight=e},o.prototype.getMinMoveDistance=function(){return this._minMoveDistance},o.prototype.setMinMoveDistance=function(e){this._minMoveDistance=e},o.prototype.getSlopeSlideSpeed=function(){return this._slopeSlideSpeed},o.prototype.setSlopeSlideSpeed=function(e){this._slopeSlideSpeed=e},o.prototype.getSlopeLimit=function(){return this._slopeLimit},o.prototype.setSlopeLimit=function(e){this._slopeLimit=e},o.prototype.isSteppingUp=function(){return this._isSteppingUp},o.prototype.isGrounded=function(){return this._isGrounded},o.prototype.isSliding=function(){return this._isSliding},o.prototype.canSlide=function(){return 0<this._slopeAngleDegrees&&(this._slopeMoveDirection<=0||0<this._slopeMoveDirection&&this._maxSlopeTimer>=a.Toolkit.CharacterController.DEFAULT_SLIDING_TIMER)},o.prototype.canJump=function(){return!0===this._isGrounded},o.prototype.awake=function(){this._avatarRadius=this.getProperty("avatarRadius",this._avatarRadius),this._avatarHeight=this.getProperty("avatarHeight",this._avatarHeight),this._slopeLimit=this.getProperty("slopeLimit",this._slopeLimit),this._skinWidth=this.getProperty("skinWidth",this._skinWidth),this._stepHeight=this.getProperty("stepOffset",this._stepHeight),this._minMoveDistance=this.getProperty("minMoveDistance",this._minMoveDistance);var e=this.getProperty("centerOffset");null!=e&&(this._centerOffset=a.Toolkit.Utilities.ParseVector3(e)),this.createPhysicsBodyAndShape(a.Toolkit.CharacterController.DEFAULT_CHARACTER_MASS,a.Toolkit.Utilities.GetLayerMask(31),-1)},o.prototype.update=function(){var e=this.getDeltaSeconds();0<this._minJumpTimer&&(this._minJumpTimer-=e,this._minJumpTimer<0)&&(this._minJumpTimer=0),0<this._slopeAngleDegrees?this._maxSlopeTimer+=e:this._maxSlopeTimer=0},o.prototype.fixed=function(){var e,t;null!=this.transform&&(null!=this.transform.physicsBody?this.transform.physicsBody.getLinearVelocityToRef(this._currentVelocity):this._currentVelocity.set(0,0,0),this.verticalVelocityOffset=0,t=this.updateGroundedState(),this.updateSlopesAndSlides(null==(e=null==t?void 0:t.world)?void 0:e.hasHit,null==(e=null==t?void 0:t.world)?void 0:e.hitNormal),this.onUpdateVelocityObservable&&this.onUpdateVelocityObservable.hasObservers()&&this.onUpdateVelocityObservable.notifyObservers(this.transform),this._inputVelocity.y=!0===this.enableGravity?this._verticalVelocity+this.verticalVelocityOffset+this.downwardForce:this.downwardForce,null!=this.transform.physicsBody&&this.transform.physicsBody.setLinearVelocity(this._inputVelocity),this.onUpdatePositionObservable)&&this.onUpdatePositionObservable.hasObservers()&&this.onUpdatePositionObservable.notifyObservers(this.transform)},o.prototype.set=function(e,t,o,n,i,l,r,a){var s=this;void 0===n&&(n=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===r&&(r=null),void 0===a&&(a=!0),null!=this.transform&&null!=this.transform.physicsBody&&(this.transform.physicsBody.disablePreStep=!1,null!=this.transform.position&&null!=e&&null!=t&&null!=o&&this.transform.position.set(e,t,o),null!=this.transform.rotationQuaternion&&null!=n&&null!=i&&null!=l&&null!=r&&this.transform.rotationQuaternion.set(n,i,l,r),!0===a)&&this.scene.onAfterPhysicsObservable.addOnce(function(){s.transform.physicsBody.disablePreStep=!0})},o.prototype.move=function(e,t){void 0===t&&(t=!0),null!=e&&(this.m_moveDeltaX=e.x,this.m_moveDeltaZ=e.z,Math.abs(e.x)<this._minMoveDistance&&(0<e.x?this.m_moveDeltaX=this._minMoveDistance:e.x<0&&(this.m_moveDeltaX=-this._minMoveDistance)),Math.abs(e.z)<this._minMoveDistance&&(0<e.z?this.m_moveDeltaZ=this._minMoveDistance:e.z<0&&(this.m_moveDeltaZ=-this._minMoveDistance)),this._inputVelocity.set(this.m_moveDeltaX,0,this.m_moveDeltaZ))},o.prototype.jump=function(e){this.canJump()&&(this._isGrounded=!1,this._minJumpTimer=a.Toolkit.CharacterController.DEFAULT_JUMPING_TIMER,this._verticalVelocity=e)},o.prototype.turn=function(e){null!=this.transform&&null!=this.transform.rotationQuaternion&&(this.transform.rotationQuaternion.toEulerAnglesToRef(this._eulerAngles),this._eulerAngles.y+=e,a.Quaternion.FromEulerAnglesToRef(this._eulerAngles.x,this._eulerAngles.y,this._eulerAngles.z,this._angluarVelocity),null!=this.transform.physicsBody)&&null!=this.transform.physicsBody._pluginData&&null!=this.transform.physicsBody._pluginData.hpBodyId&&(null==this.m_havokplugin&&(this.m_havokplugin=this.scene.getPhysicsEngine().getPhysicsPlugin()),null!=this.m_havokplugin)&&this.m_havokplugin._hknp.HP_Body_SetOrientation(this.transform.physicsBody._pluginData.hpBodyId,[this._angluarVelocity.x,this._angluarVelocity.y,this._angluarVelocity.z,this._angluarVelocity.w])},o.prototype.rotate=function(e,t,o,n){null!=this.transform&&null!=this.transform.physicsBody&&null!=this.transform.physicsBody._pluginData&&null!=this.transform.physicsBody._pluginData.hpBodyId&&(null==this.m_havokplugin&&(this.m_havokplugin=this.scene.getPhysicsEngine().getPhysicsPlugin()),null!=this.m_havokplugin)&&this.m_havokplugin._hknp.HP_Body_SetOrientation(this.transform.physicsBody._pluginData.hpBodyId,[e,t,o,n])},o.prototype.setRigidBodyMass=function(e){var t;null!=this.transform&&null!=this.transform.physicsBody&&((t=this.transform.physicsBody.getMassProperties()).mass=1e-7<=e?e:1e-7,this.transform.physicsBody.setMassProperties(t))},o.prototype.setCollisionState=function(e){null!=this.transform&&null!=this.transform.physicsBody&&null!=this.transform.physicsBody.shape&&(this.transform.physicsBody.shape.isTrigger=!e)},o.prototype.updateGroundedState=function(){this._groundRaycastOffset.set(0,this._avatarHeight/2,0),this.transform.absolutePosition.addToRef(this._groundRaycastOffset,this._groundRaycastOrigin);var e=.2*this._avatarRadius,t=this._avatarHeight/2+a.Toolkit.CharacterController.MIN_GROUND_CHECK_SKINWIDTH,o=(!0===this._isGrounded&&(t+=this._stepHeight+a.Toolkit.CharacterController.MIN_GROUND_CHECK_DISTANCE),a.Toolkit.Utilities.CalculateDestinationPointToRef(this._groundRaycastOrigin,this._groundRaycastDirection,t,this._groundRaycastDestination),null==this._groundRaycastShape&&(this._groundRaycastShape=new a.PhysicsShapeSphere(new a.Vector3(0,0,0),e,this.scene)),{shape:this._groundRaycastShape,rotation:this.transform.rotationQuaternion,startPosition:this._groundRaycastOrigin,endPosition:this._groundRaycastDestination,ignoreBody:this.transform.physicsBody,shouldHitTriggers:!1});return null==this._stepCheckRaycastResult&&(this._stepCheckRaycastResult=new a.PhysicsRaycastResult),null==this._localGroundShapecastResult&&(this._localGroundShapecastResult=new a.ShapeCastResult),null==this._worldGroundShapecastResult&&(this._worldGroundShapecastResult=new a.ShapeCastResult),this._stepCheckRaycastResult.reset(),this._localGroundShapecastResult.reset(),this._worldGroundShapecastResult.reset(),a.Toolkit.RigidbodyPhysics.ShapecastToRef(o,this._localGroundShapecastResult,this._worldGroundShapecastResult),this._isGrounded=this._minJumpTimer<=0&&null!=this._worldGroundShapecastResult&&!0===this._worldGroundShapecastResult.hasHit&&null!=this._worldGroundShapecastResult.body,this._groundCollisionNode=!0===this._isGrounded&&null!=this._worldGroundShapecastResult.body?this._worldGroundShapecastResult.body.transformNode:null,1!=this.showRaycasts&&!a.Toolkit.Utilities.ShowDebugColliders()||(null==this._groundRay&&(this._groundRay=new a.Ray(this._groundRaycastOrigin,this._groundRaycastDirection,t)),this._groundRay.origin=this._groundRaycastOrigin,this._groundRay.direction=this._groundRaycastDirection,this._groundRay.length=t,null==this._groundRayHelper&&(this._groundRayHelper=new a.RayHelper(this._groundRay)),this._groundRayHelper.ray=this._groundRay,this._groundRayHelper.show(this.scene,!0===this._isGrounded?this._hitColor:this._noHitColor),null==this._groundHitPointMesh&&(this._groundHitPointMesh=a.MeshBuilder.CreateSphere("GroundHitMesh",{diameter:2*e},this.scene),this._groundHitPointMesh.visibility=.5,this._groundHitPointMesh.material=new a.StandardMaterial("GroundHitMat",this.scene),this._groundHitPointMesh.material.diffuseColor=new a.Color3(1,0,0)),!0===this._isGrounded?this._groundHitPointMesh.position.copyFrom(this._worldGroundShapecastResult.hitPoint):this._groundHitPointMesh.position.copyFrom(this._groundRaycastDestination)),!0===this.enableStepOffset&&(o=this.transform.absolutePosition,t=3*this._stepHeight,this._isSteppingUp=!1,this._stepCheckRaycastHitPoint.copyFrom(o),this._stepCheckRaycastOrigin.copyFrom(o),this._stepCheckRaycastDestination.copyFrom(o),!0===this._isGrounded&&0<this._inputVelocity.lengthSquared()&&(e=this._inputVelocity.clone().normalize(),o=this.transform.position.clone(),e=e.scale(this._avatarRadius+.01),this._stepCheckRaycastOrigin.set(o.x+e.x,o.y+(this._stepHeight+this._skinWidth),o.z+e.z),a.Toolkit.Utilities.CalculateDestinationPointToRef(this._stepCheckRaycastOrigin,this._groundRaycastDirection,t,this._stepCheckRaycastDestination),a.Toolkit.RigidbodyPhysics.RaycastToRef(this._stepCheckRaycastOrigin,this._stepCheckRaycastDestination,this._stepCheckRaycastResult),!0===this._stepCheckRaycastResult.hasHit)&&null!=this._stepCheckRaycastResult.hitPointWorld&&(this._stepCheckRaycastHitPoint.copyFrom(this._stepCheckRaycastResult.hitPointWorld),(e=this._stepCheckRaycastResult.hitPointWorld.y-o.y)>=this._minimumStepHeight)&&e<=this._stepHeight&&(this._isSteppingUp=!0,this.verticalVelocityOffset=this._verticalStepSpeed),1!=this.showRaycasts&&!a.Toolkit.Utilities.ShowDebugColliders()||(null==this._stepCheckRay&&(this._stepCheckRay=new a.Ray(this._stepCheckRaycastOrigin,this._groundRaycastDirection,t)),this._stepCheckRay.origin=this._stepCheckRaycastOrigin,this._stepCheckRay.direction=this._groundRaycastDirection,this._stepCheckRay.length=t,null==this._stepCheckRayHelper&&(this._stepCheckRayHelper=new a.RayHelper(this._stepCheckRay)),this._stepCheckRayHelper.ray=this._stepCheckRay,this._stepCheckRayHelper.show(this.scene,!0===this._stepCheckRaycastResult.hasHit?this._hitColor:this._noHitColor),null==this._stepCheckOriginMesh&&(this._stepCheckOriginMesh=a.MeshBuilder.CreateSphere("StepCheckOriginMesh",{diameter:.05},this.scene),this._stepCheckOriginMesh.visibility=.5,this._stepCheckOriginMesh.material=new a.StandardMaterial("StepCheckOriginMat",this.scene),this._stepCheckOriginMesh.material.diffuseColor=new a.Color3(0,0,1)),null==this._stepCheckHitPointMesh&&(this._stepCheckHitPointMesh=a.MeshBuilder.CreateSphere("StepCheckHitPointMesh",{diameter:.05},this.scene),this._stepCheckHitPointMesh.visibility=.5,this._stepCheckHitPointMesh.material=new a.StandardMaterial("StepCheckHitPointMat",this.scene),this._stepCheckHitPointMesh.material.diffuseColor=new a.Color3(0,1,0)),null==this._stepCheckDestinationMesh&&(this._stepCheckDestinationMesh=a.MeshBuilder.CreateSphere("StepCheckDestinationMesh",{diameter:.05},this.scene),this._stepCheckDestinationMesh.visibility=.5,this._stepCheckDestinationMesh.material=new a.StandardMaterial("StepCheckDestinationMat",this.scene),this._stepCheckDestinationMesh.material.diffuseColor=new a.Color3(1,1,1)),this._stepCheckOriginMesh.position.copyFrom(this._stepCheckRaycastOrigin),this._stepCheckHitPointMesh.position.copyFrom(this._stepCheckRaycastHitPoint),this._stepCheckDestinationMesh.position.copyFrom(this._stepCheckRaycastDestination))),{local:this._localGroundShapecastResult,world:this._worldGroundShapecastResult}},o.prototype.updateSlopesAndSlides=function(e,t){var o,n=!0;this._isSliding=!1,this._slopeAngleRadians=0,this._slopeAngleDegrees=0,this._slopeMoveDirection=0,this.isGrounded()&&(this._verticalVelocity<=-a.Toolkit.CharacterController.DEFAULT_GRAVITY_FORCE&&(this._verticalVelocity=-a.Toolkit.CharacterController.DEFAULT_GRAVITY_FORCE,n=!1),null!=t)&&(this._slopeAngleRadians=Math.acos(a.Vector3.Dot(t,a.Vector3.UpReadOnly)),this._slopeAngleDegrees=a.Tools.ToDegrees(this._slopeAngleRadians),o=a.Vector3.Cross(t,a.Vector3.UpReadOnly).normalize(),o=a.Vector3.Cross(o,t).normalize(),this._slopeMoveDirection=a.Vector3.Dot(this._currentVelocity.normalize(),o),this._slopeAngleDegrees>=a.Toolkit.CharacterController.MIN_GROUND_CHECK_SLOPEANGLE&&this._slopeAngleDegrees<=this._slopeLimit?this._inputVelocity.length()<=0?this._verticalVelocity<=-a.Toolkit.CharacterController.STATIC_GRAVITY_FORCE&&(this._verticalVelocity=-a.Toolkit.CharacterController.STATIC_GRAVITY_FORCE,n=!1):0<this._slopeMoveDirection?(this._verticalVelocity=-a.Toolkit.CharacterController.UPHILL_GRAVITY_FORCE,n=!1):this._slopeMoveDirection<0&&(this._verticalVelocity=-a.Toolkit.CharacterController.SLOPE_GRAVITY_FORCE,n=!1):this._slopeAngleDegrees>=a.Toolkit.CharacterController.MIN_GROUND_CHECK_SLOPEANGLE&&this._slopeAngleDegrees>this._slopeLimit&&this.canSlide()&&(o=new a.Vector3(0,-1,0),o=a.Vector3.Cross(a.Vector3.Cross(t,o),t).normalize().scale(this._slopeSlideSpeed),this._inputVelocity.x=o.x,this._inputVelocity.z=o.z,this._verticalVelocity=o.y,n=!(this._isSliding=!0))),!0===n&&(t=this.getDeltaSeconds(),this._verticalVelocity-=Math.abs(this.scene.gravity.y)*this._gravityFactor*t,Math.abs(this._verticalVelocity)>a.Toolkit.CharacterController.TERMINAL_VELOCITY)&&(this._verticalVelocity=-a.Toolkit.CharacterController.TERMINAL_VELOCITY)},o.prototype.createPhysicsBodyAndShape=function(e,t,o){var n=this.transform,i=(a.Toolkit.Utilities.ReparentColliders()||n.setParent(null,!0,!0),this._avatarRadius*parseFloat(n.scaling.x.toFixed(4))),l=this._avatarHeight*parseFloat(n.scaling.y.toFixed(4)),i=this.createPhysicsShapeCapsule(i,l),l=(i.material={friction:0,restitution:0},i.filterMembershipMask=t,i.filterCollideMask=o,new a.Quaternion(0,0,0,1)),t=this._centerOffset.x*parseFloat(n.scaling.x.toFixed(4)),o=this._centerOffset.y*parseFloat(n.scaling.y.toFixed(4)),r=this._centerOffset.z*parseFloat(n.scaling.z.toFixed(4)),t=new a.Vector3(t,o,r),o=new a.PhysicsShapeContainer(this.scene),r=(o.addChild(i,t,l,new a.Vector3(1,1,1)),new a.PhysicsBody(n,a.PhysicsMotionType.DYNAMIC,!1,this.scene));r.shape=o,r.setMassProperties({mass:e,centerOfMass:new a.Vector3(0,0,0),inertia:new a.Vector3(0,0,0)}),r.setGravityFactor(0),r.setLinearDamping(0),r.setAngularDamping(0),a.Toolkit.Utilities.ShowDebugColliders()&&console.log("Setup character controller physics collider for: "+n.name,n),a.Toolkit.Utilities.ShowDebugColliders()||null!=n.material&&"CenterBox-Material"===n.material.name&&(n.isVisible=!1),a.Toolkit.Utilities.ShowDebugColliders()&&(null==a.Toolkit.RigidbodyPhysics.DebugPhysicsViewer&&(a.Toolkit.RigidbodyPhysics.DebugPhysicsViewer=new a.Debug.PhysicsViewer),null!=a.Toolkit.RigidbodyPhysics.DebugPhysicsViewer)&&a.Toolkit.RigidbodyPhysics.DebugPhysicsViewer.showBody(r)},o.prototype.createPhysicsShapeCapsule=function(e,t){var o=.5*(t-.5);return new a.PhysicsShapeCapsule(new a.Vector3(0,-.5*(t-.5),0),new a.Vector3(0,o,0),e,this.scene)},o.prototype.createPhysicsShapeCylinder=function(e,t){var o=.5*t;return new a.PhysicsShapeCylinder(new a.Vector3(0,-.5*t,0),new a.Vector3(0,o,0),e,this.scene)},o.TERMINAL_VELOCITY=55,o.SLOPE_GRAVITY_FORCE=3,o.UPHILL_GRAVITY_FORCE=1,o.STATIC_GRAVITY_FORCE=0,o.DEFAULT_GRAVITY_FORCE=1,o.DEFAULT_JUMPING_TIMER=.1,o.DEFAULT_SLIDING_TIMER=.15,o.DEFAULT_CHARACTER_MASS=85,o.MIN_GROUND_CHECK_DISTANCE=.25,o.MIN_GROUND_CHECK_SKINWIDTH=.001,o.MIN_GROUND_CHECK_SLOPEANGLE=1,e.CharacterController=o,n=a.Toolkit.ScriptComponent,__extends(i,n),i.prototype.start=function(){},i.prototype.set=function(e,t,o,n,i,l,r,a){void 0===n&&(n=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===r&&(r=null),void 0===a&&(a=!0),null!=this.transform&&(null!=this.transform.position&&null!=e&&null!=t&&null!=o&&this.transform.position.set(e,t,o),null!=this.transform.rotationQuaternion)&&null!=n&&null!=i&&null!=l&&null!=r&&this.transform.rotationQuaternion.set(n,i,l,r)},i.prototype.move=function(e,t){void 0===t&&(t=!0),null!=e&&null!=this.transform&&this.transform instanceof a.AbstractMesh&&this.transform.moveWithCollisions(e)},i.prototype.jump=function(e){},i.prototype.turn=function(e){null!=this.transform&&null!=this.transform.rotationQuaternion&&(this.transform.rotationQuaternion.toEulerAnglesToRef(this._eulerAngles),this._eulerAngles.y+=e,a.Quaternion.FromEulerAnglesToRef(this._eulerAngles.x,this._eulerAngles.y,this._eulerAngles.z,this.transform.rotationQuaternion))},i.prototype.rotate=function(e,t,o,n){null!=this.transform&&null!=this.transform.rotationQuaternion&&this.transform.rotationQuaternion.set(e,t,o,n)};var n;function i(){var e=null!==n&&n.apply(this,arguments)||this;return e._eulerAngles=new a.Vector3(0,0,0),e}e.SimpleCharacterController=i,l=a.Toolkit.ScriptComponent,__extends(r,l),r.prototype.getNavigationAgent=function(){return this._navigationAgent},r.prototype.setNavigationAgent=function(e){this._navigationAgent=e},r.prototype.setDestinationPoint=function(e,t){void 0===t&&(t=!0),null!=this._navigationAgent&&this._navigationAgent.setDestination(e,t)},r.prototype.start=function(){this._navigationAgent=this.getComponent("BABYLON.Toolkit.NavigationAgent")},r.prototype.set=function(e,t,o,n,i,l,r,a){void 0===n&&(n=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===r&&(r=null),void 0===a&&(a=!0),null!=this.transform&&null!=this._navigationAgent&&(null!=this.transform.position&&null!=e&&null!=t&&null!=o&&(this._teleportVector.set(e,t,o),this._navigationAgent.teleport(this._teleportVector,a)),null!=this.transform.rotationQuaternion)&&null!=n&&null!=i&&null!=l&&null!=r&&this.transform.rotationQuaternion.set(n,i,l,r)},r.prototype.move=function(e,t){void 0===t&&(t=!0),null!=e&&null!=this._navigationAgent&&this._navigationAgent.move(e,t)},r.prototype.jump=function(e){console.warn("Jump is not supported by the navigation mesh character controller.")},r.prototype.turn=function(e){null!=this.transform&&null!=this.transform.rotationQuaternion&&null!=this._navigationAgent&&(this.transform.rotationQuaternion.toEulerAnglesToRef(this._eulerAngles),this._eulerAngles.y+=e,a.Quaternion.FromEulerAnglesToRef(this._eulerAngles.x,this._eulerAngles.y,this._eulerAngles.z,this.transform.rotationQuaternion))},r.prototype.rotate=function(e,t,o,n){null!=this.transform&&null!=this.transform.rotationQuaternion&&null!=this._navigationAgent&&this.transform.rotationQuaternion.set(e,t,o,n)};var l;function r(){var e=null!==l&&l.apply(this,arguments)||this;return e._eulerAngles=new a.Vector3(0,0,0),e._teleportVector=new a.Vector3(0,0,0),e._navigationAgent=null,e}e.RecastCharacterController=r}(BABYLON=BABYLON||{}),!function(_){var e;function t(e){this.chassisBody=null,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=0,this.indexForwardAxis=2,this.indexUpAxis=1,this.minimumWheelContacts=4,this.smoothFlyingImpulse=0,this.stabilizingForce=0,this.maxImpulseForce=0,this.currentVehicleSpeedKmHour=0,this.chassisBody=e.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==e.indexRightAxis?e.indexRightAxis:0,this.indexForwardAxis=void 0!==e.indexForwardAxis?e.indexForwardAxis:2,this.indexUpAxis=void 0!==e.indexUpAxis?e.indexUpAxis:1}function o(e){this.maxSuspensionTravel=0,this.customSlidingRotationalSpeed=0,this.useCustomSlidingRotationalSpeed=0,this.sliding=!1,this.visualTravelRange=0,this.invertDirection=!1,this.isInContact=!1,this.hub=null,this.spinner=null,this.defaultFriction=10,this.steeringAngle=0,this.rotationBoost=0,this.locked=!1,e=_.Toolkit.HavokVehicleUtilities.Utilsdefaults(e,{chassisConnectionPointLocal:new _.Vector3,chassisConnectionPointWorld:new _.Vector3,directionLocal:new _.Vector3,directionWorld:new _.Vector3,axleLocal:new _.Vector3,axleWorld:new _.Vector3,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,invertDirection:!1,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=e.maxSuspensionTravel,this.customSlidingRotationalSpeed=e.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=e.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=e.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=e.chassisConnectionPointLocal.clone(),this.directionLocal=e.directionLocal.clone(),this.directionWorld=e.directionLocal.clone(),this.axleLocal=e.axleLocal.clone(),this.axleWorld=e.axleLocal.clone(),this.suspensionRestLength=e.suspensionRestLength,this.suspensionMaxLength=e.suspensionMaxLength,this.radius=e.radius,this.suspensionStiffness=e.suspensionStiffness,this.dampingCompression=e.dampingCompression,this.dampingRelaxation=e.dampingRelaxation,this.frictionSlip=e.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=e.rollInfluence,this.maxSuspensionForce=e.maxSuspensionForce,this.invertDirection=e.invertDirection,this.engineForce=0,this.brake=0,this.isFrontWheel=e.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new _.PhysicsRaycastResult,this.raycastResult.directionWorld=new _.Vector3,this.worldTransform=new _.TransformNode(""),this.worldTransform.rotationQuaternion=new _.Quaternion,this.isInContact=!1}function n(){}e=_.Toolkit||(_.Toolkit={}),t.prototype.addWheel=function(e){var e=new _.Toolkit.HavokWheelInfo(e=e||{}),t=this.wheelInfos.length;return this.wheelInfos.push(e),t},t.prototype.getNumWheels=function(){return this.wheelInfos.length},t.prototype.getWheelInfo=function(e){return this.wheelInfos[e]},t.prototype.getSteeringValue=function(e){return this.wheelInfos[e].steering},t.prototype.setSteeringValue=function(e,t){this.wheelInfos[t].steering=e},t.prototype.applyEngineForce=function(e,t){this.wheelInfos[t].engineForce=e},t.prototype.setBrake=function(e,t){this.wheelInfos[t].brake=e},t.prototype.addToWorld=function(e){this.world=e},t.prototype.getVehicleAxisWorld=function(e,t){return t.set(0===e?1:0,1===e?1:0,2===e?1:0),_.Vector3.TransformCoordinatesToRef(t,_.Toolkit.HavokVehicleUtilities.bodyTransform(this.chassisBody,new _.Matrix),t),t},t.prototype.getCurrentSpeedKmHour=function(){return this.currentVehicleSpeedKmHour},t.prototype.updateVehicle=function(e){for(var t=this.wheelInfos,o=t.length,n=this.chassisBody,i=0;i<o;i++)this.updateWheelTransform(i);var l=_.Toolkit.HavokVehicleUtilities.bodyLinearVelocity(n,new _.Vector3),l=_.Vector3.TransformNormalToRef(l,_.Toolkit.HavokVehicleUtilities.bodyTransform(n,new _.Matrix).invert(),new _.Vector3);this.currentVehicleSpeedKmHour=3.6*l.z;for(i=0;i<o;i++)this.castRay(t[i]);for(var r=0,i=0;i<o;i++)(h=t[i]).raycastResult.body&&r++;0==r&&this.smoothFlyingImpulse,this.updateSuspension(e);for(var a=new _.Vector3,i=0;i<o;i++){var s=(h=t[i]).suspensionForce;s>h.maxSuspensionForce&&(s=h.maxSuspensionForce),a.copyFrom(h.raycastResult.hitNormalWorld).scaleInPlace(s*e),_.Toolkit.HavokVehicleUtilities.addImpulseAt(n,a,h.raycastResult.hitPointWorld)}this.updateFriction(e),0<this.stabilizingForce&&0<this.minimumWheelContacts&&this.minimumWheelContacts;var u=new _.Vector3,c=new _.Vector3,p=new _.Vector3;for(i=0;i<o;i++){var d,h=t[i],m=(_.Toolkit.HavokVehicleUtilities.velocityAt(n,h.chassisConnectionPointWorld,p),1);1===this.indexUpAxis&&(m=-1),h.isInContact&&(this.getVehicleAxisWorld(this.indexForwardAxis,c),d=_.Vector3.Dot(c,h.raycastResult.hitNormalWorld),u.copyFrom(h.raycastResult.hitNormalWorld).scaleInPlace(d),c.subtractToRef(u,c),d=_.Vector3.Dot(c,p),h.deltaRotation=m*d*e/h.radius),!h.sliding&&h.isInContact||0===h.engineForce||!h.useCustomSlidingRotationalSpeed||(h.deltaRotation=(0<h.engineForce?1:-1)*h.customSlidingRotationalSpeed*e),!0===h.locked&&(h.deltaRotation=0),h.rotation+=h.deltaRotation,h.deltaRotation*=.99}},t.prototype.updateSuspension=function(e){for(var t=this.chassisBody,o=_.Toolkit.HavokVehicleUtilities.bodyMass(t),n=this.wheelInfos,i=n.length,l=0;l<i;l++){var r,a,s=n[l];(!s.isInContact||(r=s.suspensionRestLength,a=s.suspensionLength,r=s.suspensionStiffness*(r-a)*s.clippedInvContactDotSuspension,r-=((a=s.suspensionRelativeVelocity)<0?s.dampingCompression:s.dampingRelaxation)*a,s.suspensionForce=r*o,s.suspensionForce<0))&&(s.suspensionForce=0)}},t.prototype.removeFromWorld=function(e){e.removeBody(this.chassisBody),this.world=null},t.prototype.castRay2=function(e){var t=_.Toolkit.HavokVehicleUtilities.castRay_rayvector,o=_.Toolkit.HavokVehicleUtilities.castRay_target,n=(this.updateWheelTransformWorld(e),this.chassisBody),i=-1,l=e.suspensionRestLength+e.radius,l=(e.directionWorld.scaleToRef(l,t),e.chassisConnectionPointWorld),t=(l.addToRef(t,o),e.raycastResult),o=(t.reset(),this.world.raycastToRef(l,o,t),t.body);return e.raycastResult.groundObject=0,o?(t.distance=_.Vector3.Distance(l,t.hitPointWorld),i=t.distance,e.isInContact=!0,o=t.distance,e.suspensionLength=o-e.radius,l=e.suspensionRestLength-e.maxSuspensionTravel,t=e.suspensionRestLength+e.maxSuspensionTravel,e.suspensionLength<l&&(e.suspensionLength=l),e.suspensionLength>t&&(e.suspensionLength=t,e.raycastResult.reset()),o=_.Vector3.Dot(e.raycastResult.hitNormalWorld,e.directionWorld),l=new _.Vector3,_.Toolkit.HavokVehicleUtilities.velocityAt(n,e.raycastResult.hitPointWorld,l),t=_.Vector3.Dot(e.raycastResult.hitNormalWorld,l),-.1<=o?(e.suspensionRelativeVelocity=0,e.clippedInvContactDotSuspension=10):(e.suspensionRelativeVelocity=t*(n=-1/o),e.clippedInvContactDotSuspension=n)):(e.suspensionLength=e.suspensionRestLength+0*e.maxSuspensionTravel,e.suspensionRelativeVelocity=0,e.directionWorld.scaleToRef(-1,e.raycastResult.hitNormalWorld),e.clippedInvContactDotSuspension=1),i},t.prototype.castRay=function(e){var t=_.Toolkit.HavokVehicleUtilities.castRay_rayvector,o=_.Toolkit.HavokVehicleUtilities.castRay_target,n=(this.updateWheelTransformWorld(e),this.chassisBody),i=-1,l=e.suspensionRestLength+e.radius,l=(t.copyFrom(e.directionWorld).scaleInPlace(l),e.chassisConnectionPointWorld),t=(o.copyFrom(l).addInPlace(t),e.raycastResult),o=(t.reset(),this.world.raycastToRef(l,o,t),t.body);return e.raycastResult.groundObject=0,o?(i=o=_.Vector3.Distance(l,t.hitPointWorld),e.raycastResult.hitNormalWorld.copyFrom(t.hitNormalWorld),e.isInContact=!0,e.suspensionLength=o-e.radius,l=e.suspensionRestLength-e.maxSuspensionTravel,t=e.suspensionRestLength+e.maxSuspensionTravel,e.suspensionLength<l&&(e.suspensionLength=l),e.suspensionLength>t&&(e.suspensionLength=t,e.raycastResult.reset()),o=_.Vector3.Dot(e.raycastResult.hitNormalWorld,e.directionWorld),l=new _.Vector3,_.Toolkit.HavokVehicleUtilities.velocityAt(n,e.raycastResult.hitPointWorld,l),t=_.Vector3.Dot(e.raycastResult.hitNormalWorld,l),-.1<=o?(e.suspensionRelativeVelocity=0,e.clippedInvContactDotSuspension=10):(e.suspensionRelativeVelocity=t*(n=-1/o),e.clippedInvContactDotSuspension=n)):(e.suspensionLength=e.suspensionRestLength+0*e.maxSuspensionTravel,e.suspensionRelativeVelocity=0,e.raycastResult.hitNormalWorld.copyFrom(e.directionWorld).scaleInPlace(-1),e.clippedInvContactDotSuspension=1),i},t.prototype.updateWheelTransformWorld=function(e){e.isInContact=!1;var t=this.chassisBody,t=_.Toolkit.HavokVehicleUtilities.bodyTransform(t,new _.Matrix);_.Vector3.TransformCoordinatesToRef(e.chassisConnectionPointLocal,t,e.chassisConnectionPointWorld),_.Vector3.TransformNormalToRef(e.directionLocal,t,e.directionWorld),_.Vector3.TransformNormalToRef(e.axleLocal,t,e.axleWorld)},t.prototype.updateWheelTransform=function(e){var t=_.Toolkit.HavokVehicleUtilities.tmpVec4,o=_.Toolkit.HavokVehicleUtilities.tmpVec5,n=_.Toolkit.HavokVehicleUtilities.tmpVec6,e=this.wheelInfos[e],n=(this.updateWheelTransformWorld(e),e.directionLocal.scaleToRef(-1,t),o.copyFrom(e.axleLocal),_.Vector3.CrossToRef(t,o,n),n.normalize(),o.normalize(),e.steering),i=new _.Quaternion,t=(_.Quaternion.RotationAxisToRef(t,n,i),new _.Quaternion),n=(_.Quaternion.RotationAxisToRef(o,e.rotation,t),e.worldTransform.rotationQuaternion),o=(_.Toolkit.HavokVehicleUtilities.bodyOrientation(this.chassisBody,new _.Quaternion).multiplyToRef(i,n),n.multiplyToRef(t,n),n.normalize(),e.worldTransform.position);o.copyFrom(e.directionWorld),o.scaleToRef(e.suspensionLength,o),o.addToRef(e.chassisConnectionPointWorld,o),e.worldTransform.computeWorldMatrix(!0)},t.prototype.getWheelTransformWorld=function(e){return this.wheelInfos[e].worldTransform},t.prototype.updateFriction=function(e){for(var t=_.Toolkit.HavokVehicleUtilities.updateFriction_surfNormalWS_scaled_proj,o=this.wheelInfos,n=o.length,i=this.chassisBody,l=_.Toolkit.HavokVehicleUtilities.updateFriction_forwardWS,r=_.Toolkit.HavokVehicleUtilities.updateFriction_axle,a=0;a<n;a++)m=(y=o[a]).raycastResult.body,y.sideImpulse=0,y.forwardImpulse=0,l[a]||(l[a]=new _.Vector3),r[a]||(r[a]=new _.Vector3);for(var s,u,c,a=0;a<n;a++)(m=(y=o[a]).raycastResult.body)&&(s=r[a],u=this.getWheelTransformWorld(a),_.Vector3.TransformNormalToRef(_.Toolkit.HavokVehicleUtilities.directions[this.indexRightAxis],u.getWorldMatrix(),s),u=y.raycastResult.hitNormalWorld,c=_.Vector3.Dot(s,u),u.scaleToRef(c,t),s.subtractToRef(t,s),s.normalize(),_.Vector3.CrossToRef(u,s,l[a]),l[a].normalize(),y.sideImpulse=_.Toolkit.HavokVehicleUtilities.resolveSingleBilateral(i,y.raycastResult.hitPointWorld,m,y.raycastResult.hitPointWorld,s),y.sideImpulse*=_.Toolkit.HavokVehicleUtilities.sideFrictionStiffness2);this.sliding=!1;for(a=0;a<n;a++){var p,d,h,m=(y=o[a]).raycastResult.body,g=0;y.slipInfo=1,m&&(h=y.brake||0,g=_.Toolkit.HavokVehicleUtilities.calcRollingFriction(i,m,y.raycastResult.hitPointWorld,l[a],h),h=h/(g+=y.engineForce*e),y.slipInfo*=h),y.forwardImpulse=0,y.skidInfo=1,m&&(y.skidInfo=1,d=(p=y.suspensionForce*e*y.frictionSlip)*p,y.forwardImpulse=g,g=(g=.5*y.forwardImpulse)*g+(g=+y.sideImpulse)*g,y.sliding=!1,d<g)&&(this.sliding=!0,y.sliding=!0,h=p/Math.sqrt(g),y.skidInfo*=h)}if(this.sliding)for(a=0;a<n;a++)0!==(y=o[a]).sideImpulse&&y.skidInfo<1&&(y.forwardImpulse*=y.skidInfo,y.sideImpulse*=y.skidInfo);for(a=0;a<n;a++){var T,f,y=o[a],k=new _.Vector3;y.raycastResult.hitPointWorld.subtractToRef(_.Toolkit.HavokVehicleUtilities.bodyPosition(i,new _.Vector3),k),0!==y.forwardImpulse&&((T=new _.Vector3).copyFrom(l[a]).scaleInPlace(y.forwardImpulse),_.Toolkit.HavokVehicleUtilities.addImpulseAt(i,T,y.raycastResult.hitPointWorld)),0!==y.sideImpulse&&(m=y.raycastResult.body,T=new _.Vector3,y.raycastResult.hitPointWorld.subtractToRef(_.Toolkit.HavokVehicleUtilities.bodyPosition(m,new _.Vector3),T),(f=new _.Vector3).copyFrom(r[a]).scaleInPlace(y.sideImpulse),_.Vector3.TransformNormalToRef(k,_.Toolkit.HavokVehicleUtilities.bodyTransform(i,new _.Matrix).invert(),k),k["xyz"[this.indexUpAxis]]*=y.rollInfluence,_.Vector3.TransformNormalToRef(k,_.Toolkit.HavokVehicleUtilities.bodyTransform(i,new _.Matrix),k),_.Toolkit.HavokVehicleUtilities.addImpulseAt(i,f,_.Toolkit.HavokVehicleUtilities.bodyPosition(i,new _.Vector3).add(k)),f.scaleToRef(-1,f),_.Toolkit.HavokVehicleUtilities.addImpulseAt(m,f,y.raycastResult.hitPointWorld))}},e.HavokRaycastVehicle=t,o.prototype.updateWheel=function(e){var t,o=this.raycastResult;this.isInContact?(t=_.Vector3.Dot(o.hitNormalWorld,this.raycastResult.directionWorld),o.hitPointWorld.subtractToRef(_.Toolkit.HavokVehicleUtilities.bodyPosition(e,new _.Vector3),_.Toolkit.HavokVehicleUtilities.relpos),_.Toolkit.HavokVehicleUtilities.velocityAt(e,_.Toolkit.HavokVehicleUtilities.relpos,_.Toolkit.HavokVehicleUtilities.chassis_velocity_at_contactPoint),e=_.Vector3.Dot(o.hitNormalWorld,_.Toolkit.HavokVehicleUtilities.chassis_velocity_at_contactPoint),-.1<=t?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(this.suspensionRelativeVelocity=e*(e=-1/t),this.clippedInvContactDotSuspension=e)):(this.raycastResult.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,o.hitNormalWorld.copyFrom(this.raycastResult.directionWorld).scaleInPlace(-1),this.clippedInvContactDotSuspension=1)},e.HavokWheelInfo=o,n.calcRollingFriction=function(e,t,o,n,i){var l=0,r=o,a=_.Toolkit.HavokVehicleUtilities.calcRollingFriction_vel1,s=_.Toolkit.HavokVehicleUtilities.calcRollingFriction_vel2,u=_.Toolkit.HavokVehicleUtilities.calcRollingFriction_vel;_.Toolkit.HavokVehicleUtilities.velocityAt(e,r,a),_.Toolkit.HavokVehicleUtilities.velocityAt(t,r,s),a.subtractToRef(s,u);return l=(l=i<(l=-_.Vector3.Dot(n,u)*(1/(_.Toolkit.HavokVehicleUtilities.computeImpulseDenominator(e,o,n)+_.Toolkit.HavokVehicleUtilities.computeImpulseDenominator(t,o,n))))?i:l)<-i?-i:l},n.computeImpulseDenominator=function(e,t,o){var n=_.Toolkit.HavokVehicleUtilities.computeImpulseDenominator_r0,i=_.Toolkit.HavokVehicleUtilities.computeImpulseDenominator_c0,l=_.Toolkit.HavokVehicleUtilities.computeImpulseDenominator_vec,r=_.Toolkit.HavokVehicleUtilities.computeImpulseDenominator_m;return t.subtractToRef(_.Toolkit.HavokVehicleUtilities.bodyPosition(e,new _.Vector3),n).normalize(),_.Vector3.CrossToRef(n,o,i),_.Toolkit.HavokVehicleUtilities.bodyInertiaWorld(e,new _.Vector3).multiplyToRef(i,r),_.Vector3.CrossToRef(r,n,l),_.Toolkit.HavokVehicleUtilities.bodyInvMass(e)+_.Vector3.Dot(o,l)},n.resolveSingleBilateral=function(e,t,o,n,i){if(1.1<i.lengthSquared())return 0;var l=_.Toolkit.HavokVehicleUtilities.resolveSingleBilateral_vel1,r=_.Toolkit.HavokVehicleUtilities.resolveSingleBilateral_vel2,a=_.Toolkit.HavokVehicleUtilities.resolveSingleBilateral_vel;_.Toolkit.HavokVehicleUtilities.velocityAt(e,t,l),_.Toolkit.HavokVehicleUtilities.velocityAt(o,n,r),l.subtractToRef(r,a);return-.1*_.Vector3.Dot(i,a)*(1/(_.Toolkit.HavokVehicleUtilities.bodyInvMass(e)+_.Toolkit.HavokVehicleUtilities.bodyInvMass(o)))},n.directions=[new _.Vector3(1,0,0),new _.Vector3(0,1,0),new _.Vector3(0,0,1)],n.calcRollingFriction_vel1=new _.Vector3,n.calcRollingFriction_vel2=new _.Vector3,n.calcRollingFriction_vel=new _.Vector3,n.updateFriction_surfNormalWS_scaled_proj=new _.Vector3,n.updateFriction_axle=[],n.updateFriction_forwardWS=[],n.sideFrictionStiffness2=1,n.castRay_rayvector=new _.Vector3,n.castRay_target=new _.Vector3,n.torque=new _.Vector3,n.tmpVec1=new _.Vector3,n.tmpVec2=new _.Vector3,n.tmpVec3=new _.Vector3,n.tmpVec4=new _.Vector3,n.tmpVec5=new _.Vector3,n.tmpVec6=new _.Vector3,n.tmpVel2=new _.Vector3,n.tmpMat1=new _.Matrix,n.velocityAt=function(e,t,o){return e.getObjectCenterWorldToRef(_.Toolkit.HavokVehicleUtilities.tmpVel2),t.subtractToRef(_.Toolkit.HavokVehicleUtilities.tmpVel2,o),e.getAngularVelocityToRef(_.Toolkit.HavokVehicleUtilities.tmpVel2),_.Vector3.CrossToRef(_.Toolkit.HavokVehicleUtilities.tmpVel2,o,o),e.getLinearVelocityToRef(_.Toolkit.HavokVehicleUtilities.tmpVel2),o.addInPlace(_.Toolkit.HavokVehicleUtilities.tmpVel2),o},n.bodyPosition=function(e,t){return e.getObjectCenterWorldToRef(t),t},n.bodyLinearVelocity=function(e,t){return e.getLinearVelocityToRef(t),t},n.bodyAngularVelocity=function(e,t){return e.getAngularVelocityToRef(t),t},n.bodyTransform=function(e,t){return t.copyFrom(e.transformNode.getWorldMatrix()),t},n.addImpulseAt=function(e,t,o){e.applyImpulse(t,o)},n.addForceAt=function(e,t,o){e.applyForce(t,o)},n.bodyOrientation=function(e,t){return t.copyFrom(e.transformNode.rotationQuaternion),t},n.bodyMass=function(e){return e.getMassProperties().mass},n.bodyInvMass=function(e){e=e.getMassProperties().mass;return 0<e?1/e:0},n.bodyInertiaWorld=function(e,t){var o=e.getMassProperties();return t.copyFrom(o.inertia),_.Vector3.TransformNormalToRef(t,e.transformNode.getWorldMatrix(),t),t.x=0<t.x?1/t.x:0,t.y=0<t.y?1/t.y:0,t.z=0<t.z?1/t.z:0,t},n.computeImpulseDenominator_r0=new _.Vector3,n.computeImpulseDenominator_c0=new _.Vector3,n.computeImpulseDenominator_vec=new _.Vector3,n.computeImpulseDenominator_m=new _.Vector3,n.bodyPositionVec=new _.Vector3,n.bodyInertiaVec=new _.Vector3,n.resolveSingleBilateral_vel1=new _.Vector3,n.resolveSingleBilateral_vel2=new _.Vector3,n.resolveSingleBilateral_vel=new _.Vector3,n.chassis_velocity_at_contactPoint=new _.Vector3,n.relpos=new _.Vector3,n.Utilsdefaults=function(e,t){for(var o in e=e||{},t)o in e||(e[o]=t[o]);return e},e.HavokVehicleUtilities=n}(BABYLON=BABYLON||{}),this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}()),__extends=(!function(i){var e,t,o;function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.distanceToTarget=0,e.teleporting=!1,e.moveDirection=new i.Vector3(0,0,0),e.resetPosition=new i.Vector3(0,0,0),e.lastPosition=new i.Vector3(0,0,0),e.distancePosition=new i.Vector3(0,0,0),e.currentPosition=new i.Vector3(0,0,0),e.currentRotation=new i.Quaternion(0,0,0,1),e.currentVelocity=new i.Vector3(0,0,0),e.currentWaypoint=new i.Vector3(0,0,0),e.heightOffset=0,e.angularSpeed=0,e.updatePosition=!0,e.updateRotation=!0,e.distanceEpsilon=.1,e.velocityEpsilon=1.1,e.offMeshVelocity=1.5,e.stoppingDistance=0,e.onReadyObservable=new i.Observable,e.onPreUpdateObservable=new i.Observable,e.onPostUpdateObservable=new i.Observable,e.onNavCompleteObservable=new i.Observable,e.m_agentState=0,e.m_agentIndex=-1,e.m_agentReady=!1,e.m_agentGhost=null,e.m_agentParams=null,e.m_agentMovement=new i.Vector3(0,0,0),e.m_agentDirection=new i.Vector3(0,0,1),e.m_agentQuaternion=new i.Quaternion(0,0,0,1),e.m_agentDestination=null,e}e=i.Toolkit||(i.Toolkit={}),t=i.Toolkit.ScriptComponent,__extends(n,t),n.prototype.isReady=function(){return this.m_agentReady},n.prototype.isNavigating=function(){return null!=this.m_agentDestination},n.prototype.isTeleporting=function(){return this.teleporting},n.prototype.isOnOffMeshLink=function(){return this.m_agentState===i.Toolkit.CrowdAgentState.DT_CROWDAGENT_STATE_OFFMESH},n.prototype.getAgentType=function(){return this.type},n.prototype.getAgentState=function(){return this.m_agentState},n.prototype.getAgentIndex=function(){return this.m_agentIndex},n.prototype.getAgentOffset=function(){return this.baseOffset},n.prototype.getTargetDistance=function(){return this.distanceToTarget},n.prototype.getCurrentPosition=function(){return this.currentPosition},n.prototype.getCurrentRotation=function(){return this.currentRotation},n.prototype.getCurrentVelocity=function(){return this.currentVelocity},n.prototype.getAgentParameters=function(){return this.m_agentParams},n.prototype.setAgentParameters=function(e){this.m_agentParams=e,this.updateAgentParameters()},n.prototype.awake=function(){this.awakeNavigationAgent()},n.prototype.update=function(){this.updateNavigationAgent()},n.prototype.destroy=function(){this.destroyNavigationAgent()},n.prototype.awakeNavigationAgent=function(){this.type=this.getProperty("type",this.type),this.speed=this.getProperty("speed",this.speed),this.baseOffset=this.getProperty("offset",this.baseOffset),this.angularSpeed=this.getProperty("angularspeed",this.angularSpeed),this.acceleration=this.getProperty("acceleration",this.acceleration),this.stoppingDistance=this.getProperty("stoppingdistance",this.stoppingDistance),this.autoBraking=this.getProperty("autobraking",this.autoBraking),this.avoidRadius=this.getProperty("avoidradius",this.avoidRadius),this.avoidHeight=this.getProperty("avoidheight",this.avoidHeight),this.obstacleAvoidanceType=this.getProperty("avoidquality",this.obstacleAvoidanceType),this.avoidancePriority=this.getProperty("avoidpriority",this.avoidancePriority),this.autoTraverseOffMeshLink=this.getProperty("autotraverse",this.autoTraverseOffMeshLink),this.autoRepath=this.getProperty("autopepath",this.autoRepath),this.areaMask=this.getProperty("areamask",this.areaMask),i.Toolkit.Utilities.ValidateTransformQuaternion(this.transform),this.m_agentGhost=new i.TransformNode(this.transform.name+".Agent",this.scene),this.m_agentGhost.position=new i.Vector3(0,0,0),this.m_agentGhost.rotation=new i.Vector3(0,0,0),i.Toolkit.Utilities.ValidateTransformQuaternion(this.m_agentGhost),this.m_agentGhost.position.copyFrom(this.transform.position),this.lastPosition.copyFrom(this.transform.position)},n.prototype.updateNavigationAgent=function(){var e,t=i.Toolkit.SceneManager.GetCrowdInterface(this.scene);null!=t&&(this.m_agentIndex<0?(this.m_agentParams={radius:this.avoidRadius,height:this.avoidHeight,maxSpeed:this.speed,maxAcceleration:this.acceleration,collisionQueryRange:2,pathOptimizationRange:20,separationWeight:1},i.Toolkit.Utilities.GetAbsolutePositionToRef(this.transform,this.resetPosition),this.m_agentIndex=t.addAgent(this.resetPosition,this.m_agentParams,this.m_agentGhost),0<=this.m_agentIndex&&(this.m_agentReady=!0,this.onReadyObservable)&&this.onReadyObservable.hasObservers()&&this.onReadyObservable.notifyObservers(this.transform)):(this.m_agentState=t.getAgentState(this.m_agentIndex),this.getAgentWaypointToRef(this.currentWaypoint),this.getAgentPositionToRef(this.currentPosition),this.distancePosition.copyFrom(this.currentPosition),this.isOnOffMeshLink()?(this.currentPosition.subtractToRef(this.lastPosition,this.currentVelocity),this.currentVelocity.scaleInPlace(this.speed*this.offMeshVelocity)):this.getAgentVelocityToRef(this.currentVelocity),this.onPreUpdateObservable&&this.onPreUpdateObservable.hasObservers()&&this.onPreUpdateObservable.notifyObservers(this.transform),this.currentPosition.y+=this.baseOffset+this.heightOffset,this.currentVelocity.length()>=this.velocityEpsilon&&(this.currentVelocity.normalize(),t=this.angularSpeed*i.Toolkit.NavigationAgent.ANGULAR_SPEED_RATIO*this.getDeltaSeconds(),this.isOnOffMeshLink()?(this.moveDirection.copyFrom(this.m_agentDirection),this.m_agentDirection.set(this.moveDirection.x+(this.currentVelocity.x-this.moveDirection.x),this.moveDirection.y+(this.currentVelocity.y-this.moveDirection.y),this.moveDirection.z+(this.currentVelocity.z-this.moveDirection.z)),this.m_agentDirection.normalize(),e=i.Toolkit.NavigationAgent.TARGET_ANGLE_FACTOR-Math.atan2(this.m_agentDirection.x,this.m_agentDirection.z),i.Quaternion.FromEulerAnglesToRef(0,e,0,this.currentRotation),this.isNavigating()&&!0===this.updateRotation&&i.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.currentRotation,t,this.transform.rotationQuaternion)):(this.m_agentQuaternion.copyFrom(this.transform.rotationQuaternion),this.isNavigating()&&!0===this.updateRotation&&this.transform.lookAt(this.currentWaypoint),this.transform.rotationQuaternion.toEulerAnglesToRef(this.m_agentDirection),i.Quaternion.FromEulerAnglesToRef(0,this.m_agentDirection.y,0,this.currentRotation),this.isNavigating()&&!0===this.updateRotation&&i.Quaternion.SlerpToRef(this.m_agentQuaternion,this.currentRotation,t,this.transform.rotationQuaternion))),this.isNavigating()&&!0===this.updatePosition&&this.transform.position.copyFrom(this.currentPosition),this.isNavigating()?(this.distanceToTarget=i.Vector3.Distance(this.distancePosition,this.m_agentDestination),this.distanceToTarget<=Math.max(this.distanceEpsilon,this.stoppingDistance)&&(this.cancelNavigation(),this.onNavCompleteObservable)&&this.onNavCompleteObservable.hasObservers()&&this.onNavCompleteObservable.notifyObservers(this.transform)):this.distanceToTarget=0,this.lastPosition.copyFrom(this.currentPosition),this.onPostUpdateObservable&&this.onPostUpdateObservable.hasObservers()&&this.onPostUpdateObservable.notifyObservers(this.transform),this.teleporting=!1))},n.prototype.updateAgentParameters=function(){var e=i.Toolkit.SceneManager.GetCrowdInterface(this.scene);null!=e&&0<=this.m_agentIndex&&e.updateAgentParameters(this.m_agentIndex,this.m_agentParams)},n.prototype.destroyNavigationAgent=function(){this.m_agentIndex=-1,this.m_agentReady=!1,this.m_agentMovement=null,this.m_agentDirection=null,this.m_agentDestination=null,this.moveDirection=null,this.resetPosition=null,this.lastPosition=null,this.currentPosition=null,this.currentRotation=null,this.currentVelocity=null,this.currentWaypoint=null,this.onReadyObservable.clear(),this.onReadyObservable=null,this.onPreUpdateObservable.clear(),this.onPreUpdateObservable=null,this.onPostUpdateObservable.clear(),this.onPostUpdateObservable=null,this.onNavCompleteObservable.clear(),(this.onNavCompleteObservable=null)!=this.m_agentGhost&&(this.m_agentGhost.dispose(),this.m_agentGhost=null)},n.prototype.move=function(e,t){void 0===t&&(t=!0);var o=i.Toolkit.SceneManager.GetNavigationTools(),n=i.Toolkit.SceneManager.GetCrowdInterface(this.scene);null!=o&&null!=n?(n.getAgentPosition(this.m_agentIndex).addToRef(e,this.m_agentMovement),this.m_agentDestination=!0===t?o.getClosestPoint(this.m_agentMovement):this.m_agentMovement.clone(),0<=this.m_agentIndex&&n.agentGoto(this.m_agentIndex,this.m_agentDestination)):i.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.teleport=function(e,t){void 0===t&&(t=!0);var o=i.Toolkit.SceneManager.GetNavigationTools(),n=i.Toolkit.SceneManager.GetCrowdInterface(this.scene);null!=o&&null!=n?(this.teleporting=!0,this.m_agentDestination=!0===t?o.getClosestPoint(e):e.clone(),0<=this.m_agentIndex&&n.agentTeleport(this.m_agentIndex,this.m_agentDestination)):i.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.setDestination=function(e,t){void 0===t&&(t=!0);var o=i.Toolkit.SceneManager.GetNavigationTools(),n=i.Toolkit.SceneManager.GetCrowdInterface(this.scene);null!=o&&null!=n?(this.m_agentDestination=!0===t?o.getClosestPoint(e):e.clone(),0<=this.m_agentIndex&&n.agentGoto(this.m_agentIndex,this.m_agentDestination)):i.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.getAgentVelocity=function(){var e=i.Toolkit.SceneManager.GetCrowdInterface(this.scene);return null!=e&&0<=this.m_agentIndex?e.getAgentVelocity(this.m_agentIndex):null},n.prototype.getAgentVelocityToRef=function(e){var t=i.Toolkit.SceneManager.GetCrowdInterface(this.scene);null!=t&&0<=this.m_agentIndex&&t.getAgentVelocityToRef(this.m_agentIndex,e)},n.prototype.getAgentPosition=function(){var e=i.Toolkit.SceneManager.GetCrowdInterface(this.scene);return null!=e&&0<=this.m_agentIndex?e.getAgentPosition(this.m_agentIndex):null},n.prototype.getAgentPositionToRef=function(e){var t=i.Toolkit.SceneManager.GetCrowdInterface(this.scene);null!=t&&0<=this.m_agentIndex&&t.getAgentPositionToRef(this.m_agentIndex,e)},n.prototype.getAgentWaypoint=function(){var e=i.Toolkit.SceneManager.GetCrowdInterface(this.scene);return null!=e&&0<=this.m_agentIndex?e.getAgentNextTargetPath(this.m_agentIndex):null},n.prototype.getAgentWaypointToRef=function(e){var t=i.Toolkit.SceneManager.GetCrowdInterface(this.scene);null!=t&&0<=this.m_agentIndex&&t.getAgentNextTargetPathToRef(this.m_agentIndex,e)},n.prototype.cancelNavigation=function(){this.m_agentDestination=null;var e=i.Toolkit.SceneManager.GetCrowdInterface(this.scene),t=this.getAgentPosition();null!=t&&null!=e&&0<=this.m_agentIndex&&e.agentTeleport(this.m_agentIndex,t)},n.TARGET_ANGLE_FACTOR=.5*Math.PI,n.ANGULAR_SPEED_RATIO=.05,o=n,e.NavigationAgent=o,(o=e.CrowdAgentState||(e.CrowdAgentState={}))[o.DT_CROWDAGENT_STATE_INVALID=0]="DT_CROWDAGENT_STATE_INVALID",o[o.DT_CROWDAGENT_STATE_WALKING=1]="DT_CROWDAGENT_STATE_WALKING",o[o.DT_CROWDAGENT_STATE_OFFMESH=2]="DT_CROWDAGENT_STATE_OFFMESH"}(BABYLON=BABYLON||{}),!function(f){var e;function t(e,t,o){this._centerMass=new f.Vector3(0,0,0),this._chassisMesh=null,this._tempVectorPos=new f.Vector3(0,0,0),this.lockedWheelIndexes=null,this.m_vehicleColliders=null,this.m_vehicle=null,this.m_scene=null,this._chassisMesh=t,this._centerMass=o,this.m_vehicleColliders=null!=this._chassisMesh.metadata&&null!=this._chassisMesh.metadata.toolkit&&null!=this._chassisMesh.metadata.toolkit.wheels?this._chassisMesh.metadata.toolkit.wheels:null,this.m_vehicle=new f.Toolkit.HavokRaycastVehicle({chassisBody:this._chassisMesh.physicsBody}),this.m_scene=e,this.setupWheelInformation();t=this.m_scene.getPhysicsEngine();null!=t&&this.m_vehicle.addToWorld(t)}e=f.Toolkit||(f.Toolkit={}),t.prototype.getNumWheels=function(){if(null!=this.m_vehicle)return this.m_vehicle.getNumWheels()},t.prototype.getWheelInfo=function(e){if(null!=this.m_vehicle)return this.m_vehicle.getWheelInfo(e)},t.prototype.setEngineForce=function(e,t){null!=this.m_vehicle&&this.m_vehicle.applyEngineForce(-e,t)},t.prototype.setBrakingForce=function(e,t){null!=this.m_vehicle&&this.m_vehicle.setBrake(e,t)},t.prototype.getWheelTransform=function(e){if(null!=this.m_vehicle)return this.m_vehicle.getWheelTransformWorld(e)},t.prototype.updateWheelTransform=function(e){null!=this.m_vehicle&&this.m_vehicle.updateWheelTransform(e)},t.prototype.getRawCurrentSpeedKph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()},t.prototype.getRawCurrentSpeedMph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()*f.Toolkit.System.Kph2Mph},t.prototype.getAbsCurrentSpeedKph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())},t.prototype.getAbsCurrentSpeedMph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())*f.Toolkit.System.Kph2Mph},t.prototype.dispose=function(){this.deleteWheelInformation(),this.m_vehicleColliders=null},t.prototype.getWheelIndexByID=function(e){var t=-1;if(null!=this.m_vehicleColliders&&0<this.m_vehicleColliders.length)for(var o=0;o<this.m_vehicleColliders.length;o++){var n=this.m_vehicleColliders[o];if(e.toLowerCase()===n.id.toLowerCase()){t=o;break}}return t},t.prototype.getWheelIndexByName=function(e){var t=-1;if(null!=this.m_vehicleColliders&&0<this.m_vehicleColliders.length)for(var o=0;o<this.m_vehicleColliders.length;o++){var n=this.m_vehicleColliders[o];if(e.toLowerCase()===n.name.toLowerCase()){t=o;break}}return t},t.prototype.getWheelColliderInfo=function(e){var t=-1;return t=null!=this.m_vehicleColliders&&0<this.m_vehicleColliders.length&&this.m_vehicleColliders.length>e?this.m_vehicleColliders[e]:t},t.prototype.getVisualSteeringAngle=function(e){var t=0,e=this.getWheelInfo(e);return t=null!=e&&null!=e.steeringAngle?e.steeringAngle:t},t.prototype.setVisualSteeringAngle=function(e,t){t=this.getWheelInfo(t);null!=t&&(t.steeringAngle=e)},t.prototype.getPhysicsSteeringAngle=function(e){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getSteeringValue(e))},t.prototype.setPhysicsSteeringAngle=function(e,t){null!=this.m_vehicle&&this.m_vehicle.setSteeringValue(e,t)},t.prototype.getStabilizingForce=function(){var e=-1;return e=null!=this.m_vehicle&&null!=this.m_vehicle.chassisBody?this.m_vehicle.stabilizingForce:e},t.prototype.setStabilizingForce=function(e){null!=this.m_vehicle&&null!=this.m_vehicle.chassisBody&&(this.m_vehicle.stabilizingForce=e)},t.prototype.getSmoothFlyingImpulse=function(){var e=-1;return e=null!=this.m_vehicle?this.m_vehicle.smoothFlyingImpulse:e},t.prototype.setSmoothFlyingImpulse=function(e){null!=this.m_vehicle&&(this.m_vehicle.smoothFlyingImpulse=e)},t.prototype.setupWheelInformation=function(){if(null!=this.m_vehicle&&null!=this.m_vehicleColliders&&0<this.m_vehicleColliders.length)for(var e=-1,e=0;e<this.m_vehicleColliders.length;e++){var t=this.m_vehicleColliders[e],o=null!=t.name?t.name:"Unknown",n=null!=t.radius?t.radius:.35,i=null!=t.position&&3<=t.position.length?t.position[0]:1,l=null!=t.position&&3<=t.position.length?t.position[2]:-1,r=null!=t.wheelconnectionpoint?t.wheelconnectionpoint:.5,a=null!=t.suspensionrestlength?t.suspensionrestlength:.3,o=null!=t.frontwheel||0<=o.toLowerCase().indexOf("front"),s=-this._centerMass.x,u=-this._centerMass.z,c=null!=t.frictionslip?t.frictionslip:10,p=null!=t.totalsuspensionforces?t.totalsuspensionforces:1e5,d=null!=t.suspensiontravelcm?t.suspensiontravelcm:100,h=null!=t.rollinfluence?t.rollinfluence:.2,m=null!=t.suspensionstiffness?t.suspensionstiffness:50,g=null!=t.dampingcompression?t.dampingcompression:2.5,T=null!=t.dampingrelaxation?t.dampingrelaxation:4.5,i=new f.Vector3(i+s,r,l+u),s=null!=t.maxVisualTravelRange?t.maxVisualTravelRange:0,r=null!=t.invertWheelDirection&&t.invertWheelDirection;this.m_vehicle.addWheel({radius:n,isFrontWheel:o,directionLocal:new f.Vector3(0,-1,0),suspensionStiffness:m,suspensionRestLength:a,frictionSlip:c,dampingRelaxation:T,dampingCompression:g,maxSuspensionForce:p,rollInfluence:h,axleLocal:new f.Vector3(-1,0,0),chassisConnectionPointLocal:i,maxSuspensionTravel:d,steeringAngle:0,rotationBoost:0,defaultFriction:c,invertDirection:r,visualTravelRange:s})}},t.prototype.tickVehicleController=function(e){null!=this.m_vehicle&&this.m_vehicle.updateVehicle(e)},t.prototype.updateWheelInformation=function(){var e=this.m_vehicle.getCurrentSpeedKmHour(),t=this.getNumWheels();if(0<t)for(var o=0;o<t;o++){var n,i,l,r=this.getWheelInfo(o);null!=r&&(r.locked=this.lockedWheelInformation(o),this.updateWheelTransform(o),null!=(n=this.getWheelTransform(o))&&this._tempVectorPos.copyFrom(n.position),null!=r.hub)&&null!=(n=r.hub).parent&&(f.Toolkit.Utilities.InverseTransformPointToRef(n.parent,this._tempVectorPos,this._tempVectorPos),n.position.y=this._tempVectorPos.y,0<r.visualTravelRange&&(n.position.y=f.Scalar.Clamp(n.position.y,-Math.abs(r.visualTravelRange),Math.abs(r.visualTravelRange))),l=null!=r.steeringAngle?r.steeringAngle:0,f.Quaternion.FromEulerAnglesToRef(0,l,0,n.rotationQuaternion),null!=r.spinner)&&!1===r.locked&&(l=this.m_scene.getEngine().getDeltaTime()/1e3,n=2*Math.PI*r.radius,i=null!=r.rotationBoost?r.rotationBoost:0,l=f.Tools.ToRadians(e*l/n*360)+i*Math.sign(e),!0===r.invertDirection?r.spinner.addRotation(-l,0,0):r.spinner.addRotation(l,0,0))}},t.prototype.lockedWheelInformation=function(e){var t=!1;if(null!=this.lockedWheelIndexes&&0<this.lockedWheelIndexes.length)for(var o=0;o<this.lockedWheelIndexes.length;o++)if(this.lockedWheelIndexes[o]===e){t=!0;break}return t},t.prototype.deleteWheelInformation=function(){var e=this.getNumWheels();if(0<e)for(var t=0;t<e;t++){var o=this.getWheelInfo(t);null!=o&&(o.hub=null,o.spinner=null,o.steeringAngle=0,o.rotationBoost=0,o.defaultFriction=0)}},e.RaycastVehicle=t}(BABYLON=BABYLON||{}),this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}()),__awaiter=this&&this.__awaiter||function(e,r,a,s){return new(a=a||Promise)(function(o,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function i(e){try{l(s.throw(e))}catch(e){t(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,i)}l((s=s.apply(e,r||[])).next())})},__generator=this&&this.__generator||function(n,i){var l,r,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},u={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function e(o){return function(e){var t=[o,e];if(l)throw new TypeError("Generator is already executing.");for(;s=u&&t[u=0]?0:s;)try{if(l=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3]))s.label=t[1];else if(6===t[0]&&s.label<a[1])s.label=a[1],a=t;else{if(!(a&&s.label<a[2])){a[2]&&s.ops.pop(),s.trys.pop();continue}s.label=a[2],s.ops.push(t)}}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__extends=(!function(N){var e,t;function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._isKinematic=!1,e._centerOfMass=new N.Vector3(0,0,0),e.m_raycastVehicle=null,e}e=N.Toolkit||(N.Toolkit={}),t=N.Toolkit.ScriptComponent,__extends(o,t),o.prototype.awake=function(){this.awakeRigidbodyState()},o.prototype.update=function(){this.updateRigidbodyState()},o.prototype.late=function(){this.lateRigidbodyState()},o.prototype.destroy=function(){this.destroyRigidbodyState()},o.prototype.awakeRigidbodyState=function(){this._isKinematic=this.getProperty("isKinematic",this._isKinematic),null!=this.transform.metadata&&null!=this.transform.metadata.toolkit&&null!=this.transform.metadata.toolkit.physics&&(this._centerOfMass=null!=this.transform.metadata.toolkit.physics.center?N.Toolkit.Utilities.ParseVector3(this.transform.metadata.toolkit.physics.center,this._centerOfMass):this._centerOfMass),this.hasWheelColliders()&&(this.m_raycastVehicle=new N.Toolkit.RaycastVehicle(this.scene,this.transform,this._centerOfMass),N.Toolkit.Utilities.ShowDebugColliders())&&console.log("Raycase Vehicle Created For: "+this.transform.name)},o.prototype.updateRigidbodyState=function(){null!=this.m_raycastVehicle&&this.m_raycastVehicle.updateWheelInformation()},o.prototype.lateRigidbodyState=function(){null!=this.m_raycastVehicle&&this.m_raycastVehicle.tickVehicleController(N.Toolkit.RigidbodyPhysics.PHYSICS_STEP_TIME)},o.prototype.destroyRigidbodyState=function(){null!=this.m_raycastVehicle&&(this.m_raycastVehicle.dispose(),this.m_raycastVehicle=null)},o.prototype.isKinematic=function(){return this._isKinematic},o.prototype.hasWheelColliders=function(){return null!=this.transform.metadata&&null!=this.transform.metadata.toolkit&&null!=this.transform.metadata.toolkit.wheels},o.prototype.getRaycastVehicle=function(){return this.m_raycastVehicle},o.GetHavokInstance=function(){return globalThis.HK},o.GetHavokPlugin=function(){return globalThis.HKP},o.Raycast=function(e,t,o,n){return null==N.Toolkit.RigidbodyPhysics.RaycastResult&&(N.Toolkit.RigidbodyPhysics.RaycastResult=new N.PhysicsRaycastResult),null==N.Toolkit.RigidbodyPhysics.RaycastDestination&&(N.Toolkit.RigidbodyPhysics.RaycastDestination=new N.Vector3(0,0,0)),N.Toolkit.RigidbodyPhysics.RaycastResult.reset(),N.Toolkit.RigidbodyPhysics.RaycastDestination.set(0,0,0),N.Toolkit.Utilities.CalculateDestinationPointToRef(e,t,o,N.Toolkit.RigidbodyPhysics.RaycastDestination),N.Toolkit.RigidbodyPhysics.RaycastToRef(e,N.Toolkit.RigidbodyPhysics.RaycastDestination,N.Toolkit.RigidbodyPhysics.RaycastResult,n),N.Toolkit.RigidbodyPhysics.RaycastResult},o.Shapecast=function(e){return null==N.Toolkit.RigidbodyPhysics.LocalShapeResult&&(N.Toolkit.RigidbodyPhysics.LocalShapeResult=new N.ShapeCastResult),null==N.Toolkit.RigidbodyPhysics.WorldShapeResult&&(N.Toolkit.RigidbodyPhysics.WorldShapeResult=new N.ShapeCastResult),N.Toolkit.RigidbodyPhysics.LocalShapeResult.reset(),N.Toolkit.RigidbodyPhysics.WorldShapeResult.reset(),N.Toolkit.RigidbodyPhysics.ShapecastToRef(e,N.Toolkit.RigidbodyPhysics.LocalShapeResult,N.Toolkit.RigidbodyPhysics.WorldShapeResult),{local:N.Toolkit.RigidbodyPhysics.LocalShapeResult,world:N.Toolkit.RigidbodyPhysics.WorldShapeResult}},o.RaycastToRef=function(e,t,o,n){var i=N.Toolkit.RigidbodyPhysics.GetHavokPlugin();i?i.raycast(e,t,o,n):N.Tools.Warn("Havok.js physics library not loaded")},o.ShapecastToRef=function(e,t,o){var n=N.Toolkit.RigidbodyPhysics.GetHavokPlugin();n?n.shapeCast(e,t,o):N.Tools.Warn("Havok.js physics library not loaded")},o.SetMaxVelocities=function(e,t){var o,n=N.Toolkit.RigidbodyPhysics.GetHavokPlugin();n?(o=n._hknp.HEAP8.buffer,n=new Int32Array(o,Number(n.world),100),n=new Int32Array(o,n[8],500),n=new Int32Array(o,n[428],100),(o=new Float32Array(o,n[8],300))[32]=e,o[33]=t,o[60]=e,o[61]=t,o[88]=e,o[89]=t,o[144]=e,o[145]=t,o[172]=e,o[173]=t,o[200]=e,o[201]=t,o[228]=e):N.Tools.Warn("Havok.js physics library not loaded")},o.ConfigurePhysicsEngine=function(e){return __awaiter(this,arguments,void 0,function(t,o,n,e,i,l,r){var a,s,u,c,p;return void 0===o&&(o=!0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===i&&(i=!0),void 0===l&&(l=1e-4),void 0===r&&(r=null),__generator(this,function(e){switch(e.label){case 0:if(!N.HavokPlugin)return[3,8];N.Tools.Log("Havok.js physics engine initializing..."),e.label=1;case 1:return(e.trys.push([1,6,7,8]),t.isPhysicsEnabled())?[3,4]:null!=(a=N.Toolkit.RigidbodyPhysics.GetHavokInstance())?[3,3]:(s=globalThis,[4,N.HavokPhysics()]);case 2:s.HK=e.sent(),a=globalThis.HK,e.label=3;case 3:return u=new N.Vector3(0,-9.81,0),u=null!=r?r:u,globalThis.HKP=new N.HavokPlugin(o,a),t.enablePhysics(u,globalThis.HKP),[3,5];case 4:N.Tools.Warn("Havok.js physics plugin already enabled"),e.label=5;case 5:return[3,8];case 6:return u=e.sent(),console.warn(u),[3,8];case 7:N.Toolkit.RigidbodyPhysics.PhysicsShapeCache={},N.Toolkit.RigidbodyPhysics.NewPhysicsShapeCount=0,N.Toolkit.RigidbodyPhysics.CachedPhysicsShapeCount=0;try{0<n&&null!=(p=t.getPhysicsEngine())&&p.setSubTimeStep(n),c=N.Toolkit.RigidbodyPhysics.GetPhysicsHeapSize(),N.Tools.Log("Havok.js initialized with a heap size of "+c+" MB")}catch(e){console.warn(e)}try{null!=N.Toolkit.RigidbodyPhysics.OnSetupPhysicsPlugin&&N.Toolkit.RigidbodyPhysics.OnSetupPhysicsPlugin(t)}catch(e){console.warn(e)}return[7];case 8:return[2]}})})},o.SetupPhysicsComponent=function(c,p){var d,h,e,t,o,n,i,u,m,g,T,f,l,y,k,_,v,b,r,a,s,C,S,I,M,w,x,P,A,O,B=null!=p.metadata&&null!=p.metadata.toolkit?p.metadata.toolkit:null,R=null!=B.layermask?B.layermask:-1;null==B||null==B.physics&&null==B.collision||(M=null!=B.physics,d=null!=B.physics&&null!=B.physics.filter?B.physics.filter:-1,C=null!=B.physics&&null!=B.physics.vehicle&&B.physics.vehicle,h=null!=B.physics&&null!=B.physics.root&&B.physics.root,s=null!=B.collision&&null!=B.collision.compoundcolliders,e=null!=B.physics&&null!=B.physics.mass?B.physics.mass:0,t=null!=B.physics&&null!=B.physics.center?B.physics.center:{x:0,y:0,z:0},o=null==B.physics||null==B.physics.kinematic||B.physics.kinematic,n=null==B.physics||null==B.physics.truestatic||B.physics.truestatic,O=N.PhysicsMotionType.DYNAMIC,O=!0===n?N.PhysicsMotionType.STATIC:!0===o?N.PhysicsMotionType.ANIMATED:N.PhysicsMotionType.DYNAMIC,!0==M&&(C&&((i=null)!=(M=p.getChildren(null,!1))&&0<M.length&&M.forEach(function(e){var t;null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.collision&&null!=(t=null!=(t=e.metadata.toolkit.collision).wheelinformation?t.wheelinformation:null)&&(N.Toolkit.Utilities.ShowDebugColliders()&&console.log("Setup raycast wheel collider: "+e.name+" --\x3e on to: "+p.name,p),(i=null==i?[]:i).push(t))}),null!=i)&&0<i.length&&(null==p.metadata&&(p.metadata={}),null==p.metadata.toolkit&&(p.metadata.toolkit={}),p.metadata.toolkit.wheels=i),s?null!=(C=B.collision.compoundcolliders)&&0<C.length&&(g=m=u=0,T=!1,f=[],C.forEach(function(e){var t=null!=e.type?e.type:"BoxCollider",o=null!=e.dynamicfriction?e.dynamicfriction:.6,n=null!=e.staticfriction?e.staticfriction:.6,i=null!=e.restitution?e.restitution:0,l=null!=e.trigger&&e.trigger,n=(u<o&&(u=o),m<n&&(m=n),g<i&&(g=i),1==l&&(T=!0),N.PhysicsImpostor.BoxImpostor),n="MeshCollider"===t?N.PhysicsImpostor.ConvexHullImpostor:"CapsuleCollider"===t?N.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===t?N.PhysicsImpostor.SphereImpostor:N.PhysicsImpostor.BoxImpostor,r=null!=e.center?e.center:{x:0,y:0,z:0},a=null!=e.persist&&e.persist,s=new N.Toolkit.PhyscisContainerData;N.Toolkit.Utilities.ShowDebugColliders()&&console.log("Setup simple compound child collider type ("+t+") --\x3e on to: "+p.name,p),N.Toolkit.RigidbodyPhysics.CreateCompoundPhysicsShapeAndBody(c,p,p,e,n,o,i,f,s,r,!1,l,a,R,d)}),0<f.length)&&(N.Toolkit.Utilities.ReparentColliders()||p.setParent(null,!0,!0),S=new N.Vector3(t.x,t.y,t.z),l=new N.PhysicsShapeContainer(c),f.forEach(function(e){l.addChild(e.shape,e.translation,e.rotation,e.scale)}),(M=new N.PhysicsBody(p,O,!1,c)).shape=l,N.Toolkit.RigidbodyPhysics.ConfigRigidbodyPhysics(c,p,!1,T,B.physics,e,S),N.Toolkit.Utilities.ShowDebugColliders()||null!=(I=p).material&&"CenterBox-Material"===I.material.name&&(I.isVisible=!1),N.Toolkit.Utilities.ShowDebugColliders())&&(null==N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer&&(N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer=new N.Debug.PhysicsViewer),null!=N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer)&&N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer.showBody(M):h?(_=k=y=0,v=!1,b=[],r=null!=B.physics&&null!=B.physics.center?N.Toolkit.Utilities.ParseVector3(B.physics.center,N.Vector3.Zero()):N.Vector3.Zero(),null!=(s=p.getChildren(null,!0))&&0<s.length&&s.forEach(function(e){e.position.subtractInPlace(r)}),null!=(C=p.getChildren(null,!1))&&0<C.length&&C.forEach(function(e){var t,o,n,i,l,r,a,s,u;null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.collision&&(t=null!=(r=e.metadata.toolkit.collision).dynamicfriction?r.dynamicfriction:.6,l=null!=r.staticfriction?r.staticfriction:.6,o=null!=r.restitution?r.restitution:0,n=null!=r.trigger&&r.trigger,i=null!=r.type?r.type:"BoxCollider",y<t&&(y=t),k<l&&(k=l),_<o&&(_=o),1==n&&(v=!0),l=N.PhysicsImpostor.BoxImpostor,l="MeshCollider"===i?N.PhysicsImpostor.ConvexHullImpostor:"CapsuleCollider"===i?N.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===i?N.PhysicsImpostor.SphereImpostor:N.PhysicsImpostor.BoxImpostor,a=null!=(r=r).center?r.center:{x:0,y:0,z:0},s=null!=r.persist&&r.persist,u=new N.Toolkit.PhyscisContainerData,N.Toolkit.Utilities.ShowDebugColliders()&&console.log("Setup complex compound child collider type ("+i+") --\x3e on to: "+p.name,p),N.Toolkit.RigidbodyPhysics.CreateCompoundPhysicsShapeAndBody(c,p,e,r,l,t,o,b,u,a,h,n,s,R,d))}),0<b.length&&(N.Toolkit.Utilities.ReparentColliders()||p.setParent(null,!0,!0),S=new N.Vector3(t.x,t.y,t.z),a=new N.PhysicsShapeContainer(c),b.forEach(function(e){a.addChild(e.shape,e.translation,e.rotation,e.scale)}),(M=new N.PhysicsBody(p,O,!1,c)).shape=a,N.Toolkit.RigidbodyPhysics.ConfigRigidbodyPhysics(c,p,!1,v,B.physics,e,S),N.Toolkit.Utilities.ShowDebugColliders()||null!=(I=p).material&&"CenterBox-Material"===I.material.name&&(I.isVisible=!1),N.Toolkit.Utilities.ShowDebugColliders())&&(null==N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer&&(N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer=new N.Debug.PhysicsViewer),null!=N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer)&&N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer.showBody(M)):null!=B.collision&&(s=null!=B.collision.type?B.collision.type:"BoxCollider",C=null!=B.collision.convexmesh&&B.collision.convexmesh,S=null!=B.collision.dynamicfriction?B.collision.dynamicfriction:.6,I=null!=B.collision.staticfriction?B.collision.staticfriction:.6,M=null!=B.collision.restitution?B.collision.restitution:0,w=null!=B.collision.terraindata?B.collision.terraindata:null,x=null!=B.collision.trigger&&B.collision.trigger,P=null!=B.collision.persist&&B.collision.persist,A=N.PhysicsImpostor.BoxImpostor,A="MeshCollider"===s?!0===C?N.PhysicsImpostor.ConvexHullImpostor:N.PhysicsImpostor.MeshImpostor:"TerrainCollider"===s?N.PhysicsImpostor.HeightmapImpostor:"CapsuleCollider"===s?N.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===s?N.PhysicsImpostor.SphereImpostor:N.PhysicsImpostor.BoxImpostor,N.Toolkit.RigidbodyPhysics.CreateStandardPhysicsShapeAndBody(c,p,B,A,x,n,O,e,I,S,M,w,t,P,R,d))),null!=p&&null!=p.physicsBody&&!0===o&&(p.physicsBody.disablePreStep=!1))},o.GetCachedPhysicsMeshShape=function(e,t,o,n,i,l,r){var a;return null==o||""===o?(console.warn("Invalid mesh key specfifed for child collider: "+t.name),null):(null==(a=N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[o+="_F"+n+"_R"+i+"_T0_L"+l+"_X"+r])?((a=new N.PhysicsShapeMesh(t,e)).material={friction:n,restitution:i},a.isTrigger=!1,a.filterMembershipMask=l,a.filterCollideMask=r,N.Toolkit.RigidbodyPhysics.NewPhysicsShapeCount++,N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[o]=a):N.Toolkit.RigidbodyPhysics.CachedPhysicsShapeCount++,a)},o.GetCachedPhysicsConvexHullShape=function(e,t,o,n,i,l,r){var a;return null==o||""===o?(console.warn("Invalid mesh key specfifed for child collider: "+t.name),null):(null==(a=N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[o+="_F"+n+"_R"+i+"_T0_L"+l+"_X"+r])?((a=new N.PhysicsShapeConvexHull(t,e)).material={friction:n,restitution:i},a.isTrigger=!1,a.filterMembershipMask=l,a.filterCollideMask=r,N.Toolkit.RigidbodyPhysics.NewPhysicsShapeCount++,N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[o]=a):N.Toolkit.RigidbodyPhysics.CachedPhysicsShapeCount++,a)},o.GetCachedPhysicsBoxShape=function(e,t,o,n,i,l){var r="SHAPE_BOX_F"+o+"_R"+n+"_T"+(1==t?"1":"0")+"_L"+i+"_X"+l,a=N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[r];return null==a?((a=new N.PhysicsShapeBox(new N.Vector3(0,0,0),new N.Quaternion(0,0,0,1),new N.Vector3(1,1,1),e)).material={friction:o,restitution:n},a.isTrigger=t,a.filterMembershipMask=i,a.filterCollideMask=l,N.Toolkit.RigidbodyPhysics.NewPhysicsShapeCount++,N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[r]=a):N.Toolkit.RigidbodyPhysics.CachedPhysicsShapeCount++,a},o.GetCachedPhysicsSphereShape=function(e,t,o,n,i,l){var r="SHAPE_SPHERE_F"+o+"_R"+n+"_T"+(1==t?"1":"0")+"_L"+i+"_X"+l,a=N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[r];return null==a?((a=new N.PhysicsShapeSphere(new N.Vector3(0,0,0),1,e)).material={friction:o,restitution:n},a.isTrigger=t,a.filterMembershipMask=i,a.filterCollideMask=l,N.Toolkit.RigidbodyPhysics.NewPhysicsShapeCount++,N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[r]=a):N.Toolkit.RigidbodyPhysics.CachedPhysicsShapeCount++,a},o.GetCachedPhysicsCapsuleShape=function(e,t,o,n,i,l){var r="SHAPE_CAPSULE_F"+o+"_R"+n+"_T"+(1==t?"1":"0")+"_L"+i+"_X"+l,a=N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[r];return null==a?((a=new N.PhysicsShapeCapsule(new N.Vector3(0,-1,0),new N.Vector3(0,1,0),1,e)).material={friction:o,restitution:n},a.isTrigger=t,a.filterMembershipMask=i,a.filterCollideMask=l,N.Toolkit.RigidbodyPhysics.NewPhysicsShapeCount++,N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[r]=a):N.Toolkit.RigidbodyPhysics.CachedPhysicsShapeCount++,a},o.GetCachedPhysicsCylinderShape=function(e,t,o,n,i,l){var r="SHAPE_CYLINDER_F"+o+"_R"+n+"_T"+(1==t?"1":"0")+"_L"+i+"_X"+l,a=N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[r];return null==a?((a=new N.PhysicsShapeCylinder(new N.Vector3(0,-.5,0),new N.Vector3(0,.5,0),1,e)).material={friction:o,restitution:n},a.isTrigger=t,a.filterMembershipMask=i,a.filterCollideMask=l,N.Toolkit.RigidbodyPhysics.NewPhysicsShapeCount++,N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[r]=a):N.Toolkit.RigidbodyPhysics.CachedPhysicsShapeCount++,a},o.CreateStandardPhysicsShapeAndBody=function(e,t,o,n,i,l,r,a,s,u,c,p,d,h,m,g){var T,f,y,k,_,v,b,C,S,I,M,w,x,P,A,O,B,R=o.collision,L=null!=R.meshkey?R.meshkey:null,D=null!=R.center?R.center:{x:0,y:0,z:0};n==N.PhysicsImpostor.HeightmapImpostor?null!=p?(N.Toolkit.Utilities.ReparentColliders()||t.setParent(null,!0,!0),v=t,k=p.index,b=p.segments,T=p.resolution,A=p.width,p.height,y=p.length,1===(null!=p.collider?p.collider:0)?(f=p=0,(S=C=1)===b?(p=.5*(A+(C=A/(T-1))),f=.5*(y-(S=y/(T-1)))):2===b&&(_=A/b,b=y/b,C=A/(T-1),S=y/(T-1),0===k?(p=.5*(_+C)+0,f=.5*(b-S)+0):1===k?(p=.5*(_+C)+0,f=.5*(b-S)+b):2===k?(p=.5*(_+C)+_,f=.5*(b-S)+0):3===k&&(p=.5*(_+C)+_,f=.5*(b-S)+b)),A=N.Toolkit.RigidbodyPhysics.CreateHeightFieldTerrainShapeFromMesh(v,C,S),(y=new N.PhysicsShape({type:N.PhysicsShapeType.HEIGHTFIELD,pluginData:A},e)).filterMembershipMask=m,y.filterCollideMask=g,y.material={friction:s,restitution:c},T="TERRAIN_MESH_ID"+v.uniqueId+"_F"+s+"_R"+c+"_T0_L"+m+"_X"+g,N.Toolkit.RigidbodyPhysics.NewPhysicsShapeCount++,N.Toolkit.RigidbodyPhysics.PhysicsShapeCache[T]=y,k=new N.Vector3(p,0,f),_=new N.Quaternion(0,0,0,1),b=new N.Vector3(1,1,1),C=new N.PhysicsShapeContainer(e),N.Toolkit.Utilities.FromEulerToRef(0,90,0,_),y.isTrigger=!1,C.addChild(y,k,_,b),(S=new N.PhysicsBody(t,N.PhysicsMotionType.STATIC,!1,e)).shape=C,N.Toolkit.Utilities.ShowDebugColliders()&&console.log("Setup standard terrain heightmap physics collider for: "+t.name,t),N.Toolkit.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!1,i,o.physics,0,new N.Vector3(d.x,d.y,d.z)),N.Toolkit.Utilities.ShowDebugColliders()||null!=(B=t).material&&"CenterBox-Material"===B.material.name&&(B.isVisible=!1),N.Toolkit.Utilities.ShowDebugColliders()&&(null==N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer&&(N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer=new N.Debug.PhysicsViewer),null!=N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer)&&N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer.showBody(S)):(I=new N.PhysicsShapeMesh(v,e),(O=new N.PhysicsBody(t,N.PhysicsMotionType.STATIC,!1,e)).shape=I,N.Toolkit.Utilities.ShowDebugColliders()&&console.log("Setup terrain mesh physics collider for: "+t.name,t),N.Toolkit.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!1,i,o.physics,0,new N.Vector3(d.x,d.y,d.z)),N.Toolkit.Utilities.ShowDebugColliders()||null!=(B=t).material&&"CenterBox-Material"===B.material.name&&(B.isVisible=!1),N.Toolkit.Utilities.ShowDebugColliders()&&(null==N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer&&(N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer=new N.Debug.PhysicsViewer),null!=N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer)&&N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer.showBody(O))):N.Tools.Warn("No terrain collision data found for: "+t.name+". No terrain collision impostor will be created."):n==N.PhysicsImpostor.MeshImpostor?null!=(A=N.Toolkit.SceneManager.FindChildTransformNode(t,t.name+".Collider",N.Toolkit.SearchType.ExactMatch,!0))?(!1===h&&N.Toolkit.Utilities.AddLoaderItemMarkedForDisposal(A),N.Toolkit.Utilities.ReparentColliders()||t.setParent(null,!0,!0),O=new N.PhysicsBody(t,N.PhysicsMotionType.STATIC,!1,e),I=N.Toolkit.RigidbodyPhysics.GetCachedPhysicsMeshShape(e,A,L,s,c,m,g),T=new N.PhysicsShapeContainer(e),N.Toolkit.RigidbodyPhysics.AddChildShapeFromParent(T,t,I,A),O.shape=T,N.Toolkit.Utilities.ShowDebugColliders()&&console.log("Setup standard mesh physics collider for: "+t.name,t),N.Toolkit.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!1,i,o.physics,0,new N.Vector3(d.x,d.y,d.z)),N.Toolkit.Utilities.ShowDebugColliders()||null!=(B=t).material&&"CenterBox-Material"===B.material.name&&(B.isVisible=!1),N.Toolkit.Utilities.ShowDebugColliders()&&(null==N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer&&(N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer=new N.Debug.PhysicsViewer),null!=N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer)&&N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer.showBody(O)):N.Tools.Warn("No mesh collider found for: "+t.name+"."):n==N.PhysicsImpostor.ConvexHullImpostor?null!=(p=N.Toolkit.SceneManager.FindChildTransformNode(t,t.name+".Collider",N.Toolkit.SearchType.ExactMatch,!0))?(!1===h&&N.Toolkit.Utilities.AddLoaderItemMarkedForDisposal(p),N.Toolkit.Utilities.ReparentColliders()||t.setParent(null,!0,!0),f=N.Toolkit.RigidbodyPhysics.GetCachedPhysicsConvexHullShape(e,p,L,l?s:u,c,m,g),y=new N.PhysicsShapeContainer(e),N.Toolkit.RigidbodyPhysics.AddChildShapeFromParent(y,t,f,p),(k=new N.PhysicsBody(t,r,!1,e)).shape=y,N.Toolkit.Utilities.ShowDebugColliders()&&console.log("Setup standard convex hull physics collider for: "+t.name,t),N.Toolkit.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!0,!1,o.physics,a,new N.Vector3(d.x,d.y,d.z)),N.Toolkit.Utilities.ShowDebugColliders()||null!=(B=t).material&&"CenterBox-Material"===B.material.name&&(B.isVisible=!1),N.Toolkit.Utilities.ShowDebugColliders()&&(null==N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer&&(N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer=new N.Debug.PhysicsViewer),null!=N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer)&&N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer.showBody(k)):N.Tools.Warn("No convex hull child mesh collider found for: "+t.name+"."):n==N.PhysicsImpostor.BoxImpostor?(N.Toolkit.Utilities.ReparentColliders()||t.setParent(null,!0,!0),b=(_=null!=R.boxsize?R.boxsize:{x:1,y:1,z:1}).x*parseFloat(t.scaling.x.toFixed(4)),C=_.y*parseFloat(t.scaling.y.toFixed(4)),S=_.z*parseFloat(t.scaling.z.toFixed(4)),M=D.x*parseFloat(t.scaling.x.toFixed(4)),w=D.y*parseFloat(t.scaling.y.toFixed(4)),x=D.z*parseFloat(t.scaling.z.toFixed(4)),P=new N.Vector3(M,w,x),(v=N.Toolkit.RigidbodyPhysics.GetCachedPhysicsBoxShape(e,i,l?s:u,c,m,g)).material={friction:l?s:u,restitution:c},(I=new N.PhysicsShapeContainer(e)).addChild(v,P,new N.Quaternion(0,0,0,1),new N.Vector3(b,C,S)),(A=new N.PhysicsBody(t,r,!1,e)).shape=I,N.Toolkit.Utilities.ShowDebugColliders()&&console.log("Setup standard box physics collider for: "+t.name,t),N.Toolkit.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!1,!1,o.physics,a,P.add(new N.Vector3(d.x,d.y,d.z))),N.Toolkit.Utilities.ShowDebugColliders()||null!=(B=t).material&&"CenterBox-Material"===B.material.name&&(B.isVisible=!1),N.Toolkit.Utilities.ShowDebugColliders()&&(null==N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer&&(N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer=new N.Debug.PhysicsViewer),null!=N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer)&&N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer.showBody(A)):n==N.PhysicsImpostor.SphereImpostor?(N.Toolkit.Utilities.ReparentColliders()||t.setParent(null,!0,!0),T=null!=R.sphereradius?R.sphereradius:.5,O=parseFloat(t.scaling.x.toFixed(4)),h=parseFloat(t.scaling.y.toFixed(4)),L=parseFloat(t.scaling.z.toFixed(4)),f=Math.max(O,h,L)*T,M=D.x*parseFloat(t.scaling.x.toFixed(4)),w=D.y*parseFloat(t.scaling.y.toFixed(4)),x=D.z*parseFloat(t.scaling.z.toFixed(4)),P=new N.Vector3(M,w,x),(p=N.Toolkit.RigidbodyPhysics.GetCachedPhysicsSphereShape(e,i,l?s:u,c,m,g)).material={friction:l?s:u,restitution:c},(y=new N.PhysicsShapeContainer(e)).addChild(p,P,new N.Quaternion(0,0,0,1),new N.Vector3(f,f,f)),(k=new N.PhysicsBody(t,r,!1,e)).shape=y,N.Toolkit.Utilities.ShowDebugColliders()&&console.log("Setup standard sphere physics collider for: "+t.name,t),N.Toolkit.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!1,!1,o.physics,a,P.add(new N.Vector3(d.x,d.y,d.z))),N.Toolkit.Utilities.ShowDebugColliders()||null!=(B=t).material&&"CenterBox-Material"===B.material.name&&(B.isVisible=!1),N.Toolkit.Utilities.ShowDebugColliders()&&(null==N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer&&(N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer=new N.Debug.PhysicsViewer),null!=N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer)&&N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer.showBody(k)):n==N.PhysicsImpostor.CapsuleImpostor&&(N.Toolkit.Utilities.ReparentColliders()||t.setParent(null,!0,!0),_=null!=R.cylinder&&R.cylinder,b=(v=null!=R.capsulesize?R.capsulesize:{x:.5,y:2,z:1}).x*parseFloat(t.scaling.x.toFixed(4)),C=v.y*parseFloat(t.scaling.y.toFixed(4)),parseFloat(t.scaling.z.toFixed(4)),(S=!(S=null)===_?N.Toolkit.RigidbodyPhysics.GetCachedPhysicsCylinderShape(e,i,l?s:u,c,m,g):N.Toolkit.RigidbodyPhysics.GetCachedPhysicsCapsuleShape(e,i,l?s:u,c,m,g)).material={friction:l?s:u,restitution:c},I=new N.Quaternion(0,0,0,1),0!==v.z&&2!==v.z||(0===v.z?N.Toolkit.Utilities.FromEulerToRef(0,0,90,I):2===v.z&&N.Toolkit.Utilities.FromEulerToRef(90,0,0,I)),M=D.x*parseFloat(t.scaling.x.toFixed(4)),w=D.y*parseFloat(t.scaling.y.toFixed(4)),x=D.z*parseFloat(t.scaling.z.toFixed(4)),P=new N.Vector3(M,w,x),(A=new N.PhysicsShapeContainer(e)).addChild(S,P,I,new N.Vector3(b,C,b)),(O=new N.PhysicsBody(t,r,!1,e)).shape=A,N.Toolkit.Utilities.ShowDebugColliders()&&console.log("Setup standard "+(!0===_?"cylinder":"capsule")+" physics collider for: "+t.name,t),N.Toolkit.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!1,!1,o.physics,a,P.add(new N.Vector3(d.x,d.y,d.z))),N.Toolkit.Utilities.ShowDebugColliders()||null!=(B=t).material&&"CenterBox-Material"===B.material.name&&(B.isVisible=!1),N.Toolkit.Utilities.ShowDebugColliders())&&(null==N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer&&(N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer=new N.Debug.PhysicsViewer),null!=N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer)&&N.Toolkit.RigidbodyPhysics.DebugPhysicsViewer.showBody(O)},o.CreateCompoundPhysicsShapeAndBody=function(e,t,o,n,i,l,r,a,s,u,c,p,d,h,m){var g,T,f,y,k,_,v,b,C,S=0,I=0,M=0,w=new N.Vector3(0,0,0),x=new N.Quaternion(0,0,0,1),P=new N.Vector3(1,1,1);!1===d&&!0===c&&N.Toolkit.Utilities.AddLoaderItemMarkedForDisposal(o),i==N.PhysicsImpostor.ConvexHullImpostor?null!=(d=N.Toolkit.SceneManager.FindChildTransformNode(o,o.name+".Collider",N.Toolkit.SearchType.ExactMatch,!0))&&(T=f=k=1,d instanceof N.InstancedMesh?(!0===c&&(k*=parseFloat(t.scaling.x.toFixed(4)),f*=parseFloat(t.scaling.y.toFixed(4)),T*=parseFloat(t.scaling.z.toFixed(4))),P.set(k,f,T),null!=(_=d.sourceMesh)&&(y=null!=d.metadata&&null!=d.metadata.toolkit&&null!=d.metadata.toolkit.collision&&null!=d.metadata.toolkit.collision.sourcescale?d.metadata.toolkit.collision.sourcescale:null,null!=(_=null!=_.metadata&&null!=_.metadata.toolkit&&null!=_.metadata.toolkit.collision&&null!=_.metadata.toolkit.collision.sourcescale?_.metadata.toolkit.collision.sourcescale:null))&&null!=y&&(g=new N.Vector3(1,1,1),y=new N.Vector3(y.x,y.y,y.z),_=new N.Vector3(_.x,_.y,_.z),y.divideToRef(_,g),P.multiplyInPlace(g))):P.set(k,f,T),y=null!=n.meshkey?n.meshkey:null,_=N.Toolkit.RigidbodyPhysics.GetCachedPhysicsConvexHullShape(e,d,y,l,r,h,m),!0===c?(v=o.position.x*parseFloat(t.scaling.x.toFixed(4)),b=o.position.y*parseFloat(t.scaling.y.toFixed(4)),C=o.position.z*parseFloat(t.scaling.z.toFixed(4)),w.set(v,b,C),x.multiplyInPlace(o.rotationQuaternion)):(S=u.x*parseFloat(o.scaling.x.toFixed(4)),I=u.y*parseFloat(o.scaling.y.toFixed(4)),M=u.z*parseFloat(o.scaling.z.toFixed(4)),w.set(S,I,M)),s.shape=_,s.translation=w,s.rotation=x,s.scale=P,a.push(s)):i==N.PhysicsImpostor.CapsuleImpostor?(g=null!=n.cylinder&&n.cylinder,f=(k=null!=n.capsulesize?n.capsulesize:{x:.5,y:2,z:1}).x*parseFloat(o.scaling.x.toFixed(4)),T=k.y*parseFloat(o.scaling.y.toFixed(4)),parseFloat(o.scaling.z.toFixed(4)),!0===c&&(f*=parseFloat(t.scaling.x.toFixed(4)),T*=parseFloat(t.scaling.y.toFixed(4)),parseFloat(t.scaling.z.toFixed(4))),P.set(f,T,f),d=!(d=null)===g?N.Toolkit.RigidbodyPhysics.GetCachedPhysicsCylinderShape(e,p,l,r,h,m):N.Toolkit.RigidbodyPhysics.GetCachedPhysicsCapsuleShape(e,p,l,r,h,m),0!==k.z&&2!==k.z||(0===k.z?N.Toolkit.Utilities.FromEulerToRef(0,0,90,x):2===k.z&&N.Toolkit.Utilities.FromEulerToRef(90,0,0,x)),!0===c?(0===u.x&&0===u.y&&0===u.z||console.warn("WARNING: Center offset not supported for complex compound item: "+o.name),v=o.position.x*parseFloat(t.scaling.x.toFixed(4)),b=o.position.y*parseFloat(t.scaling.y.toFixed(4)),C=o.position.z*parseFloat(t.scaling.z.toFixed(4)),w.set(v,b,C),x.multiplyInPlace(o.rotationQuaternion)):(S=u.x*parseFloat(o.scaling.x.toFixed(4)),I=u.y*parseFloat(o.scaling.y.toFixed(4)),M=u.z*parseFloat(o.scaling.z.toFixed(4)),w.set(S,I,M)),s.shape=d,s.translation=w,s.rotation=x,s.scale=P,a.push(s)):i==N.PhysicsImpostor.SphereImpostor?(y=null!=n.sphereradius?n.sphereradius:.5,_=parseFloat(o.scaling.x.toFixed(4)),T=parseFloat(o.scaling.y.toFixed(4)),f=parseFloat(o.scaling.z.toFixed(4)),g=Math.max(_,T,f)*y,!0===c&&(k=parseFloat(t.scaling.x.toFixed(4)),d=parseFloat(t.scaling.y.toFixed(4)),_=parseFloat(t.scaling.z.toFixed(4)),g*=Math.max(k,d,_)),P.set(g,g,g),T=N.Toolkit.RigidbodyPhysics.GetCachedPhysicsSphereShape(e,p,l,r,h,m),!0===c?(0===u.x&&0===u.y&&0===u.z||console.warn("WARNING: Center offset not supported for complex compound item: "+o.name),v=o.position.x*parseFloat(t.scaling.x.toFixed(4)),b=o.position.y*parseFloat(t.scaling.y.toFixed(4)),C=o.position.z*parseFloat(t.scaling.z.toFixed(4)),w.set(v,b,C),x.multiplyInPlace(o.rotationQuaternion)):(S=u.x*parseFloat(o.scaling.x.toFixed(4)),I=u.y*parseFloat(o.scaling.y.toFixed(4)),M=u.z*parseFloat(o.scaling.z.toFixed(4)),w.set(S,I,M)),s.shape=T,s.translation=w,s.rotation=x,s.scale=P,a.push(s)):i==N.PhysicsImpostor.BoxImpostor&&(y=(f=null!=n.boxsize?n.boxsize:{x:1,y:1,z:1}).x*parseFloat(o.scaling.x.toFixed(4)),k=f.y*parseFloat(o.scaling.y.toFixed(4)),d=f.z*parseFloat(o.scaling.z.toFixed(4)),!0===c&&(y*=parseFloat(t.scaling.x.toFixed(4)),k*=parseFloat(t.scaling.y.toFixed(4)),d*=parseFloat(t.scaling.z.toFixed(4))),P.set(y,k,d),_=N.Toolkit.RigidbodyPhysics.GetCachedPhysicsBoxShape(e,p,l,r,h,m),!0===c?(0===u.x&&0===u.y&&0===u.z||console.warn("WARNING: Center offset not supported for complex compound item: "+o.name),v=o.position.x*parseFloat(t.scaling.x.toFixed(4)),b=o.position.y*parseFloat(t.scaling.y.toFixed(4)),C=o.position.z*parseFloat(t.scaling.z.toFixed(4)),w.set(v,b,C),x.multiplyInPlace(o.rotationQuaternion)):(S=u.x*parseFloat(o.scaling.x.toFixed(4)),I=u.y*parseFloat(o.scaling.y.toFixed(4)),M=u.z*parseFloat(o.scaling.z.toFixed(4)),w.set(S,I,M)),s.shape=_,s.translation=w,s.rotation=x,s.scale=P,a.push(s))},o.CreateHeightFieldTerrainShapeFromMesh=function(e,t,o){var n=N.Toolkit.RigidbodyPhysics.GetHavokInstance();if(!n)return N.Tools.Warn("Havok.js physics library not loaded"),null;var i=e.getVerticesData(N.VertexBuffer.PositionKind),l=i.length/3,r=n._malloc(4*l),a=Math.sqrt(l),l=a;if(a%1!=0)return console.error("Terrain mesh does not seem to be a regular square grid: "+e.name),null;for(var s=0,u=l-1;0<=u;u--)for(var c=0;c<a;c++)n.HEAPF32[r+s>>2]=i[3*(u*a+c)+1],s+=4;e=n.HP_Shape_CreateHeightField(a,l,[t,1,o],r)[1];return n._free(r),e},o.GetPhysicsHeapSize=function(){var e,t=N.Toolkit.RigidbodyPhysics.GetHavokInstance();return t?(e=0,t.HEAP8&&t.HEAP8.length?t.HEAP8.length/1048576:e):(N.Tools.Warn("Havok.js physics library not loaded"),0)},o.ConfigRigidbodyPhysics=function(e,t,o,n,i,l,r){var a,s,u;null!=t&&null!=t.physicsBody&&(!1===(null==i||null==i.gravity||i.gravity)&&t.physicsBody.setGravityFactor(0),a=null!=i&&null!=i.ldrag?i.ldrag:0,s=null!=i&&null!=i.adrag?i.adrag:.05,t.physicsBody.setLinearDamping(a),t.physicsBody.setAngularDamping(s),u=s=a=1,null!=(i=null!=i&&null!=i.freeze?i.freeze:null)&&(null!=i.positionx&&i.positionx,null!=i.positiony&&i.positiony,null!=i.positionz&&i.positionz,a=null!=i.rotationx&&!0===i.rotationx?0:1,s=null!=i.rotationy&&!0===i.rotationy?0:1,u=null!=i.rotationz&&!0===i.rotationz?0:1),t.physicsBody.setMassProperties({mass:l,centerOfMass:r,inertia:new N.Vector3(a,s,u)}))},o.CreatePhysicsMetadata=function(e,t,o,n){void 0===t&&(t=0),void 0===o&&(o=.05);n=null!=(n=void 0===n?null:n)?n:new N.Vector3(0,0,0);return{type:"rigidbody",mass:e,ldrag:t,adrag:o,center:{x:n.x,y:n.y,z:n.z}}},o.CreateCollisionMetadata=function(e,t,o,n,i,l){return{type:e,trigger:t=void 0===t?!1:t,convexmesh:o=void 0===o?!1:o,restitution:n=void 0===n?0:n,dynamicfriction:i=void 0===i?.6:i,staticfriction:l=void 0===l?.6:l,wheelinformation:null}},o.CreatePhysicsProperties=function(e,t,o,n,i){return{mass:e,drag:t=void 0===t?0:t,angularDrag:o=void 0===o?.05:o,useGravity:n=void 0===n?!0:n,isKinematic:i=void 0===i?!1:i}},o.AddChildShapeFromParent=function(e,t,o,n){var i,l=n.computeWorldMatrix(!0),t=t.computeWorldMatrix(!0),r=N.TmpVectors.Matrix[0],l=(l.multiplyToRef(N.Matrix.Invert(t),r),N.TmpVectors.Vector3[0]),t=N.TmpVectors.Quaternion[0],a=N.TmpVectors.Vector3[1],r=(r.decompose(a,t,l),new N.Vector3(a.x,a.y,a.z));n instanceof N.InstancedMesh&&null!=(a=n.sourceMesh)&&(n=null!=n.metadata&&null!=n.metadata.toolkit&&null!=n.metadata.toolkit.collision&&null!=n.metadata.toolkit.collision.sourcescale?n.metadata.toolkit.collision.sourcescale:null,null!=(a=null!=a.metadata&&null!=a.metadata.toolkit&&null!=a.metadata.toolkit.collision&&null!=a.metadata.toolkit.collision.sourcescale?a.metadata.toolkit.collision.sourcescale:null))&&null!=n&&(i=new N.Vector3(1,1,1),n=new N.Vector3(n.x,n.y,n.z),a=new N.Vector3(a.x,a.y,a.z),n.divideToRef(a,i),r.multiplyInPlace(i)),null!=(n=N.Toolkit.RigidbodyPhysics.GetHavokPlugin())&&n.addChild(e,o,l,t,r)},o.PHYSICS_STEP_TIME=.016,o.RaycastResult=null,o.LocalShapeResult=null,o.WorldShapeResult=null,o.RaycastDestination=null,o.PhysicsShapeCache={},o.NewPhysicsShapeCount=0,o.CachedPhysicsShapeCount=0,o.DebugPhysicsViewer=null,o.OnSetupPhysicsPlugin=null,e.RigidbodyPhysics=o,e.PhyscisContainerData=function(){}}(BABYLON=BABYLON||{}),this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}()),__extends=(!function(e){var t,o;function n(){return null!==o&&o.apply(this,arguments)||this}t=e.Toolkit||(e.Toolkit={}),o=e.Toolkit.ScriptComponent,__extends(n,o),n.prototype.awake=function(){},n.prototype.start=function(){},n.prototype.ready=function(){},n.prototype.update=function(){},n.prototype.late=function(){},n.prototype.step=function(){},n.prototype.fixed=function(){},n.prototype.after=function(){},n.prototype.destroy=function(){},t.ShurikenParticles=n}(BABYLON=BABYLON||{}),this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}()),__extends=(!function(e){var t,o;function n(){return null!==o&&o.apply(this,arguments)||this}t=e.Toolkit||(e.Toolkit={}),o=e.Toolkit.ScriptComponent,__extends(n,o),n.prototype.awake=function(){},n.prototype.start=function(){},n.prototype.ready=function(){},n.prototype.update=function(){},n.prototype.late=function(){},n.prototype.step=function(){},n.prototype.fixed=function(){},n.prototype.after=function(){},n.prototype.destroy=function(){},t.TerrainGenerator=n}(BABYLON=BABYLON||{}),this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}());!function(o){var e,t;function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.videoLoop=!1,e.videoMuted=!1,e.videoAlpha=!1,e.videoFaded=!1,e.videoPoster=null,e.videoInvert=!0,e.videoSample=3,e.videoVolume=1,e.videoMipmaps=!1,e.videoPlayback=1,e.videoPlayOnAwake=!0,e.videoPreloaderUrl=null,e.videoBlobUrl=null,e.videoPreload=!1,e._initializedReadyInstance=!1,e.onReadyObservable=new o.Observable,e.m_abstractMesh=null,e.m_videoTexture=null,e.m_videoMaterial=null,e.m_diffuseIntensity=1,e}e=o.Toolkit||(o.Toolkit={}),t=o.Toolkit.ScriptComponent,__extends(n,t),n.prototype.getVideoMaterial=function(){return this.m_videoMaterial},n.prototype.getVideoTexture=function(){return this.m_videoTexture},n.prototype.getVideoElement=function(){return null!=this.m_videoTexture?this.m_videoTexture.video:null},n.prototype.getVideoScreen=function(){return this.m_abstractMesh},n.prototype.getVideoBlobUrl=function(){return this.videoBlobUrl},n.prototype.awake=function(){this.awakeWebVideoPlayer()},n.prototype.destroy=function(){this.destroyWebVideoPlayer()},n.prototype.awakeWebVideoPlayer=function(){this.videoLoop=this.getProperty("looping",!1),this.videoMuted=this.getProperty("muted",!1),this.videoInvert=this.getProperty("inverty",!0),this.videoSample=this.getProperty("sampling",3),this.videoVolume=this.getProperty("volume",1),this.videoMipmaps=this.getProperty("mipmaps",!1),this.videoAlpha=this.getProperty("texturealpha",!1),this.videoFaded=this.getProperty("diffusealpha",!1),this.videoPlayback=this.getProperty("playbackspeed",1),this.videoPlayOnAwake=this.getProperty("playonawake",!0),this.videoPreload=this.getProperty("preload",this.videoPreload),this.m_diffuseIntensity=this.getProperty("intensity",1),this.m_abstractMesh=this.getAbstractMesh();!0===this.getProperty("poster")&&null!=this.m_abstractMesh&&null!=this.m_abstractMesh.material&&(this.m_abstractMesh.material instanceof o.PBRMaterial?null!=this.m_abstractMesh.material.albedoTexture&&null!=this.m_abstractMesh.material.albedoTexture.url&&""!==this.m_abstractMesh.material.albedoTexture.url&&(this.videoPoster=this.m_abstractMesh.material.albedoTexture.url.replace("data:","")):this.m_abstractMesh.material instanceof o.StandardMaterial&&null!=this.m_abstractMesh.material.diffuseTexture&&null!=this.m_abstractMesh.material.diffuseTexture.url&&""!==this.m_abstractMesh.material.diffuseTexture.url&&(this.videoPoster=this.m_abstractMesh.material.diffuseTexture.url.replace("data:","")));var e=this.getProperty("url",null),t=this.getProperty("source",null);null!=(e=null!=t&&null!=t.filename&&""!==t.filename?o.Toolkit.SceneManager.GetRootUrl(this.scene)+t.filename:e)&&""!==e&&(!0===this.videoPreload?this.videoPreloaderUrl=e:this.setDataSource(e))},n.prototype.destroyWebVideoPlayer=function(){(this.m_abstractMesh=null)!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),null!=this.m_videoMaterial&&(this.m_videoMaterial.dispose(),this.m_videoMaterial=null),this.revokeVideoBlobUrl()},n.prototype.isReady=function(){return null!=this.getVideoElement()},n.prototype.isPlaying=function(){var e=!1,t=this.getVideoElement();return e=null!=t?!1===t.paused:e},n.prototype.isPaused=function(){var e=!1,t=this.getVideoElement();return e=null!=t?!0===t.paused:e},n.prototype.play=function(){var e=this;return o.Toolkit.SceneManager.HasAudioContext()?this.internalPlay():o.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){e.internalPlay()}),!0},n.prototype.internalPlay=function(){var e=this;!0===this._initializedReadyInstance?this.checkedPlay():this.onReadyObservable.addOnce(function(){e.checkedPlay()})},n.prototype.checkedPlay=function(){var e=this,t=this.getVideoElement();null!=t&&t.play().then(function(){!0===t.paused&&e.checkedRePlay()})},n.prototype.checkedRePlay=function(){var e=this.getVideoElement();null!=e&&e.play().then(function(){})},n.prototype.pause=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.pause(),e=!0),e},n.prototype.mute=function(){var e=!1,t=this.getVideoElement();return e=null!=t?t.muted=!0:e},n.prototype.unmute=function(){var e=!1,t=this.getVideoElement();return e=null!=t?!(t.muted=!1):e},n.prototype.getVolume=function(){var e=0,t=this.getVideoElement();return e=null!=t?t.volume:e},n.prototype.setVolume=function(e){var t=!1,o=this.getVideoElement();return null!=o&&(o.volume=e,t=!0),t},n.prototype.setDataSource=function(e){var t=this;null!=this.m_abstractMesh&&(null==this.m_videoMaterial&&(this.m_videoMaterial=new o.StandardMaterial(this.transform.name+".VideoMat",this.scene),this.m_videoMaterial.roughness=1,this.m_videoMaterial.diffuseColor=new o.Color3(1,1,1),this.m_videoMaterial.emissiveColor=new o.Color3(1,1,1),this.m_videoMaterial.useAlphaFromDiffuseTexture=this.videoFaded,this.m_abstractMesh.material=this.m_videoMaterial),null!=this.m_videoMaterial?((this.m_videoMaterial.diffuseTexture=null)!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),this._initializedReadyInstance=!1,this.m_videoTexture=new o.VideoTexture(this.transform.name+".VideoTex",e,this.scene,this.videoMipmaps,this.videoInvert,this.videoSample,{autoUpdateTexture:!0,poster:this.videoPoster}),null!=this.m_videoTexture&&(this.m_videoTexture.hasAlpha=this.videoAlpha,null!=this.m_videoTexture.video)&&(this.m_videoTexture.video.loop=this.videoLoop,this.m_videoTexture.video.muted=this.videoMuted,this.m_videoTexture.video.volume=this.videoVolume,this.m_videoTexture.video.playbackRate=this.videoPlayback,this.m_videoTexture.video.addEventListener("loadeddata",function(){t._initializedReadyInstance=!0,t.onReadyObservable&&t.onReadyObservable.hasObservers()&&t.onReadyObservable.notifyObservers(t.m_videoTexture),!0===t.videoPlayOnAwake&&t.play()}),this.m_videoTexture.video.load()),null!=this.m_videoTexture&&(this.m_videoTexture.level=this.m_diffuseIntensity,this.m_videoMaterial.diffuseTexture=this.m_videoTexture)):o.Tools.Warn("No video mesh or material available for: "+this.transform.name))},n.prototype.revokeVideoBlobUrl=function(){null!=this.videoBlobUrl&&(URL.revokeObjectURL(this.videoBlobUrl),this.videoBlobUrl=null)},n.prototype.addPreloaderTasks=function(e){var t=this;!0===this.videoPreload&&((e=e.addBinaryFileTask(this.transform.name+".VideoTask",this.videoPreloaderUrl)).onSuccess=function(e){t.revokeVideoBlobUrl(),t.videoBlobUrl=URL.createObjectURL(new Blob([e.data])),t.setDataSource(t.videoBlobUrl)},e.onError=function(e,t,o){console.error(t,o)})},e.WebVideoPlayer=n}(BABYLON=BABYLON||{});