!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TOOLKIT=t():e.TOOLKIT=t()}(this,()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>s});var n,o,i=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function l(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,l)}s((o=o.apply(e,t||[])).next())})},a=function(e,t){var n,o,i,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=l(0),a.throw=l(1),a.return=l(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(r=0)),r;)try{if(n=1,o&&(i=2&l[0]?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==l[0]&&2!==l[0])){r=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(6===l[0]&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(e){l=[6,e],o=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},l=function(e,t,n){if(n||2===arguments.length)for(var o,i=0,r=t.length;i<r;i++)!o&&i in t||(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return e.concat(o||Array.prototype.slice.call(t))};!function(e){var t=function(){function t(){}return Object.defineProperty(t,"Version",{get:function(){return"8.14.1 - R1"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Copyright",{get:function(){return"All rights reserved (c) 2024 Mackey Kinard"},enumerable:!1,configurable:!0}),t.GetEngine=function(e){var t=null,n=e.getEngine();return null!=n&&(n instanceof BABYLON.Engine||n instanceof BABYLON.WebGPUEngine)&&(t=n),t},t.GetClass=function(e){return BABYLON.GetClass(e)},t.RegisterClass=function(e,t){BABYLON.RegisterClass(e,t)},Object.defineProperty(t,"EventBus",{get:function(){return null==e.SceneManager._EventBus&&(e.SceneManager._EventBus=new e.GlobalMessageBus),e.SceneManager._EventBus},enumerable:!1,configurable:!0}),Object.defineProperty(t,"PlaygroundCdn",{get:function(){return"https://cdn.jsdelivr.net/gh/BabylonJS/BabylonToolkit@master/Runtime/"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"PlaygroundRepo",{get:function(){return"https://www.babylontoolkit.com/playground/"},enumerable:!1,configurable:!0}),t.InitializePlayground=function(t){return r(this,arguments,void 0,function(t,n){var o,i,r,l,s,u,c;return void 0===n&&(n=null),a(this,function(a){switch(a.label){case 0:if(BABYLON.Tools.Log("Babylon.js Toolkit v"+e.SceneManager.Version),!0===(null==n||null==n.initSceneFileLoaders||n.initSceneFileLoaders))try{e.SceneManager.UniversalModuleDefinition=!0,BABYLON&&BABYLON.GLTF2&&BABYLON.GLTF2.registerGLTFExtension?(e.SceneManager.CVTOOLS_NAME_REGISTERED||(BABYLON.GLTF2.registerGLTFExtension(e.SceneManager.CVTOOLS_NAME,!0,function(t){return new e.CVTOOLS_unity_metadata(t)}),e.SceneManager.CVTOOLS_NAME_REGISTERED=!0),e.SceneManager.CVTOOLS_MESH_REGISTERED||(BABYLON.GLTF2.registerGLTFExtension(e.SceneManager.CVTOOLS_MESH,!0,function(t){return new e.CVTOOLS_babylon_mesh(t)}),e.SceneManager.CVTOOLS_MESH_REGISTERED=!0),e.SceneManager.CVTOOLS_HAND_REGISTERED||(BABYLON.GLTF2.registerGLTFExtension(e.SceneManager.CVTOOLS_HAND,!0,function(t){return new e.CVTOOLS_left_handed(t)}),e.SceneManager.CVTOOLS_HAND_REGISTERED=!0)):console.warn("Babylon Toolkit: UMD GLTF Parser not registered because BABYLON.GLTF2 or RegisterGLTFExtension is not available.")}catch(e){console.warn("Babylon Toolkit: Failed to initialize GLTF extensions:",e)}return o=e.SceneManager.PlaygroundCdn+"default.playground.js",i=null!=n&&null!=n.loadProjectScriptBundle&&n.loadProjectScriptBundle,r=null!=n&&null!=n.projectScriptBundleUrl?n.projectScriptBundleUrl:o,l=null!=n&&null!=n.showDefaultLoadingScreen&&n.showDefaultLoadingScreen,s=null==n||null==n.hideLoadingUIWithEngine||n.hideLoadingUIWithEngine,u=null!=n&&null!=n.defaultLoadingUIMarginTop?n.defaultLoadingUIMarginTop:"150px",!0===l&&e.SceneManager.ShowLoadingScreen(t,s,u),!0!==i||null==r||""===r?[3,2]:(c=r.substring(r.lastIndexOf("/")+1).toLowerCase(),[4,BABYLON.Tools.LoadScriptAsync(r,c)]);case 1:a.sent(),a.label=2;case 2:return[2]}})})},t.InitializeRuntime=function(t){return r(this,arguments,void 0,function(t,n){var o,i,r,l,s,u,c;return void 0===n&&(n=null),a(this,function(a){switch(a.label){case 0:if(BABYLON.Tools.Log("Babylon.js Toolkit v"+e.SceneManager.Version),!0===(null==n||null==n.initSceneFileLoaders||n.initSceneFileLoaders))try{e.SceneManager.UniversalModuleDefinition=!0,BABYLON&&BABYLON.GLTF2&&BABYLON.GLTF2.registerGLTFExtension?(e.SceneManager.CVTOOLS_NAME_REGISTERED||(BABYLON.GLTF2.registerGLTFExtension(e.SceneManager.CVTOOLS_NAME,!0,function(t){return new e.CVTOOLS_unity_metadata(t)}),e.SceneManager.CVTOOLS_NAME_REGISTERED=!0),e.SceneManager.CVTOOLS_MESH_REGISTERED||(BABYLON.GLTF2.registerGLTFExtension(e.SceneManager.CVTOOLS_MESH,!0,function(t){return new e.CVTOOLS_babylon_mesh(t)}),e.SceneManager.CVTOOLS_MESH_REGISTERED=!0),e.SceneManager.CVTOOLS_HAND_REGISTERED||(BABYLON.GLTF2.registerGLTFExtension(e.SceneManager.CVTOOLS_HAND,!0,function(t){return new e.CVTOOLS_left_handed(t)}),e.SceneManager.CVTOOLS_HAND_REGISTERED=!0)):console.warn("Babylon Toolkit: UMD GLTF Parser not registered because BABYLON.GLTF2 or RegisterGLTFExtension is not available.")}catch(e){console.warn("Babylon Toolkit: Failed to initialize GLTF extensions:",e)}return o=e.SceneManager.PlaygroundCdn+"default.playground.js",i=null!=n&&null!=n.loadProjectScriptBundle&&n.loadProjectScriptBundle,r=null!=n&&null!=n.projectScriptBundleUrl?n.projectScriptBundleUrl:o,l=null!=n&&null!=n.showDefaultLoadingScreen&&n.showDefaultLoadingScreen,s=null==n||null==n.hideLoadingUIWithEngine||n.hideLoadingUIWithEngine,u=null!=n&&null!=n.defaultLoadingUIMarginTop?n.defaultLoadingUIMarginTop:"150px",!0===l&&e.SceneManager.ShowLoadingScreen(t,s,u),!0!==i||null==r||""===r?[3,2]:(c=r.substring(r.lastIndexOf("/")+1).toLowerCase(),[4,BABYLON.Tools.LoadScriptAsync(r,c)]);case 1:a.sent(),a.label=2;case 2:return[2]}})})},t.LoadRuntimeAssets=function(t,n,o){return r(this,arguments,void 0,function(t,n,o,i,r){return void 0===i&&(i=60),void 0===r&&(r=!1),a(this,function(a){switch(a.label){case 0:return e.SceneManager.SetOnSceneReadyHandler(n,o,i,r),null==t?[3,2]:[4,t.loadAsync()];case 1:a.sent(),a.label=2;case 2:return[2]}})})},t.ShowLoadingScreen=function(t,n,o){if(void 0===n&&(n=!0),void 0===o&&(o="150px"),null!=t.loadingScreen){e.SceneManager._HideLoadingScreen=t.loadingScreen.hideLoadingUI.bind(t.loadingScreen),!1===n&&(t.loadingScreen.hideLoadingUI=function(){});var i=t.loadingScreen;i._loadingDivBackgroundColor="#2A2342",t.displayLoadingUI(),null!=i._loadingTextDiv&&null!=i._loadingTextDiv.style&&(i._loadingTextDiv.style.marginTop=o)}},t.HideLoadingScreen=function(t){t.loadingScreen instanceof BABYLON.DefaultLoadingScreen?null!=e.SceneManager._HideLoadingScreen?e.SceneManager._HideLoadingScreen():t.hideLoadingUI():e.SceneManager.ForceHideLoadingScreen()},t.ForceHideLoadingScreen=function(){try{e.SceneManager.DoForceHideLoadingScreen()}catch(e){console.warn(e)}finally{try{e.SceneManager.DoForceHideLoadingScreen()}catch(e){console.warn(e)}finally{try{e.SceneManager.DoForceHideLoadingScreen()}catch(e){console.warn(e)}}}},t.DoForceHideLoadingScreen=function(){var e=document.getElementById("babylonjsLoadingDiv"),t=document.getElementById("babylonjsLoadingText"),n=document.getElementById("babylonjsLoadingDivStyle");try{null!=t&&(t.remove(),t=null)}catch(e){console.warn(e)}try{null!=e&&(e.remove(),e=null)}catch(e){console.warn(e)}try{null!=n&&n.remove()}catch(e){console.warn(e)}},t.FocusRenderCanvas=function(e){e.getEngine().getRenderingCanvas().focus()},t.SetOnSceneReadyHandler=function(t,n,o,i){void 0===o&&(o=60),void 0===i&&(i=!1),e.SceneManager.SceneLoaderPropertyBag={},e.SceneManager.SceneLoaderHandledFlag=!1,e.SceneManager.SceneLoaderFileNames=t,e.SceneManager.SceneLoaderFileNames.forEach(function(t){e.SceneManager.SceneLoaderPropertyBag[t.toLowerCase()]=!1}),e.SceneManager.OnSceneReadyObservable.clear(),e.SceneManager.OnSceneReadyObservable.add(function(t){if(!0===i&&console.log("OnSceneReady(): "+t),e.SceneManager.SceneLoaderPropertyBag[t.toLowerCase()]=!0,!0===Object.values(e.SceneManager.SceneLoaderPropertyBag).every(function(e){return!0===e}))try{n&&n()}catch(e){console.warn(e)}finally{e.SceneManager.SceneLoaderHandledFlag=!0}}),e.WindowManager.SetTimeout(1e3*o,function(){if(!1===e.SceneManager.SceneLoaderHandledFlag)try{n&&n()}catch(e){console.warn(e)}finally{e.SceneManager.SceneLoaderHandledFlag=!0,e.SceneManager.ForceHideLoadingScreen()}})},t.EnableSceneParsing=function(t){e.SceneManager.SceneParsingEnabled=t},t.IsSceneParsingEnabled=function(){return e.SceneManager.SceneParsingEnabled},t.HasSceneBeenPreLoaded=function(e){var t=e;return null!=t._preloaded&&!0===t._preloaded},t.GetDefaultSkybox=function(e){return e.getMeshById("Default Skybox")},t.GetIntensityFactor=function(){return null!=e.SceneManager.GlobalOptions.intensityFactor?e.SceneManager.GlobalOptions.intensityFactor:2},t.GetRenderQuality=function(){var t=e.RenderQuality.High,n=e.SceneManager.GlobalOptions.renderQuality;return null!=n&&(t=n),t},t.SetRenderQuality=function(t){e.SceneManager.GlobalOptions.renderQuality=t},t.GetEngineVersionString=function(t){var n="Unknown",o=t||e.SceneManager.GetLastCreatedScene();if(null!=o){var i=e.SceneManager.GetEngine(o);if(null!=i){var r=i.getInfo();null!=r&&(n=r.version+" - "+r.renderer)}}return n},t.SetWindowState=function(t,n){e.SceneManager.WindowState[t]=n},t.GetWindowState=function(t){var n=e.SceneManager.WindowState[t];return null!=n?n:null},t.IsDebugMode=function(){return null!=e.SceneManager.GlobalOptions.debugModeEnabled&&!0===e.SceneManager.GlobalOptions.debugModeEnabled},t.ConsoleLog=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.log.apply(console,t)},t.ConsoleInfo=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.info.apply(console,t)},t.ConsoleWarn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.warn.apply(console,t)},t.ConsoleError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,e)},t.LogMessage=function(t){e.SceneManager.IsDebugMode()&&BABYLON.Tools.Log(t)},t.LogWarning=function(t){e.SceneManager.IsDebugMode()&&BABYLON.Tools.Warn(t)},t.LogError=function(e){BABYLON.Tools.Error(e)},t.GetTime=function(){return.001*e.SceneManager.GetTimeMilliseconds()},t.GetTimeMs=function(){return e.SceneManager.GetTimeMilliseconds()},t.GetGameTime=function(){return.001*(e.SceneManager.GetTimeMilliseconds()-e.SceneManager.GameTimeMilliseconds)},t.GetGameTimeMs=function(){return e.SceneManager.GetTimeMilliseconds()-e.SceneManager.GameTimeMilliseconds},t.GetDeltaTime=function(t,n){return void 0===n&&(n=!1),e.SceneManager.GetDeltaSeconds(t,n)},t.GetDeltaSeconds=function(t,n){void 0===n&&(n=!1);var o=t||e.SceneManager.GetLastCreatedScene(),i=.001*Math.max(BABYLON.Scene.MinDeltaTime,Math.min(o.getEngine().getDeltaTime(),BABYLON.Scene.MaxDeltaTime));return!0===n&&(i*=o.getAnimationRatio()),i},t.GetDeltaMilliseconds=function(t,n){void 0===n&&(n=!1);var o=t||e.SceneManager.GetLastCreatedScene(),i=Math.max(BABYLON.Scene.MinDeltaTime,Math.min(o.getEngine().getDeltaTime(),BABYLON.Scene.MaxDeltaTime));return!0===n&&(i*=o.getAnimationRatio()),i},t.GetTimeMilliseconds=function(){var e=0;return"undefined"!=typeof window&&window.performance?e=window.performance.now():"undefined"!=typeof window&&window.Date?e=window.Date.now():null!=Date&&(e=Date.now()),e},t.GetAnimationRatio=function(t){return(t||e.SceneManager.GetLastCreatedScene()).getAnimationRatio()},t.RunOnce=function(e,t,n){e.executeOnceBeforeRender(t,n)},t.DisposeScene=function(e,t){void 0===t&&(t=new BABYLON.Color4(0,0,0,1));var n=e.getEngine();e.dispose(),n.clear(t,!0,!0,!0)},t.SafeDestroy=function(t,n,o){void 0===n&&(n=5),void 0===o&&(o=!1),n>0?(!0===o&&t.setEnabled(!1),e.WindowManager.SetTimeout(n,function(){t.dispose(!1,!1)})):t.dispose(!1,!1)},t.GetRootUrl=function(e){return null!=e._rootUrl&&""!==e._rootUrl?e._rootUrl:"/"},t.SetRootUrl=function(e,t){e._rootUrl=t},t.GetSceneFile=function(e){return null!=e._fileName&&""!==e._fileName?e._fileName:null},t.SetSceneFile=function(e,t){e._fileName=t},t.GetEngineInstances=function(){return BABYLON.EngineStore.Instances},t.GetLastCreatedEngine=function(){return BABYLON.EngineStore.LastCreatedEngine},t.GetLastCreatedScene=function(){return BABYLON.EngineStore.LastCreatedScene},t.AddShadowCaster=function(e,t,n){void 0===n&&(n=!1);var o=(null==e?void 0:e.getShadowGenerator()).getShadowMap();if(null==o.renderList&&(o.renderList=[]),t instanceof BABYLON.AbstractMesh&&o.renderList.indexOf(t)<0&&o.renderList.push(t),!0===n){var i=t.getChildMeshes(!1);null!=i&&i.forEach(function(e){o.renderList.indexOf(e)<0&&o.renderList.push(e)})}},t.IsPhysicsViewerEnabled=function(){return e.SceneManager.PhysicsViewersEnabled},t.TogglePhysicsViewer=function(t){if(e.SceneManager.PhysicsViewersEnabled=!e.SceneManager.PhysicsViewersEnabled,e.SceneManager.PhysicsViewersEnabled){var n=new BABYLON.Debug.PhysicsViewer(t);null==t.reservedDataStore&&(t.reservedDataStore={}),t.reservedDataStore.physicsViewer=n;for(var o=0,i=t.meshes;o<i.length;o++){var r=i[o];r.physicsImpostor?(s=n.showImpostor(r.physicsImpostor,r))&&(s.reservedDataStore={hidden:!0},s.material&&(s.material.reservedDataStore={hidden:!0})):r.physicsBody&&(s=n.showBody(r.physicsBody))&&(s.reservedDataStore={hidden:!0},s.material&&(s.material.reservedDataStore={hidden:!0}))}for(var a=0,l=t.transformNodes;a<l.length;a++){var s,u=l[a];u.physicsBody&&(s=n.showBody(u.physicsBody))&&(s.reservedDataStore={hidden:!0},s.material&&(s.material.reservedDataStore={hidden:!0}))}}else t.reservedDataStore&&t.reservedDataStore.physicsViewer&&(t.reservedDataStore.physicsViewer.dispose(),t.reservedDataStore.physicsViewer=null)},t.GetImportMeshes=function(e,t){return null==e||null==t||""===t?null:null!=e.importMeshes?e.importMeshes.get(t.toLowerCase()):null},t.GetImportMeshesMap=function(e){return null==e?null:null!=e.importMeshes?e.importMeshes:null},t.ClearImportMeshes=function(e){if(null==e)return null;e.importMeshes,e.importMeshes=new Map},t.RegisterImportMeshes=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.importMeshes&&(e.importMeshes=new Map),e.importMeshes.set(t.toLowerCase(),n))},t.LoadImportMeshes=function(t,n,o,i,r,a,l,s,u){var c=null,d=n+o,p=e.SceneManager.GetImportMeshes(i,d);return null!=p?r&&r(p):c=BABYLON.SceneLoader.ImportMesh(t,n,o,i,function(t){e.SceneManager.RegisterImportMeshes(i,d,t),r&&r(t)},a,l,s,u),c},t.LoadImportMeshesAsync=function(t,n,o,i,l,s,u){return r(this,void 0,void 0,function(){var r,c,d,p;return a(this,function(a){switch(a.label){case 0:return r=n+o,null==(c=e.SceneManager.GetImportMeshes(i,r))?[3,1]:[2,c];case 1:return d=null,[4,BABYLON.SceneLoader.ImportMeshAsync(t,n,o,i,l,s,u)];case 2:return null!=(p=a.sent())&&null!=p.meshes&&(d=p.meshes),e.SceneManager.RegisterImportMeshes(i,r,d),[2,d]}})})},t.GetAssetContainer=function(e,t){return null==e||null==t||""===t?null:null!=e.assetContainers?e.assetContainers.get(t.toLowerCase()):null},t.GetAssetContainerMap=function(e){return null==e?null:null!=e.assetContainers?e.assetContainers:null},t.ClearAssetContainers=function(e){if(null==e)return null;e.assetContainers,e.assetContainers=new Map},t.RegisterAssetContainer=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.assetContainers&&(e.assetContainers=new Map),e.assetContainers.set(t.toLowerCase(),n))},t.LoadAssetContainer=function(t,n,o,i,r,a,l,s){var u=t+n,c=e.SceneManager.GetAssetContainer(o,u);null!=c?i&&i(c):BABYLON.SceneLoader.LoadAssetContainer(t,n,o,function(t){e.SceneManager.RegisterAssetContainer(o,u,t),i&&i(t)},r,a,l,s)},t.LoadAssetContainerAsync=function(t,n,o,i,l,s){return r(this,void 0,void 0,function(){var r,u,c;return a(this,function(a){switch(a.label){case 0:return r=t+n,null==(u=e.SceneManager.GetAssetContainer(o,r))?[3,1]:[2,u];case 1:return[4,BABYLON.SceneLoader.LoadAssetContainerAsync(t,n,o,i,l,s)];case 2:return c=a.sent(),e.SceneManager.RegisterAssetContainer(o,r,c),[2,c]}})})},t.GetMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetAbstractMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetAbstractMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformNode=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetTransformNodeByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformDetailMesh=function(e){var t=null,n=e.name+".Detail",o=e.getChildren(function(e){return e.name===n&&e instanceof BABYLON.AbstractMesh},!0);return null!=o&&o.length>0&&(t=o[0]),t},t.GetSkinnedMesh=function(e){return null!=e._skinnedMesh?e._skinnedMesh:null},t.GetPrimitiveMeshes=function(e){return e.getChildMeshes(!0,function(e){return e.name.indexOf("_primitive")>=0})},t.GetTransformLayer=function(e){return null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.layer?e.metadata.toolkit.layer:0},t.GetTransformLayerMask=function(e){return null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.layermask?e.metadata.toolkit.layermask:1},t.GetTransformLayerName=function(e){return null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.layername&&""!==e.metadata.toolkit.layername?e.metadata.toolkit.layername:"Default"},t.GetTransformTag=function(e){return null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.group&&""!==e.metadata.toolkit.group?e.metadata.toolkit.group:"Untagged"},t.HasTransformTags=function(e,t){return BABYLON.Tags.MatchesQuery(e,t)},t.TextureFloatSupported=function(e){var t=!1,n=!1,o=e.getEngine().getCaps();return o.textureHalfFloatRender&&o.textureHalfFloatLinearFiltering?t=!0:o.textureFloatRender&&o.textureFloatLinearFiltering&&(n=!0),t||n},t.RegisterClickAction=function(e,t,n){var o=null;return null!=t&&(t.isPickable=!0,null==t.actionManager&&(t.actionManager=new BABYLON.ActionManager(e)),o=t.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnPickTrigger},n))),o},t.UnregisterClickAction=function(e,t){var n=!1;return null!=e&&null!=t&&(n=e.actionManager.unregisterAction(t)),n},t.StartTweenAnimation=function(t,n,o,i,r,a,l,s,u,c,d){void 0===l&&(l=1),void 0===s&&(s=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null);var p=l||1,h=s||30,m=u||BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,f=e.Utilities.CreateTweenAnimation(n,i,r,a,h,m);null!=c&&f.setEasingFunction(c);var g=e.Utilities.GetLastKeyFrameIndex(f),y=m!=BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT;return t.beginDirectAnimation(o,[f],0,g,y,p,d)},t.GetMaterialWithName=function(e,t){var n=null;if(null!=e.materials&&e.materials.length>0){e.materials.length;for(var o=0;o<e.materials.length;o++){var i=e.materials[o];if(i.name.startsWith(t)){n=i;break}}}return n},t.GetAllMaterialsWithName=function(e,t){var n=null;if(null!=e.materials&&e.materials.length>0){e.materials.length;for(var o=0;o<e.materials.length;o++){var i=e.materials[o];i.name.startsWith(t)&&(null==n&&(n=[]),n.push(i))}}return n},t.InstantiatePrefabFromScene=function(t,n,o,i,r,a,l,s){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===s&&(s=!0);var u=null;if(null!=t&&null!=n&&""!==n){var c=t.getNodeByName(n);if(null!=c)if(null!=(u=c.clone(o,i,!1))){null!=r&&(u.position=r.clone()),null!=a&&(u.rotationQuaternion=a.clone()),null!=l&&(u.scaling=l.clone());var d=null,p=u.getChildren(null,!1);null!=p&&(d=p),null==d?d=[u]:d.unshift(u),d.forEach(function(e){if(e.setEnabled(!0),e instanceof BABYLON.AbstractMesh&&null!=e.metadata&&null!=e.metadata.shadowCastingMode&&0!==e.metadata.shadowCastingMode&&t.lights.forEach(function(t){var n=t.getShadowGenerator();if(null!=n&&!1==(null!=t.includedOnlyMeshes&&t.includedOnlyMeshes.length>0)){var o=n.getShadowMap();null==o.renderList&&(o.renderList=[]),o.renderList.indexOf(e)<0&&o.renderList.push(e)}}),e instanceof BABYLON.Mesh)if(null!=e.source){if(null==e.skeleton&&null!=e.source.skeleton){var n=e.source.skeleton.name+".Skeleton",o=n+"."+e.source.skeleton.id;if(e.skeleton=e.source.skeleton.clone(n,o),null!=e.skeleton&&null!=e.skeleton.bones&&null!=e.source.skeleton.bones&&e.skeleton.bones.length===e.source.skeleton.bones.length)for(var i=e.skeleton.bones.length,r=0;r<i;r++)null==e.skeleton.bones[r].metadata&&null!=e.source.skeleton.bones[r].metadata&&(e.skeleton.bones[r].metadata=e.source.skeleton.bones[r].metadata)}}else BABYLON.Tools.Warn("Babylon.js encountered a null clone source for: "+e.name)});var h=[];if(d.forEach(function(e){h.push(e)}),null!=h&&h.length>0){var m=[];e.Utilities.PostParseSceneComponents(t,h,null,m),t.onAfterRenderObservable.addOnce(function(){if(null!=m&&m.length>0)for(var e=0;e<m.length;e++){var t=m[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})}}else BABYLON.Tools.Warn("Failed to create prefab of: "+n);else BABYLON.Tools.Warn("Failed to lookup prefab map: "+n)}else BABYLON.Tools.Warn("Unable to locate prefab master: "+n);return u},t.InstantiatePrefabFromContainer=function(t,n,o,i,r,a,l,s,u){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===s&&(s=!0),void 0===u&&(u=!1);var c=e.Utilities.CloneAssetContainerItem(t,n,function(e){return e},i,u,s);if(null!=c){null!=o&&""!==o&&(c.name=o),null!=r&&(c.position=r.clone()),null!=a&&(c.rotationQuaternion=a.clone()),null!=l&&(c.scaling=l.clone());var d=[];d.push(c);var p=c.getChildren(null,!1);null!=p&&p.length>0&&p.forEach(function(e){d.push(e)}),d.forEach(function(t){t.id=e.Utilities.CreateGuid(),t.setEnabled(!0)});var h=[];e.Utilities.PostParseSceneComponents(t.scene,d,null,h),t.scene.onAfterRenderObservable.addOnce(function(){if(null!=h&&h.length>0)for(var e=0;e<h.length;e++){var t=h[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})}return c},t.InstantiateModelsFromContainer=function(t,n,o,i,r,a){void 0===n&&(n=null),void 0===o&&(o=!1),void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===a&&(a=null);var s=null,u=t.instantiateModelsToScene(n,i,{doNotInstantiate:!o,predicate:a});if(null!=u&&null!=u.rootNodes&&u.rootNodes.length>0){var c=u.rootNodes[0],d=c.getChildren(null,!1);!0===r&&e.SceneManager.RebuildBoundingBoxInfo(d),s=l([c],d,!0)}return s},t.CreateInstancedModelsFromContainer=function(t,n,o,i,r,a,l,s,u){void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=!0),void 0===s&&(s=!1),void 0===u&&(u=!1);var c=null,d=null,p=null,h=t.instantiateModelsToScene(function(e){return e},s,{doNotInstantiate:!1});if(null!=h&&(null!=h.rootNodes&&h.rootNodes.length>0&&(d=h.rootNodes[0].getChildren(null,!1),!0===u&&e.SceneManager.RebuildBoundingBoxInfo(d)),null!=h.animationGroups&&(p=h.animationGroups)),null!=d){if(c=d[0],null!=o&&(c.parent=o),null!=n&&""!==n&&(c.name=n),null!=i&&(c.position=i.clone()),null!=r&&(c.rotationQuaternion=r.clone()),null!=a&&(c.scaling=a.clone()),d.forEach(function(t){t.id=e.Utilities.CreateGuid(),t.setEnabled(!0)}),!0===l){var m=null;p.forEach(function(e){var t=e,n=null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.source&&""!==t.metadata.toolkit.source?t.metadata.toolkit.source:null;if(null!=n&&""!==n){var o=e.clone(e.name),i=n;null!=t.metadata&&(o.metadata={},o.metadata.toolkit={},o.metadata.toolkit.id=t.metadata.toolkit.id,o.metadata.toolkit.clip=t.metadata.toolkit.clip,o.metadata.toolkit.source=i,o.metadata.toolkit.legacy=t.metadata.toolkit.legacy,o.metadata.toolkit.length=t.metadata.toolkit.length,o.metadata.toolkit.looping=t.metadata.toolkit.looping,o.metadata.toolkit.settings=t.metadata.toolkit.settings,o.metadata.toolkit.behavior=t.metadata.toolkit.behavior,o.metadata.toolkit.wrapmode=t.metadata.toolkit.wrapmode,o.metadata.toolkit.framerate=t.metadata.toolkit.framerate,o.metadata.toolkit.humanmotion=t.metadata.toolkit.humanmotion,o.metadata.toolkit.averagespeed=t.metadata.toolkit.averagespeed,o.metadata.toolkit.averageduration=t.metadata.toolkit.averageduration,o.metadata.toolkit.averageangularspeed=t.metadata.toolkit.averageangularspeed),null==m&&(m=[]),m.push(o)}}),null!=c&&null!=m&&e.Utilities.AssignAnimationGroupsToInstance(c,m)}var f=[];e.Utilities.PostParseSceneComponents(t.scene,d,null,f),t.scene.onAfterRenderObservable.addOnce(function(){if(null!=f&&f.length>0)for(var e=0;e<f.length;e++){var t=f[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})}return h},t.CloneTransformNode=function(t,n,o,i,r,a,l){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerNode(t,n).clone(o,i,!0);return null!=s&&(null!=r&&(s.position=r.clone()),null!=a&&(s.rotationQuaternion=a.clone()),null!=l&&(s.scaling=l.clone()),s.setEnabled(!0)),s},t.CloneAbstractMesh=function(t,n,o,i,r,a,l){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerMesh(t,n).clone(o,i,!0);return null!=s&&(null!=r&&(s.position=r.clone()),null!=a&&(s.rotationQuaternion=a.clone()),null!=l&&(s.scaling=l.clone()),s.setEnabled(!0)),s},t.CreateInstancedMesh=function(t,n,o,i,r,a,l){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerMesh(t,n).createInstance(o);return null!=s&&(null!=i&&(s.parent=i),null!=r&&(s.position=r.clone()),null!=a&&(s.rotationQuaternion=a.clone()),null!=l&&(s.scaling=l.clone()),s.setEnabled(!0)),s},t.RebuildBoundingBoxInfo=function(e){null!=e&&e.length>0&&e.forEach(function(e){var t,n;if(e instanceof BABYLON.InstancedMesh){var o=null===(t=e.sourceMesh.getBoundingInfo())||void 0===t?void 0:t.boundingBox;null!=o&&null!=o.minimum&&null!=o.maximum&&e.setBoundingInfo(new BABYLON.BoundingInfo(o.minimum,o.maximum))}else if(e instanceof BABYLON.AbstractMesh){var i=null===(n=e.getBoundingInfo())||void 0===n?void 0:n.boundingBox;null!=i&&null!=i.minimum&&null!=i.maximum&&e.setBoundingInfo(new BABYLON.BoundingInfo(i.minimum,i.maximum))}})},t.AttachScriptComponent=function(e,t,n){void 0===n&&(n=!0),null!=e&&e.registerComponentInstance&&e.registerComponentInstance(e,t,n)},t.DestroyScriptComponent=function(e){null!=e&&e.destroyComponentInstance&&e.destroyComponentInstance(e)},t.DestroyGameObject=function(t){if(null!=t){var n=e.SceneManager.FindScriptComponents(t,!0);if(null!=n&&n.length>0)for(var o=0;o<n.length;o++){var i=n[o];e.SceneManager.DestroyScriptComponent(i)}e.SceneManager.SafeDestroy(t)}},t.GetComponent=function(t,n,o){return void 0===o&&(o=!1),e.SceneManager.FindScriptComponent(t,n,o)},t.GetComponents=function(t,n){return void 0===n&&(n=!1),e.SceneManager.FindScriptComponents(t,n)},t.FindGameObject=function(e,t){for(var n=t.split("/"),o=null,i=e.rootNodes,r=function(e){var t=n[e];if(0===e)o=i.find(function(e){return e.name===t})||null;else{if(!(o&&o instanceof BABYLON.TransformNode))return{value:null};o=o.getChildren(function(e){return e.name===t},!1)[0]||null}if(!o)return{value:null}},a=0;a<n.length;a++){var l=r(a);if("object"==typeof l)return l.value}return o},t.FindGameObjectWithTag=function(t,n){for(var o=function(t){if(e.SceneManager.GetTransformTag(t)===n)return t;if(t instanceof BABYLON.TransformNode)for(var i=0,r=t.getChildren();i<r.length;i++){var a=r[i];if(a instanceof BABYLON.TransformNode){var l=o(a);if(l)return l}}return null},i=0,r=t.rootNodes;i<r.length;i++){var a=r[i];if(a instanceof BABYLON.TransformNode){var l=o(a);if(l)return l}}return null},t.FindGameObjectsWithTag=function(t,n){for(var o=[],i=function(t){if(e.SceneManager.GetTransformTag(t)===n&&o.push(t),t instanceof BABYLON.TransformNode)for(var r=0,a=t.getChildren();r<a.length;r++){var l=a[r];l instanceof BABYLON.TransformNode&&i(l)}},r=0,a=t.rootNodes;r<a.length;r++){var l=a[r];l instanceof BABYLON.TransformNode&&i(l)}return o},t.FindScriptComponents=function(t,n){if(void 0===n&&(n=!1),null==t)return null;var o=null;if(null!=t.metadata&&t.metadata.toolkit){var i=t.metadata.toolkit;if(null!=i.components&&i.components.length>0)for(var r=0;r<i.components.length;r++){var a=i.components[r];null==o&&(o=[]),o.push(a.instance)}}if(!0===n){var l=t.getChildren(null,!1);if(null!=l)for(var s=0;s<l.length;s++){var u=l[s],c=e.SceneManager.FindScriptComponents(u,!1);null!=c&&(null==o&&(o=[]),o.push.apply(o,c))}}return null!=o?o:null},t.FindScriptComponent=function(t,n,o){if(void 0===o&&(o=!1),null==t)return null;var i=null;if(null!=t.metadata&&t.metadata.toolkit){var r=t.metadata.toolkit;if(null!=r.components&&r.components.length>0)for(var a=0;a<r.components.length;a++){var l=r.components[a];if(null!=l.instance&&l.klass===n){i=l.instance;break}}}if(null==i&&!0===o){var s=t.getChildren(null,!1);if(null!=s)for(var u=0;u<s.length;u++){var c=s[u];if(null!=(i=e.SceneManager.FindScriptComponent(c,n,!1)))break}}return null!=i?i:null},t.FindAllScriptComponents=function(t,n,o){if(void 0===o&&(o=!1),null==t)return null;var i=null;if(null!=t.metadata&&t.metadata.toolkit){var r=t.metadata.toolkit;if(null!=r.components&&r.components.length>0)for(var a=0;a<r.components.length;a++){var l=r.components[a];null!=l.instance&&l.klass===n&&(null==i&&(i=[]),i.push(l.instance))}}if(!0===o){var s=t.getChildren(null,!1);if(null!=s)for(var u=0;u<s.length;u++){var c=s[u],d=e.SceneManager.FindAllScriptComponents(c,n,!1);null!=d&&(null==i&&(i=[]),i.push.apply(i,d))}}return null!=i?i:null},t.FindSceneMetadata=function(e){return null==e?null:null!=e.metadata&&e.metadata.toolkit?e.metadata.toolkit:null},t.FindSceneCameraRig=function(e){return null==e?null:null!=e.cameraRig?e.cameraRig:null},t.FindSceneLightRig=function(e){return null==e?null:null!=e.lightRig?e.lightRig:null},t.FindTransformWithScript=function(t,n){var o=t.getNodes();return e.Utilities.SearchTransformNodeForScript(n,o)},t.FindAllTransformsWithScript=function(t,n){var o=t.getNodes();return e.Utilities.SearchAllTransformNodesForScript(n,o)},t.FindChildTransformNode=function(t,n,o,i,r){if(void 0===o&&(o=e.SearchType.ExactMatch),void 0===i&&(i=!0),void 0===r&&(r=null),null==t)return null;var a=null!=o?o:e.SearchType.ExactMatch,l=t.getChildren(r,i);return e.Utilities.SearchTransformNodes(n,l,a)},t.FindChildTransformWithTags=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchTransformNodeForTags(n,r)},t.FindAllChildTransformsWithTags=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchAllTransformNodesForTags(n,r)},t.FindChildTransformWithScript=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchTransformNodeForScript(n,r)},t.FindAllChildTransformsWithScript=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchAllTransformNodesForScript(n,r)},t.FindComponentInParent=function(t,n,o){var i=null!=n.parent?[n,n.parent]:[n],r=e.Utilities.SearchTransformNodeForScript(o,i);return e.SceneManager.FindScriptComponent(r,o)},t.FindComponentsInParent=function(t,n,o){var i=null,r=n.getChildren(null,!1),a=null!=r?l([n],r,!0):[n],s=e.Utilities.SearchAllTransformNodesForScript(o,a);return null!=s&&s.length>0&&s.forEach(function(t){var n=e.SceneManager.FindScriptComponent(t,o);null!=n&&(null==i&&(i=[]),i.push(n))}),null!=i?i:null},t.FindComponentInChildren=function(t,n,o){var i=n.getChildren(null,!1),r=null!=i?l([n],i,!0):[n],a=e.Utilities.SearchTransformNodeForScript(o,r);return e.SceneManager.FindScriptComponent(a,o)},t.FindComponentsInChildren=function(t,n,o){var i=null,r=n.getChildren(null,!1),a=null!=r?l([n],r,!0):[n],s=e.Utilities.SearchAllTransformNodesForScript(o,a);return null!=s&&s.length>0&&s.forEach(function(t){var n=e.SceneManager.FindScriptComponent(t,o);null!=n&&(null==i&&(i=[]),i.push(n))}),null!=i?i:null},t.SearchForScriptComponentByName=function(t,n){var o=t.getNodes(),i=e.Utilities.SearchTransformNodeForScript(n,o);return e.SceneManager.FindScriptComponent(i,n)},t.SearchForAllScriptComponentsByName=function(t,n){var o=null,i=t.getNodes(),r=e.Utilities.SearchAllTransformNodesForScript(n,i);return null!=r&&r.length>0&&r.forEach(function(t){var i=e.SceneManager.FindScriptComponent(t,n);null!=i&&(null==o&&(o=[]),o.push(i))}),null!=o?o:null},t.MoveWithCollisions=function(e,t){if(null==e)return null;null!=t&&e.moveWithCollisions(t)},t.MoveWithTranslation=function(e,t){if(null==e)return null;null!=t&&e.position.addInPlace(t)},t.TurnWithRotation=function(e,t,n){if(void 0===n&&(n=BABYLON.Space.LOCAL),null==e)return null;0!=t&&e.rotate(BABYLON.Axis.Y,t,n)},t.GetRecastHeapSize=function(){if("undefined"==typeof Recast)return 0;var e=0;return Recast&&Recast.HEAP8&&Recast.HEAP8.length&&(e=Recast.HEAP8.length/1048576),e},t.GetNavigationTools=function(){if("undefined"!=typeof Recast)return null==e.SceneManager.PluginInstance&&(e.SceneManager.PluginInstance=new e.RecastJSPluginExtension),e.SceneManager.PluginInstance},t.GetCrowdInterface=function(t){if("undefined"==typeof Recast)return null;if(e.SceneManager.HasNavigationData()){var n=e.SceneManager.GetNavigationTools();return null!=n&&null==e.SceneManager.CrowdInterface&&(e.SceneManager.CrowdInterface=n.createCrowd(e.SceneManager.MAX_AGENT_COUNT,e.SceneManager.MAX_AGENT_RADIUS,t)),e.SceneManager.CrowdInterface}return null},t.HasNavigationData=function(){if("undefined"==typeof Recast)return!1;var t=e.SceneManager.GetNavigationTools();return null!=t&&null!=t.navMesh},t.GetNavigationMesh=function(){return"undefined"==typeof Recast?null:e.SceneManager.NavigationMesh},t.BakeNavigationMesh=function(t,n,o,i,r,a,l){void 0===i&&(i=!1),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===l&&(l=0);var s=-1;if("undefined"==typeof Recast)return s;BABYLON.Tools.Log("Recast.js baking navigation mesh data");var u=e.SceneManager.GetNavigationTools();if(null!=u)if(s=u.createNavMesh(n,o),null!=u.navMesh){var c="NavigationMesh",d=t.getMaterialByName(c);null==d&&((d=new BABYLON.PBRMaterial(c,t)).albedoColor=r||new BABYLON.Color3(.2627451,.5960785,.7372549),d.unlit=!0,d.alpha=.5),e.SceneManager.NavigationMesh=u.createDebugNavMesh(t),null!=e.SceneManager.NavigationMesh&&(e.SceneManager.NavigationMesh.position=new BABYLON.Vector3(0,l,0),e.SceneManager.NavigationMesh.material=d,e.SceneManager.NavigationMesh.isPickable=!1,e.SceneManager.NavigationMesh.isVisible=!0,e.SceneManager.NavigationMesh.visibility=!0===i?1:0,e.SceneManager.NavigationMesh.renderingGroupId=e.Utilities.ColliderRenderGroup(),BABYLON.Tags.AddTagsTo(e.SceneManager.NavigationMesh,"Navigation"),e.Utilities.ValidateTransformMetadata(e.SceneManager.NavigationMesh),!0===a&&(e.SceneManager.NavigationMesh.checkCollisions=!0,e.SceneManager.NavigationMesh.metadata.toolkit.physics=e.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new BABYLON.Vector3(0,0,0)),e.SceneManager.NavigationMesh.metadata.toolkit.collision=e.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),e.RigidbodyPhysics.SetupPhysicsComponent(t,e.SceneManager.NavigationMesh))),null!=e.SceneManager.NavigationMesh?!0===e.SceneManager.OnNavMeshReadyObservable.hasObservers()&&e.SceneManager.OnNavMeshReadyObservable.notifyObservers(e.SceneManager.NavigationMesh):BABYLON.Tools.Warn("Failed to generate navigation mesh geometry")}else BABYLON.Tools.Warn("Failed to create navigation mesh data");return s},t.LoadNavigationMesh=function(t,n,o,i,r,a,l){void 0===o&&(o=!1),void 0===i&&(i=null),void 0===r&&(r=0),void 0===a&&(a=!1),void 0===l&&(l=0);var s=-1;if("undefined"==typeof Recast)return s;BABYLON.Tools.Log("Recast.js loading prebaked navigation mesh");var u=e.SceneManager.GetNavigationTools();if(null!=u)if(u.setTimeStep&&u.setTimeStep(r),s=u.buildFromNavmeshData(n),null!=u.navMesh){var c="NavigationMesh",d=t.getMaterialByName(c);null==d&&((d=new BABYLON.PBRMaterial(c,t)).albedoColor=i||new BABYLON.Color3(.2627451,.5960785,.7372549),d.unlit=!0,d.alpha=.5),e.SceneManager.NavigationMesh=u.createDebugNavMesh(t),null!=e.SceneManager.NavigationMesh&&(e.SceneManager.NavigationMesh.position=new BABYLON.Vector3(0,l,0),e.SceneManager.NavigationMesh.material=d,e.SceneManager.NavigationMesh.isPickable=!1,e.SceneManager.NavigationMesh.isVisible=!0,e.SceneManager.NavigationMesh.visibility=!0===o?1:0,e.SceneManager.NavigationMesh.renderingGroupId=e.Utilities.ColliderRenderGroup(),BABYLON.Tags.AddTagsTo(e.SceneManager.NavigationMesh,"Navigation"),e.Utilities.ValidateTransformMetadata(e.SceneManager.NavigationMesh),!0===a&&(e.SceneManager.NavigationMesh.checkCollisions=!0,e.SceneManager.NavigationMesh.metadata.toolkit.physics=e.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new BABYLON.Vector3(0,0,0)),e.SceneManager.NavigationMesh.metadata.toolkit.collision=e.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),e.RigidbodyPhysics.SetupPhysicsComponent(t,e.SceneManager.NavigationMesh))),null!=e.SceneManager.NavigationMesh?!0===e.SceneManager.OnNavMeshReadyObservable.hasObservers()&&e.SceneManager.OnNavMeshReadyObservable.notifyObservers(e.SceneManager.NavigationMesh):BABYLON.Tools.Warn("Failed to generate navigation mesh geometry")}else BABYLON.Tools.Warn("Failed to build navigation mesh data");return s},t.SaveNavigationMesh=function(){if("undefined"==typeof Recast)return null;var t=e.SceneManager.GetNavigationTools();return null!=t&&null!=t.navMesh?t.getNavmeshData():null},t.ComputeNavigationPath=function(t,n,o){if(void 0===o&&(o=!0),"undefined"==typeof Recast)return null;var i=e.SceneManager.GetNavigationTools(),r=!0===o?i.getClosestPoint(t):t,a=!0===o?i.getClosestPoint(n):n;return null!=i&&null!=i.navMesh?i.computePath(r,a):null},t.MoveAlongNavigationPath=function(e,t,n,o,i,r){void 0===i&&(i=null);var a=null;if(n&&n.length>0){for(var l=0,s=[{frame:0,value:t.position}],u=0;u<n.length;u++)l+=BABYLON.Vector3.Distance(s[u].value,n[u]),s.push({frame:l,value:n[u]});a=new BABYLON.Animation("Navigation","position",3,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),null!=i&&a.setEasingFunction(i),a.setKeys(s),t.animations=[a],e.beginAnimation(t,0,l,!1,o,r)}return a},t.AddNavigationCylinderObstacle=function(t,n,o){if("undefined"==typeof Recast)return null;var i=e.SceneManager.GetNavigationTools();return null!=i&&null!=i.navMesh?i.addCylinderObstacle(t,n,o):null},t.AddNavigationBoxObstacle=function(t,n,o){if("undefined"==typeof Recast)return null;var i=e.SceneManager.GetNavigationTools();return null!=i&&null!=i.navMesh?i.addBoxObstacle(t,n,o):null},t.RemoveNavigationObstacle=function(t){if("undefined"==typeof Recast)return null;var n=e.SceneManager.GetNavigationTools();null!=n&&null!=n.navMesh&&n.removeObstacle(t)},t.ToggleFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().switchFullscreen(t)},t.EnterFullscreenMode=function(t,n){void 0===n&&(n=!0),e.SceneManager.GotoFullscreenBrowser(t,n)},t.ExitFullscreenMode=function(t){e.SceneManager.ExitFromFullscreenBrowser(t)},t.GotoFullscreenBrowser=function(t,n){void 0===n&&(n=!0);var o=document.documentElement;o.requestFullscreen?o.requestFullscreen().then(function(){!0===n&&e.SceneManager.RequestBrowserPointerLock(o)}).catch(function(e){console.error("Error attempting to enable full-screen mode: ".concat(e.message," (").concat(e.name,")"))}):o.mozRequestFullScreen?(o.mozRequestFullScreen(),!0===n&&e.SceneManager.RequestBrowserPointerLock(o)):o.webkitRequestFullscreen?(o.webkitRequestFullscreen(),!0===n&&e.SceneManager.RequestBrowserPointerLock(o)):o.msRequestFullscreen?(o.msRequestFullscreen(),!0===n&&e.SceneManager.RequestBrowserPointerLock(o)):t.getEngine().enterFullscreen(n)},t.RequestBrowserPointerLock=function(e){e.requestPointerLock?e.requestPointerLock():e.mozRequestPointerLock?e.mozRequestPointerLock():e.webkitRequestPointerLock&&e.webkitRequestPointerLock()},t.ExitFromFullscreenBrowser=function(e){var t=document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen?t.webkitExitFullscreen():t.msExitFullscreen?t.msExitFullscreen():e.getEngine().exitFullscreen()},t.GlobalOptions={},t.WindowState={},t.ServerEndPoint="http://127.0.0.1:2567",t.EnableDebugMode=!1,t.EnableUserInput=!0,t.RenderLoopReady=!0,t.PauseRenderLoop=!1,t.LostRenderContext=!1,t.AutoUpdateProgress=!0,t.PhysicsCapsuleShape=0,t.SupportSRGBBuffers=!1,t.AnimationStartMode=0,t.AnimationTargetFps=60,t.DefaultConvexHullMargin=.001,t.DefaultHeightFieldMargin=.001,t.AmbientLightIntensity=1,t.PointLightIntensity=1,t.SpotLightIntensity=1,t.DirectionalLightIntensity=1,t.TerrainColorCorrection=2.2,t.AllowCameraMovement=!0,t.AllowCameraRotation=!0,t.VirtualJoystickEnabled=!1,t.GameTimeMilliseconds=0,t.ParseScriptComponents=!0,t.AutoLoadScriptBundles=!0,t.AutoStripNamespacePrefix=!0,t.UniversalModuleDefinition=!0,t.WaitForSeconds=function(t){return new Promise(function(n){return e.WindowManager.SetTimeout(1e3*t,n)})},t.OnPreRenderLoopObservable=new BABYLON.Observable,t.OnPostRenderLoopObservable=new BABYLON.Observable,t.OnSceneReadyObservable=new BABYLON.Observable,t.OnEngineResizeObservable=new BABYLON.Observable,t.OnLoadCompleteObservable=new BABYLON.Observable,t.OnRebuildContextObservable=new BABYLON.Observable,t.OnAssetManagerProgress=null,t._HideLoadingScreen=null,t.CVTOOLS_NAME="CVTOOLS_unity_metadata",t.CVTOOLS_MESH="CVTOOLS_babylon_mesh",t.CVTOOLS_HAND="CVTOOLS_left_handed",t.CVTOOLS_NAME_REGISTERED=!1,t.CVTOOLS_MESH_REGISTERED=!1,t.CVTOOLS_HAND_REGISTERED=!1,t._EventBus=null,t.SceneLoaderFileNames=[],t.SceneLoaderPropertyBag={},t.SceneLoaderHandledFlag=!1,t.SceneParsingEnabled=!0,t.PhysicsViewersEnabled=!1,t.MAX_AGENT_COUNT=200,t.MAX_AGENT_RADIUS=2,t.NavigationMesh=null,t.CrowdInterface=null,t.PluginInstance=null,t.OnNavMeshReadyObservable=new BABYLON.Observable,t}();e.SceneManager=t}(o||(o={})),o.SceneManager.GameTimeMilliseconds=o.SceneManager.GetTimeMilliseconds(),function(e){var t=function(){function t(t,n,o,i){if(void 0===o&&(o={}),void 0===i&&(i=null),this._update=null,this._late=null,this._step=null,this._fixed=null,this._after=null,this._ready=null,this._lateUpdate=!1,this._properties=null,this._awoken=!1,this._started=!1,this._scene=null,this._delyed=!1,this._transform=null,this._scriptReady=!1,this._registeredClassname=null,this._registerComponentAlias=!0,this._lateUpdateObserver=null,this.resetScriptComponent=null,this._bodyCollisionObserver=null,this._bodyCollisionEndedObserver=null,this._worldTriggerEventObserver=null,this.onCollisionEnterObservable=new BABYLON.Observable,this.onCollisionStayObservable=new BABYLON.Observable,this.onCollisionExitObservable=new BABYLON.Observable,this.onTriggerEnterObservable=new BABYLON.Observable,this.onTriggerExitObservable=new BABYLON.Observable,null==t)throw new Error("Null transform object specified.");if(null==n)throw new Error("Null host scene object specified.");this._scene=n,this._transform=t,this._properties=o||{},null!=this._properties._scriptComponentAlias&&""!==this._properties._scriptComponentAlias?this._registeredClassname=this._properties._scriptComponentAlias:this._registeredClassname=i||this.constructor.name||"Unknown",null!=this._properties._registerComponentAlias?this._registerComponentAlias=this._properties._registerComponentAlias:this._registerComponentAlias=!0;var r=this;r._update=function(){e.ScriptComponent.UpdateInstance(r)},r._late=function(){e.ScriptComponent.LateInstance(r)},r._step=function(){e.ScriptComponent.StepInstance(r)},r._fixed=function(){e.ScriptComponent.FixedInstance(r)},r._after=function(){e.ScriptComponent.AfterInstance(r)},r._ready=function(){e.ScriptComponent.ReadyInstance(r)},r.resetScriptComponent=function(){e.ScriptComponent.ResetInstance(r)},r.registerComponentInstance&&r.destroyComponentInstance||BABYLON.Tools.Warn("Invalid component registration handlers for: "+this._transform.name),!0===this._registerComponentAlias&&null!=r.registerComponentInstance&&r.registerComponentInstance(r,this._registeredClassname,!0)}return t.prototype.isReady=function(){return this._scriptReady},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){},t.prototype.getClassName=function(){return this._registeredClassname},t.prototype.setProperty=function(e,t){null==this._properties&&(this._properties={}),this._properties[e]=t},t.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=this._properties&&null==(n=this._properties[e])&&(n=this._properties["auto__"+e]),null==n&&(n=t),null!=n?n:null},t.prototype.getTime=function(){return e.SceneManager.GetTime()},t.prototype.getTimeMs=function(){return e.SceneManager.GetTimeMs()},t.prototype.getGameTime=function(){return e.SceneManager.GetGameTime()},t.prototype.getGameTimeMs=function(){return e.SceneManager.GetGameTimeMs()},t.prototype.getDeltaTime=function(){return e.SceneManager.GetDeltaTime(this.scene)},t.prototype.getDeltaSeconds=function(){return e.SceneManager.GetDeltaSeconds(this.scene)},t.prototype.getDeltaMilliseconds=function(){return e.SceneManager.GetDeltaMilliseconds(this.scene)},t.prototype.getAnimationRatio=function(){return e.SceneManager.GetAnimationRatio(this.scene)},t.prototype.hasSkinnedMesh=function(){return null!=this.getSkinnedMesh()},t.prototype.getSkinnedMesh=function(){return e.SceneManager.GetSkinnedMesh(this.transform)},t.prototype.getTransformMesh=function(){return this._transform instanceof BABYLON.Mesh?this._transform:null},t.prototype.getAbstractMesh=function(){return this._transform instanceof BABYLON.AbstractMesh?this._transform:null},t.prototype.getInstancedMesh=function(){return this._transform instanceof BABYLON.InstancedMesh?this._transform:null},t.prototype.getPrimitiveMeshes=function(){return e.SceneManager.GetPrimitiveMeshes(this.transform)},t.prototype.getMetadata=function(){return e.SceneManager.FindSceneMetadata(this._transform)},t.prototype.getComponent=function(t,n){void 0===n&&(n=!1);var o=e.SceneManager.FindScriptComponent(this._transform,t,n);return null!=o?o:null},t.prototype.getComponents=function(t,n){void 0===n&&(n=!1);var o=e.SceneManager.FindAllScriptComponents(this._transform,t,n);return null!=o?o:null},t.prototype.getLightRig=function(){return e.SceneManager.FindSceneLightRig(this._transform)},t.prototype.getCameraRig=function(){return e.SceneManager.FindSceneCameraRig(this._transform)},t.prototype.getTransformTag=function(){return e.SceneManager.GetTransformTag(this.transform)},t.prototype.hasTransformTags=function(t){return e.SceneManager.HasTransformTags(this._transform,t)},t.prototype.getChildNode=function(t,n,o,i){return void 0===n&&(n=e.SearchType.ExactMatch),void 0===o&&(o=!0),void 0===i&&(i=null),e.SceneManager.FindChildTransformNode(this._transform,t,n,o,i)},t.prototype.getChildWithTags=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindChildTransformWithTags(this._transform,t,n,o)},t.prototype.getChildrenWithTags=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindAllChildTransformsWithTags(this._transform,t,n,o)},t.prototype.getChildWithScript=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindChildTransformWithScript(this._transform,t,n,o)},t.prototype.getChildrenWithScript=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindAllChildTransformsWithScript(this._transform,t,n,o)},t.prototype.enableCollisionEvents=function(){var t=this,n=e.Utilities.GetHavokPlugin();if(null!=n&&null!=this.transform.physicsBody){if(this.transform.physicsBody.setCollisionCallbackEnabled(!0),this.transform.physicsBody.setCollisionEndedCallbackEnabled(!0),null==this._bodyCollisionObserver){var o=this.transform.physicsBody.getCollisionObservable();null!=o&&(this._bodyCollisionObserver=o.add(function(e){null!=e.collidedAgainst&&null!=e.collidedAgainst.transformNode&&("COLLISION_STARTED"===e.type?t.onCollisionEnterObservable.notifyObservers(e.collidedAgainst.transformNode):"COLLISION_CONTINUED"===e.type&&t.onCollisionStayObservable.notifyObservers(e.collidedAgainst.transformNode))}))}if(null==this._bodyCollisionEndedObserver){var i=this.transform.physicsBody.getCollisionEndedObservable();null!=i&&(this._bodyCollisionEndedObserver=i.add(function(e){null!=e.collidedAgainst&&null!=e.collidedAgainst.transformNode&&"COLLISION_FINISHED"===e.type&&t.onCollisionExitObservable.notifyObservers(e.collidedAgainst.transformNode)}))}null==this._worldTriggerEventObserver&&(this._worldTriggerEventObserver=n.onTriggerCollisionObservable.add(function(e){if(e.collider===t.transform.physicsBody||e.collidedAgainst===t.transform.physicsBody){var n=e.collider===t.transform.physicsBody?e.collidedAgainst:e.collider;"TRIGGER_ENTERED"===e.type?t.onTriggerEnterObservable.notifyObservers(n.transformNode):"TRIGGER_EXITED"===e.type&&t.onTriggerExitObservable.notifyObservers(n.transformNode)}}))}},t.prototype.disableCollisionEvents=function(){null!=e.Utilities.GetHavokPlugin()&&null!=this.transform.physicsBody&&(this.transform.physicsBody.setCollisionCallbackEnabled(!1),this.transform.physicsBody.setCollisionEndedCallbackEnabled(!1))},t.prototype.setTransformPosition=function(e){this.transform.physicsBody&&(this.transform.physicsBody.disablePreStep=!1),null!=this.transform.position&&this.transform.position.copyFrom(e)},t.prototype.setTransformRotation=function(e){this.transform.physicsBody&&(this.transform.physicsBody.disablePreStep=!1),null!=this.transform.rotationQuaternion&&this.transform.rotationQuaternion.copyFrom(e)},t.prototype.registerOnClickAction=function(t){var n=null;return this.transform instanceof BABYLON.AbstractMesh&&(n=e.SceneManager.RegisterClickAction(this.scene,this.transform,t)),n},t.prototype.unregisterOnClickAction=function(t){var n=!1;return this.transform instanceof BABYLON.AbstractMesh&&(n=e.SceneManager.UnregisterClickAction(this.transform,t)),n},t.prototype.registerComponentInstance=function(t,n,o){if(void 0===o&&(o=!0),null!=n&&""!==n&&"Unknown"!==n){if(!0===o){e.Utilities.ValidateTransformMetadata(this._transform);var i={alias:"script",order:0,klass:n,properties:null,instance:t};null==this._transform.metadata.toolkit.components&&(this._transform.metadata.toolkit.components=[]),this._transform.metadata.toolkit.components.push(i)}e.ScriptComponent.RegisterInstance(t),!0===o&&t.scene.onAfterRenderObservable.addOnce(function(){t.delayComponentInstance(t)})}else console.warn("Failed to register unknown component instance: ",t)},t.prototype.delayComponentInstance=function(t){e.WindowManager.SetTimeout(100,function(){t._delyed=!0})},t.prototype.destroyComponentInstance=function(t){e.ScriptComponent.DestroyInstance(t)},t.prototype.setupStepComponentInstance=function(e){e.scene.onBeforePhysicsObservable&&e.scene.onBeforePhysicsObservable.add(e._step)},t.prototype.removeStepComponentInstance=function(e){e.scene.onBeforePhysicsObservable&&e.scene.onBeforePhysicsObservable.removeCallback(e._step)},t.prototype.setupFixedComponentInstance=function(e){e.scene.onAfterPhysicsObservable&&e.scene.onAfterPhysicsObservable.add(e._fixed)},t.prototype.removeFixedComponentInstance=function(e){e.scene.onAfterPhysicsObservable&&e.scene.onAfterPhysicsObservable.removeCallback(e._fixed)},t.RegisterInstance=function(e){null!=e&&(null!=e._update&&e.scene.registerBeforeRender(e._update),e.late&&null!=e._late&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&(e._lateUpdateObserver=e.scene.onBeforeRenderTargetsRenderObservable.add(e._late)),e.after&&null!=e._after&&e.scene.registerAfterRender(e._after),e.step&&null!=e._step&&e.setupStepComponentInstance(e),e.fixed&&null!=e._fixed&&e.setupFixedComponentInstance(e))},t.UpdateInstance=function(t){null!=t&&null!=t.transform&&t.transform.isEnabled(!1)&&(!1===t._awoken?(t._awoken=!0,e.ScriptComponent.ParseAutoProperties(t),t.awake&&t.awake()):!1===t._started?(t._started=!0,t.start&&t.start()):!0===t._awoken&&!0===t._started&&(!0===t._delyed&&(t._delyed=!1,e.ScriptComponent.ReadyInstance(t)),t.update&&t.update(),t._lateUpdate=!0))},t.LateInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&!0===e._lateUpdate&&(e._lateUpdate=!1,!0===e._started&&e.late&&e.late())},t.AfterInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&!0===e._started&&e.after&&e.after()},t.StepInstance=function(e){null!=e&&null!=e.transform&&!0===e._started&&e.step&&e.step()},t.FixedInstance=function(e){null!=e&&null!=e.transform&&!0===e._started&&e.fixed&&e.fixed()},t.ReadyInstance=function(e){null!=e&&null!=e.transform&&!1===e._scriptReady&&(e._scriptReady=!0,e.ready&&e.ready())},t.ResetInstance=function(e){null!=e&&null!=e.transform&&!0===e._started&&e.reset&&e.reset()},t.DestroyInstance=function(t){if(null!=t){t.scene.unregisterBeforeRender(t._update),null!=t._lateUpdateObserver&&null!=t.scene.onBeforeRenderTargetsRenderObservable&&t.scene.onBeforeRenderTargetsRenderObservable.remove(t._lateUpdateObserver),t.after&&null!=t._after&&t.scene.unregisterAfterRender(t._after),t.step&&null!=t._step&&t.removeStepComponentInstance(t),t.fixed&&null!=t._fixed&&t.removeFixedComponentInstance(t);var n=e.Utilities.GetHavokPlugin();if(null!=n){if(null!=t._bodyCollisionObserver)try{t._bodyCollisionObserver.remove()}catch(e){}if(null!=t._bodyCollisionEndedObserver)try{t._bodyCollisionEndedObserver.remove()}catch(e){}if(null!=t._worldTriggerEventObserver)try{n.onTriggerCollisionObservable.remove(t._worldTriggerEventObserver)}catch(e){}}try{t.onCollisionEnterObservable.clear()}catch(e){}try{t.onCollisionStayObservable.clear()}catch(e){}try{t.onCollisionExitObservable.clear()}catch(e){}try{t.onTriggerEnterObservable.clear()}catch(e){}try{t.onTriggerExitObservable.clear()}catch(e){}try{t.destroy&&t.destroy()}catch(e){}t._scriptReady=!1,t._transform=null,t._properties=null,t._started=!1,t._delyed=!1,t._update=null,t._late=null,t._step=null,t._fixed=null,t._after=null,t._ready=null,t._scene=null}},t.ParseAutoProperties=function(t){var n=Object.keys(t._properties);if(null!=n&&n.length>0)for(var o=function(o){var i=n[o];if(e.Utilities.StartsWith(i,"auto__")){var r=i.replace("auto__","");if(e.Utilities.HasOwnProperty(t,r)){var a=t.getProperty(i);if(null!=a){var l=typeof a;if(null!=l&&""!==l)if("object"===l)if(Array.isArray(a)){var s=[];a.forEach(function(n){null!=n&&("object"==typeof n?s.push(e.ScriptComponent.UnpackObjectProperty(n,t.scene)):s.push(n))}),t[r]=s}else{var u=t[r],c=e.ScriptComponent.UnpackObjectProperty(a,t.scene);u instanceof BABYLON.Color3&&c instanceof BABYLON.Color4?t[r]=new BABYLON.Color3(c.r,c.g,c.b):t[r]=c}else t[r]=a;else t[r]=a}else t[r]=a}else BABYLON.Tools.Warn(t.getClassName()||"Unregistered Class: Auto property '"+r+"' not found for transform '"+t.transform.name+"'")}},i=0;i<n.length;i++)o(i)},t.UnpackObjectProperty=function(t,n){var o=null;if(null!=t)if(void 0!==t.x&&void 0!==t.y)o=void 0!==t.z?void 0!==t.w?new BABYLON.Vector4(t.x,t.y,t.z,t.w):new BABYLON.Vector3(t.x,t.y,t.z):new BABYLON.Vector2(t.x,t.y);else if(void 0!==t.r&&void 0!==t.g&&void 0!==t.b){var i=1;void 0!==t.a&&(i=t.a),o=new BABYLON.Color4(t.r,t.g,t.b,i)}else if(void 0!==t.type)switch(t.type){case"UnityEngine.AnimationCurve":var r=t;o=BABYLON.Animation.Parse(r.animation);break;case"UnityEngine.Transform":var a=t;o=e.Utilities.ParseTransformByID(a,n);break;case"UnityEngine.Material":var l=t;o=n.getMaterialByName(l.name);break;case"UnityEngine.Texture2D":var s=t;o=e.Utilities.ParseTexture(s,n);break;case"UnityEngine.Cubemap":var u=t;o=e.Utilities.ParseCubemap(u,n);break;case"UnityEngine.AudioClip":case"UnityEngine.Video.VideoClip":case"UnityEngine.Font":default:o=t;break;case"UnityEngine.TextAsset":var c=t;o=null!=c.base64?!0===c.json?JSON.parse(e.WindowManager.Atob(c.base64)):e.WindowManager.Atob(c.base64):c;break;case"UnityEditor.DefaultAsset":var d=t;o=null!=d.base64?!0===d.json?JSON.parse(e.WindowManager.Atob(d.base64)):e.WindowManager.Atob(d.base64):d}else o=t;return o},t}();e.ScriptComponent=t}(o||(o={})),function(e){var t,n,o,r,a,l,s,u,c,d,p,h,m,f,g,y,v;(v=e.System||(e.System={}))[v.Deg2Rad=2*Math.PI/360]="Deg2Rad",v[v.Rad2Deg=1/e.System.Deg2Rad]="Rad2Deg",v[v.Epsilon=1e-6]="Epsilon",v[v.SingleEpsilon=1401298e-51]="SingleEpsilon",v[v.EpsilonNormalSqrt=1e-15]="EpsilonNormalSqrt",v[v.Kph2Mph=.621371]="Kph2Mph",v[v.Mph2Kph=1.60934]="Mph2Kph",v[v.Mps2Kph=3.6]="Mps2Kph",v[v.Mps2Mph=2.23694]="Mps2Mph",v[v.Meter2Inch=39.3701]="Meter2Inch",v[v.Inch2Meter=.0254]="Inch2Meter",v[v.Gravity=9.81]="Gravity",v[v.Gravity3G=29.400000000000002]="Gravity3G",v[v.SkidFactor=.25]="SkidFactor",v[v.MaxInteger=2147483647]="MaxInteger",v[v.WalkingVelocity=4.4]="WalkingVelocity",v[v.TerminalVelocity=55]="TerminalVelocity",v[v.SmoothDeltaFactor=.2]="SmoothDeltaFactor",v[v.ToLinearSpace=2.2]="ToLinearSpace",v[v.ToGammaSpace=.45454545454545453]="ToGammaSpace",(y=e.Handedness||(e.Handedness={}))[y.Default=-1]="Default",y[y.Right=0]="Right",y[y.Left=1]="Left",(g=e.SearchType||(e.SearchType={}))[g.ExactMatch=0]="ExactMatch",g[g.StartsWith=1]="StartsWith",g[g.EndsWith=2]="EndsWith",g[g.IndexOf=3]="IndexOf",(f=e.PlayerNumber||(e.PlayerNumber={}))[f.Auto=0]="Auto",f[f.One=1]="One",f[f.Two=2]="Two",f[f.Three=3]="Three",f[f.Four=4]="Four",(m=e.PlayerControl||(e.PlayerControl={}))[m.FirstPerson=0]="FirstPerson",m[m.ThirdPerson=1]="ThirdPerson",(h=e.RenderQuality||(e.RenderQuality={}))[h.High=0]="High",h[h.Medium=1]="Medium",h[h.Low=2]="Low",(p=e.GamepadType||(e.GamepadType={}))[p.None=-1]="None",p[p.Generic=0]="Generic",p[p.Xbox360=1]="Xbox360",p[p.DualShock=2]="DualShock",p[p.PoseController=3]="PoseController",(d=e.Xbox360Trigger||(e.Xbox360Trigger={}))[d.Left=0]="Left",d[d.Right=1]="Right",(c=e.MovementType||(e.MovementType={}))[c.DirectVelocity=0]="DirectVelocity",c[c.AppliedForces=1]="AppliedForces",(u=e.CollisionContact||(e.CollisionContact={}))[u.Top=0]="Top",u[u.Left=1]="Left",u[u.Right=2]="Right",u[u.Bottom=3]="Bottom",(s=e.IntersectionPrecision||(e.IntersectionPrecision={}))[s.AABB=0]="AABB",s[s.OBB=1]="OBB",(l=e.CollisionFilters||(e.CollisionFilters={}))[l.DefaultFilter=1]="DefaultFilter",l[l.StaticFilter=2]="StaticFilter",l[l.KinematicFilter=4]="KinematicFilter",l[l.DebrisFilter=8]="DebrisFilter",l[l.SensorTrigger=16]="SensorTrigger",l[l.CharacterFilter=32]="CharacterFilter",l[l.AllFilter=-1]="AllFilter",(a=e.CollisionState||(e.CollisionState={}))[a.ACTIVE_TAG=1]="ACTIVE_TAG",a[a.ISLAND_SLEEPING=2]="ISLAND_SLEEPING",a[a.WANTS_DEACTIVATION=3]="WANTS_DEACTIVATION",a[a.DISABLE_DEACTIVATION=4]="DISABLE_DEACTIVATION",a[a.DISABLE_SIMULATION=5]="DISABLE_SIMULATION",(r=e.CollisionFlags||(e.CollisionFlags={}))[r.CF_STATIC_OBJECT=1]="CF_STATIC_OBJECT",r[r.CF_KINEMATIC_OBJECT=2]="CF_KINEMATIC_OBJECT",r[r.CF_NO_CONTACT_RESPONSE=4]="CF_NO_CONTACT_RESPONSE",r[r.CF_CUSTOM_MATERIAL_CALLBACK=8]="CF_CUSTOM_MATERIAL_CALLBACK",r[r.CF_CHARACTER_OBJECT=16]="CF_CHARACTER_OBJECT",r[r.CF_DISABLE_VISUALIZE_OBJECT=32]="CF_DISABLE_VISUALIZE_OBJECT",r[r.CF_DISABLE_SPU_COLLISION_PROCESSING=64]="CF_DISABLE_SPU_COLLISION_PROCESSING",r[r.CF_HAS_CONTACT_STIFFNESS_DAMPING=128]="CF_HAS_CONTACT_STIFFNESS_DAMPING",r[r.CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR=256]="CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR",r[r.CF_HAS_FRICTION_ANCHOR=512]="CF_HAS_FRICTION_ANCHOR",r[r.CF_HAS_COLLISION_SOUND_TRIGGER=1024]="CF_HAS_COLLISION_SOUND_TRIGGER",(o=e.UserInputPointer||(e.UserInputPointer={}))[o.Left=0]="Left",o[o.Middle=1]="Middle",o[o.Right=2]="Right",(n=e.UserInputAxis||(e.UserInputAxis={}))[n.Horizontal=0]="Horizontal",n[n.Vertical=1]="Vertical",n[n.ClientX=2]="ClientX",n[n.ClientY=3]="ClientY",n[n.MouseX=4]="MouseX",n[n.MouseY=5]="MouseY",n[n.Wheel=6]="Wheel",(t=e.UserInputKey||(e.UserInputKey={}))[t.BackSpace=8]="BackSpace",t[t.Tab=9]="Tab",t[t.Enter=13]="Enter",t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Pause=19]="Pause",t[t.Break=19]="Break",t[t.CapsLock=20]="CapsLock",t[t.Escape=27]="Escape",t[t.SpaceBar=32]="SpaceBar",t[t.PageUp=33]="PageUp",t[t.PageDown=34]="PageDown",t[t.End=35]="End",t[t.Home=36]="Home",t[t.LeftArrow=37]="LeftArrow",t[t.UpArrow=38]="UpArrow",t[t.RightArrow=39]="RightArrow",t[t.DownArrow=40]="DownArrow",t[t.Insert=45]="Insert",t[t.Delete=46]="Delete",t[t.Num0=48]="Num0",t[t.Num1=49]="Num1",t[t.Num2=50]="Num2",t[t.Num3=51]="Num3",t[t.Num4=52]="Num4",t[t.Num5=53]="Num5",t[t.Num6=54]="Num6",t[t.Num7=55]="Num7",t[t.Num8=56]="Num8",t[t.Num9=57]="Num9",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.LeftWindowKey=91]="LeftWindowKey",t[t.RightWindowKey=92]="RightWindowKey",t[t.SelectKey=93]="SelectKey",t[t.Numpad0=96]="Numpad0",t[t.Numpad1=97]="Numpad1",t[t.Numpad2=98]="Numpad2",t[t.Numpad3=99]="Numpad3",t[t.Numpad4=100]="Numpad4",t[t.Numpad5=101]="Numpad5",t[t.Numpad6=102]="Numpad6",t[t.Numpad7=103]="Numpad7",t[t.Numpad8=104]="Numpad8",t[t.Numpad9=105]="Numpad9",t[t.Multiply=106]="Multiply",t[t.Add=107]="Add",t[t.Subtract=109]="Subtract",t[t.DecimalPoint=110]="DecimalPoint",t[t.Divide=111]="Divide",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NumLock=144]="NumLock",t[t.ScrollLock=145]="ScrollLock",t[t.SemiColon=186]="SemiColon",t[t.EqualSign=187]="EqualSign",t[t.Comma=188]="Comma",t[t.Dash=189]="Dash",t[t.Period=190]="Period",t[t.ForwardSlash=191]="ForwardSlash",t[t.GraveAccent=192]="GraveAccent",t[t.OpenBracket=219]="OpenBracket",t[t.BackSlash=220]="BackSlash",t[t.CloseBraket=221]="CloseBraket",t[t.SingleQuote=222]="SingleQuote";var _=function(){function e(){}return e.KeyboardSmoothing=!1,e.KeyboardMoveSensibility=3,e.KeyboardArrowSensibility=1,e.KeyboardMoveDeadZone=.001,e.GamepadDeadStickValue=.15,e.GamepadLStickXInverted=!1,e.GamepadLStickYInverted=!1,e.GamepadRStickXInverted=!1,e.GamepadRStickYInverted=!0,e.GamepadLStickSensibility=1,e.GamepadRStickSensibility=1,e.SupportedInputDevices=null,e.BabylonAngularSensibility=2e3,e.DefaultAngularSensibility=.5,e.PointerWheelDeadZone=.1,e.PointerMouseDeadZone=.1,e.PointerMouseInverted=!0,e.UseCanvasElement=!0,e.UseArrowKeyRotation=!1,e.EnableBabylonRotation=!1,e}();e.UserInputOptions=_;e.RequestHeader=function(){};e.TriggerVolume=function(){this.mesh=null,this.state=0};e.RoomErrorMessage=function(){};var b=function(){function e(e,t,n,o,i){void 0===n&&(n=!0),void 0===o&&(o=null),void 0===i&&(i=null),this.loadingDivId=e,this.loadingUIText=t,this.hideLoadingUIWithEngine=n,this.customInnerHtml=o,this.customInnerCss=i,this.loadingUIBackgroundColor="#000000",null!=this.loadingDivId&&""!==this.loadingDivId||(this.loadingDivId="customLoadingScreen"),null!=this.loadingUIText&&""!==this.loadingUIText||(this.loadingUIText="Please Wait")}return e.prototype.displayLoadingUI=function(){if(this.hasLoadingDiv())this.showLoadingDiv(!0);else{var e=document.createElement("style");e.type="text/css",e.innerHTML=this.customInnerCss||"",document.getElementsByTagName("head")[0].appendChild(e);var t=this.loadingUIText,n=document.createElement("div");n.id=this.loadingDivId,n.innerHTML=this.customInnerHtml||t,document.body.appendChild(n)}},e.prototype.hideLoadingUI=function(){!0===this.hideLoadingUIWithEngine&&this.showLoadingDiv(!1)},e.prototype.showLoadingDiv=function(e){var t=this.getLoadingDiv();null!=t&&(t.style.display=e?"initial":"none")},e.prototype.getLoadingDiv=function(){return document.getElementById(this.loadingDivId)},e.prototype.hasLoadingDiv=function(){return null!=document.getElementById(this.loadingDivId)},e}();e.CustomLoadingScreen=b;var B=function(){function e(){this.ListenerDictionary={}}return e.prototype.OnMessage=function(e,t){var n;null==this.ListenerDictionary[e]?(n=[],this.ListenerDictionary[e]=n):n=this.ListenerDictionary[e],n.findIndex(function(e){return t==e})<0&&n.push(t)},e.prototype.PostMessage=function(e,t){void 0===t&&(t=null);var n=this.ListenerDictionary[e];null!=n&&n.forEach(function(e){try{e&&e(t)}catch(e){console.warn(e)}})},e.prototype.RemoveHandler=function(e,t){var n=this.ListenerDictionary[e];if(null!=n){var o=n.findIndex(function(e){return t==e});o>=0&&n.splice(o,1)}},e.prototype.ResetHandlers=function(){this.ListenerDictionary={}},e.prototype.Dispose=function(){this.ResetHandlers()},e}();e.LocalMessageBus=B;var C=function(){function e(){this.ListenerDictionary={},window&&window.top?(this.HandleWindowMessage=this.HandleWindowMessage.bind(this),window.top.addEventListener("message",this.HandleWindowMessage)):console.warn("GlobalMessageBus: No Top Window Available")}return e.prototype.OnMessage=function(e,t){var n;null==this.ListenerDictionary[e]?(n=[],this.ListenerDictionary[e]=n):n=this.ListenerDictionary[e],n.findIndex(function(e){return t==e})<0&&n.push(t)},e.prototype.PostMessage=function(e,t,n,o){void 0===t&&(t=null),void 0===n&&(n="*"),window&&window.top?window.top.postMessage({source:"eventbus",message:e,data:t},n,o):console.warn("GlobalMessageBus: No Top Window Available")},e.prototype.RemoveHandler=function(e,t){var n=this.ListenerDictionary[e];if(null!=n){var o=n.findIndex(function(e){return t==e});o>=0&&n.splice(o,1)}},e.prototype.ResetHandlers=function(){this.ListenerDictionary={}},e.prototype.Dispose=function(){this.ResetHandlers(),window&&window.top&&window.top.removeEventListener("message",this.HandleWindowMessage)},e.prototype.HandleWindowMessage=function(e){null!=e&&null!=e.data&&null!=e.data.message&&null!=e.data.source&&"eventbus"==e.data.source&&this.OnDispatchMessage(e.data.message,null!=e.data.data?e.data.data:null)},e.prototype.OnDispatchMessage=function(e,t){void 0===t&&(t=null);var n=this.ListenerDictionary[e];null!=n&&n.forEach(function(e){try{e&&e(t)}catch(e){console.warn(e)}})},e}();e.GlobalMessageBus=C;var S=function(){function t(e,t,n,o,i,r){void 0===n&&(n=1),void 0===o&&(o=!0),void 0===i&&(i=!1),void 0===r&&(r=!0),this.prefabName=null,this.allowGrowth=!0,this.assetContainer=null,this.cloneAnimations=!0,this.makeNewMaterials=!1,this.availableInstances=null,this.prefabName=t,this.allowGrowth=o,this.assetContainer=e,this.cloneAnimations=r,this.makeNewMaterials=i,this.availableInstances=[],this.populatePool(n)}return t.prototype.getAvailableCount=function(){return this.availableInstances.length},t.prototype.populatePool=function(e){if(e>0)for(var t=0;t<e;t++){var n=this.createNewInstance();null!=n&&this.freeInstance(n)}},t.prototype.getInstance=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var n=this.availableInstances.length>0?this.availableInstances.pop():this.appendNewInstance();return null!=n&&(null!=e?n.position.copyFrom(e):n.position.set(0,0,0),null!=t?null!=n.rotationQuaternion?n.rotationQuaternion.copyFrom(t):n.rotationQuaternion=t.clone():null!=n.rotationQuaternion?n.rotationQuaternion.set(0,0,0,1):n.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),n.name=this.prefabName+".Instance",n.setEnabled(!0)),n},t.prototype.freeInstance=function(e){null!=e&&(e.setEnabled(!1),e.position.set(0,0,0),null!=e.rotationQuaternion?e.rotationQuaternion.set(0,0,0,1):e.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.components&&e.metadata.toolkit.components.forEach(function(e){if(null!=e)try{e.resetScriptComponent()}catch(e){}}),e.name=this.prefabName+".Unassigned",this.availableInstances.push(e))},t.prototype.appendNewInstance=function(){var e=null;return!0===this.allowGrowth&&(e=this.createNewInstance()),e},t.prototype.createNewInstance=function(t,n,o,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null);var r=null;return null!=this.assetContainer&&null!=this.prefabName&&""!==this.prefabName&&(this.assetContainer instanceof BABYLON.AssetContainer?r=e.SceneManager.InstantiatePrefabFromContainer(this.assetContainer,this.prefabName,this.prefabName+".Instance",t,n,o,i,this.cloneAnimations,this.makeNewMaterials):this.assetContainer instanceof BABYLON.Scene&&(r=e.SceneManager.InstantiatePrefabFromScene(this.assetContainer,this.prefabName,this.prefabName+".Instance",t,n,o,i,this.cloneAnimations))),r},t}();e.PrefabObjectPool=S;var A=function(){function e(){this._hit=!1,this._dest=new BABYLON.Vector3(0,0,0),this._origin=new BABYLON.Vector3(0,0,0),this._hitPoint=new BABYLON.Vector3(0,0,0),this._hitNormal=new BABYLON.Vector3(0,0,0),this._hitDistance=0,this._collisionObject=null,this.reset(BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero())}return Object.defineProperty(e.prototype,"hasHit",{get:function(){return this._hit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitPoint",{get:function(){return this._hitPoint},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitNormal",{get:function(){return this._hitNormal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionObject",{get:function(){return this._collisionObject},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rayDestination",{get:function(){return this._dest},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rayOrigin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),e.prototype.reset=function(e,t){this._hit=!1,this._hitPoint.set(0,0,0),this._hitNormal.set(0,0,0),this._hitDistance=0,this._collisionObject=null,this._origin.copyFrom(e),this._dest.copyFrom(t)},e.prototype.update=function(e,t,n,o,i,r,a,l){void 0===l&&(l=null),this._hit=e,this._hitPoint.set(t,n,o),this._hitNormal.set(i,r,a),this._hitDistance=BABYLON.Vector3.Distance(this._origin,this.hitPoint),this._collisionObject=l},e}();e.RaycastHitResult=A;var T=function(){function t(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=.5),this._numPoints=-1,this._pointMesh=null,this._pointSize=.5,this._pointType=0,this._linesName="MeshLines",this._linesMesh=null,this._babylonScene=null,this._pointMesh=null,this._linesMesh=null,this._linesName=e,this._babylonScene=t,this._pointType=n,this._pointSize=o}return Object.defineProperty(t.prototype,"pointMesh",{get:function(){return this._pointMesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linesMesh",{get:function(){return this._linesMesh},enumerable:!1,configurable:!0}),t.prototype.dispose=function(e){void 0===e&&(e=!0),this._babylonScene=null,this._linesName=null,null!=this._pointMesh&&(this._pointMesh.dispose(e),this._pointMesh=null),null!=this._linesMesh&&(this._linesMesh.dispose(e),this._linesMesh=null)},t.prototype.hidePoint=function(e){void 0===e&&(e=!0),null!=this._pointMesh&&(this._pointMesh.isVisible=!e)},t.prototype.drawPoint=function(t){null==this._pointMesh&&(1===this._pointType?(this._pointMesh=BABYLON.MeshBuilder.CreateBox(this._linesName+".EndPoint",{size:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25):(this._pointMesh=BABYLON.MeshBuilder.CreateSphere(this._linesName+".EndPoint",{segments:24,diameter:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25)),null!=this._pointMesh&&(this._pointMesh.isVisible=!0,this._pointMesh.position.copyFrom(t))},t.prototype.drawLine=function(t,n){void 0===n&&(n=null),null==this._linesMesh?(this._numPoints=t.length,this._linesMesh=BABYLON.MeshBuilder.CreateLines(this._linesName,{points:t,updatable:!0},this._babylonScene),this._linesMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),null!=n&&(this._linesMesh.color=n),this._linesMesh.refreshBoundingInfo(!1)):t.length===this._numPoints?(this._linesMesh=BABYLON.MeshBuilder.CreateLines(this._linesName,{points:t,instance:this._linesMesh},this._babylonScene),this._linesMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),null!=n&&(this._linesMesh.color=n),this._linesMesh.refreshBoundingInfo(!1)):BABYLON.Tools.Warn("Dynamic line mesh point count mismatch for "+this._linesName)},t}();e.LinesMeshRenderer=T;var O=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return i(n,t),n.prototype.addContainerTask=function(e,t,n,o){var i=this,r=new BABYLON.ContainerAssetTask(e,t,n,o),a=r;return a._lengthComputable=0,a._loaded=0,a._total=0,a.runTask=function(e,t,n){BABYLON.SceneLoader.LoadAssetContainer(r.rootUrl,r.sceneFilename,e,function(e){r.loadedContainer=e,r.loadedMeshes=e.meshes,r.loadedParticleSystems=e.particleSystems,r.loadedSkeletons=e.skeletons,r.loadedAnimationGroups=e.animationGroups,t()},function(e){a._lengthComputable=e.lengthComputable,a._loaded=e.loaded,a._total=e.total,i.handlePreloadingProgress()},function(e,t,o){n(t,o)})},this._tasks.push(r),r},n.prototype.addMeshTask=function(e,t,n,o){var i=this,r=new BABYLON.MeshAssetTask(e,t,n,o),a=r;return a._lengthComputable=0,a._loaded=0,a._total=0,a.runTask=function(e,t,n){BABYLON.SceneLoader.ImportMesh(r.meshesNames,r.rootUrl,r.sceneFilename,e,function(e,n,o,i){r.loadedMeshes=e,r.loadedParticleSystems=n,r.loadedSkeletons=o,r.loadedAnimationGroups=i,t()},function(e){a._lengthComputable=e.lengthComputable,a._loaded=e.loaded,a._total=e.total,i.handlePreloadingProgress()},function(e,t,o){n(t,o)})},this._tasks.push(r),r},n.prototype.addTextFileTask=function(e,t){var n=this,o=new BABYLON.TextFileAssetTask(e,t),i=o;return i._lengthComputable=0,i._loaded=0,i._total=0,i.runTask=function(e,t,r){e._loadFile(o.url,function(e){o.text=e,t()},function(e){i._lengthComputable=e.lengthComputable,i._loaded=e.loaded,i._total=e.total,n.handlePreloadingProgress()},!1,!1,function(e,t){e&&r(e.status+" "+e.statusText,t)})},this._tasks.push(o),o},n.prototype.addBinaryFileTask=function(e,t){var n=this,o=new BABYLON.BinaryFileAssetTask(e,t),i=o;return i._lengthComputable=0,i._loaded=0,i._total=0,i.runTask=function(e,t,r){e._loadFile(o.url,function(e){o.data=e,t()},function(e){i._lengthComputable=e.lengthComputable,i._loaded=e.loaded,i._total=e.total,n.handlePreloadingProgress()},!0,!0,function(e,t){e&&r(e.status+" "+e.statusText,t)})},this._tasks.push(o),o},n.prototype.addImageTask=function(e,t){var n=this,o=new BABYLON.ImageAssetTask(e,t),i=o;return i._lengthComputable=0,i._loaded=0,i._total=0,i.runTask=function(e,t,r){var a=new Image;BABYLON.Tools.SetCorsBehavior(o.url,a),a.onload=function(){o.image=a,t()},a.onerror=function(e){r("Error loading image",e)},a.onprogress=function(e){i._lengthComputable=e.lengthComputable,i._loaded=e.loaded,i._total=e.total,n.handlePreloadingProgress()},a.src=o.url},this._tasks.push(o),o},n.prototype.handlePreloadingProgress=function(){var t=!0,n=0,o=0;if(null!=this._tasks&&this._tasks.length>0)for(var i=0;i<this._tasks.length;i++){var r=this._tasks[i];null!=r._lengthComputable&&null!=r._loaded&&null!=r._total&&(t=t&&r._lengthComputable,n+=r._loaded,o+=r._total)}if(null!=e.SceneManager.OnAssetManagerProgress){var a={lengthComputable:t,loaded:n,total:t?o:0};e.SceneManager.OnAssetManagerProgress(a)}},n}(BABYLON.AssetsManager);e.PreloadAssetsManager=O;var I=function(){function e(){}return e.HasNetworkEntity=function(e){return null!=e&&null!=e.networkEntity},e.GetNetworkEntityId=function(e){return null==e?null:null!=e.networkEntity?e.networkEntity.id:null},e.GetNetworkEntityType=function(e){return null==e?0:null!=e.networkEntityType?e.networkEntityType:0},e.GetNetworkEntitySessionId=function(e){return null==e?null:null!=e.networkEntity?e.networkEntity.ownerId:null},e.QueryNetworkAttribute=function(e,t){var n=null;return null!=e&&null!=e.networkEntity&&null!=e.networkEntity.attributes&&(n=e.networkEntity.attributes.get(t)),n},e.QueryBufferedAttribute=function(e,t){var n=0;return null!=e&&null!=e.networkEntityAttributeBuffer&&(n=e.networkEntityAttributeBuffer[t.toFixed(0)]),n},e.PostBufferedAttribute=function(e,t,n){null==e.networkEntityBatch&&(e.networkEntityBatch={}),e.networkEntityBatch[t.toFixed(0)]=n},e}();e.EntityController=I}(o||(o={})),BABYLON.Bone.prototype.linkTransformNode=function(e){e._linkedBone=this,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},function(e){var t;(t=e.MaterialAlphaMode||(e.MaterialAlphaMode={})).OPAQUE="OPAQUE",t.MASK="MASK",t.BLEND="BLEND";e.CubeTextureLoader=function(){};var n=function(){function t(t){this.name=e.SceneManager.CVTOOLS_NAME,this.enabled=!1,this._webgpu=!1,this._babylonScene=null,this._metadataParser=null,this._loaderScene=null,this._assetsManager=null,this._materialMap=null,this._lightmapMap=null,this._reflectionMap=null,this._reflectionCache=null,this._assetContainer=!1,this._activeMeshes=!1,this._parseScene=!1,this._leftHanded=!1,this._disposeRoot=!1,this._sceneParsed=!1,this._preWarmTime=1,this._hideLoader=!1,this._rootUrl=null,this._fileName="Unknown",this._licenseName="Unknown",this._licenseType="standard",this._loader=t,this.enabled=this._loader.isExtensionUsed(e.SceneManager.CVTOOLS_NAME)&&this._loader.isExtensionUsed(e.SceneManager.CVTOOLS_HAND),this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._rootUrl=null,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._readyList=null,this._preloadList=null,this._materialMap=null,this._lightmapMap=null,this._preWarmTime=1,this._hideLoader=!1,this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._animationGroups=null,this._metadataParser=null,this._babylonScene=null,this.order=100}return t.prototype.dispose=function(){delete this._loader},t.prototype.onLoading=function(){var t=this;e.Utilities.LoadingState=0,this._assetContainer=null!=this._loader._assetContainer,this._metadataParser=null,this._babylonScene=this._loader.babylonScene,this._loaderScene=null,this._assetsManager=null,this._rootUrl=this._loader._uniqueRootUrl?this._loader._uniqueRootUrl:"/",this._fileName=this._loader._fileName?this._loader._fileName:"Unknown",this._fileName.indexOf("?")>=0&&(this._fileName=this._fileName.split("?")[0]),this._loader.parent.onCompleteObservable.addOnce(function(){t.onComplete()}),this._loader.parent.onValidatedObservable.addOnce(function(){t.onValidate()}),this._parseScene=this._loader.isExtensionUsed(e.SceneManager.CVTOOLS_NAME)&&this._loader.isExtensionUsed(e.SceneManager.CVTOOLS_HAND)&&!0===e.SceneManager.IsSceneParsingEnabled(),this._leftHanded=this._loader.isExtensionUsed(e.SceneManager.CVTOOLS_HAND),this._disposeRoot=this._sceneParsed=!1,this._animationGroups=[],this._masterList=[],this._detailList=[],this._parserList=[],this._shaderList=[],this._readyList=[],this._preloadList=[],this._materialMap=new Map,this._lightmapMap=new Map,this._preWarmTime=1,this._hideLoader=!1,this._reflectionMap={},this._reflectionCache={},e.Utilities.ResetLoaderItemsMarkedForDisposal(),this._webgpu=this._babylonScene.getEngine()instanceof BABYLON.WebGPUEngine,this._babylonScene.getEngine().getCaps().supportSRGBBuffers=e.SceneManager.SupportSRGBBuffers,!0===this._leftHanded&&null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.rotationQuaternion=BABYLON.Quaternion.Identity(),this._loader.rootBabylonMesh.scaling=BABYLON.Vector3.One()),!0===this._parseScene&&(e.SceneManager.RenderLoopReady=!1,null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.name="Root."+this._fileName.replace(".gltf","").replace(".glb","")),this.setupLoader())},t.prototype.onReady=function(){!0===this._parseScene&&!0===this._disposeRoot&&null!=this._loader.rootBabylonMesh&&this._loader.rootBabylonMesh.dispose(!0)},t.prototype.onComplete=function(){this._parseScene,this.finishComplete()},t.prototype.getScriptBundleTag=function(){var e=null,t=this._loaderScene,n=null!=t&&null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null;if(null!=n){null!=this._rootUrl&&this._rootUrl;var o=null!=n.script?n.script:null,i=null!=n.project?n.project:null;null!=o&&""!==o&&null!=i&&""!==i&&(e=i.toLocaleLowerCase())}return e},t.prototype.getScriptBundleUrl=function(){var e=null,t=this._loaderScene,n=null!=t&&null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null;if(null!=n){var o=null!=this._rootUrl?this._rootUrl:"/",i=null!=n.script?n.script:null,r=null!=n.project?n.project:null;null!=i&&""!==i&&null!=r&&""!==r&&(e=o+r)}return e},t.prototype.finishComplete=function(){var t=this;!0===this._parseScene&&(this.startParsing(),e.SceneManager.RenderLoopReady=!0,this._babylonScene.onAfterRenderObservable.addOnce(function(){e.Utilities.LoadingState=3,t._processPreloadTimeout()}))},t.prototype.onValidate=function(){this._parseScene},t.prototype.onCleanup=function(){this._fileName=null,this._rootUrl=null,this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._preWarmTime=1,this._readyList=null,this._preloadList=null,this._hideLoader=!1,this._animationGroups=null,null!=this._materialMap&&(this._materialMap.clear(),this._materialMap=null),null!=this._lightmapMap&&(this._lightmapMap.clear(),this._lightmapMap=null),this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._metadataParser=null,this._babylonScene=null},t.prototype.setupLoader=function(){var t=this,n=this._fileName;!0===this._parseScene&&(this._assetsManager=new e.PreloadAssetsManager(this._babylonScene),this._assetsManager.onProgress=function(t,n,o){if(!0===e.SceneManager.AutoUpdateProgress){var i="LOADING "+(n-t)+" OF "+n+(1===n?" ASSET":" ASSETS");e.WindowManager.UpdateLoaderDetails(i,e.Utilities.LoadingState)}else null!=e.Utilities.OnPreloaderProgress&&e.Utilities.OnPreloaderProgress(t,n,o)},this._assetsManager.onFinish=function(o){e.WindowManager.SetTimeout(100,function(){e.Utilities.LoadingState=4,!0===e.SceneManager.AutoUpdateProgress&&e.WindowManager.UpdateLoaderStatus("PLEASE WAIT","PREPARING SCENE VIEW",e.Utilities.LoadingState);var i=t._preWarmTime>0?1e3*t._preWarmTime:100;e.WindowManager.SetTimeout(i,function(){if(null!=e.Utilities.OnPreloaderComplete&&e.Utilities.OnPreloaderComplete(o),t._processShaderMaterials(t._babylonScene,t._shaderList),e.Utilities.RemoveLoaderItemsMarkedForDisposal(),null!=t._readyList&&t._readyList.length>0)for(var i=0;i<t._readyList.length;i++){var r=t._readyList[i];null!=r&&r._ready&&r._ready()}t._babylonScene.onAfterRenderObservable.addOnce(function(){console.warn("CVTOOLS: OnSceneReady: "+n);var o=null!=n&&""!==n?n:"Unknown";null!=e.SceneManager.OnSceneReadyObservable&&e.SceneManager.OnSceneReadyObservable.notifyObservers(o),1==t._hideLoader&&e.WindowManager.HideSceneLoader(),t.onCleanup()})})})})},t.prototype.startParsing=function(){!0===this._parseScene&&(e.Utilities.LoadingState=2,this._processLevelOfDetail(this._babylonScene,this._detailList),this._processActiveMeshes(this._babylonScene,this._activeMeshes),this._processUnityMeshes(this._masterList),null!=this._loaderScene&&(this.preProcessSceneProperties(this._loaderScene,this._babylonScene),this.postProcessSceneProperties(this._rootUrl,this._loaderScene,this._babylonScene)),!1===this._assetContainer&&null!=this._parserList&&this._parserList.length>0&&(this._metadataParser=e.Utilities.PostParseSceneComponents(this._babylonScene,this._parserList,this._preloadList,this._readyList)))},t.prototype.loadSceneAsync=function(t,n){if(!0===this._parseScene&&(this._loaderScene=n),!0===this._parseScene&&null!=n.extras&&null!=n.extras.metadata){if(null!=n.extras.metadata.rawmaterials){var o=this._loader,i=n.extras.metadata.rawmaterials;this._preloadRawMaterialsAsync(t,o._gltf.materials,i)}e.Utilities.LoadingState=1;var r=this._loader.loadSceneAsync(t,n);return this.loadSceneExAsync(t,n),r}return e.Utilities.LoadingState=1,null},t.prototype.loadSceneExAsync=function(t,n){var o=this,i=this._loader,r=new Array;if(i._gltf.nodes)for(var a=0,l=i._gltf.nodes;a<l.length;a++){var s=l[a];s._babylonTransformNode&&this._animationGroups&&e.Utilities.AssignAnimationGroupsToNode(s._babylonTransformNode,this._animationGroups)}if(null!=this._reflectionMap&&null!=this._reflectionCache){var u=0,c=function(t){if(u++,d._reflectionMap.hasOwnProperty(t)){var n=t;if(null!=d._assetsManager){var i=d._assetsManager.addBinaryFileTask("Material.ReflectionTextureTask"+u.toFixed(0),n);i.onSuccess=function(t){if(null!=t.data){var i=new Blob([t.data]),r=o._reflectionMap[n];null!=r&&r.forEach(function(t){if(null!=t&&null!=t.mapkey){var n=o._reflectionCache[t.mapkey];if(null!=n)null!=t.material&&e.Utilities.HasOwnProperty(t.material,"reflectionTexture")&&(t.material.reflectionTexture=n);else{var r=o._babylonScene,a=URL.createObjectURL(i),l=function(){URL.revokeObjectURL(a)},s=new BABYLON.CubeTexture(a,r,null,null,null,l,l,null,t.prefiltered,t.extension);s.name=t.name,null!=t.boundingBoxSize&&(s.boundingBoxSize=t.boundingBoxSize),null!=t.boundingBoxPosition&&(s.boundingBoxPosition=t.boundingBoxPosition),o._reflectionCache[t.mapkey]=s,null!=t.material&&e.Utilities.HasOwnProperty(t.material,"reflectionTexture")&&(t.material.reflectionTexture=s)}}})}else console.error("Failed to load reflection texture task: "+n)},i.onError=function(e,t,n){console.error(t,n)}}}},d=this;for(var p in this._reflectionMap)c(p)}return i.logClose(),Promise.all(r).then(function(){})},t.prototype._processActiveMeshes=function(e,t){!0===t&&e.freeActiveMeshes()},t.prototype._processUnityMeshes=function(t){null!=t&&t.length>0&&t.forEach(function(t){e.Utilities.RegisterInstancedMeshBuffers(t)})},t.prototype._processPreloadTimeout=function(){if(null!=this._assetsManager){if(null!=this._preloadList&&this._preloadList.length>0)for(var e=0;e<this._preloadList.length;e++){var t=this._preloadList[e];null!=t&&t.addPreloaderTasks&&t.addPreloaderTasks(this._assetsManager)}this._babylonScene._preloaded=!0,this._assetsManager.load()}},t.prototype.loadNodeAsync=function(t,n,o){var i=this;return!0===this._parseScene&&null!=n.extras&&null!=n.extras.metadata?this._loader.loadNodeAsync(t,n,function(t){var r=t,a=n.extras.metadata;null==r.metadata&&(r.metadata={}),r.metadata.toolkit=a,e.Utilities.ValidateTransformGuid(r),e.Utilities.ValidateTransformMetadata(r),e.Utilities.ValidateTransformQuaternion(r),r.isVisible=null==r.metadata.toolkit.visible||r.metadata.toolkit.visible,r.visibility=null!=r.metadata.toolkit.visibility?r.metadata.toolkit.visibility:1,r.billboardMode=null!=r.metadata.toolkit.billboard?r.metadata.toolkit.billboard:0,!0===i._assetContainer&&(r.metadata.toolkit.prefab=!0),!0===r.metadata.toolkit.prefab?r.setEnabled(!1):(i._parserList.push(r),null!=n.extras.metadata.lods&&null!=n.extras.metadata.distances&&null!=i._detailList&&i._detailList.push(r)),i._masterList.push(r),o(r)}):null},t.prototype.loadMaterialPropertiesAsync=function(e,t,n){if(!0===this._parseScene){var o=-1;t.index&&(o=t.index)>=0&&null!=this._materialMap&&(this._materialMap.has(o)||this._materialMap.set(o,n)),n.gltfIndex=o;var i=this._loader,r=new Array;return n instanceof BABYLON.NodeMaterial?r.push(this._parseNodeMaterialPropertiesAsync("".concat(e,"/nodeMaterial"),t,n)):n instanceof BABYLON.ShaderMaterial?r.push(this._parseShaderMaterialPropertiesAsync("".concat(e,"/shaderMaterial"),t,n)):n instanceof BABYLON.StandardMaterial?r.push(this._parseDiffuseMaterialPropertiesAsync("".concat(e,"/standardMaterial"),t,n)):(i._extensionsLoadMaterialPropertiesAsync(e,t,n)||(r.push(i.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&r.push(i._loadMaterialMetallicRoughnessPropertiesAsync("".concat(e,"/pbrMetallicRoughness"),t.pbrMetallicRoughness,n)),i.loadMaterialAlphaProperties(e,t,n)),this._parseCommonConstantProperties(r,"".concat(e,"/commonConstant"),t,n)),Promise.all(r).then(function(){})}return null},t.prototype._getCachedMaterialByIndex=function(e){var t=null;return e>=0&&null!=this._materialMap&&(t=this._materialMap.get(e)||null),t},t.prototype._getCachedLightmapByIndex=function(e){var t=null;return e>=0&&null!=this._lightmapMap&&(t=this._lightmapMap.get(e)||null),t},t.prototype.createMaterial=function(t,n,o){if(!0===this._parseScene&&n.index){var i=n.index;if(i>=0){var r=this._getCachedMaterialByIndex(i);if(null!=r)return r}}if(!0===this._parseScene){var a=null,l=n.name||"No Name";if(null!=n.extras&&null!=n.extras.metadata&&null!=n.extras.metadata.customMaterial){var s=n.extras.metadata,u=s.customMaterial,c=(s.customShader,e.Utilities.InstantiateClass(u));if(null!=c){var d=new c(l,this._loader.babylonScene);null!=d?!0==d instanceof BABYLON.Material?((a=d).fillMode=o,a instanceof BABYLON.ShaderMaterial&&e.Utilities.InitializeShaderMaterial(a)):BABYLON.Tools.Warn("Non material instantiated class: "+u):BABYLON.Tools.Warn("Failed to instantiate material class: "+u)}else BABYLON.Tools.Warn("Failed to locate material class: "+u)}return a}return null},t.prototype.loadAnimationAsync=function(e,t){if(!0===this._parseScene){this._loader;var n=t;this._babylonScene._blockEntityCollection=!!this._assetContainer;var o=new BABYLON.AnimationGroup(t.name||"animation".concat(n.index),this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n._babylonAnimationGroup=o,this._animationGroups.push(o);var i=new Array;BABYLON.GLTF2.ArrayItem.Assign(n.channels),BABYLON.GLTF2.ArrayItem.Assign(n.samplers);for(var r=0,a=t.channels;r<a.length;r++){var l=a[r],s=l;i.push(this._loader._loadAnimationChannelAsync("".concat(e,"/channels/").concat(s.index),e,t,l,function(e,t){e.animations=e.animations||[],e.animations.push(t),o.addTargetedAnimation(t,e)}))}return Promise.all(i).then(function(){if(null!=t.extras&&null!=t.extras.metadata){var e={};e.toolkit=t.extras.metadata,o.metadata=e,null!=e.label&&""!==e.label&&(o.name=e.label)}return o.normalize(0),o})}return null},t.prototype._loadMeshPrimitiveAsync=function(e,t,n,o,i,r){var a=this;if(!0===this._parseScene){var l=this._loader;l.logOpen("".concat(e));var s,u=0===l._disableInstancedMesh&&l._parent.createInstances&&null==n.skin&&!o.primitives[0].targets,c=void 0;if(u&&i._instanceData)l._babylonScene._blockEntityCollection=!!l._assetContainer,(s=i._instanceData.babylonSourceMesh.createInstance(t))._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1,c=i._instanceData.promise;else{var d=new Array;l._babylonScene._blockEntityCollection=!!l._assetContainer;var p=new BABYLON.Mesh(t,l._babylonScene);p._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1,!0===this._leftHanded?p.overrideMaterialSideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:p.overrideMaterialSideOrientation=l._babylonScene.useRightHandedSystem?BABYLON.Material.CounterClockWiseSideOrientation:BABYLON.Material.ClockWiseSideOrientation,l._createMorphTargets(e,n,o,i,p),d.push(l._loadVertexDataAsync(e,i,p).then(function(t){return l._loadMorphTargetsAsync(e,i,p,t).then(function(){l._disposed||(l._babylonScene._blockEntityCollection=!!l._assetContainer,t.applyToMesh(p),a._setupBabylonMesh(p,n,o,i),t._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1)})}));var h=BABYLON.GLTF2.GLTFLoader._GetDrawMode(e,i.mode);if(null!=i.extras&&null!=i.extras.metadata&&null!=i.extras.metadata.multimaterial&&null!=i.extras.metadata.submeshes)this._setupBabylonMaterials(e,d,h,p,o,i);else if(null==i.material){var m=l._defaultBabylonMaterialData[h];m||(m=l._createDefaultMaterial("__GLTFLoader._default",h),l._parent.onMaterialLoadedObservable.notifyObservers(m),l._defaultBabylonMaterialData[h]=m),p.material=m}else if(!l.parent.skipMaterials){var f=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),l._gltf.materials,i.material);d.push(l._loadMaterialAsync("/materials/".concat(f.index),f,p,h,function(e){p.material=e}))}c=Promise.all(d),u&&(i._instanceData={babylonSourceMesh:p,promise:c}),s=p}return BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(s,e),l._parent.onMeshLoadedObservable.notifyObservers(s),r(s),l.logClose(),c.then(function(){return s})}return null},t.prototype._setupBabylonMesh=function(e,t,n,o){if(!0===this._parseScene){if(this._loader,null!=o.extras&&null!=o.extras.metadata&&null!=o.extras.metadata.multimaterial&&null!=o.extras.metadata.submeshes){var i=o.extras.metadata.submeshes;e.subMeshes=[];for(var r=0;r<i.length;r++){var a=i[r];BABYLON.SubMesh.AddToMesh(a.materialIndex,a.verticesStart,a.verticesCount,a.indexStart,a.indexCount,e)}}e.computeWorldMatrix(!0)}},t.prototype._setupBabylonMaterials=function(e,t,n,o,i,r){if(!0===this._parseScene){var a=this._loader,l=r.extras.metadata.multimaterial,s=l.materials,u=[],c=l.id||"MM_"+i.name,d=l.name||"MM_"+i.name,p=new BABYLON.MultiMaterial("["+d+"]",a._babylonScene);p.id=c,s.forEach(function(t){if(null!=t){var n=parseInt(t);if(n>=0){var i=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),a._gltf.materials,n);u.push(i)}else console.warn("Invalid Submesh Material Index Encountered For: "+o.name)}else console.warn("Null Submesh Material Encountered For: "+o.name)}),t.push(this._parseMultiMaterialAsync("/materials/".concat(d),u,o,n,function(e){p.subMaterials=e,o.material=p}))}},t.prototype._processLevelOfDetail=function(t,n){null!=n&&n.length>0&&n.forEach(function(t){if(null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.lods&&null!=t.metadata.toolkit.distances){var n=t.metadata.toolkit,o=n.lods,i=n.distances;if(i.length>=o.length){var r=null,a=null;if(o.forEach(function(n,o){var i="*"===n?t:e.SceneManager.FindChildTransformNode(t,n,e.SearchType.ExactMatch,!1);null!=i&&i instanceof BABYLON.AbstractMesh&&(0===o?r=i:(null==a&&(a=[]),a.push(i)))}),null!=r)if(r instanceof BABYLON.Mesh){var l=i.length>0?i[i.length-1]:0;l>=1/0&&(l=0),null!=a&&a.forEach(function(e,t){r.addLODLevel(i[t],e)}),l>0&&r.addLODLevel(l,null)}else r instanceof BABYLON.InstancedMesh&&null!=a&&a.forEach(function(e,n){try{e.dispose()}catch(e){}BABYLON.Tools.Warn("Destroyed Unused Level Detail: "+e.name+" --\x3e For Transform: "+t.name)})}}})},t.prototype._processShaderMaterials=function(e,t){null!=t&&t.length>0&&t.forEach(function(e){e.freeze()})},t.prototype.preProcessSceneProperties=function(t,n){if(!0!==this._assetContainer&&!1===this._sceneParsed&&null!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.properties&&!0===t.extras.metadata.properties){this._sceneParsed=!0;var o=null!=this._rootUrl?this._rootUrl:"/",i=t.extras.metadata;if(null==n.metadata&&(n.metadata={}),null==n.metadata.toolkit&&(n.metadata.toolkit={}),n.metadata.toolkit=i,this._disposeRoot=null!=i.disposeroot&&!0===i.disposeroot,this._hideLoader=null!=i.hideloader&&!0===i.hideloader,this._preWarmTime=null!=i.prewarmup?i.prewarmup:0,this._licenseType=null!=i.license?i.license:"standard",this._licenseName=null!=i.licensee?i.licensee:"Unknown",e.SceneManager.SetRootUrl(n,o),e.SceneManager.SetSceneFile(n,this._fileName),e.SceneManager.EnableUserInput=!0,null!=this._licenseName&&""!==this._licenseName&&"Unknown"!==this._licenseName&&"DefaultCompany"!==this._licenseName&&"Default Company"!==this._licenseName&&BABYLON.Tools.Log(e.Utilities.MakeProper(this._fileName)+" licensed to "+this._licenseName),e.SceneManager.GlobalOptions.ktxtextures=null!=i.ktxtextures&&i.ktxtextures,e.SceneManager.GlobalOptions.ktxlightmaps=null!=i.ktxlightmaps&&i.ktxlightmaps,e.SceneManager.GlobalOptions.intensityFactor=null!=i.intensity?i.intensity:1,e.SceneManager.GlobalOptions.debugModeEnabled=null!=i.debugging&&i.debugging,e.SceneManager.GlobalOptions.showDebugColliders=null!=i.showdebugcolliders&&i.showdebugcolliders,e.SceneManager.GlobalOptions.colliderVisibility=null!=i.collidervisibility?i.collidervisibility:0,e.SceneManager.GlobalOptions.colliderRenderGroup=null!=i.colliderrendergroup?i.colliderrendergroup:0,e.SceneManager.GlobalOptions.defaultRenderGroup=null!=i.defaultrendergroup?i.defaultrendergroup:0,e.SceneManager.GlobalOptions.collisionWireframe=null!=i.collisionwireframe&&i.collisionwireframe,e.SceneManager.GlobalOptions.useTriangleNormals=null!=i.trianglenormals&&i.trianglenormals,e.SceneManager.GlobalOptions.useConvexTriangles=null==i.convextriangles||i.convextriangles,e.SceneManager.GlobalOptions.colliderInstances=null==i.colliderinstances||i.colliderinstances,e.SceneManager.GlobalOptions.reparentColliders=null==i.reparentcolliders||i.reparentcolliders,e.SceneManager.GlobalOptions.enablelegacyaudio=null!=i.enablelegacyaudio&&i.enablelegacyaudio,e.SceneManager.GlobalOptions.globalillumination=null!=i.globalillumination&&i.globalillumination,null!=i.clearcolor&&(n.clearColor=e.Utilities.ParseColor4(i.clearcolor)),null!=i.autoclear&&!0===i.autoclear&&(n.autoClear=!0,n.autoClearDepthAndStencil=!0),null!=i.rendergroups&&(BABYLON.RenderingManager.MAX_RENDERINGGROUPS=i.rendergroups),null!=i.imageprocessing){var r=i.imageprocessing,a=null!=r.contrast?r.contrast:1,l=null!=r.exposure?r.exposure:1;null!=n.imageProcessingConfiguration&&(n.imageProcessingConfiguration.contrast=a,n.imageProcessingConfiguration.exposure=l)}var s=e.SceneManager.AmbientLightIntensity;if(null!=i.ambientcoloring&&(n.ambientColor=e.Utilities.ParseColor3(i.ambientcoloring)),null!=i.ambientlighting&&i.ambientlighting>0){var u=n;null==u._AmbientLight&&(u._AmbientLight=new BABYLON.HemisphericLight("Ambient Lighting",new BABYLON.Vector3(0,1,0),n),u._AmbientLight.falloffType=BABYLON.Light.FALLOFF_STANDARD,u._AmbientLight.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT),null!=u._AmbientLight&&(null!=i.ambientskycolor&&(u._AmbientLight.diffuse=e.Utilities.ParseColor3(i.ambientskycolor,BABYLON.Color3.Gray())),null!=i.ambientspecularcolor&&(u._AmbientLight.specular=e.Utilities.ParseColor3(i.ambientspecularcolor,BABYLON.Color3.White())),null!=i.ambientgroundcolor&&(u._AmbientLight.groundColor=e.Utilities.ParseColor3(i.ambientgroundcolor,BABYLON.Color3.Gray())),null!=i.ambientlightintensity&&(u._AmbientLight.intensity=i.ambientlightintensity),u._AmbientLight.intensity*=s)}if(null!=i.fogmode){var c=i.fogmode;if(c>0){n.fogMode=c,n.fogEnabled=!0;var d=1;1===c?d=.5:2===c&&(d=.75),null!=i.fogdensity&&(n.fogDensity=i.fogdensity*d),null!=i.fogstart&&(n.fogStart=i.fogstart),null!=i.fogend&&(n.fogEnd=i.fogend),null!=i.fogcolor&&(n.fogColor=e.Utilities.ParseColor3(i.fogcolor))}}var p=new BABYLON.Vector3(0,-9.81,0),h=null!=i.defaultgravity?e.Utilities.ParseVector3(i.defaultgravity,p):p;if(n.gravity=h.clone(),n.collisionsEnabled=!0,null!=i.enablephysics&&!0===i.enablephysics){var m=null==i.ccdenabled||i.ccdenabled,f=null!=i.ccdpenetration?i.ccdpenetration:1e-4,g=null!=i.subtimestep?i.subtimestep:0,y=null!=i.maxworldsweep?i.maxworldsweep:0,v=null==i.deltaworldstep||i.deltaworldstep;e.RigidbodyPhysics.ConfigurePhysicsEngine(n,!v,g,y,m,f,h)}if(null!=i.userinput){var _=i.userinput;e.UserInputOptions.KeyboardSmoothing=_.keyboardSmoothing,e.UserInputOptions.KeyboardMoveSensibility=_.keyboardSensitivity,e.UserInputOptions.KeyboardArrowSensibility=1,e.UserInputOptions.KeyboardMoveDeadZone=_.keyboardDeadZone,e.UserInputOptions.GamepadDeadStickValue=_.padDeadStick,e.UserInputOptions.GamepadLStickXInverted=_.padLStickXInvert,e.UserInputOptions.GamepadLStickYInverted=_.padLStickYInvert,e.UserInputOptions.GamepadRStickXInverted=_.padRStickXInvert,e.UserInputOptions.GamepadRStickYInverted=_.padRStickYInvert,e.UserInputOptions.GamepadLStickSensibility=_.padLStickLevel,e.UserInputOptions.GamepadRStickSensibility=_.padRStickLevel,e.UserInputOptions.SupportedInputDevices=_.supportedDevices,e.UserInputOptions.BabylonAngularSensibility=2e3,e.UserInputOptions.DefaultAngularSensibility=_.mouseSensitivity,e.UserInputOptions.PointerWheelDeadZone=_.wheelDeadZone,e.UserInputOptions.PointerMouseDeadZone=_.mouseDeadZone,e.UserInputOptions.PointerMouseInverted=_.mouseMoveInvert,e.UserInputOptions.UseCanvasElement=_.useCanvasElement,e.UserInputOptions.UseArrowKeyRotation=_.arrowKeyRotation,e.UserInputOptions.EnableBabylonRotation=!1}if(null!=i.enableinput&&!0===i.enableinput){var b={contextMenu:null==i.contextmenu||i.contextmenu,pointerLock:null!=i.pointerlock&&i.pointerlock,preventDefault:null!=i.preventdefault&&i.preventdefault,useCapture:null!=i.usecapture&&i.usecapture};e.InputController.ConfigureUserInput(n.getEngine(),n,b)}null!=i.freezeactivemeshes&&!0===i.freezeactivemeshes&&(this._activeMeshes=!0),null!=i.performancepriority&&(n.performancePriority=i.performancepriority)}},t.prototype.postProcessSceneProperties=function(t,n,o){var i=this;if(!0!==this._assetContainer&&null!=n.extras&&null!=n.extras.metadata&&null!=n.extras.metadata.properties&&!0===n.extras.metadata.properties){var r=n.extras.metadata;if(null!=r.skybox){var a=r.skybox,l=null!=a.skyfog&&a.skyfog,s=null!=a.skytags?a.skytags:"Untagged",u=null!=a.skysize?a.skysize:1e3,c=null!=a.rotation?a.rotation:0,d=null!=a.basename&&""!==a.basename?t+a.basename:null,p=null!=a.skyfaces?a.skyfaces:null,h=null!=a.rendergroup?a.rendergroup:0,m=null!=a.extensions&&a.extensions.length>0?a.extensions:null,f=null!=a.polynomial?a.polynomial:1;try{if(null!=p&&""!==p&&null!=d&&""!==d){var g=null;if("png"===p||"webp"===p)g=new BABYLON.CubeTexture(d,o,m),d.indexOf("_rgbd")>=0?(g.isRGBD=!0,g.gammaSpace=!1):(g.isRGBD=!1,g.gammaSpace=!0);else if("jpg"===p)(g=new BABYLON.CubeTexture(d,o,m)).isRGBD=!1,g.gammaSpace=!0;else if("ktx2"===p)(g=new BABYLON.CubeTexture(d,o,m)).isRGBD=!1,g.gammaSpace=!0;else{var y=d+"."+p;(g=new BABYLON.CubeTexture(y,o,null,!0,null,null,null,null,!0)).gammaSpace=!1}g.name=a.basename,g.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,g.rotationY=BABYLON.Tools.ToRadians(c);var v="Default Skybox",_=BABYLON.MeshBuilder.CreateBox(v,{size:u},o);_.renderingGroupId=e.Utilities.DefaultRenderGroup(),_.id=v,_.infiniteDistance=!0,_.applyFog=l,_.renderingGroupId=h,null!=s&&""!==s&&BABYLON.Tags.AddTagsTo(_,s),!0===o.useRightHandedSystem&&(_.scaling.x*=-1);var b=new BABYLON.StandardMaterial("Skybox-Material",o);b.backFaceCulling=!1,b.disableLighting=!0,b.diffuseColor=new BABYLON.Color3(0,0,0),b.emissiveColor=new BABYLON.Color3(0,0,0),b.specularColor=new BABYLON.Color3(0,0,0),b.ambientColor=new BABYLON.Color3(0,0,0),b.reflectionTexture=g,_.material=b}}catch(e){console.warn(e)}if(null!=a.environment){var B=a.environment;o.environmentIntensity=null!=B.level?BABYLON.Scalar.Clamp(B.level,0,10):1;var C=null!=B.info&&""!==B.info?B.info:null;if(null!=C&&""!==C)try{var S=e.SceneManager.GetRootUrl(o)+C.rooturl+C.name;if(null!=this._assetsManager){var A=this._assetsManager.addBinaryFileTask("Global.EnvironmentTextureTask",S);A.onSuccess=function(e){if(null!=e.data){var t=new Blob([e.data]),n=i._babylonScene,o=URL.createObjectURL(t),r=function(){URL.revokeObjectURL(o)},a=S.toLowerCase().endsWith(".env")?".env":".dds",l=new BABYLON.CubeTexture(o,n,null,null,null,r,r,null,!0,a);n.environmentTexture=l,n.environmentTexture.name="assets/"+C.name,null!=n.environmentTexture&&null!=n.environmentTexture.sphericalPolynomial&&(n.isReady()?n.environmentTexture.sphericalPolynomial.scaleInPlace(f):n.onReadyObservable.addOnce(function(){n.environmentTexture.sphericalPolynomial.scaleInPlace(f)}))}else console.error("Failed to load environment texture task: "+S)},A.onError=function(e,t,n){console.error(t,n)}}}catch(e){console.warn(e)}}}if(null!=r.navigation&&null!=r.navigation.prebaked&&""!==r.navigation.prebaked){var T=null!=r.navigation.collision&&!0===r.navigation.collision,O=null!=r.navigation.showdebug&&!0===r.navigation.showdebug,I=null!=r.navigation.debugcolor?r.navigation.debugcolor:[.2627451,.5960785,.7372549],M=null!=r.navigation.debugoffset?r.navigation.debugoffset:0,L=new BABYLON.Color3(I[0],I[1],I[2]),x=null!=r.navigation.timesteps?r.navigation.timesteps:0;if(null!=this._assetsManager){var w=r.navigation.prebaked,P=this._assetsManager.addBinaryFileTask("System.NavigationMeshTask",w);P.onSuccess=function(t){if(null!=t.data){var n=new Uint8Array(t.data);e.SceneManager.LoadNavigationMesh(o,n,O,L,x,T,M)}else console.error("Failed to load navigation mesh task: "+w)},P.onError=function(e,t,n){console.error(t,n)}}}}},t.prototype._preloadRawMaterialsAsync=function(e,t,n){var o=this._loader,i=new Array,r=BABYLON.Material.TriangleFillMode;return n.forEach(function(n){var a=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),t,n);if(null!=a){var l=o.createMaterial(e,a,r);BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(l,e),o._parent.onMaterialLoadedObservable.notifyObservers(l),i.push(o.loadMaterialPropertiesAsync(e,a,l))}}),Promise.all(i).then(function(){})},t.prototype._parseMultiMaterialAsync=function(e,t,n,o,i){var r=this;void 0===i&&(i=function(){});var a=this._loader,l=t;l._data=l._data||{};var s=l._data[o];if(!s){a.logOpen("".concat(e," ").concat(n.name||""));var u=[],c=new Array;t.forEach(function(t){var n=null;if(t.index){var i=t.index;i>=0&&(n=r._getCachedMaterialByIndex(i))}null==n&&(n=a.createMaterial(e,t,o),BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(n,e),a._parent.onMaterialLoadedObservable.notifyObservers(n),c.push(a.loadMaterialPropertiesAsync(e,t,n))),u.push(n)}),s={babylonMaterials:u,babylonMeshes:[],promises:c},l._data[o]=s,a.logClose()}return s.babylonMeshes.push(n),n.onDisposeObservable.addOnce(function(){var e=s.babylonMeshes.indexOf(n);-1!==e&&s.babylonMeshes.splice(e,1)}),i(s.babylonMaterials),Promise.all(s.promises).then(function(){return s.babylonMaterials})},t.prototype._parseNodeMaterialPropertiesAsync=function(e,t,n){var o=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,i=n,r=new Array;if(i.backFaceCulling=null==o||null==o.backFaceCulling||o.backFaceCulling,t.doubleSided&&(i.backFaceCulling=!1),t.pbrMetallicRoughness){var a=t.pbrMetallicRoughness;if(a){if(a.baseColorFactor){var l=BABYLON.Color4.FromArray(a.baseColorFactor);i.setVector4("_Color",new BABYLON.Vector4(Math.pow(l.r,1/2.2),Math.pow(l.g,1/2.2),Math.pow(l.b,1/2.2),l.a)),l.a}else i.setVector4("_Color",new BABYLON.Vector4(1,1,1,1));a.baseColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),a.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)");var t=e;t.level=null!=o&&null!=o.diffuseIntensity?o.diffuseIntensity:1,i.setTexture("_MainTex",t)}))}}if(t.normalTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)");var o=e;null!=t.normalTexture.scale&&(o.level=t.normalTexture.scale),i.setTexture("_BumpMap",o)})),t.occlusionTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)");var o=e;null!=t.occlusionTexture.strength&&(o.level=t.occlusionTexture.strength),i.setTexture("_OcclusionMap",o)})),t.emissiveFactor){var s=BABYLON.Color4.FromArray(t.emissiveFactor);(s.r>0||s.g>0||s.b>0)&&i.setVector4("_EmissionColor",new BABYLON.Vector4(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2),s.a))}if(t.emissiveTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)");var t=e;i.setTexture("_EmissionMap",t)})),null!=o){if(i.wireframe=null!=o.useWireframe&&o.useWireframe,i.needDepthPrePass=null!=o.depthPrepass&&o.depthPrepass,o.customTextures){var u=function(t){var a=o.customTextures[t];null!=a&&r.push(c._loader.loadTextureInfoAsync(e+"/"+t,a,function(e){e.name="".concat(n.name,"detailsSampler"===t||"normalsSampler"===t?" (Atlas)":" (Custom)"),i.setTexture(t,e)}))},c=this;for(var d in o.customTextures)u(d)}if(o.customVectors)for(var p in o.customVectors){var h=o.customVectors[p];null!=h&&i.setVector4(p,BABYLON.Vector4.FromArray(h))}if(o.customColors)for(var m in o.customColors){var f=o.customColors[m];null!=f&&i.setVector4(m,BABYLON.Vector4.FromArray(f))}if(o.customFloats)for(var g in o.customFloats){var y=o.customFloats[g];null!=y&&i.setFloat(g,y)}null!=o.freezeMaterial&&!0===o.freezeMaterial&&null!=this._shaderList&&this._shaderList.push(i)}var v=Promise.all(r).then(function(){});return i.compile(),v},t.prototype._parseShaderMaterialPropertiesAsync=function(t,n,o){var i=null!=n.extras&&null!=n.extras.metadata?n.extras.metadata:null,r=o,a=new Array;r.backFaceCulling=null==i||null==i.backFaceCulling||i.backFaceCulling,n.doubleSided&&(r.backFaceCulling=!1),e.Utilities.HasOwnProperty(r,"ambientColor")&&(r.ambientColor=null!=i&&i.ambientColorFactor?BABYLON.Color3.FromArray(i.ambientColorFactor):BABYLON.Color3.Black());var l=1;if(n.pbrMetallicRoughness){var s=n.pbrMetallicRoughness;if(s){if(s.baseColorFactor){var u=BABYLON.Color4.FromArray(s.baseColorFactor);r.setVector4("diffuseColor",new BABYLON.Vector4(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2),u.a)),l=u.a}else r.setVector4("diffuseColor",new BABYLON.Vector4(1,1,1,1));s.baseColorTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(t,"/baseColorTexture"),s.baseColorTexture,function(e){e.name="".concat(o.name," (Base Color)");var t=e;t.level=null!=i&&null!=i.diffuseIntensity?i.diffuseIntensity:1,r.setTexture("diffuseTexture",t)}))}}if(n.normalTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(t,"/normalTexture"),n.normalTexture,function(e){e.name="".concat(o.name," (Normal)");var t=e;null!=n.normalTexture.scale&&(t.level=n.normalTexture.scale),r.setTexture("bumpTexture",t)})),n.occlusionTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(t,"/occlusionTexture"),n.occlusionTexture,function(e){e.name="".concat(o.name," (Occlusion)");var t=e;null!=n.occlusionTexture.strength&&(t.level=n.occlusionTexture.strength),r.setTexture("ambientTexture",t)})),n.emissiveFactor){var c=BABYLON.Color4.FromArray(n.emissiveFactor);(c.r>0||c.g>0||c.b>0)&&r.setVector4("emissiveColor",new BABYLON.Vector4(Math.pow(c.r,1/2.2),Math.pow(c.g,1/2.2),Math.pow(c.b,1/2.2),c.a))}switch(n.emissiveTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(t,"/emissiveTexture"),n.emissiveTexture,function(e){e.name="".concat(o.name," (Emissive)");var t=e;r.setTexture("emissiveTexture",t)})),r.alpha=l,n.alphaMode||e.MaterialAlphaMode.OPAQUE){case e.MaterialAlphaMode.OPAQUE:r.alpha=1,r.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_OPAQUE;break;case e.MaterialAlphaMode.MASK:r.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHATEST;break;case e.MaterialAlphaMode.BLEND:r.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHABLEND;break;default:throw new Error("".concat(t,"/AlphaMode: Invalid value (").concat(n.alphaMode,")"))}if(null!=i){if(r.wireframe=null!=i.useWireframe&&i.useWireframe,r.needDepthPrePass=null!=i.depthPrepass&&i.depthPrepass,i.customTextures){var d=function(e){var n=i.customTextures[e];null!=n&&a.push(p._loader.loadTextureInfoAsync(t+"/"+e,n,function(t){t.name="".concat(o.name,"detailsSampler"===e||"normalsSampler"===e?" (Atlas)":" (Custom)"),r.setTexture(e,t)}))},p=this;for(var h in i.customTextures)d(h)}if(i.customVectors)for(var m in i.customVectors){var f=i.customVectors[m];null!=f&&r.setVector4(m,BABYLON.Vector4.FromArray(f))}if(i.customColors)for(var g in i.customColors){var y=i.customColors[g];null!=y&&r.setVector4(g,BABYLON.Vector4.FromArray(y))}if(i.customFloats)for(var v in i.customFloats){var _=i.customFloats[v];null!=_&&r.setFloat(v,_)}null!=i.freezeMaterial&&!0===i.freezeMaterial&&null!=this._shaderList&&this._shaderList.push(r)}return Promise.all(a).then(function(){})},t.prototype._parseDiffuseMaterialPropertiesAsync=function(t,n,o){var i=null!=n.extras&&null!=n.extras.metadata?n.extras.metadata:null,r=o,a=new Array;e.Utilities.HasOwnProperty(r,"ambientColor")&&(r.ambientColor=null!=i&&i.ambientColorFactor?BABYLON.Color3.FromArray(i.ambientColorFactor):BABYLON.Color3.Black()),e.Utilities.HasOwnProperty(r,"backFaceCulling")&&(r.backFaceCulling=null==i||null==i.backFaceCulling||i.backFaceCulling),n.doubleSided&&(e.Utilities.HasOwnProperty(r,"twoSidedLighting")&&(r.twoSidedLighting=!0),e.Utilities.HasOwnProperty(r,"backFaceCulling")&&(r.backFaceCulling=!1));var l=1;if(n.pbrMetallicRoughness){var s=n.pbrMetallicRoughness;if(s){if(e.Utilities.HasOwnProperty(r,"diffuseColor"))if(s.baseColorFactor){var u=BABYLON.Color4.FromArray(s.baseColorFactor);r.diffuseColor=new BABYLON.Color3(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2)),l=u.a}else r.diffuseColor=BABYLON.Color3.White();e.Utilities.HasOwnProperty(r,"diffuseTexture")&&s.baseColorTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(t,"/baseColorTexture"),s.baseColorTexture,function(e){e.name="".concat(o.name," (Base Color)"),r.diffuseTexture=e,r.diffuseTexture.level=null!=i&&null!=i.diffuseIntensity?i.diffuseIntensity:1}))}}if(e.Utilities.HasOwnProperty(r,"bumpTexture")&&n.normalTexture&&(a.push(this._loader.loadTextureInfoAsync("".concat(t,"/normalTexture"),n.normalTexture,function(e){e.name="".concat(o.name," (Normal)"),r.bumpTexture=e,null!=n.normalTexture.scale&&(r.bumpTexture.level=n.normalTexture.scale)})),e.Utilities.HasOwnProperty(r,"invertNormalMapX")&&(r.invertNormalMapX=!this._loader.babylonScene.useRightHandedSystem),e.Utilities.HasOwnProperty(r,"invertNormalMapY")&&(r.invertNormalMapY=this._loader.babylonScene.useRightHandedSystem)),e.Utilities.HasOwnProperty(r,"ambientTexture")&&n.occlusionTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(t,"/occlusionTexture"),n.occlusionTexture,function(e){e.name="".concat(o.name," (Occlusion)"),r.ambientTexture=e,null!=n.occlusionTexture.strength&&(r.ambientTexture.level=n.occlusionTexture.strength)})),e.Utilities.HasOwnProperty(r,"emissiveColor")){var c=n.emissiveFactor?BABYLON.Color4.FromArray(n.emissiveFactor):new BABYLON.Color4(0,0,0,1);r.emissiveColor=new BABYLON.Color3(Math.pow(c.r,1/2.2),Math.pow(c.g,1/2.2),Math.pow(c.b,1/2.2))}switch(e.Utilities.HasOwnProperty(r,"emissiveTexture")&&n.emissiveTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(t,"/emissiveTexture"),n.emissiveTexture,function(t){t.name="".concat(o.name," (Emissive)"),r.emissiveTexture=t,e.Utilities.HasOwnProperty(r,"useEmissiveAsIllumination")&&(r.useEmissiveAsIllumination=null!=i&&null!=i.useEmissiveAsIllumination&&i.useEmissiveAsIllumination)})),e.Utilities.HasOwnProperty(r,"alpha")&&(r.alpha=l),n.alphaMode||e.MaterialAlphaMode.OPAQUE){case e.MaterialAlphaMode.OPAQUE:e.Utilities.HasOwnProperty(r,"alpha")&&(r.alpha=1);break;case e.MaterialAlphaMode.MASK:r.alphaCutOff=null==n.alphaCutoff?.5:n.alphaCutoff,r.diffuseTexture&&e.Utilities.HasOwnProperty(r,"diffuseTexture")&&(r.diffuseTexture.hasAlpha=!0);break;case e.MaterialAlphaMode.BLEND:r.diffuseTexture&&(e.Utilities.HasOwnProperty(r,"diffuseTexture")&&(r.diffuseTexture.hasAlpha=!0),e.Utilities.HasOwnProperty(r,"useAlphaFromDiffuseTexture")&&(r.useAlphaFromDiffuseTexture=!0));break;default:throw new Error("".concat(t,"/AlphaMode: Invalid value (").concat(n.alphaMode,")"))}return this._parseCommonConstantProperties(a,t,n,o),Promise.all(a).then(function(){})},t.prototype._parseCommonConstantProperties=function(t,n,o,i){var r=this,a=null!=o.extras&&null!=o.extras.metadata?o.extras.metadata:null;if(null!=a){var l=i;if(e.Utilities.HasOwnProperty(l,"alphaMode")&&(l.alphaMode=null!=a&&a.alphaMode?a.alphaMode:BABYLON.Engine.ALPHA_COMBINE),e.Utilities.HasOwnProperty(l,"ambientColor")&&(l.ambientColor=null!=a&&a.ambientColorFactor?BABYLON.Color3.FromArray(a.ambientColorFactor):BABYLON.Color3.Black()),e.Utilities.HasOwnProperty(l,"backFaceCulling")&&(l.backFaceCulling=null==a||null==a.backFaceCulling||a.backFaceCulling),i instanceof BABYLON.PBRMaterial){i.useMetallnessFromMetallicTextureBlue=!0,i.useRoughnessFromMetallicTextureGreen=!0,i.useRoughnessFromMetallicTextureAlpha=!1,i.useAmbientOcclusionFromMetallicTextureRed=!1,i.directIntensity=null!=a.directIntensity?a.directIntensity:1,i.specularIntensity=null!=a.specularIntensity?a.specularIntensity:1,i.emissiveIntensity=null!=a.emissiveIntensity?a.emissiveIntensity:1,i.environmentIntensity=null!=a.environmentIntensity?a.environmentIntensity:1,i.indexOfRefraction=null!=a.indexOfRefraction?a.indexOfRefraction:1.5;var s=null!=a.clearCoatIntensity?a.clearCoatIntensity:0;s>0&&(i.clearCoat.isEnabled=!0,i.clearCoat.intensity=s),null!=a.useAlphaFromAlbedoTexture&&(i.useAlphaFromAlbedoTexture=a.useAlphaFromAlbedoTexture),null!=a.parallaxBias&&a.parallaxBias>0&&(i.useParallax=!0,i.parallaxScaleBias=.9*a.parallaxBias,i.useParallaxOcclusion=null==a.parallaxOcclusion||a.parallaxOcclusion,!0===i.useParallaxOcclusion&&(i.parallaxScaleBias*=.5))}if(e.Utilities.HasOwnProperty(l,"unlit")&&(l.unlit=null!=a.unlitMaterial&&a.unlitMaterial),e.Utilities.HasOwnProperty(l,"wireframe")&&(l.wireframe=null!=a.useWireframe&&a.useWireframe),e.Utilities.HasOwnProperty(l,"disableLighting")&&(l.disableLighting=null!=a.disableLighting&&a.disableLighting),e.Utilities.HasOwnProperty(l,"maxSimultaneousLights")&&(l.maxSimultaneousLights=null!=a.maxSimultaneousLights?a.maxSimultaneousLights:4),e.Utilities.HasOwnProperty(l,"needDepthPrePass")&&(l.needDepthPrePass=null!=a.depthPrepass&&a.depthPrepass),e.Utilities.HasOwnProperty(l,"lightmapTexture")&&a.lightmapTexture){a.lightmapTexture.nonColorData=!0;var u=!0;e.Utilities.HasOwnProperty(l,"useLightmapAsShadowmap")&&(u=null==a.useLightmapAsShadowmap||a.useLightmapAsShadowmap);var c=null,d=null!=a.lightmapTexture.index?a.lightmapTexture.index:-1;d>=0&&(c=this._getCachedLightmapByIndex(d)),null!=c?(l.lightmapTexture=c,l.useLightmapAsShadowmap=u,e.Utilities.HasOwnProperty(l,"ambientColor")&&(l.ambientColor=BABYLON.Color3.White())):t.push(this._loader.loadTextureInfoAsync(n+"/lightmapTexture",a.lightmapTexture,function(t){t.name="assets/LightmapTexture-".concat(d),t.level=a.lightmapLevel?a.lightmapLevel:1;var n=t;!0==(null!=e.SceneManager.GlobalOptions.ktxlightmaps&&!0===e.SceneManager.GlobalOptions.ktxlightmaps)?t.gammaSpace=!0:(t.gammaSpace=!1,n.onLoadObservable.addOnce(function(){n.isReady()?n.isRGBD=!0:BABYLON.Tools.Warn("Failed to register texture as RGBD: "+n.name)})),l.lightmapTexture=t,d>=0&&null!=r._lightmapMap&&(r._lightmapMap.has(d)||r._lightmapMap.set(d,n)),l.useLightmapAsShadowmap=u,e.Utilities.HasOwnProperty(l,"ambientColor")&&(l.ambientColor=BABYLON.Color3.White())}))}i instanceof BABYLON.PBRMaterial&&a.detailMapTexture&&t.push(this._loader.loadTextureInfoAsync(n+"/detailMapTexture",a.detailMapTexture,function(e){e.name="".concat(i.name," (Detail Map)"),e.level=1,i.detailMap.texture=e,i.detailMap.bumpLevel=a.detailBumpLevel?a.detailBumpLevel:1,i.detailMap.diffuseBlendLevel=a.detailBlendLevel?a.detailBlendLevel:.75,i.detailMap.roughnessBlendLevel=a.detailRoughLevel?a.detailRoughLevel:.5,i.detailMap.isEnabled=!0}));var p=e.SceneManager.GetRenderQuality(),h=p===e.RenderQuality.High||p===e.RenderQuality.Medium;if(!0===h&&e.Utilities.HasOwnProperty(l,"reflectionColor")&&(l.reflectionColor=null!=a&&a.reflectionColorFactor?BABYLON.Color3.FromArray(a.reflectionColorFactor):BABYLON.Color3.White()),!0===h&&e.Utilities.HasOwnProperty(l,"reflectionTexture")&&a.reflectionCubemapInfo){var m=(this._loader._rootUrl+a.reflectionCubemapInfo.rooturl+a.reflectionCubemapInfo.name).toLowerCase(),f=m.lastIndexOf("."),g=f>-1?m.substring(f).toLowerCase():"",y=new e.CubeTextureLoader;y.name="assets/"+a.reflectionCubemapInfo.name,y.mapkey=m,y.material=l,y.extension=g,y.prefiltered=!0,a.reflectionCubemapInfo.boundingBoxSize&&(y.boundingBoxSize=BABYLON.Vector3.FromArray(a.reflectionCubemapInfo.boundingBoxSize),y.name+=" ("+y.boundingBoxSize.x.toString()+" "+y.boundingBoxSize.y.toString()+" "+y.boundingBoxSize.z.toString()+")",y.mapkey+="_"+y.boundingBoxSize.x.toString()+"_"+y.boundingBoxSize.y.toString()+"_"+y.boundingBoxSize.z.toString()),a.reflectionCubemapInfo.boundingBoxPosition&&(y.boundingBoxPosition=BABYLON.Vector3.FromArray(a.reflectionCubemapInfo.boundingBoxPosition),y.name+=" ("+y.boundingBoxPosition.x.toString()+" "+y.boundingBoxPosition.y.toString()+" "+y.boundingBoxPosition.z.toString()+")",y.mapkey+="_"+y.boundingBoxPosition.x.toString()+"_"+y.boundingBoxPosition.y.toString()+"_"+y.boundingBoxPosition.z.toString());var v=this._reflectionMap[m];null==v?(v=[y],this._reflectionMap[m]=v):v.push(y)}if(e.Utilities.HasOwnProperty(l,"terrainInfo")&&(l.terrainInfo=null!=a.terrainInfo?a.terrainInfo:null),e.Utilities.HasOwnProperty(i,"universalMaterial")){var _=i;if(a.customTextures){var b=function(e){var o=a.customTextures[e];null!=o&&(_.checkSampler(e),t.push(B._loader.loadTextureInfoAsync(n+"/"+e,o,function(t){t.name="".concat(i.name,"detailsSampler"===e||"normalsSampler"===e?" (Atlas)":" (Custom)"),_.setTextureValue(e,t)})))},B=this;for(var C in a.customTextures)b(C)}if(a.customVectors)for(var S in a.customVectors)null!=(M=a.customVectors[S])&&_.addVector4Uniform(S,BABYLON.Vector4.FromArray(M),!0);if(a.customColors)for(var A in a.customColors)null!=(L=a.customColors[A])&&_.addVector4Uniform(A,BABYLON.Vector4.FromArray(L),!0);if(a.customFloats)for(var T in a.customFloats)null!=(x=a.customFloats[T])&&_.addFloatUniform(T,x,!0)}else{if(a.customTextures){var O=function(o){var r=a.customTextures[o];null!=r&&e.Utilities.HasOwnProperty(l,o)&&t.push(I._loader.loadTextureInfoAsync(n+"/"+o,r,function(e){e.name="".concat(i.name,"detailsSampler"===o||"normalsSampler"===o?" (Atlas)":" (Custom)"),l[o]=e}))},I=this;for(var C in a.customTextures)O(C)}if(a.customVectors)for(var S in a.customVectors){var M;null!=(M=a.customVectors[S])&&e.Utilities.HasOwnProperty(l,S)&&(l[S]=BABYLON.Vector4.FromArray(M))}if(a.customColors)for(var A in a.customColors){var L;null!=(L=a.customColors[A])&&e.Utilities.HasOwnProperty(l,A)&&(l[A]instanceof BABYLON.Vector4?l[A]=BABYLON.Vector4.FromArray(L):l[A]instanceof BABYLON.Color4?l[A]=BABYLON.Color4.FromArray(L):l[A]=BABYLON.Color3.FromArray(L))}if(a.customFloats)for(var T in a.customFloats){var x;null!=(x=a.customFloats[T])&&e.Utilities.HasOwnProperty(l,T)&&(l[T]instanceof Boolean?l[T]=x>0:l[T]=x)}}null!=a.freezeMaterial&&!0===a.freezeMaterial&&null!=this._shaderList&&this._shaderList.push(i)}},t.ScriptBundleCache={},t}();e.CVTOOLS_unity_metadata=n;var o=function(){function t(t){this.name=e.SceneManager.CVTOOLS_MESH,this.enabled=!1,this._loader=t,this.enabled=this._loader.isExtensionUsed(e.SceneManager.CVTOOLS_MESH),this.order=101}return t.prototype.dispose=function(){delete this._loader},t}();e.CVTOOLS_babylon_mesh=o;var i=function(){function t(t){this.name=e.SceneManager.CVTOOLS_HAND,this.enabled=!1,this._loader=t,this.enabled=this._loader.isExtensionUsed(e.SceneManager.CVTOOLS_HAND),this.order=102}return t.prototype.dispose=function(){delete this._loader},t}();e.CVTOOLS_left_handed=i}(o||(o={})),BABYLON.SceneLoader.OnPluginActivatedObservable.add(function(e){null!=e&&"gltf"===e.name&&e instanceof BABYLON.GLTFFileLoader&&(e.extensions,e.animationStartMode=o.SceneManager.AnimationStartMode,e.targetFps=o.SceneManager.AnimationTargetFps,e.onSkinLoadedObservable&&e.onSkinLoadedObservable.add(function(e){if(null!=e){try{null!=e.skinnedNode&&(e.skinnedNode.id+=".Skin")}catch(e){console.warn(e)}try{null!=e.skinnedNode&&(e.skinnedNode.name+=".Skin")}catch(e){console.warn(e)}try{if(null!=e.node&&null!=e.skinnedNode){var t=BABYLON.Tags.GetTags(e.node);null!=t&&BABYLON.Tags.AddTagsTo(e.skinnedNode,t),e.node._skinnedMesh=e.skinnedNode}}catch(e){console.warn(e)}}}))}),function(e){var t=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.universalMaterial=!0,o._defines={},o._uniforms=[],o._samplers=[],o._attributes=[],o._textures={},o._vectors4={},o._vectors3={},o._vectors2={},o._floats={},o._bools={},o._ubos=null,o.shader=null,o.plugin=null,o}return i(t,e),t.prototype.addAttribute=function(e){-1===this._attributes.indexOf(e)&&this._attributes.push(e)},t.prototype.checkUniform=function(e,t,n){void 0===n&&(n=null),-1===this._uniforms.indexOf(e)&&(this._uniforms.push(e),this._defines[e.toUpperCase()]=!0,this.buildUniformProperty(e,t,n))},t.prototype.checkSampler=function(e,t){void 0===t&&(t=null),-1===this._samplers.indexOf(e)&&(this._samplers.push(e),this._defines[e.toUpperCase()]=!0,this.buildUniformProperty(e,"sampler2D",t),this.checkUniform(e+"Infos","vec2",BABYLON.Vector2.Zero()),this.checkUniform(e+"Matrix","mat4",BABYLON.Matrix.Identity()))},t.prototype.addTextureUniform=function(e,t){return this.checkSampler(e,t),this._textures[e]=t,this},t.prototype.setTextureValue=function(e,t){return this._textures[e]=t,this},t.prototype.getTextureValue=function(e){return this._textures[e]},t.prototype.addVector4Uniform=function(e,t){return this.checkUniform(e,"vec4",t),this._vectors4[e]=t,this},t.prototype.setVector4Value=function(e,t){return this._vectors4[e]=t,this},t.prototype.getVector4Value=function(e){return this._vectors4[e]},t.prototype.addVector3Uniform=function(e,t){return this.checkUniform(e,"vec3",t),this._vectors3[e]=t,this},t.prototype.setVector3Value=function(e,t){return this._vectors3[e]=t,this},t.prototype.getVector3Value=function(e){return this._vectors3[e]},t.prototype.addVector2Uniform=function(e,t){return this.checkUniform(e,"vec2",t),this._vectors2[e]=t,this},t.prototype.setVector2Value=function(e,t){return this._vectors2[e]=t,this},t.prototype.getVector2Value=function(e){return this._vectors2[e]},t.prototype.addFloatUniform=function(e,t){return this.checkUniform(e,"float",t),this._floats[e]=t,this},t.prototype.setFloatValue=function(e,t){return this._floats[e]=t,this},t.prototype.getFloatValue=function(e){return this._floats[e]},t.prototype.addBoolUniform=function(e,t){return this.checkUniform(e,"bool",t),this._bools[e]=t,this},t.prototype.setBoolValue=function(e,t){return this._bools[e]=t,this},t.prototype.getBoolValue=function(e){return this._bools[e]},t.prototype.getAnimatables=function(){var t=e.prototype.getAnimatables.call(this);for(var n in this._textures){var o=this._textures[n];o&&o.animations&&o.animations.length>0&&t.push(o)}return t},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);for(var n in this._textures){var o=this._textures[n];o&&t.push(o)}return t},t.prototype.hasTexture=function(t){if(e.prototype.hasTexture.call(this,t))return!0;var n=!1;for(var o in this._textures){var i=this._textures[o];if(i==i){n=!0;break}}return n},t.prototype.getCustomUniforms=function(e){var t=null;return null!=this._ubos&&this._ubos.length>0&&(t=this._ubos.filter(function(e){return"sampler2D"!==e.type})),t},t.prototype.getCustomSamplers=function(){return this._samplers},t.prototype.getCustomAttributes=function(){return this._attributes},t.prototype.getCustomVertexCode=function(e){return null},t.prototype.getCustomFragmentCode=function(e){var t=null;return null!=this._ubos&&this._ubos.length>0&&(t="#ifdef "+this.shader.toUpperCase()+"\n",this._ubos.forEach(function(n){!0===e?"sampler2D"===n.type&&(t+="\tvar "+n.name+": texture_2d<f32>;\n",t+="\tvar "+n.name+"Sampler: sampler;\n"):"float"===n.type||"bool"===n.type||"int"===n.type?t+="\tuniform float "+n.name+";\n":"vec2"===n.type?t+="\tuniform vec2 "+n.name+";\n":"vec3"===n.type?t+="\tuniform vec3 "+n.name+";\n":"vec4"===n.type?t+="\tuniform vec4 "+n.name+";\n":"mat4"===n.type?t+="\tuniform mat4 "+n.name+";\n":"sampler2D"===n.type&&(t+="\tuniform sampler2D "+n.name+";\n")}),t+="#endif\n"),t},t.prototype.prepareCustomDefines=function(e){if(e[this.shader.toUpperCase()]=!0,null!=this._defines){var t=Object.keys(this._defines);if(null!=t&&t.length>0)for(var n=0,o=t;n<o.length;n++){var i=o[n];e[i]=this._defines[i]}}e.isDirty&&e.rebuild()},t.prototype.updateCustomBindings=function(e){var t,n=this.getScene();if(this.update&&this.update(),n.texturesEnabled)for(t in this._textures){var o=this._textures[t];null!=o&&o.isReady&&o.isReady()&&(null==o.isChecked&&(o.isChecked=!0,("detailsSampler"===t||"normalsSampler"===t||t.indexOf("(Atlas)")>=0)&&o.updateSamplingMode(8)),e.setTexture(t,o),e.updateFloat2(t+"Infos",o.coordinatesIndex,o.level),e.updateMatrix(t+"Matrix",o.getTextureMatrix()))}for(t in this._vectors4)e.updateVector4(t,this._vectors4[t]);for(t in this._vectors3)e.updateVector3(t,this._vectors3[t]);for(t in this._vectors2)e.updateFloat2(t,this._vectors2[t].x,this._vectors2[t].y);for(t in this._floats)e.updateFloat(t,this._floats[t]);for(t in this._bools)e.updateFloat(t,this._bools[t]?1:0);e.update()},t.prototype.buildUniformProperty=function(e,t,n){var o=1;switch(t){case"float":case"bool":case"int":o=1;break;case"vec2":o=2;break;case"vec3":o=3;break;case"vec4":o=4;break;case"mat4":o=16}null==this._ubos&&(this._ubos=[]),this._ubos.push({name:e,size:o,type:t})},t}(BABYLON.PBRMaterial);e.CustomShaderMaterial=t,e.SceneManager.RegisterClass("TOOLKIT.CustomShaderMaterial",t);var n=function(e){function t(t,n,o,i,r,a,l){void 0===r&&(r=!0),void 0===a&&(a=!0),void 0===l&&(l=!1);var s=e.call(this,t,n,o,i,r,a,l)||this;return s._isEnabled=!1,s.vertexDefinitions=null,s.fragmentDefinitions=null,s.isEnabled=a,s}return i(t,e),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this.markAllDefinesAsDirty(),this._enable(this._isEnabled))},enumerable:!1,configurable:!0}),t.prototype.getCustomShaderMaterial=function(){return this._material},t}(BABYLON.MaterialPluginBase);e.CustomShaderMaterialPlugin=n,e.SceneManager.RegisterClass("TOOLKIT.CustomShaderMaterialPlugin",n)}(o||(o={})),function(e){var t=function(){function t(e){this._babylonScene=e,this._physicList=[],this._shadowList=[],this._scriptList=[],this._freezeList=[]}return t.prototype.parseSceneComponents=function(t){e.MetadataParser.DoParseSceneComponents(this._babylonScene,t,this._physicList,this._shadowList,this._scriptList,this._freezeList)},t.prototype.postProcessSceneComponents=function(t,n){e.MetadataParser.DoProcessPendingPhysics(this._babylonScene,this._physicList),e.MetadataParser.DoProcessPendingShadows(this._babylonScene,this._shadowList),e.MetadataParser.DoProcessPendingScripts(this._babylonScene,this._scriptList,t,n),e.MetadataParser.DoProcessPendingFreezes(this._freezeList),this._babylonScene=null,this._physicList=null,this._shadowList=null,this._scriptList=null,this._freezeList=null},t.DoParseSceneComponents=function(t,n,o,i,r,a){if(null!=n&&null!=n.metadata&&null!=n.metadata.toolkit&&null!=n.metadata.toolkit.parsed&&!1===n.metadata.toolkit.parsed){n.onDisposeObservable.addOnce(function(){e.Utilities.DisposeEntity(n)}),n.metadata.toolkit.parsed=!0,n.metadata.toolkit.prefab=!1;var l=n.metadata.toolkit,s=null==n.metadata.toolkit.visible||n.metadata.toolkit.visible,u=null!=n.metadata.toolkit.visibility?n.metadata.toolkit.visibility:1,c=null!=n.metadata.toolkit.billboard?n.metadata.toolkit.billboard:0,d=n instanceof BABYLON.AbstractMesh,p=(null!=n.metadata.toolkit.lightmapped&&n.metadata.toolkit.lightmapped,l.tags);if(null!=p&&""!==p&&(BABYLON.Tags.AddTagsTo(n,p),p.indexOf("NavigationMesh")>=0&&(n.isVisible=!1,n.isPickable=!1,n.useVertexColors=!1)),null!=l.physics&&null!=o&&o.push(n),null!=l.renderer)if(!0===d)n.isPickable=!0,n.useVertexColors=!1,n.isVisible=s,n.visibility=u,n.billboardMode=c,n.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(n.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&!0===l.renderer.castshadows&&null!=i&&i.push(n),null!=l.renderer.receiveshadows&&!0===l.renderer.receiveshadows&&(n.receiveShadows=!0),null!=l.renderer.checkcollisions&&!0===l.renderer.checkcollisions&&(n.checkCollisions=!0),null!=l.renderer.istriggervolume&&!0===l.renderer.istriggervolume&&(n.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(n.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(n.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(n.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(n.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(n.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(n.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&!0===l.renderer.freezeworldmatrix&&null!=a&&a.push(n),null!=l.renderer.snapshotrendering&&l.renderer.snapshotrendering>0&&(e.Utilities.PrepareSkeletonForRendering(n.skeleton),n.alwaysSelectAsActiveMesh=!0);else{var h=e.SceneManager.GetSkinnedMesh(n);if(null!=h)h.isPickable=!0,h.useVertexColors=!1,h.isVisible=s,h.visibility=u,h.billboardMode=c,h.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,h.alwaysSelectAsActiveMesh=!0,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(h.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&!0===l.renderer.castshadows&&null!=i&&i.push(h),null!=l.renderer.receiveshadows&&!0===l.renderer.receiveshadows&&(h.receiveShadows=!0),null!=l.renderer.checkcollisions&&!0===l.renderer.checkcollisions&&(h.checkCollisions=!0),null!=l.renderer.istriggervolume&&!0===l.renderer.istriggervolume&&(h.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(h.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(h.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(h.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(h.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(h.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(h.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&!0===l.renderer.freezeworldmatrix&&null!=a&&a.push(h),null!=l.renderer.snapshotrendering&&l.renderer.snapshotrendering>0&&e.Utilities.PrepareSkeletonForRendering(h.skeleton);else{var m=e.SceneManager.GetPrimitiveMeshes(n);null!=m&&m.length>0&&m.forEach(function(t){var n=e.SceneManager.GetSkinnedMesh(t);null!=n?(n.isPickable=!0,n.useVertexColors=!1,n.isVisible=s,n.visibility=u,n.billboardMode=c,n.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,n.alwaysSelectAsActiveMesh=!0,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(n.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&!0===l.renderer.castshadows&&null!=i&&i.push(n),null!=l.renderer.receiveshadows&&!0===l.renderer.receiveshadows&&(n.receiveShadows=!0),null!=l.renderer.checkcollisions&&!0===l.renderer.checkcollisions&&(n.checkCollisions=!0),null!=l.renderer.istriggervolume&&!0===l.renderer.istriggervolume&&(n.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(n.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(n.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(n.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(n.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(n.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(n.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&!0===l.renderer.freezeworldmatrix&&null!=a&&a.push(n),null!=l.renderer.snapshotrendering&&l.renderer.snapshotrendering>0&&e.Utilities.PrepareSkeletonForRendering(n.skeleton)):(t.isPickable=!0,t.useVertexColors=!1,t.isVisible=s,t.visibility=u,t.billboardMode=c,t.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(t.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&!0===l.renderer.castshadows&&null!=i&&i.push(t),null!=l.renderer.receiveshadows&&!0===l.renderer.receiveshadows&&(t.receiveShadows=!0),null!=l.renderer.checkcollisions&&!0===l.renderer.checkcollisions&&(t.checkCollisions=!0),null!=l.renderer.istriggervolume&&!0===l.renderer.istriggervolume&&(t.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(t.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(t.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(t.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(t.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(t.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(t.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&!0===l.renderer.freezeworldmatrix&&null!=a&&a.push(t),null!=l.renderer.snapshotrendering&&l.renderer.snapshotrendering>0&&(e.Utilities.PrepareSkeletonForRendering(t.skeleton),t.alwaysSelectAsActiveMesh=!0))})}}if(null!=l.components){var f=l.components;null!=f&&f.length>0&&f.forEach(function(o){if(null!=o)switch(o.alias){case"camera":e.MetadataParser.SetupCameraComponent(t,n,o);break;case"light":e.MetadataParser.SetupLightComponent(t,n,o);break;case"script":null!=r&&r.push({mesh:n,comp:o})}})}}},t.DoProcessPendingScripts=function(t,n,o,i){null!=n&&n.length>0&&(n.sort(function(e,t){return e.comp.order<t.comp.order?-1:e.comp.order>t.comp.order?1:0}),n.forEach(function(n){if(null!=n.comp.klass&&""!==n.comp.klass&&"TOOLKIT.ScriptComponent"!==n.comp.klass){var r=n.comp.klass;if(!0===e.SceneManager.AutoStripNamespacePrefix&&!1===e.SceneManager.UniversalModuleDefinition){var a=r.lastIndexOf(".");-1!==a&&(r=r.substring(a+1))}null==n.comp.properties&&(n.comp.properties={}),n.comp.properties._scriptComponentAlias=r,n.comp.properties._registerComponentAlias=!1;var l=e.Utilities.InstantiateClass(r);if(null!=l){var s=new l(n.mesh,t,n.comp.properties);null!=s?!0==s instanceof e.ScriptComponent?(n.comp.instance=s,null!=i&&i.push(n.comp.instance),n.comp.instance.addPreloaderTasks&&null!=o&&o.push(n.comp.instance),e.SceneManager.AttachScriptComponent(n.comp.instance,r,!1)):BABYLON.Tools.Warn("Non script component instantiated class: "+r):BABYLON.Tools.Warn("Failed to instantiate script class: "+r)}else BABYLON.Tools.Warn("Failed to locate script class: "+r)}}))},t.DoProcessPendingShadows=function(e,t){null!=t&&t.length>0&&null!=e.lights&&e.lights.length>0&&e.lights.forEach(function(e){var n=e.getShadowGenerator();if(null!=n&&null!=e.metadata&&null!=e.metadata.toolkit&&!0===e.metadata.toolkit.autorender){var o=n.getShadowMap();null!=o&&t.forEach(function(t){!0==(!(null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0)||e.includedOnlyMeshes.indexOf(t)>=0)&&(null==o.renderList&&(o.renderList=[]),o.renderList.indexOf(t)<0&&o.renderList.push(t))})}})},t.DoProcessPendingPhysics=function(t,n){if(null!=n&&n.length>0){var o=t.isPhysicsEnabled(),i=!0===o?t.getPhysicsEngine():null;!0==(!0===o&&null!=i)?n.forEach(function(n){e.RigidbodyPhysics.SetupPhysicsComponent(t,n)}):BABYLON.Tools.Warn("Physics engine not loaded. Physics impostors will not be created.")}},t.DoProcessPendingFreezes=function(e){null!=e&&e.length>0&&e.forEach(function(e){e.freezeWorldMatrix()})},t.SetupCameraComponent=function(t,n,o){n.checkCollisions=!1;var i=0,r=n.name+".Rig",a=null!=o.culling?o.culling:-1,l=null!=o.camerabase?o.camerabase:0,s=(null!=o.clearflags&&o.clearflags,null!=o.renderlist?o.renderlist:null),u=null!=o.maincamera&&o.maincamera,c=4===l?new BABYLON.FreeCamera(r,BABYLON.Vector3.Zero(),t):new BABYLON.UniversalCamera(r,BABYLON.Vector3.Zero(),t);switch(c.checkCollisions=!1,c.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(0,0,0),c.parent=n,!0===u&&(t.activeCamera=c),null!=o.type?o.type:0){case 0:c.mode=BABYLON.Camera.PERSPECTIVE_CAMERA,null!=o.perspectiveyfov&&(c.fov=o.perspectiveyfov),null!=o.perspectiveznear&&(c.minZ=o.perspectiveznear),null!=o.perspectivezfar&&(c.maxZ=o.perspectivezfar);break;case 1:c.mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA,null!=o.orthoxmag&&(c.orthoLeft=-o.orthoxmag,c.orthoRight=o.orthoxmag),null!=o.orthoymag&&(c.orthoBottom=-o.orthoymag,c.orthoTop=o.orthoymag),null!=o.orthoznear&&(c.minZ=o.orthoznear),null!=o.orthozfar&&(c.maxZ=o.orthozfar)}if(-1===a);else if(0===a);else{var d=s;if(null!=d&&d.length>0){var p=function(){var n=d[i],o=e.SceneManager.GetMeshByID(t,n);if(null!=o){var r=o.name+".Detail",a=o.getChildren(function(e){return e.name===r},!0);null!=a&&a.length}};for(i=0;i<d.length;i++)p()}}n.cameraRig=c},t.SetupLightComponent=function(t,n,o){n.checkCollisions=!1;var i,r=n.name+".Rig",a=0,l=1,s=null!=o.culling?o.culling:-1,u=(null!=o.clearflags&&o.clearflags,null!=o.renderlist?o.renderlist:null),c=null!=o.type?o.type:0,d=e.SceneManager.GetRenderQuality(),p=null!=o.exponentdecayspeed?o.exponentdecayspeed:1,h=!1;switch(c){case 0:var m=BABYLON.Vector3.Forward(),f=null!=o.orthoscale?o.orthoscale:.1,g=null!=o.ortholeft?o.ortholeft:Number.MAX_VALUE,y=null!=o.orthoright?o.orthoright:Number.MAX_VALUE,v=null!=o.orthotop?o.orthotop:Number.MAX_VALUE,_=null!=o.orthobottom?o.orthobottom:Number.MAX_VALUE,b=null!=o.calczbounds&&o.calczbounds,B=null!=o.updateextends&&o.updateextends,C=null!=o.shadowfrustumsize?o.shadowfrustumsize:0,S=new BABYLON.DirectionalLight(r,m,t);S.shadowFrustumSize=C,S.shadowOrthoScale=f,S.autoCalcShadowZBounds=b,S.autoUpdateExtends=B,S.orthoLeft=g,S.orthoRight=y,S.orthoTop=v,S.orthoBottom=_,(i=S).falloffType=BABYLON.Light.FALLOFF_STANDARD,h=d===e.RenderQuality.High||d===e.RenderQuality.Medium,l=e.SceneManager.DirectionalLightIntensity;break;case 1:var A=i=new BABYLON.PointLight(r,BABYLON.Vector3.Zero(),t);(i=A).falloffType=BABYLON.Light.FALLOFF_STANDARD,h=d===e.RenderQuality.High||d===e.RenderQuality.Medium,l=e.SceneManager.PointLightIntensity;break;case 2:m=BABYLON.Vector3.Forward();var T=null!=o.spotangle?o.spotangle:Math.PI/4,O=new BABYLON.SpotLight(r,BABYLON.Vector3.Zero(),m,0,p,t);O.angle=.966*BABYLON.Tools.ToRadians(T),O.innerAngle=.8*O.angle,(i=O).falloffType=BABYLON.Light.FALLOFF_GLTF,h=d===e.RenderQuality.High||d===e.RenderQuality.Medium,l=e.SceneManager.SpotLightIntensity}if(null!=i){var I=null!=o.range?o.range:Number.MAX_VALUE,M=null!=o.color?e.Utilities.ParseColor3(o.color,BABYLON.Color3.White()):BABYLON.Color3.White(),L=null!=o.specular?e.Utilities.ParseColor3(o.specular,BABYLON.Color3.White()):BABYLON.Color3.White(),x=null!=o.lightmapmode?o.lightmapmode:0;null!=o.lightmaptype&&o.lightmaptype,i.parent=n,i.range=I,i.diffuse=M,i.specular=L,i.intensity=(null!=o.intensity?o.intensity:1)*l,i.lightmapMode=1===x?BABYLON.Light.LIGHTMAP_SHADOWSONLY:BABYLON.Light.LIGHTMAP_DEFAULT,i.intensityMode=BABYLON.Light.INTENSITYMODE_AUTOMATIC,i.shadowEnabled=!1;var w=null==o.autorender||o.autorender,P=null!=o.softshadows&&o.softshadows,N=null!=o.numcascades?o.numcascades:0,k=null!=o.cascadelambda?o.cascadelambda:1,R=null!=o.setdepthclamp&&o.setdepthclamp,D=null!=o.blendpertecntage?o.blendpertecntage:1e-8,E=null!=o.boundsrefreshrate?o.boundsrefreshrate:1,V=null!=o.lightcontactratio?o.lightcontactratio:.1,U=null!=o.stabilizecascades&&o.stabilizecascades,F=null!=o.penumbradarkness?o.penumbradarkness:1,Y=null!=o.softshadowsfilter?o.softshadowsfilter:99,G=null!=o.freezeshadows&&o.freezeshadows,H=null!=o.calcdepths&&o.calcdepths,z=null!=o.depthscaling?o.depthscaling:50,W=null!=o.blurscaling?o.blurscaling:2,Q=null==o.kernelblur||o.kernelblur,X=null!=o.blurkernelsize?o.blurkernelsize:1,K=null!=o.blurboxoffset?o.blurboxoffset:1,j=null!=o.shadowmapsize?o.shadowmapsize:1024,Z=null!=o.generateshadows&&o.generateshadows,q=null!=o.shadowbiasfactor?o.shadowbiasfactor:.1,J=null!=o.normalbiasfactor?o.normalbiasfactor:1,$=null!=o.shadowmapbias?o.shadowmapbias:.05,ee=null!=o.normalmapbias?o.normalmapbias:.4,te=null!=o.shadowstrength?o.shadowstrength:1,ne=null!=o.shadowdistance?o.shadowdistance:150,oe=null!=o.shadownearplane?o.shadownearplane:.2,ie=null!=o.shadowfilterquality?o.shadowfilterquality:"Medium",re=null!=o.transparencyshadow&&o.transparencyshadow,ae=null!=o.softtransparency&&o.softtransparency,le=null==o.forcebackfacesonly||o.forcebackfacesonly,se=null!=o.frustumedgefalloff?o.frustumedgefalloff:0,ue=null!=o.usefullfloatfirst&&o.usefullfloatfirst;if(!0===h&&!0===Z){var ce=i,de=e.SceneManager.GetEngine(t),pe=de instanceof BABYLON.Engine?de.webGLVersion:0,he=de instanceof BABYLON.WebGPUEngine?1:0,me=0===c&&N>=2&&(pe>=2||he>=1),fe=!0===me?new BABYLON.CascadedShadowGenerator(j,i,ue):new BABYLON.ShadowGenerator(j,ce,ue);if(fe.bias=$*q,fe.normalBias=ee*J,fe.depthScale=z,fe.useKernelBlur=Q,fe.blurKernel=X,fe.blurScale=W,fe.blurBoxOffset=K,fe.frustumEdgeFalloff=se,fe.forceBackFacesOnly=le,fe.transparencyShadow=re,fe.enableSoftTransparentShadow=ae,fe.contactHardeningLightSizeUVRatio=V,!0===P)if(pe<=1&&he<=0)fe.usePoissonSampling=!0;else if(!0===me)fe.usePercentageCloserFiltering=!0;else switch(Y){case 0:default:fe.usePoissonSampling=!0;break;case 1:fe.useExponentialShadowMap=!0;break;case 2:fe.useBlurExponentialShadowMap=!0;break;case 3:fe.useCloseExponentialShadowMap=!0;break;case 4:fe.useBlurCloseExponentialShadowMap=!0;break;case 5:fe.useContactHardeningShadow=!0;break;case 99:fe.usePercentageCloserFiltering=!0}switch(ie){case"High":fe.filteringQuality=BABYLON.ShadowGenerator.QUALITY_HIGH;break;case"Medium":fe.filteringQuality=BABYLON.ShadowGenerator.QUALITY_MEDIUM;break;case"Low":fe.filteringQuality=BABYLON.ShadowGenerator.QUALITY_LOW}if(!0===me){var ge=fe;ge.lambda=k,ge.depthClamp=R,ge.shadowMaxZ=ne,ge.numCascades=N,ge.penumbraDarkness=F,ge.autoCalcDepthBounds=H,ge.stabilizeCascades=U,ge.cascadeBlendPercentage=D,ge.autoCalcDepthBoundsRefreshRate=E,ge.freezeShadowCastersBoundingInfo=G,ge.setDarkness(1-BABYLON.Scalar.Clamp(te)),ce.shadowEnabled=!0,ge.splitFrustum()}else fe.setDarkness(1-BABYLON.Scalar.Clamp(te)),ce.shadowEnabled=!0,ce.shadowMinZ=oe,ce.shadowMaxZ=ne;null==i.metadata&&(i.metadata={}),null==i.metadata.toolkit&&(i.metadata.toolkit={}),i.metadata.toolkit.autorender=w}var ye=n.name+".Holder";if(-1===s)i.includedOnlyMeshes=[];else if(0===s)i.includedOnlyMeshes=[new BABYLON.Mesh(ye,t)];else{i.includedOnlyMeshes=[new BABYLON.Mesh(ye,t)];var ve=u;if(null!=ve&&ve.length>0){var _e=function(){var n=ve[a],o=e.SceneManager.GetMeshByID(t,n);if(null!=o){var r=o.name+".Detail",l=o.getChildren(function(e){return e.name===r},!0);null!=l&&l.length>0?i.includedOnlyMeshes.push(l[0]):i.includedOnlyMeshes.push(o)}};for(a=0;a<ve.length;a++)_e()}}n.lightRig=i}},t}();e.MetadataParser=t}(o||(o={})),function(e){var t=function(){function t(e){void 0===e&&(e=Recast),this.bjsRECAST={},this.name="TOOLKIT.RecastJSPluginExtension",this.navMeshes=[],this._maximumSubStepCount=10,this._timeStep=1/60,this._timeFactor=1,this._worker=null,"function"==typeof e?BABYLON.Logger.Error("RecastJS is not ready. Please make sure you await Recast() before using the plugin."):this.bjsRECAST=e,this.isSupported()?(this.setTimeStep(),this._tempVec1=new this.bjsRECAST.Vec3,this._tempVec2=new this.bjsRECAST.Vec3):BABYLON.Logger.Error("RecastJS is not available. Please make sure you included the js file.")}return t.prototype.setWorkerURL=function(e){return!(!window||!window.Worker||(this._worker=new Worker(e),0))},t.prototype.setTimeStep=function(e){void 0===e&&(e=1/60),this._timeStep=e},t.prototype.getTimeStep=function(){return this._timeStep},t.prototype.setMaximumSubStepCount=function(e){void 0===e&&(e=10),this._maximumSubStepCount=e},t.prototype.getMaximumSubStepCount=function(){return this._maximumSubStepCount},Object.defineProperty(t.prototype,"timeFactor",{get:function(){return this._timeFactor},set:function(e){this._timeFactor=Math.max(e,0)},enumerable:!1,configurable:!0}),t.prototype.setActiveNavMesh=function(e){return null!=this.navMeshes&&e>=0&&e<this.navMeshes.length&&(this.navMesh=this.navMeshes[e],!0)},t.prototype.getActiveNavMesh=function(){return this.navMesh},t.prototype.getIndexedNavMesh=function(e){var t=null;return null!=this.navMeshes&&e>=0&&e<this.navMeshes.length&&(t=this.navMeshes[e]),t},t.prototype.getNavMeshCount=function(){return null!=this.navMeshes?this.navMeshes.length:0},t.prototype.getNavMeshArray=function(){return this.navMeshes},t.prototype.createNavMesh=function(e,t,n){this._worker&&!n?BABYLON.Logger.Warn("A worker is avaible but no completion callback. Defaulting to blocking navmesh creation"):!this._worker&&n&&BABYLON.Logger.Warn("A completion callback is avaible but no worker. Defaulting to blocking navmesh creation"),this.navMesh=new this.bjsRECAST.NavMesh,null==this.navMeshes&&(this.navMeshes=[]),this.navMeshes.push(this.navMesh);var o,i,r,a=this.navMeshes.length-1,l=[],s=[],u=0;for(o=0;o<e.length;o++)if(e[o]){var c=e[o],d=c.getIndices();if(!d)continue;var p=c.getVerticesData(BABYLON.VertexBuffer.PositionKind,!1,!1);if(!p)continue;var h=[],m=c.computeWorldMatrix(!0);if(c.hasThinInstances)for(var f=c.thinInstanceGetWorldMatrices(),g=0;g<f.length;g++){var y=new BABYLON.Matrix;f[g].multiplyToRef(m,y),h.push(y)}else h.push(m);for(var v=0;v<h.length;v++){var _=h[v];for(i=0;i<d.length;i++)l.push(d[i]+u);var b=BABYLON.Vector3.Zero(),B=BABYLON.Vector3.Zero();for(r=0;r<p.length;r+=3)BABYLON.Vector3.FromArrayToRef(p,r,B),BABYLON.Vector3.TransformCoordinatesToRef(B,_,b),s.push(b.x,b.y,b.z);u+=p.length/3}}if(this._worker&&n)this._worker.postMessage([s,u,l,l.length,t]),this._worker.onmessage=function(e){n(e.data)};else{var C=new this.bjsRECAST.rcConfig;C.cs=t.cs,C.ch=t.ch,C.borderSize=t.borderSize?t.borderSize:0,C.tileSize=t.tileSize?t.tileSize:0,C.walkableSlopeAngle=t.walkableSlopeAngle,C.walkableHeight=t.walkableHeight,C.walkableClimb=t.walkableClimb,C.walkableRadius=t.walkableRadius,C.maxEdgeLen=t.maxEdgeLen,C.maxSimplificationError=t.maxSimplificationError,C.minRegionArea=t.minRegionArea,C.mergeRegionArea=t.mergeRegionArea,C.maxVertsPerPoly=t.maxVertsPerPoly,C.detailSampleDist=t.detailSampleDist,C.detailSampleMaxError=t.detailSampleMaxError,this.navMesh.build(s,u,l,l.length,C)}return a},t.prototype.createDebugNavMesh=function(e){var t,n,o=this.navMesh.getDebugNavMesh(),i=o.getTriangleCount(),r=[],a=[];for(t=0;t<3*i;t++)r.push(t);for(t=0;t<i;t++)for(n=0;n<3;n++){var l=o.getTriangle(t).getPoint(n);a.push(l.x,l.y,l.z)}var s=new BABYLON.Mesh("NavMeshDebug",e),u=new BABYLON.VertexData;return u.indices=r,u.positions=a,u.applyToMesh(s,!1),s},t.prototype.getClosestPoint=function(e){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z;var t=this.navMesh.getClosestPoint(this._tempVec1);return new BABYLON.Vector3(t.x,t.y,t.z)},t.prototype.getClosestPointToRef=function(e,t){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z;var n=this.navMesh.getClosestPoint(this._tempVec1);t.set(n.x,n.y,n.z)},t.prototype.getRandomPointAround=function(e,t){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z;var n=this.navMesh.getRandomPointAround(this._tempVec1,t);return new BABYLON.Vector3(n.x,n.y,n.z)},t.prototype.getRandomPointAroundToRef=function(e,t,n){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z;var o=this.navMesh.getRandomPointAround(this._tempVec1,t);n.set(o.x,o.y,o.z)},t.prototype.moveAlong=function(e,t){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this._tempVec2.x=t.x,this._tempVec2.y=t.y,this._tempVec2.z=t.z;var n=this.navMesh.moveAlong(this._tempVec1,this._tempVec2);return new BABYLON.Vector3(n.x,n.y,n.z)},t.prototype.moveAlongToRef=function(e,t,n){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this._tempVec2.x=t.x,this._tempVec2.y=t.y,this._tempVec2.z=t.z;var o=this.navMesh.moveAlong(this._tempVec1,this._tempVec2);n.set(o.x,o.y,o.z)},t.prototype._convertNavPathPoints=function(e){var t,n=e.getPointCount(),o=[];for(t=0;t<n;t++){var i=e.getPoint(t);o.push(new BABYLON.Vector3(i.x,i.y,i.z))}return o},t.prototype.computePath=function(e,t){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this._tempVec2.x=t.x,this._tempVec2.y=t.y,this._tempVec2.z=t.z;var n=this.navMesh.computePath(this._tempVec1,this._tempVec2);return this._convertNavPathPoints(n)},t.prototype.computePathSmooth=function(e,t){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this._tempVec2.x=t.x,this._tempVec2.y=t.y,this._tempVec2.z=t.z;var n=this.navMesh.computePathSmooth(this._tempVec1,this._tempVec2);return this._convertNavPathPoints(n)},t.prototype.createCrowd=function(t,n,o){return new e.RecastJSCrowdExtension(this,t,n,o)},t.prototype.setDefaultQueryExtent=function(e){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this.navMesh.setDefaultQueryExtent(this._tempVec1)},t.prototype.getDefaultQueryExtent=function(){var e=this.navMesh.getDefaultQueryExtent();return new BABYLON.Vector3(e.x,e.y,e.z)},t.prototype.buildFromNavmeshData=function(e){var t=e.length*e.BYTES_PER_ELEMENT,n=this.bjsRECAST._malloc(t),o=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,n,t);o.set(e);var i=new this.bjsRECAST.NavmeshData;i.dataPointer=o.byteOffset,i.size=e.length,this.navMesh=new this.bjsRECAST.NavMesh,null==this.navMeshes&&(this.navMeshes=[]),this.navMeshes.push(this.navMesh);var r=this.navMeshes.length-1;return this.navMesh.buildFromNavmeshData(i),this.bjsRECAST._free(o.byteOffset),r},t.prototype.getNavmeshData=function(){var e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,e.dataPointer,e.size),n=new Uint8Array(e.size);return n.set(t),this.navMesh.freeNavmeshData(e),n},t.prototype.getDefaultQueryExtentToRef=function(e){var t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)},t.prototype.dispose=function(){},t.prototype.addCylinderObstacle=function(e,t,n){return this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this.navMesh.addCylinderObstacle(this._tempVec1,t,n)},t.prototype.addBoxObstacle=function(e,t,n){return this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this._tempVec2.x=t.x,this._tempVec2.y=t.y,this._tempVec2.z=t.z,this.navMesh.addBoxObstacle(this._tempVec1,this._tempVec2,n)},t.prototype.removeObstacle=function(e){this.navMesh.removeObstacle(e)},t.prototype.isSupported=function(){return void 0!==this.bjsRECAST},t.prototype.getRandomSeed=function(){return this.bjsRECAST._getRandomSeed()},t.prototype.setRandomSeed=function(e){this.bjsRECAST._setRandomSeed(e)},t}();e.RecastJSPluginExtension=t;var n=function(){function e(e,t,n,o){var i=this;this.recastCrowd={},this.transforms=new Array,this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this._onBeforeAnimationsObserver=null,this.onReachTargetObservable=new BABYLON.Observable,this.bjsRECASTPlugin=e,this.recastCrowd=new this.bjsRECASTPlugin.bjsRECAST.Crowd(t,n,this.bjsRECASTPlugin.navMesh.getNavMesh()),this._scene=o,this._onBeforeAnimationsObserver=o.onBeforeAnimationsObservable.add(function(){i.update(.001*o.getEngine().getDeltaTime()*e.timeFactor)})}return e.prototype.addAgent=function(e,t,n){var o=new this.bjsRECASTPlugin.bjsRECAST.dtCrowdAgentParams;o.radius=t.radius,o.height=t.height,o.maxAcceleration=t.maxAcceleration,o.maxSpeed=t.maxSpeed,o.collisionQueryRange=t.collisionQueryRange,o.pathOptimizationRange=t.pathOptimizationRange,o.separationWeight=t.separationWeight,o.updateFlags=7,o.obstacleAvoidanceType=0,o.queryFilterType=0,o.userData=0;var i=this.recastCrowd.addAgent(new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x,e.y,e.z),o);return this.transforms.push(n),this.agents.push(i),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new BABYLON.Vector3(0,0,0)),i},e.prototype.getAgentPosition=function(e){var t=this.recastCrowd.getAgentPosition(e);return new BABYLON.Vector3(t.x,t.y,t.z)},e.prototype.getAgentPositionToRef=function(e,t){var n=this.recastCrowd.getAgentPosition(e);t.set(n.x,n.y,n.z)},e.prototype.getAgentVelocity=function(e){var t=this.recastCrowd.getAgentVelocity(e);return new BABYLON.Vector3(t.x,t.y,t.z)},e.prototype.getAgentVelocityToRef=function(e,t){var n=this.recastCrowd.getAgentVelocity(e);t.set(n.x,n.y,n.z)},e.prototype.getAgentNextTargetPath=function(e){var t=this.recastCrowd.getAgentNextTargetPath(e);return new BABYLON.Vector3(t.x,t.y,t.z)},e.prototype.getAgentNextTargetPathToRef=function(e,t){var n=this.recastCrowd.getAgentNextTargetPath(e);t.set(n.x,n.y,n.z)},e.prototype.getAgentState=function(e){return this.recastCrowd.getAgentState(e)},e.prototype.overOffmeshConnection=function(e){return this.recastCrowd.overOffmeshConnection(e)},e.prototype.agentGoto=function(e,t){this.recastCrowd.agentGoto(e,new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x,t.y,t.z));var n=this.agents.indexOf(e);n>-1&&(this._agentDestinationArmed[n]=!0,this._agentDestination[n].set(t.x,t.y,t.z))},e.prototype.agentTeleport=function(e,t){this.recastCrowd.agentTeleport(e,new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x,t.y,t.z))},e.prototype.updateAgentParameters=function(e,t){var n=this.recastCrowd.getAgentParameters(e);void 0!==t.radius&&(n.radius=t.radius),void 0!==t.height&&(n.height=t.height),void 0!==t.maxAcceleration&&(n.maxAcceleration=t.maxAcceleration),void 0!==t.maxSpeed&&(n.maxSpeed=t.maxSpeed),void 0!==t.collisionQueryRange&&(n.collisionQueryRange=t.collisionQueryRange),void 0!==t.pathOptimizationRange&&(n.pathOptimizationRange=t.pathOptimizationRange),void 0!==t.separationWeight&&(n.separationWeight=t.separationWeight),this.recastCrowd.setAgentParameters(e,n)},e.prototype.removeAgent=function(e){this.recastCrowd.removeAgent(e);var t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))},e.prototype.getAgents=function(){return this.agents},e.prototype.update=function(e){if(this.bjsRECASTPlugin.navMesh.update(),!(e<=BABYLON.Epsilon)){var t=this.bjsRECASTPlugin.getTimeStep(),n=this.bjsRECASTPlugin.getMaximumSubStepCount();if(t<=BABYLON.Epsilon)this.recastCrowd.update(e);else{var o=Math.floor(e/t);n&&o>n&&(o=n),o<1&&(o=1);for(var i=e/o,r=0;r<o;r++)this.recastCrowd.update(i)}for(var a=0;a<this.agents.length;a++){var l=this.agents[a],s=this.getAgentPosition(l);if(this.transforms[a].position=s,this._agentDestinationArmed[a]){var u=s.x-this._agentDestination[a].x,c=s.z-this._agentDestination[a].z,d=this.reachRadii[a],p=this._agentDestination[a].y-this.reachRadii[a],h=this._agentDestination[a].y+this.reachRadii[a],m=u*u+c*c;s.y>p&&s.y<h&&m<d*d&&(this._agentDestinationArmed[a]=!1,this.onReachTargetObservable.notifyObservers({agentIndex:l,destination:this._agentDestination[a]}))}}}},e.prototype.setDefaultQueryExtent=function(e){var t=new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x,e.y,e.z);this.recastCrowd.setDefaultQueryExtent(t)},e.prototype.getDefaultQueryExtent=function(){var e=this.recastCrowd.getDefaultQueryExtent();return new BABYLON.Vector3(e.x,e.y,e.z)},e.prototype.getDefaultQueryExtentToRef=function(e){var t=this.recastCrowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)},e.prototype.getCorners=function(e){var t,n=this.recastCrowd.getCorners(e),o=n.getPointCount(),i=[];for(t=0;t<o;t++){var r=n.getPoint(t);i.push(new BABYLON.Vector3(r.x,r.y,r.z))}return i},e.prototype.dispose=function(){this.recastCrowd.destroy(),this._scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.onReachTargetObservable.clear()},e}();e.RecastJSCrowdExtension=n}(o||(o={})),function(e){var t=function(){function e(){}return e.fastFloor=function(e){return 0|Math.floor(e)},e.createNoise2D=function(t){void 0===t&&(t=Math.random);var n=e.buildPermutationTable(t),o=new Float64Array(n).map(function(t){return e.grad2[t%12*2]}),i=new Float64Array(n).map(function(t){return e.grad2[t%12*2+1]});return function(t,r){var a,l,s=0,u=0,c=0,d=(t+r)*e.F2,p=e.fastFloor(t+d),h=e.fastFloor(r+d),m=(p+h)*e.G2,f=t-(p-m),g=r-(h-m);f>g?(a=1,l=0):(a=0,l=1);var y=f-a+e.G2,v=g-l+e.G2,_=f-1+2*e.G2,b=g-1+2*e.G2,B=255&p,C=255&h,S=.5-f*f-g*g;if(S>=0){var A=B+n[C];s=(S*=S)*S*(o[A]*f+i[A]*g)}var T=.5-y*y-v*v;if(T>=0){var O=B+a+n[C+l];u=(T*=T)*T*(o[O]*y+i[O]*v)}var I=.5-_*_-b*b;if(I>=0){var M=B+1+n[C+1];c=(I*=I)*I*(o[M]*_+i[M]*b)}return 70*(s+u+c)}},e.createNoise3D=function(t){void 0===t&&(t=Math.random);var n=e.buildPermutationTable(t),o=new Float64Array(n).map(function(t){return e.grad3[t%12*3]}),i=new Float64Array(n).map(function(t){return e.grad3[t%12*3+1]}),r=new Float64Array(n).map(function(t){return e.grad3[t%12*3+2]});return function(t,a,l){var s,u,c,d,p,h,m,f,g,y,v=(t+a+l)*e.F3,_=e.fastFloor(t+v),b=e.fastFloor(a+v),B=e.fastFloor(l+v),C=(_+b+B)*e.G3,S=t-(_-C),A=a-(b-C),T=l-(B-C);S>=A?A>=T?(p=1,h=0,m=0,f=1,g=1,y=0):S>=T?(p=1,h=0,m=0,f=1,g=0,y=1):(p=0,h=0,m=1,f=1,g=0,y=1):A<T?(p=0,h=0,m=1,f=0,g=1,y=1):S<T?(p=0,h=1,m=0,f=0,g=1,y=1):(p=0,h=1,m=0,f=1,g=1,y=0);var O=S-p+e.G3,I=A-h+e.G3,M=T-m+e.G3,L=S-f+2*e.G3,x=A-g+2*e.G3,w=T-y+2*e.G3,P=S-1+3*e.G3,N=A-1+3*e.G3,k=T-1+3*e.G3,R=255&_,D=255&b,E=255&B,V=.6-S*S-A*A-T*T;if(V<0)s=0;else{var U=R+n[D+n[E]];s=(V*=V)*V*(o[U]*S+i[U]*A+r[U]*T)}var F=.6-O*O-I*I-M*M;if(F<0)u=0;else{var Y=R+p+n[D+h+n[E+m]];u=(F*=F)*F*(o[Y]*O+i[Y]*I+r[Y]*M)}var G=.6-L*L-x*x-w*w;if(G<0)c=0;else{var H=R+f+n[D+g+n[E+y]];c=(G*=G)*G*(o[H]*L+i[H]*x+r[H]*w)}var z=.6-P*P-N*N-k*k;if(z<0)d=0;else{var W=R+1+n[D+1+n[E+1]];d=(z*=z)*z*(o[W]*P+i[W]*N+r[W]*k)}return 32*(s+u+c+d)}},e.createNoise4D=function(t){void 0===t&&(t=Math.random);var n=e.buildPermutationTable(t),o=new Float64Array(n).map(function(t){return e.grad4[t%32*4]}),i=new Float64Array(n).map(function(t){return e.grad4[t%32*4+1]}),r=new Float64Array(n).map(function(t){return e.grad4[t%32*4+2]}),a=new Float64Array(n).map(function(t){return e.grad4[t%32*4+3]});return function(t,l,s,u){var c,d,p,h,m,f=(t+l+s+u)*e.F4,g=e.fastFloor(t+f),y=e.fastFloor(l+f),v=e.fastFloor(s+f),_=e.fastFloor(u+f),b=(g+y+v+_)*e.G4,B=t-(g-b),C=l-(y-b),S=s-(v-b),A=u-(_-b),T=0,O=0,I=0,M=0;B>C?T++:O++,B>S?T++:I++,B>A?T++:M++,C>S?O++:I++,C>A?O++:M++,S>A?I++:M++;var L=T>=3?1:0,x=O>=3?1:0,w=I>=3?1:0,P=M>=3?1:0,N=T>=2?1:0,k=O>=2?1:0,R=I>=2?1:0,D=M>=2?1:0,E=T>=1?1:0,V=O>=1?1:0,U=I>=1?1:0,F=M>=1?1:0,Y=B-L+e.G4,G=C-x+e.G4,H=S-w+e.G4,z=A-P+e.G4,W=B-N+2*e.G4,Q=C-k+2*e.G4,X=S-R+2*e.G4,K=A-D+2*e.G4,j=B-E+3*e.G4,Z=C-V+3*e.G4,q=S-U+3*e.G4,J=A-F+3*e.G4,$=B-1+4*e.G4,ee=C-1+4*e.G4,te=S-1+4*e.G4,ne=A-1+4*e.G4,oe=255&g,ie=255&y,re=255&v,ae=255&_,le=.6-B*B-C*C-S*S-A*A;if(le<0)c=0;else{var se=oe+n[ie+n[re+n[ae]]];c=(le*=le)*le*(o[se]*B+i[se]*C+r[se]*S+a[se]*A)}var ue=.6-Y*Y-G*G-H*H-z*z;if(ue<0)d=0;else{var ce=oe+L+n[ie+x+n[re+w+n[ae+P]]];d=(ue*=ue)*ue*(o[ce]*Y+i[ce]*G+r[ce]*H+a[ce]*z)}var de=.6-W*W-Q*Q-X*X-K*K;if(de<0)p=0;else{var pe=oe+N+n[ie+k+n[re+R+n[ae+D]]];p=(de*=de)*de*(o[pe]*W+i[pe]*Q+r[pe]*X+a[pe]*K)}var he=.6-j*j-Z*Z-q*q-J*J;if(he<0)h=0;else{var me=oe+E+n[ie+V+n[re+U+n[ae+F]]];h=(he*=he)*he*(o[me]*j+i[me]*Z+r[me]*q+a[me]*J)}var fe=.6-$*$-ee*ee-te*te-ne*ne;if(fe<0)m=0;else{var ge=oe+1+n[ie+1+n[re+1+n[ae+1]]];m=(fe*=fe)*fe*(o[ge]*$+i[ge]*ee+r[ge]*te+a[ge]*ne)}return 27*(c+d+p+h+m)}},e.buildPermutationTable=function(e){for(var t=new Uint8Array(512),n=0;n<256;n++)t[n]=n;for(n=0;n<255;n++){var o=n+~~(e()*(256-n)),i=t[n];t[n]=t[o],t[o]=i}for(n=256;n<512;n++)t[n]=t[n-256];return t},e.F2=.5*(Math.sqrt(3)-1),e.G2=(3-Math.sqrt(3))/6,e.F3=1/3,e.G3=1/6,e.F4=(Math.sqrt(5)-1)/4,e.G4=(5-Math.sqrt(5))/20,e.grad2=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),e.grad3=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),e.grad4=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),e}();e.SimplexNoise=t}(o||(o={})),function(e){var t=function(){function t(){}return t.ZeroPad=function(e,t){var n=t-e.toString().length+1;return Array(+(n>0&&n)).join("0")+e},t.ShiftArray=function(e,t){return t?e.unshift(e.pop()):e.push(e.shift()),e},t.GetLayerMask=function(e){return 1<<e},t.IsLayerMasked=function(e,t){return!!(e&1<<t)},t.GetHavokPlugin=function(){return globalThis.HKP},t.GetLoadingState=function(){return e.Utilities.LoadingState},t.GetRandomRange=function(e,t,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var i=BABYLON.Scalar.RandomRange(e,t);if(null!=n){var r=null!=o?o:100;if(i===n)for(var a=0;a<r&&(i=BABYLON.Scalar.RandomRange(e,t))===n;a++);}return i},t.GetRandomFloat=function(t,n,o,i){return void 0===o&&(o=null),void 0===i&&(i=null),parseFloat(e.Utilities.GetRandomRange(t,n,o,i).toFixed(2))},t.GetRandomInteger=function(t,n,o,i){return void 0===o&&(o=null),void 0===i&&(i=null),parseInt(e.Utilities.GetRandomRange(t,n,o,i).toFixed(0))},t.Approximately=function(t,n){return Math.abs(n-t)<Math.max(e.System.Epsilon*Math.max(Math.abs(t),Math.abs(n)),8*e.System.SingleEpsilon)},t.GetVertexDataFromMesh=function(e){var t=e.computeWorldMatrix(!0),n=BABYLON.VertexData.ExtractFromMesh(e,!0,!0);return n.transform(t),n},t.CalculateDestinationPoint=function(t,n,o){var i=new BABYLON.Vector3(0,0,0);return e.Utilities.CalculateDestinationPointToRef(t,n,o,i),i},t.CalculateDestinationPointToRef=function(t,n,o,i){null==e.Utilities.TempDirectionBuffer&&(e.Utilities.TempDirectionBuffer=new BABYLON.Vector3(0,0,0)),e.Utilities.TempDirectionBuffer.set(0,0,0),n.scaleToRef(o,e.Utilities.TempDirectionBuffer),t.addToRef(e.Utilities.TempDirectionBuffer,i)},t.UpdateAbstractMeshMaterial=function(e,t,n){if(null!=e)if(!1==e instanceof BABYLON.InstancedMesh){var o=e.material;if(o instanceof BABYLON.MultiMaterial){var i=o.clone(o.name+".Clone");i.subMaterials[n]=t,e.material=i}else e.material=t}else console.warn("Instanced mesh not supported as a node material on mesh: "+e.name);else console.warn("Null source mesh for mesh: "+e.name)},t.HermiteVector3=function(t,n,o,i,r){var a=new BABYLON.Vector3(0,0,0);return e.Utilities.HermiteVector3ToRef(t,n,o,i,r,a),a},t.HermiteVector3ToRef=function(e,t,n,o,i,r){var a=i*i,l=i*a,s=2*l-3*a+1,u=-2*l+3*a,c=l-2*a+i,d=l-a,p=e._x*s+n._x*u+t._x*c+o._x*d,h=e._y*s+n._y*u+t._y*c+o._y*d,m=e._z*s+n._z*u+t._z*c+o._z*d;r.set(p,h,m)},t.LerpLog=function(e,t,n){var o=Math.min(Math.max(n,0),1);return e+(t-e)*Math.sin(o*Math.PI*.5)},t.LerpExp=function(e,t,n){var o=Math.min(Math.max(n,0),1);return e+(t-e)*(1-Math.cos(o*Math.PI*.5))},t.LerpUnclamped=function(e,t,n){return e+(t-e)*n},t.LerpUnclampedColor3=function(t,n,o){var i=new BABYLON.Color3(0,0,0);return e.Utilities.LerpUnclampedColor3ToRef(t,n,o,i),i},t.LerpUnclampedColor3ToRef=function(e,t,n,o){o.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n)},t.LerpUnclampedColor4=function(t,n,o){var i=new BABYLON.Color4(0,0,0,1);return e.Utilities.LerpUnclampedColor4ToRef(t,n,o,i),i},t.LerpUnclampedColor4ToRef=function(e,t,n,o){o.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n,e.a+(t.a-e.a)*n)},t.LerpUnclampedVector2=function(t,n,o){var i=new BABYLON.Vector2(0,0);return e.Utilities.LerpUnclampedVector2ToRef(t,n,o,i),i},t.LerpUnclampedVector2ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},t.LerpUnclampedVector3=function(t,n,o){var i=new BABYLON.Vector3(0,0,0);return e.Utilities.LerpUnclampedVector3ToRef(t,n,o,i),i},t.LerpUnclampedVector3ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n)},t.LerpUnclampedVector4=function(t,n,o){var i=new BABYLON.Vector4(0,0,0,0);return e.Utilities.LerpUnclampedVector4ToRef(t,n,o,i),i},t.LerpUnclampedVector4ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n,e.w+(t.w-e.w)*n)},t.IsEqualUsingDot=function(t){return t>1-e.System.Epsilon},t.QuaternionAngle=function(t,n){var o=Math.min(Math.abs(BABYLON.Quaternion.Dot(t,n)),1);return e.Utilities.IsEqualUsingDot(o)?0:2*Math.acos(o)*e.System.Rad2Deg},t.QuaternionLengthSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},t.QuaternionRotateTowards=function(t,n,o){var i=new BABYLON.Quaternion(0,0,0,1);return e.Utilities.QuaternionRotateTowardsToRef(t,n,o,i),i},t.QuaternionRotateTowardsToRef=function(t,n,o,i){var r=e.Utilities.QuaternionAngle(t,n);0==r?i.copyFrom(n):e.Utilities.QuaternionSlerpUnclampedToRef(t,n,Math.min(1,o/r),i)},t.QuaternionSlerpUnclamped=function(t,n,o){var i=new BABYLON.Quaternion(0,0,0,1);return e.Utilities.QuaternionSlerpUnclampedToRef(t,n,o,i),i},t.QuaternionSlerpUnclampedToRef=function(e,t,n,o){},t.MoveTowardsVector2=function(t,n,o){var i=new BABYLON.Vector2(0,0);return e.Utilities.MoveTowardsVector2ToRef(t,n,o,i),i},t.MoveTowardsVector2ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=i*i+r*r;if(0==a||n>=0&&a<=n*n)o.set(t.x,t.y);else{var l=Math.sqrt(a);o.set(e.x+i/l*n,e.y+r/l*n)}},t.MoveTowardsVector3=function(t,n,o){var i=new BABYLON.Vector3(0,0,0);return e.Utilities.MoveTowardsVector3ToRef(t,n,o,i),i},t.MoveTowardsVector3ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z,l=i*i+r*r+a*a;if(0==l||n>=0&&l<=n*n)o.set(t.x,t.y,t.z);else{var s=Math.sqrt(l);o.set(e.x+i/s*n,e.y+r/s*n,e.z+a/s*n)}},t.MoveTowardsVector4=function(t,n,o){var i=new BABYLON.Vector4(0,0,0,0);return e.Utilities.MoveTowardsVector4ToRef(t,n,o,i),i},t.MoveTowardsVector4ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z,l=t.w-e.w,s=i*i+r*r+a*a+l*l;if(0==s||n>=0&&s<=n*n)o.set(t.x,t.y,t.z,t.w);else{var u=Math.sqrt(s);o.set(e.x+i/u*n,e.y+r/u*n,e.z+a/u*n,e.w+l/u*n)}},t.ClampMagnitudeVector2=function(t,n){var o=new BABYLON.Vector2(0,0);return e.Utilities.ClampMagnitudeVector2ToRef(t,n,o),o},t.ClampMagnitudeVector2ToRef=function(e,t,n){var o=e.lengthSquared();if(o>t*t){var i=Math.sqrt(o),r=e.x/i,a=e.y/i;n.set(r*t,a*t)}},t.ClampMagnitudeVector3=function(t,n){var o=new BABYLON.Vector3(0,0,0);return e.Utilities.ClampMagnitudeVector3ToRef(t,n,o),o},t.ClampMagnitudeVector3ToRef=function(e,t,n){var o=e.lengthSquared();if(o>t*t){var i=Math.sqrt(o),r=e.x/i,a=e.y/i,l=e.z/i;n.set(r*t,a*t,l*t)}},t.GetAngle=function(t,n){return e.Utilities.GetAngleRadians(t,n)*e.System.Rad2Deg},t.GetAngleRadians=function(e,t){return Math.acos(BABYLON.Vector3.Dot(e,t))},t.ClampAngle=function(e,t,n){var o=e;do{o<-360&&(o+=360),o>360&&(o-=360)}while(o<-360||o>360);return BABYLON.Scalar.Clamp(o,t,n)},t.ClampAngle180=function(e,t,n){return e>180&&(e-=360),(e=BABYLON.Scalar.Clamp(e,t,n))<0&&(e+=360),e},t.ClampAngle360=function(e,t,n){return(e<90||e>270)&&(e>180&&(e-=360),n>180&&(n-=360),t>180&&(t-=360)),(e=BABYLON.Scalar.Clamp(e,t,n))<0&&(e+=360),e},t.SmoothDamp=function(e,t,n,o,i,r){if(!r)return 0;var a=e-t,l=Math.max(1e-4,n),s=2/l,u=s*i,c=1/(1+u+.48*u*u+.235*u*u*u),d=t,p=o*l,h=e-(a=BABYLON.Scalar.Clamp(a,-p,p)),m=(r.x+s*a)*i;r.x=(r.x-s*m)*c;var f=h+(a+m)*c;return d-e>0==f>d&&(f=d,r.x=(f-d)/i),f},t.SmoothDampAngle=function(t,n,o,i,r,a){var l=t+BABYLON.Scalar.DeltaAngle(t,n);return e.Utilities.SmoothDamp(t,l,o,i,r,a)},t.SmoothDampVector2=function(t,n,o,i,r,a){var l=new BABYLON.Vector2(0,0);return e.Utilities.SmoothDampVector2ToRef(t,n,o,i,r,a,l),l},t.SmoothDampVector2ToRef=function(e,t,n,o,i,r,a){var l=2/(n=Math.max(1e-4,n)),s=l*i,u=1/(1+s+.48*s*s+.235*s*s*s),c=e.x-t.x,d=e.y-t.y,p=t.clone(),h=o*n,m=c*c+d*d;if(m>h*h){var f=Math.sqrt(m);c=c/f*h,d=d/f*h}t.x=e.x-c,t.y=e.y-d;var g=(r.x+l*c)*i,y=(r.y+l*d)*i;r.x=(r.x-l*g)*u,r.y=(r.y-l*y)*u;var v=t.x+(c+g)*u,_=t.y+(d+y)*u,b=p.x-e.x,B=p.y-e.y;b*(v-p.x)+B*(_-p.y)>0&&(v=p.x,_=p.y,r.x=(v-p.x)/i,r.y=(_-p.y)/i),a.set(v,_)},t.SmoothDampVector3=function(t,n,o,i,r,a){var l=new BABYLON.Vector3(0,0,0);return e.Utilities.SmoothDampVector3ToRef(t,n,o,i,r,a,l),l},t.SmoothDampVector3ToRef=function(e,t,n,o,i,r,a){var l=0,s=0,u=0,c=2/(n=Math.max(1e-4,n)),d=c*i,p=1/(1+d+.48*d*d+.235*d*d*d),h=e.x-t.x,m=e.y-t.y,f=e.z-t.z,g=t.clone(),y=o*n,v=h*h+m*m+f*f;if(v>y*y){var _=Math.sqrt(v);h=h/_*y,m=m/_*y,f=f/_*y}t.x=e.x-h,t.y=e.y-m,t.z=e.z-f;var b=(r.x+c*h)*i,B=(r.y+c*m)*i,C=(r.z+c*f)*i;r.x=(r.x-c*b)*p,r.y=(r.y-c*B)*p,r.z=(r.z-c*C)*p,l=t.x+(h+b)*p,s=t.y+(m+B)*p,u=t.z+(f+C)*p;var S=g.x-e.x,A=g.y-e.y,T=g.z-e.z;S*(l-g.x)+A*(s-g.y)+T*(u-g.z)>0&&(l=g.x,s=g.y,u=g.z,r.x=(l-g.x)/i,r.y=(s-g.y)/i,r.z=(u-g.z)/i),a.set(l,s,u)},t.ToMatrix=function(e,t,n){return BABYLON.Matrix.RotationYawPitchRoll(BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(n))},t.ToMatrixToRef=function(e,t,n,o){BABYLON.Matrix.RotationYawPitchRollToRef(BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(n),o)},t.FastMatrixLerp=function(e,t,n,o){BABYLON.Matrix.LerpToRef(e,t,n,o)},t.FastMatrixSlerp=function(e,t,n,o){BABYLON.Matrix.DecomposeLerpToRef(e,t,n,o)},t.ToEuler=function(e){var t=e.toEulerAngles();return t.x=BABYLON.Tools.ToDegrees(t.x),t.y=BABYLON.Tools.ToDegrees(t.y),t.z=BABYLON.Tools.ToDegrees(t.z),t},t.ToEulerToRef=function(e,t){e.toEulerAnglesToRef(t),t.x=BABYLON.Tools.ToDegrees(t.x),t.y=BABYLON.Tools.ToDegrees(t.y),t.z=BABYLON.Tools.ToDegrees(t.z)},t.FromEuler=function(e,t,n){return BABYLON.Quaternion.FromEulerAngles(BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(n))},t.FromEulerToRef=function(e,t,n,o){BABYLON.Quaternion.FromEulerAnglesToRef(BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(n),o)},t.QuaternionDiff=function(t,n){var o=new BABYLON.Quaternion(0,0,0,1);return e.Utilities.QuaternionDiffToRef(t,n,o),o},t.QuaternionDiffToRef=function(t,n,o){BABYLON.Quaternion.InverseToRef(n,e.Utilities.TempQuaternion),e.Utilities.TempQuaternion.multiplyToRef(t,o)},t.QuaternionSubtractToRef=function(e,t,n){n.set(e._x-t._x,e._y-t._y,e._z-t._z,e._w-t._w)},t.RotateVector=function(e,t){var n=2*(t.y*e.z-t.z*e.y),o=2*(t.z*e.x-t.x*e.z),i=2*(t.x*e.y-t.y*e.x);return new BABYLON.Vector3(e.x+t.w*n+(t.y*i-t.z*o),e.y+t.w*o+(t.z*n-t.x*i),e.z+t.w*i+(t.x*o-t.y*n))},t.RotateVectorToRef=function(e,t,n){var o=2*(t.y*e.z-t.z*e.y),i=2*(t.z*e.x-t.x*e.z),r=2*(t.x*e.y-t.y*e.x);n.x=e.x+t.w*o+(t.y*r-t.z*i),n.y=e.y+t.w*i+(t.z*o-t.x*r),n.z=e.z+t.w*r+(t.x*i-t.y*o)},t.LookRotation=function(t){var n=BABYLON.Quaternion.Zero();return e.Utilities.LookRotationToRef(t,n),n},t.LookRotationToRef=function(e,t){BABYLON.Quaternion.FromLookDirectionRHToRef(e,BABYLON.Vector3.Up(),t)},t.Vector3Rad2Deg=function(t){var n=BABYLON.Vector3.Zero();return e.Utilities.Vector3Rad2DegToRef(t,n),n},t.Vector3Rad2DegToRef=function(e,t){t.x=BABYLON.Tools.ToDegrees(e.x),t.y=BABYLON.Tools.ToDegrees(e.y),t.z=BABYLON.Tools.ToDegrees(e.z)},t.MultiplyQuaternionByVector=function(t,n){var o=new BABYLON.Vector3(0,0,0);return e.Utilities.MultiplyQuaternionByVectorToRef(t,n,o),o},t.MultiplyQuaternionByVectorToRef=function(e,t,n){var o=2*e.x,i=2*e.y,r=2*e.z,a=e.x*o,l=e.y*i,s=e.z*r,u=e.x*i,c=e.x*r,d=e.y*r,p=e.w*o,h=e.w*i,m=e.w*r;n.x=(1-(l+s))*t.x+(u-m)*t.y+(c+h)*t.z,n.y=(u+m)*t.x+(1-(a+s))*t.y+(d-p)*t.z,n.z=(c-h)*t.x+(d+p)*t.y+(1-(a+l))*t.z},t.ValidateTransformRotation=function(e){null!=e.rotationQuaternion&&(e.rotation=e.rotationQuaternion.toEulerAngles(),e.rotationQuaternion=null)},t.ValidateTransformQuaternion=function(e){null==e.rotationQuaternion&&null!=e.rotation&&(e.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(e.rotation.x,e.rotation.y,e.rotation.z),e.rotation.set(0,0,0))},t.GetKeyboardInputValue=function(t,n,o){var i=o;return!0===e.UserInputOptions.KeyboardSmoothing&&(i=BABYLON.Scalar.MoveTowards(n,o,e.UserInputOptions.KeyboardMoveSensibility*e.SceneManager.GetDeltaSeconds(t)),Math.abs(i)<e.UserInputOptions.KeyboardMoveDeadZone&&(i=0)),i},t.GenerateRandonNumber=function(e,t,n){void 0===n&&(n=2);var o=(Math.random()*(t-e)+e).toFixed(n);return parseFloat(o)},t.ProjectVector=function(t,n){var o=new BABYLON.Vector3(0,0,0);return e.Utilities.ProjectVectorToRef(t,n,o),o},t.ProjectVectorToRef=function(t,n,o){var i=BABYLON.Vector3.Dot(n,n);if(i<e.System.Epsilon)o.set(0,0,0);else{var r=BABYLON.Vector3.Dot(t,n);o.set(n.x*r/i,n.y*r/i,n.z*r/i)}},t.ProjectVectorOnPlane=function(t,n){var o=new BABYLON.Vector3(0,0,0);return e.Utilities.ProjectVectorOnPlaneToRef(t,n,o),o},t.ProjectVectorOnPlaneToRef=function(t,n,o){var i=BABYLON.Vector3.Dot(n,n);if(i<e.System.Epsilon)o.copyFrom(t);else{var r=BABYLON.Vector3.Dot(t,n);o.set(t.x-n.x*r/i,t.y-n.y*r/i,t.z-n.z*r/i)}},t.AreVectorsEqual=function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n},t.GetVerticalSlopeAngle=function(t,n){void 0===n&&(n=0);var o=Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))*e.System.Rad2Deg;return o=null!=o&&!1===Number.isNaN(o)?o:0,n>0&&o>=n&&(o=0),o},t.DownloadEnvironment=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),BABYLON.EnvironmentTextureTools.CreateEnvTextureAsync(e).then(function(n){var o=e.name||"Environment",i=new Blob([n],{type:"octet/stream"});BABYLON.Tools.Download(i,o+".env"),null!=t&&t()}).catch(function(e){console.error(e),null!=n&&n()})},t.HasOwnProperty=function(e,t){return null!=e&&null!=t&&""!==t&&t in e},t.FindMeshCollider=function(e,t){var n=null;if(t instanceof BABYLON.TransformNode&&!0==(null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.renderer&&null!=t.metadata.toolkit.renderer.hasmeshcollider&&!0===t.metadata.toolkit.renderer.hasmeshcollider)){var o=t.id+"-collider";n=e.getMeshById(o)}return n},t.ColliderInstances=function(){return null==e.SceneManager.GlobalOptions.colliderInstances||e.SceneManager.GlobalOptions.colliderInstances},t.ReparentColliders=function(){return null==e.SceneManager.GlobalOptions.reparentColliders||e.SceneManager.GlobalOptions.reparentColliders},t.UseTriangleNormals=function(){return null!=e.SceneManager.GlobalOptions.useTriangleNormals&&e.SceneManager.GlobalOptions.useTriangleNormals},t.UseConvexTriangles=function(){return null!=e.SceneManager.GlobalOptions.useConvexTriangles&&e.SceneManager.GlobalOptions.useConvexTriangles},t.DefaultRenderGroup=function(){return null!=e.SceneManager.GlobalOptions.defaultRenderGroup?e.SceneManager.GlobalOptions.defaultRenderGroup:0},t.ShowDebugColliders=function(){return!0===e.SceneManager.EnableDebugMode||null!=e.SceneManager.GlobalOptions.showDebugColliders&&e.SceneManager.GlobalOptions.showDebugColliders},t.ColliderVisibility=function(){return null!=e.SceneManager.GlobalOptions.colliderVisibility?e.SceneManager.GlobalOptions.colliderVisibility:0},t.ColliderRenderGroup=function(){return null!=e.SceneManager.GlobalOptions.colliderRenderGroup?e.SceneManager.GlobalOptions.colliderRenderGroup:0},t.CollisionWireframe=function(){return null!=e.SceneManager.GlobalOptions.collisionWireframe&&e.SceneManager.GlobalOptions.collisionWireframe},t.GetColliderMaterial=function(t){var n="Collider-Material",o=t.getMaterialByName(n);if(null==o){var i=new BABYLON.PBRMaterial(n,t);i.albedoColor=new BABYLON.Color3(0,.75,0),i.wireframe=e.Utilities.CollisionWireframe(),i.unlit=!0,o=i}return o},t.CalculateCombinedFriction=function(e,t){var n=e*t;return n<-10&&(n=-10),n>10&&(n=10),n},t.CalculateCombinedRestitution=function(e,t){return e*t},t.AddLoaderItemMarkedForDisposal=function(t){null==e.Utilities.LoaderItemsMarkedForDisposal&&(e.Utilities.LoaderItemsMarkedForDisposal=[]),e.Utilities.LoaderItemsMarkedForDisposal.push(t)},t.ResetLoaderItemsMarkedForDisposal=function(){e.Utilities.LoaderItemsMarkedForDisposal=[]},t.RemoveLoaderItemsMarkedForDisposal=function(){null!=e.Utilities.LoaderItemsMarkedForDisposal&&e.Utilities.LoaderItemsMarkedForDisposal.length>0&&e.Utilities.LoaderItemsMarkedForDisposal.forEach(function(e){try{e.dispose()}catch(e){console.warn(e)}}),e.Utilities.ResetLoaderItemsMarkedForDisposal()},t.GetDirectTargetAngle=function(t,n){return e.Utilities.TempVector3.set(0,0,0),e.Utilities.InverseTransformPointToRef(t,n,e.Utilities.TempVector3),Math.atan2(e.Utilities.TempVector3.x,e.Utilities.TempVector3.z)},t.GetSmoothTargetAngle=function(t,n){return e.Utilities.TempVector3.set(0,0,0),e.Utilities.InverseTransformPointToRef(t,n,e.Utilities.TempVector3),e.Utilities.TempVector3.x/e.Utilities.TempVector3.length()},t.CalculatCatmullRom=function(t,n,o,i,r){var a=new BABYLON.Vector3(0,0,0);return e.Utilities.CalculatCatmullRomToRef(t,n,o,i,r,a),a},t.CalculatCatmullRomToRef=function(e,t,n,o,i,r){},t.MakeProper=function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},t.StartsWith=function(e,t){return 0===e.lastIndexOf(t,0)},t.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},t.ReplaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},t.IsNullOrEmpty=function(e){return null==e||""===e},t.SafeStringPush=function(e,t){-1===e.indexOf(t)&&e.push(t)},t.ParseColor3=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=!1),null!=e&&null!=e.r&&null!=e.g&&null!=e.b?!0===n?new BABYLON.Color3(e.r,e.g,e.b).toLinearSpace():new BABYLON.Color3(e.r,e.g,e.b):t},t.ParseColor4=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var o=null;if(null!=e&&null!=e.r&&null!=e.g&&null!=e.b){var i=null!=e.a?e.a:1;o=!0===n?new BABYLON.Color4(e.r,e.g,e.b,i).toLinearSpace():new BABYLON.Color4(e.r,e.g,e.b,i)}else o=t;return o},t.ParseVector2=function(e,t){return void 0===t&&(t=null),null!=e&&null!=e.x&&null!=e.y?new BABYLON.Vector2(e.x,e.y):t},t.ParseVector3=function(e,t){return void 0===t&&(t=null),null!=e&&null!=e.x&&null!=e.y&&null!=e.z?new BABYLON.Vector3(e.x,e.y,e.z):t},t.ParseVector4=function(e,t){return void 0===t&&(t=null),null!=e&&null!=e.x&&null!=e.y&&null!=e.z&&null!=e.w?new BABYLON.Vector4(e.x,e.y,e.z,e.w):t},t.ParseSound=function(t,n,o,i,l){return r(this,void 0,void 0,function(){var r,s,u;return a(this,function(a){switch(a.label){case 0:return r=null,null==t||null==t.filename||""===t.filename?[3,2]:(s=e.SceneManager.GetRootUrl(n),u=t.filename,[4,e.AudioSource.CreateStaticSound(o,s+u,l)]);case 1:r=a.sent(),null!=i&&i(),a.label=2;case 2:return[2,r]}})})},t.ParseTexture=function(t,n,o,i,r,a,l,s,u,c){var d=null;if(null!=t&&null!=t.filename&&""!==t.filename){var p=e.SceneManager.GetRootUrl(n),h=t.filename;d=new BABYLON.Texture(p+h,n,o,i,r,a,l,s,u,c)}return d},t.ParseCubemap=function(t,n){var o=null;if(null!=t&&null!=t.info){var i=e.SceneManager.GetRootUrl(n)+t.info.rooturl;null!=(o=BABYLON.CubeTexture.Parse(t.info,n,i))&&(o.gammaSpace=!1)}return o},t.ParseTextAsset=function(t,n){return void 0===n&&(n=null),null!=t&&null!=t.base64&&""!==t.base64?e.WindowManager.Atob(t.base64):n},t.ParseJsonAsset=function(t,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var i=e.Utilities.ParseTextAsset(t,n);return null!=i&&""!==i?JSON.parse(i,o):null},t.ParseTransformByID=function(t,n,o){return void 0===o&&(o=null),null!=t&&null!=t.id?e.SceneManager.GetTransformNodeByID(n,t.id):o},t.ParseTransformByName=function(t,n,o){return void 0===o&&(o=null),null!=t&&null!=t.id?e.SceneManager.GetTransformNode(n,t.id):o},t.ParseChildTransform=function(t,n,o){return void 0===o&&(o=null),null!=n&&null!=n.name?e.SceneManager.FindChildTransformNode(t,n.name,e.SearchType.IndexOf,!1):o},t.SetAbsolutePosition=function(e,t){e.setAbsolutePosition(t)},t.GetAbsolutePosition=function(t,n,o){void 0===n&&(n=null),void 0===o&&(o=!0);var i=new BABYLON.Vector3(0,0,0);return e.Utilities.GetAbsolutePositionToRef(t,i,n,o),i},t.GetAbsolutePositionToRef=function(e,t,n,o){void 0===n&&(n=null),void 0===o&&(o=!0),!0===o&&e.computeWorldMatrix(!0),t.copyFrom(e.getAbsolutePosition()),null!=n&&t.addInPlace(n)},t.SetAbsoluteRotation=function(t,n){null==t.rotationQuaternion&&(t.rotationQuaternion=t.rotation.toQuaternion()),null!=t.parent&&t.parent instanceof BABYLON.TransformNode?(e.Utilities.TempQuaternion2.set(0,0,0,1),e.Utilities.GetAbsoluteRotationToRef(t.parent,e.Utilities.TempQuaternion2),BABYLON.Quaternion.InverseToRef(e.Utilities.TempQuaternion2,e.Utilities.TempQuaternion2),e.Utilities.TempQuaternion2.multiplyInPlace(n),t.rotationQuaternion.copyFrom(e.Utilities.TempQuaternion2)):t.rotationQuaternion.copyFrom(n)},t.GetAbsoluteRotation=function(t){var n=new BABYLON.Quaternion(0,0,0,1);return e.Utilities.GetAbsoluteRotationToRef(t,n),n},t.GetAbsoluteRotationToRef=function(e,t){null!=e.absoluteRotationQuaternion&&t.copyFrom(e.absoluteRotationQuaternion)},t.TransformPoint=function(e,t,n){return void 0===n&&(n=!0),!0===n&&e.computeWorldMatrix(),BABYLON.Vector3.TransformCoordinates(t,e.getWorldMatrix())},t.InverseTransformPoint=function(t,n,o){return void 0===o&&(o=!0),!0===o&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),BABYLON.Vector3.TransformCoordinates(n,e.Utilities.TempMatrix)},t.TransformPointToRef=function(e,t,n,o){void 0===o&&(o=!0),!0===o&&e.computeWorldMatrix(),BABYLON.Vector3.TransformCoordinatesToRef(t,e.getWorldMatrix(),n)},t.InverseTransformPointToRef=function(t,n,o,i){void 0===i&&(i=!0),!0===i&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),BABYLON.Vector3.TransformCoordinatesToRef(n,e.Utilities.TempMatrix,o)},t.TransformDirection=function(e,t,n){return void 0===n&&(n=!0),!0===n&&e.computeWorldMatrix(),BABYLON.Vector3.TransformNormal(t,e.getWorldMatrix())},t.InverseTransformDirection=function(t,n,o){return void 0===o&&(o=!0),!0===o&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),BABYLON.Vector3.TransformNormal(n,e.Utilities.TempMatrix)},t.TransformDirectionToRef=function(e,t,n,o){void 0===o&&(o=!0),!0===o&&e.computeWorldMatrix(),BABYLON.Vector3.TransformNormalToRef(t,e.getWorldMatrix(),n)},t.InverseTransformDirectionToRef=function(t,n,o,i){void 0===i&&(i=!0),!0===i&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),BABYLON.Vector3.TransformNormalToRef(n,e.Utilities.TempMatrix,o)},t.RecomputeCenterPivotPoint=function(e){var t=e.getBoundingInfo().boundingSphere.center;e.setPivotMatrix(BABYLON.Matrix.Translation(-t.x,-t.y,-t.z))},t.GetDirectionVector=function(e,t){return e.getDirection(t)},t.GetDirectionVectorToRef=function(e,t,n){e.getDirectionToRef(t,n)},t.GetForwardVector=function(e){return e.getDirection(BABYLON.Vector3.Forward())},t.GetForwardVectorToRef=function(e,t){e.getDirectionToRef(BABYLON.Vector3.Forward(),t)},t.GetRightVector=function(e){return e.getDirection(BABYLON.Vector3.Right())},t.GetRightVectorToRef=function(e,t){e.getDirectionToRef(BABYLON.Vector3.Right(),t)},t.GetUpVector=function(e){return e.getDirection(BABYLON.Vector3.Up())},t.GetUpVectorToRef=function(e,t){e.getDirectionToRef(BABYLON.Vector3.Up(),t)},t.BlendFloatValue=function(e,t,n){var o=BABYLON.Scalar.Clamp(n,0,1);return o>0?BABYLON.Scalar.Lerp(e,t,o):e},t.BlendVector2Value=function(e,t,n){var o=BABYLON.Scalar.Clamp(n,0,1);if(o>0){var i=BABYLON.Vector2.Lerp(e,t,o);e.copyFrom(i)}},t.BlendVector3Value=function(e,t,n){var o=BABYLON.Scalar.Clamp(n,0,1);o>0&&BABYLON.Vector3.LerpToRef(e,t,o,e)},t.BlendQuaternionValue=function(e,t,n){var o=BABYLON.Scalar.Clamp(n,0,1);o>0&&BABYLON.Quaternion.SlerpToRef(e,t,o,e)},t.SetAnimationTargetProperty=function(e,t){null!=e&&(e.targetProperty=t,e.targetPropertyPath=e.targetProperty.split("."))},t.SampleAnimationFloat=function(t,n,o,i){void 0===o&&(o=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=0;return null!=t&&t.dataType===BABYLON.Animation.ANIMATIONTYPE_FLOAT&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:BABYLON.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationVector2=function(t,n,o,i){void 0===o&&(o=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===BABYLON.Animation.ANIMATIONTYPE_VECTOR2&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:BABYLON.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationVector3=function(t,n,o,i){void 0===o&&(o=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===BABYLON.Animation.ANIMATIONTYPE_VECTOR3&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:BABYLON.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationQuaternion=function(t,n,o,i){void 0===o&&(o=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===BABYLON.Animation.ANIMATIONTYPE_QUATERNION&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:BABYLON.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationMatrix=function(t,n,o,i){void 0===o&&(o=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===BABYLON.Animation.ANIMATIONTYPE_MATRIX&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:BABYLON.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.CreateTweenAnimation=function(e,t,n,o,i,r){void 0===i&&(i=30),void 0===r&&(r=BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE);var a=[];a.push({frame:0,value:n}),a.push({frame:i,value:o});var l=new BABYLON.Animation(e,t,i,BABYLON.Animation.ANIMATIONTYPE_FLOAT,r);return l.setKeys(a),l},t.GetLastKeyFrameIndex=function(e){var t=0;if(null!=e){var n=e.getKeys();if(null!=n&&n.length>0){var o=n[n.length-1];null!=o&&(t=o.frame)}}return t},t.InterpolateAnimation=function(t,n,o,i){void 0===i&&(i=!1);var r=!0===i?n*e.SceneManager.AnimationTargetFps:n;return t._interpolate(r,o)},t.UpdateLoopBlendPositionSettings=function(e,t,n){var o=e;null!=o.metadata&&null!=o.metadata.toolkit&&null!=o.metadata.toolkit.settings&&(o.metadata.toolkit.settings.loopblendpositiony=t,o.metadata.toolkit.settings.loopblendpositionxz=n)},t.InitializeShaderMaterial=function(t,n,o){void 0===n&&(n=!0),void 0===o&&(o=!1);var i=t,r=e.Utilities.HasOwnProperty(i,"getShaderName")?i.getShaderName():"glsl",a=!!e.Utilities.HasOwnProperty(i,"getAlphaBlending")&&i.getAlphaBlending(),l=!!e.Utilities.HasOwnProperty(i,"getAlphaTesting")&&i.getAlphaTesting(),s=e.Utilities.HasOwnProperty(i,"getDefaultDefines")?i.getDefaultDefines():null,u=e.Utilities.HasOwnProperty(i,"getDefaultAttributes")?i.getDefaultAttributes():null,c=e.Utilities.HasOwnProperty(i,"getDefaultUniforms")?i.getDefaultUniforms():null;(null==s||s.length<=0)&&(s=["#define GAMETIME","#define DELTATIME","#define DIFFUSECOLOR","#define DIFFUSETEXTURE"]),(null==u||u.length<=0)&&(u=["position","normal","uv","uv2","color"]),(null==c||c.length<=0)&&(c=["world","worldView","worldViewProjection","view","projection","viewProjection","gameTime","deltaTime","diffuseColor","diffuseTexture","diffuseTextureInfos","diffuseTextureMatrix"]);var d={vertex:r,fragment:r},p={needAlphaBlending:a,needAlphaTesting:l,attributes:u,uniforms:c,defines:s,useClipPlane:o,samplers:[],uniformBuffers:[],externalTextures:[],samplerObjects:[],storageBuffers:[]};i._shaderPath=d,i._options=p,!0===n&&(i.fn_afterBind=i.bind,i.bind=function(e,n,o){if(void 0===o&&(o=null),null!=i.updateGlobalTime&&i.updateGlobalTime(),i.after&&i.after(),i.fn_afterBind)try{i.fn_afterBind(e,n,o)}catch(e){}var r=null!=o?o:i.getEffect();if(t.getScene().texturesEnabled&&null!=r)for(var a in i._textures){var l=i._textures[a];null!=l&&(r.setFloat2(a+"Infos",l.coordinatesIndex,l.level),r.setMatrix(a+"Matrix",l.getTextureMatrix()))}}),i.awake&&i.awake()},t.WorldToScreenPoint=function(e,t,n){void 0===n&&(n=null);var o=null,i=null!=n?n.viewport:null!=e.activeCamera?e.activeCamera.viewport:null;return null!=i&&(o=BABYLON.Vector3.Project(t,BABYLON.Matrix.Identity(),e.getTransformMatrix(),i.toGlobal(e.getEngine().getRenderWidth(),e.getEngine().getRenderHeight()))),o},t.ScreenToWorldPoint=function(e,t){return BABYLON.Vector3.Unproject(t,e.getEngine().getRenderWidth(),e.getEngine().getRenderHeight(),BABYLON.Matrix.Identity(),e.getViewMatrix(),e.getProjectionMatrix())},t.LoadTextFile=function(e,t,n,o){return BABYLON.Tools.LoadFile(e,t,n,null,!1,o)},t.LoadTextFileAsync=function(e){return BABYLON.Tools.LoadFileAsync(e,!1)},t.GetHttpRequest=function(e,t,n,o,i,r,a){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=!1),void 0===a&&(a=null);var l=new XMLHttpRequest;return l.open("GET",e,!0),!0===r&&(l.responseType="arraybuffer"),null!=a&&l.overrideMimeType(a),null!=t&&t.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&l.setRequestHeader(e.name,e.value)}),l.onreadystatechange=function(){l.readyState===XMLHttpRequest.DONE&&null!=n&&n(l)},l.onprogress=function(e){null!=i&&i(e)},l.onerror=function(){null!=o&&o("Failed to get data from server.")},l.onabort=function(){null!=o&&o("Aborted get data from server.")},l.send(null),l},t.GetHttpRequestAsync=function(t,n,o,i,r){return void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=!1),void 0===r&&(r=null),new Promise(function(a,l){e.Utilities.GetHttpRequest(t,n,function(e){a(e)},function(e){l(e)},o,i,r)})},t.PostHttpRequest=function(e,t,n,o,i,r,a,l,s){void 0===n&&(n=null),void 0===o&&(o="application/x-www-form-urlencoded"),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=!1),void 0===s&&(s=null);var u=new XMLHttpRequest;return u.open("POST",e,!0),!0===l&&(u.responseType="arraybuffer"),null!=s&&u.overrideMimeType(s),null!=n&&n.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&u.setRequestHeader(e.name,e.value)}),u.setRequestHeader("Content-Type",o),u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&null!=i&&i(u)},u.onprogress=function(e){null!=a&&a(e)},u.onerror=function(){null!=r&&r("Failed to post data to server.")},u.onabort=function(){null!=r&&r("Aborted post data to server.")},u.send(t),u},t.PostHttpRequestAsync=function(t,n,o,i,r,a,l){return void 0===o&&(o=null),void 0===i&&(i="application/x-www-form-urlencoded"),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===l&&(l=null),new Promise(function(s,u){e.Utilities.PostHttpRequest(t,n,o,i,function(e){s(e)},function(e){u(e)},r,a,l)})},t.RemapValueToRange=function(e,t,n,o,i){return o+(e-t)*(i-o)/(n-t)},t.CloneSkeletonPrefab=function(e,t,n,o,i){void 0===i&&(i=null);var r=new BABYLON.Skeleton(n,o||n,e);r.needInitialSkinMatrix=t.needInitialSkinMatrix;for(var a=0;a<t.bones.length;a++){var l=t.bones[a],s=null,u=l.getParent();if(u){var c=t.bones.indexOf(u);s=r.bones[c]}var d=new BABYLON.Bone(l.name,r,s,l.getBaseMatrix().clone(),l.getRestPose().clone());d._index=l._index,d.metadata=l.metadata,l._linkedTransformNode&&d.linkTransformNode(l._linkedTransformNode),BABYLON.DeepCopier.DeepCopy(l.animations,d.animations)}var p=r,h=t;if(h._ranges)for(var m in p._ranges={},h._ranges){var f=h._ranges[m];f&&(p._ranges[m]=f.clone())}return h._isDirty=!0,r},t.GetSceneTransforms=function(e){var t=null;return null!=e.transformNodes&&e.transformNodes.length>0&&e.transformNodes.forEach(function(e){null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.prefab&&!1===e.metadata.toolkit.prefab&&(null==t&&(t=[]),t.push(e))}),null!=e.meshes&&e.meshes.length>0&&e.meshes.forEach(function(e){null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.prefab&&!1===e.metadata.toolkit.prefab&&(null==t&&(t=[]),t.push(e))}),t},t.PostParseSceneComponents=function(t,n,o,i){var r=new e.MetadataParser(t);return null!=n&&n.length>0&&(n.forEach(function(e){r.parseSceneComponents(e)}),r.postProcessSceneComponents(o,i)),r},t.GetAssetContainerMesh=function(e,t){var n=null,o=t.toLowerCase();if(null==n&&null!=e.meshes&&e.meshes.length>0)for(var i=0;i<e.meshes.length;i++){var r=e.meshes[i];if(r instanceof BABYLON.Mesh&&r.name.toLowerCase()===o){n=r;break}}return n},t.GetAssetContainerNode=function(e,t){var n=null,o=t.toLowerCase();if(null==n&&null!=e.transformNodes&&e.transformNodes.length>0)for(var i=0;i<e.transformNodes.length;i++){var r=e.transformNodes[i];if(r.name.toLowerCase()===o){n=r;break}}return n},t.CloneAssetContainerItem=function(t,n,o,i,r,a){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===a&&(a=!0);var l=null,s={},u={},c={},d=null,p=null,h=[],m=[],f=n.toLowerCase(),g=null,y=function(t,n){null==g&&(g=n),s[t.uniqueId]=n.uniqueId,u[n.uniqueId]=n,o&&(n.name=o(t.name)),null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.entity&&(n.metadata=e.Utilities.CloneEntityMetadata(t.metadata));var i=null!=n.metadata&&null!=n.metadata.toolkit&&null!=n.metadata.toolkit.animator?n.metadata.toolkit.animator:null;if(null!=i&&""!==i&&(null==d&&(d=[]),d.indexOf(i)<0&&d.push(i),n.metadata.toolkit.animator=e.Utilities.CreateGuid(),c[i]=n.metadata.toolkit.animator),t instanceof BABYLON.AbstractMesh&&null!=t.skeleton&&(null==p&&(p=[]),p.indexOf(t.skeleton)<0&&p.push(t.skeleton)),n instanceof BABYLON.Mesh){var r=n;if(r.morphTargetManager){var a=t.morphTargetManager;r.morphTargetManager=a.clone();for(var l=0;l<a.numTargets;l++){var h=a.getTarget(l),m=r.morphTargetManager.getTarget(l);s[h.uniqueId]=m.uniqueId,u[m.uniqueId]=m}}}};if(null==l&&null!=t.transformNodes&&t.transformNodes.length>0)for(var v=0;v<t.transformNodes.length;v++){var _=t.transformNodes[v];if(_.name.toLowerCase()===f){var b=e.Utilities.InstantiateHierarchy(_,i,function(e,t){y(e,t)});if(b){l=b;break}}}if(null==l&&null!=t.meshes&&t.meshes.length>0){var B=function(n){var a=t.meshes[n];if(a.name.toLowerCase()===f){var c=e.Utilities.InstantiateHierarchy(a,i,function(e,n){y(e,n);var i=n;if(!0===a.isWorldMatrixFrozen&&i.freezeWorldMatrix&&i.freezeWorldMatrix(),n.material&&i.material)if(!0===r){var l=e.material;if(-1===m.indexOf(l)){var c=l.clone(o?o(l.name):"Clone of "+l.name);if(!0===l.isFrozen&&c.freeze&&c.freeze(),m.push(l),s[l.uniqueId]=c.uniqueId,u[c.uniqueId]=c,"MultiMaterial"===l.getClassName())for(var d=0,p=l.subMaterials;d<p.length;d++){var h=p[d];h&&(c=h.clone(o?o(h.name):"Clone of "+h.name),!0===h.isFrozen&&c.freeze&&c.freeze(),m.push(h),s[h.uniqueId]=c.uniqueId,u[c.uniqueId]=c)}}i.material=u[s[l.uniqueId]]}else"MultiMaterial"===i.material.getClassName()?-1===t.scene.multiMaterials.indexOf(i.material)&&t.scene.addMultiMaterial(i.material):-1===t.scene.materials.indexOf(i.material)&&t.scene.addMaterial(i.material)});if(c)return l=c,"break"}};for(v=0;v<t.meshes.length&&"break"!==B(v);v++);}if(null!=p&&p.length>0&&p.forEach(function(n){for(var i=o?o(n.name):"Clone of "+n.name,r=e.Utilities.CloneSkeletonPrefab(t.scene,n,i,i,g),a=0,l=t.meshes;a<l.length;a++){var c=l[a];if(c.skeleton===n&&!c.isAnInstance){if(u[s[c.uniqueId]].skeleton=r,-1!==h.indexOf(r))continue;h.push(r);for(var d=0,p=r.bones;d<p.length;d++){var m=p[d];m._linkedTransformNode&&(m._linkedTransformNode=u[s[m._linkedTransformNode.uniqueId]])}}}}),!0===a){var C=null;t.animationGroups.forEach(function(e){var t=e,n=null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.source&&""!==t.metadata.toolkit.source?t.metadata.toolkit.source:null;if(null!=n&&""!==n&&null!=d&&d.indexOf(n)>=0){var o=e.clone(e.name,function(e){return u[s[e.uniqueId]]||e}),i=c[n]||n;null!=t.metadata&&(o.metadata={},o.metadata.toolkit={},o.metadata.toolkit.id=t.metadata.toolkit.id,o.metadata.toolkit.clip=t.metadata.toolkit.clip,o.metadata.toolkit.source=i,o.metadata.toolkit.legacy=t.metadata.toolkit.legacy,o.metadata.toolkit.length=t.metadata.toolkit.length,o.metadata.toolkit.looping=t.metadata.toolkit.looping,o.metadata.toolkit.settings=t.metadata.toolkit.settings,o.metadata.toolkit.behavior=t.metadata.toolkit.behavior,o.metadata.toolkit.wrapmode=t.metadata.toolkit.wrapmode,o.metadata.toolkit.framerate=t.metadata.toolkit.framerate,o.metadata.toolkit.humanmotion=t.metadata.toolkit.humanmotion,o.metadata.toolkit.averagespeed=t.metadata.toolkit.averagespeed,o.metadata.toolkit.averageduration=t.metadata.toolkit.averageduration,o.metadata.toolkit.averageangularspeed=t.metadata.toolkit.averageangularspeed),null==C&&(C=[]),C.push(o)}}),null!=l&&null!=C&&e.Utilities.AssignAnimationGroupsToInstance(l,C)}return l},t.AssignAnimationGroupsToInstance=function(t,n){e.Utilities.AssignAnimationGroupsToNode(t,n);var o=t.getChildren(null,!1);null!=o&&o.length>0&&o.forEach(function(t){e.Utilities.AssignAnimationGroupsToNode(t,n)})},t.AssignAnimationGroupsToNode=function(e,t){if(null!=e&&null!=e.metadata&&e.metadata.toolkit){var n=e.metadata.toolkit;if(null!=n.components&&n.components.length>0)for(var o=0;o<n.components.length;o++)if("TOOLKIT.AnimationState"===n.components[o].klass){e.metadata.toolkit.sourceAnimationGroups=t;break}}},t.UnitySlopeAngleToCosine=function(e){return Math.cos(e*Math.PI/180)},t.InstantiateHierarchy=function(t,n,o){if(void 0===n&&(n=null),t instanceof BABYLON.Mesh){var i=null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.instance&&!0===t.metadata.toolkit.instance;return e.Utilities.InstantiateMeshHierarchy(t,n,i,o)}return e.Utilities.InstantiateNodeHierarchy(t,n,o)},t.InstantiateNodeHierarchy=function(t,n,o){void 0===n&&(n=null);var i=t.clone("Clone of "+(t.name||t.id),n,!0);i&&o&&o(t,i);for(var r=0,a=t.getChildTransformNodes(!0);r<a.length;r++){var l=a[r];e.Utilities.InstantiateHierarchy(l,i,o)}return i},t.InstantiateMeshHierarchy=function(t,n,o,i){void 0===n&&(n=null);var r=t.getTotalVertices()>0&&!0===o?t.createInstance("Instance of "+(t.name||t.id)):t.clone("Clone of "+(t.name||t.id),n||t.parent,!0);r&&(r.parent=n,r.position=t.position.clone(),r.scaling=t.scaling.clone(),t.rotationQuaternion?r.rotationQuaternion=t.rotationQuaternion.clone():r.rotation=t.rotation.clone(),i&&i(t,r));for(var a=0,l=t.getChildTransformNodes(!0);a<l.length;a++){var s=l[a];e.Utilities.InstantiateHierarchy(s,r,i)}return r},t.PrepareSkeletonForRendering=function(e,t){void 0===t&&(t=!1),null!=e&&e.prepare(t)},t.RetargetAnimationGroupSkeleton=function(e,t,n){void 0===n&&(n=null),null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,o){if(null!=e.target&&null!=e.target.name){var i=t.bones.filter(function(t){return t.name.toLowerCase()===e.target.name.toLowerCase()})[0];null!=i?null!=i.getTransformNode()&&(e.target=i.getTransformNode()):"Armature"===e.target.name&&null!=n?e.target=n:console.warn("Failed to locate matching animation cloning target: "+e.target.name)}})},t.RetargetAnimationGroupBlendShapes=function(e,t){null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,t){null!=e.target&&e.target.name})},t.LinkSkeletonMeshes=function(t,n){if(null!=t&&null!=t.bones&&t.bones.length>0&&null!=n&&null!=n.bones&&n.bones.length>0)for(var o=n.bones.length,i=0;i<o;i++){var r=n.bones[i];if(null!=r){var a=e.Utilities.FindBoneByName(t,r.name);null!=a?r._linkedTransformNode=a._linkedTransformNode:console.warn("Failed to locate bone on mater rig: "+r.name)}}},t.FindBoneByName=function(e,t){var n=null;if(null!=e&&null!=e.bones)for(var o=0;o<e.bones.length;o++){var i=e.bones[o];if(i.name.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right")===t.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right")){n=i;break}}return n},t.SwitchHandednessVector3=function(e){return new BABYLON.Vector3(e.x,e.y,-e.z)},t.SwitchHandednessVector4=function(e){return new BABYLON.Vector4(e.x,e.y,-e.z,-e.w)},t.SwitchHandednessQuaternion=function(e){return new BABYLON.Quaternion(e.x,e.y,-e.z,-e.w)},t.ComputeBlendingSpeed=function(e,t,n){void 0===n&&(n=!1);var o=1/(e*t);return!0===n&&(o*=.5),o},t.CalculateCameraDistance=function(e,t,n){return void 0===n&&(n=1),Math.round(e*n*t*1)},t.InstantiateClass=function(t){try{var n=e.SceneManager.GetClass(t);if(n)return n;var o=t.split("."),i=void 0;if("undefined"!=typeof window)i=window;else if("undefined"!=typeof globalThis)i=globalThis;else{if(void 0===globalThis.global)throw new Error("No global object available");i=globalThis.global}for(var r=0;r<o.length;r++)if(!(i=i[o[r]]))throw new Error("Class not found: ".concat(t));return"function"==typeof i?i:null}catch(e){return console.error("Failed to resolve class: ".concat(t),e),null}},t.GetSimpleClassName=function(e){if(e&&e.constructor&&e.constructor.toString){var t=e.constructor.toString().match(/function\s*(\w+)/);if(t&&2==t.length)return t[1]}},t.DisposeEntity=function(t){if(null!=t){if(null!=t.metadata&&t.metadata.toolkit){var n=t.metadata.toolkit;null!=n.components&&n.components.length>0&&n.components.forEach(function(t){if(null!=t.instance){try{e.SceneManager.DestroyScriptComponent(t.instance)}catch(e){}t.instance=null}}),delete t.metadata.toolkit}if(null!=t.metadata&&t.metadata.mixer&&delete t.metadata.mixer,null!=t.metadata&&null!=t.metadata.clone&&delete t.metadata.clone,null!=t.physicsImpostor){var o=t.physicsImpostor;null!=o.onCollideEvent&&(o.onCollideEvent=null),null!=o.tmpCollisionObjects&&delete o.tmpCollisionObjects,null!=t.physicsImpostor.physicsBody&&(null!=t.physicsImpostor.physicsBody.entity&&delete t.physicsImpostor.physicsBody.entity,null!=t.physicsImpostor.physicsBody.triangleMapInfo&&delete t.physicsImpostor.physicsBody.triangleMapInfo),t.physicsImpostor.dispose(),t.physicsImpostor=null}null!=t.skeleton&&(null!=t.skeleton._sockets&&delete t.skeleton._sockets,null!=t.skeleton.bones&&t.skeleton.bones.length>0&&t.skeleton.bones.forEach(function(e){null!=e&&null!=e.metadata&&(e.metadata=null)})),null!=t.cameraRig&&(t.cameraRig.dispose&&t.cameraRig.dispose(),delete t.cameraRig),null!=t.lightRig&&(t.lightRig.dispose&&t.lightRig.dispose(),delete t.lightRig),null!=t.shadowBox&&(t.shadowBox.dispose&&t.shadowBox.dispose(),delete t.shadowBox),null!=t._debugCollider&&(t._debugCollider.dispose&&t._debugCollider.dispose(),delete t._debugCollider),null!=t._meshCollider&&(t._meshCollider=null),null!=t._colliderType&&delete t._colliderType,null!=t._skinnedMesh&&delete t._skinnedMesh}},t.SearchTransformNodes=function(t,n,o){void 0===o&&(o=e.SearchType.ExactMatch);var i=null,r=null!=o?o:e.SearchType.ExactMatch;if(null!=n&&n.length>0)for(var a=0;a<n.length;a++){var l=n[a];if(r===e.SearchType.ExactMatch){if(l.name===t){i=l;break}}else if(r===e.SearchType.StartsWith){if(e.Utilities.StartsWith(l.name,t)){i=l;break}}else if(r===e.SearchType.EndsWith){if(e.Utilities.EndsWith(l.name,t)){i=l;break}}else if(r===e.SearchType.IndexOf){if(l.name.indexOf(t)>=0){i=l;break}}else if(l.name===t){i=l;break}}return i},t.SearchTransformNodeForTags=function(e,t){var n=null;if(null!=t&&t.length>0)for(var o=0;o<t.length;o++){var i=t[o];if(i instanceof BABYLON.TransformNode&&BABYLON.Tags.MatchesQuery(i,e)){n=i;break}}return n},t.SearchAllTransformNodesForTags=function(e,t){var n=null;if(null!=t&&t.length>0)for(var o=0;o<t.length;o++){var i=t[o];i instanceof BABYLON.TransformNode&&BABYLON.Tags.MatchesQuery(i,e)&&(null==n&&(n=[]),n.push(i))}return n},t.SearchTransformNodeForScript=function(t,n){var o=null;if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var r=n[i];if(r instanceof BABYLON.TransformNode&&null!=e.SceneManager.FindScriptComponent(r,t)){o=r;break}}return o},t.SearchAllTransformNodesForScript=function(t,n){var o=null;if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var r=n[i];r instanceof BABYLON.TransformNode&&null!=e.SceneManager.FindScriptComponent(r,t)&&(null==o&&(o=[]),o.push(r))}return o},t.CreateGuid=function(t){void 0===t&&(t=null);var n=BABYLON.Tools.RandomId();return e.Utilities.IsNullOrEmpty(t)||(n+="-"+t),n},t.ValidateTransformGuid=function(e){if(null!=e&&null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.guid&&""!==e.metadata.toolkit.guid){var t=e.metadata.toolkit.guid;e.id!==t&&(e.id=t),delete e.metadata.toolkit.guid}},t.AddShadowCastersToLight=function(e,t,n){void 0===n&&(n=!1);var o=e.getShadowGenerator();if(null!=o){var i=o.getShadowMap();if(null!=i)for(var r=0;r<t.length;r++){var a=t[r];if(a instanceof BABYLON.AbstractMesh&&(null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0&&e.includedOnlyMeshes.indexOf(a)<0&&e.includedOnlyMeshes.push(a),null==i.renderList&&(i.renderList=[]),i.renderList.indexOf(a)<0&&i.renderList.push(a)),!0===n){var l=a.getChildMeshes();null!=l&&l.length>0&&l.forEach(function(t){null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0&&e.includedOnlyMeshes.indexOf(t)<0&&e.includedOnlyMeshes.push(t),null==i.renderList&&(i.renderList=[]),i.renderList.indexOf(t)<0&&i.renderList.push(t)})}}}},t.RegisterInstancedMeshBuffers=function(e){var t=null!=e.metadata&&null!=e.metadata.toolkit&&null!=e.metadata.toolkit.buffers?e.metadata.toolkit.buffers:null;null!=t&&(null!=t.floats&&t.floats.length>0&&t.floats.forEach(function(t){null!=t.kind&&""!==t.kind&&null!=t.value&&(e.registerInstancedBuffer(t.kind,1),e.instancedBuffers[t.kind]=t.value)}),null!=t.colors&&t.colors.length>0&&t.colors.forEach(function(t){null!=t.kind&&""!==t.kind&&null!=t.value&&(e.registerInstancedBuffer(t.kind,4),e.instancedBuffers[t.kind]=new BABYLON.Color4(t.value.r||0,t.value.g||0,t.value.b||0,t.value.a||1).toLinearSpace())}),null!=t.vector2&&t.vector2.length>0&&t.vector2.forEach(function(t){null!=t.kind&&""!==t.kind&&null!=t.value&&(e.registerInstancedBuffer(t.kind,2),e.instancedBuffers[t.kind]=new BABYLON.Vector2(t.value.x||0,t.value.y||0))}),null!=t.vector3&&t.vector3.length>0&&t.vector3.forEach(function(t){null!=t.kind&&""!==t.kind&&null!=t.value&&(e.registerInstancedBuffer(t.kind,3),e.instancedBuffers[t.kind]=new BABYLON.Vector3(t.value.x||0,t.value.y||0,t.value.z||0))}),null!=t.vector4&&t.vector4.length>0&&t.vector4.forEach(function(t){null!=t.kind&&""!==t.kind&&null!=t.value&&(e.registerInstancedBuffer(t.kind,4),e.instancedBuffers[t.kind]=new BABYLON.Vector4(t.value.x||0,t.value.y||0,t.value.z||0,t.value.w||0))}))},t.CloneValue=function(e,t){return e?e instanceof BABYLON.Mesh?null:e instanceof BABYLON.SubMesh?e.clone(t):e.clone?e.clone():e:null},t.CloneEntityMetadata=function(t){var n=null;if(null!=t){var o=null;if(null!=t.toolkit){var i=null!=t.toolkit.instance&&t.toolkit.instance,r=null==t.toolkit.visible||t.toolkit.visible,a=null!=t.toolkit.visibility?t.toolkit.visibility:1,l=null!=t.toolkit.billboard?t.toolkit.billboard:0,s=null!=t.toolkit.tags?t.toolkit.tags:"Untagged Layer0",u=null!=t.toolkit.skin&&t.toolkit.skin,c=null!=t.toolkit.bone?t.toolkit.bone:null,d=null!=t.toolkit.rootbone&&t.toolkit.rootbone,p=null!=t.toolkit.rootpos?t.toolkit.rootpos:null,h=null!=t.toolkit.rootrot?t.toolkit.rootrot:null,m=null!=t.toolkit.group?t.toolkit.group:"Untagged",f=null!=t.toolkit.layer?t.toolkit.layer:0,g=null!=t.toolkit.layername?t.toolkit.layername:"Default",y=null!=t.toolkit.navigation?t.toolkit.navigation:null,v=null!=t.toolkit.lightmapped&&t.toolkit.lightmapped,_=null!=t.toolkit.lightmapuvs?t.toolkit.lightmapuvs:null,b=null!=t.toolkit.animator?t.toolkit.animator:null,B=null,C=null,S=null,A=null;t.toolkit.physics&&(B={},e.Utilities.DeepCopyProperties(t.toolkit.physics,B)),t.toolkit.renderer&&(C={},e.Utilities.DeepCopyProperties(t.toolkit.renderer,C)),t.toolkit.collision&&(S={},e.Utilities.DeepCopyProperties(t.toolkit.collision,S)),t.toolkit.properties&&(A={},e.Utilities.DeepCopyProperties(t.toolkit.properties,A));var T=null;null!=t.toolkit.wheels&&t.toolkit.wheels.length>0&&(T=[],t.toolkit.wheels.forEach(function(t){if(null!=t){var n={};e.Utilities.DeepCopyProperties(t,n),T.push(n)}}));var O=null;null!=t.toolkit.components&&t.toolkit.components.length>0&&(O=[],t.toolkit.components.forEach(function(t){if(null!=t){var n=e.Utilities.FastJsonCopy(t);n.instance=null,O.push(n)}})),(o={}).parsed=!1,o.prefab=!1,o.buffers=null,o.lods=null,o.coverages=null,o.distances=null,o.handlers=null,o.instance=i,o.visible=r,o.visibility=a,o.billboard=l,o.tags=s,o.skin=u,o.bone=c,o.rootbone=d,o.rootpos=p,o.rootrot=h,o.group=m,o.layer=f,o.layername=g,o.navigation=y,o.lightmapped=v,o.lightmapuvs=_,o.animator=b,o.renderer=C,o.physics=B,o.wheels=T,o.collision=S,o.properties=A,o.components=O}null!=o&&(n={toolkit:o})}return n},t.FastJsonCopy=function(t){if(!t)return t;if(Array.isArray(t)){for(var n=[],o=t.length,i=0;i<o;i++)n.push(e.Utilities.FastJsonCopy(t[i]));return n}if("object"==typeof t){var r=Object.keys(t),a={};for(i=r.length-1;i>-1;i--){var l=r[i];a[l]=e.Utilities.FastJsonCopy(t[l])}return a}return t},t.DeepCopyProperties=function(t,n,o,i){for(var r in t)if(("_"!==r[0]||i&&-1!==i.indexOf(r))&&(!o||-1===o.indexOf(r))){var a=t[r],l=typeof a;if("function"!==l)if("object"===l)if(a instanceof Array){if(n[r]=[],a.length>0)if("object"==typeof a[0])for(var s=0;s<a.length;s++){var u=e.Utilities.CloneValue(a[s],n);-1===n[r].indexOf(u)&&n[r].push(u)}else n[r]=a.slice(0)}else n[r]=e.Utilities.CloneValue(a,n);else n[r]=a}},t.ValidateTransformMetadata=function(t){null==t.metadata&&(t.metadata={}),null==t.metadata.toolkit&&(t.metadata.toolkit={});var n=t.metadata.toolkit;e.Utilities.HasOwnProperty(n,"entity")||(t.metadata.toolkit.entity=!0),e.Utilities.HasOwnProperty(n,"parsed")||(t.metadata.toolkit.parsed=!1),e.Utilities.HasOwnProperty(n,"prefab")||(t.metadata.toolkit.prefab=!1),e.Utilities.HasOwnProperty(n,"instance")||(t.metadata.toolkit.instance=!1),e.Utilities.HasOwnProperty(n,"buffers")||(t.metadata.toolkit.buffers=null),e.Utilities.HasOwnProperty(n,"visible")||(t.metadata.toolkit.visible=!0),e.Utilities.HasOwnProperty(n,"visibility")||(t.metadata.toolkit.visibility=1),e.Utilities.HasOwnProperty(n,"billboard")||(t.metadata.toolkit.billboard=0),e.Utilities.HasOwnProperty(n,"tags")||(t.metadata.toolkit.tags="Untagged Layer0"),e.Utilities.HasOwnProperty(n,"skin")||(t.metadata.toolkit.skin=!1),e.Utilities.HasOwnProperty(n,"bone")||(t.metadata.toolkit.bone=null),e.Utilities.HasOwnProperty(n,"rootbone")||(t.metadata.toolkit.rootbone=!1),e.Utilities.HasOwnProperty(n,"rootpos")||(t.metadata.toolkit.rootpos=null),e.Utilities.HasOwnProperty(n,"rootrot")||(t.metadata.toolkit.rootrot=null),e.Utilities.HasOwnProperty(n,"group")||(t.metadata.toolkit.group="Untagged"),e.Utilities.HasOwnProperty(n,"layer")||(t.metadata.toolkit.layer=0),e.Utilities.HasOwnProperty(n,"layername")||(t.metadata.toolkit.layername="Default"),e.Utilities.HasOwnProperty(n,"navigation")||(t.metadata.toolkit.navigation=null),e.Utilities.HasOwnProperty(n,"lightmapped")||(t.metadata.toolkit.lightmapped=!1),e.Utilities.HasOwnProperty(n,"lightmapuvs")||(t.metadata.toolkit.lightmapuvs=!1),e.Utilities.HasOwnProperty(n,"animator")||(t.metadata.toolkit.animator=null),e.Utilities.HasOwnProperty(n,"lods")||(t.metadata.toolkit.lods=null),e.Utilities.HasOwnProperty(n,"coverages")||(t.metadata.toolkit.coverages=null),e.Utilities.HasOwnProperty(n,"distances")||(t.metadata.toolkit.distances=null),e.Utilities.HasOwnProperty(n,"handlers")||(t.metadata.toolkit.handlers=null),e.Utilities.HasOwnProperty(n,"physics")||(t.metadata.toolkit.physics=null),e.Utilities.HasOwnProperty(n,"wheels")||(t.metadata.toolkit.wheels=null),e.Utilities.HasOwnProperty(n,"renderer")||(t.metadata.toolkit.renderer=null),e.Utilities.HasOwnProperty(n,"collision")||(t.metadata.toolkit.collision=null),e.Utilities.HasOwnProperty(n,"properties")||(t.metadata.toolkit.properties=null),e.Utilities.HasOwnProperty(n,"components")||(t.metadata.toolkit.components=null)},t.UpVector=BABYLON.Vector3.Up(),t.AuxVector=BABYLON.Vector3.Zero(),t.ZeroVector=BABYLON.Vector3.Zero(),t.TempMatrix=BABYLON.Matrix.Zero(),t.TempMatrix2=BABYLON.Matrix.Zero(),t.TempVector2=BABYLON.Vector2.Zero(),t.TempVector3=BABYLON.Vector3.Zero(),t.TempQuaternion=BABYLON.Quaternion.Zero(),t.TempQuaternion2=BABYLON.Quaternion.Zero(),t.TempQuaternion3=BABYLON.Quaternion.Zero(),t.TempDirectionBuffer=BABYLON.Vector3.Zero(),t.LoadingState=-1,t.OnPreloaderProgress=null,t.OnPreloaderComplete=null,t.LoaderItemsMarkedForDisposal=[],t}();e.Utilities=t}(o||(o={})),function(e){var t=function(t){function n(n,o){var i=t.call(this,n,o)||this;return i.terrainInfo=null,i.shader=i.getClassName(),i.plugin=new e.UniversalTerrainMaterialPlugin(i,i.shader),i}return i(n,t),n.prototype.update=function(){},n.prototype.getClassName=function(){return"UniversalTerrainMaterial"},n.prototype.getTerrainInfo=function(){return this.terrainInfo},n}(e.CustomShaderMaterial);e.UniversalTerrainMaterial=t,e.SceneManager.RegisterClass("TOOLKIT.UniversalTerrainMaterial",t);var n=function(t){function n(e,n){var o=t.call(this,e,n,100,{UNIVERSALTERRAINMATERIAL:!1})||this;return o.colorName="surfaceAlbedo",o.splatmapSampler="splatmapSampler",o.detailsSampler="detailsSampler",o.normalsSampler="normalsSampler",o.GLSL_CustomFragment=null,o.GLSL_CustomVertex=null,o.GLSL_VertexMainEnd=null,o.GLSL_FragmentUpdateColor=null,o.WGSL_CustomFragment=null,o.WGSL_CustomVertex=null,o.WGSL_VertexMainEnd=null,o.WGSL_FragmentUpdateColor=null,o}return i(n,t),n.prototype.isCompatible=function(e){return e===BABYLON.ShaderLanguage.WGSL||e===BABYLON.ShaderLanguage.GLSL},n.prototype.getClassName=function(){return"UniversalTerrainMaterialPlugin"},n.prototype.getCustomCode=function(t,n){var o=this.getCustomShaderMaterial().getTerrainInfo();if("vertex"===t){if(n===BABYLON.ShaderLanguage.WGSL)return null==this.WGSL_CustomVertex&&(this.WGSL_CustomVertex=this.WGSL_FormatTerrainVertexDefintions(o)),null==this.WGSL_VertexMainEnd&&(this.WGSL_VertexMainEnd=this.WGSL_FormatTerrainVertexMainEnd(o)),{CUSTOM_VERTEX_DEFINITIONS:this.WGSL_CustomVertex,CUSTOM_VERTEX_MAIN_END:this.WGSL_VertexMainEnd};if(n===BABYLON.ShaderLanguage.GLSL)return null==this.GLSL_CustomVertex&&(this.GLSL_CustomVertex=this.GLSL_FormatTerrainVertexDefintions(o)),null==this.GLSL_VertexMainEnd&&(this.GLSL_VertexMainEnd=this.GLSL_FormatTerrainVertexMainEnd(o)),{CUSTOM_VERTEX_DEFINITIONS:this.GLSL_CustomVertex,CUSTOM_VERTEX_MAIN_END:this.GLSL_VertexMainEnd}}else if("fragment"===t){if(n===BABYLON.ShaderLanguage.WGSL)return null==this.WGSL_CustomFragment&&(this.WGSL_CustomFragment=this.WGSL_FormatTerrainFragmentDefintions(o,this.splatmapSampler,this.detailsSampler,this.normalsSampler)),null==this.WGSL_FragmentUpdateColor&&(this.WGSL_FragmentUpdateColor=this.WGSL_FormatTerrainFragmentUpdateColor(o,this.colorName,this.splatmapSampler,this.detailsSampler,this.normalsSampler,e.SceneManager.TerrainColorCorrection)),{CUSTOM_FRAGMENT_DEFINITIONS:this.WGSL_CustomFragment,CUSTOM_FRAGMENT_BEFORE_LIGHTS:this.WGSL_FragmentUpdateColor};if(n===BABYLON.ShaderLanguage.GLSL)return null==this.GLSL_CustomFragment&&(this.GLSL_CustomFragment=this.GLSL_FormatTerrainFragmentDefintions(o,this.splatmapSampler,this.detailsSampler,this.normalsSampler)),null==this.GLSL_FragmentUpdateColor&&(this.GLSL_FragmentUpdateColor=this.GLSL_FormatTerrainFragmentUpdateColor(o,this.colorName,this.splatmapSampler,this.detailsSampler,this.normalsSampler,e.SceneManager.TerrainColorCorrection)),{CUSTOM_FRAGMENT_DEFINITIONS:this.GLSL_CustomFragment,CUSTOM_FRAGMENT_BEFORE_LIGHTS:this.GLSL_FragmentUpdateColor}}return null},n.prototype.getUniforms=function(e){var t=e===BABYLON.ShaderLanguage.WGSL;return this.vertexDefinitions=this.getCustomShaderMaterial().getCustomVertexCode(t),this.fragmentDefinitions=this.getCustomShaderMaterial().getCustomFragmentCode(t),this.getCustomShaderMaterial().getCustomUniforms(t)},n.prototype.getSamplers=function(e){var t=this.getCustomShaderMaterial().getCustomSamplers();null!=t&&t.length>0&&e.push.apply(e,t)},n.prototype.getAttributes=function(e,t,n){var o=this.getCustomShaderMaterial().getCustomAttributes();null!=o&&o.length>0&&e.push.apply(e,o)},n.prototype.prepareDefines=function(e,t,n){this.isEnabled&&this.getCustomShaderMaterial().prepareCustomDefines(e)},n.prototype.bindForSubMesh=function(e,t,n,o){this.isEnabled&&this.getCustomShaderMaterial().updateCustomBindings(e)},n.prototype.WGSL_FormatTerrainVertexDefintions=function(e){var t="";return null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0&&(t="\r\n#define TERRAIN_VERTEX_DEFINITIONS\r\n\r\nvarying vSplatmapUV: vec2<f32>;\r\n\r\n"),t},n.prototype.WGSL_FormatTerrainVertexMainEnd=function(e){var t="";return null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0&&(t="\r\n#define TERRAIN_VERTEX_MAIN_END\r\n\r\n#ifdef UV1\r\nvertexOutputs.vSplatmapUV = uvUpdated;\r\n#endif\r\n\r\n"),t},n.prototype.WGSL_FormatTerrainFragmentDefintions=function(e,t,n,o){var i="";return null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0&&(i="\r\n#define TERRAIN_FRAGMENT_DEFNITIONS\r\n\r\nvarying vSplatmapUV: vec2<f32>;\r\nvar "+t+":texture_2d<f32>;\r\nvar "+t+"Sampler: sampler;\r\nvar "+n+":texture_2d<f32>;\r\nvar "+n+"Sampler: sampler;\r\nvar "+o+":texture_2d<f32>;\r\nvar "+o+"Sampler: sampler;\r\n\r\nfn srgb_to_linear(c: vec3<f32>) -> vec3<f32>\r\n{\r\n    return pow(c, vec3<f32>(2.2));\r\n}\r\n\r\nfn linear_to_srgb(c: vec3<f32>) -> vec3<f32>\r\n{\r\n    return pow(c, vec3<f32>(1.0 / 2.2));\r\n}\r\n\r\nfn calculateMipmapLevel(uvs: vec2<f32>, size: vec2<f32>) -> f32\r\n{\r\n    let dx: vec2<f32> = dpdx(uvs * size.x);\r\n    let dy: vec2<f32> = dpdy(uvs * size.y);\r\n    let d: f32 = max(dot(dx, dx), dot(dy, dy));\r\n    return (0.4 * log2(d));\r\n}\r\n\r\nfn sampleTextureAtlas2D(atlas: texture_2d<f32>, sampler: sampler, gamma: f32, tile: vec2<f32>, rect: vec4<f32>, uvs: vec2<f32>, lod: f32) -> vec4<f32>\r\n{\r\n    var level: f32 = lod;\r\n    if (level < 0.0) {\r\n        level = clamp(calculateMipmapLevel(uvs, vec2(tile.x, tile.x)), 0.0, tile.y);\r\n    }\r\n    let size: f32 = pow(2.0, tile.y - level);\r\n    let sizex: f32 = size / rect.z;\r\n    let sizey: f32 = size / rect.w;\r\n    var uv: vec2<f32> = fract(uvs);\r\n    uv.x = uv.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;\r\n    uv.y = uv.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;\r\n    var color: vec4<f32> = textureSampleLevel(atlas, sampler, uv, level);\r\n    if (gamma != 1.0) {\r\n        color.r = pow(color.r, gamma);\r\n        color.g = pow(color.g, gamma);\r\n        color.b = pow(color.b, gamma);\r\n    }\r\n    return color;\r\n}\r\n\r\nfn sampleSplatmapAtlas2D(atlas: texture_2d<f32>, sampler: sampler, tile: vec2<f32>, rect: vec4<f32>, uvs: vec2<f32>) -> vec4<f32>\r\n{\r\n    let size: f32 = pow(2.0, tile.y);\r\n\t   let sizex: f32 = size / rect.z;\r\n\t   let sizey: f32 = size / rect.w;\r\n\t   var uv: vec2<f32> = uvs;\r\n\t   uv.x = uv.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;\r\n\t   uv.y = uv.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;\r\n    return textureSample(atlas, sampler, uv);\r\n}\r\n\r\nfn blendSplatmapAtlasColors(splatmap: vec4<f32>, color1: vec4<f32>, color2: vec4<f32>, color3: vec4<f32>, color4: vec4<f32>, mixbuffer: vec3<f32>) -> vec3<f32>\r\n{\r\n    let buffer1: vec3<f32> = mix(mixbuffer, color1.rgb, splatmap.r);\r\n    let buffer2: vec3<f32> = mix(buffer1, color2.rgb, splatmap.g);\r\n    let buffer3: vec3<f32> = mix(buffer2, color3.rgb, splatmap.b);\r\n    return mix(buffer3, color4.rgb, splatmap.a);\r\n}\r\n\r\nfn perturbNormalSamplerColor(cotangentFrame: mat3x3<f32>, samplerColor: vec3<f32>, scale: f32) -> vec3<f32>\r\n{\r\n    var map: vec3<f32> = samplerColor.xyz;\r\n    map = map * 2.00787402 - 1.00787402;\r\n    #ifdef NORMALXYSCALE\r\n        map = normalize(map * vec3<f32>(scale, scale, 1.0));\r\n    #endif\r\n    return normalize(cotangentFrame * map);\r\n}\r\n\r\n\r\n"),i},n.prototype.WGSL_FormatTerrainFragmentUpdateColor=function(e,t,n,o,i,r){void 0===r&&(r=1);var a="";if(null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0){if(a="\r\n#define TERRAIN_FRAGMENT_UPDATE_COLOR\r\n\r\nvar normalsColor: vec3<f32> = vec3<f32>(0.5, 0.5, 1.0);\r\nvar normalsBuffer: vec3<f32> = normalW.rgb;\r\nvar splatmapBuffer: vec3<f32> = "+t+".rgb;\r\nvar autoMipMapLevel: f32 = -1.0;\r\nvar normalCorrection: f32 = 1.0;\r\nvar detailCorrection: f32 = "+r.toFixed(4)+";\r\n\r\n#if defined(ALBEDO) && defined("+n.toUpperCase()+") && defined("+o.toUpperCase()+")\r\n\r\n// Reset Normal Values\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    uvOffset = vec2<f32>(0.0, 0.0);\r\n    #ifdef NORMAL\r\n        normalW = normalize(input.vNormalW);\r\n    #else\r\n        normalW = normalize(cross(dpdx(input.vPositionW), dpdy(input.vPositionW))) * scene.vEyePosition.w;\r\n    #endif\r\n    #ifdef CLEARCOAT\r\n        clearCoatNormalW = normalW;\r\n    #endif\r\n    #if defined(BUMP) || defined(PARALLAX)\r\n        #if defined(CLEARCOAT_BUMP) && defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, input.vPositionW, fragmentInputs.vSplatmapUV, vec2<f32>(1.0, 1.0));\r\n        #endif\r\n    #elif defined(ANISOTROPIC)\r\n        #if defined(CLEARCOAT_BUMP) && defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, input.vPositionW, fragmentInputs.vSplatmapUV, vec2<f32>(1.0, 1.0));\r\n        #endif\r\n    #endif\r\n    #ifdef PARALLAX\r\n        invTBN = transposeMat3(TBN);\r\n    #endif\r\n    normalW = perturbNormalSamplerColor(TBN, normalsColor, 1.0);\r\n#endif\r\n\r\n// Global Atlas Values\r\nlet splatTileSize: f32 = "+e.splatmapAtlas[2].toFixed(4)+";\r\nlet splatTileBits: f32 = "+e.splatmapAtlas[3].toFixed(4)+";\r\nlet detailTileSize: f32 = "+e.textureAtlas[2].toFixed(4)+";\r\nlet detailTileBits: f32 = "+e.textureAtlas[3].toFixed(4)+";\r\n\r\n// Sample splatmap textures\r\n",e.splatmapCount>0){var l=0;a+="normalsBuffer = vec3<f32>(0.0,0.0,0.0);\r\n";for(var s=0;s<e.splatmapCount;s++){l=4*s;var u=e["splatmapRect"+s];if(a+="var splatmapRect"+s+": vec4<f32> = vec4<f32>("+u[0].toFixed(4)+", "+u[1].toFixed(4)+", "+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n",a+="var splatmapAlbedo"+s+": vec4<f32> = sampleSplatmapAtlas2D("+n+", "+n+"Sampler, vec2<f32>(splatTileSize, splatTileBits), splatmapRect"+s+", (fragmentInputs.vSplatmapUV + uvOffset));\r\n",a+="var textureAlbedo"+(l+0)+": vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 1.0);\r\n",a+="var textureAlbedo"+(l+1)+": vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 1.0);\r\n",a+="var textureAlbedo"+(l+2)+": vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 1.0);\r\n",a+="var textureAlbedo"+(l+3)+": vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(l+0)]){var c=e["textureRect"+(l+0)],d=e["textureInfo"+(l+0)];a+="var textureRect"+(l+0)+": vec4<f32> = vec4<f32>("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="var textureScale"+(l+0)+": vec2<f32> = vec2<f32>("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="var textureOffset"+(l+0)+": vec2<f32> = vec2<f32>("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="var textureTileUV"+(l+0)+": vec2<f32> = ((fragmentInputs.vSplatmapUV + textureOffset"+(l+0)+") * textureScale"+(l+0)+");\r\n",a+="textureAlbedo"+(l+0)+" = sampleTextureAtlas2D("+o+", "+o+"Sampler, detailCorrection, vec2<f32>(detailTileSize, detailTileBits), textureRect"+(l+0)+", textureTileUV"+(l+0)+", autoMipMapLevel);\r\n"}e["textureRect"+(l+1)]&&(c=e["textureRect"+(l+1)],d=e["textureInfo"+(l+1)],a+="var textureRect"+(l+1)+": vec4<f32> = vec4<f32>("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="var textureScale"+(l+1)+": vec2<f32> = vec2<f32>("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="var textureOffset"+(l+1)+": vec2<f32> = vec2<f32>("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="var textureTileUV"+(l+1)+": vec2<f32> = ((fragmentInputs.vSplatmapUV + textureOffset"+(l+1)+") * textureScale"+(l+1)+");\r\n",a+="textureAlbedo"+(l+1)+" = sampleTextureAtlas2D("+o+", "+o+"Sampler, detailCorrection, vec2<f32>(detailTileSize, detailTileBits), textureRect"+(l+1)+", textureTileUV"+(l+1)+", autoMipMapLevel);\r\n"),e["textureRect"+(l+2)]&&(c=e["textureRect"+(l+2)],d=e["textureInfo"+(l+2)],a+="var textureRect"+(l+2)+": vec4<f32> = vec4<f32>("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="var textureScale"+(l+2)+": vec2<f32> = vec2<f32>("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="var textureOffset"+(l+2)+": vec2<f32> = vec2<f32>("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="var textureTileUV"+(l+2)+": vec2<f32> = ((fragmentInputs.vSplatmapUV + textureOffset"+(l+2)+") * textureScale"+(l+2)+");\r\n",a+="textureAlbedo"+(l+2)+" = sampleTextureAtlas2D("+o+", "+o+"Sampler, detailCorrection, vec2<f32>(detailTileSize, detailTileBits), textureRect"+(l+2)+", textureTileUV"+(l+2)+", autoMipMapLevel);\r\n"),e["textureRect"+(l+3)]&&(c=e["textureRect"+(l+3)],d=e["textureInfo"+(l+3)],a+="var textureRect"+(l+3)+": vec4<f32> = vec4<f32>("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="var textureScale"+(l+3)+": vec2<f32> = vec2<f32>("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="var textureOffset"+(l+3)+": vec2<f32> = vec2<f32>("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="var textureTileUV"+(l+3)+": vec2<f32> = ((fragmentInputs.vSplatmapUV + textureOffset"+(l+3)+") * textureScale"+(l+3)+");\r\n",a+="textureAlbedo"+(l+3)+" = sampleTextureAtlas2D("+o+", "+o+"Sampler, detailCorrection, vec2<f32>(detailTileSize, detailTileBits), textureRect"+(l+3)+", textureTileUV"+(l+3)+", autoMipMapLevel);\r\n"),a+="splatmapBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", textureAlbedo"+(l+0)+", textureAlbedo"+(l+1)+", textureAlbedo"+(l+2)+", textureAlbedo"+(l+3)+", splatmapBuffer);\r\n",a+="#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n",a+="    #if defined("+i.toUpperCase()+")\r\n",a+="        var normalColor"+(l+0)+": vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 1.0);\r\n",a+="        var normalColor"+(l+1)+": vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 1.0);\r\n",a+="        var normalColor"+(l+2)+": vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 1.0);\r\n",a+="        var normalColor"+(l+3)+": vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(l+0)]&&(a+="        var normalScale"+(l+0)+": f32 = "+e["normalsScale"+(l+0)].toFixed(4)+";\r\n",a+="        normalColor"+(l+0)+" = sampleTextureAtlas2D("+i+", "+i+"Sampler, normalCorrection, vec2<f32>(detailTileSize, detailTileBits), textureRect"+(l+0)+", textureTileUV"+(l+0)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+0)+" = vec4<f32>(perturbNormalSamplerColor(TBN, normalColor"+(l+0)+".rgb, normalScale"+(l+0)+"), 1.0);\r\n"),e["textureRect"+(l+1)]&&(a+="        var normalScale"+(l+1)+": f32 = "+e["normalsScale"+(l+1)].toFixed(4)+";\r\n",a+="        normalColor"+(l+1)+" = sampleTextureAtlas2D("+i+", "+i+"Sampler, normalCorrection, vec2<f32>(detailTileSize, detailTileBits), textureRect"+(l+1)+", textureTileUV"+(l+1)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+1)+" = vec4<f32>(perturbNormalSamplerColor(TBN, normalColor"+(l+1)+".rgb, normalScale"+(l+1)+"), 1.0);\r\n"),e["textureRect"+(l+2)]&&(a+="        var normalScale"+(l+2)+": f32 = "+e["normalsScale"+(l+2)].toFixed(4)+";\r\n",a+="        normalColor"+(l+2)+" = sampleTextureAtlas2D("+i+", "+i+"Sampler, normalCorrection, vec2<f32>(detailTileSize, detailTileBits), textureRect"+(l+2)+", textureTileUV"+(l+2)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+2)+" = vec4<f32>(perturbNormalSamplerColor(TBN, normalColor"+(l+2)+".rgb, normalScale"+(l+2)+"), 1.0);\r\n"),e["textureRect"+(l+3)]&&(a+="        var normalScale"+(l+3)+": f32 = "+e["normalsScale"+(l+3)].toFixed(4)+";\r\n",a+="        normalColor"+(l+3)+" = sampleTextureAtlas2D("+i+", "+i+"Sampler, normalCorrection, vec2<f32>(detailTileSize, detailTileBits), textureRect"+(l+3)+", textureTileUV"+(l+3)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+3)+" = vec4<f32>(perturbNormalSamplerColor(TBN, normalColor"+(l+3)+".rgb, normalScale"+(l+3)+"), 1.0);\r\n"),a+="        normalsBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", normalColor"+(l+0)+", normalColor"+(l+1)+", normalColor"+(l+2)+", normalColor"+(l+3)+", normalsBuffer);\r\n",a+="    #endif\r\n",a+="#endif\r\n",a+="\r\n"}}a+="// Update Color Values\r\n"+t+" = splatmapBuffer.rgb;\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    #if defined("+i.toUpperCase()+")\r\n        normalW = normalsBuffer.rgb;\r\n    #endif\r\n    #if defined(FORCENORMALFORWARD) && defined(NORMAL)\r\n        var faceNormal: vec3<f32> = normalize(cross(dpdx(input.vPositionW), dpdy(input.vPositionW))) * scene.vEyePosition.w;\r\n        #if defined(TWOSIDEDLIGHTING)\r\n            faceNormal = select(-faceNormal, faceNormal, fragmentInputs.frontFacing)\r\n        #endif\r\n        normalW *= sign(dot(normalW, faceNormal));\r\n    #endif\r\n    #if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\r\n        normalW = select(-normalW, normalW, fragmentInputs.frontFacing);\r\n    #endif\r\n#endif\r\n\r\n#endif\r\n\r\n"}return a},n.prototype.GLSL_FormatTerrainVertexDefintions=function(e){var t="";return null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0&&(t="\r\n#define TERRAIN_VERTEX_DEFINITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\n\r\n"),t},n.prototype.GLSL_FormatTerrainVertexMainEnd=function(e){var t="";return null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0&&(t="\r\n#define TERRAIN_VERTEX_MAIN_END\r\n\r\n#ifdef UV1\r\nvSplatmapUV = uv;\r\n#endif\r\n\r\n"),t},n.prototype.GLSL_FormatTerrainFragmentDefintions=function(e,t,n,o){var i="";return null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0&&(i="\r\n#define TERRAIN_FRAGMENT_DEFNITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\nuniform sampler2D "+t+";\r\nuniform sampler2D "+n+";\r\nuniform sampler2D "+o+";\r\n\r\nvec3 srgb_to_linear(const in vec3 c)\r\n{\r\n    return pow(c, vec3(2.2));\r\n}\r\n\r\nvec3 linear_to_srgb(const in vec3 c)\r\n{\r\n    return pow(c, vec3(1.0 / 2.2));\r\n}\r\n\r\nfloat calculateMipmapLevel(const in vec2 uvs, const in vec2 size)\r\n{\r\n    vec2 dx = dFdx(uvs * size.x);\r\n    vec2 dy = dFdy(uvs * size.y);\r\n    float d = max(dot(dx, dx), dot(dy, dy));\r\n    return 0.4 * log2(d);\r\n}\r\n\r\nvec4 sampleTextureAtlas2D(const in sampler2D atlas, const in float gamma, const in vec2 tile, const in vec4 rect, in vec2 uvs, in float lod)\r\n{\r\n    if (lod < 0.0) lod = clamp(calculateMipmapLevel(uvs, vec2(tile.x, tile.x)), 0.0, tile.y);   // Tile Info (tile.xy)\r\n    float size = pow(2.0, tile.y - lod);                                                        // Tile Bits (tile.y)\r\n    float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n    float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n    uvs = fract(uvs);                                                                           // Perfrom Tiling (fract)\r\n    uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n    uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    vec4 color = texture2DLodEXT(atlas, uvs, lod);\r\n    if (gamma != 1.0) {\r\n        color.r = pow(color.r, gamma);\r\n        color.g = pow(color.g, gamma);\r\n        color.b = pow(color.b, gamma);\r\n    }\r\n    return color;\r\n}\r\n\r\nvec4 sampleSplatmapAtlas2D(const in sampler2D atlas, const in vec2 tile, const in vec4 rect, in vec2 uvs)\r\n{\r\n    float size = pow(2.0, tile.y);                                                              // Tile Bits (tile.y)\r\n\t   float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n\t   float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n\t   uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n\t   uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    return texture2D(atlas, uvs);\r\n}\r\n\r\nvec3 blendSplatmapAtlasColors(const in vec4 splatmap, in vec4 color1, in vec4 color2, in vec4 color3, in vec4 color4, in vec3 mixbuffer)\r\n{\r\n    vec3 buffer1 = mix(mixbuffer, color1.rgb, splatmap.r);\r\n    vec3 buffer2 = mix(buffer1, color2.rgb, splatmap.g);\r\n    vec3 buffer3 = mix(buffer2, color3.rgb, splatmap.b);\r\n    return mix(buffer3, color4.rgb, splatmap.a);\r\n}\r\n\r\nvec3 perturbNormalSamplerColor(mat3 cotangentFrame, vec3 samplerColor, float scale)\r\n{\r\n    vec3 map = samplerColor.xyz;\r\n    map = map * 2.00787402 - 1.00787402;\r\n    #ifdef NORMALXYSCALE\r\n        map = normalize(map * vec3(scale, scale, 1.0));\r\n    #endif\r\n    return normalize(cotangentFrame * map);\r\n}\r\n\r\n\r\n"),i},n.prototype.GLSL_FormatTerrainFragmentUpdateColor=function(e,t,n,o,i,r){void 0===r&&(r=1);var a="";if(null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0){if(a="\r\n#define TERRAIN_FRAGMENT_UPDATE_COLOR\r\n\r\nvec3 normalsColor = vec3(0.5, 0.5, 1.0);\r\nvec3 normalsBuffer = normalW.rgb;\r\nvec3 splatmapBuffer = "+t+".rgb;\r\nfloat autoMipMapLevel = -1.0;\r\nfloat normalCorrection = 1.0;\r\nfloat detailCorrection = "+r.toFixed(4)+";\r\n\r\n#if defined(ALBEDO) && defined("+n.toUpperCase()+") && defined("+o.toUpperCase()+")\r\n\r\n// Reset Normal Values\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    uvOffset = vec2(0.0, 0.0);\r\n    #ifdef NORMAL\r\n        normalW = normalize(vNormalW);\r\n    #else\r\n        normalW = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n    #endif\r\n    #ifdef CLEARCOAT\r\n        clearCoatNormalW = normalW;\r\n    #endif\r\n    #if defined(BUMP) || defined(PARALLAX)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV);\r\n        #endif\r\n    #elif defined(ANISOTROPIC)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV, vec2(1.0, 1.0));\r\n        #endif\r\n    #endif\r\n    #ifdef PARALLAX\r\n        invTBN = transposeMat3(TBN);\r\n    #endif\r\n    normalW = perturbNormalSamplerColor(TBN, normalsColor, 1.0);\r\n#endif\r\n\r\n// Global Atlas Values\r\nfloat splatTileSize = "+e.splatmapAtlas[2].toFixed(4)+";\r\nfloat splatTileBits = "+e.splatmapAtlas[3].toFixed(4)+";\r\nfloat detailTileSize = "+e.textureAtlas[2].toFixed(4)+";\r\nfloat detailTileBits = "+e.textureAtlas[3].toFixed(4)+";\r\n\r\n// Sample splatmap textures\r\n",e.splatmapCount>0){var l=0;a+="normalsBuffer = vec3(0.0,0.0,0.0);\r\n";for(var s=0;s<e.splatmapCount;s++){l=4*s;var u=e["splatmapRect"+s];if(a+="vec4 splatmapRect"+s+" = vec4("+u[0].toFixed(4)+", "+u[1].toFixed(4)+", "+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n",a+="vec4 splatmapAlbedo"+s+" = sampleSplatmapAtlas2D("+n+", vec2(splatTileSize, splatTileBits), splatmapRect"+s+", (vSplatmapUV + uvOffset));\r\n",a+="vec4 textureAlbedo"+(l+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="vec4 textureAlbedo"+(l+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="vec4 textureAlbedo"+(l+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="vec4 textureAlbedo"+(l+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(l+0)]){var c=e["textureRect"+(l+0)],d=e["textureInfo"+(l+0)];a+="vec4 textureRect"+(l+0)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+0)+" = vec2("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+0)+" = vec2("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+0)+" = ((vSplatmapUV + textureOffset"+(l+0)+") * textureScale"+(l+0)+");\r\n",a+="textureAlbedo"+(l+0)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+0)+", textureTileUV"+(l+0)+", autoMipMapLevel);\r\n"}e["textureRect"+(l+1)]&&(c=e["textureRect"+(l+1)],d=e["textureInfo"+(l+1)],a+="vec4 textureRect"+(l+1)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+1)+" = vec2("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+1)+" = vec2("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+1)+" = ((vSplatmapUV + textureOffset"+(l+1)+") * textureScale"+(l+1)+");\r\n",a+="textureAlbedo"+(l+1)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+1)+", textureTileUV"+(l+1)+", autoMipMapLevel);\r\n"),e["textureRect"+(l+2)]&&(c=e["textureRect"+(l+2)],d=e["textureInfo"+(l+2)],a+="vec4 textureRect"+(l+2)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+2)+" = vec2("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+2)+" = vec2("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+2)+" = ((vSplatmapUV + textureOffset"+(l+2)+") * textureScale"+(l+2)+");\r\n",a+="textureAlbedo"+(l+2)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+2)+", textureTileUV"+(l+2)+", autoMipMapLevel);\r\n"),e["textureRect"+(l+3)]&&(c=e["textureRect"+(l+3)],d=e["textureInfo"+(l+3)],a+="vec4 textureRect"+(l+3)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+3)+" = vec2("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+3)+" = vec2("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+3)+" = ((vSplatmapUV + textureOffset"+(l+3)+") * textureScale"+(l+3)+");\r\n",a+="textureAlbedo"+(l+3)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+3)+", textureTileUV"+(l+3)+", autoMipMapLevel);\r\n"),a+="splatmapBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", textureAlbedo"+(l+0)+", textureAlbedo"+(l+1)+", textureAlbedo"+(l+2)+", textureAlbedo"+(l+3)+", splatmapBuffer);\r\n",a+="#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n",a+="    #if defined("+i.toUpperCase()+")\r\n",a+="        vec4 normalColor"+(l+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="        vec4 normalColor"+(l+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="        vec4 normalColor"+(l+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="        vec4 normalColor"+(l+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(l+0)]&&(a+="        float normalScale"+(l+0)+" = "+e["normalsScale"+(l+0)].toFixed(4)+";\r\n",a+="        normalColor"+(l+0)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+0)+", textureTileUV"+(l+0)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+0)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+0)+".rgb, normalScale"+(l+0)+");\r\n"),e["textureRect"+(l+1)]&&(a+="        float normalScale"+(l+1)+" = "+e["normalsScale"+(l+1)].toFixed(4)+";\r\n",a+="        normalColor"+(l+1)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+1)+", textureTileUV"+(l+1)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+1)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+1)+".rgb, normalScale"+(l+1)+");\r\n"),e["textureRect"+(l+2)]&&(a+="        float normalScale"+(l+2)+" = "+e["normalsScale"+(l+2)].toFixed(4)+";\r\n",a+="        normalColor"+(l+2)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+2)+", textureTileUV"+(l+2)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+2)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+2)+".rgb, normalScale"+(l+2)+");\r\n"),e["textureRect"+(l+3)]&&(a+="        float normalScale"+(l+3)+" = "+e["normalsScale"+(l+3)].toFixed(4)+";\r\n",a+="        normalColor"+(l+3)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+3)+", textureTileUV"+(l+3)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+3)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+3)+".rgb, normalScale"+(l+3)+");\r\n"),a+="        normalsBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", normalColor"+(l+0)+", normalColor"+(l+1)+", normalColor"+(l+2)+", normalColor"+(l+3)+", normalsBuffer);\r\n",a+="    #endif\r\n",a+="#endif\r\n",a+="\r\n"}}a+="// Update Color Values\r\n"+t+" = splatmapBuffer.rgb;\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    #if defined("+i.toUpperCase()+")\r\n        normalW = normalsBuffer.rgb;\r\n    #endif\r\n    #if defined(FORCENORMALFORWARD) && defined(NORMAL)\r\n        vec3 faceNormal = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n        #if defined(TWOSIDEDLIGHTING)\r\n            faceNormal = gl_FrontFacing ? faceNormal : -faceNormal;\r\n        #endif\r\n        normalW *= sign(dot(normalW, faceNormal));\r\n    #endif\r\n    #if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\r\n        normalW = gl_FrontFacing ? normalW : -normalW;\r\n    #endif\r\n#endif\r\n\r\n#endif\r\n\r\n"}return a},n}(e.CustomShaderMaterialPlugin);e.UniversalTerrainMaterialPlugin=n}(o||(o={})),function(e){var t,n,o,i;(i=e.DragDirection||(e.DragDirection={}))[i.None=0]="None",i[i.Up=1]="Up",i[i.Down=2]="Down",i[i.Right=3]="Right",i[i.Left=4]="Left",(o=e.PinchZoomState||(e.PinchZoomState={}))[o.None=0]="None",o[o.ZoomIn=1]="ZoomIn",o[o.ZoomOut=2]="ZoomOut",(n=e.MouseButtonMode||(e.MouseButtonMode={}))[n.Pan=0]="Pan",n[n.Look=1]="Look",n[n.Move=2]="Move",(t=e.TouchMouseButton||(e.TouchMouseButton={}))[t.Any=-1]="Any",t[t.Left=0]="Left",t[t.Right=1]="Right";var r=function(){function t(){}return t.GetMouseButtonsDown=function(){return e.InputController.mouseButtonsDown},t.GetLeftButtonDown=function(){return e.InputController.leftButtonDown},t.GetMiddleButtonDown=function(){return e.InputController.middleButtonDown},t.GetRightButtonDown=function(){return e.InputController.rightButtonDown},t.GetMouseDownTarget=function(){return e.InputController.mouseDownTarget},t.GetMouseDragTarget=function(){return e.InputController.mouseDragTarget},t.GetPinchZoomState=function(){return e.InputController.pinchZoomState},t.EnableUserInput=function(t,n,o){void 0===o&&(o=null),e.InputController.ConfigureUserInput(t,n,o)},t.ConfigureUserInput=function(t,n,o){void 0===o&&(o=null);var i=null==o||null==o.contextMenu||o.contextMenu,r=null!=o&&null!=o.pointerLock&&o.pointerLock,a=null!=o&&null!=o.preventDefault&&o.preventDefault,l=null!=o&&null!=o.useCapture&&o.useCapture;if(e.InputController.resetUserInput(),!e.InputController.input){document.documentElement.tabIndex=1,document.documentElement.addEventListener("keyup",e.InputController.inputKeyUpHandler,l),document.documentElement.addEventListener("pointerup",e.InputController.inputPointerUpHandler,l),document.documentElement.addEventListener("pointerout",e.InputController.inputPointerUpHandler,l),document.documentElement.addEventListener("pointerleave",e.InputController.inputPointerUpHandler,l),document.documentElement.addEventListener("pointercancel",e.InputController.inputPointerUpHandler,l);var s=document.getElementById("renderingCanvas")||t.getRenderingCanvas();null!=s&&(s.oncontextmenu=!0===i?null:function(e){e.preventDefault(),e.stopPropagation()}),!0===e.UserInputOptions.UseCanvasElement?(s.tabIndex=2,s.addEventListener("focusout",e.InputController.resetKeyMapHandler,l),s.addEventListener("keydown",e.InputController.inputKeyDownHandler,l),s.addEventListener("pointerdown",e.InputController.inputPointerDownHandler,l),s.addEventListener("pointermove",e.InputController.inputPointerMoveHandler,l),s.addEventListener("onwheel"in document?"wheel":"mousewheel",e.InputController.inputPointerWheelHandler,l)):(document.documentElement.addEventListener("focusout",e.InputController.resetKeyMapHandler,l),document.documentElement.addEventListener("keydown",e.InputController.inputKeyDownHandler,l),document.documentElement.addEventListener("pointerdown",e.InputController.inputPointerDownHandler,l),document.documentElement.addEventListener("pointermove",e.InputController.inputPointerMoveHandler,l),document.documentElement.addEventListener("onwheel"in document?"wheel":"mousewheel",e.InputController.inputPointerWheelHandler,l)),e.InputController.preventDefault=a,null==e.InputController.GamepadManager&&(e.InputController.GamepadManager=new BABYLON.GamepadManager,e.InputController.GamepadManager.onGamepadConnectedObservable.add(e.InputController.inputManagerGamepadConnected),e.InputController.GamepadManager.onGamepadDisconnectedObservable.add(e.InputController.inputManagerGamepadDisconnected)),e.InputController.input=!0,document.documentElement.focus(),!0===r&&e.InputController.LockMousePointer(n,!0)}n.registerAfterRender(function(){e.InputController.updateUserInput(n)})},t.SetLeftJoystickBuffer=function(t,n,o){void 0===o&&(o=!0),e.InputController.j_horizontal=t,e.InputController.j_vertical=!0===o?-n:n},t.SetRightJoystickBuffer=function(t,n,o){void 0===o&&(o=!0),e.InputController.j_mousex=t,e.InputController.j_mousey=!0===o?-n:n},t.DisableUserInput=function(t,n){void 0===n&&(n=!1),e.InputController.LockMousePointer(t,!1),e.InputController.resetUserInput()},t.LockMousePointer=function(t,n){!0===n?e.InputController.LockMousePointerObserver=t.onPointerObservable.add(function(n,o){var i;n.type==BABYLON.PointerEventTypes.POINTERDOWN&&(document.pointerLockElement||null===(i=e.SceneManager.GetEngine(t))||void 0===i||i.enterPointerlock())}):e.InputController.IsPointerLockHandled()&&(t.onPointerObservable.remove(e.InputController.LockMousePointerObserver),e.InputController.LockMousePointerObserver=null)},t.IsPointerLocked=function(){return e.InputController.PointerLockedFlag},t.IsPointerLockHandled=function(){return null!=e.InputController.LockMousePointerObserver},t.GetUserInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=0;if(e.InputController.input)switch(t){case e.UserInputAxis.Vertical:case e.UserInputAxis.Horizontal:o=n===e.PlayerNumber.Four?t===e.UserInputAxis.Horizontal?e.InputController.horizontal4:e.InputController.vertical4:n===e.PlayerNumber.Three?t===e.UserInputAxis.Horizontal?e.InputController.horizontal3:e.InputController.vertical3:n===e.PlayerNumber.Two?t===e.UserInputAxis.Horizontal?e.InputController.horizontal2:e.InputController.vertical2:t===e.UserInputAxis.Horizontal?e.InputController.horizontal:e.InputController.vertical;break;case e.UserInputAxis.MouseX:case e.UserInputAxis.MouseY:o=n===e.PlayerNumber.Four?t===e.UserInputAxis.MouseX?e.InputController.mousex4:e.InputController.mousey4:n===e.PlayerNumber.Three?t===e.UserInputAxis.MouseX?e.InputController.mousex3:e.InputController.mousey3:n===e.PlayerNumber.Two?t===e.UserInputAxis.MouseX?e.InputController.mousex2:e.InputController.mousey2:t===e.UserInputAxis.MouseX?e.InputController.mousex:e.InputController.mousey;break;case e.UserInputAxis.Wheel:n===e.PlayerNumber.One&&(o=e.InputController.wheel)}return o},t.OnKeyboardUp=function(t){e.InputController.input&&e.InputController.keyButtonUp.push(t)},t.OnKeyboardDown=function(t){e.InputController.input&&e.InputController.keyButtonDown.push(t)},t.OnKeyboardPress=function(t,n){e.InputController.input&&e.InputController.keyButtonPress.push({index:t,action:n})},t.GetKeyboardInput=function(t){var n=!1;if(e.InputController.input){var o="k:"+t.toString();if(null!=e.InputController.keymap[o]){var i=e.InputController.keymap[o];n=null!=i.result&&i.result}}return n},t.IsKeyboardButtonHeld=function(t){var n=!1;if(e.InputController.input){var o="k:"+t.toString();if(null!=e.InputController.keymap[o]){var i=e.InputController.keymap[o];null!=i.pressTime&&null!=i.releaseTime&&!0===(null!=i.result&&i.result)&&i.pressTime>0&&0===i.releaseTime&&(n=e.SceneManager.GetTimeMs()-i.pressTime>=e.InputController.TAP_THRESHOLD_MS)}}return n},t.WasKeyboardButtonTapped=function(t,n){void 0===n&&(n=!0);var o=!1;if(e.InputController.input){var i="k:"+t.toString();if(null!=e.InputController.keymap[i]){var r=e.InputController.keymap[i];null!=r.pressTime&&null!=r.releaseTime&&!1===(null!=r.result&&r.result)&&r.pressTime>0&&r.releaseTime>0&&(o=r.releaseTime-r.pressTime<e.InputController.TAP_THRESHOLD_MS)}!0===n&&e.InputController.ResetKeyboardButtonTapped(t)}return o},t.ResetKeyboardButtonTapped=function(t){if(e.InputController.input){var n="k:"+t.toString();null!=e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0})}},t.OnPointerUp=function(t){e.InputController.input&&e.InputController.mouseButtonUp.push(t)},t.OnPointerDown=function(t){e.InputController.input&&e.InputController.mouseButtonDown.push(t)},t.OnPointerPress=function(t,n){e.InputController.input&&e.InputController.mouseButtonPress.push({index:t,action:n})},t.GetPointerInput=function(t){var n=!1;if(e.InputController.input){var o="p:"+t.toString();if(null!=e.InputController.keymap[o]){var i=e.InputController.keymap[o];n=null!=i.result&&i.result}}return n},t.IsPointerButtonHeld=function(t){var n=!1;if(e.InputController.input){var o="p:"+t.toString();if(null!=e.InputController.keymap[o]){var i=e.InputController.keymap[o];null!=i.pressTime&&null!=i.releaseTime&&!0===(null!=i.result&&i.result)&&i.pressTime>0&&0===i.releaseTime&&(n=e.SceneManager.GetTimeMs()-i.pressTime>=e.InputController.TAP_THRESHOLD_MS)}}return n},t.WasPointerButtonTapped=function(t,n){void 0===n&&(n=!0);var o=!1;if(e.InputController.input){var i="p:"+t.toString();if(null!=e.InputController.keymap[i]){var r=e.InputController.keymap[i];null!=r.pressTime&&null!=r.releaseTime&&!1===(null!=r.result&&r.result)&&r.pressTime>0&&r.releaseTime>0&&(o=r.releaseTime-r.pressTime<e.InputController.TAP_THRESHOLD_MS)}!0===n&&e.InputController.ResetPointerButtonTapped(t)}return o},t.ResetPointerButtonTapped=function(t){if(e.InputController.input){var n="p:"+t.toString();null!=e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0})}},t.GetPointerDragDirection=function(t,n,o){return!0===o?0===t&&0===n||(Math.abs(t)>Math.abs(n)?t>0?e.InputController.dragDirection=e.DragDirection.Right:t<0&&(e.InputController.dragDirection=e.DragDirection.Left):n>0?e.InputController.dragDirection=e.DragDirection.Up:n<0&&(e.InputController.dragDirection=e.DragDirection.Down)):e.InputController.dragDirection=e.DragDirection.None,e.InputController.dragDirection},t.ResetPinchZoomTracking=function(){e.InputController.pinchZoomState=0,e.InputController.pinchZoomEvents=[],e.InputController.pinchZoomDistance=null},t.IsWheelScrolling=function(){return 0!==e.InputController.scroll},t.OnGamepadButtonUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1ButtonUp.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonUp.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonUp.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonUp.push(t)}},t.OnGamepadButtonDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1ButtonDown.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonDown.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonDown.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonDown.push(t)}},t.OnGamepadButtonPress=function(t,n,o){if(void 0===o&&(o=e.PlayerNumber.One),e.InputController.input)switch(o){case e.PlayerNumber.One:e.InputController.gamepad1ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonPress.push({index:t,action:n})}},t.GetGamepadButtonInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="b1:"+t.toString();break;case e.PlayerNumber.Two:i="b2:"+t.toString();break;case e.PlayerNumber.Three:i="b3:"+t.toString();break;case e.PlayerNumber.Four:i="b4:"+t.toString()}if(null!=i&&null!=e.InputController.keymap[i]){var r=e.InputController.keymap[i];o=null!=r.result&&r.result}}return o},t.IsGamepadButtonHeld=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="b1:"+t.toString();break;case e.PlayerNumber.Two:i="b2:"+t.toString();break;case e.PlayerNumber.Three:i="b3:"+t.toString();break;case e.PlayerNumber.Four:i="b4:"+t.toString()}if(null!=i&&null!=e.InputController.keymap[i]){var r=e.InputController.keymap[i];null!=r.pressTime&&null!=r.releaseTime&&!0===(null!=r.result&&r.result)&&r.pressTime>0&&0===r.releaseTime&&(o=e.SceneManager.GetTimeMs()-r.pressTime>=e.InputController.TAP_THRESHOLD_MS)}}return o},t.IsGamepadButtonTapped=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="b1:"+t.toString();break;case e.PlayerNumber.Two:i="b2:"+t.toString();break;case e.PlayerNumber.Three:i="b3:"+t.toString();break;case e.PlayerNumber.Four:i="b4:"+t.toString()}if(null!=i&&null!=e.InputController.keymap[i]){var r=e.InputController.keymap[i];null!=r.pressTime&&null!=r.releaseTime&&!1===(null!=r.result&&r.result)&&r.pressTime>0&&r.releaseTime>0&&(o=r.releaseTime-r.pressTime<e.InputController.TAP_THRESHOLD_MS)}}return o},t.ResetGamepadButtonTapped=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input){var o=null;switch(n){case e.PlayerNumber.One:o="b1:"+t.toString();break;case e.PlayerNumber.Two:o="b2:"+t.toString();break;case e.PlayerNumber.Three:o="b3:"+t.toString();break;case e.PlayerNumber.Four:o="b4:"+t.toString()}null!=o&&null!=e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0})}},t.OnGamepadDirectionUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1DpadUp.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadUp.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadUp.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadUp.push(t)}},t.OnGamepadDirectionDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1DpadDown.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadDown.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadDown.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadDown.push(t)}},t.OnGamepadDirectionPress=function(t,n,o){if(void 0===o&&(o=e.PlayerNumber.One),e.InputController.input)switch(o){case e.PlayerNumber.One:e.InputController.gamepad1DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadPress.push({index:t,action:n})}},t.GetGamepadDirectionInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="d1:"+t.toString();break;case e.PlayerNumber.Two:i="d2:"+t.toString();break;case e.PlayerNumber.Three:i="d3:"+t.toString();break;case e.PlayerNumber.Four:i="d4:"+t.toString()}if(null!=i&&null!=e.InputController.keymap[i]){var r=e.InputController.keymap[i];o=null!=r.result&&r.result}}return o},t.IsGamepadDirectionHeld=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="d1:"+t.toString();break;case e.PlayerNumber.Two:i="d2:"+t.toString();break;case e.PlayerNumber.Three:i="d3:"+t.toString();break;case e.PlayerNumber.Four:i="d4:"+t.toString()}if(null!=i&&null!=e.InputController.keymap[i]){var r=e.InputController.keymap[i];null!=r.pressTime&&null!=r.releaseTime&&!0===(null!=r.result&&r.result)&&r.pressTime>0&&0===r.releaseTime&&(o=e.SceneManager.GetTimeMs()-r.pressTime>=e.InputController.TAP_THRESHOLD_MS)}}return o},t.IsGamepadDirectionTapped=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="d1:"+t.toString();break;case e.PlayerNumber.Two:i="d2:"+t.toString();break;case e.PlayerNumber.Three:i="d3:"+t.toString();break;case e.PlayerNumber.Four:i="d4:"+t.toString()}if(null!=i&&null!=e.InputController.keymap[i]){var r=e.InputController.keymap[i];null!=r.pressTime&&null!=r.releaseTime&&!1===(null!=r.result&&r.result)&&r.pressTime>0&&r.releaseTime>0&&(o=r.releaseTime-r.pressTime<e.InputController.TAP_THRESHOLD_MS)}}return o},t.ResetGamepadDirectionTapped=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input){var o=null;switch(n){case e.PlayerNumber.One:o="d1:"+t.toString();break;case e.PlayerNumber.Two:o="d2:"+t.toString();break;case e.PlayerNumber.Three:o="d3:"+t.toString();break;case e.PlayerNumber.Four:o="d4:"+t.toString()}null!=o&&null!=e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0})}},t.OnGamepadTriggerLeft=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1LeftTrigger.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2LeftTrigger.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3LeftTrigger.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4LeftTrigger.push(t)}},t.OnGamepadTriggerRight=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1RightTrigger.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2RightTrigger.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3RightTrigger.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4RightTrigger.push(t)}},t.GetGamepadTriggerInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=0;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="t1:"+t.toString();break;case e.PlayerNumber.Two:i="t2:"+t.toString();break;case e.PlayerNumber.Three:i="t3:"+t.toString();break;case e.PlayerNumber.Four:i="t4:"+t.toString()}if(null!=i&&null!=e.InputController.keymap[i]){var r=e.InputController.keymap[i];o=null!=r.result?r.result:0}}return o},t.IsGamepadTriggerHeld=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="t1:"+t.toString();break;case e.PlayerNumber.Two:i="t2:"+t.toString();break;case e.PlayerNumber.Three:i="t3:"+t.toString();break;case e.PlayerNumber.Four:i="t4:"+t.toString()}if(null!=i&&null!=e.InputController.keymap[i]){var r=e.InputController.keymap[i];null!=r.pressTime&&null!=r.releaseTime&&!0===(null!=r.result&&r.result)&&r.pressTime>0&&0===r.releaseTime&&(o=e.SceneManager.GetTimeMs()-r.pressTime>=e.InputController.TAP_THRESHOLD_MS)}}return o},t.IsGamepadTriggerTapped=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="t1:"+t.toString();break;case e.PlayerNumber.Two:i="t2:"+t.toString();break;case e.PlayerNumber.Three:i="t3:"+t.toString();break;case e.PlayerNumber.Four:i="t4:"+t.toString()}if(null!=i&&null!=e.InputController.keymap[i]){var r=e.InputController.keymap[i];null!=r.pressTime&&null!=r.releaseTime&&!1===(null!=r.result&&r.result)&&r.pressTime>0&&r.releaseTime>0&&(o=r.releaseTime-r.pressTime<e.InputController.TAP_THRESHOLD_MS)}}return o},t.ResetGamepadTriggerTapped=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input){var o=null;switch(n){case e.PlayerNumber.One:o="t1:"+t.toString();break;case e.PlayerNumber.Two:o="t2:"+t.toString();break;case e.PlayerNumber.Three:o="t3:"+t.toString();break;case e.PlayerNumber.Four:o="t4:"+t.toString()}null!=o&&null!=e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0})}},t.GetGamepadType=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=e.GamepadType.None;if(e.InputController.input)switch(t){case e.PlayerNumber.One:n=e.InputController.gamepad1Type;break;case e.PlayerNumber.Two:n=e.InputController.gamepad2Type;break;case e.PlayerNumber.Three:n=e.InputController.gamepad3Type;break;case e.PlayerNumber.Four:n=e.InputController.gamepad4Type}return n},t.GetGamepad=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(e.InputController.input)switch(t){case e.PlayerNumber.One:n=e.InputController.gamepad1;break;case e.PlayerNumber.Two:n=e.InputController.gamepad2;break;case e.PlayerNumber.Three:n=e.InputController.gamepad3;break;case e.PlayerNumber.Four:n=e.InputController.gamepad4}return n},t.InputKeyDownHandler=function(t,n){if(void 0===n&&(n=null),null==t||!1===e.SceneManager.EnableUserInput)return!1;n&&n.preventDefault();var o="k:"+t.toString(),i=!1;if(null==e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[o]){var r=e.InputController.keymap[o];!1===(i=null!=r.result&&r.result)&&(r.result=!0,r.pressTime=e.SceneManager.GetTimeMs(),r.releaseTime=0)}return null!=e.InputController.keyButtonDown&&e.InputController.keyButtonDown.length>0&&e.InputController.keyButtonDown.forEach(function(e){e(t)}),i||null!=e.InputController.keyButtonPress&&e.InputController.keyButtonPress.length>0&&e.InputController.keyButtonPress.forEach(function(e){e.index===t&&e.action()}),!0},t.InputKeyUpHandler=function(t,n){if(void 0===n&&(n=null),null==t||!1===e.SceneManager.EnableUserInput)return!1;var o="k:"+t.toString();if(null!=e.InputController.keymap[o]){var i=e.InputController.keymap[o];!0===(null!=i.result&&i.result)&&(i.result=!1,i.releaseTime=e.SceneManager.GetTimeMs())}return null!=e.InputController.keyButtonUp&&e.InputController.keyButtonUp.length>0&&e.InputController.keyButtonUp.forEach(function(e){e(t)}),!0},t.tickKeyboardInput=function(t){if(!1!==e.SceneManager.EnableUserInput){var n=e.InputController.GetKeyboardInput(e.UserInputKey.W)||e.InputController.GetKeyboardInput(e.UserInputKey.UpArrow),o=e.InputController.GetKeyboardInput(e.UserInputKey.A),i=e.InputController.GetKeyboardInput(e.UserInputKey.S)||e.InputController.GetKeyboardInput(e.UserInputKey.DownArrow),r=e.InputController.GetKeyboardInput(e.UserInputKey.D),a=e.InputController.GetKeyboardInput(e.UserInputKey.LeftArrow),l=e.InputController.GetKeyboardInput(e.UserInputKey.RightArrow);e.InputController.k_vertical=!0===n?e.Utilities.GetKeyboardInputValue(t,e.InputController.k_vertical,1):!0===i?e.Utilities.GetKeyboardInputValue(t,e.InputController.k_vertical,-1):0,!0===e.UserInputOptions.UseArrowKeyRotation?(e.InputController.k_horizontal=!0===r?e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,1):!0===o?e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,-1):0,e.InputController.a_mousex=!0===l?1*e.UserInputOptions.KeyboardArrowSensibility:!0===a?-1*e.UserInputOptions.KeyboardArrowSensibility:0):e.InputController.k_horizontal=!0===r||!0===l?e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,1):!0===o||!0===a?e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,-1):0}},t.updateUserInput=function(t){var n=e.InputController.GetMouseButtonsDown();e.InputController.leftButtonDown=!(1&~n),e.InputController.middleButtonDown=!(4&~n),e.InputController.rightButtonDown=!(2&~n),!1!==e.SceneManager.EnableUserInput&&(e.InputController.PointerLockedFlag=t.getEngine().isPointerLock,e.InputController.tickKeyboardInput(t),e.InputController.x_horizontal=0,e.InputController.x_vertical=0,e.InputController.x_mousex=0,e.InputController.x_mousey=0,0!==e.InputController.j_horizontal?e.InputController.x_horizontal=e.InputController.j_horizontal:0!==e.InputController.g_horizontal1?e.InputController.x_horizontal=e.InputController.g_horizontal1:0!==e.InputController.k_horizontal&&(e.InputController.x_horizontal=e.InputController.k_horizontal),0!==e.InputController.j_vertical?e.InputController.x_vertical=e.InputController.j_vertical:0!==e.InputController.g_vertical1?e.InputController.x_vertical=e.InputController.g_vertical1:0!==e.InputController.k_vertical&&(e.InputController.x_vertical=e.InputController.k_vertical),0!==e.InputController.j_mousex?e.InputController.x_mousex=e.InputController.j_mousex:0!==e.InputController.g_mousex1?e.InputController.x_mousex=e.InputController.g_mousex1:0!==e.InputController.a_mousex?e.InputController.x_mousex=e.InputController.a_mousex:0!==e.InputController.k_mousex&&(e.InputController.x_mousex=e.InputController.k_mousex),0!==e.InputController.j_mousey?e.InputController.x_mousey=e.InputController.j_mousey:0!==e.InputController.g_mousey1?e.InputController.x_mousey=e.InputController.g_mousey1:0!==e.InputController.k_mousey&&(e.InputController.x_mousey=e.InputController.k_mousey),e.InputController.horizontal=e.InputController.x_horizontal,e.InputController.vertical=e.InputController.x_vertical,e.InputController.mousex=e.InputController.x_mousex,e.InputController.mousey=e.InputController.x_mousey,e.InputController.scroll=e.InputController.x_scroll,e.InputController.wheel=e.InputController.x_wheel,e.InputController.horizontal2=e.InputController.g_horizontal2,e.InputController.vertical2=e.InputController.g_vertical2,e.InputController.mousex2=e.InputController.g_mousex2,e.InputController.mousey2=e.InputController.g_mousey2,e.InputController.horizontal3=e.InputController.g_horizontal3,e.InputController.vertical3=e.InputController.g_vertical3,e.InputController.mousex3=e.InputController.g_mousex3,e.InputController.mousey3=e.InputController.g_mousey3,e.InputController.horizontal4=e.InputController.g_horizontal4,e.InputController.vertical4=e.InputController.g_vertical4,e.InputController.mousex4=e.InputController.g_mousex4,e.InputController.mousey4=e.InputController.g_mousey4,e.InputController.k_mousex=0,e.InputController.k_mousey=0,e.InputController.x_mousey=0,e.InputController.x_scroll=0)},t.resetUserInput=function(){e.InputController.input=!1,e.InputController.keymap={},e.InputController.scroll=0,e.InputController.wheel=0,e.InputController.mousex=0,e.InputController.mousey=0,e.InputController.vertical=0,e.InputController.horizontal=0,e.InputController.mousex2=0,e.InputController.mousey2=0,e.InputController.vertical2=0,e.InputController.horizontal2=0,e.InputController.mousex3=0,e.InputController.mousey3=0,e.InputController.vertical3=0,e.InputController.horizontal3=0,e.InputController.mousex4=0,e.InputController.mousey4=0,e.InputController.vertical4=0,e.InputController.horizontal4=0,e.InputController.a_mousex=0,e.InputController.x_scroll=0,e.InputController.x_wheel=0,e.InputController.x_mousex=0,e.InputController.x_mousey=0,e.InputController.x_vertical=0,e.InputController.x_horizontal=0,e.InputController.k_mousex=0,e.InputController.k_mousey=0,e.InputController.k_vertical=0,e.InputController.k_horizontal=0,e.InputController.j_mousex=0,e.InputController.j_mousey=0,e.InputController.j_vertical=0,e.InputController.j_horizontal=0,e.InputController.g_mousex1=0,e.InputController.g_mousey1=0,e.InputController.g_vertical1=0,e.InputController.g_horizontal1=0,e.InputController.g_mousex2=0,e.InputController.g_mousey2=0,e.InputController.g_vertical2=0,e.InputController.g_horizontal2=0,e.InputController.g_mousex3=0,e.InputController.g_mousey3=0,e.InputController.g_vertical3=0,e.InputController.g_horizontal3=0,e.InputController.g_mousex4=0,e.InputController.g_mousey4=0,e.InputController.g_vertical4=0,e.InputController.g_horizontal4=0,e.InputController.dragDirection=0,e.InputController.pinchZoomState=0,e.InputController.pinchZoomEvents=[],e.InputController.pinchZoomDistance=null,e.InputController.preventDefault=!1,e.InputController.leftButtonDown=!1,e.InputController.middleButtonDown=!1,e.InputController.rightButtonDown=!1,e.InputController.mouseDownTarget=null,e.InputController.mouseDragTarget=null,e.InputController.mouseButtonsDown=0,e.InputController.mouseButtonUp=[],e.InputController.mouseButtonDown=[],e.InputController.mouseButtonPress=[],e.InputController.keyButtonUp=[],e.InputController.keyButtonDown=[],e.InputController.keyButtonPress=[],e.InputController.gamepad1ButtonUp=[],e.InputController.gamepad1ButtonDown=[],e.InputController.gamepad1ButtonPress=[],e.InputController.gamepad1DpadUp=[],e.InputController.gamepad1DpadDown=[],e.InputController.gamepad1DpadPress=[],e.InputController.gamepad1LeftTrigger=[],e.InputController.gamepad1RightTrigger=[],e.InputController.gamepad2ButtonUp=[],e.InputController.gamepad2ButtonDown=[],e.InputController.gamepad2ButtonPress=[],e.InputController.gamepad2DpadUp=[],e.InputController.gamepad2DpadDown=[],e.InputController.gamepad2DpadPress=[],e.InputController.gamepad2LeftTrigger=[],e.InputController.gamepad2RightTrigger=[],e.InputController.gamepad3ButtonUp=[],e.InputController.gamepad3ButtonDown=[],e.InputController.gamepad3ButtonPress=[],e.InputController.gamepad3DpadUp=[],e.InputController.gamepad3DpadDown=[],e.InputController.gamepad3DpadPress=[],e.InputController.gamepad3LeftTrigger=[],e.InputController.gamepad3RightTrigger=[],e.InputController.gamepad4ButtonUp=[],e.InputController.gamepad4ButtonDown=[],e.InputController.gamepad4ButtonPress=[],e.InputController.gamepad4DpadUp=[],e.InputController.gamepad4DpadDown=[],e.InputController.gamepad4DpadPress=[],e.InputController.gamepad4LeftTrigger=[],e.InputController.gamepad4RightTrigger=[],e.InputController.previousPosition=null},t.resetKeyMapHandler=function(t){e.InputController.keymap={}},t.getPinchZoomDistance=function(e,t){var n=t.clientX-e.clientX,o=t.clientY-e.clientY;return Math.sqrt(n*n+o*o)},t.cachePinchZoomPointer=function(t){!0===e.InputController.EnablePinchZoomTracking&&e.InputController.pinchZoomEvents.push(t)},t.removePinchZoomPointer=function(t){if(!0===e.InputController.EnablePinchZoomTracking){for(var n=0;n<e.InputController.pinchZoomEvents.length;n++)if(e.InputController.pinchZoomEvents[n].pointerId===t.pointerId){e.InputController.pinchZoomEvents.splice(n,1);break}e.InputController.pinchZoomEvents.length<2&&(e.InputController.pinchZoomDistance=null)}},t.processPinchZoomTracking=function(t){if(!0===e.InputController.EnablePinchZoomTracking){for(var n=0;n<e.InputController.pinchZoomEvents.length;n++)if(e.InputController.pinchZoomEvents[n].pointerId===t.pointerId){e.InputController.pinchZoomEvents[n]=t;break}if(e.InputController.pinchZoomState=e.PinchZoomState.None,2===e.InputController.pinchZoomEvents.length){var o=e.InputController.getPinchZoomDistance(e.InputController.pinchZoomEvents[0],e.InputController.pinchZoomEvents[1]);o!==e.InputController.pinchZoomDistance&&(o>e.InputController.pinchZoomDistance?e.InputController.pinchZoomState=e.PinchZoomState.ZoomIn:o<e.InputController.pinchZoomDistance&&(e.InputController.pinchZoomState=e.PinchZoomState.ZoomOut),e.InputController.pinchZoomDistance=o)}}},t.inputKeyDownHandler=function(t){return e.InputController.InputKeyDownHandler(t.keyCode,t)},t.inputKeyUpHandler=function(t){return e.InputController.InputKeyUpHandler(t.keyCode,t)},t.inputPointerWheelHandler=function(t){if(!1===e.SceneManager.EnableUserInput)return!1;var n=t.deltaY?-t.deltaY:t.wheelDelta/40;return e.InputController.x_scroll=1,e.InputController.x_wheel=Math.abs(n)>e.UserInputOptions.PointerWheelDeadZone?0+n:0,e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerDownHandler=function(t){if(e.InputController.mouseDownTarget=t.target,e.InputController.mouseButtonsDown=t.buttons,e.InputController.cachePinchZoomPointer(t),!1===e.SceneManager.EnableUserInput)return!1;e.InputController.previousPosition={x:t.clientX,y:t.clientY};var n="p:"+t.button.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}return null!=e.InputController.mouseButtonDown&&e.InputController.mouseButtonDown.length>0&&e.InputController.mouseButtonDown.forEach(function(e){e(t.button)}),o||null!=e.InputController.mouseButtonPress&&e.InputController.mouseButtonPress.length>0&&e.InputController.mouseButtonPress.forEach(function(e){e.index===t.button&&e.action()}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerUpHandler=function(t){if(e.InputController.mouseDownTarget=null,e.InputController.mouseDragTarget=null,e.InputController.mouseButtonsDown=t.buttons,e.InputController.removePinchZoomPointer(t),!1===e.SceneManager.EnableUserInput)return!1;e.InputController.previousPosition=null,e.InputController.k_mousex=0,e.InputController.k_mousey=0;var n="p:"+t.button.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}return null!=e.InputController.mouseButtonUp&&e.InputController.mouseButtonUp.length>0&&e.InputController.mouseButtonUp.forEach(function(e){e(t.button)}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerMoveHandler=function(t){if(e.InputController.mouseDragTarget=t.target,e.InputController.mouseButtonsDown=t.buttons,e.InputController.processPinchZoomTracking(t),!1===e.SceneManager.EnableUserInput)return!1;if(!1===e.SceneManager.VirtualJoystickEnabled){var n=0,o=0;if(e.InputController.IsPointerLocked()?(n=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,o=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0,e.InputController.previousPosition=null):null!=e.InputController.previousPosition&&(n=t.clientX-e.InputController.previousPosition.x,o=t.clientY-e.InputController.previousPosition.y,e.InputController.previousPosition={x:t.clientX,y:t.clientY}),!0===e.UserInputOptions.PointerMouseInverted&&(n*=-1,o*=-1),!0===e.InputController.rightHanded&&(n*=-1),!0===e.UserInputOptions.EnableBabylonRotation)e.InputController.k_mousex=n/e.UserInputOptions.BabylonAngularSensibility,e.InputController.k_mousey=o/e.UserInputOptions.BabylonAngularSensibility;else{var i=n*e.UserInputOptions.DefaultAngularSensibility*e.InputController.MOUSE_DAMPENER,r=o*e.UserInputOptions.DefaultAngularSensibility*e.InputController.MOUSE_DAMPENER;Math.abs(n)<=e.UserInputOptions.PointerMouseDeadZone&&(i=0),Math.abs(o)<=e.UserInputOptions.PointerMouseDeadZone&&(r=0),e.InputController.k_mousex+=i,e.InputController.k_mousey+=r,e.InputController.k_mousex=BABYLON.Scalar.Clamp(e.InputController.k_mousex,-1,1),e.InputController.k_mousey=BABYLON.Scalar.Clamp(e.InputController.k_mousey,-1,1)}}return e.InputController.preventDefault&&t.preventDefault(),!0},t.inputOneButtonDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad1){var n="b1:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad1ButtonDown&&e.InputController.gamepad1ButtonDown.length>0&&e.InputController.gamepad1ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad1ButtonPress&&e.InputController.gamepad1ButtonPress.length>0&&e.InputController.gamepad1ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneButtonUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad1){var n="b1:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad1ButtonUp&&e.InputController.gamepad1ButtonUp.length>0&&e.InputController.gamepad1ButtonUp.forEach(function(e){e(t)})}},t.inputOneXboxDPadDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad1){var n="d1:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad1DpadDown&&e.InputController.gamepad1DpadDown.length>0&&e.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad1DpadPress&&e.InputController.gamepad1DpadPress.length>0&&e.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneShockDPadDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad1){var n="d1:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad1DpadDown&&e.InputController.gamepad1DpadDown.length>0&&e.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad1DpadPress&&e.InputController.gamepad1DpadPress.length>0&&e.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneXboxDPadUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad1){var n="d1:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad1DpadUp&&e.InputController.gamepad1DpadUp.length>0&&e.InputController.gamepad1DpadUp.forEach(function(e){e(t)})}},t.inputOneShockDPadUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad1){var n="d1:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad1DpadUp&&e.InputController.gamepad1DpadUp.length>0&&e.InputController.gamepad1DpadUp.forEach(function(e){e(t)})}},t.inputOneXboxLeftTriggerHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad1){var n,o="t1:0";t>0?(null==e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[o]&&!1===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!0,n.pressTime=e.SceneManager.GetTimeMs(),n.releaseTime=0)):null!=e.InputController.keymap[o]&&!0===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!1,n.releaseTime=e.SceneManager.GetTimeMs()),null!=e.InputController.gamepad1LeftTrigger&&e.InputController.gamepad1LeftTrigger.length>0&&e.InputController.gamepad1LeftTrigger.forEach(function(e){e(t)})}},t.inputOneXboxRightTriggerHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad1){var n,o="t1:1";t>0?(null==e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[o]&&!1===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!0,n.pressTime=e.SceneManager.GetTimeMs(),n.releaseTime=0)):null!=e.InputController.keymap[o]&&!0===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!1,n.releaseTime=e.SceneManager.GetTimeMs()),null!=e.InputController.gamepad1RightTrigger&&e.InputController.gamepad1RightTrigger.length>0&&e.InputController.gamepad1RightTrigger.forEach(function(e){e(t)})}},t.inputOneLeftStickHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad1){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal1=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical1=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputOneRightStickHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad1){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex1=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey1=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputTwoButtonDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad2){var n="b2:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad2ButtonDown&&e.InputController.gamepad2ButtonDown.length>0&&e.InputController.gamepad2ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad2ButtonPress&&e.InputController.gamepad2ButtonPress.length>0&&e.InputController.gamepad2ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoButtonUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad2){var n="b2:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad2ButtonUp&&e.InputController.gamepad2ButtonUp.length>0&&e.InputController.gamepad2ButtonUp.forEach(function(e){e(t)})}},t.inputTwoXboxDPadDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad2){var n="d2:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad2DpadDown&&e.InputController.gamepad2DpadDown.length>0&&e.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad2DpadPress&&e.InputController.gamepad2DpadPress.length>0&&e.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoShockDPadDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad2){var n="d2:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad2DpadDown&&e.InputController.gamepad2DpadDown.length>0&&e.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad2DpadPress&&e.InputController.gamepad2DpadPress.length>0&&e.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoXboxDPadUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad2){var n="d2:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad2DpadUp&&e.InputController.gamepad2DpadUp.length>0&&e.InputController.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoShockDPadUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad2){var n="d2:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad2DpadUp&&e.InputController.gamepad2DpadUp.length>0&&e.InputController.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoXboxLeftTriggerHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad2){var n,o="t2:0";t>0?(null==e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[o]&&!1===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!0,n.pressTime=e.SceneManager.GetTimeMs(),n.releaseTime=0)):null!=e.InputController.keymap[o]&&!0===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!1,n.releaseTime=e.SceneManager.GetTimeMs()),null!=e.InputController.gamepad2LeftTrigger&&e.InputController.gamepad2LeftTrigger.length>0&&e.InputController.gamepad2LeftTrigger.forEach(function(e){e(t)})}},t.inputTwoXboxRightTriggerHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad2){var n,o="t2:1";t>0?(null==e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[o]&&!1===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!0,n.pressTime=e.SceneManager.GetTimeMs(),n.releaseTime=0)):null!=e.InputController.keymap[o]&&!0===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!1,n.releaseTime=e.SceneManager.GetTimeMs()),null!=e.InputController.gamepad2RightTrigger&&e.InputController.gamepad2RightTrigger.length>0&&e.InputController.gamepad2RightTrigger.forEach(function(e){e(t)})}},t.inputTwoLeftStickHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad2){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal2=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical2=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputTwoRightStickHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad2){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex2=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey2=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputThreeButtonDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad3){var n="b3:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad3ButtonDown&&e.InputController.gamepad3ButtonDown.length>0&&e.InputController.gamepad3ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad3ButtonPress&&e.InputController.gamepad3ButtonPress.length>0&&e.InputController.gamepad3ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeButtonUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad3){var n="b3:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad3ButtonUp&&e.InputController.gamepad3ButtonUp.length>0&&e.InputController.gamepad3ButtonUp.forEach(function(e){e(t)})}},t.inputThreeXboxDPadDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad3){var n="d3:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad3DpadDown&&e.InputController.gamepad3DpadDown.length>0&&e.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad3DpadPress&&e.InputController.gamepad3DpadPress.length>0&&e.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeShockDPadDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad3){var n="d3:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad3DpadDown&&e.InputController.gamepad3DpadDown.length>0&&e.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad3DpadPress&&e.InputController.gamepad3DpadPress.length>0&&e.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeXboxDPadUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad3){var n="d3:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad3DpadUp&&e.InputController.gamepad3DpadUp.length>0&&e.InputController.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeShockDPadUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad3){var n="d3:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad3DpadUp&&e.InputController.gamepad3DpadUp.length>0&&e.InputController.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeXboxLeftTriggerHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad3){var n,o="t3:0";t>0?(null==e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[o]&&!1===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!0,n.pressTime=e.SceneManager.GetTimeMs(),n.releaseTime=0)):null!=e.InputController.keymap[o]&&!0===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!1,n.releaseTime=e.SceneManager.GetTimeMs()),null!=e.InputController.gamepad3LeftTrigger&&e.InputController.gamepad3LeftTrigger.length>0&&e.InputController.gamepad3LeftTrigger.forEach(function(e){e(t)})}},t.inputThreeXboxRightTriggerHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad3){var n,o="t3:1";t>0?(null==e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[o]&&!1===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!0,n.pressTime=e.SceneManager.GetTimeMs(),n.releaseTime=0)):null!=e.InputController.keymap[o]&&!0===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!1,n.releaseTime=e.SceneManager.GetTimeMs()),null!=e.InputController.gamepad3RightTrigger&&e.InputController.gamepad3RightTrigger.length>0&&e.InputController.gamepad3RightTrigger.forEach(function(e){e(t)})}},t.inputThreeLeftStickHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad3){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal3=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical3=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputThreeRightStickHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad3){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex3=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey3=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputFourButtonDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad4){var n="b4:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad4ButtonDown&&e.InputController.gamepad4ButtonDown.length>0&&e.InputController.gamepad4ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad4ButtonPress&&e.InputController.gamepad4ButtonPress.length>0&&e.InputController.gamepad4ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourButtonUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad4){var n="b4:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad4ButtonUp&&e.InputController.gamepad4ButtonUp.length>0&&e.InputController.gamepad4ButtonUp.forEach(function(e){e(t)})}},t.inputFourXboxDPadDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad4){var n="d4:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad4DpadDown&&e.InputController.gamepad4DpadDown.length>0&&e.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad4DpadPress&&e.InputController.gamepad4DpadPress.length>0&&e.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourShockDPadDownHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad4){var n="d4:"+t.toString(),o=!1;if(null==e.InputController.keymap[n]&&(e.InputController.keymap[n]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[n]){var i=e.InputController.keymap[n];!1===(o=null!=i.result&&i.result)&&(i.result=!0,i.pressTime=e.SceneManager.GetTimeMs(),i.releaseTime=0)}null!=e.InputController.gamepad4DpadDown&&e.InputController.gamepad4DpadDown.length>0&&e.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad4DpadPress&&e.InputController.gamepad4DpadPress.length>0&&e.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourXboxDPadUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad4){var n="d4:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad4DpadUp&&e.InputController.gamepad4DpadUp.length>0&&e.InputController.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourShockDPadUpHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad4){var n="d4:"+t.toString();if(null!=e.InputController.keymap[n]){var o=e.InputController.keymap[n];!0===(null!=o.result&&o.result)&&(o.result=!1,o.releaseTime=e.SceneManager.GetTimeMs())}null!=e.InputController.gamepad4DpadUp&&e.InputController.gamepad4DpadUp.length>0&&e.InputController.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourXboxLeftTriggerHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad4){var n,o="t4:0";t>0?(null==e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[o]&&!1===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!0,n.pressTime=e.SceneManager.GetTimeMs(),n.releaseTime=0)):null!=e.InputController.keymap[o]&&!0===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!1,n.releaseTime=e.SceneManager.GetTimeMs()),null!=e.InputController.gamepad4LeftTrigger&&e.InputController.gamepad4LeftTrigger.length>0&&e.InputController.gamepad4LeftTrigger.forEach(function(e){e(t)})}},t.inputFourXboxRightTriggerHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad4){var n,o="t4:1";t>0?(null==e.InputController.keymap[o]&&(e.InputController.keymap[o]={result:!1,pressTime:0,releaseTime:0}),null!=e.InputController.keymap[o]&&!1===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!0,n.pressTime=e.SceneManager.GetTimeMs(),n.releaseTime=0)):null!=e.InputController.keymap[o]&&!0===(null!=(n=e.InputController.keymap[o]).result&&n.result)&&(n.result=!1,n.releaseTime=e.SceneManager.GetTimeMs()),null!=e.InputController.gamepad4RightTrigger&&e.InputController.gamepad4RightTrigger.length>0&&e.InputController.gamepad4RightTrigger.forEach(function(e){e(t)})}},t.inputFourLeftStickHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad4){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal4=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical4=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputFourRightStickHandler=function(t){if(!1!==e.SceneManager.EnableUserInput&&null!=e.InputController.gamepad4){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex4=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey4=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputManagerGamepadConnected=function(t,n){if(null==e.InputController.gamepad1&&0===t.index)if(e.InputController.gamepad1=t,BABYLON.Tools.Log("Gamepad One Connected: "+e.InputController.gamepad1.id),e.InputController.gamepad1 instanceof BABYLON.Xbox360Pad){e.InputController.gamepad1Type=e.GamepadType.Xbox360;var o=e.InputController.gamepad1;o.onbuttonup(e.InputController.inputOneButtonUpHandler),o.onbuttondown(e.InputController.inputOneButtonDownHandler),o.onleftstickchanged(e.InputController.inputOneLeftStickHandler),o.onrightstickchanged(e.InputController.inputOneRightStickHandler),o.ondpadup(e.InputController.inputOneXboxDPadUpHandler),o.ondpaddown(e.InputController.inputOneXboxDPadDownHandler),o.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),o.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad1 instanceof BABYLON.DualShockPad){e.InputController.gamepad1Type=e.GamepadType.DualShock;var i=e.InputController.gamepad1;i.onbuttonup(e.InputController.inputOneButtonUpHandler),i.onbuttondown(e.InputController.inputOneButtonDownHandler),i.onleftstickchanged(e.InputController.inputOneLeftStickHandler),i.onrightstickchanged(e.InputController.inputOneRightStickHandler),i.ondpadup(e.InputController.inputOneShockDPadUpHandler),i.ondpaddown(e.InputController.inputOneShockDPadDownHandler),i.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),i.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad1Type=e.GamepadType.Generic;var r=e.InputController.gamepad1;r.onbuttonup(e.InputController.inputOneButtonUpHandler),r.onbuttondown(e.InputController.inputOneButtonDownHandler),r.onleftstickchanged(e.InputController.inputOneLeftStickHandler),r.onrightstickchanged(e.InputController.inputOneRightStickHandler)}if(null==e.InputController.gamepad2&&1===t.index)if(e.InputController.gamepad2=t,BABYLON.Tools.Log("Gamepad Two Connected: "+e.InputController.gamepad2.id),e.InputController.gamepad2 instanceof BABYLON.Xbox360Pad){e.InputController.gamepad2Type=e.GamepadType.Xbox360;var a=e.InputController.gamepad2;a.onbuttonup(e.InputController.inputTwoButtonUpHandler),a.onbuttondown(e.InputController.inputTwoButtonDownHandler),a.onleftstickchanged(e.InputController.inputTwoLeftStickHandler),a.onrightstickchanged(e.InputController.inputTwoRightStickHandler),a.ondpadup(e.InputController.inputTwoXboxDPadUpHandler),a.ondpaddown(e.InputController.inputTwoXboxDPadDownHandler),a.onlefttriggerchanged(e.InputController.inputTwoXboxLeftTriggerHandler),a.onrighttriggerchanged(e.InputController.inputTwoXboxRightTriggerHandler)}else if(e.InputController.gamepad2 instanceof BABYLON.DualShockPad){e.InputController.gamepad2Type=e.GamepadType.DualShock;var l=e.InputController.gamepad2;l.onbuttonup(e.InputController.inputOneButtonUpHandler),l.onbuttondown(e.InputController.inputOneButtonDownHandler),l.onleftstickchanged(e.InputController.inputOneLeftStickHandler),l.onrightstickchanged(e.InputController.inputOneRightStickHandler),l.ondpadup(e.InputController.inputOneShockDPadUpHandler),l.ondpaddown(e.InputController.inputOneShockDPadDownHandler),l.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),l.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad2Type=e.GamepadType.Generic;var s=e.InputController.gamepad2;s.onbuttonup(e.InputController.inputTwoButtonUpHandler),s.onbuttondown(e.InputController.inputTwoButtonDownHandler),s.onleftstickchanged(e.InputController.inputTwoLeftStickHandler),s.onrightstickchanged(e.InputController.inputTwoRightStickHandler)}if(null==e.InputController.gamepad3&&2===t.index)if(e.InputController.gamepad3=t,BABYLON.Tools.Log("Gamepad Three Connected: "+e.InputController.gamepad3.id),e.InputController.gamepad3 instanceof BABYLON.Xbox360Pad){e.InputController.gamepad3Type=e.GamepadType.Xbox360;var u=e.InputController.gamepad3;u.onbuttonup(e.InputController.inputThreeButtonUpHandler),u.onbuttondown(e.InputController.inputThreeButtonDownHandler),u.onleftstickchanged(e.InputController.inputThreeLeftStickHandler),u.onrightstickchanged(e.InputController.inputThreeRightStickHandler),u.ondpadup(e.InputController.inputThreeXboxDPadUpHandler),u.ondpaddown(e.InputController.inputThreeXboxDPadDownHandler),u.onlefttriggerchanged(e.InputController.inputThreeXboxLeftTriggerHandler),u.onrighttriggerchanged(e.InputController.inputThreeXboxRightTriggerHandler)}else if(e.InputController.gamepad3 instanceof BABYLON.DualShockPad){var c=e.InputController.gamepad3;c.onbuttonup(e.InputController.inputOneButtonUpHandler),c.onbuttondown(e.InputController.inputOneButtonDownHandler),c.onleftstickchanged(e.InputController.inputOneLeftStickHandler),c.onrightstickchanged(e.InputController.inputOneRightStickHandler),c.ondpadup(e.InputController.inputOneShockDPadUpHandler),c.ondpaddown(e.InputController.inputOneShockDPadDownHandler),c.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),c.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad3Type=e.GamepadType.Generic;var d=e.InputController.gamepad3;d.onbuttonup(e.InputController.inputThreeButtonUpHandler),d.onbuttondown(e.InputController.inputThreeButtonDownHandler),d.onleftstickchanged(e.InputController.inputThreeLeftStickHandler),d.onrightstickchanged(e.InputController.inputThreeRightStickHandler)}if(null==e.InputController.gamepad4&&3===t.index)if(e.InputController.gamepad4=t,BABYLON.Tools.Log("Gamepad Four Connected: "+e.InputController.gamepad4.id),e.InputController.gamepad4 instanceof BABYLON.Xbox360Pad){e.InputController.gamepad4Type=e.GamepadType.Xbox360;var p=e.InputController.gamepad4;p.onbuttonup(e.InputController.inputFourButtonUpHandler),p.onbuttondown(e.InputController.inputFourButtonDownHandler),p.onleftstickchanged(e.InputController.inputFourLeftStickHandler),p.onrightstickchanged(e.InputController.inputFourRightStickHandler),p.ondpadup(e.InputController.inputFourXboxDPadUpHandler),p.ondpaddown(e.InputController.inputFourXboxDPadDownHandler),p.onlefttriggerchanged(e.InputController.inputFourXboxLeftTriggerHandler),p.onrighttriggerchanged(e.InputController.inputFourXboxRightTriggerHandler)}else if(e.InputController.gamepad4 instanceof BABYLON.DualShockPad){var h=e.InputController.gamepad4;h.onbuttonup(e.InputController.inputOneButtonUpHandler),h.onbuttondown(e.InputController.inputOneButtonDownHandler),h.onleftstickchanged(e.InputController.inputOneLeftStickHandler),h.onrightstickchanged(e.InputController.inputOneRightStickHandler),h.ondpadup(e.InputController.inputOneShockDPadUpHandler),h.ondpaddown(e.InputController.inputOneShockDPadDownHandler),h.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),h.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad4Type=e.GamepadType.Generic;var m=e.InputController.gamepad4;m.onbuttonup(e.InputController.inputFourButtonUpHandler),m.onbuttondown(e.InputController.inputFourButtonDownHandler),m.onleftstickchanged(e.InputController.inputFourLeftStickHandler),m.onrightstickchanged(e.InputController.inputFourRightStickHandler)}null!=e.InputController.GamepadConnected&&e.InputController.GamepadConnected(t,n)},t.inputManagerGamepadDisconnected=function(t,n){null!=e.InputController.GamepadDisconnected&&e.InputController.GamepadDisconnected(t,n)},t.MOUSE_DAMPENER=.5,t.TAP_THRESHOLD_MS=200,t.GamepadManager=null,t.GamepadConnected=null,t.GamepadDisconnected=null,t.AllowMobileControls=!0,t.MobileControlsActive=!1,t.EnablePinchZoomTracking=!1,t.PointerLockedFlag=!1,t.LockMousePointerObserver=null,t.input=!1,t.keymap={},t.scroll=0,t.wheel=0,t.mousex=0,t.mousey=0,t.vertical=0,t.horizontal=0,t.mousex2=0,t.mousey2=0,t.vertical2=0,t.horizontal2=0,t.mousex3=0,t.mousey3=0,t.vertical3=0,t.horizontal3=0,t.mousex4=0,t.mousey4=0,t.vertical4=0,t.horizontal4=0,t.a_mousex=0,t.x_scroll=0,t.x_wheel=0,t.x_mousex=0,t.x_mousey=0,t.x_vertical=0,t.x_horizontal=0,t.k_mousex=0,t.k_mousey=0,t.k_vertical=0,t.k_horizontal=0,t.j_mousex=0,t.j_mousey=0,t.j_vertical=0,t.j_horizontal=0,t.g_mousex1=0,t.g_mousey1=0,t.g_vertical1=0,t.g_horizontal1=0,t.g_mousex2=0,t.g_mousey2=0,t.g_vertical2=0,t.g_horizontal2=0,t.g_mousex3=0,t.g_mousey3=0,t.g_vertical3=0,t.g_horizontal3=0,t.g_mousex4=0,t.g_mousey4=0,t.g_vertical4=0,t.g_horizontal4=0,t.dragDirection=0,t.pinchZoomState=0,t.pinchZoomEvents=[],t.pinchZoomDistance=null,t.mouseDownTarget=null,t.mouseDragTarget=null,t.leftButtonDown=!1,t.middleButtonDown=!1,t.rightButtonDown=!1,t.mouseButtonsDown=0,t.mouseButtonPress=[],t.mouseButtonDown=[],t.mouseButtonUp=[],t.keyButtonPress=[],t.keyButtonDown=[],t.keyButtonUp=[],t.previousPosition=null,t.preventDefault=!1,t.rightHanded=!0,t.gamepad1=null,t.gamepad1Type=-1,t.gamepad1ButtonPress=[],t.gamepad1ButtonDown=[],t.gamepad1ButtonUp=[],t.gamepad1DpadPress=[],t.gamepad1DpadDown=[],t.gamepad1DpadUp=[],t.gamepad1LeftTrigger=[],t.gamepad1RightTrigger=[],t.gamepad2=null,t.gamepad2Type=-1,t.gamepad2ButtonPress=[],t.gamepad2ButtonDown=[],t.gamepad2ButtonUp=[],t.gamepad2DpadPress=[],t.gamepad2DpadDown=[],t.gamepad2DpadUp=[],t.gamepad2LeftTrigger=[],t.gamepad2RightTrigger=[],t.gamepad3=null,t.gamepad3Type=-1,t.gamepad3ButtonPress=[],t.gamepad3ButtonDown=[],t.gamepad3ButtonUp=[],t.gamepad3DpadPress=[],t.gamepad3DpadDown=[],t.gamepad3DpadUp=[],t.gamepad3LeftTrigger=[],t.gamepad3RightTrigger=[],t.gamepad4=null,t.gamepad4Type=-1,t.gamepad4ButtonPress=[],t.gamepad4ButtonDown=[],t.gamepad4ButtonUp=[],t.gamepad4DpadPress=[],t.gamepad4DpadDown=[],t.gamepad4DpadUp=[],t.gamepad4LeftTrigger=[],t.gamepad4RightTrigger=[],t}();e.InputController=r;var a=function(){function t(e,t,n,o,i,r){void 0===o&&(o=!0),void 0===i&&(i=-1),void 0===r&&(r=null);var a=this;this.isFixed=!0,this.touchId=null,this.pointerId=null,this.dragStart=null,this.mouseButton=-1,this.maxDistance=48,this.deadZone=2,this.xvalue=0,this.yvalue=0,this.stick=null,this.base=null,this.active=!1,this.enabled=!0,this.updateElements=!0,this.preventDefault=!0,this.stopPropagation=!0,this.baseElementOpacity="1",this.stickElementOpacity="1",this.onHandleDown=null,this.onHandleMove=null,this.onHandleUp=null,this.isFixed=o,this.deadZone=n,this.maxDistance=t,this.mouseButton=i,r&&(this.base=document.getElementById(r)),e&&(this.stick=document.getElementById(e)),this.base&&(this.base.oncontextmenu=function(e){return!1}),this.stick&&(this.stick.oncontextmenu=function(e){return!1}),this.isFixed?this.stick?this.stick.addEventListener("pointerdown",function(e){return a.handleDown(e)}):console.warn("Failed to locate fixed joystick element: "+e):(this.base&&(this.base.style.opacity="0"),this.stick&&(this.stick.style.opacity="0"),document.documentElement.addEventListener("pointerdown",function(e){return a.handleDown(e)})),document.documentElement.addEventListener("pointermove",function(e){return a.handleMove(e)},{passive:!1}),document.documentElement.addEventListener("pointerup",function(e){return a.handleUp(e)})}return t.prototype.dispose=function(){},t.prototype.isActive=function(){return this.active},t.prototype.getValueX=function(){return this.xvalue},t.prototype.getValueY=function(){return this.yvalue},t.prototype.getMouseButton=function(){return this.mouseButton},t.prototype.getBaseElement=function(){return this.base},t.prototype.getStickElement=function(){return this.stick},t.prototype.isFixedJoystick=function(){return this.isFixed},t.prototype.handleDown=function(t){if(this.enabled){var n=!(1&~t.buttons),o=!(2&~t.buttons);(this.mouseButton!==e.TouchMouseButton.Left||n)&&(this.mouseButton!==e.TouchMouseButton.Right||o)&&(this.active=!0,this.pointerId=t.pointerId,this.showBaseElement(t),this.stick&&(this.stick.style.transition="0s"),this.active&&this.preventDefault&&t.preventDefault(),t.changedTouches?(this.dragStart={x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY},this.touchId=t.changedTouches[0].identifier):this.dragStart={x:t.clientX,y:t.clientY},this.onHandleDown&&this.onHandleDown(t),this.stopPropagation&&t.stopPropagation())}},t.prototype.handleMove=function(e){if(this.enabled&&this.active&&e.pointerId===this.pointerId){if(e.changedTouches){for(var t=null,n=0;n<e.changedTouches.length;n++)this.touchId===e.changedTouches[n].identifier&&(t=n,e.clientX=e.changedTouches[n].clientX,e.clientY=e.changedTouches[n].clientY);if(null===t)return}var o=e.clientX-this.dragStart.x,i=e.clientY-this.dragStart.y,r=Math.atan2(i,o),a=Math.min(this.maxDistance,Math.hypot(o,i)),l=a*Math.cos(r),s=a*Math.sin(r);this.stick&&(this.stick.style.transform="translate3d(".concat(l,"px, ").concat(s,"px, 0px)"));var u=a<this.deadZone?0:this.maxDistance/(this.maxDistance-this.deadZone)*(a-this.deadZone),c=u*Math.cos(r),d=u*Math.sin(r),p=parseFloat((c/this.maxDistance).toFixed(4)),h=parseFloat((d/this.maxDistance).toFixed(4));this.xvalue=p,this.yvalue=h,this.onHandleMove&&this.onHandleMove(e),this.stopPropagation&&e.stopPropagation()}},t.prototype.handleUp=function(e){this.enabled&&this.active&&e.pointerId===this.pointerId&&(e.changedTouches&&this.touchId!==e.changedTouches[0].identifier||(this.stick&&(this.stick.style.transition=".2s",this.stick.style.transform="translate3d(0px, 0px, 0px)"),this.xvalue=0,this.yvalue=0,this.touchId=null,this.pointerId=null,this.active=!1,this.hideBaseElement(),this.onHandleUp&&this.onHandleUp(e),this.stopPropagation&&e.stopPropagation()))},t.prototype.showBaseElement=function(e){if(!this.isFixed&&this.updateElements){if(this.base&&this.base.style.opacity!==this.baseElementOpacity){var t=this.base.getBoundingClientRect();this.base.style.left=e.clientX-t.width/2+"px",this.base.style.top=e.clientY-t.height/2+"px",this.base.style.opacity=this.baseElementOpacity}this.stick&&this.stick.style.opacity!==this.stickElementOpacity&&(this.stick.style.opacity=this.stickElementOpacity)}else this.isFixed||this.updateElements||this.hideBaseElement()},t.prototype.hideBaseElement=function(){this.isFixed||(this.base&&"0"!==this.base.style.opacity&&(this.base.style.opacity="0",this.base.style.left="-1000px",this.base.style.top="-1000px"),this.stick&&"0"!==this.stick.style.opacity&&(this.stick.style.opacity="0"))},t}();e.TouchJoystickHandler=a}(o||(o={})),function(e){var t=function(){function t(){}return t.IsWindows=function(){return"undefined"!=typeof Windows&&void 0!==Windows.UI&&void 0!==Windows.System&&void 0!==Windows.Foundation},t.IsCordova=function(){return null!=window.cordova},t.IsWebAssembly=function(){return window.WebAssembly},t.IsOculusBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/OculusBrowser/i)&&(e=!0),e},t.IsSamsungBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/SamsungBrowser/i)&&(e=!0),e},t.IsWindowsPhone=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Windows Phone/i)&&(e=!0),e},t.IsBlackBerry=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/BlackBerry/i)&&(e=!0),e},t.IsOperaMini=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Opera Mini/i)&&(e=!0),e},t.IsAndroid=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Android/i)&&(e=!0),e},t.IsWebOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/webOS/i)&&(e=!0),e},t.IsIOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone|iPad|iPod/i)&&(e=!0),e},t.IsIPHONE=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone/i)&&(e=!0),e},t.IsIPAD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPad/i)&&(e=!0),e},t.IsIPOD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPod/i)&&(e=!0),e},t.IsIE11=function(){return void 0!==navigator.maxTouchPoints},t.IsMobile=function(){var e=!1;if(null!=navigator&&null!=navigator.userAgent){var t=navigator.userAgent;(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone|iPad|iPod/i)||t.match(/BlackBerry/i)||t.match(/Opera Mini/i)||t.match(/Windows Phone/i))&&(e=!0)}return e},t.IsPlaystation=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Playstation/i)&&(e=!0),e},t.IsXboxConsole=function(){var t=!1;return e.WindowManager.IsWindows()&&void 0!==Windows.System.Profile&&void 0!==Windows.System.Profile.AnalyticsInfo&&void 0!==Windows.System.Profile.AnalyticsInfo.versionInfo&&void 0!==Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily&&Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily.match(/Xbox/i)&&(t=!0),t},t.IsXboxLive=function(){return e.WindowManager.IsWindows()&&"undefined"!=typeof Microsoft&&void 0!==Microsoft.Xbox&&void 0!==Microsoft.Xbox.Services},t.IsFrameWindow=function(){return null!=window.parent&&window!==window.parent},t.IsPortraitWindow=function(){return"portrait"===e.WindowManager.GetOrientation()},t.IsLandscapeWindow=function(){return"landscape"===e.WindowManager.GetOrientation()},t.IsStandaloneWindow=function(){return!!window.navigator.standalone||!(!window.matchMedia||!window.matchMedia("(display-mode: standalone)").matches)},t.IsFullscreenWindow=function(){return!!window.navigator.standalone||!(!window.matchMedia||!window.matchMedia("(display-mode: fullscreen)").matches)},t.IsProgressiveWindow=function(){return e.WindowManager.IsStandaloneWindow()||e.WindowManager.IsFullscreenWindow()},t.GetDisplayMode=function(){if(window.navigator.standalone)return"standalone";if(window.matchMedia){if(window.matchMedia("(display-mode: fullscreen)").matches)return"fullscreen";if(window.matchMedia("(display-mode: standalone)").matches)return"standalone";if(window.matchMedia("(display-mode: minimal-ui)").matches)return"minimal-ui"}return"browser"},t.GetOrientation=function(){var e="portrait";if(window.screen&&window.screen.orientation){var t=window.screen.orientation.type;t.includes("portrait")?e="portrait":t.includes("landscape")&&(e="landscape")}else if(window.orientation){var n=window.orientation;0===n||180===n?e="portrait":90!==n&&-90!==n||(e="landscape")}return e},t.AlertMessage=function(t,n){void 0===n&&(n="Babylon Toolkit");var o=null;return e.WindowManager.IsWindows()?o=new Windows.UI.Popups.MessageDialog(t,n).showAsync():window.alert(t),o},t.GetQueryStringParam=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},t.PostWindowMessage=function(e,t,n){void 0===t&&(t="*"),void 0===n&&(n=!1),!0===n?window.postMessage(e,t):window.top?window.top.postMessage(e,t):console.warn("No Valid Top Window")},t.LoadLevel=function(e,t){if(void 0===t&&(t=null),null!=window.BJS&&"engine.html"===window.BJS){var n=window.location.protocol+"//"+window.location.host+":"+window.location.port+window.location.pathname+"?scene="+e;null!=t&&""!==t&&(n+=t),window.location.replace(n)}else BABYLON.Tools.Warn("Scene viewer engine.html required to load level: "+e);return!1},t.ShowSceneLoader=function(){window.showSceneLoader&&window.showSceneLoader()},t.HideSceneLoader=function(){window.hideSceneLoader&&window.hideSceneLoader()},t.UpdateLoaderStatus=function(e,t,n){window.updateStatus&&window.updateStatus(e,t,n)},t.UpdateLoaderDetails=function(e,t){window.updateDetails&&window.updateDetails(e,t)},t.UpdateLoaderProgress=function(e,t){window.updateProgress&&window.updateProgress(e,t)},t.ShowPageErrorMessage=function(e,t,n){void 0===t&&(t="Error"),void 0===n&&(n=0),window.showErrorMessage&&window.showErrorMessage(e,t,n)},t.SetTimeout=function(e,t){return window.setTimeout(t,e)},t.ClearTimeout=function(e){window.clearTimeout(e)},t.SetInterval=function(e,t){return window.setInterval(t,e)},t.ClearInterval=function(e){window.clearInterval(e)},t.Atob=function(e){return window.atob(e)},t.Btoa=function(e){return window.btoa(e)},t.PopupDebug=function(e){e.debugLayer&&(e.debugLayer.hide(),e.debugLayer.show({enablePopup:!0,globalRoot:null}))},t.ToggleDebug=function(t,n,o){if(void 0===n&&(n=!1),void 0===o&&(o=null),t.debugLayer){var i=window;!0===e.WindowManager.debugLayerVisible?(e.WindowManager.debugLayerVisible=!1,i.METER&&i.METER.show&&i.METER.show(),t.debugLayer.hide()):(e.WindowManager.debugLayerVisible=!0,i.METER&&i.METER.hide&&i.METER.hide(),t.debugLayer.show({embedMode:n,globalRoot:o}))}},t.GetLocalStorageItem=function(e){return null!=window.localStorage?window.localStorage.getItem(e):null},t.SetLocalStorageItem=function(e,t){null!=window.localStorage&&window.localStorage.setItem(e,t)},t.GetSessionStorageItem=function(e){return null!=window.sessionStorage?window.sessionStorage.getItem(e):null},t.SetSessionStorageItem=function(e,t){null!=window.sessionStorage&&window.sessionStorage.setItem(e,t)},t.GetFilenameFromUrl=function(e){return e.substring(e.lastIndexOf("/")+1)},t.GetUrlParameter=function(e){var t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.search);return null!==n?decodeURIComponent(n[1].replace(/\+/g," ")):null},t.GetVirtualRealityEnabled=function(){var t=e.WindowManager.GetLocalStorageItem("virtualReality");return null!=t&&"true"===t},t.SetVirtualRealityEnabled=function(t){e.WindowManager.SetLocalStorageItem("virtualReality",t.toString().toLowerCase())},t.SetWindowsLaunchMode=function(t){void 0===t&&(t=1),e.WindowManager.IsWindows()&&void 0!==Windows.UI.ViewManagement&&void 0!==Windows.UI.ViewManagement.ApplicationView&&(Windows.UI.ViewManagement.ApplicationView.preferredLaunchWindowingMode=t)},t.QuitWindowsApplication=function(){e.WindowManager.IsWindows()&&window.close()},t.PrintToScreen=function(t,n){if(void 0===n&&(n="white"),e.WindowManager.PrintElement=document.getElementById("print"),null==e.WindowManager.PrintElement){var o=document.createElement("div");o.id="print",o.style.position="absolute",o.style.left="6px",o.style.bottom="3px",o.style.fontSize="12px",o.style.zIndex="10000",o.style.color="#0c0",o.style.pointerEvents="none",document.body.appendChild(o),e.WindowManager.PrintElement=o}null!=e.WindowManager.PrintElement&&e.WindowManager.PrintElement.innerHTML!==t&&(e.WindowManager.PrintElement.style.color!==n&&(e.WindowManager.PrintElement.style.color=n),e.WindowManager.PrintElement.innerHTML=t)},t.debugLayerVisible=!1,t.PrintElement=null,t}();e.WindowManager=t}(o||(o={})),o.WindowManager.IsWindows()&&void 0!==Windows.UI.ViewManagement&&void 0!==Windows.UI.ViewManagement.ApplicationViewBoundsMode&&void 0!==Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow&&Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow),o.WindowManager.IsXboxConsole()&&navigator.gamepadInputEmulation&&(navigator.gamepadInputEmulation="gamepad"),function(e){var t=function(t){function n(n,o,i,r){void 0===i&&(i={}),void 0===r&&(r="TOOLKIT.AnimationState");var a=t.call(this,n,o,i,r)||this;return a._looptime=!1,a._loopblend=!1,a._frametime=0,a._layercount=0,a._updatemode=0,a._hasrootmotion=!1,a._animationplaying=!1,a._initialtargetblending=!1,a._hastransformhierarchy=!1,a._leftfeetbottomheight=0,a._rightfeetbottomheight=0,a._runtimecontroller=null,a._executed=!1,a._awakened=!1,a._initialized=!1,a._checkers=new e.TransitionCheck,a._source="",a._machine=null,a._animationmode=0,a._animationrig=null,a._deltaPosition=new BABYLON.Vector3(0,0,0),a._deltaRotation=new BABYLON.Quaternion(0,0,0,0),a._angularVelocity=new BABYLON.Vector3(0,0,0),a._rootMotionSpeed=0,a._lastMotionSpeed=0,a._loopMotionSpeed=0,a._lastRotateSpeed=0,a._loopRotateSpeed=0,a._lastMotionRotation=new BABYLON.Quaternion(0,0,0,0),a._lastMotionPosition=new BABYLON.Vector3(0,0,0),a._positionWeight=!1,a._rootBoneWeight=!1,a._rotationWeight=!1,a._rootQuatWeight=!1,a._rootBoneTransform=null,a._positionHolder=new BABYLON.Vector3(0,0,0),a._rootBoneHolder=new BABYLON.Vector3(0,0,0),a._rotationHolder=new BABYLON.Quaternion(0,0,0,0),a._rootQuatHolder=new BABYLON.Quaternion(0,0,0,0),a._rootMotionMatrix=BABYLON.Matrix.Zero(),a._rootMotionScaling=new BABYLON.Vector3(0,0,0),a._rootMotionRotation=new BABYLON.Quaternion(0,0,0,0),a._rootMotionPosition=new BABYLON.Vector3(0,0,0),a._dirtyMotionMatrix=null,a._dirtyBlenderMatrix=null,a._targetPosition=new BABYLON.Vector3(0,0,0),a._targetRotation=new BABYLON.Quaternion(0,0,0,0),a._targetScaling=new BABYLON.Vector3(1,1,1),a._updateMatrix=BABYLON.Matrix.Zero(),a._blenderMatrix=BABYLON.Matrix.Zero(),a._blendWeights=new e.BlendingWeights,a._emptyScaling=new BABYLON.Vector3(1,1,1),a._emptyPosition=new BABYLON.Vector3(0,0,0),a._emptyRotation=new BABYLON.Quaternion(0,0,0,0),a._ikFrameEanbled=!1,a._data=new Map,a._anims=new Map,a._clips=null,a._numbers=new Map,a._booleans=new Map,a._triggers=new Map,a._parameters=new Map,a.speedRatio=1,a.delayUpdateUntilReady=!0,a.enableAnimation=!0,a.applyRootMotion=!1,a.onAnimationAwakeObservable=new BABYLON.Observable,a.onAnimationInitObservable=new BABYLON.Observable,a.onAnimationIKObservable=new BABYLON.Observable,a.onAnimationEndObservable=new BABYLON.Observable,a.onAnimationLoopObservable=new BABYLON.Observable,a.onAnimationEventObservable=new BABYLON.Observable,a.onAnimationUpdateObservable=new BABYLON.Observable,a.onAnimationTransitionObservable=new BABYLON.Observable,a.m_zeroVector=new BABYLON.Vector3(0,0,0),a.m_defaultGroup=null,a.m_animationTargets=null,a.m_rotationIdentity=new BABYLON.Quaternion(0,0,0,0),a.sourceAnimationGroups=null,a}return i(n,t),n.prototype.awakened=function(){return this._awakened},n.prototype.initialized=function(){return this._initialized},n.prototype.hasRootMotion=function(){return this._hasrootmotion},n.prototype.isFirstFrame=function(){return 0===this._frametime},n.prototype.isLastFrame=function(){return this._frametime>=.985},n.prototype.ikFrameEnabled=function(){return this._ikFrameEanbled},n.prototype.getAnimationTime=function(){return this._frametime},n.prototype.getFrameLoopTime=function(){return this._looptime},n.prototype.getFrameLoopBlend=function(){return this._loopblend},n.prototype.getAnimationPlaying=function(){return this._animationplaying},n.prototype.getRuntimeController=function(){return this._runtimecontroller},n.prototype.getRootBoneTransform=function(){return this._rootBoneTransform},n.prototype.getDeltaRootMotionAngle=function(){return this._angularVelocity.y},n.prototype.getDeltaRootMotionSpeed=function(){return this._rootMotionSpeed},n.prototype.getDeltaRootMotionPosition=function(){return this._deltaPosition},n.prototype.getDeltaRootMotionRotation=function(){return this._deltaRotation},n.prototype.getFixedRootMotionPosition=function(){return null!=this._dirtyMotionMatrix?this._rootMotionPosition:null},n.prototype.getFixedRootMotionRotation=function(){return null!=this._dirtyMotionMatrix?this._rootMotionRotation:null},n.prototype.awake=function(){this.awakeStateMachine()},n.prototype.update=function(){this.updateStateMachine()},n.prototype.destroy=function(){this.destroyStateMachine()},n.prototype.playDefaultAnimation=function(t,n,o){void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=null);var i=!1;if(!0===this._initialized)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>n){var r=this._machine.layers[n],a=null!=r.animationStateMachine&&r.animationStateMachine.rate||e.AnimationState.FPS,l=t>0?e.Utilities.ComputeBlendingSpeed(o||a,t):0;this.playCurrentAnimationState(r,r.entry,l),i=!0}else BABYLON.Tools.Warn("No animation state layers on "+this.transform.name);else BABYLON.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return i},n.prototype.playAnimation=function(t,n,o,i){void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=null);var r=!1;if(!0===this._initialized)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>o){var a=this._machine.layers[o],l=null!=a.animationStateMachine&&a.animationStateMachine.rate||e.AnimationState.FPS,s=n>0?e.Utilities.ComputeBlendingSpeed(i||l,n):0;this.playCurrentAnimationState(a,t,s),r=!0}else BABYLON.Tools.Warn("No animation state layers on "+this.transform.name);else BABYLON.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return r},n.prototype.stopAnimation=function(e){void 0===e&&(e=0);var t=!1;if(!0===this._initialized)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>e){var n=this._machine.layers[e];this.stopCurrentAnimationState(n),t=!0}else BABYLON.Tools.Warn("No animation state layers on "+this.transform.name);else BABYLON.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return t},n.prototype.killAnimations=function(){var e=this,t=!1;return!0===this._initialized?null!=this._machine&&null!=this._machine.layers?this._machine.layers.forEach(function(n){e.stopCurrentAnimationState(n),t=!0}):BABYLON.Tools.Warn("No animation state layers on "+this.transform.name):BABYLON.Tools.Warn("Animation state machine not initialized for "+this.transform.name),t},n.prototype.hasBool=function(e){return null!=this._booleans.get(e)},n.prototype.getBool=function(e){return this._booleans.get(e)||!1},n.prototype.setBool=function(e,t){this._booleans.set(e,t)},n.prototype.hasFloat=function(e){return null!=this._numbers.get(e)},n.prototype.getFloat=function(e){return this._numbers.get(e)||0},n.prototype.setFloat=function(e,t){this._numbers.set(e,t)},n.prototype.hasInteger=function(e){return null!=this._numbers.get(e)},n.prototype.getInteger=function(e){return this._numbers.get(e)||0},n.prototype.setInteger=function(e,t){this._numbers.set(e,t)},n.prototype.hasTrigger=function(e){return null!=this._triggers.get(e)},n.prototype.getTrigger=function(e){return this._triggers.get(e)||!1},n.prototype.setTrigger=function(e){this._triggers.set(e,!0)},n.prototype.resetTrigger=function(e){this._triggers.set(e,!1)},n.prototype.setSmoothFloat=function(e,t,n){var o=BABYLON.Scalar.Lerp(this.getFloat(e),t,Math.min(n,1));this.setFloat(e,o)},n.prototype.setSmoothInteger=function(e,t,n){var o=BABYLON.Scalar.Lerp(this.getInteger(e),t,Math.min(n,1));this.setInteger(e,o)},n.prototype.getMachineState=function(e){return this._data.get(e)},n.prototype.setMachineState=function(e,t){this._data.set(e,t)},n.prototype.getCurrentState=function(e){return null!=this._machine.layers&&this._machine.layers.length>e?this._machine.layers[e].animationStateMachine:null},n.prototype.getDefaultClips=function(){return this._clips},n.prototype.getDefaultSource=function(){return this._source},n.prototype.setLayerWeight=function(e,t){},n.prototype.fixAnimationGroup=function(e){var t=null;if(null!=this._clips&&this._clips.length>0)for(var n=0;n<this._clips.length;n++){var o=this._clips[n];if(null!=o.clip){var i=("."+o.clip).toLowerCase();if(e.name.toLowerCase().endsWith(i)){null==e.metadata&&(e.metadata={}),null==e.metadata.toolkit&&(e.metadata.toolkit=o),e.metadata.toolkit.source=this._source,t=o;break}}}return t},n.prototype.getAnimationGroup=function(e){return this._anims.get(e)},n.prototype.getAnimationGroups=function(){return this.sourceAnimationGroups},n.prototype.setAnimationGroups=function(e){null==this.transform.metadata&&(this.transform.metadata={}),null==this.transform.metadata.toolkit&&(this.transform.metadata.toolkit={}),this.transform.metadata.toolkit.sourceAnimationGroups=e,this.setupSourceAnimationGroups()},n.prototype.updateAnimationGroups=function(t){var n=this;null!=t&&t.length>0&&(this._anims=new Map,this.m_animationTargets=[],this.m_defaultGroup=null,this.sourceAnimationGroups=null,t.forEach(function(t){var o=!1,i=t;if(null!=i&&null!=i.metadata&&null!=i.metadata.toolkit&&null!=i.metadata.toolkit.source&&""!==i.metadata.toolkit.source&&i.metadata.toolkit.source===n._source&&(o=!0),!0===o&&null!=i&&null!=i.metadata&&null!=i.metadata.toolkit&&null!=i.metadata.toolkit.clip&&""!==i.metadata.toolkit.clip){try{t.stop()}catch(e){}null==n.sourceAnimationGroups&&(n.sourceAnimationGroups=[]),n.sourceAnimationGroups.push(t),n._anims.set(i.metadata.toolkit.clip,t),null==n.m_defaultGroup&&(n.m_defaultGroup=t),null!=t.targetedAnimations&&t.targetedAnimations.length>0&&t.targetedAnimations.forEach(function(t){for(var o=-1,i=0;i<n.m_animationTargets.length;i++)if(n.m_animationTargets[i].target===t.target){o=i;break}if(o<0)if(n.m_animationTargets.push(t),null==t.target.metadata&&(t.target.metadata={}),t.target instanceof BABYLON.TransformNode){e.Utilities.ValidateTransformQuaternion(t.target);for(var r=[],a=0;a<n._layercount;a++){var l=new e.AnimationMixer;l.positionBuffer=null,l.rotationBuffer=null,l.scalingBuffer=null,l.originalMatrix=null,l.blendingFactor=0,l.blendingSpeed=0,l.rootPosition=null,l.rootRotation=null,r.push(l)}t.target.metadata.mixer=r}else if(t.target instanceof BABYLON.MorphTarget){var s=[];for(a=0;a<n._layercount;a++){var u=new e.AnimationMixer;u.influenceBuffer=null,s.push(u)}t.target.metadata.mixer=s}})}}))},n.prototype.awakeStateMachine=function(){var t=this;e.Utilities.ValidateTransformQuaternion(this.transform),this.m_animationTargets=[],this.m_defaultGroup=null,this.m_rotationIdentity=BABYLON.Quaternion.Identity(),this._source=null!=this.transform.metadata&&null!=this.transform.metadata.toolkit&&null!=this.transform.metadata.toolkit.animator&&""!==this.transform.metadata.toolkit.animator?this.transform.metadata.toolkit.animator:null,this._clips=this.getProperty("clips",this._clips),this._machine=this.getProperty("machine",this._machine),this._updatemode=this.getProperty("updatemode",this._updatemode),this._animationrig=this.getProperty("animationrig",this._animationrig),this._animationmode=this.getProperty("animationmode",this._animationmode),this._hasrootmotion=this.getProperty("hasrootmotion",this._hasrootmotion),this._runtimecontroller=this.getProperty("runtimecontroller",this._runtimecontroller),this._hastransformhierarchy=this.getProperty("hastransformhierarchy",this._hastransformhierarchy),this._leftfeetbottomheight=this.getProperty("leftfeetbottomheight",this._leftfeetbottomheight),this._rightfeetbottomheight=this.getProperty("rightfeetbottomheight",this._rightfeetbottomheight),this.applyRootMotion=this.getProperty("applyrootmotion",this.applyRootMotion),null!=this._machine&&(null!=this._machine.owner&&null!=this._machine.owner&&""!==this._machine.owner&&"*"!==this._machine.owner||(this._machine.owner=null!=this.transform.parent?this.transform.parent.name:this.transform.name),null!=this._machine.speed&&(this.speedRatio=this._machine.speed),null!=this._machine.parameters&&this._machine.parameters.length>0&&this._machine.parameters.forEach(function(n){var o=n.name,i=n.type,r=(n.curve,n.defaultFloat),a=n.defaultBool,l=n.defaultInt;t._parameters.set(o,i),i===e.AnimatorParameterType.Bool?t.setBool(o,a):i===e.AnimatorParameterType.Float?t.setFloat(o,r):i===e.AnimatorParameterType.Int?t.setInteger(o,l):i===e.AnimatorParameterType.Trigger&&t.resetTrigger(o)}),null!=this._machine.layers&&this._machine.layers.length>0&&(this._layercount=this._machine.layers.length,this._machine.layers.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this._machine.layers.forEach(function(e){if(null==e.owner||null==e.owner||""===e.owner||e.owner,e.animationMaskMap=new Map,null!=e.avatarMask&&null!=e.avatarMask.transformPaths&&e.avatarMask.transformPaths.length>0)for(var t=0;t<e.avatarMask.transformPaths.length;t++)e.animationMaskMap.set(e.avatarMask.transformPaths[t],t)}))),this._awakened=!0,this.onAnimationAwakeObservable&&this.onAnimationAwakeObservable.hasObservers()&&this.onAnimationAwakeObservable.notifyObservers(this.transform)},n.prototype.updateStateMachine=function(e){var t=this;if(void 0===e&&(e=null),(!1===this.delayUpdateUntilReady||!0===this.delayUpdateUntilReady&&this.isReady())&&(null==this.sourceAnimationGroups&&this.setupSourceAnimationGroups(),null!=this.sourceAnimationGroups&&(!1===this._executed&&(this._executed=!0,null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(e){t.playCurrentAnimationState(e,e.entry,0)}),this._initialized=!0,this.onAnimationInitObservable&&this.onAnimationInitObservable.hasObservers()&&this.onAnimationInitObservable.notifyObservers(this.transform)),!0===this.enableAnimation))){var n=e||this.getDeltaSeconds();this.updateAnimationState(n),this.updateAnimationTargets(n),this.onAnimationUpdateObservable&&this.onAnimationUpdateObservable.hasObservers()&&this.onAnimationUpdateObservable.notifyObservers(this.transform)}},n.prototype.setupSourceAnimationGroups=function(){var e=this,t=null!=this.transform.metadata&&null!=this.transform.metadata.toolkit&&null!=this.transform.metadata.toolkit.sourceAnimationGroups?this.transform.metadata.toolkit.sourceAnimationGroups:null;null!=t&&(this.updateAnimationGroups(t),null!=this.sourceAnimationGroups&&null!=this._machine&&null!=this._machine.states&&this._machine.states.length>0&&this._machine.states.forEach(function(t){null!=t&&null!=t.name&&(null!=t.ccurves&&t.ccurves.length>0&&t.ccurves.forEach(function(e){if(null!=e.animation){var n=BABYLON.Animation.Parse(e.animation);null!=n&&(null==t.tcurves&&(t.tcurves=[]),t.tcurves.push(n))}}),e.setupTreeBranches(t.blendtree),e.setMachineState(t.name,t))}))},n.prototype.destroyStateMachine=function(){this._data=null,this._clips=null,this._anims=null,this._numbers=null,this._booleans=null,this._triggers=null,this._parameters=null,this._checkers=null,this._machine=null,this.sourceAnimationGroups=null,this.onAnimationAwakeObservable.clear(),this.onAnimationAwakeObservable=null,this.onAnimationInitObservable.clear(),this.onAnimationInitObservable=null,this.onAnimationIKObservable.clear(),this.onAnimationIKObservable=null,this.onAnimationEndObservable.clear(),this.onAnimationEndObservable=null,this.onAnimationLoopObservable.clear(),this.onAnimationLoopObservable=null,this.onAnimationEventObservable.clear(),this.onAnimationEventObservable=null,this.onAnimationUpdateObservable.clear(),this.onAnimationUpdateObservable=null,this.onAnimationTransitionObservable.clear(),this.onAnimationTransitionObservable=null},n.prototype.updateAnimationState=function(e){var t=this;null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(n){t.checkStateMachine(n,e)})},n.prototype.updateAnimationTargets=function(t){var n=this;this._looptime=!1,this._loopblend=!1,this._ikFrameEanbled=!1,this._animationplaying=!1,null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(o){if(0===o.index&&(n._frametime=o.animationTime),null!=o.animationStateMachine&&null!=o.animationStateMachine.blendtree){!0===o.animationStateMachine.iKOnFeet&&(n._ikFrameEanbled=!0),!0===o.iKPass&&n.onAnimationIKObservable&&n.onAnimationIKObservable.hasObservers()&&n.onAnimationIKObservable.notifyObservers(o.index);var i=o.animationStateMachine;if(i.type===e.MotionType.Clip&&-1!==i.played&&(i.played+=t),null!=i.blendtree.children&&i.blendtree.children.length>0){var r=i.blendtree.children[0];if(null!=r)if(i.blendtree.blendType==e.BlendTreeType.Clip){var a=r.track;if(null!=a){var l=a.metadata.toolkit.length,s=e.AnimationState.TIME/l;o.animationTime+=t*s*Math.abs(i.speed)*Math.abs(n.speedRatio)*e.AnimationState.SPEED,o.animationTime>e.AnimationState.TIME&&(o.animationTime=e.AnimationState.TIME),o.animationNormal=o.animationTime>0?BABYLON.Scalar.Clamp(o.animationTime/e.AnimationState.TIME,0,1):0;var u=o.animationNormal>=.99?1:o.animationNormal,c=parseFloat(u.toFixed(3));i.speed<0&&(o.animationNormal=1-o.animationNormal);var d=l*o.animationNormal,p=0,h=0,m=0,f=!1,g=!1,y=0,v=!0,_=!0,b=!0,B=a;null!=B.metadata&&null!=B.metadata.toolkit&&(null!=B.metadata.toolkit.averagespeed&&(h=null!=B.metadata.toolkit.averagespeed.x?B.metadata.toolkit.averagespeed.x:0,m=null!=B.metadata.toolkit.averagespeed.z?B.metadata.toolkit.averagespeed.z:0),null!=B.metadata.toolkit.settings&&(p=null!=B.metadata.toolkit.settings.level?B.metadata.toolkit.settings.level:0,f=null!=B.metadata.toolkit.settings.looptime&&B.metadata.toolkit.settings.looptime,g=null!=B.metadata.toolkit.settings.loopblend&&B.metadata.toolkit.settings.loopblend,y=null!=B.metadata.toolkit.settings.orientationoffsety?B.metadata.toolkit.settings.orientationoffsety:0,v=null==B.metadata.toolkit.settings.loopblendorientation||B.metadata.toolkit.settings.loopblendorientation,_=null==B.metadata.toolkit.settings.loopblendpositiony||B.metadata.toolkit.settings.loopblendpositiony,b=null==B.metadata.toolkit.settings.loopblendpositionxz||B.metadata.toolkit.settings.loopblendpositionxz)),0===o.index&&(n._looptime=f,n._loopblend=g),y=BABYLON.Tools.ToRadians(y),h=Math.abs(h),m=Math.abs(m),p*=-1,o.animationTime>=e.AnimationState.TIME&&(o.animationFirstRun=!1,o.animationLoopFrame=!0,!0===f?(o.animationLoopCount++,n.onAnimationLoopObservable&&n.onAnimationLoopObservable.hasObservers()&&n.onAnimationLoopObservable.notifyObservers(o.index)):!1===o.animationEndFrame&&(o.animationEndFrame=!0,n.onAnimationEndObservable&&n.onAnimationEndObservable.hasObservers()&&n.onAnimationEndObservable.notifyObservers(o.index))),!0!==o.animationFirstRun&&!0!==f||(n._animationplaying=!0,a.targetedAnimations.forEach(function(t){if(t.target instanceof BABYLON.TransformNode){var i=t.target;if(0===o.index||null==o.avatarMask||n.filterTargetAvatarMask(o,i)){var r=null!=i.metadata&&null!=i.metadata.toolkit&&null!=i.metadata.toolkit.rootbone&&i.metadata.toolkit.rootbone;if(!0===r&&null==n._rootBoneTransform&&(n._rootBoneTransform=i),null!=i.metadata&&null!=i.metadata.mixer){var a=i.metadata.mixer[o.index];if(null!=a)if("position"===t.animation.targetProperty)n._targetPosition=e.Utilities.SampleAnimationVector3(t.animation,d,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===r&&null!=n._rootBoneTransform?(n._positionWeight=!0,n._positionHolder.set(0,0,0),n._rootBoneWeight=!1,n._rootBoneHolder.set(0,0,0),!0===n.applyRootMotion?!0===_&&!0===b?(n._positionWeight=!0,n._positionHolder.set(n._targetPosition.x,n._targetPosition.y+p,n._targetPosition.z)):!1===_&&!1===b?(n._rootBoneWeight=!0,n._rootBoneHolder.set(n._targetPosition.x,n._targetPosition.y+p,n._targetPosition.z)):!0===_&&!1===b?(n._positionWeight=!0,n._positionHolder.set(n.m_zeroVector.x,n._targetPosition.y+p,n.m_zeroVector.z),n._rootBoneWeight=!0,n._rootBoneHolder.set(n._targetPosition.x,n.m_zeroVector.y,n._targetPosition.z)):!0===b&&!1===_&&(n._positionWeight=!0,n._positionHolder.set(n._targetPosition.x,n.m_zeroVector.y,n._targetPosition.z),n._rootBoneWeight=!0,n._rootBoneHolder.set(n.m_zeroVector.x,n._targetPosition.y+p,n.m_zeroVector.z)):(n._positionWeight=!0,n._positionHolder.set(n._targetPosition.x,n._targetPosition.y+p,n._targetPosition.z)),!0===n._positionWeight&&(null==a.positionBuffer&&(a.positionBuffer=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.positionBuffer,n._positionHolder,1)),!0===n._rootBoneWeight&&(null==a.rootPosition&&(a.rootPosition=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.rootPosition,n._rootBoneHolder,1))):(null==a.positionBuffer&&(a.positionBuffer=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.positionBuffer,n._targetPosition,1));else if("rotationQuaternion"===t.animation.targetProperty)if(n._targetRotation=e.Utilities.SampleAnimationQuaternion(t.animation,d,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===r&&null!=n._rootBoneTransform){n._rotationWeight=!1,n._rotationHolder.copyFrom(n.m_rotationIdentity),n._rootQuatWeight=!1,n._rootQuatHolder.copyFrom(n.m_rotationIdentity);var l=n._targetRotation.toEulerAngles(),s=l.y;!0===n.applyRootMotion?!0===v?(n._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(l.x,s+y,l.z,n._rotationHolder)):(n._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(l.x,n.m_zeroVector.y,l.z,n._rotationHolder),n._rootQuatWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(n.m_zeroVector.x,s+y,n.m_zeroVector.z,n._rootQuatHolder)):(n._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(l.x,s+y,l.z,n._rotationHolder)),!0===n._rotationWeight&&(null==a.rotationBuffer&&(a.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rotationBuffer,n._rotationHolder,1)),!0===n._rootQuatWeight&&(null==a.rootRotation&&(a.rootRotation=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rootRotation,n._rootQuatHolder,1))}else null==a.rotationBuffer&&(a.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rotationBuffer,n._targetRotation,1);else"scaling"===t.animation.targetProperty&&(n._targetScaling=e.Utilities.SampleAnimationVector3(t.animation,d,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==a.scalingBuffer&&(a.scalingBuffer=new BABYLON.Vector3(1,1,1)),e.Utilities.BlendVector3Value(a.scalingBuffer,n._targetScaling,1))}}}else if(t.target instanceof BABYLON.MorphTarget){var u=t.target;if(null!=u.metadata&&null!=u.metadata.mixer){var c=u.metadata.mixer[o.index];if("influence"===t.animation.targetProperty){var h=e.Utilities.SampleAnimationFloat(t.animation,d,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0);null==c.influenceBuffer&&(c.influenceBuffer=0),c.influenceBuffer=e.Utilities.BlendFloatValue(c.influenceBuffer,h,1)}}}})),1==n._animationplaying&&(null!=o.animationStateMachine.tcurves&&o.animationStateMachine.tcurves.length>0&&o.animationStateMachine.tcurves.forEach(function(t){if(null!=t.targetProperty&&""!==t.targetProperty){var i=e.Utilities.SampleAnimationFloat(t,o.animationNormal,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0);n.setFloat(t.targetProperty,i)}}),null!=o.animationStateMachine.events&&o.animationStateMachine.events.length>0&&o.animationStateMachine.events.forEach(function(e){if(c>=e.time-.01&&c<=e.time+.01){var t=e.function+"_"+e.time;null==o.animationLoopEvents&&(o.animationLoopEvents={}),o.animationLoopEvents[t]||(o.animationLoopEvents[t]=!0,n.onAnimationEventObservable&&n.onAnimationEventObservable.hasObservers()&&n.onAnimationEventObservable.notifyObservers(e))}})),!0===o.animationLoopFrame&&(o.animationTime=0,o.animationNormal=0,o.animationLoopFrame=!1,o.animationLoopEvents=null)}}else{n._animationplaying=!0,n._blendWeights.primary=null,n._blendWeights.secondary=null;var C=[],S=i.blendtree;n.parseTreeBranches(o,S,1,C),s=n.computeWeightedFrameRatio(C),o.animationTime+=t*s*Math.abs(i.speed)*Math.abs(n.speedRatio)*e.AnimationState.SPEED,o.animationTime>e.AnimationState.TIME&&(o.animationTime=e.AnimationState.TIME),o.animationNormal=o.animationTime>0?BABYLON.Scalar.Clamp(o.animationTime/e.AnimationState.TIME,0,1):0,u=o.animationNormal>=.99?1:o.animationNormal;var A=parseFloat(u.toFixed(3));i.speed<0&&(o.animationNormal=1-o.animationNormal);var T=o.animationNormal;o.animationTime>=e.AnimationState.TIME&&(o.animationFirstRun=!1,o.animationLoopFrame=!0,o.animationLoopCount++);var O=null!=C&&C.length>0&&null!=C[0].track?C[0].track:null;if(null!=O)for(var I=O.targetedAnimations.length,M=0;M<I;M++){var L=O.targetedAnimations[M];if(L.target instanceof BABYLON.TransformNode){var x=L.target;if(0===o.index||null==o.avatarMask||n.filterTargetAvatarMask(o,x)){var w=null!=x.metadata&&null!=x.metadata.toolkit&&null!=x.metadata.toolkit.rootbone&&x.metadata.toolkit.rootbone;if(!0===w&&null==n._rootBoneTransform&&(n._rootBoneTransform=x),null!=x.metadata&&null!=x.metadata.mixer){n._initialtargetblending=!0;var P=x.metadata.mixer[o.index];n.updateBlendableTargets(t,o,S,L,M,P,T,w,x)}}}}null!=o.animationStateMachine.tcurves&&o.animationStateMachine.tcurves.length>0&&o.animationStateMachine.tcurves.forEach(function(t){if(null!=t.targetProperty&&""!==t.targetProperty){var i=e.Utilities.SampleAnimationFloat(t,o.animationNormal,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0);n.setFloat(t.targetProperty,i)}}),null!=o.animationStateMachine.events&&o.animationStateMachine.events.length>0&&o.animationStateMachine.events.forEach(function(e){if(A>=e.time-.01&&A<=e.time+.01){var t=e.function+"_"+e.time;null==o.animationLoopEvents&&(o.animationLoopEvents={}),o.animationLoopEvents[t]||(o.animationLoopEvents[t]=!0,n.onAnimationEventObservable&&n.onAnimationEventObservable.hasObservers()&&n.onAnimationEventObservable.notifyObservers(e))}}),!0===o.animationLoopFrame&&(o.animationTime=0,o.animationNormal=0,o.animationLoopFrame=!1,o.animationLoopEvents=null)}}}}),this.finalizeAnimationTargets(t)},n.prototype.updateBlendableTargets=function(t,n,o,i,r,a,l,s,u){if(null!=a&&null!=o.children&&o.children.length>0)for(var c=0;c<o.children.length;c++){var d=o.children[c];if(d.weight>0)if(d.type===e.MotionType.Clip){if(null!=d.track){var p=0,h=0,m=0,f=!1,g=0,y=!0,v=!0,_=!0,b=d.track;null!=b.metadata&&null!=b.metadata.toolkit&&(null!=b.metadata.toolkit.averagespeed&&(h=null!=b.metadata.toolkit.averagespeed.x?b.metadata.toolkit.averagespeed.x:0,m=null!=b.metadata.toolkit.averagespeed.z?b.metadata.toolkit.averagespeed.z:0),null!=b.metadata.toolkit.settings&&(p=null!=b.metadata.toolkit.settings.level?b.metadata.toolkit.settings.level:0,f=null!=b.metadata.toolkit.settings.loopblend&&b.metadata.toolkit.settings.loopblend,g=null!=b.metadata.toolkit.settings.orientationoffsety?b.metadata.toolkit.settings.orientationoffsety:0,y=null==b.metadata.toolkit.settings.loopblendorientation||b.metadata.toolkit.settings.loopblendorientation,v=null==b.metadata.toolkit.settings.loopblendpositiony||b.metadata.toolkit.settings.loopblendpositiony,_=null==b.metadata.toolkit.settings.loopblendpositionxz||b.metadata.toolkit.settings.loopblendpositionxz)),0===n.index&&(this._looptime=!0,this._loopblend=f),g=BABYLON.Tools.ToRadians(g),h=Math.abs(h),m=Math.abs(m),p*=-1;var B=d.track.targetedAnimations[r],C=!0===this._initialtargetblending?1:parseFloat(d.weight.toFixed(2));if(this._initialtargetblending=!1,B.target===i.target&&B.animation.targetProperty===i.animation.targetProperty){var S=l;d.timescale<0&&(S=1-S);var A=d.track.metadata.toolkit.length*S;if("position"===i.animation.targetProperty)this._targetPosition=e.Utilities.SampleAnimationVector3(B.animation,A,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===s&&null!=this._rootBoneTransform?(this._positionWeight=!0,this._positionHolder.set(0,0,0),this._rootBoneWeight=!1,this._rootBoneHolder.set(0,0,0),!0===this.applyRootMotion?!0===v&&!0===_?(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+p,this._targetPosition.z)):!1===v&&!1===_?(this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this._targetPosition.y+p,this._targetPosition.z)):!0===v&&!1===_?(this._positionWeight=!0,this._positionHolder.set(this.m_zeroVector.x,this._targetPosition.y+p,this.m_zeroVector.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this.m_zeroVector.y,this._targetPosition.z)):!0===_&&!1===v&&(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this.m_zeroVector.y,this._targetPosition.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(this.m_zeroVector.x,this._targetPosition.y+p,this.m_zeroVector.z)):(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+p,this._targetPosition.z)),!0===this._positionWeight&&(null==a.positionBuffer&&(a.positionBuffer=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.positionBuffer,this._positionHolder,C)),!0===this._rootBoneWeight&&(null==a.rootPosition&&(a.rootPosition=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.rootPosition,this._rootBoneHolder,C))):(null==a.positionBuffer&&(a.positionBuffer=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.positionBuffer,this._targetPosition,C));else if("rotationQuaternion"===i.animation.targetProperty)if(this._targetRotation=e.Utilities.SampleAnimationQuaternion(B.animation,A,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===s&&null!=this._rootBoneTransform){this._rotationWeight=!1,this._rotationHolder.copyFrom(this.m_rotationIdentity),this._rootQuatWeight=!1,this._rootQuatHolder.copyFrom(this.m_rotationIdentity);var T=this._targetRotation.toEulerAngles(),O=T.y;!0===this.applyRootMotion?!0===y?(this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(T.x,O+g,T.z,this._rotationHolder)):(this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(T.x,this.m_zeroVector.y,T.z,this._rotationHolder),this._rootQuatWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(this.m_zeroVector.x,O+g,this.m_zeroVector.z,this._rootQuatHolder)):(this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(T.x,O+g,T.z,this._rotationHolder)),!0===this._rotationWeight&&(null==a.rotationBuffer&&(a.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rotationBuffer,this._rotationHolder,C)),!0===this._rootQuatWeight&&(null==a.rootRotation&&(a.rootRotation=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rootRotation,this._rootQuatHolder,C))}else null==a.rotationBuffer&&(a.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rotationBuffer,this._targetRotation,C);else"scaling"===i.animation.targetProperty&&(this._targetScaling=e.Utilities.SampleAnimationVector3(B.animation,A,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==a.scalingBuffer&&(a.scalingBuffer=new BABYLON.Vector3(1,1,1)),e.Utilities.BlendVector3Value(a.scalingBuffer,this._targetScaling,C))}}}else d.type===e.MotionType.Tree&&this.updateBlendableTargets(t,n,d.subtree,i,r,a,l,s,u)}},n.prototype.finalizeAnimationTargets=function(t){var n=this;if(this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(t){var o=t.target;null!=o.metadata&&null!=o.metadata.mixer&&null!=n._machine.layers&&n._machine.layers.length>0&&(n._blenderMatrix.reset(),n._dirtyBlenderMatrix=null,n._machine.layers.forEach(function(t){var i=o.metadata.mixer[t.index];if(null!=i)if(o instanceof BABYLON.TransformNode){if(null==i.positionBuffer&&null==i.rotationBuffer&&null==i.scalingBuffer||(BABYLON.Matrix.ComposeToRef(i.scalingBuffer||o.scaling,i.rotationBuffer||o.rotationQuaternion,i.positionBuffer||o.position,n._updateMatrix),i.blendingSpeed>0&&(i.blendingFactor<=1&&null==i.originalMatrix&&(i.originalMatrix=BABYLON.Matrix.Compose(o.scaling,o.rotationQuaternion,o.position)),i.blendingFactor<=1&&null!=i.originalMatrix&&(e.Utilities.FastMatrixSlerp(i.originalMatrix,n._updateMatrix,i.blendingFactor,n._updateMatrix),i.blendingFactor+=i.blendingSpeed)),e.Utilities.FastMatrixSlerp(n._blenderMatrix,n._updateMatrix,t.defaultWeight,n._blenderMatrix),n._dirtyBlenderMatrix=!0,i.positionBuffer=null,i.rotationBuffer=null,i.scalingBuffer=null),n._emptyPosition.set(0,0,0),n._emptyRotation.set(0,0,0,0),n._emptyScaling.set(1,1,1),null!=i.rootPosition||null!=i.rootRotation){var r=n._emptyPosition,a=i.rootRotation?i.rootRotation.clone():n._emptyRotation,l=i.rootPosition?i.rootPosition.clone():n._emptyPosition;BABYLON.Matrix.ComposeToRef(r,a,l,n._updateMatrix),e.Utilities.FastMatrixSlerp(n._rootMotionMatrix,n._updateMatrix,t.defaultWeight,n._rootMotionMatrix),n._dirtyMotionMatrix=!0,i.rootPosition=null,i.rootRotation=null}}else o instanceof BABYLON.MorphTarget&&null!=i.influenceBuffer&&(o.influence=BABYLON.Scalar.Lerp(o.influence,i.influenceBuffer,t.defaultWeight),i.influenceBuffer=null)}),null!=n._dirtyBlenderMatrix&&n._blenderMatrix.decompose(o.scaling,o.rotationQuaternion,o.position))}),!0===this.applyRootMotion&&null!=this._dirtyMotionMatrix){if(this._rootMotionMatrix.decompose(this._rootMotionScaling,this._rootMotionRotation,this._rootMotionPosition),!0===this.isFirstFrame())this._deltaPosition.copyFrom(this._rootMotionPosition),this._deltaRotation.copyFrom(this._rootMotionRotation);else if(!0===this.isLastFrame()){if(this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),e.Utilities.QuaternionDiffToRef(this._rootMotionRotation,this._lastMotionRotation,this._deltaRotation),!0===this._looptime&&!0===this._loopblend){var o=this._loopMotionSpeed+this._lastMotionSpeed;0!==o&&(o/=2),this._deltaPosition.normalize(),this._deltaPosition.scaleInPlace(o*t);var i=this._loopRotateSpeed+this._lastRotateSpeed;0!==i&&(i/=2),this._deltaRotation.toEulerAnglesToRef(this._angularVelocity),BABYLON.Quaternion.FromEulerAnglesToRef(this._angularVelocity.x,i,this._angularVelocity.z,this._deltaRotation)}}else this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),e.Utilities.QuaternionDiffToRef(this._rootMotionRotation,this._lastMotionRotation,this._deltaRotation);var r=this._deltaPosition.length();this._rootMotionSpeed=r>0?r/t:r,this._deltaRotation.toEulerAnglesToRef(this._angularVelocity),this._lastMotionPosition.copyFrom(this._rootMotionPosition),this._lastMotionRotation.copyFrom(this._rootMotionRotation),this._lastMotionSpeed=this._rootMotionSpeed,this._lastRotateSpeed=this._angularVelocity.y,0===this._frametime&&(this._loopMotionSpeed=this._rootMotionSpeed,this._loopRotateSpeed=this._angularVelocity.y)}},n.prototype.checkStateMachine=function(e,t){var n=this;this._checkers.result=null,this._checkers.offest=0,this._checkers.blending=0,this._checkers.triggered=[],null!=e.animationStateMachine&&(e.animationStateMachine.time+=t,this.checkStateTransitions(e,e.animationStateMachine.transitions),null==this._checkers.result&&null!=this._machine.transitions&&this.checkStateTransitions(e,this._machine.transitions)),null!=this._checkers.triggered&&this._checkers.triggered.length>0&&(this._checkers.triggered.forEach(function(e){n.resetTrigger(e)}),this._checkers.triggered=null),null!=this._checkers.result&&(this.onAnimationTransitionObservable&&this.onAnimationTransitionObservable.hasObservers()&&this.onAnimationTransitionObservable.notifyObservers(this.transform),this.playCurrentAnimationState(e,this._checkers.result,this._checkers.blending,this._checkers.offest))},n.prototype.checkStateTransitions=function(t,n){var o=this,i=t.animationStateMachine.rate,r=t.animationStateMachine.length;if(null!=n&&n.length>0){var a=0,l=-1;for(a=0;a<n.length;a++)if(!0===n[a].solo&&!1===n[a].mute){l=a;break}var s=function(){var s=n[a];if(s.layerIndex!==t.index)return"continue";if(!0===s.mute)return"continue";if(l>=0&&l!==a)return"continue";var c=!1,d=0,p=!0;if(s.exitTime>0&&(d=r*s.exitTime/u.speedRatio,p=!0!==s.hasExitTime||t.animationStateMachine.time>=d),!0===s.hasExitTime&&s.intSource==e.InterruptionSource.None&&!1===p)return"continue";if(null!=s.conditions&&s.conditions.length>0){var h=0,m=s.conditions.length;s.conditions.forEach(function(t){var n=o._parameters.get(t.parameter);if(null!=n)if(n==e.AnimatorParameterType.Float||n==e.AnimatorParameterType.Int){var i=parseFloat(o.getFloat(t.parameter).toFixed(2));(t.mode===e.ConditionMode.Greater&&i>t.threshold||t.mode===e.ConditionMode.Less&&i<t.threshold||t.mode===e.ConditionMode.Equals&&i===t.threshold||t.mode===e.ConditionMode.NotEqual&&i!==t.threshold)&&h++}else if(n==e.AnimatorParameterType.Bool){var r=o.getBool(t.parameter);(t.mode===e.ConditionMode.If&&!0===r||t.mode===e.ConditionMode.IfNot&&!1===r)&&h++}else if(n==e.AnimatorParameterType.Trigger&&!0===o.getTrigger(t.parameter)){h++;for(var a=-1,l=0;l<o._checkers.triggered.length;l++)if(o._checkers.triggered[l]===t.parameter){a=l;break}a<0&&o._checkers.triggered.push(t.parameter)}}),c=!0===s.hasExitTime?!0===p&&h===m:h===m}else c=!0===s.hasExitTime&&!0===p;if(!0===c){!0===s.hasExitTime&&!0===p&&u.onAnimationEndObservable&&u.onAnimationEndObservable.hasObservers()&&u.onAnimationEndObservable.notifyObservers(t.index);var f=i>0?i:e.AnimationState.FPS,g=!1===s.isExit?s.destination:e.AnimationState.EXIT,y=!0===s.fixedDuration?s.duration:BABYLON.Scalar.Denormalize(s.duration,0,r),v=e.Utilities.ComputeBlendingSpeed(f,y),_=s.offset;return u._checkers.result=g,u._checkers.offest=_,u._checkers.blending=v,"break"}},u=this;for(a=0;a<n.length&&"break"!==s();a++);}},n.prototype.playCurrentAnimationState=function(t,n,o,i){if(void 0===i&&(i=0),null!=t&&null!=n&&""!==n&&n!==e.AnimationState.EXIT&&(null==t.animationStateMachine||t.animationStateMachine.name!==n)){null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(e){var n=e.target;if(null!=n.metadata&&null!=n.metadata.mixer){var i=n.metadata.mixer[t.index];null!=i&&(i.originalMatrix=null,i.blendingFactor=0,i.blendingSpeed=o)}});var r=this.getMachineState(n);null!=r&&r.layerIndex===t.index&&(r.time=0,r.played=0,r.interrupted=!1,t.animationTime=BABYLON.Scalar.Clamp(i),t.animationNormal=0,t.animationFirstRun=!0,t.animationEndFrame=!1,t.animationLoopFrame=!1,t.animationLoopCount=0,t.animationLoopEvents=null,t.animationStateMachine=r,this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),this._lastMotionPosition.set(0,0,0),this._lastMotionRotation.set(0,0,0,0))}},n.prototype.stopCurrentAnimationState=function(e){null!=e&&(null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(t){var n=t.target;if(null!=n.metadata&&null!=n.metadata.mixer){var o=n.metadata.mixer[e.index];null!=o&&(o.originalMatrix=null,o.blendingFactor=0,o.blendingSpeed=0)}}),e.animationTime=0,e.animationNormal=0,e.animationFirstRun=!0,e.animationEndFrame=!1,e.animationLoopFrame=!1,e.animationLoopCount=0,e.animationLoopEvents=null,e.animationStateMachine=null,this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),this._lastMotionPosition.set(0,0,0),this._lastMotionRotation.set(0,0,0,0))},n.prototype.checkAvatarTransformPath=function(e,t){var n=!1;if(null!=e.animationMaskMap){var o=e.animationMaskMap.get(t);null!=o&&o>=0&&(n=!0)}return n},n.prototype.filterTargetAvatarMask=function(e,t){var n=!1;if(null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.bone&&""!==t.metadata.toolkit.bone){var o=t.metadata.toolkit.bone;n=this.checkAvatarTransformPath(e,o)}return n},n.prototype.sortWeightedBlendingList=function(e){null!=e&&e.length>0&&e.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0})},n.prototype.computeWeightedFrameRatio=function(e){var t=1;if(null!=e&&e.length>0)if(this.sortWeightedBlendingList(e),this._blendWeights.primary=e[0],this._blendWeights.primary.weight<1&&e.length>1&&(this._blendWeights.secondary=e[1]),null!=this._blendWeights.primary&&null!=this._blendWeights.secondary){var n=BABYLON.Scalar.Clamp(this._blendWeights.primary.weight);t=BABYLON.Scalar.Lerp(this._blendWeights.secondary.ratio,this._blendWeights.primary.ratio,n)}else null!=this._blendWeights.primary&&null==this._blendWeights.secondary&&(t=this._blendWeights.primary.ratio);return t},n.prototype.setupTreeBranches=function(t){var n=this;null!=t&&null!=t.children&&t.children.length>0&&t.children.forEach(function(t){if(t.type===e.MotionType.Tree)n.setupTreeBranches(t.subtree);else if(t.type===e.MotionType.Clip&&null!=t.motion&&""!==t.motion&&(t.weight=0,t.ratio=0,t.track=n.getAnimationGroup(t.motion),null!=t.track)){var o=t.track.metadata.toolkit.length;t.ratio=e.AnimationState.TIME/o}})},n.prototype.parseTreeBranches=function(t,n,o,i){if(null!=n)switch(n.valueParameterX=null!=n.blendParameterX?parseFloat(this.getFloat(n.blendParameterX).toFixed(2)):0,n.valueParameterY=null!=n.blendParameterY?parseFloat(this.getFloat(n.blendParameterY).toFixed(2)):0,n.blendType){case e.BlendTreeType.Simple1D:this.parse1DSimpleTreeBranches(t,n,o,i);break;case e.BlendTreeType.SimpleDirectional2D:this.parse2DSimpleDirectionalTreeBranches(t,n,o,i);break;case e.BlendTreeType.FreeformDirectional2D:this.parse2DFreeformDirectionalTreeBranches(t,n,o,i);break;case e.BlendTreeType.FreeformCartesian2D:this.parse2DFreeformCartesianTreeBranches(t,n,o,i)}},n.prototype.parse1DSimpleTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.threshold,posY:e.threshold,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate1DSimpleBlendTree(n.valueParameterX,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.prototype.parse2DSimpleDirectionalTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate2DFreeformDirectional(n.valueParameterX,n.valueParameterY,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.prototype.parse2DFreeformDirectionalTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate2DFreeformDirectional(n.valueParameterX,n.valueParameterY,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.prototype.parse2DFreeformCartesianTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate2DFreeformCartesian(n.valueParameterX,n.valueParameterY,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.FPS=30,n.EXIT="[EXIT]",n.TIME=1,n.SPEED=1,n}(e.ScriptComponent);e.AnimationState=t;e.BlendTreeValue=function(e){this.source=e.source,this.motion=e.motion,this.posX=e.posX||0,this.posY=e.posY||0,this.weight=e.weight||0};var n=function(){function e(){}return e.ClampValue=function(e,t,n){return e<=t?t:e>=n?n:e},e.GetSignedAngle=function(e,t){return Math.atan2(e.x*t.y-e.y*t.x,e.x*t.x+e.y*t.y)},e.GetLinearInterpolation=function(e,t,n,o,i){return t+(o-t)/(n-e)*(i-e)},e.GetRightNeighbourIndex=function(e,t){t.sort(function(e,t){return e.posX-t.posX});for(var n=0;n<t.length;++n)if(t[n].posX>e)return n;return-1},e}();e.BlendTreeUtils=n;var o=function(){function t(){}return t.Calculate1DSimpleBlendTree=function(t,n){var o=n[0],i=n[n.length-1];if(t<=o.posX)o.weight=1;else if(t>=i.posX)i.weight=1;else{var r=e.BlendTreeUtils.GetRightNeighbourIndex(t,n),a=n[r-1],l=n[r],s=e.BlendTreeUtils.GetLinearInterpolation(a.posX,1,l.posX,0,t);a.weight=s,l.weight=1-a.weight}},t.Calculate2DFreeformDirectional=function(t,n,o){e.BlendTreeSystem.TempVector2_IP.set(t,n),e.BlendTreeSystem.TempVector2_POSI.set(0,0),e.BlendTreeSystem.TempVector2_POSJ.set(0,0),e.BlendTreeSystem.TempVector2_POSIP.set(0,0),e.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var i=0,r=e.BlendTreeSystem.TempVector2_IP.length(),a=0;a<o.length;++a){var l=o[a];e.BlendTreeSystem.TempVector2_POSI.set(l.posX,l.posY);for(var s=e.BlendTreeSystem.TempVector2_POSI.length(),u=r-s,c=e.BlendTreeUtils.GetSignedAngle(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_IP),d=1,p=0;p<o.length;++p)if(p!==a){e.BlendTreeSystem.TempVector2_POSJ.set(o[p].posX,o[p].posY);var h=e.BlendTreeSystem.TempVector2_POSJ.length(),m=(s+h)/2,f=u/m,g=(h-s)/m,y=e.BlendTreeUtils.GetSignedAngle(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSJ);e.BlendTreeSystem.TempVector2_POSIP.set(f,2*c),e.BlendTreeSystem.TempVector2_POSIJ.set(g,2*y);var v=e.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),_=BABYLON.Vector2.Dot(e.BlendTreeSystem.TempVector2_POSIP,e.BlendTreeSystem.TempVector2_POSIJ)/v;_=1-_,_=e.BlendTreeUtils.ClampValue(_,0,1),d=Math.min(_,d)}l.weight=d,i+=d}for(var b=0,B=o;b<B.length;b++)(l=B[b]).weight/=i},t.Calculate2DFreeformCartesian=function(t,n,o){e.BlendTreeSystem.TempVector2_IP.set(t,n),e.BlendTreeSystem.TempVector2_POSI.set(0,0),e.BlendTreeSystem.TempVector2_POSJ.set(0,0),e.BlendTreeSystem.TempVector2_POSIP.set(0,0),e.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var i=0,r=0;r<o.length;++r){var a=o[r];e.BlendTreeSystem.TempVector2_POSI.set(a.posX,a.posY),e.BlendTreeSystem.TempVector2_IP.subtractToRef(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSIP);for(var l=1,s=0;s<o.length;++s)if(s!==r){e.BlendTreeSystem.TempVector2_POSJ.set(o[s].posX,o[s].posY),e.BlendTreeSystem.TempVector2_POSJ.subtractToRef(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSIJ);var u=e.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),c=BABYLON.Vector2.Dot(e.BlendTreeSystem.TempVector2_POSIP,e.BlendTreeSystem.TempVector2_POSIJ)/u;c=1-c,c=e.BlendTreeUtils.ClampValue(c,0,1),l=Math.min(l,c)}a.weight=l,i+=l}for(var d=0,p=o;d<p.length;d++)(a=p[d]).weight/=i},t.TempVector2_IP=new BABYLON.Vector2(0,0),t.TempVector2_POSI=new BABYLON.Vector2(0,0),t.TempVector2_POSJ=new BABYLON.Vector2(0,0),t.TempVector2_POSIP=new BABYLON.Vector2(0,0),t.TempVector2_POSIJ=new BABYLON.Vector2(0,0),t}();e.BlendTreeSystem=o;e.MachineState=function(){};e.TransitionCheck=function(){};e.AnimationMixer=function(){};var r,a,l,s,u,c;e.BlendingWeights=function(){},(c=e.MotionType||(e.MotionType={}))[c.Clip=0]="Clip",c[c.Tree=1]="Tree",(u=e.ConditionMode||(e.ConditionMode={}))[u.If=1]="If",u[u.IfNot=2]="IfNot",u[u.Greater=3]="Greater",u[u.Less=4]="Less",u[u.Equals=6]="Equals",u[u.NotEqual=7]="NotEqual",(s=e.InterruptionSource||(e.InterruptionSource={}))[s.None=0]="None",s[s.Source=1]="Source",s[s.Destination=2]="Destination",s[s.SourceThenDestination=3]="SourceThenDestination",s[s.DestinationThenSource=4]="DestinationThenSource",(l=e.BlendTreeType||(e.BlendTreeType={}))[l.Simple1D=0]="Simple1D",l[l.SimpleDirectional2D=1]="SimpleDirectional2D",l[l.FreeformDirectional2D=2]="FreeformDirectional2D",l[l.FreeformCartesian2D=3]="FreeformCartesian2D",l[l.Direct=4]="Direct",l[l.Clip=5]="Clip",(a=e.BlendTreePosition||(e.BlendTreePosition={}))[a.Lower=0]="Lower",a[a.Upper=1]="Upper",(r=e.AnimatorParameterType||(e.AnimatorParameterType={}))[r.Float=1]="Float",r[r.Int=3]="Int",r[r.Bool=4]="Bool",r[r.Trigger=9]="Trigger",e.SceneManager.RegisterClass("TOOLKIT.AnimationState",t)}(o||(o={})),function(e){var t=function(t){function n(e,n,o,i){void 0===o&&(o={}),void 0===i&&(i="TOOLKIT.AudioSource");var r=t.call(this,e,n,o,i)||this;return r._audio=null,r._name=null,r._loop=!1,r._mute=!1,r._pitch=1,r._volume=1,r._preload=!1,r._playonawake=!0,r._spatialblend=0,r._preloaderUrl=null,r._lastmutedvolume=null,r._priority=128,r._panstereo=0,r._mindistance=0,r._maxdistance=50,r._reverbzonemix=1,r._bypasseffects=!1,r._bypassreverbzones=!1,r._bypasslistenereffects=!1,r._enablelegacyaudio=!1,r._initializedReadyInstance=!1,r._isAudioPlaying=!1,r._isAudioPaused=!1,r.onReadyObservable=new BABYLON.Observable,r}return i(n,t),n.prototype.getSoundClip=function(){return this._audio},n.prototype.awake=function(){this.awakeAudioSource()},n.prototype.start=function(){this.startAudioSource()},n.prototype.destroy=function(){this.destroyAudioSource()},n.prototype.awakeAudioSource=function(){return r(this,void 0,void 0,function(){var t,n,o;return a(this,function(i){switch(i.label){case 0:return this._name=this.getProperty("name",this._name),this._loop=this.getProperty("loop",this._loop),this._mute=this.getProperty("mute",this._mute),this._pitch=this.getProperty("pitch",this._pitch),this._volume=this.getProperty("volume",this._volume),this._preload=this.getProperty("preload",this._preload),this._priority=this.getProperty("priority",this._priority),this._panstereo=this.getProperty("panstereo",this._panstereo),this._playonawake=this.getProperty("playonawake",this._playonawake),this._mindistance=this.getProperty("mindistance",this._mindistance),this._maxdistance=this.getProperty("maxdistance",this._maxdistance),this._spatialblend=this.getProperty("spatialblend",this._spatialblend),this._reverbzonemix=this.getProperty("reverbzonemix",this._reverbzonemix),this._bypasseffects=this.getProperty("bypasseffects",this._bypasseffects),this._bypassreverbzones=this.getProperty("bypassreverbzones",this._bypassreverbzones),this._bypasslistenereffects=this.getProperty("bypasslistenereffects",this._bypasslistenereffects),this._enablelegacyaudio=this.getProperty("enablelegacyaudio",this._enablelegacyaudio),null!=this._name&&""!==this._name||(this._name="Unknown"),null==(t=this.getProperty("file"))||""===t?[3,4]:(n=e.SceneManager.GetRootUrl(this.scene),null==(o=n+t)||""===o?[3,4]:!0!==this._preload?[3,1]:(this._preloaderUrl=o,[3,4]));case 1:return!0!==this._enablelegacyaudio?[3,2]:(this.setLegacyDataSource(o),[3,4]);case 2:return[4,this.setAudioDataSource(o)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},n.prototype.startAudioSource=function(){this._volume>=e.AudioSource.MAX_VOLUME&&(this._volume=e.AudioSource.DEFAULT_LEVEL)},n.prototype.destroyAudioSource=function(){this.onReadyObservable.clear(),this.onReadyObservable=null,null!=this._audio&&(this._audio.dispose(),this._audio=null)},n.prototype.isReady=function(){return null!=this._audio},n.prototype.isLegacy=function(){return this._enablelegacyaudio},n.prototype.isPlaying=function(){return this._isAudioPlaying},n.prototype.isPaused=function(){return this._isAudioPaused},n.prototype.play=function(t,n,o){return r(this,void 0,void 0,function(){return a(this,function(i){switch(i.label){case 0:return[4,e.AudioSource.UnlockAudioEngine()];case 1:return i.sent(),this.internalPlay(t,n,o),[2,!0]}})})},n.prototype.internalPlay=function(e,t,n){var o=this;null!=this._audio&&(!0===this._initializedReadyInstance?(this._audio instanceof BABYLON.StaticSound?this._audio.play({waitTime:e,startOffset:t,duration:n}):this._audio instanceof BABYLON.Sound&&this._audio.play(e,t,n),this._isAudioPlaying=!0,this._isAudioPaused=!1):this.onReadyObservable.addOnce(function(){o._audio instanceof BABYLON.StaticSound?o._audio.play({waitTime:e,startOffset:t,duration:n}):o._audio instanceof BABYLON.Sound&&o._audio.play(e,t,n),o._isAudioPlaying=!0,o._isAudioPaused=!1}))},n.prototype.pause=function(){var e=!1;return null!=this._audio&&(this._audio.pause(),this._isAudioPlaying=!1,this._isAudioPaused=!0,e=!0),e},n.prototype.stop=function(e){var t=!1;return null!=this._audio&&(this._audio instanceof BABYLON.StaticSound?this._audio.stop({waitTime:e}):this._audio instanceof BABYLON.Sound&&this._audio.stop(e),this._isAudioPlaying=!1,this._isAudioPaused=!1,t=!0),t},n.prototype.mute=function(t){var n=this;return null!=this._audio&&(this._audio instanceof BABYLON.StaticSound?null!=t&&t>0?e.WindowManager.SetTimeout(t/1e3,function(){n._lastmutedvolume=n._audio.volume,n._audio.volume=0}):(this._lastmutedvolume=this._audio.volume,this._audio.volume=0):this._audio instanceof BABYLON.Sound&&(this._lastmutedvolume=this._audio.getVolume(),this._audio.setVolume(0,t))),!1},n.prototype.unmute=function(t){var n=this;return null!=this._audio&&(this._audio instanceof BABYLON.StaticSound?null!=t&&t>0?e.WindowManager.SetTimeout(t/1e3,function(){null!=n._lastmutedvolume&&(n._audio.volume=n._lastmutedvolume,n._lastmutedvolume=null)}):null!=this._lastmutedvolume&&(this._audio.volume=this._lastmutedvolume,this._lastmutedvolume=null):this._audio instanceof BABYLON.Sound&&null!=this._lastmutedvolume&&(this._audio.setVolume(this._lastmutedvolume,t),this._lastmutedvolume=null)),!1},n.prototype.getPitch=function(){return null==this._audio?0:this._audio instanceof BABYLON.StaticSound?this._audio.playbackRate:this._audio instanceof BABYLON.Sound?this._audio.getPlaybackRate():void 0},n.prototype.setPitch=function(e){null!=this._audio&&(this._audio instanceof BABYLON.StaticSound?this._audio.playbackRate=e:this._audio instanceof BABYLON.Sound&&this._audio.setPlaybackRate(e))},n.prototype.getVolume=function(){var e=0;return null!=this._audio?this._audio instanceof BABYLON.StaticSound?e=this._audio.volume:this._audio instanceof BABYLON.Sound&&(e=this._audio.getVolume()):e=this._volume,e},n.prototype.setVolume=function(t,n){var o=this;return this._volume=t,null!=this._audio&&(this._audio instanceof BABYLON.StaticSound?null!=n&&n>0?e.WindowManager.SetTimeout(n/1e3,function(){o._audio.volume=o._volume}):this._audio.volume=this._volume:this._audio instanceof BABYLON.Sound&&this._audio.setVolume(this._volume,n)),!0},n.prototype.setPosition=function(e){this._audio instanceof BABYLON.StaticSound?this._audio.spatial.position=e:this._audio instanceof BABYLON.Sound&&this._audio.setPosition(e)},n.prototype.getPlaybackSpeed=function(){return null==this._audio?0:this._audio instanceof BABYLON.StaticSound?this._audio.playbackRate:this._audio instanceof BABYLON.Sound?this._audio.getPlaybackRate():void 0},n.prototype.setPlaybackSpeed=function(e){null!=this._audio&&(this._audio instanceof BABYLON.StaticSound?this._audio.playbackRate=e:this._audio instanceof BABYLON.Sound&&this._audio.setPlaybackRate(e))},n.prototype.setRolloffMode=function(e){null!=this._audio&&(this._audio instanceof BABYLON.StaticSound&&("linear"===e||"inverse"===e||"exponential"===e)?this._audio.spatial.distanceModel=e:this._audio instanceof BABYLON.Sound&&(this._audio.distanceModel=e))},n.prototype.setMinDistance=function(e){null!=this._audio&&(this._audio instanceof BABYLON.StaticSound?this._audio.spatial.minDistance=e:this._audio instanceof BABYLON.Sound&&(this._audio.refDistance=e))},n.prototype.setMaxDistance=function(e){null!=this._audio&&(this._audio instanceof BABYLON.StaticSound?this._audio.spatial.maxDistance=e:this._audio instanceof BABYLON.Sound&&(this._audio.maxDistance=e))},n.prototype.setSpatialBlend=function(e){null!=this._audio&&(this._audio instanceof BABYLON.StaticSound||(this._audio,BABYLON.Sound))},n.prototype.hasSpatialSound=function(){var e=!1;return null!=this._audio&&(this._audio instanceof BABYLON.StaticSound?e=null!=this._audio.spatial:this._audio instanceof BABYLON.Sound&&(e=this._audio.spatialSound)),e},n.prototype.getSpatialSound=function(){var e=null;return null!=this._audio&&this._audio instanceof BABYLON.StaticSound&&(e=this._audio.spatial),e},n.prototype.setSpatialSound=function(e){null!=this._audio&&this._audio instanceof BABYLON.StaticSound&&(this._audio.spatial=e)},n.prototype.getCurrentTrackTime=function(){var e=0;return null!=this._audio&&(e=this._audio.currentTime),e},n.prototype.setAudioDataSource=function(t){return r(this,void 0,void 0,function(){var n,o;return a(this,function(i){switch(i.label){case 0:return null!=this._audio&&(this._audio.dispose(),this._audio=null),n=this._spatialblend>=.1,this._initializedReadyInstance=!1,this._lastmutedvolume=this._volume,o=this,[4,e.AudioSource.CreateStaticSound(this._name,t,{loop:this._loop,volume:!0===this._mute?0:this._volume,autoplay:!1,playbackRate:this._pitch,spatialEnabled:n,spatialAutoUpdate:!0,spatialPosition:this.transform.absolutePosition.clone(),spatialDistanceModel:"linear",spatialMinDistance:this._mindistance,spatialMaxDistance:this._maxdistance,spatialRolloffFactor:e.AudioSource.DEFAULT_ROLLOFF})];case 1:return o._audio=i.sent(),null!=this._audio&&(this._initializedReadyInstance=!0,!0===n&&null!=this._audio.spatial&&this._audio.spatial.attach(this.transform),this.onReadyObservable&&this.onReadyObservable.hasObservers()&&this.onReadyObservable.notifyObservers(this._audio),!0===this._playonawake&&this.play()),[2]}})})},n.prototype.setLegacyDataSource=function(t){var n=this;null!=this._audio&&(this._audio.dispose(),this._audio=null);var o=this._spatialblend>=.1,i=null!=this.transform.metadata&&null!=this.transform.metadata.vtt&&!0===this.transform.metadata.vtt;this._initializedReadyInstance=!1,this._audio=new BABYLON.Sound(this._name,t,this.scene,function(){n._lastmutedvolume=n._volume,n._audio.setVolume(!0===n._mute?0:n._volume),n._audio.setPlaybackRate(n._pitch),n._audio.setPosition(n.transform.absolutePosition.clone()),n._initializedReadyInstance=!0,!0===o&&n._audio.attachToMesh(n.transform),n.onReadyObservable&&n.onReadyObservable.hasObservers()&&n.onReadyObservable.notifyObservers(n._audio),!0===n._playonawake&&n.play()},{loop:this._loop,autoplay:!1,refDistance:this._mindistance,maxDistance:this._maxdistance,rolloffFactor:e.AudioSource.DEFAULT_ROLLOFF,spatialSound:o,distanceModel:"linear",streaming:i})},n.prototype.addPreloaderTasks=function(e){var t=this;!0===this._preload&&(e.addBinaryFileTask(this.transform.name+".AudioTask",this._preloaderUrl).onSuccess=function(e){return r(t,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return!0!==this._enablelegacyaudio?[3,1]:(this.setLegacyDataSource(e.data),[3,3]);case 1:return[4,this.setAudioDataSource(e.data)];case 2:t.sent(),t.label=3;case 3:return[2]}})})})},n.IsLegacyEngine=function(){return null!=e.SceneManager.GlobalOptions.enablelegacyaudio&&e.SceneManager.GlobalOptions.enablelegacyaudio},n.GetAudioOptions=function(){return e.AudioSource.AUDIO_ENGINE_V2_OPTIONS},n.SetAudioOptions=function(t){e.AudioSource.AUDIO_ENGINE_V2_OPTIONS=t},n.GetAudioEngine=function(){return r(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return null!=e.AudioSource.AUDIO_ENGINE_V2?[3,2]:(t=e.AudioSource,[4,BABYLON.CreateAudioEngineAsync(e.AudioSource.AUDIO_ENGINE_V2_OPTIONS||{listenerAutoUpdate:!0,listenerEnabled:!1,resumeOnInteraction:!0,resumeOnPause:!0})]);case 1:t.AUDIO_ENGINE_V2=n.sent(),n.label=2;case 2:return[2,e.AudioSource.AUDIO_ENGINE_V2]}})})},n.UnlockLegacyAudio=function(){null==BABYLON.Engine.audioEngine||BABYLON.Engine.audioEngine.unlocked||BABYLON.Engine.audioEngine.unlock()},n.UnlockAudioEngine=function(){return r(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return[4,e.AudioSource.GetAudioEngine()];case 1:return null==(t=n.sent())?[3,3]:[4,t.unlockAsync()];case 2:n.sent(),n.label=3;case 3:return[2]}})})},n.AttachSpatialCamera=function(t){return r(this,void 0,void 0,function(){var n;return a(this,function(o){switch(o.label){case 0:return[4,e.AudioSource.GetAudioEngine()];case 1:return null!=(n=o.sent())&&null!=n.listener&&n.listener.attach(t),[2]}})})},n.DetachSpatialCamera=function(){return r(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return[4,e.AudioSource.GetAudioEngine()];case 1:return null!=(t=n.sent())&&null!=t.listener&&t.listener.detach(),[2]}})})},n.UpdateSpatialCamera=function(t,n){return r(this,void 0,void 0,function(){var o;return a(this,function(i){switch(i.label){case 0:return[4,e.AudioSource.GetAudioEngine()];case 1:return null!=(o=i.sent())&&null!=o.listener&&(null!=t&&o.listener.position.copyFrom(t),null==o.listener.rotationQuaternion&&(o.listener.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1)),null!=n&&o.listener.rotationQuaternion.copyFrom(n),o.listener.update()),[2]}})})},n.CreateSoundBuffer=function(t,n){return r(this,void 0,void 0,function(){var o,i;return a(this,function(r){switch(r.label){case 0:return o=null,[4,e.AudioSource.GetAudioEngine()];case 1:return null==(i=r.sent())?[3,3]:[4,i.createSoundBufferAsync(t,n)];case 2:o=r.sent(),r.label=3;case 3:return[2,o]}})})},n.CreateStaticSound=function(t,n,o){return r(this,void 0,void 0,function(){var i,r;return a(this,function(a){switch(a.label){case 0:return i=null,[4,e.AudioSource.GetAudioEngine()];case 1:return null==(r=a.sent())?[3,3]:[4,r.createSoundAsync(t,n,o)];case 2:i=a.sent(),a.label=3;case 3:return[2,i]}})})},n.CreateStreamingSound=function(t,n,o){return r(this,void 0,void 0,function(){var i,r;return a(this,function(a){switch(a.label){case 0:return i=null,[4,e.AudioSource.GetAudioEngine()];case 1:return null==(r=a.sent())?[3,3]:[4,r.createStreamingSoundAsync(t,n,o)];case 2:i=a.sent(),a.label=3;case 3:return[2,i]}})})},n.MAX_VOLUME=1,n.DEFAULT_LEVEL=1,n.DEFAULT_ROLLOFF=1,n.AUDIO_ENGINE_V2=null,n.AUDIO_ENGINE_V2_OPTIONS={listenerAutoUpdate:!0,listenerEnabled:!1,resumeOnInteraction:!0,resumeOnPause:!0},n}(e.ScriptComponent);e.AudioSource=t,e.SceneManager.RegisterClass("TOOLKIT.AudioSource",t)}(o||(o={})),function(e){var t=function(t){function n(e,n,o,i){void 0===o&&(o={}),void 0===i&&(i="TOOLKIT.CharacterController");var r=t.call(this,e,n,o,i)||this;return r._avatarRadius=.28,r._avatarHeight=1.8,r._centerOffset=new BABYLON.Vector3(0,.94,0),r._slopeLimit=45,r._skinWidth=.025,r._stepHeight=.25,r._minMoveDistance=.001,r._slopeSlideSpeed=10,r._slopeAngleRadians=0,r._slopeAngleDegrees=0,r._slopeMoveDirection=0,r._verticalVelocity=0,r._verticalStepSpeed=1,r._minimumStepHeight=.15,r._collisionEvents=!0,r._targetRotation=new BABYLON.Quaternion(0,0,0,1),r._targetVelocity=new BABYLON.Vector3,r._currentVelocity=new BABYLON.Vector3(0,0,0),r._inputVelocity=new BABYLON.Vector3(0,0,0),r._gravityFactor=3,r._minJumpTimer=0,r._maxSlopeTimer=0,r._isSliding=!1,r._isGrounded=!1,r._isSteppingUp=!1,r._hitColor=new BABYLON.Color3(0,1,0),r._noHitColor=new BABYLON.Color3(1,0,0),r._groundRay=null,r._groundRayHelper=null,r._groundHitPointMesh=null,r._stepCheckOriginMesh=null,r._stepCheckHitPointMesh=null,r._stepCheckDestinationMesh=null,r._stepCheckRayHelper=null,r._stepCheckRay=null,r._groundRaycastShape=null,r._groundCollisionNode=null,r._groundRaycastOffset=new BABYLON.Vector3(0,0,0),r._groundRaycastOrigin=new BABYLON.Vector3(0,0,0),r._groundRaycastDirection=new BABYLON.Vector3(0,-1,0),r._groundRaycastDestination=new BABYLON.Vector3(0,0,0),r._localGroundShapecastResult=null,r._worldGroundShapecastResult=null,r._stepCheckRaycastOrigin=new BABYLON.Vector3(0,0,0),r._stepCheckRaycastDestination=new BABYLON.Vector3(0,0,0),r._stepCheckRaycastHitPoint=new BABYLON.Vector3(0,0,0),r._stepCheckRaycastResult=null,r.m_moveDeltaX=0,r.m_moveDeltaZ=0,r.m_havokplugin=null,r.onUpdatePositionObservable=new BABYLON.Observable,r.onUpdateVelocityObservable=new BABYLON.Observable,r.verticalVelocityOffset=0,r.enableStepOffset=!0,r.enableGravity=!0,r.downwardForce=0,r.raycastLength=.01,r.showRaycasts=!1,r}return i(n,t),n.prototype.getAvatarRadius=function(){return this._avatarRadius},n.prototype.getAvatarHeight=function(){return this._avatarHeight},n.prototype.getCenterOffset=function(){return this._centerOffset},n.prototype.getSkinWidth=function(){return this._skinWidth},n.prototype.getStepHeight=function(){return this._stepHeight},n.prototype.getGravityFactor=function(){return this._gravityFactor},n.prototype.setGravityFactor=function(e){this._gravityFactor=e},n.prototype.getInputVelocity=function(){return this._inputVelocity},n.prototype.getVerticalVelocity=function(){return!0===this.isGrounded()?0:this._currentVelocity.y},n.prototype.getSlopeAngleRadians=function(){return this._slopeAngleRadians},n.prototype.getSlopeAngleDegrees=function(){return this._slopeAngleDegrees},n.prototype.getGroundCollisionNode=function(){return this._groundCollisionNode},n.prototype.getVerticalStepSpeed=function(){return this._verticalStepSpeed},n.prototype.setVerticalStepSpeed=function(e){this._verticalStepSpeed=e},n.prototype.getMinimumStepHeight=function(){return this._minimumStepHeight},n.prototype.setMinimumStepHeight=function(e){this._minimumStepHeight=e},n.prototype.getMinMoveDistance=function(){return this._minMoveDistance},n.prototype.setMinMoveDistance=function(e){this._minMoveDistance=e},n.prototype.getSlopeSlideSpeed=function(){return this._slopeSlideSpeed},n.prototype.setSlopeSlideSpeed=function(e){this._slopeSlideSpeed=e},n.prototype.getSlopeLimit=function(){return this._slopeLimit},n.prototype.setSlopeLimit=function(e){this._slopeLimit=e},n.prototype.isSteppingUp=function(){return this._isSteppingUp},n.prototype.isGrounded=function(){return this._isGrounded},n.prototype.isSliding=function(){return this._isSliding},n.prototype.canSlide=function(){return this._slopeAngleDegrees>0&&(this._slopeMoveDirection<=0||this._slopeMoveDirection>0&&this._maxSlopeTimer>=e.CharacterController.DEFAULT_SLIDING_TIMER)},n.prototype.canJump=function(){return!0===this.isGrounded()},n.prototype.awake=function(){this._avatarRadius=this.getProperty("avatarRadius",this._avatarRadius),this._avatarHeight=this.getProperty("avatarHeight",this._avatarHeight),this._slopeLimit=this.getProperty("slopeLimit",this._slopeLimit),this._skinWidth=this.getProperty("skinWidth",this._skinWidth),this._stepHeight=this.getProperty("stepOffset",this._stepHeight),this._minMoveDistance=this.getProperty("minMoveDistance",this._minMoveDistance),this._collisionEvents=this.getProperty("collisionEvents",this._collisionEvents);var t=this.getProperty("centerOffset");null!=t&&(this._centerOffset=e.Utilities.ParseVector3(t)),this.createPhysicsBodyAndShape(e.CharacterController.DEFAULT_CHARACTER_MASS,e.Utilities.GetLayerMask(31),-1)},n.prototype.update=function(){var e=this.getDeltaSeconds();this._minJumpTimer>0&&(this._minJumpTimer-=e,this._minJumpTimer<0&&(this._minJumpTimer=0)),this._slopeAngleDegrees>0?this._maxSlopeTimer+=e:this._maxSlopeTimer=0},n.prototype.fixed=function(){var e,t;if(null!=this.transform){null!=this.transform.physicsBody?this.transform.physicsBody.getLinearVelocityToRef(this._currentVelocity):this._currentVelocity.set(0,0,0),this.m_moveDeltaX=this._targetVelocity.x,this.m_moveDeltaZ=this._targetVelocity.z,Math.abs(this.m_moveDeltaX)<this._minMoveDistance&&(this.m_moveDeltaX>0?this.m_moveDeltaX=this._minMoveDistance:this.m_moveDeltaX<0&&(this.m_moveDeltaX=-this._minMoveDistance)),Math.abs(this.m_moveDeltaZ)<this._minMoveDistance&&(this.m_moveDeltaZ>0?this.m_moveDeltaZ=this._minMoveDistance:this.m_moveDeltaZ<0&&(this.m_moveDeltaZ=-this._minMoveDistance)),this._inputVelocity.set(this.m_moveDeltaX,0,this.m_moveDeltaZ),this.verticalVelocityOffset=0;var n=this.updateGroundedState();this.updateSlopesAndSlides(null===(e=null==n?void 0:n.world)||void 0===e?void 0:e.hasHit,null===(t=null==n?void 0:n.world)||void 0===t?void 0:t.hitNormal),this.onUpdateVelocityObservable&&this.onUpdateVelocityObservable.hasObservers()&&this.onUpdateVelocityObservable.notifyObservers(this.transform),this._inputVelocity.y=!0===this.enableGravity?this._verticalVelocity+this.verticalVelocityOffset+this.downwardForce:this.downwardForce,null!=this.transform.physicsBody?this.transform.physicsBody.setLinearVelocity(this._inputVelocity):console.warn("No physics body attached to character controller transform: "+this.transform.name),this.onUpdatePositionObservable&&this.onUpdatePositionObservable.hasObservers()&&this.onUpdatePositionObservable.notifyObservers(this.transform)}},n.prototype.set=function(e,t,n,o,i,r,a){void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),null!=this.transform&&(null!=this.transform.position&&null!=e&&null!=t&&null!=n&&this.transform.position.set(e,t,n),null!=this.transform.rotationQuaternion&&null!=o&&null!=i&&null!=r&&null!=a&&this.transform.rotationQuaternion.set(o,i,r,a))},n.prototype.move=function(e,t){void 0===t&&(t=!0),null!=e&&this._targetVelocity.copyFrom(e)},n.prototype.jump=function(t){var n;if(this.canJump()&&(this._isGrounded=!1,this._minJumpTimer=e.CharacterController.DEFAULT_JUMPING_TIMER,this._verticalVelocity=t,null===(n=this.transform)||void 0===n?void 0:n.physicsBody)){var o=new BABYLON.Vector3;this.transform.physicsBody.getLinearVelocityToRef(o),o.y=t,this.transform.physicsBody.setLinearVelocity(o)}},n.prototype.turn=function(e){null!=this.transform&&this.transform.addRotation(0,e,0)},n.prototype.rotate=function(e,t,n,o){null!=this.transform&&null!=this.transform.rotationQuaternion&&(this._targetRotation.set(e,t,n,o),this.transform.rotationQuaternion.copyFrom(this._targetRotation))},n.prototype.setRigidBodyMass=function(e){if(null!=this.transform&&null!=this.transform.physicsBody){var t=this.transform.physicsBody.getMassProperties();t.mass=e>=1e-7?e:1e-7,this.transform.physicsBody.setMassProperties(t)}},n.prototype.setCollisionState=function(e){null!=this.transform&&null!=this.transform.physicsBody&&null!=this.transform.physicsBody.shape&&(this.transform.physicsBody.shape.isTrigger=!e)},n.prototype.updateGroundedState=function(){this._groundRaycastOffset.set(0,this._avatarHeight/2,0),this.transform.absolutePosition.addToRef(this._groundRaycastOffset,this._groundRaycastOrigin);var t=.2*this._avatarRadius,n=this._avatarHeight/2+this.raycastLength+e.CharacterController.MIN_GROUND_CHECK_SKINWIDTH;this.isGrounded()&&(n+=this._stepHeight+e.CharacterController.MIN_GROUND_CHECK_DISTANCE),e.Utilities.CalculateDestinationPointToRef(this._groundRaycastOrigin,this._groundRaycastDirection,n,this._groundRaycastDestination),null==this._groundRaycastShape&&(this._groundRaycastShape=new BABYLON.PhysicsShapeSphere(new BABYLON.Vector3(0,0,0),t,this.scene));var o={shape:this._groundRaycastShape,rotation:this.transform.rotationQuaternion,startPosition:this._groundRaycastOrigin,endPosition:this._groundRaycastDestination,ignoreBody:this.transform.physicsBody,shouldHitTriggers:!1};if(null==this._stepCheckRaycastResult&&(this._stepCheckRaycastResult=new BABYLON.PhysicsRaycastResult),null==this._localGroundShapecastResult&&(this._localGroundShapecastResult=new BABYLON.ShapeCastResult),null==this._worldGroundShapecastResult&&(this._worldGroundShapecastResult=new BABYLON.ShapeCastResult),this._stepCheckRaycastResult.reset(),this._localGroundShapecastResult.reset(),this._worldGroundShapecastResult.reset(),e.RigidbodyPhysics.ShapecastToRef(o,this._localGroundShapecastResult,this._worldGroundShapecastResult),this._isGrounded=this._minJumpTimer<=0&&null!=this._worldGroundShapecastResult&&!0===this._worldGroundShapecastResult.hasHit&&null!=this._worldGroundShapecastResult.body,this._isGrounded&&this._verticalVelocity>0&&(this._isGrounded=!1),this._groundCollisionNode=!0===this.isGrounded()&&null!=this._worldGroundShapecastResult.body?this._worldGroundShapecastResult.body.transformNode:null,(1==this.showRaycasts||e.Utilities.ShowDebugColliders())&&(null==this._groundRay&&(this._groundRay=new BABYLON.Ray(this._groundRaycastOrigin,this._groundRaycastDirection,n)),this._groundRay.origin=this._groundRaycastOrigin,this._groundRay.direction=this._groundRaycastDirection,this._groundRay.length=n,null==this._groundRayHelper&&(this._groundRayHelper=new BABYLON.RayHelper(this._groundRay)),this._groundRayHelper.ray=this._groundRay,this._groundRayHelper.show(this.scene,this.isGrounded()?this._hitColor:this._noHitColor),null==this._groundHitPointMesh&&(this._groundHitPointMesh=BABYLON.MeshBuilder.CreateSphere("GroundHitMesh",{diameter:2*t},this.scene),this._groundHitPointMesh.visibility=.5,this._groundHitPointMesh.material=new BABYLON.StandardMaterial("GroundHitMat",this.scene),this._groundHitPointMesh.material.diffuseColor=new BABYLON.Color3(1,0,0)),this.isGrounded()?this._groundHitPointMesh.position.copyFrom(this._worldGroundShapecastResult.hitPoint):this._groundHitPointMesh.position.copyFrom(this._groundRaycastDestination)),!0===this.enableStepOffset){var i=this.transform.absolutePosition,r=3*this._stepHeight;if(this._isSteppingUp=!1,this._stepCheckRaycastHitPoint.copyFrom(i),this._stepCheckRaycastOrigin.copyFrom(i),this._stepCheckRaycastDestination.copyFrom(i),this.isGrounded()&&this._inputVelocity.lengthSquared()>0){var a=this._inputVelocity.clone().normalize(),l=this.transform.position.clone(),s=a.scale(this._avatarRadius+.01);if(this._stepCheckRaycastOrigin.set(l.x+s.x,l.y+(this._stepHeight+this._skinWidth),l.z+s.z),e.Utilities.CalculateDestinationPointToRef(this._stepCheckRaycastOrigin,this._groundRaycastDirection,r,this._stepCheckRaycastDestination),e.RigidbodyPhysics.RaycastToRef(this._stepCheckRaycastOrigin,this._stepCheckRaycastDestination,this._stepCheckRaycastResult),!0===this._stepCheckRaycastResult.hasHit&&null!=this._stepCheckRaycastResult.hitPointWorld){this._stepCheckRaycastHitPoint.copyFrom(this._stepCheckRaycastResult.hitPointWorld);var u=this._stepCheckRaycastResult.hitPointWorld.y-l.y;u>=this._minimumStepHeight&&u<=this._stepHeight&&(this._isSteppingUp=!0,this.verticalVelocityOffset=this._verticalStepSpeed)}}(1==this.showRaycasts||e.Utilities.ShowDebugColliders())&&(null==this._stepCheckRay&&(this._stepCheckRay=new BABYLON.Ray(this._stepCheckRaycastOrigin,this._groundRaycastDirection,r)),this._stepCheckRay.origin=this._stepCheckRaycastOrigin,this._stepCheckRay.direction=this._groundRaycastDirection,this._stepCheckRay.length=r,null==this._stepCheckRayHelper&&(this._stepCheckRayHelper=new BABYLON.RayHelper(this._stepCheckRay)),this._stepCheckRayHelper.ray=this._stepCheckRay,this._stepCheckRayHelper.show(this.scene,!0===this._stepCheckRaycastResult.hasHit?this._hitColor:this._noHitColor),null==this._stepCheckOriginMesh&&(this._stepCheckOriginMesh=BABYLON.MeshBuilder.CreateSphere("StepCheckOriginMesh",{diameter:.05},this.scene),this._stepCheckOriginMesh.visibility=.5,this._stepCheckOriginMesh.material=new BABYLON.StandardMaterial("StepCheckOriginMat",this.scene),this._stepCheckOriginMesh.material.diffuseColor=new BABYLON.Color3(0,0,1)),null==this._stepCheckHitPointMesh&&(this._stepCheckHitPointMesh=BABYLON.MeshBuilder.CreateSphere("StepCheckHitPointMesh",{diameter:.05},this.scene),this._stepCheckHitPointMesh.visibility=.5,this._stepCheckHitPointMesh.material=new BABYLON.StandardMaterial("StepCheckHitPointMat",this.scene),this._stepCheckHitPointMesh.material.diffuseColor=new BABYLON.Color3(0,1,0)),null==this._stepCheckDestinationMesh&&(this._stepCheckDestinationMesh=BABYLON.MeshBuilder.CreateSphere("StepCheckDestinationMesh",{diameter:.05},this.scene),this._stepCheckDestinationMesh.visibility=.5,this._stepCheckDestinationMesh.material=new BABYLON.StandardMaterial("StepCheckDestinationMat",this.scene),this._stepCheckDestinationMesh.material.diffuseColor=new BABYLON.Color3(1,1,1)),this._stepCheckOriginMesh.position.copyFrom(this._stepCheckRaycastOrigin),this._stepCheckHitPointMesh.position.copyFrom(this._stepCheckRaycastHitPoint),this._stepCheckDestinationMesh.position.copyFrom(this._stepCheckRaycastDestination))}return{local:this._localGroundShapecastResult,world:this._worldGroundShapecastResult}},n.prototype.updateSlopesAndSlides=function(t,n){var o=!0;if(this._isSliding=!1,this._slopeAngleRadians=0,this._slopeAngleDegrees=0,this._slopeMoveDirection=0,this.isGrounded()&&(this._verticalVelocity<=-e.CharacterController.DEFAULT_GRAVITY_FORCE&&(this._verticalVelocity=-e.CharacterController.DEFAULT_GRAVITY_FORCE,o=!1),null!=n)){this._slopeAngleRadians=Math.acos(BABYLON.Vector3.Dot(n,BABYLON.Vector3.UpReadOnly)),this._slopeAngleDegrees=BABYLON.Tools.ToDegrees(this._slopeAngleRadians);var i=BABYLON.Vector3.Cross(n,BABYLON.Vector3.UpReadOnly).normalize(),r=BABYLON.Vector3.Cross(i,n).normalize();if(this._slopeMoveDirection=BABYLON.Vector3.Dot(this._currentVelocity.normalize(),r),this._slopeAngleDegrees>=e.CharacterController.MIN_GROUND_CHECK_SLOPEANGLE&&this._slopeAngleDegrees<=this._slopeLimit)this._inputVelocity.length()<=0?this._verticalVelocity<=-e.CharacterController.STATIC_GRAVITY_FORCE&&(this._verticalVelocity=-e.CharacterController.STATIC_GRAVITY_FORCE,o=!1):this._slopeMoveDirection>0?(this._verticalVelocity=-e.CharacterController.UPHILL_GRAVITY_FORCE,o=!1):this._slopeMoveDirection<0&&(this._verticalVelocity=-e.CharacterController.SLOPE_GRAVITY_FORCE,o=!1);else if(this._slopeAngleDegrees>=e.CharacterController.MIN_GROUND_CHECK_SLOPEANGLE&&this._slopeAngleDegrees>this._slopeLimit&&this.canSlide()){var a=new BABYLON.Vector3(0,-1,0),l=BABYLON.Vector3.Cross(BABYLON.Vector3.Cross(n,a),n).normalize().scale(this._slopeSlideSpeed);this._inputVelocity.x=l.x,this._inputVelocity.z=l.z,this._verticalVelocity=l.y,this._isSliding=!0,o=!1}}if(!0===o){var s=this.getDeltaSeconds();this._verticalVelocity-=Math.abs(this.scene.gravity.y)*this._gravityFactor*s,Math.abs(this._verticalVelocity)>e.CharacterController.TERMINAL_VELOCITY&&(this._verticalVelocity=-e.CharacterController.TERMINAL_VELOCITY)}},n.prototype.createPhysicsBodyAndShape=function(t,n,o){var i=this.transform;e.Utilities.ReparentColliders()||i.setParent(null,!0,!0);var r=this._avatarRadius*parseFloat(i.scaling.x.toFixed(4)),a=this._avatarHeight*parseFloat(i.scaling.y.toFixed(4)),l=this.createPhysicsShapeCapsule(r,a);l.filterMembershipMask=n,l.filterCollideMask=o;var s=new BABYLON.Quaternion(0,0,0,1),u=this._centerOffset.x*parseFloat(i.scaling.x.toFixed(4)),c=this._centerOffset.y*parseFloat(i.scaling.y.toFixed(4)),d=this._centerOffset.z*parseFloat(i.scaling.z.toFixed(4)),p=new BABYLON.Vector3(u,c,d),h=new BABYLON.PhysicsShapeContainer(this.scene);h.material={friction:0,staticFriction:0,restitution:0,frictionCombine:0,restitutionCombine:0},h.addChild(l,p,s,new BABYLON.Vector3(1,1,1));var m=new BABYLON.PhysicsBody(i,BABYLON.PhysicsMotionType.DYNAMIC,!1,this.scene);if(m.shape=h,m.setMassProperties({mass:t,centerOfMass:new BABYLON.Vector3(0,0,0),inertia:new BABYLON.Vector3(0,0,0)}),m.setGravityFactor(0),m.setLinearDamping(.1),m.setAngularDamping(.99),m.disablePreStep=!1,!0===this._collisionEvents&&(m.setCollisionCallbackEnabled(!0),m.setCollisionEndedCallbackEnabled(!0)),e.Utilities.ShowDebugColliders()&&console.log("Setup character controller physics collider for: "+i.name,i),!e.Utilities.ShowDebugColliders()){var f=i;null!=f.material&&"CenterBox-Material"===f.material.name&&(f.isVisible=!1)}e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.Debug.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(m))},n.prototype.createPhysicsShapeCapsule=function(e,t){var n=-.5*(t-.5),o=.5*(t-.5);return new BABYLON.PhysicsShapeCapsule(new BABYLON.Vector3(0,n,0),new BABYLON.Vector3(0,o,0),e,this.scene)},n.prototype.createPhysicsShapeCylinder=function(e,t){var n=-.5*t,o=.5*t;return new BABYLON.PhysicsShapeCylinder(new BABYLON.Vector3(0,n,0),new BABYLON.Vector3(0,o,0),e,this.scene)},n.TERMINAL_VELOCITY=55,n.SLOPE_GRAVITY_FORCE=3,n.UPHILL_GRAVITY_FORCE=1,n.STATIC_GRAVITY_FORCE=0,n.DEFAULT_GRAVITY_FORCE=1,n.DEFAULT_JUMPING_TIMER=.1,n.DEFAULT_SLIDING_TIMER=.15,n.DEFAULT_CHARACTER_MASS=85,n.MIN_GROUND_CHECK_DISTANCE=.25,n.MIN_GROUND_CHECK_SKINWIDTH=.001,n.MIN_GROUND_CHECK_SLOPEANGLE=1,n}(e.ScriptComponent);e.CharacterController=t;var n=function(e){function t(t,n,o,i){void 0===o&&(o={}),void 0===i&&(i="TOOLKIT.SimpleCharacterController");var r=e.call(this,t,n,o,i)||this;return r._eulerAngles=new BABYLON.Vector3(0,0,0),r}return i(t,e),t.prototype.start=function(){},t.prototype.set=function(e,t,n,o,i,r,a,l){void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=!0),null!=this.transform&&(null!=this.transform.position&&null!=e&&null!=t&&null!=n&&this.transform.position.set(e,t,n),null!=this.transform.rotationQuaternion&&null!=o&&null!=i&&null!=r&&null!=a&&this.transform.rotationQuaternion.set(o,i,r,a))},t.prototype.move=function(e,t){void 0===t&&(t=!0),null!=e&&null!=this.transform&&this.transform instanceof BABYLON.AbstractMesh&&this.transform.moveWithCollisions(e)},t.prototype.jump=function(e){},t.prototype.turn=function(e){null!=this.transform&&this.transform.addRotation(0,e,0)},t.prototype.rotate=function(e,t,n,o){null!=this.transform&&null!=this.transform.rotationQuaternion&&this.transform.rotationQuaternion.set(e,t,n,o)},t}(e.ScriptComponent);e.SimpleCharacterController=n;var o=function(e){function t(t,n,o,i){void 0===o&&(o={}),void 0===i&&(i="TOOLKIT.RecastCharacterController");var r=e.call(this,t,n,o,i)||this;return r._eulerAngles=new BABYLON.Vector3(0,0,0),r._teleportVector=new BABYLON.Vector3(0,0,0),r._navigationAgent=null,r}return i(t,e),t.prototype.getNavigationAgent=function(){return this._navigationAgent},t.prototype.setNavigationAgent=function(e){this._navigationAgent=e},t.prototype.setDestinationPoint=function(e,t){void 0===t&&(t=!0),null!=this._navigationAgent&&this._navigationAgent.setDestination(e,t)},t.prototype.start=function(){this._navigationAgent=this.getComponent("TOOLKIT.NavigationAgent")},t.prototype.set=function(e,t,n,o,i,r,a,l){void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=!0),null!=this.transform&&null!=this._navigationAgent&&(null!=this.transform.position&&null!=e&&null!=t&&null!=n&&(this._teleportVector.set(e,t,n),this._navigationAgent.teleport(this._teleportVector,l)),null!=this.transform.rotationQuaternion&&null!=o&&null!=i&&null!=r&&null!=a&&this.transform.rotationQuaternion.set(o,i,r,a))},t.prototype.move=function(e,t){void 0===t&&(t=!0),null!=e&&null!=this._navigationAgent&&this._navigationAgent.move(e,t)},t.prototype.jump=function(e){console.warn("Jump is not supported by the navigation mesh character controller.")},t.prototype.turn=function(e){null!=this.transform&&this.transform.addRotation(0,e,0)},t.prototype.rotate=function(e,t,n,o){null!=this.transform&&null!=this.transform.rotationQuaternion&&null!=this._navigationAgent&&this.transform.rotationQuaternion.set(e,t,n,o)},t}(e.ScriptComponent);e.RecastCharacterController=o,e.SceneManager.RegisterClass("TOOLKIT.CharacterController",t),e.SceneManager.RegisterClass("TOOLKIT.SimpleCharacterController",n),e.SceneManager.RegisterClass("TOOLKIT.RecastCharacterController",o)}(o||(o={})),function(e){var t=function(){function t(e){this.chassisBody=null,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=0,this.indexForwardAxis=2,this.indexUpAxis=1,this.minimumWheelContacts=4,this.smoothFlyingImpulse=0,this.stabilizingForce=0,this.maxImpulseForce=0,this.currentVehicleSpeedKmHour=0,this.chassisBody=e.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==e.indexRightAxis?e.indexRightAxis:0,this.indexForwardAxis=void 0!==e.indexForwardAxis?e.indexForwardAxis:2,this.indexUpAxis=void 0!==e.indexUpAxis?e.indexUpAxis:1}return t.prototype.addWheel=function(t){t=t||{};var n=new e.HavokWheelInfo(t),o=this.wheelInfos.length;return this.wheelInfos.push(n),o},t.prototype.getNumWheels=function(){return this.wheelInfos.length},t.prototype.getWheelInfo=function(e){return this.wheelInfos[e]},t.prototype.getSteeringValue=function(e){return this.wheelInfos[e].steering},t.prototype.setSteeringValue=function(e,t){this.wheelInfos[t].steering=e},t.prototype.applyEngineForce=function(e,t){this.wheelInfos[t].engineForce=e},t.prototype.setBrake=function(e,t){this.wheelInfos[t].brake=e},t.prototype.addToWorld=function(e){this.world=e},t.prototype.getVehicleAxisWorld=function(t,n){return n.set(0===t?1:0,1===t?1:0,2===t?1:0),BABYLON.Vector3.TransformCoordinatesToRef(n,e.HavokVehicleUtilities.bodyTransform(this.chassisBody,new BABYLON.Matrix),n),n},t.prototype.getCurrentSpeedKmHour=function(){return this.currentVehicleSpeedKmHour},t.prototype.updateVehicle=function(t){for(var n=this.wheelInfos,o=n.length,i=this.chassisBody,r=0;r<o;r++)this.updateWheelTransform(r);var a=e.HavokVehicleUtilities.bodyLinearVelocity(i,new BABYLON.Vector3),l=BABYLON.Vector3.TransformNormalToRef(a,e.HavokVehicleUtilities.bodyTransform(i,new BABYLON.Matrix).invert(),new BABYLON.Vector3);for(this.currentVehicleSpeedKmHour=3.6*l.z,r=0;r<o;r++)this.castRay2(n[r]);var s=0;for(r=0;r<o;r++)(m=n[r]).raycastResult.body&&s++;0==s&&this.smoothFlyingImpulse,this.updateSuspension(t);var u=new BABYLON.Vector3;for(r=0;r<o;r++){var c=(m=n[r]).suspensionForce;c>m.maxSuspensionForce&&(c=m.maxSuspensionForce),u.copyFrom(m.raycastResult.hitNormalWorld).scaleInPlace(c*t),e.HavokVehicleUtilities.addImpulseAt(i,u,m.raycastResult.hitPointWorld)}this.updateFriction(t),this.stabilizingForce>0&&this.minimumWheelContacts>0&&this.minimumWheelContacts;var d=new BABYLON.Vector3,p=new BABYLON.Vector3,h=new BABYLON.Vector3;for(r=0;r<o;r++){var m=n[r];e.HavokVehicleUtilities.velocityAt(i,m.chassisConnectionPointWorld,h);var f=1;if(1===this.indexUpAxis&&(f=-1),m.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,p);var g=BABYLON.Vector3.Dot(p,m.raycastResult.hitNormalWorld);d.copyFrom(m.raycastResult.hitNormalWorld).scaleInPlace(g),p.subtractToRef(d,p);var y=BABYLON.Vector3.Dot(p,h);m.deltaRotation=f*y*t/m.radius}!m.sliding&&m.isInContact||0===m.engineForce||!m.useCustomSlidingRotationalSpeed||(m.deltaRotation=(m.engineForce>0?1:-1)*m.customSlidingRotationalSpeed*t),!0===m.locked&&(m.deltaRotation=0),m.rotation+=m.deltaRotation,m.deltaRotation*=.99}},t.prototype.updateSuspension=function(t){for(var n=this.chassisBody,o=e.HavokVehicleUtilities.bodyMass(n),i=this.wheelInfos,r=i.length,a=0;a<r;a++){var l=i[a];if(l.isInContact){var s,u=l.suspensionRestLength-l.suspensionLength;s=l.suspensionStiffness*u*l.clippedInvContactDotSuspension;var c=l.suspensionRelativeVelocity;s-=(c<0?l.dampingCompression:l.dampingRelaxation)*c,l.suspensionForce=s*o,l.suspensionForce<0&&(l.suspensionForce=0)}else l.suspensionForce=0}},t.prototype.removeFromWorld=function(e){e.removeBody(this.chassisBody),this.world=null},t.prototype.castRay2=function(t){var n=e.HavokVehicleUtilities.castRay_rayvector,o=e.HavokVehicleUtilities.castRay_target;this.updateWheelTransformWorld(t);var i=this.chassisBody,r=-1,a=t.suspensionRestLength+t.radius;t.directionWorld.scaleToRef(a,n);var l=t.chassisConnectionPointWorld;l.addToRef(n,o);var s=t.raycastResult;if(s.reset(),this.world.raycastToRef(l,o,s),t.raycastResult.groundObject=0,s.body){s.distance=BABYLON.Vector3.Distance(l,s.hitPointWorld),r=s.distance,t.raycastResult.hitNormalWorld.copyFrom(s.hitNormalWorld),t.raycastResult.hitNormal.copyFrom(s.hitNormalWorld),t.isInContact=!0;var u=s.distance;t.suspensionLength=u-t.radius;var c=t.suspensionRestLength-t.maxSuspensionTravel,d=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<c&&(t.suspensionLength=c),t.suspensionLength>d&&(t.suspensionLength=d,t.raycastResult.reset());var p=BABYLON.Vector3.Dot(t.raycastResult.hitNormalWorld,t.directionWorld),h=new BABYLON.Vector3;e.HavokVehicleUtilities.velocityAt(i,t.raycastResult.hitPointWorld,h);var m=BABYLON.Vector3.Dot(t.raycastResult.hitNormalWorld,h);if(p>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var f=-1/p;t.suspensionRelativeVelocity=m*f,t.clippedInvContactDotSuspension=f}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scaleToRef(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return r},t.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var n=this.chassisBody,o=e.HavokVehicleUtilities.bodyTransform(n,new BABYLON.Matrix);BABYLON.Vector3.TransformCoordinatesToRef(t.chassisConnectionPointLocal,o,t.chassisConnectionPointWorld),BABYLON.Vector3.TransformNormalToRef(t.directionLocal,o,t.directionWorld),BABYLON.Vector3.TransformNormalToRef(t.axleLocal,o,t.axleWorld)},t.prototype.updateWheelTransform=function(t){var n=e.HavokVehicleUtilities.tmpVec4,o=e.HavokVehicleUtilities.tmpVec5,i=e.HavokVehicleUtilities.tmpVec6,r=this.wheelInfos[t];this.updateWheelTransformWorld(r),r.directionLocal.scaleToRef(-1,n),o.copyFrom(r.axleLocal),BABYLON.Vector3.CrossToRef(n,o,i),i.normalize(),o.normalize();var a=r.steering,l=new BABYLON.Quaternion;BABYLON.Quaternion.RotationAxisToRef(n,a,l);var s=new BABYLON.Quaternion;BABYLON.Quaternion.RotationAxisToRef(o,r.rotation,s);var u=r.worldTransform.rotationQuaternion;e.HavokVehicleUtilities.bodyOrientation(this.chassisBody,new BABYLON.Quaternion).multiplyToRef(l,u),u.multiplyToRef(s,u),u.normalize();var c=r.worldTransform.position;c.copyFrom(r.directionWorld),c.scaleToRef(r.suspensionLength,c),c.addToRef(r.chassisConnectionPointWorld,c),r.worldTransform.computeWorldMatrix(!0)},t.prototype.getWheelTransformWorld=function(e){return this.wheelInfos[e].worldTransform},t.prototype.updateFriction=function(t){for(var n=e.HavokVehicleUtilities.updateFriction_surfNormalWS_scaled_proj,o=this.wheelInfos,i=o.length,r=this.chassisBody,a=e.HavokVehicleUtilities.updateFriction_forwardWS,l=e.HavokVehicleUtilities.updateFriction_axle,s=0;s<i;s++)h=(C=o[s]).raycastResult.body,C.sideImpulse=0,C.forwardImpulse=0,a[s]||(a[s]=new BABYLON.Vector3),l[s]||(l[s]=new BABYLON.Vector3);for(s=0;s<i;s++)if(h=(C=o[s]).raycastResult.body){var u=l[s],c=this.getWheelTransformWorld(s);BABYLON.Vector3.TransformNormalToRef(e.HavokVehicleUtilities.directions[this.indexRightAxis],c.getWorldMatrix(),u);var d=C.raycastResult.hitNormalWorld,p=BABYLON.Vector3.Dot(u,d);d.scaleToRef(p,n),u.subtractToRef(n,u),u.normalize(),BABYLON.Vector3.CrossToRef(d,u,a[s]),a[s].normalize(),C.sideImpulse=e.HavokVehicleUtilities.resolveSingleBilateral(r,C.raycastResult.hitPointWorld,h,C.raycastResult.hitPointWorld,u),C.sideImpulse*=e.HavokVehicleUtilities.sideFrictionStiffness2}for(this.sliding=!1,s=0;s<i;s++){var h=(C=o[s]).raycastResult.body,m=0;if(C.slipInfo=1,h){var f=C.brake?C.brake:0;m=e.HavokVehicleUtilities.calcRollingFriction(r,h,C.raycastResult.hitPointWorld,a[s],f);var g=f/(m+=C.engineForce*t);C.slipInfo*=g}if(C.forwardImpulse=0,C.skidInfo=1,h){C.skidInfo=1;var y=C.suspensionForce*t*C.frictionSlip,v=y*y;C.forwardImpulse=m;var _=.5*C.forwardImpulse,b=1*C.sideImpulse,B=_*_+b*b;C.sliding=!1,B>v&&(this.sliding=!0,C.sliding=!0,g=y/Math.sqrt(B),C.skidInfo*=g)}}if(this.sliding)for(s=0;s<i;s++)0!==(C=o[s]).sideImpulse&&C.skidInfo<1&&(C.forwardImpulse*=C.skidInfo,C.sideImpulse*=C.skidInfo);for(s=0;s<i;s++){var C=o[s],S=new BABYLON.Vector3;if(C.raycastResult.hitPointWorld.subtractToRef(e.HavokVehicleUtilities.bodyPosition(r,new BABYLON.Vector3),S),0!==C.forwardImpulse){var A=new BABYLON.Vector3;A.copyFrom(a[s]).scaleInPlace(C.forwardImpulse),e.HavokVehicleUtilities.addImpulseAt(r,A,C.raycastResult.hitPointWorld)}if(0!==C.sideImpulse){h=C.raycastResult.body;var T=new BABYLON.Vector3;C.raycastResult.hitPointWorld.subtractToRef(e.HavokVehicleUtilities.bodyPosition(h,new BABYLON.Vector3),T);var O=new BABYLON.Vector3;O.copyFrom(l[s]).scaleInPlace(C.sideImpulse),BABYLON.Vector3.TransformNormalToRef(S,e.HavokVehicleUtilities.bodyTransform(r,new BABYLON.Matrix).invert(),S),S["xyz"[this.indexUpAxis]]*=C.rollInfluence,BABYLON.Vector3.TransformNormalToRef(S,e.HavokVehicleUtilities.bodyTransform(r,new BABYLON.Matrix),S),e.HavokVehicleUtilities.addImpulseAt(r,O,e.HavokVehicleUtilities.bodyPosition(r,new BABYLON.Vector3).add(S)),O.scaleToRef(-1,O),e.HavokVehicleUtilities.addImpulseAt(h,O,C.raycastResult.hitPointWorld)}}},t}();e.HavokRaycastVehicle=t;var n=function(){function t(t){this.maxSuspensionTravel=0,this.customSlidingRotationalSpeed=0,this.useCustomSlidingRotationalSpeed=0,this.sliding=!1,this.visualTravelRange=0,this.invertDirection=!1,this.isInContact=!1,this.hub=null,this.spinner=null,this.defaultFriction=10,this.steeringAngle=0,this.rotationBoost=0,this.locked=!1,t=e.HavokVehicleUtilities.Utilsdefaults(t,{chassisConnectionPointLocal:new BABYLON.Vector3,chassisConnectionPointWorld:new BABYLON.Vector3,directionLocal:new BABYLON.Vector3,directionWorld:new BABYLON.Vector3,axleLocal:new BABYLON.Vector3,axleWorld:new BABYLON.Vector3,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,invertDirection:!1,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointLocal.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionLocal.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleLocal.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.invertDirection=t.invertDirection,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new BABYLON.PhysicsRaycastResult,this.raycastResult.directionWorld=new BABYLON.Vector3,this.worldTransform=new BABYLON.TransformNode(""),this.worldTransform.rotationQuaternion=new BABYLON.Quaternion,this.isInContact=!1}return t.prototype.updateWheel=function(t){var n=this.raycastResult;if(this.isInContact){var o=BABYLON.Vector3.Dot(n.hitNormalWorld,this.raycastResult.directionWorld);n.hitPointWorld.subtractToRef(e.HavokVehicleUtilities.bodyPosition(t,new BABYLON.Vector3),e.HavokVehicleUtilities.relpos),e.HavokVehicleUtilities.velocityAt(t,e.HavokVehicleUtilities.relpos,e.HavokVehicleUtilities.chassis_velocity_at_contactPoint);var i=BABYLON.Vector3.Dot(n.hitNormalWorld,e.HavokVehicleUtilities.chassis_velocity_at_contactPoint);if(o>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var r=-1/o;this.suspensionRelativeVelocity=i*r,this.clippedInvContactDotSuspension=r}}else this.raycastResult.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,n.hitNormalWorld.copyFrom(this.raycastResult.directionWorld).scaleInPlace(-1),this.clippedInvContactDotSuspension=1},t}();e.HavokWheelInfo=n;var o=function(){function t(){}return t.calcRollingFriction=function(t,n,o,i,r){var a=0,l=o,s=e.HavokVehicleUtilities.calcRollingFriction_vel1,u=e.HavokVehicleUtilities.calcRollingFriction_vel2,c=e.HavokVehicleUtilities.calcRollingFriction_vel;return e.HavokVehicleUtilities.velocityAt(t,l,s),e.HavokVehicleUtilities.velocityAt(n,l,u),s.subtractToRef(u,c),r<(a=-BABYLON.Vector3.Dot(i,c)*(1/(e.HavokVehicleUtilities.computeImpulseDenominator(t,o,i)+e.HavokVehicleUtilities.computeImpulseDenominator(n,o,i))))&&(a=r),a<-r&&(a=-r),a},t.computeImpulseDenominator=function(t,n,o){var i=e.HavokVehicleUtilities.computeImpulseDenominator_r0,r=e.HavokVehicleUtilities.computeImpulseDenominator_c0,a=e.HavokVehicleUtilities.computeImpulseDenominator_vec,l=e.HavokVehicleUtilities.computeImpulseDenominator_m;return n.subtractToRef(e.HavokVehicleUtilities.bodyPosition(t,new BABYLON.Vector3),i).normalize(),BABYLON.Vector3.CrossToRef(i,o,r),e.HavokVehicleUtilities.bodyInertiaWorld(t,new BABYLON.Vector3).multiplyToRef(r,l),BABYLON.Vector3.CrossToRef(l,i,a),e.HavokVehicleUtilities.bodyInvMass(t)+BABYLON.Vector3.Dot(o,a)},t.resolveSingleBilateral=function(t,n,o,i,r){if(r.lengthSquared()>1.1)return 0;var a=e.HavokVehicleUtilities.resolveSingleBilateral_vel1,l=e.HavokVehicleUtilities.resolveSingleBilateral_vel2,s=e.HavokVehicleUtilities.resolveSingleBilateral_vel;return e.HavokVehicleUtilities.velocityAt(t,n,a),e.HavokVehicleUtilities.velocityAt(o,i,l),a.subtractToRef(l,s),-.1*BABYLON.Vector3.Dot(r,s)*(1/(e.HavokVehicleUtilities.bodyInvMass(t)+e.HavokVehicleUtilities.bodyInvMass(o)))},t.directions=[new BABYLON.Vector3(1,0,0),new BABYLON.Vector3(0,1,0),new BABYLON.Vector3(0,0,1)],t.calcRollingFriction_vel1=new BABYLON.Vector3,t.calcRollingFriction_vel2=new BABYLON.Vector3,t.calcRollingFriction_vel=new BABYLON.Vector3,t.updateFriction_surfNormalWS_scaled_proj=new BABYLON.Vector3,t.updateFriction_axle=[],t.updateFriction_forwardWS=[],t.sideFrictionStiffness2=1,t.castRay_rayvector=new BABYLON.Vector3,t.castRay_target=new BABYLON.Vector3,t.torque=new BABYLON.Vector3,t.tmpVec1=new BABYLON.Vector3,t.tmpVec2=new BABYLON.Vector3,t.tmpVec3=new BABYLON.Vector3,t.tmpVec4=new BABYLON.Vector3,t.tmpVec5=new BABYLON.Vector3,t.tmpVec6=new BABYLON.Vector3,t.tmpVel2=new BABYLON.Vector3,t.tmpMat1=new BABYLON.Matrix,t.velocityAt=function(t,n,o){return t.getObjectCenterWorldToRef(e.HavokVehicleUtilities.tmpVel2),n.subtractToRef(e.HavokVehicleUtilities.tmpVel2,o),t.getAngularVelocityToRef(e.HavokVehicleUtilities.tmpVel2),BABYLON.Vector3.CrossToRef(e.HavokVehicleUtilities.tmpVel2,o,o),t.getLinearVelocityToRef(e.HavokVehicleUtilities.tmpVel2),o.addInPlace(e.HavokVehicleUtilities.tmpVel2),o},t.bodyPosition=function(e,t){return e.getObjectCenterWorldToRef(t),t},t.bodyLinearVelocity=function(e,t){return e.getLinearVelocityToRef(t),t},t.bodyAngularVelocity=function(e,t){return e.getAngularVelocityToRef(t),t},t.bodyTransform=function(e,t){return t.copyFrom(e.transformNode.getWorldMatrix()),t},t.addImpulseAt=function(e,t,n){e.applyImpulse(t,n)},t.addForceAt=function(e,t,n){e.applyForce(t,n)},t.bodyOrientation=function(e,t){return t.copyFrom(e.transformNode.rotationQuaternion),t},t.bodyMass=function(e){return e.getMassProperties().mass},t.bodyInvMass=function(e){var t=e.getMassProperties().mass;return t>0?1/t:0},t.bodyInertiaWorld=function(e,t){var n=e.getMassProperties();return t.copyFrom(n.inertia),BABYLON.Vector3.TransformNormalToRef(t,e.transformNode.getWorldMatrix(),t),t.x=t.x>0?1/t.x:0,t.y=t.y>0?1/t.y:0,t.z=t.z>0?1/t.z:0,t},t.computeImpulseDenominator_r0=new BABYLON.Vector3,t.computeImpulseDenominator_c0=new BABYLON.Vector3,t.computeImpulseDenominator_vec=new BABYLON.Vector3,t.computeImpulseDenominator_m=new BABYLON.Vector3,t.bodyPositionVec=new BABYLON.Vector3,t.bodyInertiaVec=new BABYLON.Vector3,t.resolveSingleBilateral_vel1=new BABYLON.Vector3,t.resolveSingleBilateral_vel2=new BABYLON.Vector3,t.resolveSingleBilateral_vel=new BABYLON.Vector3,t.chassis_velocity_at_contactPoint=new BABYLON.Vector3,t.relpos=new BABYLON.Vector3,t.Utilsdefaults=function(e,t){for(var n in e=e||{},t)n in e||(e[n]=t[n]);return e},t}();e.HavokVehicleUtilities=o}(o||(o={})),function(e){var t,n=function(t){function n(e,n,o,i){void 0===o&&(o={}),void 0===i&&(i="TOOLKIT.NavigationAgent");var r=t.call(this,e,n,o,i)||this;return r.crowd=null,r.distanceToTarget=0,r.teleporting=!1,r.moveDirection=new BABYLON.Vector3(0,0,0),r.resetPosition=new BABYLON.Vector3(0,0,0),r.lastPosition=new BABYLON.Vector3(0,0,0),r.distancePosition=new BABYLON.Vector3(0,0,0),r.currentPosition=new BABYLON.Vector3(0,0,0),r.currentRotation=new BABYLON.Quaternion(0,0,0,1),r.currentVelocity=new BABYLON.Vector3(0,0,0),r.currentWaypoint=new BABYLON.Vector3(0,0,0),r.heightOffset=0,r.angularSpeed=0,r.updatePosition=!0,r.updateRotation=!0,r.distanceEpsilon=.1,r.velocityEpsilon=1.1,r.offMeshVelocity=1.5,r.stoppingDistance=0,r.onReadyObservable=new BABYLON.Observable,r.onPreUpdateObservable=new BABYLON.Observable,r.onPostUpdateObservable=new BABYLON.Observable,r.onNavCompleteObservable=new BABYLON.Observable,r.m_agentState=0,r.m_agentIndex=-1,r.m_agentReady=!1,r.m_agentGhost=null,r.m_agentParams=null,r.m_agentMovement=new BABYLON.Vector3(0,0,0),r.m_agentDirection=new BABYLON.Vector3(0,0,1),r.m_agentQuaternion=new BABYLON.Quaternion(0,0,0,1),r.m_agentDestination=null,r}return i(n,t),n.prototype.isReady=function(){return this.m_agentReady},n.prototype.isNavigating=function(){return null!=this.m_agentDestination},n.prototype.isTeleporting=function(){return this.teleporting},n.prototype.isOnOffMeshLink=function(){return this.m_agentState===e.CrowdAgentState.DT_CROWDAGENT_STATE_OFFMESH},n.prototype.getAgentType=function(){return this.type},n.prototype.getAgentState=function(){return this.m_agentState},n.prototype.getAgentIndex=function(){return this.m_agentIndex},n.prototype.getAgentOffset=function(){return this.baseOffset},n.prototype.getTargetDistance=function(){return this.distanceToTarget},n.prototype.getCurrentPosition=function(){return this.currentPosition},n.prototype.getCurrentRotation=function(){return this.currentRotation},n.prototype.getCurrentVelocity=function(){return this.currentVelocity},n.prototype.getAgentParameters=function(){return this.m_agentParams},n.prototype.setAgentParameters=function(e){this.m_agentParams=e,this.updateAgentParameters()},n.prototype.awake=function(){this.awakeNavigationAgent()},n.prototype.update=function(){this.updateNavigationAgent()},n.prototype.destroy=function(){this.destroyNavigationAgent()},n.prototype.awakeNavigationAgent=function(){this.type=this.getProperty("type",this.type),this.speed=this.getProperty("speed",this.speed),this.baseOffset=this.getProperty("offset",this.baseOffset),this.angularSpeed=this.getProperty("angularspeed",this.angularSpeed),this.acceleration=this.getProperty("acceleration",this.acceleration),this.stoppingDistance=this.getProperty("stoppingdistance",this.stoppingDistance),this.autoBraking=this.getProperty("autobraking",this.autoBraking),this.avoidRadius=this.getProperty("avoidradius",this.avoidRadius),this.avoidHeight=this.getProperty("avoidheight",this.avoidHeight),this.obstacleAvoidanceType=this.getProperty("avoidquality",this.obstacleAvoidanceType),this.avoidancePriority=this.getProperty("avoidpriority",this.avoidancePriority),this.autoTraverseOffMeshLink=this.getProperty("autotraverse",this.autoTraverseOffMeshLink),this.autoRepath=this.getProperty("autopepath",this.autoRepath),this.areaMask=this.getProperty("areamask",this.areaMask),e.Utilities.ValidateTransformQuaternion(this.transform),this.m_agentGhost=new BABYLON.TransformNode(this.transform.name+".Agent",this.scene),this.m_agentGhost.position=new BABYLON.Vector3(0,0,0),this.m_agentGhost.rotation=new BABYLON.Vector3(0,0,0),e.Utilities.ValidateTransformQuaternion(this.m_agentGhost),this.m_agentGhost.position.copyFrom(this.transform.position),this.lastPosition.copyFrom(this.transform.position)},n.prototype.updateNavigationAgent=function(){if(null==this.crowd){var t=e.SceneManager.GetNavigationTools();if(null==t||null==t.navMesh)return;!0===e.NavigationAgent.GLOBAL_CROWD_INSTANCE?this.crowd=e.SceneManager.GetCrowdInterface(this.scene):this.crowd=t.createCrowd(e.SceneManager.MAX_AGENT_COUNT,e.SceneManager.MAX_AGENT_RADIUS,this.scene)}if(null!=this.crowd){if(this.m_agentIndex<0)return this.m_agentParams={radius:this.avoidRadius,height:this.avoidHeight,maxSpeed:this.speed,maxAcceleration:this.acceleration},e.Utilities.GetAbsolutePositionToRef(this.transform,this.resetPosition),this.m_agentIndex=this.crowd.addAgent(this.resetPosition,this.m_agentParams,this.m_agentGhost),void(this.m_agentIndex>=0&&(this.m_agentReady=!0,this.onReadyObservable&&this.onReadyObservable.hasObservers()&&this.onReadyObservable.notifyObservers(this.transform)));if(this.m_agentState=this.crowd.getAgentState(this.m_agentIndex),this.getAgentWaypointToRef(this.currentWaypoint),this.getAgentPositionToRef(this.currentPosition),this.distancePosition.copyFrom(this.currentPosition),this.isOnOffMeshLink()?(this.currentPosition.subtractToRef(this.lastPosition,this.currentVelocity),this.currentVelocity.scaleInPlace(this.speed*this.offMeshVelocity)):this.getAgentVelocityToRef(this.currentVelocity),this.onPreUpdateObservable&&this.onPreUpdateObservable.hasObservers()&&this.onPreUpdateObservable.notifyObservers(this.transform),this.currentPosition.y+=this.baseOffset+this.heightOffset,this.currentVelocity.length()>=this.velocityEpsilon){this.currentVelocity.normalize();var n=this.angularSpeed*e.NavigationAgent.ANGULAR_SPEED_RATIO*this.getDeltaSeconds();if(this.isOnOffMeshLink()){this.moveDirection.copyFrom(this.m_agentDirection),this.m_agentDirection.set(this.moveDirection.x+(this.currentVelocity.x-this.moveDirection.x),this.moveDirection.y+(this.currentVelocity.y-this.moveDirection.y),this.moveDirection.z+(this.currentVelocity.z-this.moveDirection.z)),this.m_agentDirection.normalize();var o=e.NavigationAgent.TARGET_ANGLE_FACTOR-Math.atan2(this.m_agentDirection.x,this.m_agentDirection.z);BABYLON.Quaternion.FromEulerAnglesToRef(0,o,0,this.currentRotation),this.isNavigating()&&!0===this.updateRotation&&BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.currentRotation,n,this.transform.rotationQuaternion)}else this.m_agentQuaternion.copyFrom(this.transform.rotationQuaternion),this.isNavigating()&&!0===this.updateRotation&&this.transform.lookAt(this.currentWaypoint),this.transform.rotationQuaternion.toEulerAnglesToRef(this.m_agentDirection),BABYLON.Quaternion.FromEulerAnglesToRef(0,this.m_agentDirection.y,0,this.currentRotation),this.isNavigating()&&!0===this.updateRotation&&BABYLON.Quaternion.SlerpToRef(this.m_agentQuaternion,this.currentRotation,n,this.transform.rotationQuaternion)}this.isNavigating()&&!0===this.updatePosition&&this.transform.position.copyFrom(this.currentPosition),this.isNavigating()?(this.distanceToTarget=BABYLON.Vector3.Distance(this.distancePosition,this.m_agentDestination),this.distanceToTarget<=Math.max(this.distanceEpsilon,this.stoppingDistance)&&(this.cancelNavigation(),this.onNavCompleteObservable&&this.onNavCompleteObservable.hasObservers()&&this.onNavCompleteObservable.notifyObservers(this.transform))):this.distanceToTarget=0,this.lastPosition.copyFrom(this.currentPosition),this.onPostUpdateObservable&&this.onPostUpdateObservable.hasObservers()&&this.onPostUpdateObservable.notifyObservers(this.transform),this.teleporting=!1}},n.prototype.updateAgentParameters=function(){null!=this.crowd&&this.m_agentIndex>=0&&this.crowd.updateAgentParameters(this.m_agentIndex,this.m_agentParams)},n.prototype.destroyNavigationAgent=function(){this.m_agentIndex=-1,this.m_agentReady=!1,this.m_agentMovement=null,this.m_agentDirection=null,this.m_agentDestination=null,this.moveDirection=null,this.resetPosition=null,this.lastPosition=null,this.currentPosition=null,this.currentRotation=null,this.currentVelocity=null,this.currentWaypoint=null,this.onReadyObservable.clear(),this.onReadyObservable=null,this.onPreUpdateObservable.clear(),this.onPreUpdateObservable=null,this.onPostUpdateObservable.clear(),this.onPostUpdateObservable=null,this.onNavCompleteObservable.clear(),this.onNavCompleteObservable=null,null!=this.m_agentGhost&&(this.m_agentGhost.dispose(),this.m_agentGhost=null)},n.prototype.move=function(t,n){void 0===n&&(n=!0);var o=e.SceneManager.GetNavigationTools();null!=o&&null!=this.crowd?(this.crowd.getAgentPosition(this.m_agentIndex).addToRef(t,this.m_agentMovement),this.m_agentDestination=!0===n?o.getClosestPoint(this.m_agentMovement):this.m_agentMovement.clone(),this.m_agentIndex>=0&&this.crowd.agentGoto(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.teleport=function(t,n){void 0===n&&(n=!0);var o=e.SceneManager.GetNavigationTools();null!=o&&null!=this.crowd?(this.teleporting=!0,this.m_agentDestination=!0===n?o.getClosestPoint(t):t.clone(),this.m_agentIndex>=0&&this.crowd.agentTeleport(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.setDestination=function(t,n){void 0===n&&(n=!0);var o=e.SceneManager.GetNavigationTools();null!=o&&null!=this.crowd?(this.m_agentDestination=!0===n?o.getClosestPoint(t):t.clone(),this.m_agentIndex>=0&&this.crowd.agentGoto(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.setAcceleration=function(e){null!=this.m_agentParams&&(this.acceleration=e,this.m_agentParams.maxAcceleration=this.acceleration,this.updateAgentParameters())},n.prototype.setMovementSpeed=function(e){null!=this.m_agentParams&&(this.speed=e,this.m_agentParams.maxSpeed=this.speed,this.updateAgentParameters())},n.prototype.setSeparationWeight=function(e){null!=this.m_agentParams&&(this.m_agentParams.separationWeight=e,this.updateAgentParameters())},n.prototype.setOptimizationRange=function(e){null!=this.m_agentParams&&(this.m_agentParams.pathOptimizationRange=e,this.updateAgentParameters())},n.prototype.setCollisionQueryRange=function(e){null!=this.m_agentParams&&(this.m_agentParams.collisionQueryRange=e,this.updateAgentParameters())},n.prototype.setAgentRadius=function(e){null!=this.m_agentParams&&(this.m_agentParams.radius=e,this.updateAgentParameters())},n.prototype.setAgentHeight=function(e){null!=this.m_agentParams&&(this.m_agentParams.height=e,this.updateAgentParameters())},n.prototype.getAgentVelocity=function(){return null!=this.crowd&&this.m_agentIndex>=0?this.crowd.getAgentVelocity(this.m_agentIndex):null},n.prototype.getAgentVelocityToRef=function(e){null!=this.crowd&&this.m_agentIndex>=0&&this.crowd.getAgentVelocityToRef(this.m_agentIndex,e)},n.prototype.getAgentPosition=function(){return null!=this.crowd&&this.m_agentIndex>=0?this.crowd.getAgentPosition(this.m_agentIndex):null},n.prototype.getAgentPositionToRef=function(e){null!=this.crowd&&this.m_agentIndex>=0&&this.crowd.getAgentPositionToRef(this.m_agentIndex,e)},n.prototype.getAgentWaypoint=function(){return null!=this.crowd&&this.m_agentIndex>=0?this.crowd.getAgentNextTargetPath(this.m_agentIndex):null},n.prototype.getAgentWaypointToRef=function(e){null!=this.crowd&&this.m_agentIndex>=0&&this.crowd.getAgentNextTargetPathToRef(this.m_agentIndex,e)},n.prototype.cancelNavigation=function(){this.m_agentDestination=null;var e=this.getAgentPosition();null!=e&&null!=this.crowd&&this.m_agentIndex>=0&&this.crowd.agentTeleport(this.m_agentIndex,e)},n.TARGET_ANGLE_FACTOR=.5*Math.PI,n.ANGULAR_SPEED_RATIO=.05,n.GLOBAL_CROWD_INSTANCE=!1,n}(e.ScriptComponent);e.NavigationAgent=n,(t=e.CrowdAgentState||(e.CrowdAgentState={}))[t.DT_CROWDAGENT_STATE_INVALID=0]="DT_CROWDAGENT_STATE_INVALID",t[t.DT_CROWDAGENT_STATE_WALKING=1]="DT_CROWDAGENT_STATE_WALKING",t[t.DT_CROWDAGENT_STATE_OFFMESH=2]="DT_CROWDAGENT_STATE_OFFMESH",e.SceneManager.RegisterClass("TOOLKIT.NavigationAgent",n)}(o||(o={})),function(e){var t=function(){function t(t,n,o){this._centerMass=new BABYLON.Vector3(0,0,0),this._chassisMesh=null,this._tempVectorPos=new BABYLON.Vector3(0,0,0),this.lockedWheelIndexes=null,this.m_vehicleColliders=null,this.m_vehicle=null,this.m_scene=null,this._chassisMesh=n,this._centerMass=o,this.m_vehicleColliders=null!=this._chassisMesh.metadata&&null!=this._chassisMesh.metadata.toolkit&&null!=this._chassisMesh.metadata.toolkit.wheels?this._chassisMesh.metadata.toolkit.wheels:null,this.m_vehicle=new e.HavokRaycastVehicle({chassisBody:this._chassisMesh.physicsBody}),this.m_scene=t,this.setupWheelInformation();var i=this.m_scene.getPhysicsEngine();null!=i&&this.m_vehicle.addToWorld(i)}return t.prototype.getNumWheels=function(){if(null!=this.m_vehicle)return this.m_vehicle.getNumWheels()},t.prototype.getWheelInfo=function(e){if(null!=this.m_vehicle)return this.m_vehicle.getWheelInfo(e)},t.prototype.setEngineForce=function(e,t){null!=this.m_vehicle&&this.m_vehicle.applyEngineForce(-e,t)},t.prototype.setBrakingForce=function(e,t){null!=this.m_vehicle&&this.m_vehicle.setBrake(e,t)},t.prototype.getWheelTransform=function(e){if(null!=this.m_vehicle)return this.m_vehicle.getWheelTransformWorld(e)},t.prototype.updateWheelTransform=function(e){null!=this.m_vehicle&&this.m_vehicle.updateWheelTransform(e)},t.prototype.getRawCurrentSpeedKph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()},t.prototype.getRawCurrentSpeedMph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()*e.System.Kph2Mph},t.prototype.getAbsCurrentSpeedKph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())},t.prototype.getAbsCurrentSpeedMph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())*e.System.Kph2Mph},t.prototype.dispose=function(){this.deleteWheelInformation(),this.m_vehicleColliders=null},t.prototype.getWheelIndexByID=function(e){var t=-1;if(null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0)for(var n=0;n<this.m_vehicleColliders.length;n++){var o=this.m_vehicleColliders[n];if(e.toLowerCase()===o.id.toLowerCase()){t=n;break}}return t},t.prototype.getWheelIndexByName=function(e){var t=-1;if(null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0)for(var n=0;n<this.m_vehicleColliders.length;n++){var o=this.m_vehicleColliders[n];if(e.toLowerCase()===o.name.toLowerCase()){t=n;break}}return t},t.prototype.getWheelColliderInfo=function(e){var t=-1;return null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0&&this.m_vehicleColliders.length>e&&(t=this.m_vehicleColliders[e]),t},t.prototype.getVisualSteeringAngle=function(e){var t=0,n=this.getWheelInfo(e);return null!=n&&null!=n.steeringAngle&&(t=n.steeringAngle),t},t.prototype.setVisualSteeringAngle=function(e,t){var n=this.getWheelInfo(t);null!=n&&(n.steeringAngle=e)},t.prototype.getPhysicsSteeringAngle=function(e){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getSteeringValue(e))},t.prototype.setPhysicsSteeringAngle=function(e,t){null!=this.m_vehicle&&this.m_vehicle.setSteeringValue(e,t)},t.prototype.getStabilizingForce=function(){var e=-1;return null!=this.m_vehicle&&null!=this.m_vehicle.chassisBody&&(e=this.m_vehicle.stabilizingForce),e},t.prototype.setStabilizingForce=function(e){null!=this.m_vehicle&&null!=this.m_vehicle.chassisBody&&(this.m_vehicle.stabilizingForce=e)},t.prototype.getSmoothFlyingImpulse=function(){var e=-1;return null!=this.m_vehicle&&(e=this.m_vehicle.smoothFlyingImpulse),e},t.prototype.setSmoothFlyingImpulse=function(e){null!=this.m_vehicle&&(this.m_vehicle.smoothFlyingImpulse=e)},t.prototype.setupWheelInformation=function(){if(null!=this.m_vehicle&&null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0){var e=-1,t=0,n=!1,o=0;for(e=0;e<this.m_vehicleColliders.length;e++){var i=this.m_vehicleColliders[e],r=null!=i.name?i.name:"Unknown",a=null!=i.radius?i.radius:.35,l=null!=i.position&&i.position.length>=3?i.position[0]:1,s=null!=i.position&&i.position.length>=3?i.position[2]:-1,u=null!=i.wheelconnectionpoint?i.wheelconnectionpoint:.5,c=null!=i.suspensionrestlength?i.suspensionrestlength:.3,d=null!=i.frontwheel||r.toLowerCase().indexOf("front")>=0,p=s,h=l,m=-this._centerMass.x,f=-this._centerMass.z;t=null!=i.frictionslip?i.frictionslip:10;var g=null!=i.totalsuspensionforces?i.totalsuspensionforces:1e5,y=null!=i.suspensiontravelcm?i.suspensiontravelcm:100,v=null!=i.rollinfluence?i.rollinfluence:.2,_=null!=i.suspensionstiffness?i.suspensionstiffness:50,b=null!=i.dampingcompression?i.dampingcompression:2.5,B=null!=i.dampingrelaxation?i.dampingrelaxation:4.5,C=new BABYLON.Vector3(h+m,u,p+f);o=null!=i.maxVisualTravelRange?i.maxVisualTravelRange:0,n=null!=i.invertWheelDirection&&i.invertWheelDirection,this.m_vehicle.addWheel({radius:a,isFrontWheel:d,directionLocal:new BABYLON.Vector3(0,-1,0),suspensionStiffness:_,suspensionRestLength:c,frictionSlip:t,dampingRelaxation:B,dampingCompression:b,maxSuspensionForce:g,rollInfluence:v,axleLocal:new BABYLON.Vector3(-1,0,0),chassisConnectionPointLocal:C,maxSuspensionTravel:y,steeringAngle:0,rotationBoost:0,defaultFriction:t,invertDirection:n,visualTravelRange:o})}}},t.prototype.tickVehicleController=function(e){null!=this.m_vehicle&&this.m_vehicle.updateVehicle(e)},t.prototype.updateWheelInformation=function(){var t=this.m_vehicle.getCurrentSpeedKmHour(),n=this.getNumWheels();if(n>0)for(var o=0;o<n;o++){var i=this.getWheelInfo(o);if(null!=i){i.locked=this.lockedWheelInformation(o),this.updateWheelTransform(o);var r=this.getWheelTransform(o);if(null!=r&&this._tempVectorPos.copyFrom(r.position),null!=i.hub){var a=i.hub;if(null!=a.parent){e.Utilities.InverseTransformPointToRef(a.parent,this._tempVectorPos,this._tempVectorPos),a.position.y=this._tempVectorPos.y,i.visualTravelRange>0&&(a.position.y=BABYLON.Scalar.Clamp(a.position.y,-Math.abs(i.visualTravelRange),Math.abs(i.visualTravelRange)));var l=null!=i.steeringAngle?i.steeringAngle:0;if(BABYLON.Quaternion.FromEulerAnglesToRef(0,l,0,a.rotationQuaternion),null!=i.spinner&&!1===i.locked){var s=t*(this.m_scene.getEngine().getDeltaTime()/1e3)/(2*Math.PI*i.radius)*360,u=null!=i.rotationBoost?i.rotationBoost:0,c=BABYLON.Tools.ToRadians(s)+u*Math.sign(t);!0===i.invertDirection?i.spinner.addRotation(-c,0,0):i.spinner.addRotation(c,0,0)}}}}}},t.prototype.lockedWheelInformation=function(e){var t=!1;if(null!=this.lockedWheelIndexes&&this.lockedWheelIndexes.length>0)for(var n=0;n<this.lockedWheelIndexes.length;n++)if(this.lockedWheelIndexes[n]===e){t=!0;break}return t},t.prototype.deleteWheelInformation=function(){var e=this.getNumWheels();if(e>0)for(var t=0;t<e;t++){var n=this.getWheelInfo(t);null!=n&&(n.hub=null,n.spinner=null,n.steeringAngle=0,n.rotationBoost=0,n.defaultFriction=0)}},t}();e.RaycastVehicle=t}(o||(o={})),function(e){var t=function(t){function n(e,n,o,i){void 0===o&&(o={}),void 0===i&&(i="TOOLKIT.RigidbodyPhysics");var r=t.call(this,e,n,o,i)||this;return r._isKinematic=!1,r._centerOfMass=new BABYLON.Vector3(0,0,0),r.m_raycastVehicle=null,r}return i(n,t),n.prototype.awake=function(){this.awakeRigidbodyState()},n.prototype.update=function(){this.updateRigidbodyState()},n.prototype.late=function(){this.lateRigidbodyState()},n.prototype.destroy=function(){this.destroyRigidbodyState()},n.prototype.awakeRigidbodyState=function(){this._isKinematic=this.getProperty("isKinematic",this._isKinematic),null!=this.transform.metadata&&null!=this.transform.metadata.toolkit&&null!=this.transform.metadata.toolkit.physics&&(this._centerOfMass=null!=this.transform.metadata.toolkit.physics.center?e.Utilities.ParseVector3(this.transform.metadata.toolkit.physics.center,this._centerOfMass):this._centerOfMass),this.hasWheelColliders()&&(this.m_raycastVehicle=new e.RaycastVehicle(this.scene,this.transform,this._centerOfMass),e.Utilities.ShowDebugColliders()&&console.log("Raycase Vehicle Created For: "+this.transform.name))},n.prototype.updateRigidbodyState=function(){null!=this.m_raycastVehicle&&this.m_raycastVehicle.updateWheelInformation()},n.prototype.lateRigidbodyState=function(){null!=this.m_raycastVehicle&&this.m_raycastVehicle.tickVehicleController(e.RigidbodyPhysics.PHYSICS_STEP_TIME)},n.prototype.destroyRigidbodyState=function(){null!=this.m_raycastVehicle&&(this.m_raycastVehicle.dispose(),this.m_raycastVehicle=null)},n.prototype.isKinematic=function(){return this._isKinematic},n.prototype.hasWheelColliders=function(){return null!=this.transform.metadata&&null!=this.transform.metadata.toolkit&&null!=this.transform.metadata.toolkit.wheels},n.prototype.getRaycastVehicle=function(){return this.m_raycastVehicle},n.GetHavokInstance=function(){return globalThis.HK},n.Raycast=function(t,n,o,i){return null==e.RigidbodyPhysics.RaycastResult&&(e.RigidbodyPhysics.RaycastResult=new BABYLON.PhysicsRaycastResult),null==e.RigidbodyPhysics.RaycastDestination&&(e.RigidbodyPhysics.RaycastDestination=new BABYLON.Vector3(0,0,0)),e.RigidbodyPhysics.RaycastResult.reset(),e.RigidbodyPhysics.RaycastDestination.set(0,0,0),e.Utilities.CalculateDestinationPointToRef(t,n,o,e.RigidbodyPhysics.RaycastDestination),e.RigidbodyPhysics.RaycastToRef(t,e.RigidbodyPhysics.RaycastDestination,e.RigidbodyPhysics.RaycastResult,i),e.RigidbodyPhysics.RaycastResult},n.Shapecast=function(t){return null==e.RigidbodyPhysics.LocalShapeResult&&(e.RigidbodyPhysics.LocalShapeResult=new BABYLON.ShapeCastResult),null==e.RigidbodyPhysics.WorldShapeResult&&(e.RigidbodyPhysics.WorldShapeResult=new BABYLON.ShapeCastResult),e.RigidbodyPhysics.LocalShapeResult.reset(),e.RigidbodyPhysics.WorldShapeResult.reset(),e.RigidbodyPhysics.ShapecastToRef(t,e.RigidbodyPhysics.LocalShapeResult,e.RigidbodyPhysics.WorldShapeResult),{local:e.RigidbodyPhysics.LocalShapeResult,world:e.RigidbodyPhysics.WorldShapeResult}},n.RaycastToRef=function(t,n,o,i){var r=e.Utilities.GetHavokPlugin();r?r.raycast(t,n,o,i):BABYLON.Tools.Warn("Havok.js physics library not loaded")},n.ShapecastToRef=function(t,n,o){var i=e.Utilities.GetHavokPlugin();i?i.shapeCast(t,n,o):BABYLON.Tools.Warn("Havok.js physics library not loaded")},n.SetMaxVelocities=function(t,n){var o=e.Utilities.GetHavokPlugin();if(o){var i=o._hknp.HEAP8.buffer,r=new Int32Array(i,Number(o.world),100),a=new Int32Array(i,r[8],500),l=new Int32Array(i,a[428],100),s=new Float32Array(i,l[8],300);s[32]=t,s[33]=n,s[60]=t,s[61]=n,s[88]=t,s[89]=n,s[144]=t,s[145]=n,s[172]=t,s[173]=n,s[200]=t,s[201]=n,s[228]=t}else BABYLON.Tools.Warn("Havok.js physics library not loaded")},n.ConfigurePhysicsEngine=function(t){return r(this,arguments,void 0,function(t,n,o,i,r,l,s){var u,c,d,p,h,m,f;return void 0===n&&(n=!0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===r&&(r=!0),void 0===l&&(l=1e-4),void 0===s&&(s=null),a(this,function(i){switch(i.label){case 0:if(!BABYLON.HavokPlugin)return[3,7];BABYLON.Tools.Log("Havok.js physics engine initializing..."),i.label=1;case 1:return i.trys.push([1,5,6,7]),t.isPhysicsEnabled()?[3,4]:null!=(u=e.RigidbodyPhysics.GetHavokInstance())?[3,3]:(c=globalThis,[4,BABYLON.HavokPhysics()]);case 2:c.HK=i.sent(),u=globalThis.HK,i.label=3;case 3:return d=new BABYLON.Vector3(0,-9.81,0),p=null!=s?s:d,globalThis.HKP=new BABYLON.HavokPlugin(!n,u),t.enablePhysics(p,globalThis.HKP),[3,4];case 4:return[3,7];case 5:return h=i.sent(),console.warn(h),[3,7];case 6:e.RigidbodyPhysics.PhysicsShapeCache={},e.RigidbodyPhysics.NewPhysicsShapeCount=0,e.RigidbodyPhysics.CachedPhysicsShapeCount=0;try{null===(f=t.getPhysicsEngine())||void 0===f||f.setSubTimeStep(o),BABYLON.Tools.Log("Havok.js initialized with sub time step: "+o),m=e.RigidbodyPhysics.GetPhysicsHeapSize(),BABYLON.Tools.Log("Havok.js initialized with a heap size of "+m+" MB")}catch(e){console.warn(e)}try{null!=e.RigidbodyPhysics.OnSetupPhysicsPlugin&&e.RigidbodyPhysics.OnSetupPhysicsPlugin(t)}catch(e){console.warn(e)}return[7];case 7:return[2]}})})},n.SetupPhysicsComponent=function(t,n){var o=null!=n.metadata&&null!=n.metadata.toolkit?n.metadata.toolkit:null,i=null!=o.layermask?o.layermask:-1;if(null!=o&&(null!=o.physics||null!=o.collision)){var r=null!=o.physics,a=null!=o.physics&&null!=o.physics.filter?o.physics.filter:-1,l=null!=o.physics&&null!=o.physics.vehicle&&o.physics.vehicle,s=null!=o.physics&&null!=o.physics.root&&o.physics.root,u=null!=o.collision&&null!=o.collision.compoundcolliders,c=null!=o.physics&&null!=o.physics.mass?o.physics.mass:0,d=null!=o.physics&&null!=o.physics.center?o.physics.center:{x:0,y:0,z:0},p=null==o.physics||null==o.physics.kinematic||o.physics.kinematic,h=null==o.physics||null==o.physics.truestatic||o.physics.truestatic,m=BABYLON.PhysicsMotionType.DYNAMIC;if(m=!0===h?BABYLON.PhysicsMotionType.STATIC:!0===p?BABYLON.PhysicsMotionType.ANIMATED:BABYLON.PhysicsMotionType.DYNAMIC,!0===r){if(l){var f=null,g=n.getChildren(null,!1);null!=g&&g.length>0&&g.forEach(function(t){if(null!=t.metadata&&null!=t.metadata.toolkit&&null!=t.metadata.toolkit.collision){var o=t.metadata.toolkit.collision,i=null!=o.wheelinformation?o.wheelinformation:null;null!=i&&(e.Utilities.ShowDebugColliders()&&console.log("Setup raycast wheel collider: "+t.name+" --\x3e on to: "+n.name,n),null==f&&(f=[]),f.push(i))}}),null!=f&&f.length>0&&(null==n.metadata&&(n.metadata={}),null==n.metadata.toolkit&&(n.metadata.toolkit={}),n.metadata.toolkit.wheels=f)}if(u){var y=o.collision.compoundcolliders;if(null!=y&&y.length>0){var v=0,_=0,b=0,B=!1,C=[];if(y.forEach(function(o){if(null!=o){var r=null!=o.type?o.type:"BoxCollider",l=null!=o.restitutioncombine?e.RigidbodyPhysics.GetPhysicsMaterialCombine(o.restitutioncombine):0,s=null!=o.frictioncombine?e.RigidbodyPhysics.GetPhysicsMaterialCombine(o.frictioncombine):0,u=null!=o.dynamicfriction?o.dynamicfriction:.6,c=null!=o.staticfriction?o.staticfriction:.6,d=null!=o.restitution?o.restitution:0,p=null!=o.trigger&&o.trigger;u>v&&(v=u),c>_&&(_=c),d>b&&(b=d),1==p&&(B=!0);var h=e.RigidbodyPhysics.BoxImpostor;h="MeshCollider"===r?e.RigidbodyPhysics.ConvexHullImpostor:"CapsuleCollider"===r?e.RigidbodyPhysics.CapsuleImpostor:"SphereCollider"===r?e.RigidbodyPhysics.SphereImpostor:e.RigidbodyPhysics.BoxImpostor;var m=o,f=null!=m.center?m.center:{x:0,y:0,z:0},g=null!=m.persist&&m.persist,y=new e.PhyscisContainerData;e.Utilities.ShowDebugColliders()&&console.log("Setup simple compound child collider type ("+r+") --\x3e on to: "+n.name,n),e.RigidbodyPhysics.CreateCompoundPhysicsShapeAndBody(t,n,n,m,h,c,u,d,s,l,C,y,f,!1,p,g,i,a)}}),C.length>0){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var S=new BABYLON.Vector3(d.x,d.y,d.z),A=new BABYLON.PhysicsShapeContainer(t);C.forEach(function(e){A.addChild(e.shape,e.translation,e.rotation,e.scale)}),A.material=C[0].shape.material;var T=new BABYLON.PhysicsBody(n,m,!1,t);T.shape=A,e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,B,o.physics,c,S),e.Utilities.ShowDebugColliders()||null!=(R=n).material&&"CenterBox-Material"===R.material.name&&(R.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.Debug.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(T))}}}else if(s){var O=0,I=0,M=0,L=!1,x=[],w=null!=o.physics&&null!=o.physics.center?e.Utilities.ParseVector3(o.physics.center,BABYLON.Vector3.Zero()):BABYLON.Vector3.Zero(),P=n.getChildren(null,!0);null!=P&&P.length>0&&P.forEach(function(e){e.position.subtractInPlace(w)});var N=n.getChildren(null,!1);if(null!=N&&N.length>0&&N.forEach(function(o){if(null!=o.metadata&&null!=o.metadata.toolkit&&null!=o.metadata.toolkit.collision){var r=o.metadata.toolkit.collision,l=null!=r.restitutioncombine?e.RigidbodyPhysics.GetPhysicsMaterialCombine(r.restitutioncombine):0,u=null!=r.frictioncombine?e.RigidbodyPhysics.GetPhysicsMaterialCombine(r.frictioncombine):0,c=null!=r.dynamicfriction?r.dynamicfriction:.6,d=null!=r.staticfriction?r.staticfriction:.6,p=null!=r.restitution?r.restitution:0,h=null!=r.trigger&&r.trigger,m=null!=r.type?r.type:"BoxCollider";c>O&&(O=c),d>I&&(I=d),p>M&&(M=p),1==h&&(L=!0);var f=e.RigidbodyPhysics.BoxImpostor;f="MeshCollider"===m?e.RigidbodyPhysics.ConvexHullImpostor:"CapsuleCollider"===m?e.RigidbodyPhysics.CapsuleImpostor:"SphereCollider"===m?e.RigidbodyPhysics.SphereImpostor:e.RigidbodyPhysics.BoxImpostor;var g=r,y=null!=g.center?g.center:{x:0,y:0,z:0},v=null!=g.persist&&g.persist,_=new e.PhyscisContainerData;e.Utilities.ShowDebugColliders()&&console.log("Setup complex compound child collider type ("+m+") --\x3e on to: "+n.name,n),e.RigidbodyPhysics.CreateCompoundPhysicsShapeAndBody(t,n,o,g,f,d,c,p,u,l,x,_,y,s,h,v,i,a)}}),x.length>0){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0),S=new BABYLON.Vector3(d.x,d.y,d.z);var k=new BABYLON.PhysicsShapeContainer(t);k.material=x[0].shape.material,x.forEach(function(e){k.addChild(e.shape,e.translation,e.rotation,e.scale)});var R,D=new BABYLON.PhysicsBody(n,m,!1,t);D.shape=k,e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,L,o.physics,c,S),e.Utilities.ShowDebugColliders()||null!=(R=n).material&&"CenterBox-Material"===R.material.name&&(R.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.Debug.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(D))}}else if(null!=o.collision){var E=null!=o.collision.type?o.collision.type:"BoxCollider",V=null!=o.collision.convexmesh&&o.collision.convexmesh,U=null!=o.collision.restitutioncombine?e.RigidbodyPhysics.GetPhysicsMaterialCombine(o.collision.restitutioncombine):0,F=null!=o.collision.frictioncombine?e.RigidbodyPhysics.GetPhysicsMaterialCombine(o.collision.frictioncombine):0,Y=null!=o.collision.dynamicfriction?o.collision.dynamicfriction:.6,G=null!=o.collision.staticfriction?o.collision.staticfriction:.6,H=null!=o.collision.restitution?o.collision.restitution:0,z=null!=o.collision.terraindata?o.collision.terraindata:null,W=null!=o.collision.trigger&&o.collision.trigger,Q=null!=o.collision.persist&&o.collision.persist,X=e.RigidbodyPhysics.BoxImpostor;X="MeshCollider"===E?!0===V?e.RigidbodyPhysics.ConvexHullImpostor:e.RigidbodyPhysics.MeshImpostor:"TerrainCollider"===E?e.RigidbodyPhysics.HeightmapImpostor:"CapsuleCollider"===E?e.RigidbodyPhysics.CapsuleImpostor:"SphereCollider"===E?e.RigidbodyPhysics.SphereImpostor:e.RigidbodyPhysics.BoxImpostor,e.RigidbodyPhysics.CreateStandardPhysicsShapeAndBody(t,n,o,X,W,h,m,c,G,Y,H,F,U,z,d,Q,i,a)}}null!=n&&null!=n.physicsBody&&!0===p&&(n.physicsBody.disablePreStep=!1)}},n.GetPhysicsMaterialCombine=function(e){switch(e){case 0:default:return BABYLON.PhysicsMaterialCombineMode.ARITHMETIC_MEAN;case 1:return BABYLON.PhysicsMaterialCombineMode.MULTIPLY;case 2:return BABYLON.PhysicsMaterialCombineMode.MINIMUM;case 3:return BABYLON.PhysicsMaterialCombineMode.MAXIMUM}},n.GetCachedPhysicsMeshShape=function(t,n,o,i,r,a,l,s,u,c){if(null==o||""===o)return console.warn("Invalid mesh key specfifed for child collider: "+n.name),null;o+="_SF"+i+"_DF"+r+"_R"+a+"_T0_L"+u+"_X"+c;var d=e.RigidbodyPhysics.PhysicsShapeCache[o];return null==d?((d=new BABYLON.PhysicsShapeMesh(n,t)).material={friction:r,staticFriction:i,restitution:a,frictionCombine:l,restitutionCombine:s},d.isTrigger=!1,d.filterMembershipMask=u,d.filterCollideMask=c,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[o]=d):e.RigidbodyPhysics.CachedPhysicsShapeCount++,d},n.GetCachedPhysicsConvexHullShape=function(t,n,o,i,r,a,l,s,u,c){if(null==o||""===o)return console.warn("Invalid mesh key specfifed for child collider: "+n.name),null;o+="_SF"+i+"_DF"+r+"_R"+a+"_T0_L"+u+"_X"+c;var d=e.RigidbodyPhysics.PhysicsShapeCache[o];return null==d?((d=new BABYLON.PhysicsShapeConvexHull(n,t)).material={friction:r,staticFriction:i,restitution:a,frictionCombine:l,restitutionCombine:s},d.isTrigger=!1,d.filterMembershipMask=u,d.filterCollideMask=c,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[o]=d):e.RigidbodyPhysics.CachedPhysicsShapeCount++,d},n.GetCachedPhysicsBoxShape=function(t,n,o,i,r,a,l,s,u){var c="SHAPE_BOX_SF"+o+"_DF"+i+"_R"+r+"_T"+(1==n?"1":"0")+"_L"+s+"_X"+u,d=e.RigidbodyPhysics.PhysicsShapeCache[c];return null==d?((d=new BABYLON.PhysicsShapeBox(new BABYLON.Vector3(0,0,0),new BABYLON.Quaternion(0,0,0,1),new BABYLON.Vector3(1,1,1),t)).material={friction:i,staticFriction:o,restitution:r,frictionCombine:a,restitutionCombine:l},d.isTrigger=n,d.filterMembershipMask=s,d.filterCollideMask=u,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[c]=d):e.RigidbodyPhysics.CachedPhysicsShapeCount++,d},n.GetCachedPhysicsSphereShape=function(t,n,o,i,r,a,l,s,u){var c="SHAPE_SPHERE_SF"+o+"_DF"+i+"_R"+r+"_T"+(1==n?"1":"0")+"_L"+s+"_X"+u,d=e.RigidbodyPhysics.PhysicsShapeCache[c];return null==d?((d=new BABYLON.PhysicsShapeSphere(new BABYLON.Vector3(0,0,0),1,t)).material={friction:i,staticFriction:o,restitution:r,frictionCombine:a,restitutionCombine:l},d.isTrigger=n,d.filterMembershipMask=s,d.filterCollideMask=u,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[c]=d):e.RigidbodyPhysics.CachedPhysicsShapeCount++,d},n.GetCachedPhysicsCapsuleShape=function(t,n,o,i,r,a,l,s,u){var c="SHAPE_CAPSULE_SF"+o+"_DF"+i+"_R"+r+"_T"+(1==n?"1":"0")+"_L"+s+"_X"+u,d=e.RigidbodyPhysics.PhysicsShapeCache[c];return null==d?((d=new BABYLON.PhysicsShapeCapsule(new BABYLON.Vector3(0,-1,0),new BABYLON.Vector3(0,1,0),1,t)).material={friction:i,staticFriction:o,restitution:r,frictionCombine:a,restitutionCombine:l},d.isTrigger=n,d.filterMembershipMask=s,d.filterCollideMask=u,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[c]=d):e.RigidbodyPhysics.CachedPhysicsShapeCount++,d},n.GetCachedPhysicsCylinderShape=function(t,n,o,i,r,a,l,s,u){var c="SHAPE_CYLINDER_SF"+o+"_DF"+i+"_R"+r+"_T"+(1==n?"1":"0")+"_L"+s+"_X"+u,d=e.RigidbodyPhysics.PhysicsShapeCache[c];return null==d?((d=new BABYLON.PhysicsShapeCylinder(new BABYLON.Vector3(0,-.5,0),new BABYLON.Vector3(0,.5,0),1,t)).material={friction:i,staticFriction:o,restitution:r,frictionCombine:a,restitutionCombine:l},d.isTrigger=n,d.filterMembershipMask=s,d.filterCollideMask=u,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[c]=d):e.RigidbodyPhysics.CachedPhysicsShapeCount++,d},n.CreateStandardPhysicsShapeAndBody=function(t,n,o,i,r,a,l,s,u,c,d,p,h,m,f,g,y,v){var _=o.collision,b=null!=_.meshkey?_.meshkey:null,B=null!=_.center?_.center:{x:0,y:0,z:0};if(i==e.RigidbodyPhysics.HeightmapImpostor)if(null!=m){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var C=n,S=m.index,A=m.segments,T=m.resolution,O=m.width,I=(m.height,m.length);if(1===(null!=m.collider?m.collider:0)){var M=1,L=1,x=0,w=0;if(1===A)x=.5*(O+(M=O/(T-1))),w=.5*(I-(L=I/(T-1)));else if(2===A){var P=O/A,N=I/A;M=O/(T-1),L=I/(T-1),0===S?(x=.5*(P+M)+0,w=.5*(N-L)+0):1===S?(x=.5*(1*P+M)+0,w=.5*(N-L)+N):2===S?(x=.5*(1*P+M)+P,w=.5*(N-L)+0):3===S&&(x=.5*(1*P+M)+P,w=.5*(N-L)+N)}var k=e.RigidbodyPhysics.CreateHeightFieldTerrainShapeFromMesh(C,M,L),R=new BABYLON.PhysicsShape({type:BABYLON.PhysicsShapeType.HEIGHTFIELD,pluginData:k},t);R.filterMembershipMask=y,R.filterCollideMask=v,R.material={friction:c,staticFriction:u,restitution:d,frictionCombine:p,restitutionCombine:h};var D="TERRAIN_MESH_ID"+C.uniqueId+"_SF"+u+"_DF"+c+"_R"+d+"_T0_L"+y+"_X"+v;e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[D]=R;var E=new BABYLON.Vector3(x,0,w),V=new BABYLON.Quaternion(0,0,0,1),U=new BABYLON.Vector3(1,1,1),F=new BABYLON.PhysicsShapeContainer(t);F.material=R.material,e.Utilities.FromEulerToRef(0,90,0,V),R.isTrigger=!1,F.addChild(R,E,V,U);var Y=new BABYLON.PhysicsBody(n,BABYLON.PhysicsMotionType.STATIC,!1,t);Y.shape=F,e.Utilities.ShowDebugColliders()&&console.log("Setup standard terrain heightmap physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,r,o.physics,0,new BABYLON.Vector3(f.x,f.y,f.z)),e.Utilities.ShowDebugColliders()||null!=(Ce=n).material&&"CenterBox-Material"===Ce.material.name&&(Ce.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.Debug.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(Y))}else(z=new BABYLON.PhysicsShapeMesh(C,t)).filterMembershipMask=y,z.filterCollideMask=v,z.material={friction:c,staticFriction:u,restitution:d,frictionCombine:p,restitutionCombine:h},(H=new BABYLON.PhysicsBody(n,BABYLON.PhysicsMotionType.STATIC,!1,t)).shape=z,e.Utilities.ShowDebugColliders()&&console.log("Setup terrain mesh physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,r,o.physics,0,new BABYLON.Vector3(f.x,f.y,f.z)),e.Utilities.ShowDebugColliders()||null!=(Ce=n).material&&"CenterBox-Material"===Ce.material.name&&(Ce.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.Debug.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(H))}else BABYLON.Tools.Warn("No terrain collision data found for: "+n.name+". No terrain collision impostor will be created.");else if(i==e.RigidbodyPhysics.MeshImpostor){var G=e.SceneManager.FindChildTransformNode(n,n.name+".Collider",e.SearchType.ExactMatch,!0);if(null!=G){!1===g&&e.Utilities.AddLoaderItemMarkedForDisposal(G),e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var H=new BABYLON.PhysicsBody(n,BABYLON.PhysicsMotionType.STATIC,!1,t),z=e.RigidbodyPhysics.GetCachedPhysicsMeshShape(t,G,b,u,c,d,p,h,y,v),W=new BABYLON.PhysicsShapeContainer(t);W.material=z.material,e.RigidbodyPhysics.AddChildShapeFromParent(W,n,z,G),H.shape=W,e.Utilities.ShowDebugColliders()&&console.log("Setup standard mesh physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,r,o.physics,0,new BABYLON.Vector3(f.x,f.y,f.z)),e.Utilities.ShowDebugColliders()||null!=(Ce=n).material&&"CenterBox-Material"===Ce.material.name&&(Ce.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.Debug.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(H))}else BABYLON.Tools.Warn("No mesh collider found for: "+n.name+".")}else if(i==e.RigidbodyPhysics.ConvexHullImpostor){var Q=e.SceneManager.FindChildTransformNode(n,n.name+".Collider",e.SearchType.ExactMatch,!0);if(null!=Q){!1===g&&e.Utilities.AddLoaderItemMarkedForDisposal(Q),e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var X=e.RigidbodyPhysics.GetCachedPhysicsConvexHullShape(t,Q,b,u,c,d,p,h,y,v),K=new BABYLON.PhysicsShapeContainer(t);K.material=X.material,e.RigidbodyPhysics.AddChildShapeFromParent(K,n,X,Q);var j=new BABYLON.PhysicsBody(n,l,!1,t);j.shape=K,e.Utilities.ShowDebugColliders()&&console.log("Setup standard convex hull physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!0,!1,o.physics,s,new BABYLON.Vector3(f.x,f.y,f.z)),e.Utilities.ShowDebugColliders()||null!=(Ce=n).material&&"CenterBox-Material"===Ce.material.name&&(Ce.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.Debug.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(j))}else BABYLON.Tools.Warn("No convex hull child mesh collider found for: "+n.name+".")}else if(i==e.RigidbodyPhysics.BoxImpostor){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var Z=null!=_.boxsize?_.boxsize:{x:1,y:1,z:1},q=Z.x*parseFloat(n.scaling.x.toFixed(4)),J=Z.y*parseFloat(n.scaling.y.toFixed(4)),$=Z.z*parseFloat(n.scaling.z.toFixed(4)),ee=B.x*parseFloat(n.scaling.x.toFixed(4)),te=B.y*parseFloat(n.scaling.y.toFixed(4)),ne=B.z*parseFloat(n.scaling.z.toFixed(4)),oe=new BABYLON.Vector3(ee,te,ne),ie=e.RigidbodyPhysics.GetCachedPhysicsBoxShape(t,r,u,c,d,p,h,y,v),re=new BABYLON.PhysicsShapeContainer(t);re.material=ie.material,re.addChild(ie,oe,new BABYLON.Quaternion(0,0,0,1),new BABYLON.Vector3(q,J,$));var ae=new BABYLON.PhysicsBody(n,l,!1,t);ae.shape=re,e.Utilities.ShowDebugColliders()&&console.log("Setup standard box physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,!1,o.physics,s,oe.add(new BABYLON.Vector3(f.x,f.y,f.z))),e.Utilities.ShowDebugColliders()||null!=(Ce=n).material&&"CenterBox-Material"===Ce.material.name&&(Ce.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.Debug.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(ae))}else if(i==e.RigidbodyPhysics.SphereImpostor){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var le=null!=_.sphereradius?_.sphereradius:.5,se=parseFloat(n.scaling.x.toFixed(4)),ue=parseFloat(n.scaling.y.toFixed(4)),ce=parseFloat(n.scaling.z.toFixed(4)),de=Math.max(se,ue,ce)*le,pe=(ee=B.x*parseFloat(n.scaling.x.toFixed(4)),te=B.y*parseFloat(n.scaling.y.toFixed(4)),ne=B.z*parseFloat(n.scaling.z.toFixed(4)),oe=new BABYLON.Vector3(ee,te,ne),e.RigidbodyPhysics.GetCachedPhysicsSphereShape(t,r,u,c,d,p,h,y,v)),he=new BABYLON.PhysicsShapeContainer(t);he.material=pe.material,he.addChild(pe,oe,new BABYLON.Quaternion(0,0,0,1),new BABYLON.Vector3(de,de,de));var me=new BABYLON.PhysicsBody(n,l,!1,t);me.shape=he,e.Utilities.ShowDebugColliders()&&console.log("Setup standard sphere physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,!1,o.physics,s,oe.add(new BABYLON.Vector3(f.x,f.y,f.z))),e.Utilities.ShowDebugColliders()||null!=(Ce=n).material&&"CenterBox-Material"===Ce.material.name&&(Ce.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.Debug.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(me))}else if(i==e.RigidbodyPhysics.CapsuleImpostor){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var fe=null!=_.cylinder&&_.cylinder,ge=null!=_.capsulesize?_.capsulesize:{x:.5,y:2,z:1},ye=ge.x*parseFloat(n.scaling.x.toFixed(4)),ve=ge.y*parseFloat(n.scaling.y.toFixed(4)),_e=parseFloat(n.scaling.z.toFixed(4));_e=!0===fe?e.RigidbodyPhysics.GetCachedPhysicsCylinderShape(t,r,u,c,d,p,h,y,v):e.RigidbodyPhysics.GetCachedPhysicsCapsuleShape(t,r,u,c,d,p,h,y,v);var be=new BABYLON.Quaternion(0,0,0,1);0!==ge.z&&2!==ge.z||(0===ge.z?e.Utilities.FromEulerToRef(0,0,90,be):2===ge.z&&e.Utilities.FromEulerToRef(90,0,0,be)),ee=B.x*parseFloat(n.scaling.x.toFixed(4)),te=B.y*parseFloat(n.scaling.y.toFixed(4)),ne=B.z*parseFloat(n.scaling.z.toFixed(4)),oe=new BABYLON.Vector3(ee,te,ne);var Be=new BABYLON.PhysicsShapeContainer(t);Be.material=_e.material,Be.addChild(_e,oe,be,new BABYLON.Vector3(ye,ve,ye));var Ce,Se=new BABYLON.PhysicsBody(n,l,!1,t);Se.shape=Be,e.Utilities.ShowDebugColliders()&&console.log("Setup standard "+(!0===fe?"cylinder":"capsule")+" physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,!1,o.physics,s,oe.add(new BABYLON.Vector3(f.x,f.y,f.z))),e.Utilities.ShowDebugColliders()||null!=(Ce=n).material&&"CenterBox-Material"===Ce.material.name&&(Ce.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.Debug.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(Se))}},n.CreateCompoundPhysicsShapeAndBody=function(t,n,o,i,r,a,l,s,u,c,d,p,h,m,f,g,y,v){var _=0,b=0,B=0,C=new BABYLON.Vector3(0,0,0),S=new BABYLON.Quaternion(0,0,0,1),A=new BABYLON.Vector3(1,1,1);if(!1===g&&!0===m&&e.Utilities.AddLoaderItemMarkedForDisposal(o),r==e.RigidbodyPhysics.ConvexHullImpostor){var T=e.SceneManager.FindChildTransformNode(o,o.name+".Collider",e.SearchType.ExactMatch,!0);if(null!=T){var O=1,I=1,M=1;if(T instanceof BABYLON.InstancedMesh){!0===m&&(O*=parseFloat(n.scaling.x.toFixed(4)),I*=parseFloat(n.scaling.y.toFixed(4)),M*=parseFloat(n.scaling.z.toFixed(4))),A.set(O,I,M);var L=T.sourceMesh;if(null!=L){var x=null!=T.metadata&&null!=T.metadata.toolkit&&null!=T.metadata.toolkit.collision&&null!=T.metadata.toolkit.collision.sourcescale?T.metadata.toolkit.collision.sourcescale:null,w=null!=L.metadata&&null!=L.metadata.toolkit&&null!=L.metadata.toolkit.collision&&null!=L.metadata.toolkit.collision.sourcescale?L.metadata.toolkit.collision.sourcescale:null;if(null!=w&&null!=x){var P=new BABYLON.Vector3(1,1,1),N=new BABYLON.Vector3(x.x,x.y,x.z),k=new BABYLON.Vector3(w.x,w.y,w.z);N.divideToRef(k,P),A.multiplyInPlace(P)}}}else A.set(O,I,M);var R=null!=i.meshkey?i.meshkey:null,D=e.RigidbodyPhysics.GetCachedPhysicsConvexHullShape(t,T,R,a,l,s,u,c,y,v);if(!0===m){var E=o.position.x*parseFloat(n.scaling.x.toFixed(4)),V=o.position.y*parseFloat(n.scaling.y.toFixed(4)),U=o.position.z*parseFloat(n.scaling.z.toFixed(4));C.set(E,V,U),S.multiplyInPlace(o.rotationQuaternion)}else _=h.x*parseFloat(o.scaling.x.toFixed(4)),b=h.y*parseFloat(o.scaling.y.toFixed(4)),B=h.z*parseFloat(o.scaling.z.toFixed(4)),C.set(_,b,B);p.shape=D,p.translation=C,p.rotation=S,p.scale=A,d.push(p)}}else if(r==e.RigidbodyPhysics.CapsuleImpostor){var F=null!=i.cylinder&&i.cylinder,Y=null!=i.capsulesize?i.capsulesize:{x:.5,y:2,z:1},G=Y.x*parseFloat(o.scaling.x.toFixed(4)),H=Y.y*parseFloat(o.scaling.y.toFixed(4));parseFloat(o.scaling.z.toFixed(4)),!0===m&&(G*=parseFloat(n.scaling.x.toFixed(4)),H*=parseFloat(n.scaling.y.toFixed(4)),parseFloat(n.scaling.z.toFixed(4))),A.set(G,H,G);var z;z=!0===F?e.RigidbodyPhysics.GetCachedPhysicsCylinderShape(t,f,a,l,s,u,c,y,v):e.RigidbodyPhysics.GetCachedPhysicsCapsuleShape(t,f,a,l,s,u,c,y,v),0!==Y.z&&2!==Y.z||(0===Y.z?e.Utilities.FromEulerToRef(0,0,90,S):2===Y.z&&e.Utilities.FromEulerToRef(90,0,0,S)),!0===m?(0===h.x&&0===h.y&&0===h.z||console.warn("WARNING: Center offset not supported for complex compound item: "+o.name),E=o.position.x*parseFloat(n.scaling.x.toFixed(4)),V=o.position.y*parseFloat(n.scaling.y.toFixed(4)),U=o.position.z*parseFloat(n.scaling.z.toFixed(4)),C.set(E,V,U),S.multiplyInPlace(o.rotationQuaternion)):(_=h.x*parseFloat(o.scaling.x.toFixed(4)),b=h.y*parseFloat(o.scaling.y.toFixed(4)),B=h.z*parseFloat(o.scaling.z.toFixed(4)),C.set(_,b,B)),p.shape=z,p.translation=C,p.rotation=S,p.scale=A,d.push(p)}else if(r==e.RigidbodyPhysics.SphereImpostor){var W=null!=i.sphereradius?i.sphereradius:.5,Q=parseFloat(o.scaling.x.toFixed(4)),X=parseFloat(o.scaling.y.toFixed(4)),K=parseFloat(o.scaling.z.toFixed(4)),j=Math.max(Q,X,K)*W;if(!0===m){var Z=parseFloat(n.scaling.x.toFixed(4)),q=parseFloat(n.scaling.y.toFixed(4)),J=parseFloat(n.scaling.z.toFixed(4));j*=Math.max(Z,q,J)}A.set(j,j,j);var $=e.RigidbodyPhysics.GetCachedPhysicsSphereShape(t,f,a,l,s,u,c,y,v);!0===m?(0===h.x&&0===h.y&&0===h.z||console.warn("WARNING: Center offset not supported for complex compound item: "+o.name),E=o.position.x*parseFloat(n.scaling.x.toFixed(4)),V=o.position.y*parseFloat(n.scaling.y.toFixed(4)),U=o.position.z*parseFloat(n.scaling.z.toFixed(4)),C.set(E,V,U),S.multiplyInPlace(o.rotationQuaternion)):(_=h.x*parseFloat(o.scaling.x.toFixed(4)),b=h.y*parseFloat(o.scaling.y.toFixed(4)),B=h.z*parseFloat(o.scaling.z.toFixed(4)),C.set(_,b,B)),p.shape=$,p.translation=C,p.rotation=S,p.scale=A,d.push(p)}else if(r==e.RigidbodyPhysics.BoxImpostor){var ee=null!=i.boxsize?i.boxsize:{x:1,y:1,z:1},te=ee.x*parseFloat(o.scaling.x.toFixed(4)),ne=ee.y*parseFloat(o.scaling.y.toFixed(4)),oe=ee.z*parseFloat(o.scaling.z.toFixed(4));!0===m&&(te*=parseFloat(n.scaling.x.toFixed(4)),ne*=parseFloat(n.scaling.y.toFixed(4)),oe*=parseFloat(n.scaling.z.toFixed(4))),A.set(te,ne,oe);var ie=e.RigidbodyPhysics.GetCachedPhysicsBoxShape(t,f,a,l,s,u,c,y,v);!0===m?(0===h.x&&0===h.y&&0===h.z||console.warn("WARNING: Center offset not supported for complex compound item: "+o.name),E=o.position.x*parseFloat(n.scaling.x.toFixed(4)),V=o.position.y*parseFloat(n.scaling.y.toFixed(4)),U=o.position.z*parseFloat(n.scaling.z.toFixed(4)),C.set(E,V,U),S.multiplyInPlace(o.rotationQuaternion)):(_=h.x*parseFloat(o.scaling.x.toFixed(4)),b=h.y*parseFloat(o.scaling.y.toFixed(4)),B=h.z*parseFloat(o.scaling.z.toFixed(4)),C.set(_,b,B)),p.shape=ie,p.translation=C,p.rotation=S,p.scale=A,d.push(p)}},n.CreateHeightFieldTerrainShapeFromMesh=function(t,n,o){var i=e.RigidbodyPhysics.GetHavokInstance();if(!i)return BABYLON.Tools.Warn("Havok.js physics library not loaded"),null;var r=t.getVerticesData(BABYLON.VertexBuffer.PositionKind),a=r.length/3,l=i._malloc(4*a),s=Math.sqrt(a),u=s;if(s%1!=0)return console.error("Terrain mesh does not seem to be a regular square grid: "+t.name),null;for(var c=0,d=u-1;d>=0;d--)for(var p=0;p<s;p++){var h=d*s+p;i.HEAPF32[l+c>>2]=r[3*h+1],c+=4}var m=i.HP_Shape_CreateHeightField(s,u,[n,1,o],l)[1];return i._free(l),m},n.GetPhysicsHeapSize=function(){var t=e.RigidbodyPhysics.GetHavokInstance();if(!t)return BABYLON.Tools.Warn("Havok.js physics library not loaded"),0;var n=0;return t.HEAP8&&t.HEAP8.length&&(n=t.HEAP8.length/1048576),n},n.ConfigRigidbodyPhysics=function(e,t,n,o,i,r,a){if(null!=t&&null!=t.physicsBody){!1===(null==i||null==i.gravity||i.gravity)&&t.physicsBody.setGravityFactor(0);var l=null!=i&&null!=i.ldrag?i.ldrag:0,s=null!=i&&null!=i.adrag?i.adrag:.05;t.physicsBody.setLinearDamping(l),t.physicsBody.setAngularDamping(s);var u=null!=i&&null!=i.freeze?i.freeze:null,c=1,d=1,p=1;null!=u&&(null!=u.positionx&&u.positionx,null!=u.positiony&&u.positiony,null!=u.positionz&&u.positionz,c=null!=u.rotationx&&!0===u.rotationx?0:1,d=null!=u.rotationy&&!0===u.rotationy?0:1,p=null!=u.rotationz&&!0===u.rotationz?0:1),t.physicsBody.setMassProperties({mass:r,centerOfMass:a,inertia:new BABYLON.Vector3(c,d,p)})}},n.CreatePhysicsMetadata=function(e,t,n,o){void 0===t&&(t=0),void 0===n&&(n=.05),void 0===o&&(o=null);var i=null!=o?o:new BABYLON.Vector3(0,0,0);return{type:"rigidbody",mass:e,ldrag:t,adrag:n,center:{x:i.x,y:i.y,z:i.z}}},n.CreateCollisionMetadata=function(e,t,n,o,i,r){return void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===o&&(o=0),void 0===i&&(i=.6),void 0===r&&(r=.6),{type:e,trigger:t,convexmesh:n,restitution:o,dynamicfriction:i,staticfriction:r,wheelinformation:null}},n.CreatePhysicsProperties=function(e,t,n,o,i){return void 0===t&&(t=0),void 0===n&&(n=.05),void 0===o&&(o=!0),void 0===i&&(i=!1),{mass:e,drag:t,angularDrag:n,useGravity:o,isKinematic:i}},n.AddChildShapeFromParent=function(t,n,o,i){var r,a=i.computeWorldMatrix(!0),l=n.computeWorldMatrix(!0),s=BABYLON.TmpVectors.Matrix[0];a.multiplyToRef(BABYLON.Matrix.Invert(l),s);var u=BABYLON.TmpVectors.Vector3[0],c=BABYLON.TmpVectors.Quaternion[0],d=BABYLON.TmpVectors.Vector3[1];s.decompose(d,c,u);var p=new BABYLON.Vector3(d.x,d.y,d.z);if(i instanceof BABYLON.InstancedMesh){var h=i.sourceMesh;if(null!=h){var m=null!=i.metadata&&null!=i.metadata.toolkit&&null!=i.metadata.toolkit.collision&&null!=i.metadata.toolkit.collision.sourcescale?i.metadata.toolkit.collision.sourcescale:null,f=null!=h.metadata&&null!=h.metadata.toolkit&&null!=h.metadata.toolkit.collision&&null!=h.metadata.toolkit.collision.sourcescale?h.metadata.toolkit.collision.sourcescale:null;if(null!=f&&null!=m){var g=new BABYLON.Vector3(1,1,1),y=new BABYLON.Vector3(m.x,m.y,m.z),v=new BABYLON.Vector3(f.x,f.y,f.z);y.divideToRef(v,g),p.multiplyInPlace(g)}}}null===(r=e.Utilities.GetHavokPlugin())||void 0===r||r.addChild(t,o,u,c,p)},n.PHYSICS_STEP_TIME=.016,n.RaycastResult=null,n.LocalShapeResult=null,n.WorldShapeResult=null,n.RaycastDestination=null,n.PhysicsShapeCache={},n.NewPhysicsShapeCount=0,n.CachedPhysicsShapeCount=0,n.DebugPhysicsViewer=null,n.OnSetupPhysicsPlugin=null,n.NoImpostor=0,n.SphereImpostor=1,n.BoxImpostor=2,n.PlaneImpostor=3,n.MeshImpostor=4,n.CapsuleImpostor=6,n.CylinderImpostor=7,n.ParticleImpostor=8,n.HeightmapImpostor=9,n.ConvexHullImpostor=10,n.CustomImpostor=100,n.RopeImpostor=101,n.ClothImpostor=102,n.SoftbodyImpostor=103,n}(e.ScriptComponent);e.RigidbodyPhysics=t;e.PhyscisContainerData=function(){},e.SceneManager.RegisterClass("TOOLKIT.RigidbodyPhysics",t)}(o||(o={})),function(e){var t=function(e){function t(t,n,o,i){return void 0===o&&(o={}),void 0===i&&(i="TOOLKIT.ShurikenParticles"),e.call(this,t,n,o,i)||this}return i(t,e),t.prototype.awake=function(){},t.prototype.start=function(){},t.prototype.ready=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.step=function(){},t.prototype.fixed=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(e.ScriptComponent);e.ShurikenParticles=t,e.SceneManager.RegisterClass("TOOLKIT.ShurikenParticles",t)}(o||(o={})),function(e){var t=function(e){function t(t,n,o,i){return void 0===o&&(o={}),void 0===i&&(i="TOOLKIT.TerrainGenerator"),e.call(this,t,n,o,i)||this}return i(t,e),t.prototype.awake=function(){},t.prototype.start=function(){},t.prototype.ready=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.step=function(){},t.prototype.fixed=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(e.ScriptComponent);e.TerrainGenerator=t,e.SceneManager.RegisterClass("TOOLKIT.TerrainGenerator",t)}(o||(o={})),function(e){var t=function(t){function n(e,n,o,i){void 0===o&&(o={}),void 0===i&&(i="TOOLKIT.WebVideoPlayer");var r=t.call(this,e,n,o,i)||this;return r.videoLoop=!1,r.videoMuted=!1,r.videoAlpha=!1,r.videoFaded=!1,r.videoPoster=null,r.videoInvert=!0,r.videoSample=3,r.videoVolume=1,r.videoMipmaps=!1,r.videoPlayback=1,r.videoPlayOnAwake=!0,r.videoPreloaderUrl=null,r.videoBlobUrl=null,r.videoPreload=!1,r._initializedReadyInstance=!1,r.onReadyObservable=new BABYLON.Observable,r.m_abstractMesh=null,r.m_videoTexture=null,r.m_videoMaterial=null,r.m_diffuseIntensity=1,r}return i(n,t),n.prototype.getVideoMaterial=function(){return this.m_videoMaterial},n.prototype.getVideoTexture=function(){return this.m_videoTexture},n.prototype.getVideoElement=function(){return null!=this.m_videoTexture?this.m_videoTexture.video:null},n.prototype.getVideoScreen=function(){return this.m_abstractMesh},n.prototype.getVideoBlobUrl=function(){return this.videoBlobUrl},n.prototype.awake=function(){this.awakeWebVideoPlayer()},n.prototype.destroy=function(){this.destroyWebVideoPlayer()},n.prototype.awakeWebVideoPlayer=function(){this.videoLoop=this.getProperty("looping",!1),this.videoMuted=this.getProperty("muted",!1),this.videoInvert=this.getProperty("inverty",!0),this.videoSample=this.getProperty("sampling",3),this.videoVolume=this.getProperty("volume",1),this.videoMipmaps=this.getProperty("mipmaps",!1),this.videoAlpha=this.getProperty("texturealpha",!1),this.videoFaded=this.getProperty("diffusealpha",!1),this.videoPlayback=this.getProperty("playbackspeed",1),this.videoPlayOnAwake=this.getProperty("playonawake",!0),this.videoPreload=this.getProperty("preload",this.videoPreload),this.m_diffuseIntensity=this.getProperty("intensity",1),this.m_abstractMesh=this.getAbstractMesh(),!0===this.getProperty("poster")&&null!=this.m_abstractMesh&&null!=this.m_abstractMesh.material&&(this.m_abstractMesh.material instanceof BABYLON.PBRMaterial?null!=this.m_abstractMesh.material.albedoTexture&&null!=this.m_abstractMesh.material.albedoTexture.url&&""!==this.m_abstractMesh.material.albedoTexture.url&&(this.videoPoster=this.m_abstractMesh.material.albedoTexture.url.replace("data:","")):this.m_abstractMesh.material instanceof BABYLON.StandardMaterial&&null!=this.m_abstractMesh.material.diffuseTexture&&null!=this.m_abstractMesh.material.diffuseTexture.url&&""!==this.m_abstractMesh.material.diffuseTexture.url&&(this.videoPoster=this.m_abstractMesh.material.diffuseTexture.url.replace("data:","")));var t=this.getProperty("url",null),n=this.getProperty("source",null),o=t;null!=n&&null!=n.filename&&""!==n.filename&&(o=e.SceneManager.GetRootUrl(this.scene)+n.filename),null!=o&&""!==o&&(!0===this.videoPreload?this.videoPreloaderUrl=o:this.setDataSource(o))},n.prototype.destroyWebVideoPlayer=function(){this.m_abstractMesh=null,null!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),null!=this.m_videoMaterial&&(this.m_videoMaterial.dispose(),this.m_videoMaterial=null),this.revokeVideoBlobUrl()},n.prototype.isReady=function(){return null!=this.getVideoElement()},n.prototype.isPlaying=function(){var e=!1,t=this.getVideoElement();return null!=t&&(e=!1===t.paused),e},n.prototype.isPaused=function(){var e=!1,t=this.getVideoElement();return null!=t&&(e=!0===t.paused),e},n.prototype.play=function(){return r(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,e.AudioSource.UnlockAudioEngine()];case 1:return t.sent(),this.internalPlay(),[2,!0]}})})},n.prototype.internalPlay=function(){var e=this;!0===this._initializedReadyInstance?this.checkedPlay():this.onReadyObservable.addOnce(function(){e.checkedPlay()})},n.prototype.checkedPlay=function(){var e=this,t=this.getVideoElement();null!=t&&t.play().then(function(){!0===t.paused&&e.checkedRePlay()})},n.prototype.checkedRePlay=function(){var e=this.getVideoElement();null!=e&&e.play().then(function(){})},n.prototype.pause=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.pause(),e=!0),e},n.prototype.mute=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.muted=!0,e=!0),e},n.prototype.unmute=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.muted=!1,e=!0),e},n.prototype.getVolume=function(){var e=0,t=this.getVideoElement();return null!=t&&(e=t.volume),e},n.prototype.setVolume=function(e){var t=!1,n=this.getVideoElement();return null!=n&&(n.volume=e,t=!0),t},n.prototype.setDataSource=function(e){var t=this;null!=this.m_abstractMesh&&(null==this.m_videoMaterial&&(this.m_videoMaterial=new BABYLON.StandardMaterial(this.transform.name+".VideoMat",this.scene),this.m_videoMaterial.roughness=1,this.m_videoMaterial.diffuseColor=new BABYLON.Color3(1,1,1),this.m_videoMaterial.emissiveColor=new BABYLON.Color3(1,1,1),this.m_videoMaterial.useAlphaFromDiffuseTexture=this.videoFaded,this.m_abstractMesh.material=this.m_videoMaterial),null!=this.m_videoMaterial?(this.m_videoMaterial.diffuseTexture=null,null!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),this._initializedReadyInstance=!1,this.m_videoTexture=new BABYLON.VideoTexture(this.transform.name+".VideoTex",e,this.scene,this.videoMipmaps,this.videoInvert,this.videoSample,{autoUpdateTexture:!0,poster:this.videoPoster}),null!=this.m_videoTexture&&(this.m_videoTexture.hasAlpha=this.videoAlpha,null!=this.m_videoTexture.video&&(this.m_videoTexture.video.loop=this.videoLoop,this.m_videoTexture.video.muted=this.videoMuted,this.m_videoTexture.video.volume=this.videoVolume,this.m_videoTexture.video.playbackRate=this.videoPlayback,this.m_videoTexture.video.addEventListener("loadeddata",function(){t._initializedReadyInstance=!0,t.onReadyObservable&&t.onReadyObservable.hasObservers()&&t.onReadyObservable.notifyObservers(t.m_videoTexture),!0===t.videoPlayOnAwake&&t.play()}),this.m_videoTexture.video.load())),null!=this.m_videoTexture&&(this.m_videoTexture.level=this.m_diffuseIntensity,this.m_videoMaterial.diffuseTexture=this.m_videoTexture)):BABYLON.Tools.Warn("No video mesh or material available for: "+this.transform.name))},n.prototype.revokeVideoBlobUrl=function(){null!=this.videoBlobUrl&&(URL.revokeObjectURL(this.videoBlobUrl),this.videoBlobUrl=null)},n.prototype.addPreloaderTasks=function(e){var t=this;if(!0===this.videoPreload){var n=e.addBinaryFileTask(this.transform.name+".VideoTask",this.videoPreloaderUrl);n.onSuccess=function(e){t.revokeVideoBlobUrl(),t.videoBlobUrl=URL.createObjectURL(new Blob([e.data])),t.setDataSource(t.videoBlobUrl)},n.onError=function(e,t,n){console.error(t,n)}}},n}(e.ScriptComponent);e.WebVideoPlayer=t,e.SceneManager.RegisterClass("TOOLKIT.WebVideoPlayer",t)}(o||(o={})),"undefined"!=typeof window&&(window.TOOLKIT=o);const s=o;return t.default})());