!function(i){function e(){}e.IsWindows=function(){return"undefined"!=typeof Windows&&void 0!==Windows.UI&&void 0!==Windows.System&&void 0!==Windows.Foundation},e.IsCordova=function(){return null!=window.cordova},e.IsWebAssembly=function(){return window.WebAssembly},e.IsOculusBrowser=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/OculusBrowser/i)?!0:e},e.IsSamsungBrowser=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/SamsungBrowser/i)?!0:e},e.IsWindowsPhone=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Windows Phone/i)?!0:e},e.IsBlackBerry=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/BlackBerry/i)?!0:e},e.IsOperaMini=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Opera Mini/i)?!0:e},e.IsAndroid=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Android/i)?!0:e},e.IsWebOS=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/webOS/i)?!0:e},e.IsIOS=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone|iPad|iPod/i)?!0:e},e.IsIPHONE=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone/i)?!0:e},e.IsIPAD=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPad/i)?!0:e},e.IsIPOD=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPod/i)?!0:e},e.IsIE11=function(){return void 0!==navigator.maxTouchPoints},e.IsMobile=function(){var e,t=!1;return t=null!=navigator&&null!=navigator.userAgent&&((e=navigator.userAgent).match(/Android/i)||e.match(/webOS/i)||e.match(/iPhone|iPad|iPod/i)||e.match(/BlackBerry/i)||e.match(/Opera Mini/i)||e.match(/Windows Phone/i))?!0:t},e.IsPlaystation=function(){var e=!1;return e=null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Playstation/i)?!0:e},e.IsXboxConsole=function(){var e=!1;return e=i.WindowManager.IsWindows()&&void 0!==Windows.System.Profile&&void 0!==Windows.System.Profile.AnalyticsInfo&&void 0!==Windows.System.Profile.AnalyticsInfo.versionInfo&&void 0!==Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily&&Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily.match(/Xbox/i)?!0:e},e.IsXboxLive=function(){return i.WindowManager.IsWindows()&&"undefined"!=typeof Microsoft&&void 0!==Microsoft.Xbox&&void 0!==Microsoft.Xbox.Services},e.IsFrameWindow=function(){return null!=window.parent&&window!==window.parent},e.AlertMessage=function(e,t){void 0===t&&(t="Babylon.js");var n=null;return i.WindowManager.IsWindows()?n=new Windows.UI.Popups.MessageDialog(e,t).showAsync():window.alert(e),n},e.GetQueryStringParam=function(e,t){t=t||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");e=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null},e.GetTimeMilliseconds=function(){var e=0;return null!=window.performance?e=window.performance.now():null!=window.Date&&(e=Date.now()),e},e.PostWindowMessage=function(e,t,n){void 0===t&&(t="*"),!0===(n=void 0===n?!1:n)?window.postMessage(e,t):window.top?window.top.postMessage(e,t):console.warn("No Valid Top Window")},e.LoadNewLevel=function(e,t){var n;return void 0===t&&(t=null),window&&null!=window.BJS&&"engine.html"===window.BJS?(n=window.location.protocol+"//"+window.location.host+":"+window.location.port+window.location.pathname+"?scene="+e,null!=t&&""!==t&&(n+=t),window.location.replace(n)):BABYLON.Tools.Warn("Scene viewer engine.html required to load level: "+e),!1},e.ShowLoadingScreen=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n="150px"),null!=e.loadingScreen&&(!1===t&&(e.loadingScreen.hideLoadingUI=function(){}),e.displayLoadingUI(),null!=(t=e.loadingScreen)._loadingTextDiv)&&null!=t._loadingTextDiv.style&&(t._loadingTextDiv.style.marginTop=n)},e.HideLoadingScreen=function(e){var t;e.loadingScreen instanceof BABYLON.DefaultLoadingScreen&&(t=e.loadingScreen)&&t._loadingDiv&&(t._loadingDiv.style.opacity="0",t._loadingDiv.addEventListener("transitionend",function(){t._loadingTextDiv&&(t._loadingTextDiv.remove(),t._loadingTextDiv=null),t._loadingDiv&&(t._loadingDiv.remove(),t._loadingDiv=null),t._style&&(t._style.remove(),t._style=null),t._resizeLoadingUI&&window.removeEventListener("resize",t._resizeLoadingUI)}))},e.ShowSceneLoader=function(){window.showSceneLoader&&window.showSceneLoader()},e.HideSceneLoader=function(){window.hideSceneLoader&&window.hideSceneLoader()},e.UpdateLoaderStatus=function(e,t,n){window.updateStatus&&window.updateStatus(e,t,n)},e.UpdateLoaderDetails=function(e,t){window.updateDetails&&window.updateDetails(e,t)},e.UpdateLoaderProgress=function(e,t){window.updateProgress&&window.updateProgress(e,t)},e.ShowPageErrorMessage=function(e,t,n){void 0===t&&(t="Error"),void 0===n&&(n=0),window.showErrorMessage&&window.showErrorMessage(e,t,n)},e.SetTimeout=function(e,t){return window.setTimeout(t,e)},e.ClearTimeout=function(e){window.clearTimeout(e)},e.SetInterval=function(e,t){return window.setInterval(t,e)},e.ClearInterval=function(e){window.clearInterval(e)},e.Atob=function(e){return window.atob(e)},e.Btoa=function(e){return window.btoa(e)},e.PopupDebug=function(e){e.debugLayer&&(e.debugLayer.hide(),e.debugLayer.show({enablePopup:!0,globalRoot:null}))},e.ToggleDebug=function(e,t,n){var o;void 0===t&&(t=!1),void 0===n&&(n=null),e.debugLayer&&(o=window,!0===i.WindowManager.debugLayerVisible?(i.WindowManager.debugLayerVisible=!1,o.METER&&o.METER.show&&o.METER.show(),e.debugLayer.hide()):(i.WindowManager.debugLayerVisible=!0,o.METER&&o.METER.hide&&o.METER.hide(),e.debugLayer.show({embedMode:t,globalRoot:n})))},e.GetLocalStorageItem=function(e){return null!=window.localStorage?window.localStorage.getItem(e):null},e.SetLocalStorageItem=function(e,t){null!=window.localStorage&&window.localStorage.setItem(e,t)},e.GetSessionStorageItem=function(e){return null!=window.sessionStorage?window.sessionStorage.getItem(e):null},e.SetSessionStorageItem=function(e,t){null!=window.sessionStorage&&window.sessionStorage.setItem(e,t)},e.GetFilenameFromUrl=function(e){return e.substring(e.lastIndexOf("/")+1)},e.GetUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null!==e?decodeURIComponent(e[1].replace(/\+/g," ")):null},e.GetVirtualRealityEnabled=function(){var e=i.WindowManager.GetLocalStorageItem("virtualReality");return null!=e&&"true"===e},e.SetVirtualRealityEnabled=function(e){i.WindowManager.SetLocalStorageItem("virtualReality",e.toString().toLowerCase())},e.SetWindowsLaunchMode=function(e){void 0===e&&(e=1),i.WindowManager.IsWindows()&&void 0!==Windows.UI.ViewManagement&&void 0!==Windows.UI.ViewManagement.ApplicationView&&(Windows.UI.ViewManagement.ApplicationView.preferredLaunchWindowingMode=e)},e.QuitWindowsApplication=function(){i.WindowManager.IsWindows()&&window.close()},e.PrintToScreen=function(e,t){var n;void 0===t&&(t="white"),i.WindowManager.PrintElement=document.getElementById("print"),null==i.WindowManager.PrintElement&&((n=document.createElement("div")).id="print",n.style.position="absolute",n.style.left="6px",n.style.bottom="3px",n.style.fontSize="12px",n.style.zIndex="10000",n.style.color="#0c0",document.body.appendChild(n),i.WindowManager.PrintElement=n),null!=i.WindowManager.PrintElement&&i.WindowManager.PrintElement.innerHTML!==e&&(i.WindowManager.PrintElement.style.color!==t&&(i.WindowManager.PrintElement.style.color=t),i.WindowManager.PrintElement.innerHTML=e)},e.debugLayerVisible=!1,e.PrintElement=null,i.WindowManager=e}(UNITY=UNITY||{}),UNITY.WindowManager.IsWindows()&&void 0!==Windows.UI.ViewManagement&&void 0!==Windows.UI.ViewManagement.ApplicationViewBoundsMode&&void 0!==Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow&&Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow),UNITY.WindowManager.IsXboxConsole()&&navigator.gamepadInputEmulation&&(navigator.gamepadInputEmulation="gamepad");var UNITY,WM=UNITY.WindowManager,IC=(!function(l){function e(){}function t(e,t,n){var o=this;this.active=!1,this.touchId=null,this.dragStart=null,this.maxDistance=0,this.deadZone=0,this.xvalue=0,this.yvalue=0,this.stick=null,this.touchId=null,this.dragStart=null,this.active=!1,this.xvalue=0,this.yvalue=0,this.deadZone=n,this.maxDistance=t,this.stick=document.getElementById(e),null!=this.stick?(this.stick.addEventListener("mousedown",function(e){o.handleDown(e)}),this.stick.addEventListener("touchstart",function(e){o.handleDown(e)}),document.addEventListener("mousemove",function(e){o.handleMove(e)},{passive:!1}),document.addEventListener("touchmove",function(e){o.handleMove(e)},{passive:!1}),document.addEventListener("mouseup",function(e){o.handleUp(e)}),document.addEventListener("touchend",function(e){o.handleUp(e)})):console.warn("Failed to locate joystick element: "+e)}e.ConfigureUserInput=function(e,t){var n,o=null==(t=void 0===t?null:t)||null==t.contextMenu||t.contextMenu,i=null!=t&&null!=t.pointerLock&&t.pointerLock,r=null!=t&&null!=t.preventDefault&&t.preventDefault,t=null!=t&&null!=t.useCapture&&t.useCapture;l.InputController.resetUserInput(),l.InputController.input||(document.documentElement.tabIndex=1,document.documentElement.addEventListener("keyup",l.InputController.inputKeyUpHandler,t),document.documentElement.addEventListener("pointerup",l.InputController.inputPointerUpHandler,t),null!=(n=document.getElementById("renderingCanvas")||e.getEngine().getRenderingCanvas())&&(!0===o?(BABYLON.Tools.Log("Canvas element context menu enabled."),n.oncontextmenu=null):(n.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation()},BABYLON.Tools.Log("Canvas element context menu disabled."))),(!0===l.UserInputOptions.UseCanvasElement?(n.tabIndex=2,n.addEventListener("focusout",l.InputController.resetKeyMapHandler,t),n.addEventListener("keydown",l.InputController.inputKeyDownHandler,t),n.addEventListener("pointerdown",l.InputController.inputPointerDownHandler,t),n.addEventListener("pointermove",l.InputController.inputPointerMoveHandler,t),n):(document.documentElement.addEventListener("focusout",l.InputController.resetKeyMapHandler,t),document.documentElement.addEventListener("keydown",l.InputController.inputKeyDownHandler,t),document.documentElement.addEventListener("pointerdown",l.InputController.inputPointerDownHandler,t),document.documentElement.addEventListener("pointermove",l.InputController.inputPointerMoveHandler,t),document.documentElement)).addEventListener("onwheel"in document?"wheel":"mousewheel",l.InputController.inputPointerWheelHandler,t),l.InputController.preventDefault=r,null==l.InputController.GamepadManager&&(l.InputController.GamepadManager=new BABYLON.GamepadManager,l.InputController.GamepadManager.onGamepadConnectedObservable.add(l.InputController.inputManagerGamepadConnected),l.InputController.GamepadManager.onGamepadDisconnectedObservable.add(l.InputController.inputManagerGamepadDisconnected)),l.InputController.input=!0,document.documentElement.focus(),!0===i&&l.InputController.LockMousePointer(e,!0)),e.registerAfterRender(function(){l.InputController.updateUserInput(e)})},e.SetLeftJoystickBuffer=function(e,t,n){void 0===n&&(n=!0),l.InputController.j_horizontal=e,l.InputController.j_vertical=!0===n?-t:t},e.SetRightJoystickBuffer=function(e,t,n){void 0===n&&(n=!0),l.InputController.j_mousex=e,l.InputController.j_mousey=!0===n?-t:t},e.DisableUserInput=function(e,t){void 0===t&&(t=!1),l.InputController.LockMousePointer(e,!1),l.InputController.resetUserInput()},e.LockMousePointer=function(n,e){!0===e?l.InputController.LockMousePointerObserver=n.onPointerObservable.add(function(e,t){e.type!=BABYLON.PointerEventTypes.POINTERDOWN||document.pointerLockElement||n.getEngine().enterPointerlock()}):l.InputController.IsPointerLockHandled()&&(n.onPointerObservable.remove(l.InputController.LockMousePointerObserver),l.InputController.LockMousePointerObserver=null)},e.IsPointerLocked=function(){return l.InputController.PointerLockedFlag},e.IsPointerLockHandled=function(){return null!=l.InputController.LockMousePointerObserver},e.GetUserInput=function(e,t){void 0===t&&(t=l.PlayerNumber.One);var n=0;if(l.InputController.input)switch(e){case l.UserInputAxis.Vertical:case l.UserInputAxis.Horizontal:n=t===l.PlayerNumber.Four?e===l.UserInputAxis.Horizontal?l.InputController.horizontal4:l.InputController.vertical4:t===l.PlayerNumber.Three?e===l.UserInputAxis.Horizontal?l.InputController.horizontal3:l.InputController.vertical3:t===l.PlayerNumber.Two?e===l.UserInputAxis.Horizontal?l.InputController.horizontal2:l.InputController.vertical2:e===l.UserInputAxis.Horizontal?l.InputController.horizontal:l.InputController.vertical;break;case l.UserInputAxis.MouseX:case l.UserInputAxis.MouseY:n=t===l.PlayerNumber.Four?e===l.UserInputAxis.MouseX?l.InputController.mousex4:l.InputController.mousey4:t===l.PlayerNumber.Three?e===l.UserInputAxis.MouseX?l.InputController.mousex3:l.InputController.mousey3:t===l.PlayerNumber.Two?e===l.UserInputAxis.MouseX?l.InputController.mousex2:l.InputController.mousey2:e===l.UserInputAxis.MouseX?l.InputController.mousex:l.InputController.mousey;break;case l.UserInputAxis.Wheel:t===l.PlayerNumber.One&&(n=l.InputController.wheel)}return n},e.OnKeyboardUp=function(e){l.InputController.input&&l.InputController.keyButtonUp.push(e)},e.OnKeyboardDown=function(e){l.InputController.input&&l.InputController.keyButtonDown.push(e)},e.OnKeyboardPress=function(e,t){l.InputController.input&&l.InputController.keyButtonPress.push({index:e,action:t})},e.GetKeyboardInput=function(e){var t=!1;return t=l.InputController.input&&(e="k:"+e.toString(),null!=l.InputController.keymap[e])?l.InputController.keymap[e]:t},e.OnPointerUp=function(e){l.InputController.input&&l.InputController.mouseButtonUp.push(e)},e.OnPointerDown=function(e){l.InputController.input&&l.InputController.mouseButtonDown.push(e)},e.OnPointerPress=function(e,t){l.InputController.input&&l.InputController.mouseButtonPress.push({index:e,action:t})},e.GetPointerInput=function(e){var t=!1;return t=l.InputController.input&&(e="p:"+e.toString(),null!=l.InputController.keymap[e])?l.InputController.keymap[e]:t},e.IsWheelScrolling=function(){return 0!==l.InputController.scroll},e.OnGamepadButtonUp=function(e,t){if(void 0===t&&(t=l.PlayerNumber.One),l.InputController.input)switch(t){case l.PlayerNumber.One:l.InputController.gamepad1ButtonUp.push(e);break;case l.PlayerNumber.Two:l.InputController.gamepad2ButtonUp.push(e);break;case l.PlayerNumber.Three:l.InputController.gamepad3ButtonUp.push(e);break;case l.PlayerNumber.Four:l.InputController.gamepad4ButtonUp.push(e)}},e.OnGamepadButtonDown=function(e,t){if(void 0===t&&(t=l.PlayerNumber.One),l.InputController.input)switch(t){case l.PlayerNumber.One:l.InputController.gamepad1ButtonDown.push(e);break;case l.PlayerNumber.Two:l.InputController.gamepad2ButtonDown.push(e);break;case l.PlayerNumber.Three:l.InputController.gamepad3ButtonDown.push(e);break;case l.PlayerNumber.Four:l.InputController.gamepad4ButtonDown.push(e)}},e.OnGamepadButtonPress=function(e,t,n){if(void 0===n&&(n=l.PlayerNumber.One),l.InputController.input)switch(n){case l.PlayerNumber.One:l.InputController.gamepad1ButtonPress.push({index:e,action:t});break;case l.PlayerNumber.Two:l.InputController.gamepad2ButtonPress.push({index:e,action:t});break;case l.PlayerNumber.Three:l.InputController.gamepad3ButtonPress.push({index:e,action:t});break;case l.PlayerNumber.Four:l.InputController.gamepad4ButtonPress.push({index:e,action:t})}},e.GetGamepadButtonInput=function(e,t){void 0===t&&(t=l.PlayerNumber.One);var n=!1;if(l.InputController.input){var o=null;switch(t){case l.PlayerNumber.One:o="b1:"+e.toString();break;case l.PlayerNumber.Two:o="b2:"+e.toString();break;case l.PlayerNumber.Three:o="b3:"+e.toString();break;case l.PlayerNumber.Four:o="b4:"+e.toString()}null!=o&&null!=l.InputController.keymap[o]&&(n=l.InputController.keymap[o])}return n},e.OnGamepadDirectionUp=function(e,t){if(void 0===t&&(t=l.PlayerNumber.One),l.InputController.input)switch(t){case l.PlayerNumber.One:l.InputController.gamepad1DpadUp.push(e);break;case l.PlayerNumber.Two:l.InputController.gamepad2DpadUp.push(e);break;case l.PlayerNumber.Three:l.InputController.gamepad3DpadUp.push(e);break;case l.PlayerNumber.Four:l.InputController.gamepad4DpadUp.push(e)}},e.OnGamepadDirectionDown=function(e,t){if(void 0===t&&(t=l.PlayerNumber.One),l.InputController.input)switch(t){case l.PlayerNumber.One:l.InputController.gamepad1DpadDown.push(e);break;case l.PlayerNumber.Two:l.InputController.gamepad2DpadDown.push(e);break;case l.PlayerNumber.Three:l.InputController.gamepad3DpadDown.push(e);break;case l.PlayerNumber.Four:l.InputController.gamepad4DpadDown.push(e)}},e.OnGamepadDirectionPress=function(e,t,n){if(void 0===n&&(n=l.PlayerNumber.One),l.InputController.input)switch(n){case l.PlayerNumber.One:l.InputController.gamepad1DpadPress.push({index:e,action:t});break;case l.PlayerNumber.Two:l.InputController.gamepad2DpadPress.push({index:e,action:t});break;case l.PlayerNumber.Three:l.InputController.gamepad3DpadPress.push({index:e,action:t});break;case l.PlayerNumber.Four:l.InputController.gamepad4DpadPress.push({index:e,action:t})}},e.GetGamepadDirectionInput=function(e,t){void 0===t&&(t=l.PlayerNumber.One);var n=!1;if(l.InputController.input){var o=null;switch(t){case l.PlayerNumber.One:o="d1:"+e.toString();break;case l.PlayerNumber.Two:o="d2:"+e.toString();break;case l.PlayerNumber.Three:o="d3:"+e.toString();break;case l.PlayerNumber.Four:o="d4:"+e.toString()}null!=o&&null!=l.InputController.keymap[o]&&(n=l.InputController.keymap[o])}return n},e.OnGamepadTriggerLeft=function(e,t){if(void 0===t&&(t=l.PlayerNumber.One),l.InputController.input)switch(t){case l.PlayerNumber.One:l.InputController.gamepad1LeftTrigger.push(e);break;case l.PlayerNumber.Two:l.InputController.gamepad2LeftTrigger.push(e);break;case l.PlayerNumber.Three:l.InputController.gamepad3LeftTrigger.push(e);break;case l.PlayerNumber.Four:l.InputController.gamepad4LeftTrigger.push(e)}},e.OnGamepadTriggerRight=function(e,t){if(void 0===t&&(t=l.PlayerNumber.One),l.InputController.input)switch(t){case l.PlayerNumber.One:l.InputController.gamepad1RightTrigger.push(e);break;case l.PlayerNumber.Two:l.InputController.gamepad2RightTrigger.push(e);break;case l.PlayerNumber.Three:l.InputController.gamepad3RightTrigger.push(e);break;case l.PlayerNumber.Four:l.InputController.gamepad4RightTrigger.push(e)}},e.GetGamepadTriggerInput=function(e,t){void 0===t&&(t=l.PlayerNumber.One);var n=0;if(l.InputController.input){var o=null;switch(t){case l.PlayerNumber.One:o="t1:"+e.toString();break;case l.PlayerNumber.Two:o="t2:"+e.toString();break;case l.PlayerNumber.Three:o="t3:"+e.toString();break;case l.PlayerNumber.Four:o="t4:"+e.toString()}null!=o&&null!=l.InputController.keymap[o]&&(n=l.InputController.keymap[o])}return n},e.GetGamepadType=function(e){void 0===e&&(e=l.PlayerNumber.One);var t=l.GamepadType.None;if(l.InputController.input)switch(e){case l.PlayerNumber.One:t=l.InputController.gamepad1Type;break;case l.PlayerNumber.Two:t=l.InputController.gamepad2Type;break;case l.PlayerNumber.Three:t=l.InputController.gamepad3Type;break;case l.PlayerNumber.Four:t=l.InputController.gamepad4Type}return t},e.GetGamepad=function(e){void 0===e&&(e=l.PlayerNumber.One);var t=null;if(l.InputController.input)switch(e){case l.PlayerNumber.One:t=l.InputController.gamepad1;break;case l.PlayerNumber.Two:t=l.InputController.gamepad2;break;case l.PlayerNumber.Three:t=l.InputController.gamepad3;break;case l.PlayerNumber.Four:t=l.InputController.gamepad4}return t},e.tickKeyboardInput=function(e){var t,n,o,i,r,a;!1!==l.SceneManager.EnableUserInput&&(t=l.InputController.GetKeyboardInput(l.UserInputKey.W)||l.InputController.GetKeyboardInput(l.UserInputKey.UpArrow),n=l.InputController.GetKeyboardInput(l.UserInputKey.A),o=l.InputController.GetKeyboardInput(l.UserInputKey.S)||l.InputController.GetKeyboardInput(l.UserInputKey.DownArrow),i=l.InputController.GetKeyboardInput(l.UserInputKey.D),r=l.InputController.GetKeyboardInput(l.UserInputKey.LeftArrow),a=l.InputController.GetKeyboardInput(l.UserInputKey.RightArrow),l.InputController.k_vertical=!0===t?l.Utilities.GetKeyboardInputValue(e,l.InputController.k_vertical,1):!0===o?l.Utilities.GetKeyboardInputValue(e,l.InputController.k_vertical,-1):0,!0===l.UserInputOptions.UseArrowKeyRotation?(l.InputController.k_horizontal=!0===i?l.Utilities.GetKeyboardInputValue(e,l.InputController.k_horizontal,1):!0===n?l.Utilities.GetKeyboardInputValue(e,l.InputController.k_horizontal,-1):0,l.InputController.a_mousex=!0===a?1:!0===r?-1:0):l.InputController.k_horizontal=!0===i||!0===a?l.Utilities.GetKeyboardInputValue(e,l.InputController.k_horizontal,1):!0===n||!0===r?l.Utilities.GetKeyboardInputValue(e,l.InputController.k_horizontal,-1):0)},e.updateUserInput=function(e){!1!==l.SceneManager.EnableUserInput&&(l.InputController.PointerLockedFlag=e.getEngine().isPointerLock,l.InputController.tickKeyboardInput(e),l.InputController.x_horizontal=0,l.InputController.x_vertical=0,l.InputController.x_mousex=0,(l.InputController.x_mousey=0)!==l.InputController.j_horizontal?l.InputController.x_horizontal=l.InputController.j_horizontal:0!==l.InputController.g_horizontal1?l.InputController.x_horizontal=l.InputController.g_horizontal1:0!==l.InputController.k_horizontal&&(l.InputController.x_horizontal=l.InputController.k_horizontal),0!==l.InputController.j_vertical?l.InputController.x_vertical=l.InputController.j_vertical:0!==l.InputController.g_vertical1?l.InputController.x_vertical=l.InputController.g_vertical1:0!==l.InputController.k_vertical&&(l.InputController.x_vertical=l.InputController.k_vertical),0!==l.InputController.j_mousex?l.InputController.x_mousex=l.InputController.j_mousex:0!==l.InputController.g_mousex1?l.InputController.x_mousex=l.InputController.g_mousex1:0!==l.InputController.a_mousex?l.InputController.x_mousex=l.InputController.a_mousex:0!==l.InputController.k_mousex&&(l.InputController.x_mousex=l.InputController.k_mousex),0!==l.InputController.j_mousey?l.InputController.x_mousey=l.InputController.j_mousey:0!==l.InputController.g_mousey1?l.InputController.x_mousey=l.InputController.g_mousey1:0!==l.InputController.k_mousey&&(l.InputController.x_mousey=l.InputController.k_mousey),l.InputController.horizontal=l.InputController.x_horizontal,l.InputController.vertical=l.InputController.x_vertical,l.InputController.mousex=l.InputController.x_mousex,l.InputController.mousey=l.InputController.x_mousey,l.InputController.scroll=l.InputController.x_scroll,l.InputController.wheel=l.InputController.x_wheel,l.InputController.horizontal2=l.InputController.g_horizontal2,l.InputController.vertical2=l.InputController.g_vertical2,l.InputController.mousex2=l.InputController.g_mousex2,l.InputController.mousey2=l.InputController.g_mousey2,l.InputController.horizontal3=l.InputController.g_horizontal3,l.InputController.vertical3=l.InputController.g_vertical3,l.InputController.mousex3=l.InputController.g_mousex3,l.InputController.mousey3=l.InputController.g_mousey3,l.InputController.horizontal4=l.InputController.g_horizontal4,l.InputController.vertical4=l.InputController.g_vertical4,l.InputController.mousex4=l.InputController.g_mousex4,l.InputController.mousey4=l.InputController.g_mousey4,l.InputController.k_mousex=0,l.InputController.k_mousey=0,l.InputController.x_mousey=0,l.InputController.x_scroll=0)},e.resetUserInput=function(){l.InputController.input=!1,l.InputController.keymap={},l.InputController.scroll=0,l.InputController.wheel=0,l.InputController.mousex=0,l.InputController.mousey=0,l.InputController.vertical=0,l.InputController.horizontal=0,l.InputController.mousex2=0,l.InputController.mousey2=0,l.InputController.vertical2=0,l.InputController.horizontal2=0,l.InputController.mousex3=0,l.InputController.mousey3=0,l.InputController.vertical3=0,l.InputController.horizontal3=0,l.InputController.mousex4=0,l.InputController.mousey4=0,l.InputController.vertical4=0,l.InputController.horizontal4=0,l.InputController.a_mousex=0,l.InputController.x_scroll=0,l.InputController.x_wheel=0,l.InputController.x_mousex=0,l.InputController.x_mousey=0,l.InputController.x_vertical=0,l.InputController.x_horizontal=0,l.InputController.k_mousex=0,l.InputController.k_mousey=0,l.InputController.k_vertical=0,l.InputController.k_horizontal=0,l.InputController.j_mousex=0,l.InputController.j_mousey=0,l.InputController.j_vertical=0,l.InputController.j_horizontal=0,l.InputController.g_mousex1=0,l.InputController.g_mousey1=0,l.InputController.g_vertical1=0,l.InputController.g_horizontal1=0,l.InputController.g_mousex2=0,l.InputController.g_mousey2=0,l.InputController.g_vertical2=0,l.InputController.g_horizontal2=0,l.InputController.g_mousex3=0,l.InputController.g_mousey3=0,l.InputController.g_vertical3=0,l.InputController.g_horizontal3=0,l.InputController.g_mousex4=0,l.InputController.g_mousey4=0,l.InputController.g_vertical4=0,l.InputController.g_horizontal4=0,l.InputController.preventDefault=!1,l.InputController.mouseButtonUp=[],l.InputController.mouseButtonDown=[],l.InputController.mouseButtonPress=[],l.InputController.keyButtonUp=[],l.InputController.keyButtonDown=[],l.InputController.keyButtonPress=[],l.InputController.gamepad1ButtonUp=[],l.InputController.gamepad1ButtonDown=[],l.InputController.gamepad1ButtonPress=[],l.InputController.gamepad1DpadUp=[],l.InputController.gamepad1DpadDown=[],l.InputController.gamepad1DpadPress=[],l.InputController.gamepad1LeftTrigger=[],l.InputController.gamepad1RightTrigger=[],l.InputController.gamepad2ButtonUp=[],l.InputController.gamepad2ButtonDown=[],l.InputController.gamepad2ButtonPress=[],l.InputController.gamepad2DpadUp=[],l.InputController.gamepad2DpadDown=[],l.InputController.gamepad2DpadPress=[],l.InputController.gamepad2LeftTrigger=[],l.InputController.gamepad2RightTrigger=[],l.InputController.gamepad3ButtonUp=[],l.InputController.gamepad3ButtonDown=[],l.InputController.gamepad3ButtonPress=[],l.InputController.gamepad3DpadUp=[],l.InputController.gamepad3DpadDown=[],l.InputController.gamepad3DpadPress=[],l.InputController.gamepad3LeftTrigger=[],l.InputController.gamepad3RightTrigger=[],l.InputController.gamepad4ButtonUp=[],l.InputController.gamepad4ButtonDown=[],l.InputController.gamepad4ButtonPress=[],l.InputController.gamepad4DpadUp=[],l.InputController.gamepad4DpadDown=[],l.InputController.gamepad4DpadPress=[],l.InputController.gamepad4LeftTrigger=[],l.InputController.gamepad4RightTrigger=[],l.InputController.previousPosition=null},e.resetKeyMapHandler=function(e){l.InputController.keymap={}},e.inputKeyDownHandler=function(t){var e,n;return!1!==l.SceneManager.EnableUserInput&&(e="k:"+t.keyCode.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.keyButtonDown&&0<l.InputController.keyButtonDown.length&&l.InputController.keyButtonDown.forEach(function(e){e(t.keyCode)}),n||null!=l.InputController.keyButtonPress&&0<l.InputController.keyButtonPress.length&&l.InputController.keyButtonPress.forEach(function(e){e.index===t.keyCode&&e.action()}),l.InputController.preventDefault&&t.preventDefault(),!0)},e.inputKeyUpHandler=function(t){var e;return!1!==l.SceneManager.EnableUserInput&&(e="k:"+t.keyCode.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.keyButtonUp&&0<l.InputController.keyButtonUp.length&&l.InputController.keyButtonUp.forEach(function(e){e(t.keyCode)}),l.InputController.preventDefault&&t.preventDefault(),!0)},e.inputPointerWheelHandler=function(e){var t;return!1!==l.SceneManager.EnableUserInput&&(t=e.deltaY?-e.deltaY:e.wheelDelta/40,l.InputController.x_scroll=1,l.InputController.x_wheel=Math.abs(t)>l.UserInputOptions.PointerWheelDeadZone?0+t:0,l.InputController.preventDefault&&e.preventDefault(),!0)},e.inputPointerDownHandler=function(t){if(!1===l.SceneManager.EnableUserInput)return!1;l.InputController.previousPosition={x:t.clientX,y:t.clientY};var e="p:"+t.button.toString(),n=!1;return null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.mouseButtonDown&&0<l.InputController.mouseButtonDown.length&&l.InputController.mouseButtonDown.forEach(function(e){e(t.button)}),n||null!=l.InputController.mouseButtonPress&&0<l.InputController.mouseButtonPress.length&&l.InputController.mouseButtonPress.forEach(function(e){e.index===t.button&&e.action()}),l.InputController.preventDefault&&t.preventDefault(),!0},e.inputPointerUpHandler=function(t){if(!1===l.SceneManager.EnableUserInput)return!1;l.InputController.previousPosition=null,l.InputController.k_mousex=0,l.InputController.k_mousey=0;var e="p:"+t.button.toString();return l.InputController.keymap[e]=!1,null!=l.InputController.mouseButtonUp&&0<l.InputController.mouseButtonUp.length&&l.InputController.mouseButtonUp.forEach(function(e){e(t.button)}),l.InputController.preventDefault&&t.preventDefault(),!0},e.inputPointerMoveHandler=function(e){var t,n,o,i;return!1!==l.SceneManager.EnableUserInput&&(!1===l.SceneManager.VirtualJoystickEnabled&&(n=t=0,l.InputController.IsPointerLocked()?(t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0,l.InputController.previousPosition=null):null!=l.InputController.previousPosition&&(t=e.clientX-l.InputController.previousPosition.x,n=e.clientY-l.InputController.previousPosition.y,l.InputController.previousPosition={x:e.clientX,y:e.clientY}),!0===l.UserInputOptions.PointerMouseInverted&&(t*=-1,n*=-1),l.InputController.rightHanded&&(t*=-1),o=t*l.UserInputOptions.PointerAngularSensibility*l.InputController.MOUSE_DAMPENER,i=n*l.UserInputOptions.PointerAngularSensibility*l.InputController.MOUSE_DAMPENER,Math.abs(t)<=l.UserInputOptions.PointerMouseDeadZone&&(o=0),Math.abs(n)<=l.UserInputOptions.PointerMouseDeadZone&&(i=0),o=BABYLON.Scalar.Clamp(o,-1,1),i=BABYLON.Scalar.Clamp(i,-1,1),l.InputController.k_mousex+=o,l.InputController.k_mousey+=i),l.InputController.preventDefault&&e.preventDefault(),!0)},e.inputOneButtonDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad1&&(e="b1:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad1ButtonDown&&0<l.InputController.gamepad1ButtonDown.length&&l.InputController.gamepad1ButtonDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad1ButtonPress&&0<l.InputController.gamepad1ButtonPress.length&&l.InputController.gamepad1ButtonPress.forEach(function(e){e.index===t&&e.action()}))},e.inputOneButtonUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad1&&(e="b1:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad1ButtonUp)&&0<l.InputController.gamepad1ButtonUp.length&&l.InputController.gamepad1ButtonUp.forEach(function(e){e(t)})},e.inputOneXboxDPadDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad1&&(e="d1:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad1DpadDown&&0<l.InputController.gamepad1DpadDown.length&&l.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad1DpadPress&&0<l.InputController.gamepad1DpadPress.length&&l.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()}))},e.inputOneShockDPadDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad1&&(e="d1:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad1DpadDown&&0<l.InputController.gamepad1DpadDown.length&&l.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad1DpadPress&&0<l.InputController.gamepad1DpadPress.length&&l.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()}))},e.inputOneXboxDPadUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad1&&(e="d1:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad1DpadUp)&&0<l.InputController.gamepad1DpadUp.length&&l.InputController.gamepad1DpadUp.forEach(function(e){e(t)})},e.inputOneShockDPadUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad1&&(e="d1:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad1DpadUp)&&0<l.InputController.gamepad1DpadUp.length&&l.InputController.gamepad1DpadUp.forEach(function(e){e(t)})},e.inputOneXboxLeftTriggerHandler=function(t){!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad1&&(l.InputController.keymap["t1:0"]=t,null!=l.InputController.gamepad1LeftTrigger)&&0<l.InputController.gamepad1LeftTrigger.length&&l.InputController.gamepad1LeftTrigger.forEach(function(e){e(t)})},e.inputOneXboxRightTriggerHandler=function(t){!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad1&&(l.InputController.keymap["t1:1"]=t,null!=l.InputController.gamepad1RightTrigger)&&0<l.InputController.gamepad1RightTrigger.length&&l.InputController.gamepad1RightTrigger.forEach(function(e){e(t)})},e.inputOneLeftStickHandler=function(e){var t,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad1&&(t=(e=e).x*l.UserInputOptions.GamepadLStickSensibility,n=e.y*l.UserInputOptions.GamepadLStickSensibility,e.x=Math.abs(t)>l.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(n)>l.UserInputOptions.GamepadDeadStickValue?n:0,e.x=BABYLON.Scalar.Clamp(e.x,-1,1),e.y=BABYLON.Scalar.Clamp(e.y,-1,1),l.InputController.g_horizontal1=l.UserInputOptions.GamepadLStickXInverted?-e.x:e.x,l.InputController.g_vertical1=l.UserInputOptions.GamepadLStickYInverted?e.y:-e.y)},e.inputOneRightStickHandler=function(e){var t,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad1&&(t=(e=e).x*l.UserInputOptions.GamepadRStickSensibility,n=e.y*l.UserInputOptions.GamepadRStickSensibility,e.x=Math.abs(t)>l.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(n)>l.UserInputOptions.GamepadDeadStickValue?n:0,e.x=BABYLON.Scalar.Clamp(e.x,-1,1),e.y=BABYLON.Scalar.Clamp(e.y,-1,1),l.InputController.g_mousex1=l.UserInputOptions.GamepadRStickXInverted?-e.x:e.x,l.InputController.g_mousey1=l.UserInputOptions.GamepadRStickYInverted?-e.y:e.y)},e.inputTwoButtonDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad2&&(e="b2:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad2ButtonDown&&0<l.InputController.gamepad2ButtonDown.length&&l.InputController.gamepad2ButtonDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad2ButtonPress&&0<l.InputController.gamepad2ButtonPress.length&&l.InputController.gamepad2ButtonPress.forEach(function(e){e.index===t&&e.action()}))},e.inputTwoButtonUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad2&&(e="b2:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad2ButtonUp)&&0<l.InputController.gamepad2ButtonUp.length&&l.InputController.gamepad2ButtonUp.forEach(function(e){e(t)})},e.inputTwoXboxDPadDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad2&&(e="d2:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad2DpadDown&&0<l.InputController.gamepad2DpadDown.length&&l.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad2DpadPress&&0<l.InputController.gamepad2DpadPress.length&&l.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()}))},e.inputTwoShockDPadDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad2&&(e="d2:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad2DpadDown&&0<l.InputController.gamepad2DpadDown.length&&l.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad2DpadPress&&0<l.InputController.gamepad2DpadPress.length&&l.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()}))},e.inputTwoXboxDPadUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad2&&(e="d2:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad2DpadUp)&&0<l.InputController.gamepad2DpadUp.length&&l.InputController.gamepad2DpadUp.forEach(function(e){e(t)})},e.inputTwoShockDPadUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad2&&(e="d2:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad2DpadUp)&&0<l.InputController.gamepad2DpadUp.length&&l.InputController.gamepad2DpadUp.forEach(function(e){e(t)})},e.inputTwoXboxLeftTriggerHandler=function(t){!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad2&&(l.InputController.keymap["t2:0"]=t,null!=l.InputController.gamepad2LeftTrigger)&&0<l.InputController.gamepad2LeftTrigger.length&&l.InputController.gamepad2LeftTrigger.forEach(function(e){e(t)})},e.inputTwoXboxRightTriggerHandler=function(t){!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad2&&(l.InputController.keymap["t2:1"]=t,null!=l.InputController.gamepad2RightTrigger)&&0<l.InputController.gamepad2RightTrigger.length&&l.InputController.gamepad2RightTrigger.forEach(function(e){e(t)})},e.inputTwoLeftStickHandler=function(e){var t,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad2&&(t=(e=e).x*l.UserInputOptions.GamepadLStickSensibility,n=e.y*l.UserInputOptions.GamepadLStickSensibility,e.x=Math.abs(t)>l.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(n)>l.UserInputOptions.GamepadDeadStickValue?n:0,e.x=BABYLON.Scalar.Clamp(e.x,-1,1),e.y=BABYLON.Scalar.Clamp(e.y,-1,1),l.InputController.g_horizontal2=l.UserInputOptions.GamepadLStickXInverted?-e.x:e.x,l.InputController.g_vertical2=l.UserInputOptions.GamepadLStickYInverted?e.y:-e.y)},e.inputTwoRightStickHandler=function(e){var t,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad2&&(t=(e=e).x*l.UserInputOptions.GamepadRStickSensibility,n=e.y*l.UserInputOptions.GamepadRStickSensibility,e.x=Math.abs(t)>l.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(n)>l.UserInputOptions.GamepadDeadStickValue?n:0,e.x=BABYLON.Scalar.Clamp(e.x,-1,1),e.y=BABYLON.Scalar.Clamp(e.y,-1,1),l.InputController.g_mousex2=l.UserInputOptions.GamepadRStickXInverted?-e.x:e.x,l.InputController.g_mousey2=l.UserInputOptions.GamepadRStickYInverted?-e.y:e.y)},e.inputThreeButtonDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad3&&(e="b3:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad3ButtonDown&&0<l.InputController.gamepad3ButtonDown.length&&l.InputController.gamepad3ButtonDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad3ButtonPress&&0<l.InputController.gamepad3ButtonPress.length&&l.InputController.gamepad3ButtonPress.forEach(function(e){e.index===t&&e.action()}))},e.inputThreeButtonUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad3&&(e="b3:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad3ButtonUp)&&0<l.InputController.gamepad3ButtonUp.length&&l.InputController.gamepad3ButtonUp.forEach(function(e){e(t)})},e.inputThreeXboxDPadDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad3&&(e="d3:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad3DpadDown&&0<l.InputController.gamepad3DpadDown.length&&l.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad3DpadPress&&0<l.InputController.gamepad3DpadPress.length&&l.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()}))},e.inputThreeShockDPadDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad3&&(e="d3:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad3DpadDown&&0<l.InputController.gamepad3DpadDown.length&&l.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad3DpadPress&&0<l.InputController.gamepad3DpadPress.length&&l.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()}))},e.inputThreeXboxDPadUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad3&&(e="d3:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad3DpadUp)&&0<l.InputController.gamepad3DpadUp.length&&l.InputController.gamepad3DpadUp.forEach(function(e){e(t)})},e.inputThreeShockDPadUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad3&&(e="d3:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad3DpadUp)&&0<l.InputController.gamepad3DpadUp.length&&l.InputController.gamepad3DpadUp.forEach(function(e){e(t)})},e.inputThreeXboxLeftTriggerHandler=function(t){!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad3&&(l.InputController.keymap["t3:0"]=t,null!=l.InputController.gamepad3LeftTrigger)&&0<l.InputController.gamepad3LeftTrigger.length&&l.InputController.gamepad3LeftTrigger.forEach(function(e){e(t)})},e.inputThreeXboxRightTriggerHandler=function(t){!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad3&&(l.InputController.keymap["t3:1"]=t,null!=l.InputController.gamepad3RightTrigger)&&0<l.InputController.gamepad3RightTrigger.length&&l.InputController.gamepad3RightTrigger.forEach(function(e){e(t)})},e.inputThreeLeftStickHandler=function(e){var t,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad3&&(t=(e=e).x*l.UserInputOptions.GamepadLStickSensibility,n=e.y*l.UserInputOptions.GamepadLStickSensibility,e.x=Math.abs(t)>l.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(n)>l.UserInputOptions.GamepadDeadStickValue?n:0,e.x=BABYLON.Scalar.Clamp(e.x,-1,1),e.y=BABYLON.Scalar.Clamp(e.y,-1,1),l.InputController.g_horizontal3=l.UserInputOptions.GamepadLStickXInverted?-e.x:e.x,l.InputController.g_vertical3=l.UserInputOptions.GamepadLStickYInverted?e.y:-e.y)},e.inputThreeRightStickHandler=function(e){var t,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad3&&(t=(e=e).x*l.UserInputOptions.GamepadRStickSensibility,n=e.y*l.UserInputOptions.GamepadRStickSensibility,e.x=Math.abs(t)>l.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(n)>l.UserInputOptions.GamepadDeadStickValue?n:0,e.x=BABYLON.Scalar.Clamp(e.x,-1,1),e.y=BABYLON.Scalar.Clamp(e.y,-1,1),l.InputController.g_mousex3=l.UserInputOptions.GamepadRStickXInverted?-e.x:e.x,l.InputController.g_mousey3=l.UserInputOptions.GamepadRStickYInverted?-e.y:e.y)},e.inputFourButtonDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad4&&(e="b4:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad4ButtonDown&&0<l.InputController.gamepad4ButtonDown.length&&l.InputController.gamepad4ButtonDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad4ButtonPress&&0<l.InputController.gamepad4ButtonPress.length&&l.InputController.gamepad4ButtonPress.forEach(function(e){e.index===t&&e.action()}))},e.inputFourButtonUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad4&&(e="b4:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad4ButtonUp)&&0<l.InputController.gamepad4ButtonUp.length&&l.InputController.gamepad4ButtonUp.forEach(function(e){e(t)})},e.inputFourXboxDPadDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad4&&(e="d4:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad4DpadDown&&0<l.InputController.gamepad4DpadDown.length&&l.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad4DpadPress&&0<l.InputController.gamepad4DpadPress.length&&l.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()}))},e.inputFourShockDPadDownHandler=function(t){var e,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad4&&(e="d4:"+t.toString(),n=!1,null!=l.InputController.keymap[e]&&(n=l.InputController.keymap[e]),l.InputController.keymap[e]=!0,null!=l.InputController.gamepad4DpadDown&&0<l.InputController.gamepad4DpadDown.length&&l.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),n||null!=l.InputController.gamepad4DpadPress&&0<l.InputController.gamepad4DpadPress.length&&l.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()}))},e.inputFourXboxDPadUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad4&&(e="d4:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad4DpadUp)&&0<l.InputController.gamepad4DpadUp.length&&l.InputController.gamepad4DpadUp.forEach(function(e){e(t)})},e.inputFourShockDPadUpHandler=function(t){var e;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad4&&(e="d4:"+t.toString(),l.InputController.keymap[e]=!1,null!=l.InputController.gamepad4DpadUp)&&0<l.InputController.gamepad4DpadUp.length&&l.InputController.gamepad4DpadUp.forEach(function(e){e(t)})},e.inputFourXboxLeftTriggerHandler=function(t){!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad4&&(l.InputController.keymap["t4:0"]=t,null!=l.InputController.gamepad4LeftTrigger)&&0<l.InputController.gamepad4LeftTrigger.length&&l.InputController.gamepad4LeftTrigger.forEach(function(e){e(t)})},e.inputFourXboxRightTriggerHandler=function(t){!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad4&&(l.InputController.keymap["t4:1"]=t,null!=l.InputController.gamepad4RightTrigger)&&0<l.InputController.gamepad4RightTrigger.length&&l.InputController.gamepad4RightTrigger.forEach(function(e){e(t)})},e.inputFourLeftStickHandler=function(e){var t,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad4&&(t=(e=e).x*l.UserInputOptions.GamepadLStickSensibility,n=e.y*l.UserInputOptions.GamepadLStickSensibility,e.x=Math.abs(t)>l.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(n)>l.UserInputOptions.GamepadDeadStickValue?n:0,e.x=BABYLON.Scalar.Clamp(e.x,-1,1),e.y=BABYLON.Scalar.Clamp(e.y,-1,1),l.InputController.g_horizontal4=l.UserInputOptions.GamepadLStickXInverted?-e.x:e.x,l.InputController.g_vertical4=l.UserInputOptions.GamepadLStickYInverted?e.y:-e.y)},e.inputFourRightStickHandler=function(e){var t,n;!1!==l.SceneManager.EnableUserInput&&null!=l.InputController.gamepad4&&(t=(e=e).x*l.UserInputOptions.GamepadRStickSensibility,n=e.y*l.UserInputOptions.GamepadRStickSensibility,e.x=Math.abs(t)>l.UserInputOptions.GamepadDeadStickValue?t:0,e.y=Math.abs(n)>l.UserInputOptions.GamepadDeadStickValue?n:0,e.x=BABYLON.Scalar.Clamp(e.x,-1,1),e.y=BABYLON.Scalar.Clamp(e.y,-1,1),l.InputController.g_mousex4=l.UserInputOptions.GamepadRStickXInverted?-e.x:e.x,l.InputController.g_mousey4=l.UserInputOptions.GamepadRStickYInverted?-e.y:e.y)},e.inputManagerGamepadConnected=function(e,t){var n;null==l.InputController.gamepad1&&0===e.index&&(l.InputController.gamepad1=e,BABYLON.Tools.Log("Gamepad One Connected: "+l.InputController.gamepad1.id),l.InputController.gamepad1 instanceof BABYLON.Xbox360Pad?(l.InputController.gamepad1Type=l.GamepadType.Xbox360,(n=l.InputController.gamepad1).onbuttonup(l.InputController.inputOneButtonUpHandler),n.onbuttondown(l.InputController.inputOneButtonDownHandler),n.onleftstickchanged(l.InputController.inputOneLeftStickHandler),n.onrightstickchanged(l.InputController.inputOneRightStickHandler),n.ondpadup(l.InputController.inputOneXboxDPadUpHandler),n.ondpaddown(l.InputController.inputOneXboxDPadDownHandler),n.onlefttriggerchanged(l.InputController.inputOneXboxLeftTriggerHandler),n.onrighttriggerchanged(l.InputController.inputOneXboxRightTriggerHandler)):l.InputController.gamepad1 instanceof BABYLON.DualShockPad?(l.InputController.gamepad1Type=l.GamepadType.DualShock,(n=l.InputController.gamepad1).onbuttonup(l.InputController.inputOneButtonUpHandler),n.onbuttondown(l.InputController.inputOneButtonDownHandler),n.onleftstickchanged(l.InputController.inputOneLeftStickHandler),n.onrightstickchanged(l.InputController.inputOneRightStickHandler),n.ondpadup(l.InputController.inputOneShockDPadUpHandler),n.ondpaddown(l.InputController.inputOneShockDPadDownHandler),n.onlefttriggerchanged(l.InputController.inputOneXboxLeftTriggerHandler),n.onrighttriggerchanged(l.InputController.inputOneXboxRightTriggerHandler)):(l.InputController.gamepad1Type=l.GamepadType.Generic,(n=l.InputController.gamepad1).onbuttonup(l.InputController.inputOneButtonUpHandler),n.onbuttondown(l.InputController.inputOneButtonDownHandler),n.onleftstickchanged(l.InputController.inputOneLeftStickHandler),n.onrightstickchanged(l.InputController.inputOneRightStickHandler))),null==l.InputController.gamepad2&&1===e.index&&(l.InputController.gamepad2=e,BABYLON.Tools.Log("Gamepad Two Connected: "+l.InputController.gamepad2.id),l.InputController.gamepad2 instanceof BABYLON.Xbox360Pad?(l.InputController.gamepad2Type=l.GamepadType.Xbox360,(n=l.InputController.gamepad2).onbuttonup(l.InputController.inputTwoButtonUpHandler),n.onbuttondown(l.InputController.inputTwoButtonDownHandler),n.onleftstickchanged(l.InputController.inputTwoLeftStickHandler),n.onrightstickchanged(l.InputController.inputTwoRightStickHandler),n.ondpadup(l.InputController.inputTwoXboxDPadUpHandler),n.ondpaddown(l.InputController.inputTwoXboxDPadDownHandler),n.onlefttriggerchanged(l.InputController.inputTwoXboxLeftTriggerHandler),n.onrighttriggerchanged(l.InputController.inputTwoXboxRightTriggerHandler)):l.InputController.gamepad2 instanceof BABYLON.DualShockPad?(l.InputController.gamepad2Type=l.GamepadType.DualShock,(n=l.InputController.gamepad2).onbuttonup(l.InputController.inputOneButtonUpHandler),n.onbuttondown(l.InputController.inputOneButtonDownHandler),n.onleftstickchanged(l.InputController.inputOneLeftStickHandler),n.onrightstickchanged(l.InputController.inputOneRightStickHandler),n.ondpadup(l.InputController.inputOneShockDPadUpHandler),n.ondpaddown(l.InputController.inputOneShockDPadDownHandler),n.onlefttriggerchanged(l.InputController.inputOneXboxLeftTriggerHandler),n.onrighttriggerchanged(l.InputController.inputOneXboxRightTriggerHandler)):(l.InputController.gamepad2Type=l.GamepadType.Generic,(n=l.InputController.gamepad2).onbuttonup(l.InputController.inputTwoButtonUpHandler),n.onbuttondown(l.InputController.inputTwoButtonDownHandler),n.onleftstickchanged(l.InputController.inputTwoLeftStickHandler),n.onrightstickchanged(l.InputController.inputTwoRightStickHandler))),null==l.InputController.gamepad3&&2===e.index&&(l.InputController.gamepad3=e,BABYLON.Tools.Log("Gamepad Three Connected: "+l.InputController.gamepad3.id),l.InputController.gamepad3 instanceof BABYLON.Xbox360Pad?(l.InputController.gamepad3Type=l.GamepadType.Xbox360,(n=l.InputController.gamepad3).onbuttonup(l.InputController.inputThreeButtonUpHandler),n.onbuttondown(l.InputController.inputThreeButtonDownHandler),n.onleftstickchanged(l.InputController.inputThreeLeftStickHandler),n.onrightstickchanged(l.InputController.inputThreeRightStickHandler),n.ondpadup(l.InputController.inputThreeXboxDPadUpHandler),n.ondpaddown(l.InputController.inputThreeXboxDPadDownHandler),n.onlefttriggerchanged(l.InputController.inputThreeXboxLeftTriggerHandler),n.onrighttriggerchanged(l.InputController.inputThreeXboxRightTriggerHandler)):l.InputController.gamepad3 instanceof BABYLON.DualShockPad?((n=l.InputController.gamepad3).onbuttonup(l.InputController.inputOneButtonUpHandler),n.onbuttondown(l.InputController.inputOneButtonDownHandler),n.onleftstickchanged(l.InputController.inputOneLeftStickHandler),n.onrightstickchanged(l.InputController.inputOneRightStickHandler),n.ondpadup(l.InputController.inputOneShockDPadUpHandler),n.ondpaddown(l.InputController.inputOneShockDPadDownHandler),n.onlefttriggerchanged(l.InputController.inputOneXboxLeftTriggerHandler),n.onrighttriggerchanged(l.InputController.inputOneXboxRightTriggerHandler)):(l.InputController.gamepad3Type=l.GamepadType.Generic,(n=l.InputController.gamepad3).onbuttonup(l.InputController.inputThreeButtonUpHandler),n.onbuttondown(l.InputController.inputThreeButtonDownHandler),n.onleftstickchanged(l.InputController.inputThreeLeftStickHandler),n.onrightstickchanged(l.InputController.inputThreeRightStickHandler))),null==l.InputController.gamepad4&&3===e.index&&(l.InputController.gamepad4=e,BABYLON.Tools.Log("Gamepad Four Connected: "+l.InputController.gamepad4.id),l.InputController.gamepad4 instanceof BABYLON.Xbox360Pad?(l.InputController.gamepad4Type=l.GamepadType.Xbox360,(n=l.InputController.gamepad4).onbuttonup(l.InputController.inputFourButtonUpHandler),n.onbuttondown(l.InputController.inputFourButtonDownHandler),n.onleftstickchanged(l.InputController.inputFourLeftStickHandler),n.onrightstickchanged(l.InputController.inputFourRightStickHandler),n.ondpadup(l.InputController.inputFourXboxDPadUpHandler),n.ondpaddown(l.InputController.inputFourXboxDPadDownHandler),n.onlefttriggerchanged(l.InputController.inputFourXboxLeftTriggerHandler),n.onrighttriggerchanged(l.InputController.inputFourXboxRightTriggerHandler)):l.InputController.gamepad4 instanceof BABYLON.DualShockPad?((n=l.InputController.gamepad4).onbuttonup(l.InputController.inputOneButtonUpHandler),n.onbuttondown(l.InputController.inputOneButtonDownHandler),n.onleftstickchanged(l.InputController.inputOneLeftStickHandler),n.onrightstickchanged(l.InputController.inputOneRightStickHandler),n.ondpadup(l.InputController.inputOneShockDPadUpHandler),n.ondpaddown(l.InputController.inputOneShockDPadDownHandler),n.onlefttriggerchanged(l.InputController.inputOneXboxLeftTriggerHandler),n.onrighttriggerchanged(l.InputController.inputOneXboxRightTriggerHandler)):(l.InputController.gamepad4Type=l.GamepadType.Generic,(n=l.InputController.gamepad4).onbuttonup(l.InputController.inputFourButtonUpHandler),n.onbuttondown(l.InputController.inputFourButtonDownHandler),n.onleftstickchanged(l.InputController.inputFourLeftStickHandler),n.onrightstickchanged(l.InputController.inputFourRightStickHandler))),null!=l.InputController.GamepadConnected&&l.InputController.GamepadConnected(e,t)},e.inputManagerGamepadDisconnected=function(e,t){null!=l.InputController.GamepadDisconnected&&l.InputController.GamepadDisconnected(e,t)},e.MOUSE_DAMPENER=.5,e.GamepadManager=null,e.GamepadConnected=null,e.GamepadDisconnected=null,e.PointerLockedFlag=!1,e.LockMousePointerObserver=null,e.input=!1,e.keymap={},e.scroll=0,e.wheel=0,e.mousex=0,e.mousey=0,e.vertical=0,e.horizontal=0,e.mousex2=0,e.mousey2=0,e.vertical2=0,e.horizontal2=0,e.mousex3=0,e.mousey3=0,e.vertical3=0,e.horizontal3=0,e.mousex4=0,e.mousey4=0,e.vertical4=0,e.horizontal4=0,e.a_mousex=0,e.x_scroll=0,e.x_wheel=0,e.x_mousex=0,e.x_mousey=0,e.x_vertical=0,e.x_horizontal=0,e.k_mousex=0,e.k_mousey=0,e.k_vertical=0,e.k_horizontal=0,e.j_mousex=0,e.j_mousey=0,e.j_vertical=0,e.j_horizontal=0,e.g_mousex1=0,e.g_mousey1=0,e.g_vertical1=0,e.g_horizontal1=0,e.g_mousex2=0,e.g_mousey2=0,e.g_vertical2=0,e.g_horizontal2=0,e.g_mousex3=0,e.g_mousey3=0,e.g_vertical3=0,e.g_horizontal3=0,e.g_mousex4=0,e.g_mousey4=0,e.g_vertical4=0,e.g_horizontal4=0,e.mouseButtonPress=[],e.mouseButtonDown=[],e.mouseButtonUp=[],e.keyButtonPress=[],e.keyButtonDown=[],e.keyButtonUp=[],e.previousPosition=null,e.preventDefault=!1,e.rightHanded=!0,e.gamepad1=null,e.gamepad1Type=-1,e.gamepad1ButtonPress=[],e.gamepad1ButtonDown=[],e.gamepad1ButtonUp=[],e.gamepad1DpadPress=[],e.gamepad1DpadDown=[],e.gamepad1DpadUp=[],e.gamepad1LeftTrigger=[],e.gamepad1RightTrigger=[],e.gamepad2=null,e.gamepad2Type=-1,e.gamepad2ButtonPress=[],e.gamepad2ButtonDown=[],e.gamepad2ButtonUp=[],e.gamepad2DpadPress=[],e.gamepad2DpadDown=[],e.gamepad2DpadUp=[],e.gamepad2LeftTrigger=[],e.gamepad2RightTrigger=[],e.gamepad3=null,e.gamepad3Type=-1,e.gamepad3ButtonPress=[],e.gamepad3ButtonDown=[],e.gamepad3ButtonUp=[],e.gamepad3DpadPress=[],e.gamepad3DpadDown=[],e.gamepad3DpadUp=[],e.gamepad3LeftTrigger=[],e.gamepad3RightTrigger=[],e.gamepad4=null,e.gamepad4Type=-1,e.gamepad4ButtonPress=[],e.gamepad4ButtonDown=[],e.gamepad4ButtonUp=[],e.gamepad4DpadPress=[],e.gamepad4DpadDown=[],e.gamepad4DpadUp=[],e.gamepad4LeftTrigger=[],e.gamepad4RightTrigger=[],l.InputController=e,t.prototype.getValueX=function(){return this.xvalue},t.prototype.getValueY=function(){return this.yvalue},t.prototype.getStickElement=function(){return this.stick},t.prototype.dispose=function(){},t.prototype.handleDown=function(e){this.active=!0,this.stick.style.transition="0s",e.preventDefault(),e.changedTouches?this.dragStart={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:this.dragStart={x:e.clientX,y:e.clientY},e.changedTouches&&(this.touchId=e.changedTouches[0].identifier)},t.prototype.handleMove=function(e){if(this.active){var t=null;if(e.changedTouches){for(var n=0;n<e.changedTouches.length;n++)this.touchId==e.changedTouches[n].identifier&&(t=n,e.clientX=e.changedTouches[n].clientX,e.clientY=e.changedTouches[n].clientY);if(null==t)return}var o=e.clientX-this.dragStart.x,i=e.clientY-this.dragStart.y,r=Math.atan2(i,o),o=Math.min(this.maxDistance,Math.hypot(o,i)),i=o*Math.cos(r),a=o*Math.sin(r),i=(this.stick.style.transform="translate3d(".concat(i,"px, ").concat(a,"px, 0px)"),o<this.deadZone?0:this.maxDistance/(this.maxDistance-this.deadZone)*(o-this.deadZone)),a=i*Math.cos(r),o=i*Math.sin(r),i=parseFloat((a/this.maxDistance).toFixed(4)),r=parseFloat((o/this.maxDistance).toFixed(4));this.xvalue=i,this.yvalue=r}},t.prototype.handleUp=function(e){!this.active||e.changedTouches&&this.touchId!=e.changedTouches[0].identifier||(this.stick.style.transition=".2s",this.stick.style.transform="translate3d(0px, 0px, 0px)",this.xvalue=0,this.yvalue=0,this.touchId=null,this.active=!1)},l.TouchJoystickHandler=t}(UNITY=UNITY||{}),UNITY.InputController),__awaiter=this&&this.__awaiter||function(e,a,l,s){return new(l=l||Promise)(function(n,t){function o(e){try{r(s.next(e))}catch(e){t(e)}}function i(e){try{r(s.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(o,i)}r((s=s.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(o,i){var r,a,l,s={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]},u={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function e(n){return function(e){var t=[n,e];if(r)throw new TypeError("Generator is already executing.");for(;s=u&&t[u=0]?0:s;)try{if(r=1,a&&(l=2&t[0]?a.return:t[0]?a.throw||((l=a.return)&&l.call(a),0):a.next)&&!(l=l.call(a,t[1])).done)return l;switch(a=0,(t=l?[2&t[0],l.value]:t)[0]){case 0:case 1:l=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(l=0<(l=s.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3]))s.label=t[1];else if(6===t[0]&&s.label<l[1])s.label=l[1],l=t;else{if(!(l&&s.label<l[2])){l[2]&&s.ops.pop(),s.trys.pop();continue}s.label=l[2],s.ops.push(t)}}t=i.call(o,s)}catch(e){t=[6,e],a=0}finally{r=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},SM=(!function(d){function e(){}Object.defineProperty(e,"Version",{get:function(){return"1.45.1 - BETA"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Copyright",{get:function(){return"All rights reserved (c) 2024 Mackey Kinard"},enumerable:!1,configurable:!0}),e.HasAudioContext=function(){return null!=BABYLON.Engine.audioEngine&&null!=BABYLON.Engine.audioEngine.audioContext&&null!=BABYLON.Engine.audioEngine.audioContext.state&&"running"===BABYLON.Engine.audioEngine.audioContext.state},Object.defineProperty(e,"PlaygroundCdn",{get:function(){return"https://cdn.jsdelivr.net/gh/BabylonJS/UnityExporter@master/Redist/Runtime/unity.playground.js"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"PlaygroundRepo",{get:function(){return"https://www.babylontoolkit.com/playground/"},enumerable:!1,configurable:!0}),e.InitializePlayground=function(e,o){return void 0===o&&(o=null),__awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return(BABYLON.Tools.Log("Babylon Toolkit For Unity Playground: "+d.SceneManager.Version),n=null==o||null==o.loadProjectScriptBundle||o.loadProjectScriptBundle,t=null!=o&&null!=o.projectScriptBundleUrl?o.projectScriptBundleUrl:d.SceneManager.PlaygroundCdn,!0!==n||null==t||""===t)?[3,2]:(n=t.substring(t.lastIndexOf("/")+1).toLowerCase(),[4,BABYLON.Tools.LoadScriptAsync(t,n)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.EnableSceneParsing=function(e){d.SceneManager.SceneParsingEnabled=e},e.IsSceneParsingEnabled=function(){return d.SceneManager.SceneParsingEnabled},e.HasSceneBeenPreLoaded=function(e){return null!=e._preloaded&&!0===e._preloaded},e.GetFullscreenUI=function(e,t){return void 0===t&&(t=BABYLON.Texture.BILINEAR_SAMPLINGMODE),null==d.SceneManager.AdvDynamicTexture&&(d.SceneManager.AdvDynamicTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("Default-Screen-UI",!0,e,t)),d.SceneManager.AdvDynamicTexture},e.GetDefaultSkybox=function(e){return e.getMeshById("Default Skybox")},e.GetIntensityFactor=function(){return null!=d.SceneManager.GlobalOptions.intensityFactor?d.SceneManager.GlobalOptions.intensityFactor:2},e.GetRenderQuality=function(){var e=d.RenderQuality.High,t=d.SceneManager.GlobalOptions.renderQuality;return e=null!=t?t:e},e.SetRenderQuality=function(e){d.SceneManager.GlobalOptions.renderQuality=e},e.GetWebGLVersionString=function(e){var t="WebGL - Unknown",e=e||d.SceneManager.GetLastCreatedScene();return t=null!=e&&null!=(e=e.getEngine())&&null!=(e=e.getGlInfo())?e.version+" - "+e.renderer:t},e.GetWebGLVersionNumber=function(e){var t=0,e=e||d.SceneManager.GetLastCreatedScene();return t=null!=e&&null!=(e=e.getEngine())?e.webGLVersion:t},e.SetWindowState=function(e,t){d.SceneManager.WindowState[e]=t},e.GetWindowState=function(e){e=d.SceneManager.WindowState[e];return null!=e?e:null},e.IsDebugMode=function(){return null!=d.SceneManager.GlobalOptions.debugModeEnabled&&!0===d.SceneManager.GlobalOptions.debugModeEnabled},e.ConsoleLog=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.SceneManager.IsDebugMode()&&console.log.apply(console,e)},e.ConsoleInfo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.SceneManager.IsDebugMode()&&console.info.apply(console,e)},e.ConsoleWarn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.SceneManager.IsDebugMode()&&console.warn.apply(console,e)},e.ConsoleError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,e)},e.LogMessage=function(e){d.SceneManager.IsDebugMode()&&BABYLON.Tools.Log(e)},e.LogWarning=function(e){d.SceneManager.IsDebugMode()&&BABYLON.Tools.Warn(e)},e.LogError=function(e){BABYLON.Tools.Error(e)},e.GetTime=function(){return.001*d.WindowManager.GetTimeMilliseconds()},e.GetTimeMs=function(){return d.WindowManager.GetTimeMilliseconds()},e.GetGameTime=function(){return.001*(d.WindowManager.GetTimeMilliseconds()-d.SceneManager.GameTimeMilliseconds)},e.GetGameTimeMs=function(){return d.WindowManager.GetTimeMilliseconds()-d.SceneManager.GameTimeMilliseconds},e.GetDeltaSeconds=function(e,t){void 0===t&&(t=!1);var e=e||d.SceneManager.GetLastCreatedScene(),n=.001*Math.max(BABYLON.Scene.MinDeltaTime,Math.min(e.getEngine().getDeltaTime(),BABYLON.Scene.MaxDeltaTime));return!0===t&&(n*=e.getAnimationRatio()),n},e.GetDeltaMilliseconds=function(e,t){void 0===t&&(t=!1);var e=e||d.SceneManager.GetLastCreatedScene(),n=Math.max(BABYLON.Scene.MinDeltaTime,Math.min(e.getEngine().getDeltaTime(),BABYLON.Scene.MaxDeltaTime));return!0===t&&(n*=e.getAnimationRatio()),n},e.GetAnimationRatio=function(e){return(e||d.SceneManager.GetLastCreatedScene()).getAnimationRatio()},e.RunOnce=function(e,t,n){e.executeOnceBeforeRender(t,n)},e.DisposeScene=function(e,t){void 0===t&&(t=new BABYLON.Color4(0,0,0,1));var n=e.getEngine();e.dispose(),n.clear(t,!0,!0,!0)},e.SafeDestroy=function(e,t,n){void 0===n&&(n=!1),0<(t=void 0===t?5:t)?(!0===n&&e.setEnabled(!1),d.WindowManager.SetTimeout(t,function(){e.dispose(!1,!1)})):e.dispose(!1,!1)},e.GetRootUrl=function(e){return null!=e._rootUrl&&""!==e._rootUrl?e._rootUrl:"/"},e.SetRootUrl=function(e,t){e._rootUrl=t},e.GetSceneFile=function(e){return null!=e._fileName&&""!==e._fileName?e._fileName:null},e.SetSceneFile=function(e,t){e._fileName=t},e.GetEngineInstances=function(){return BABYLON.EngineStore.Instances},e.GetLastCreatedEngine=function(){return BABYLON.EngineStore.LastCreatedEngine},e.GetLastCreatedScene=function(){return BABYLON.EngineStore.LastCreatedScene},e.AddShadowCaster=function(e,t){e=(null==e?void 0:e.getShadowGenerator()).getShadowMap();null==e.renderList&&(e.renderList=[]),e.renderList.indexOf(t)<0&&e.renderList.push(t)},e.GetImportMeshes=function(e,t){return null!=e&&null!=t&&""!==t&&null!=e.importMeshes?e.importMeshes.get(t.toLowerCase()):null},e.GetImportMeshMap=function(e){return null!=e&&null!=e.importMeshes?e.importMeshes:null},e.ClearImportMeshes=function(e){if(null==e)return null;e.importMeshes,e.importMeshes=new Map},e.RegisterImportMeshes=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.importMeshes&&(e.importMeshes=new Map),e.importMeshes.set(t.toLowerCase(),n))},e.GetAssetContainer=function(e,t){return null!=e&&null!=t&&""!==t&&null!=e.assetContainers?e.assetContainers.get(t.toLowerCase()):null},e.GetAssetContainerMap=function(e){return null!=e&&null!=e.assetContainers?e.assetContainers:null},e.ClearAssetContainers=function(e){if(null==e)return null;e.assetContainers,e.assetContainers=new Map},e.RegisterAssetContainer=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.assetContainers&&(e.assetContainers=new Map),e.assetContainers.set(t.toLowerCase(),n))},e.GetMesh=function(e,t){return null==e?null:e.getNodeByName(t)},e.GetMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},e.GetAbstractMesh=function(e,t){return null==e?null:e.getNodeByName(t)},e.GetAbstractMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},e.GetTransformNode=function(e,t){return null==e?null:e.getNodeByName(t)},e.GetTransformNodeByID=function(e,t){return null==e?null:e.getNodeById(t)},e.GetTransformDetailMesh=function(e){var t=null,n=e.name+".Detail",e=e.getChildren(function(e){return e.name===n&&e instanceof BABYLON.AbstractMesh},!0);return t=null!=e&&0<e.length?e[0]:t},e.GetSkinnedMesh=function(e){return null!=e._skinnedMesh?e._skinnedMesh:null},e.GetPrimitiveMeshes=function(e){return e.getChildMeshes(!0,function(e){return 0<=e.name.indexOf("_primitive")})},e.GetTransformLayer=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.layer?e.metadata.unity.layer:0},e.GetTransformLayerMask=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.layermask?e.metadata.unity.layermask:1},e.GetTransformLayerName=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.layername&&""!==e.metadata.unity.layername?e.metadata.unity.layername:"Default"},e.GetTransformTag=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.group&&""!==e.metadata.unity.group?e.metadata.unity.group:"Untagged"},e.HasTransformTags=function(e,t){return BABYLON.Tags.MatchesQuery(e,t)},e.TextureFloatSupported=function(e){var t=!1,n=!1,e=e.getEngine().getCaps();return e.textureHalfFloatRender&&e.textureHalfFloatLinearFiltering?t=!0:e.textureFloatRender&&e.textureFloatLinearFiltering&&(n=!0),t||n},e.RegisterClickAction=function(e,t,n){var o=null;return null!=t&&(t.isPickable=!0,null==t.actionManager&&(t.actionManager=new BABYLON.ActionManager(e)),o=t.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnPickTrigger},n))),o},e.UnregisterClickAction=function(e,t){var n=!1;return n=null!=e&&null!=t?e.actionManager.unregisterAction(t):n},e.StartTweenAnimation=function(e,t,n,o,i,r,a,l,s,u,c){void 0===l&&(l=null),void 0===u&&(u=null),void 0===c&&(c=null);a=(a=void 0===a?1:a)||1,s=(s=void 0===s?null:s)||BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,t=d.Utilities.CreateTweenAnimation(t,o,i,r,l||30,s),null!=u&&t.setEasingFunction(u),o=d.Utilities.GetLastKeyFrameIndex(t),i=s!=BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT;return e.beginDirectAnimation(n,[t],0,o,i,a,c)},e.StartNativeTween=function(e,t){return createjs.Tween.get(e,t)},e.GetMaterialWithName=function(e,t){var n=null;if(null!=e.materials&&0<e.materials.length){e.materials.length;for(var o=0;o<e.materials.length;o++){var i=e.materials[o];if(i.name.startsWith(t)){n=i;break}}}return n},e.GetAllMaterialsWithName=function(e,t){var n=null;if(null!=e.materials&&0<e.materials.length){e.materials.length;for(var o=0;o<e.materials.length;o++){var i=e.materials[o];i.name.startsWith(t)&&(n=null==n?[]:n).push(i)}}return n},e.InstantiatePrefabFromScene=function(r,e,t,n,o,i,a,l){void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===a&&(a=null),void 0===l&&(l=!0);var s,u,c,l=null;return null!=r&&null!=e&&""!==e?null!=(s=r.getNodeByName(e))?null!=(l=s.clone(t,n,!1))?(null!=o&&(l.position=o.clone()),null!=i&&(l.rotationQuaternion=i.clone()),null!=a&&(l.scaling=a.clone()),null==(s=null!=(t=l.getChildren(s=null,!1))?t:s)?s=[l]:s.unshift(l),s.forEach(function(n){if(n.setEnabled(!0),n instanceof BABYLON.AbstractMesh&&null!=n.metadata&&null!=n.metadata.shadowCastingMode&&0!==n.metadata.shadowCastingMode&&r.lights.forEach(function(e){var t=e.getShadowGenerator();null!=t&&!1==(null!=e.includedOnlyMeshes&&0<e.includedOnlyMeshes.length)&&(null==(e=t.getShadowMap()).renderList&&(e.renderList=[]),e.renderList.indexOf(n)<0)&&e.renderList.push(n)}),n instanceof BABYLON.Mesh)if(null!=n.source){if(null==n.skeleton&&null!=n.source.skeleton){var e=n.source.skeleton.name+".Skeleton",t=e+"."+n.source.skeleton.id;if(n.skeleton=n.source.skeleton.clone(e,t),null!=n.skeleton&&null!=n.skeleton.bones&&null!=n.source.skeleton.bones&&n.skeleton.bones.length===n.source.skeleton.bones.length)for(var o=n.skeleton.bones.length,i=0;i<o;i++)null==n.skeleton.bones[i].metadata&&null!=n.source.skeleton.bones[i].metadata&&(n.skeleton.bones[i].metadata=n.source.skeleton.bones[i].metadata)}}else BABYLON.Tools.Warn("Babylon.js encountered a null clone source for: "+n.name)}),u=[],s.forEach(function(e){u.push(e)}),null!=u&&0<u.length&&(d.Utilities.PostParseSceneComponents(r,u,null,c=[]),r.onAfterRenderObservable.addOnce(function(){if(null!=c&&0<c.length)for(var e=0;e<c.length;e++){var t=c[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}}))):BABYLON.Tools.Warn("Failed to create prefab of: "+e):BABYLON.Tools.Warn("Failed to lookup prefab map: "+e):BABYLON.Tools.Warn("Unable to locate prefab master: "+e),l},e.InstantiatePrefabFromContainer=function(e,t,n,o,i,r,a,l,s){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null);var u,c,t=d.Utilities.CloneAssetContainerItem(e,t,function(e){return e},o=void 0===o?null:o,s=void 0===s?!1:s,l=void 0===l?!0:l);return null!=t&&(null!=n&&""!==n&&(t.name=n),null!=i&&(t.position=i.clone()),null!=r&&(t.rotationQuaternion=r.clone()),null!=a&&(t.scaling=a.clone()),(u=[]).push(t),null!=(o=t.getChildren(null,!1))&&0<o.length&&o.forEach(function(e){u.push(e)}),u.forEach(function(e){e.id=d.Utilities.CreateGuid(),e.setEnabled(!0)}),d.Utilities.PostParseSceneComponents(e.scene,u,null,c=[]),e.scene.onAfterRenderObservable.addOnce(function(){if(null!=c&&0<c.length)for(var e=0;e<c.length;e++){var t=c[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})),t},e.CloneTransformNode=function(e,t,n,o,i,r,a){void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null);e=d.Utilities.GetAssetContainerNode(e,t).clone(n,o,!0);return null!=e&&(null!=i&&(e.position=i.clone()),null!=r&&(e.rotationQuaternion=r.clone()),null!=a&&(e.scaling=a.clone()),e.setEnabled(!0)),e},e.CloneAbstractMesh=function(e,t,n,o,i,r,a){void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null);e=d.Utilities.GetAssetContainerMesh(e,t).clone(n,o,!0);return null!=e&&(null!=i&&(e.position=i.clone()),null!=r&&(e.rotationQuaternion=r.clone()),null!=a&&(e.scaling=a.clone()),e.setEnabled(!0)),e},e.CreateInstancedMesh=function(e,t,n,o,i,r,a){void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null);e=d.Utilities.GetAssetContainerMesh(e,t).createInstance(n);return null!=e&&(null!=o&&(e.parent=o),null!=i&&(e.position=i.clone()),null!=r&&(e.rotationQuaternion=r.clone()),null!=a&&(e.scaling=a.clone()),e.setEnabled(!0)),e},e.AttachScriptComponent=function(e,t,n){void 0===n&&(n=!0),null!=e&&e.registerComponentInstance&&e.registerComponentInstance(e,t,n)},e.DestroyScriptComponent=function(e){null!=e&&e.destroyComponentInstance&&e.destroyComponentInstance(e)},e.FindScriptComponent=function(e,t,n){if(void 0===n&&(n=!1),null==e)return null;var o=null;if(null!=e.metadata&&e.metadata.unity){var i=e.metadata.unity;if(null!=i.components&&0<i.components.length)for(var r=0;r<i.components.length;r++){var a=i.components[r];if(null!=a.instance&&a.klass===t){o=a.instance;break}}}if(null==o&&!0===n){var l=e.getChildren(null,!1);if(null!=l)for(var s=0;s<l.length;s++){var u=l[s];if(null!=(o=d.SceneManager.FindScriptComponent(u,t,!1)))break}}return null!=o?o:null},e.FindAllScriptComponents=function(e,t,n){if(void 0===n&&(n=!1),null==e)return null;var o=null;if(null!=e.metadata&&e.metadata.unity){var i=e.metadata.unity;if(null!=i.components&&0<i.components.length)for(var r=0;r<i.components.length;r++){var a=i.components[r];null!=a.instance&&a.klass===t&&(o=null==o?[]:o).push(a.instance)}}if(!0===n){var l=e.getChildren(null,!1);if(null!=l)for(var s=0;s<l.length;s++){var u=l[s],u=d.SceneManager.FindAllScriptComponents(u,t,!1);null!=u&&(o=null==o?[]:o).push.apply(o,u)}}return null!=o?o:null},e.FindSceneMetadata=function(e){return null!=e&&null!=e.metadata&&e.metadata.unity?e.metadata.unity:null},e.FindSceneCameraRig=function(e){return null!=e&&null!=e.cameraRig?e.cameraRig:null},e.FindSceneLightRig=function(e){return null!=e&&null!=e.lightRig?e.lightRig:null},e.FindTransformWithScript=function(e,t){e=e.getNodes();return d.Utilities.SearchTransformNodeForScript(t,e)},e.FindAllTransformsWithScript=function(e,t){e=e.getNodes();return d.Utilities.SearchAllTransformNodesForScript(t,e)},e.FindChildTransformNode=function(e,t,n,o,i){return void 0===n&&(n=d.SearchType.ExactMatch),void 0===o&&(o=!0),void 0===i&&(i=null),null==e?null:(n=null!=n?n:d.SearchType.ExactMatch,e=e.getChildren(i,o),d.Utilities.SearchTransformNodes(t,e,n))},e.FindChildTransformWithTags=function(e,t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),null==e?null:(e=e.getChildren(o,n),d.Utilities.SearchTransformNodeForTags(t,e))},e.FindAllChildTransformsWithTags=function(e,t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),null==e?null:(e=e.getChildren(o,n),d.Utilities.SearchAllTransformNodesForTags(t,e))},e.FindChildTransformWithScript=function(e,t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),null==e?null:(e=e.getChildren(o,n),d.Utilities.SearchTransformNodeForScript(t,e))},e.FindAllChildTransformsWithScript=function(e,t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),null==e?null:(e=e.getChildren(o,n),d.Utilities.SearchAllTransformNodesForScript(t,e))},e.SearchForScriptComponentByName=function(e,t){e=e.getNodes(),e=d.Utilities.SearchTransformNodeForScript(t,e);return d.SceneManager.FindScriptComponent(e,t)},e.SearchForAllScriptComponentsByName=function(e,t){var n=null,e=e.getNodes(),e=d.Utilities.SearchAllTransformNodesForScript(t,e);return null!=e&&0<e.length&&e.forEach(function(e){e=d.SceneManager.FindScriptComponent(e,t);null!=e&&(n=null==n?[]:n).push(e)}),null!=n?n:null},e.MoveWithCollisions=function(e,t){if(null==e)return null;null!=t&&e.moveWithCollisions(t)},e.MoveWithTranslation=function(e,t){if(null==e)return null;null!=t&&e.position.addInPlace(t)},e.TurnWithRotation=function(e,t,n){if(void 0===n&&(n=BABYLON.Space.LOCAL),null==e)return null;0!=t&&e.rotate(BABYLON.Axis.Y,t,n)},e.GetRecastHeapSize=function(){var e;return"undefined"==typeof Recast?0:(e=0,Recast&&Recast.HEAP8&&Recast.HEAP8.length?Recast.HEAP8.length/1048576:e)},e.GetNavigationTools=function(){if("undefined"!=typeof Recast)return null==d.SceneManager.PluginInstance&&(d.SceneManager.PluginInstance=new BABYLON.RecastJSPlugin),d.SceneManager.PluginInstance},e.GetCrowdInterface=function(e){var t;return"undefined"!=typeof Recast&&d.SceneManager.HasNavigationData()?(null!=(t=d.SceneManager.GetNavigationTools())&&null==d.SceneManager.CrowdInterface&&(d.SceneManager.CrowdInterface=t.createCrowd(d.SceneManager.MAX_AGENT_COUNT,d.SceneManager.MAX_AGENT_RADIUS,e)),d.SceneManager.CrowdInterface):null},e.HasNavigationData=function(){var e;return"undefined"!=typeof Recast&&null!=(e=d.SceneManager.GetNavigationTools())&&null!=e.navMesh},e.GetNavigationMesh=function(){return"undefined"==typeof Recast?null:d.SceneManager.NavigationMesh},e.BakeNavigationMesh=function(e,t,n,o,i,r){if(void 0===o&&(o=!1),void 0===i&&(i=null),void 0===r&&(r=!1),"undefined"==typeof Recast)return null;BABYLON.Tools.Log("Recast.js baking navigation mesh data");var a=d.SceneManager.GetNavigationTools();return null!=a&&(a.createNavMesh(t,n),null!=a.navMesh?(null==(n=e.getMaterialByName(t="NavigationMesh"))&&((n=new BABYLON.StandardMaterial(t,e)).diffuseColor=i||new BABYLON.Color3(.05,.225,.75),n.alpha=.5),d.SceneManager.NavigationMesh=a.createDebugNavMesh(e),null!=d.SceneManager.NavigationMesh&&(d.SceneManager.NavigationMesh.material=n,d.SceneManager.NavigationMesh.isPickable=!0,d.SceneManager.NavigationMesh.isVisible=!0,d.SceneManager.NavigationMesh.visibility=!0===o?1:0,d.SceneManager.NavigationMesh.renderingGroupId=d.Utilities.ColliderRenderGroup(),BABYLON.Tags.AddTagsTo(d.SceneManager.NavigationMesh,"Navigation"),d.Utilities.ValidateTransformMetadata(d.SceneManager.NavigationMesh),!0===r)&&(d.SceneManager.NavigationMesh.checkCollisions=!0,d.SceneManager.NavigationMesh.metadata.unity.physics=d.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new BABYLON.Vector3(0,0,0)),d.SceneManager.NavigationMesh.metadata.unity.collision=d.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),d.RigidbodyPhysics.SetupPhysicsComponent(e,d.SceneManager.NavigationMesh)),null!=d.SceneManager.NavigationMesh?!0===d.SceneManager.OnNavMeshReadyObservable.hasObservers()&&d.SceneManager.OnNavMeshReadyObservable.notifyObservers(d.SceneManager.NavigationMesh):BABYLON.Tools.Warn("Failed to generate navigation mesh geometry")):BABYLON.Tools.Warn("Failed to create navigation mesh data")),d.SceneManager.NavigationMesh},e.LoadNavigationMesh=function(e,t,n,o,i,r){if(void 0===n&&(n=!1),void 0===o&&(o=null),void 0===i&&(i=0),void 0===r&&(r=!1),"undefined"==typeof Recast)return null;BABYLON.Tools.Log("Recast.js loading prebaked navigation mesh");var a=d.SceneManager.GetNavigationTools();return null!=a&&(a.setTimeStep&&a.setTimeStep(i),a.buildFromNavmeshData(t),null!=a.navMesh?(null==(t=e.getMaterialByName(i="NavigationMesh"))&&((t=new BABYLON.StandardMaterial(i,e)).diffuseColor=o||new BABYLON.Color3(.05,.225,.75),t.alpha=.5),d.SceneManager.NavigationMesh=a.createDebugNavMesh(e),null!=d.SceneManager.NavigationMesh&&(d.SceneManager.NavigationMesh.material=t,d.SceneManager.NavigationMesh.isPickable=!0,d.SceneManager.NavigationMesh.isVisible=!0,d.SceneManager.NavigationMesh.visibility=!0===n?1:0,d.SceneManager.NavigationMesh.renderingGroupId=d.Utilities.ColliderRenderGroup(),BABYLON.Tags.AddTagsTo(d.SceneManager.NavigationMesh,"Navigation"),d.Utilities.ValidateTransformMetadata(d.SceneManager.NavigationMesh),!0===r)&&(d.SceneManager.NavigationMesh.checkCollisions=!0,d.SceneManager.NavigationMesh.metadata.unity.physics=d.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new BABYLON.Vector3(0,0,0)),d.SceneManager.NavigationMesh.metadata.unity.collision=d.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),d.RigidbodyPhysics.SetupPhysicsComponent(e,d.SceneManager.NavigationMesh)),null!=d.SceneManager.NavigationMesh?!0===d.SceneManager.OnNavMeshReadyObservable.hasObservers()&&d.SceneManager.OnNavMeshReadyObservable.notifyObservers(d.SceneManager.NavigationMesh):BABYLON.Tools.Warn("Failed to generate navigation mesh geometry")):BABYLON.Tools.Warn("Failed to build navigation mesh data")),d.SceneManager.NavigationMesh},e.SaveNavigationMesh=function(){var e;return"undefined"!=typeof Recast&&null!=(e=d.SceneManager.GetNavigationTools())&&null!=e.navMesh?e.getNavmeshData():null},e.ComputeNavigationPath=function(e,t,n){var o;return void 0===n&&(n=!0),"undefined"!=typeof Recast&&(o=d.SceneManager.GetNavigationTools(),e=!0===n?o.getClosestPoint(e):e,n=!0===n?o.getClosestPoint(t):t,null!=o)&&null!=o.navMesh?o.computePath(e,n):null},e.MoveAlongNavigationPath=function(e,t,n,o,i,r){void 0===i&&(i=null);var a=null;if(n&&0<n.length){for(var l=0,s=[{frame:0,value:t.position}],u=0;u<n.length;u++)l+=BABYLON.Vector3.Distance(s[u].value,n[u]),s.push({frame:l,value:n[u]});a=new BABYLON.Animation("Navigation","position",3,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),null!=i&&a.setEasingFunction(i),a.setKeys(s),t.animations=[a],e.beginAnimation(t,0,l,!1,o,r)}return a},e.AddNavigationCylinderObstacle=function(e,t,n){var o;return"undefined"!=typeof Recast&&null!=(o=d.SceneManager.GetNavigationTools())&&null!=o.navMesh?o.addCylinderObstacle(e,t,n):null},e.AddNavigationBoxObstacle=function(e,t,n){var o;return"undefined"!=typeof Recast&&null!=(o=d.SceneManager.GetNavigationTools())&&null!=o.navMesh?o.addBoxObstacle(e,t,n):null},e.RemoveNavigationObstacle=function(e){if("undefined"==typeof Recast)return null;var t=d.SceneManager.GetNavigationTools();null!=t&&null!=t.navMesh&&t.removeObstacle(e)},e.ToggleFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().switchFullscreen(t)},e.EnterFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().enterFullscreen(t)},e.ExitFullscreenMode=function(e){e.getEngine().exitFullscreen()},e.WindowState={},e.GlobalOptions={},e.ServerEndPoint="http://127.0.0.1:2567",e.EnableDebugMode=!1,e.EnableUserInput=!0,e.RenderLoopReady=!0,e.PauseRenderLoop=!1,e.LostRenderContext=!1,e.AutoUpdateProgress=!0,e.PhysicsCapsuleShape=0,e.SupportSRGBBuffers=!1,e.AnimationStartMode=0,e.AnimationTargetFps=30,e.DefaultConvexHullMargin=.001,e.DefaultHeightFieldMargin=.001,e.AmbientLightIntensity=.5,e.PointLightIntensity=1,e.SpotLightIntensity=10,e.DirectionalLightIntensity=2,e.TerrainColorCorrection=2.2,e.AllowCameraMovement=!0,e.AllowCameraRotation=!0,e.VirtualJoystickEnabled=!1,e.GameTimeMilliseconds=0,e.ParseScriptComponents=!0,e.AutoLoadScriptBundles=!0,e.WaitForSeconds=function(t){return new Promise(function(e){return d.WindowManager.SetTimeout(1e3*t,e)})},e.OnPreRenderLoopObservable=new BABYLON.Observable,e.OnPostRenderLoopObservable=new BABYLON.Observable,e.OnSceneReadyObservable=new BABYLON.Observable,e.OnEngineResizeObservable=new BABYLON.Observable,e.OnLoadCompleteObservable=new BABYLON.Observable,e.OnRebuildContextObservable=new BABYLON.Observable,e.OnAssetManagerProgress=null,e.SceneParsingEnabled=!0,e.AdvDynamicTexture=null,e.MAX_AGENT_COUNT=200,e.MAX_AGENT_RADIUS=2,e.NavigationMesh=null,e.CrowdInterface=null,e.PluginInstance=null,e.OnNavMeshReadyObservable=new BABYLON.Observable,d.SceneManager=e}(UNITY=UNITY||{}),UNITY.SceneManager),__extends=(UNITY.SceneManager.GameTimeMilliseconds=UNITY.WindowManager.GetTimeMilliseconds(),this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}()),UTIL=(!function(A){(e=A.System||(A.System={}))[e.Deg2Rad=2*Math.PI/360]="Deg2Rad",e[e.Rad2Deg=1/A.System.Deg2Rad]="Rad2Deg",e[e.Epsilon=1e-6]="Epsilon",e[e.SingleEpsilon=1401298e-51]="SingleEpsilon",e[e.EpsilonNormalSqrt=1e-15]="EpsilonNormalSqrt",e[e.Kph2Mph=.621371]="Kph2Mph",e[e.Mph2Kph=1.60934]="Mph2Kph",e[e.Mps2Kph=3.6]="Mps2Kph",e[e.Mps2Mph=2.23694]="Mps2Mph",e[e.Meter2Inch=39.3701]="Meter2Inch",e[e.Inch2Meter=.0254]="Inch2Meter",e[e.Gravity=9.81]="Gravity",e[e.Gravity3G=29.400000000000002]="Gravity3G",e[e.SkidFactor=.25]="SkidFactor",e[e.MaxInteger=2147483647]="MaxInteger",e[e.WalkingVelocity=4.4]="WalkingVelocity",e[e.TerminalVelocity=55]="TerminalVelocity",e[e.SmoothDeltaFactor=.2]="SmoothDeltaFactor",e[e.ToLinearSpace=2.2]="ToLinearSpace",e[e.ToGammaSpace=.45454545454545453]="ToGammaSpace",(e=A.Handedness||(A.Handedness={}))[e.Default=-1]="Default",e[e.Right=0]="Right",e[e.Left=1]="Left",(e=A.SearchType||(A.SearchType={}))[e.ExactMatch=0]="ExactMatch",e[e.StartsWith=1]="StartsWith",e[e.EndsWith=2]="EndsWith",e[e.IndexOf=3]="IndexOf",(e=A.PlayerNumber||(A.PlayerNumber={}))[e.Auto=0]="Auto",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",(e=A.PlayerControl||(A.PlayerControl={}))[e.FirstPerson=0]="FirstPerson",e[e.ThirdPerson=1]="ThirdPerson",(e=A.RenderQuality||(A.RenderQuality={}))[e.High=0]="High",e[e.Medium=1]="Medium",e[e.Low=2]="Low",(e=A.GamepadType||(A.GamepadType={}))[e.None=-1]="None",e[e.Generic=0]="Generic",e[e.Xbox360=1]="Xbox360",e[e.DualShock=2]="DualShock",e[e.PoseController=3]="PoseController",(e=A.Xbox360Trigger||(A.Xbox360Trigger={}))[e.Left=0]="Left",e[e.Right=1]="Right",(e=A.MovementType||(A.MovementType={}))[e.DirectVelocity=0]="DirectVelocity",e[e.AppliedForces=1]="AppliedForces",(e=A.CollisionContact||(A.CollisionContact={}))[e.Top=0]="Top",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Bottom=3]="Bottom",(e=A.IntersectionPrecision||(A.IntersectionPrecision={}))[e.AABB=0]="AABB",e[e.OBB=1]="OBB",(e=A.CollisionFilters||(A.CollisionFilters={}))[e.DefaultFilter=1]="DefaultFilter",e[e.StaticFilter=2]="StaticFilter",e[e.KinematicFilter=4]="KinematicFilter",e[e.DebrisFilter=8]="DebrisFilter",e[e.SensorTrigger=16]="SensorTrigger",e[e.CharacterFilter=32]="CharacterFilter",e[e.AllFilter=-1]="AllFilter",(e=A.CollisionState||(A.CollisionState={}))[e.ACTIVE_TAG=1]="ACTIVE_TAG",e[e.ISLAND_SLEEPING=2]="ISLAND_SLEEPING",e[e.WANTS_DEACTIVATION=3]="WANTS_DEACTIVATION",e[e.DISABLE_DEACTIVATION=4]="DISABLE_DEACTIVATION",e[e.DISABLE_SIMULATION=5]="DISABLE_SIMULATION",(e=A.CollisionFlags||(A.CollisionFlags={}))[e.CF_STATIC_OBJECT=1]="CF_STATIC_OBJECT",e[e.CF_KINEMATIC_OBJECT=2]="CF_KINEMATIC_OBJECT",e[e.CF_NO_CONTACT_RESPONSE=4]="CF_NO_CONTACT_RESPONSE",e[e.CF_CUSTOM_MATERIAL_CALLBACK=8]="CF_CUSTOM_MATERIAL_CALLBACK",e[e.CF_CHARACTER_OBJECT=16]="CF_CHARACTER_OBJECT",e[e.CF_DISABLE_VISUALIZE_OBJECT=32]="CF_DISABLE_VISUALIZE_OBJECT",e[e.CF_DISABLE_SPU_COLLISION_PROCESSING=64]="CF_DISABLE_SPU_COLLISION_PROCESSING",e[e.CF_HAS_CONTACT_STIFFNESS_DAMPING=128]="CF_HAS_CONTACT_STIFFNESS_DAMPING",e[e.CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR=256]="CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR",e[e.CF_HAS_FRICTION_ANCHOR=512]="CF_HAS_FRICTION_ANCHOR",e[e.CF_HAS_COLLISION_SOUND_TRIGGER=1024]="CF_HAS_COLLISION_SOUND_TRIGGER",(e=A.UserInputPointer||(A.UserInputPointer={}))[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",(e=A.UserInputAxis||(A.UserInputAxis={}))[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.ClientX=2]="ClientX",e[e.ClientY=3]="ClientY",e[e.MouseX=4]="MouseX",e[e.MouseY=5]="MouseY",e[e.Wheel=6]="Wheel",(e=A.UserInputKey||(A.UserInputKey={}))[e.BackSpace=8]="BackSpace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Pause=19]="Pause",e[e.Break=19]="Break",e[e.CapsLock=20]="CapsLock",e[e.Escape=27]="Escape",e[e.SpaceBar=32]="SpaceBar",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.LeftArrow=37]="LeftArrow",e[e.UpArrow=38]="UpArrow",e[e.RightArrow=39]="RightArrow",e[e.DownArrow=40]="DownArrow",e[e.Insert=45]="Insert",e[e.Delete=46]="Delete",e[e.Num0=48]="Num0",e[e.Num1=49]="Num1",e[e.Num2=50]="Num2",e[e.Num3=51]="Num3",e[e.Num4=52]="Num4",e[e.Num5=53]="Num5",e[e.Num6=54]="Num6",e[e.Num7=55]="Num7",e[e.Num8=56]="Num8",e[e.Num9=57]="Num9",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.LeftWindowKey=91]="LeftWindowKey",e[e.RightWindowKey=92]="RightWindowKey",e[e.SelectKey=93]="SelectKey",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.Multiply=106]="Multiply",e[e.Add=107]="Add",e[e.Subtract=109]="Subtract",e[e.DecimalPoint=110]="DecimalPoint",e[e.Divide=111]="Divide",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=144]="NumLock",e[e.ScrollLock=145]="ScrollLock",e[e.SemiColon=186]="SemiColon",e[e.EqualSign=187]="EqualSign",e[e.Comma=188]="Comma",e[e.Dash=189]="Dash",e[e.Period=190]="Period",e[e.ForwardSlash=191]="ForwardSlash",e[e.GraveAccent=192]="GraveAccent",e[e.OpenBracket=219]="OpenBracket",e[e.BackSlash=220]="BackSlash",e[e.CloseBraket=221]="CloseBraket",e[e.SingleQuote=222]="SingleQuote",t.KeyboardSmoothing=!1,t.KeyboardMoveSensibility=3,t.KeyboardMoveDeadZone=.001,t.GamepadDeadStickValue=.25,t.GamepadLStickXInverted=!1,t.GamepadLStickYInverted=!1,t.GamepadRStickXInverted=!1,t.GamepadRStickYInverted=!0,t.GamepadLStickSensibility=1,t.GamepadRStickSensibility=1,t.SupportedInputDevices=null,t.PointerAngularSensibility=.5,t.PointerWheelDeadZone=.1,t.PointerMouseDeadZone=.1,t.PointerMouseInverted=!0,t.UseCanvasElement=!0,t.UseArrowKeyRotation=!1;var e=t;function t(){}A.UserInputOptions=e;function n(){this.mesh=null,this.state=0}function o(){}A.RequestHeader=function(){},A.TriggerVolume=n;A.RoomErrorMessage=o,i.prototype.displayLoadingUI=function(){var e,t;this.hasLoadingDiv()?this.showLoadingDiv(!0):((e=document.createElement("style")).type="text/css",e.innerHTML=this.customInnerCss||"",document.getElementsByTagName("head")[0].appendChild(e),e=this.loadingUIText,(t=document.createElement("div")).id=this.loadingDivId,t.innerHTML=this.customInnerHtml||e,document.body.appendChild(t))},i.prototype.hideLoadingUI=function(){!0===this.hideLoadingUIWithEngine&&this.showLoadingDiv(!1)},i.prototype.showLoadingDiv=function(e){var t=this.getLoadingDiv();null!=t&&(t.style.display=e?"initial":"none")},i.prototype.getLoadingDiv=function(){return document.getElementById(this.loadingDivId)},i.prototype.hasLoadingDiv=function(){return null!=document.getElementById(this.loadingDivId)};e=i;function i(e,t,n,o,i){void 0===n&&(n=!0),void 0===o&&(o=null),void 0===i&&(i=null),this.loadingDivId=e,this.loadingUIText=t,this.hideLoadingUIWithEngine=n,this.customInnerHtml=o,this.customInnerCss=i,this.loadingUIBackgroundColor="#000000",null!=this.loadingDivId&&""!==this.loadingDivId||(this.loadingDivId="customLoadingScreen"),null!=this.loadingUIText&&""!==this.loadingUIText||(this.loadingUIText="Please Wait")}function r(){this.ListenerDictionary={}}function a(e,t,n,o,i,r){void 0===n&&(n=1),void 0===o&&(o=!0),void 0===i&&(i=!1),void 0===r&&(r=!0),this.prefabName=null,this.allowGrowth=!0,this.assetContainer=null,this.cloneAnimations=!0,this.makeNewMaterials=!1,this.availableInstances=null,this.prefabName=t,this.allowGrowth=o,this.assetContainer=e,this.cloneAnimations=r,this.makeNewMaterials=i,this.availableInstances=[],this.populatePool(n)}function l(){this._hit=!1,this._dest=new BABYLON.Vector3(0,0,0),this._origin=new BABYLON.Vector3(0,0,0),this._hitPoint=new BABYLON.Vector3(0,0,0),this._hitNormal=new BABYLON.Vector3(0,0,0),this._hitDistance=0,this._collisionObject=null,this.reset(BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero())}function s(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=.5),this._numPoints=-1,this._pointMesh=null,this._pointSize=.5,this._pointType=0,this._linesName="MeshLines",this._linesMesh=null,this._babylonScene=null,this._pointMesh=null,this._linesMesh=null,this._linesName=e,this._babylonScene=t,this._pointType=n,this._pointSize=o}A.CustomLoadingScreen=e,r.prototype.AddListener=function(e,t){var n;null==this.ListenerDictionary[e]?this.ListenerDictionary[e]=n=[]:n=this.ListenerDictionary[e],n.push(t)},r.prototype.RemoveListener=function(e,t){var n,e=this.ListenerDictionary[e];null!=e&&0<=(n=e.findIndex(function(e){return t==e}))&&e.splice(n,1)},r.prototype.RaiseMessage=function(e,t){void 0===t&&(t=null);e=this.ListenerDictionary[e];null!=e&&e.forEach(function(e){e(t)})},A.EventMessageBus=r,a.prototype.getAvailableCount=function(){return this.availableInstances.length},a.prototype.populatePool=function(e){if(0<e)for(var t=0;t<e;t++){var n=this.createNewInstance();null!=n&&this.freeInstance(n)}},a.prototype.getInstance=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var n=0<this.availableInstances.length?this.availableInstances.pop():this.appendNewInstance();return null!=n&&(null!=e?n.position.copyFrom(e):n.position.set(0,0,0),null!=t?null!=n.rotationQuaternion?n.rotationQuaternion.copyFrom(t):n.rotationQuaternion=t.clone():null!=n.rotationQuaternion?n.rotationQuaternion.set(0,0,0,1):n.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),n.name=this.prefabName+".Instance",n.setEnabled(!0)),n},a.prototype.freeInstance=function(e){null!=e&&(e.setEnabled(!1),e.position.set(0,0,0),null!=e.rotationQuaternion?e.rotationQuaternion.set(0,0,0,1):e.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.components&&e.metadata.unity.components.forEach(function(e){if(null!=e)try{e.resetScriptComponent()}catch(e){}}),e.name=this.prefabName+".Unassigned",this.availableInstances.push(e))},a.prototype.appendNewInstance=function(){var e=null;return e=!0===this.allowGrowth?this.createNewInstance():e},a.prototype.createNewInstance=function(e,t,n,o){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null);var i=null;return null!=this.assetContainer&&null!=this.prefabName&&""!==this.prefabName&&(this.assetContainer instanceof BABYLON.AssetContainer?i=A.SceneManager.InstantiatePrefabFromContainer(this.assetContainer,this.prefabName,this.prefabName+".Instance",e,t,n,o,this.cloneAnimations,this.makeNewMaterials):this.assetContainer instanceof BABYLON.Scene&&(i=A.SceneManager.InstantiatePrefabFromScene(this.assetContainer,this.prefabName,this.prefabName+".Instance",e,t,n,o,this.cloneAnimations))),i},A.PrefabObjectPool=a,Object.defineProperty(l.prototype,"hasHit",{get:function(){return this._hit},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hitPoint",{get:function(){return this._hitPoint},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hitNormal",{get:function(){return this._hitNormal},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"collisionObject",{get:function(){return this._collisionObject},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"rayDestination",{get:function(){return this._dest},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"rayOrigin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),l.prototype.reset=function(e,t){this._hit=!1,this._hitPoint.set(0,0,0),this._hitNormal.set(0,0,0),this._hitDistance=0,this._collisionObject=null,this._origin.copyFrom(e),this._dest.copyFrom(t)},l.prototype.update=function(e,t,n,o,i,r,a,l){void 0===l&&(l=null),this._hit=e,this._hitPoint.set(t,n,o),this._hitNormal.set(i,r,a),this._hitDistance=BABYLON.Vector3.Distance(this._origin,this.hitPoint),this._collisionObject=l},A.RaycastHitResult=l,Object.defineProperty(s.prototype,"pointMesh",{get:function(){return this._pointMesh},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"linesMesh",{get:function(){return this._linesMesh},enumerable:!1,configurable:!0}),s.prototype.dispose=function(e){void 0===e&&(e=!0),this._babylonScene=null,(this._linesName=null)!=this._pointMesh&&(this._pointMesh.dispose(e),this._pointMesh=null),null!=this._linesMesh&&(this._linesMesh.dispose(e),this._linesMesh=null)},s.prototype.hidePoint=function(e){void 0===e&&(e=!0),null!=this._pointMesh&&(this._pointMesh.isVisible=!e)},s.prototype.drawPoint=function(e){null==this._pointMesh&&(1===this._pointType?this._pointMesh=BABYLON.MeshBuilder.CreateBox(this._linesName+".EndPoint",{size:2*this._pointSize},this._babylonScene):this._pointMesh=BABYLON.MeshBuilder.CreateSphere(this._linesName+".EndPoint",{segments:24,diameter:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=A.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25),null!=this._pointMesh&&(this._pointMesh.isVisible=!0,this._pointMesh.position.copyFrom(e))},s.prototype.drawLine=function(e,t){void 0===t&&(t=null),null==this._linesMesh?(this._numPoints=e.length,this._linesMesh=BABYLON.MeshBuilder.CreateLines(this._linesName,{points:e,updatable:!0},this._babylonScene),this._linesMesh.renderingGroupId=A.Utilities.DefaultRenderGroup(),null!=t&&(this._linesMesh.color=t),this._linesMesh.refreshBoundingInfo(!1)):e.length===this._numPoints?(this._linesMesh=BABYLON.MeshBuilder.CreateLines(this._linesName,{points:e,instance:this._linesMesh},this._babylonScene),this._linesMesh.renderingGroupId=A.Utilities.DefaultRenderGroup(),null!=t&&(this._linesMesh.color=t),this._linesMesh.refreshBoundingInfo(!1)):BABYLON.Tools.Warn("Dynamic line mesh point count mismatch for "+this._linesName)},A.LinesMeshRenderer=s;u=BABYLON.AssetsManager,__extends(c,u),c.prototype.addContainerTask=function(e,t,n,o){var i=this,r=new BABYLON.ContainerAssetTask(e,t,n,o),a=r;return a._lengthComputable=0,a._loaded=0,a._total=0,a.runTask=function(e,t,o){BABYLON.SceneLoader.LoadAssetContainer(r.rootUrl,r.sceneFilename,e,function(e){r.loadedContainer=e,r.loadedMeshes=e.meshes,r.loadedParticleSystems=e.particleSystems,r.loadedSkeletons=e.skeletons,r.loadedAnimationGroups=e.animationGroups,t()},function(e){a._lengthComputable=e.lengthComputable,a._loaded=e.loaded,a._total=e.total,i.handlePreloadingProgress()},function(e,t,n){o(t,n)})},this._tasks.push(r),r},c.prototype.addMeshTask=function(e,t,n,o){var r=this,a=new BABYLON.MeshAssetTask(e,t,n,o),l=a;return l._lengthComputable=0,l._loaded=0,l._total=0,l.runTask=function(e,i,o){BABYLON.SceneLoader.ImportMesh(a.meshesNames,a.rootUrl,a.sceneFilename,e,function(e,t,n,o){a.loadedMeshes=e,a.loadedParticleSystems=t,a.loadedSkeletons=n,a.loadedAnimationGroups=o,i()},function(e){l._lengthComputable=e.lengthComputable,l._loaded=e.loaded,l._total=e.total,r.handlePreloadingProgress()},function(e,t,n){o(t,n)})},this._tasks.push(a),a},c.prototype.addTextFileTask=function(e,t){var o=this,i=new BABYLON.TextFileAssetTask(e,t),r=i;return r._lengthComputable=0,r._loaded=0,r._total=0,r.runTask=function(e,t,n){e._loadFile(i.url,function(e){i.text=e,t()},function(e){r._lengthComputable=e.lengthComputable,r._loaded=e.loaded,r._total=e.total,o.handlePreloadingProgress()},!1,!1,function(e,t){e&&n(e.status+" "+e.statusText,t)})},this._tasks.push(i),i},c.prototype.addBinaryFileTask=function(e,t){var o=this,i=new BABYLON.BinaryFileAssetTask(e,t),r=i;return r._lengthComputable=0,r._loaded=0,r._total=0,r.runTask=function(e,t,n){e._loadFile(i.url,function(e){i.data=e,t()},function(e){r._lengthComputable=e.lengthComputable,r._loaded=e.loaded,r._total=e.total,o.handlePreloadingProgress()},!0,!0,function(e,t){e&&n(e.status+" "+e.statusText,t)})},this._tasks.push(i),i},c.prototype.addImageTask=function(e,t){var i=this,r=new BABYLON.ImageAssetTask(e,t),a=r;return a._lengthComputable=0,a._loaded=0,a._total=0,a.runTask=function(e,t,n){var o=new Image;BABYLON.Tools.SetCorsBehavior(r.url,o),o.onload=function(){r.image=o,t()},o.onerror=function(e){n("Error loading image",e)},o.onprogress=function(e){a._lengthComputable=e.lengthComputable,a._loaded=e.loaded,a._total=e.total,i.handlePreloadingProgress()},o.src=r.url},this._tasks.push(r),r},c.prototype.handlePreloadingProgress=function(){var e=!0,t=0,n=0;if(null!=this._tasks&&0<this._tasks.length)for(var o=0;o<this._tasks.length;o++){var i=this._tasks[o];null!=i._lengthComputable&&null!=i._loaded&&null!=i._total&&(e=e&&i._lengthComputable,t+=i._loaded,n+=i._total)}null!=A.SceneManager.OnAssetManagerProgress&&A.SceneManager.OnAssetManagerProgress({lengthComputable:e,loaded:t,total:e?n:0})};var u,e=c;function c(){return null!==u&&u.apply(this,arguments)||this}function d(){}function p(){}A.PreloadAssetsManager=e,d.HasNetworkEntity=function(e){return null!=e&&null!=e.networkEntity},d.GetNetworkEntityId=function(e){return null!=e&&null!=e.networkEntity?e.networkEntity.id:null},d.GetNetworkEntityType=function(e){return null!=e&&null!=e.networkEntityType?e.networkEntityType:0},d.GetNetworkEntitySessionId=function(e){return null!=e&&null!=e.networkEntity?e.networkEntity.ownerId:null},d.QueryNetworkAttribute=function(e,t){var n=null;return n=null!=e&&null!=e.networkEntity&&null!=e.networkEntity.attributes?e.networkEntity.attributes.get(t):n},d.QueryBufferedAttribute=function(e,t){var n=0;return n=null!=e&&null!=e.networkEntityAttributeBuffer?e.networkEntityAttributeBuffer[t.toFixed(0)]:n},d.PostBufferedAttribute=function(e,t,n){null==e.networkEntityBatch&&(e.networkEntityBatch={}),e.networkEntityBatch[t.toFixed(0)]=n},A.EntityController=d,p.ZeroPad=function(e,t){t=t-e.toString().length+1;return Array(+(0<t&&t)).join("0")+e},p.ShiftArray=function(e,t){return t?e.unshift(e.pop()):e.push(e.shift()),e},p.GetLayerMask=function(e){return 1<<e},p.IsLayerMasked=function(e,t){return 0!=(e&1<<t)},p.GetLoadingState=function(){return A.Utilities.LoadingState},p.GetRandomRange=function(e,t,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var i=BABYLON.Scalar.RandomRange(e,t);if(null!=n){var r=null!=o?o:100;if(i===n)for(var a=0;a<r&&(i=BABYLON.Scalar.RandomRange(e,t))===n;a++);}return i},p.GetRandomFloat=function(e,t,n,o){return void 0===n&&(n=null),void 0===o&&(o=null),parseFloat(A.Utilities.GetRandomRange(e,t,n,o).toFixed(2))},p.GetRandomInteger=function(e,t,n,o){return void 0===n&&(n=null),void 0===o&&(o=null),parseInt(A.Utilities.GetRandomRange(e,t,n,o).toFixed(0))},p.Approximately=function(e,t){return Math.abs(t-e)<Math.max(A.System.Epsilon*Math.max(Math.abs(e),Math.abs(t)),8*A.System.SingleEpsilon)},p.GetVertexDataFromMesh=function(e){var t=e.computeWorldMatrix(!0),e=BABYLON.VertexData.ExtractFromMesh(e,!0,!0);return e.transform(t),e},p.CalculateDestinationPoint=function(e,t,n){var o=new BABYLON.Vector3(0,0,0);return A.Utilities.CalculateDestinationPointToRef(e,t,n,o),o},p.CalculateDestinationPointToRef=function(e,t,n,o){null==A.Utilities.TempDirectionBuffer&&(A.Utilities.TempDirectionBuffer=new BABYLON.Vector3(0,0,0)),A.Utilities.TempDirectionBuffer.set(0,0,0),t.scaleToRef(n,A.Utilities.TempDirectionBuffer),e.addToRef(A.Utilities.TempDirectionBuffer,o)},p.UpdateAbstractMeshMaterial=function(e,t,n){var o;null!=e?!1==e instanceof BABYLON.InstancedMesh?(o=e.material)instanceof BABYLON.MultiMaterial?((o=o.clone(o.name+".Clone")).subMaterials[n]=t,e.material=o):e.material=t:console.warn("Instanced mesh not supported as a node material on mesh: "+e.name):console.warn("Null source mesh for mesh: "+e.name)},p.HermiteVector3=function(e,t,n,o,i){var r=new BABYLON.Vector3(0,0,0);return A.Utilities.HermiteVector3ToRef(e,t,n,o,i,r),r},p.HermiteVector3ToRef=function(e,t,n,o,i,r){var a=i*i,l=i*a,s=2*l-3*a+1,u=-2*l+3*a,i=l-2*a+i,l=l-a,a=e._x*s+n._x*u+t._x*i+o._x*l,c=e._y*s+n._y*u+t._y*i+o._y*l,e=e._z*s+n._z*u+t._z*i+o._z*l;r.set(a,c,e)},p.LerpLog=function(e,t,n){n=Math.min(Math.max(n,0),1);return e+(t-e)*Math.sin(n*Math.PI*.5)},p.LerpExp=function(e,t,n){n=Math.min(Math.max(n,0),1);return e+(t-e)*(1-Math.cos(n*Math.PI*.5))},p.LerpUnclamped=function(e,t,n){return e+(t-e)*n},p.LerpUnclampedColor3=function(e,t,n){var o=new BABYLON.Color3(0,0,0);return A.Utilities.LerpUnclampedColor3ToRef(e,t,n,o),o},p.LerpUnclampedColor3ToRef=function(e,t,n,o){o.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n)},p.LerpUnclampedColor4=function(e,t,n){var o=new BABYLON.Color4(0,0,0,1);return A.Utilities.LerpUnclampedColor4ToRef(e,t,n,o),o},p.LerpUnclampedColor4ToRef=function(e,t,n,o){o.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n,e.a+(t.a-e.a)*n)},p.LerpUnclampedVector2=function(e,t,n){var o=new BABYLON.Vector2(0,0);return A.Utilities.LerpUnclampedVector2ToRef(e,t,n,o),o},p.LerpUnclampedVector2ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},p.LerpUnclampedVector3=function(e,t,n){var o=new BABYLON.Vector3(0,0,0);return A.Utilities.LerpUnclampedVector3ToRef(e,t,n,o),o},p.LerpUnclampedVector3ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n)},p.LerpUnclampedVector4=function(e,t,n){var o=new BABYLON.Vector4(0,0,0,0);return A.Utilities.LerpUnclampedVector4ToRef(e,t,n,o),o},p.LerpUnclampedVector4ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n,e.w+(t.w-e.w)*n)},p.IsEqualUsingDot=function(e){return e>1-A.System.Epsilon},p.QuaternionAngle=function(e,t){e=Math.min(Math.abs(BABYLON.Quaternion.Dot(e,t)),1);return A.Utilities.IsEqualUsingDot(e)?0:2*Math.acos(e)*A.System.Rad2Deg},p.QuaternionLengthSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},p.QuaternionRotateTowards=function(e,t,n){var o=new BABYLON.Quaternion(0,0,0,1);return A.Utilities.QuaternionRotateTowardsToRef(e,t,n,o),o},p.QuaternionRotateTowardsToRef=function(e,t,n,o){var i=A.Utilities.QuaternionAngle(e,t);0==i?o.copyFrom(t):A.Utilities.QuaternionSlerpUnclampedToRef(e,t,Math.min(1,n/i),o)},p.QuaternionSlerpUnclamped=function(e,t,n){var o=new BABYLON.Quaternion(0,0,0,1);return A.Utilities.QuaternionSlerpUnclampedToRef(e,t,n,o),o},p.QuaternionSlerpUnclampedToRef=function(e,t,n,o){},p.MoveTowardsVector2=function(e,t,n){var o=new BABYLON.Vector2(0,0);return A.Utilities.MoveTowardsVector2ToRef(e,t,n,o),o},p.MoveTowardsVector2ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=i*i+r*r;0==a||0<=n&&a<=n*n?o.set(t.x,t.y):(t=Math.sqrt(a),o.set(e.x+i/t*n,e.y+r/t*n))},p.MoveTowardsVector3=function(e,t,n){var o=new BABYLON.Vector3(0,0,0);return A.Utilities.MoveTowardsVector3ToRef(e,t,n,o),o},p.MoveTowardsVector3ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z,l=i*i+r*r+a*a;0==l||0<=n&&l<=n*n?o.set(t.x,t.y,t.z):(t=Math.sqrt(l),o.set(e.x+i/t*n,e.y+r/t*n,e.z+a/t*n))},p.MoveTowardsVector4=function(e,t,n){var o=new BABYLON.Vector4(0,0,0,0);return A.Utilities.MoveTowardsVector4ToRef(e,t,n,o),o},p.MoveTowardsVector4ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z,l=t.w-e.w,s=i*i+r*r+a*a+l*l;0==s||0<=n&&s<=n*n?o.set(t.x,t.y,t.z,t.w):(t=Math.sqrt(s),o.set(e.x+i/t*n,e.y+r/t*n,e.z+a/t*n,e.w+l/t*n))},p.ClampMagnitudeVector2=function(e,t){var n=new BABYLON.Vector2(0,0);return A.Utilities.ClampMagnitudeVector2ToRef(e,t,n),n},p.ClampMagnitudeVector2ToRef=function(e,t,n){var o,i=e.lengthSquared();t*t<i&&(i=Math.sqrt(i),o=e.x/i,e=e.y/i,n.set(o*t,e*t))},p.ClampMagnitudeVector3=function(e,t){var n=new BABYLON.Vector3(0,0,0);return A.Utilities.ClampMagnitudeVector3ToRef(e,t,n),n},p.ClampMagnitudeVector3ToRef=function(e,t,n){var o,i,r=e.lengthSquared();t*t<r&&(r=Math.sqrt(r),o=e.x/r,i=e.y/r,e=e.z/r,n.set(o*t,i*t,e*t))},p.GetAngle=function(e,t){return A.Utilities.GetAngleRadians(e,t)*A.System.Rad2Deg},p.GetAngleRadians=function(e,t){return Math.acos(BABYLON.Vector3.Dot(e,t))},p.ClampAngle=function(e,t,n){for(var o=e;o<-360&&(o+=360),360<o&&(o-=360),o<-360||360<o;);return BABYLON.Scalar.Clamp(o,t,n)},p.ClampAngle180=function(e,t,n){return 180<e&&(e-=360),(e=BABYLON.Scalar.Clamp(e,t,n))<0&&(e+=360),e},p.ClampAngle360=function(e,t,n){return(e<90||270<e)&&(180<e&&(e-=360),180<n&&(n-=360),180<t)&&(t-=360),(e=BABYLON.Scalar.Clamp(e,t,n))<0&&(e+=360),e},p.SmoothDamp=function(e,t,n,o,i,r){var a,l,s;return r?(l=e-t,a=1/(1+(a=(s=2/(n=Math.max(1e-4,n)))*i)+.48*a*a+.235*a*a*a),t=t,o=o*n,n=e-(l=BABYLON.Scalar.Clamp(l,-o,o)),o=(r.x+s*l)*i,r.x=(r.x-s*o)*a,0<t-e==t<(s=n+(l+o)*a)&&(r.x=((s=t)-t)/i),s):0},p.SmoothDampAngle=function(e,t,n,o,i,r){t=e+BABYLON.Scalar.DeltaAngle(e,t);return A.Utilities.SmoothDamp(e,t,n,o,i,r)},p.SmoothDampVector2=function(e,t,n,o,i,r){var a=new BABYLON.Vector2(0,0);return A.Utilities.SmoothDampVector2ToRef(e,t,n,o,i,r,a),a},p.SmoothDampVector2ToRef=function(e,t,n,o,i,r,a){var l=2/(n=Math.max(1e-4,n)),s=l*i,s=1/(1+s+.48*s*s+.235*s*s*s),u=e.x-t.x,c=e.y-t.y,d=t.clone(),o=o*n,n=u*u+c*c,n=(o*o<n&&(u=u/(n=Math.sqrt(n))*o,c=c/n*o),t.x=e.x-u,t.y=e.y-c,(r.x+l*u)*i),o=(r.y+l*c)*i,l=(r.x=(r.x-l*n)*s,r.y=(r.y-l*o)*s,t.x+(u+n)*s),u=t.y+(c+o)*s,n=d.x-e.x,t=d.y-e.y;0<n*(l-d.x)+t*(u-d.y)&&(l=d.x,u=d.y,r.x=(l-d.x)/i,r.y=(u-d.y)/i),a.set(l,u)},p.SmoothDampVector3=function(e,t,n,o,i,r){var a=new BABYLON.Vector3(0,0,0);return A.Utilities.SmoothDampVector3ToRef(e,t,n,o,i,r,a),a},p.SmoothDampVector3ToRef=function(e,t,n,o,i,r,a){var l=0,s=0,u=0,c=2/(n=Math.max(1e-4,n)),d=c*i,d=1/(1+d+.48*d*d+.235*d*d*d),p=e.x-t.x,h=e.y-t.y,m=e.z-t.z,g=t.clone(),o=o*n,n=p*p+h*h+m*m,n=(o*o<n&&(p=p/(n=Math.sqrt(n))*o,h=h/n*o,m=m/n*o),t.x=e.x-p,t.y=e.y-h,t.z=e.z-m,(r.x+c*p)*i),o=(r.y+c*h)*i,f=(r.z+c*m)*i,c=(r.x=(r.x-c*n)*d,r.y=(r.y-c*o)*d,r.z=(r.z-c*f)*d,l=t.x+(p+n)*d,s=t.y+(h+o)*d,u=t.z+(m+f)*d,g.x-e.x),p=g.y-e.y,n=g.z-e.z;0<c*(l-g.x)+p*(s-g.y)+n*(u-g.z)&&(l=g.x,s=g.y,u=g.z,r.x=(l-g.x)/i,r.y=(s-g.y)/i,r.z=(u-g.z)/i),a.set(l,s,u)},p.ToMatrix=function(e,t,n){return BABYLON.Matrix.RotationYawPitchRoll(BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(n))},p.ToMatrixToRef=function(e,t,n,o){BABYLON.Matrix.RotationYawPitchRollToRef(BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(n),o)},p.FastMatrixLerp=function(e,t,n,o){BABYLON.Matrix.LerpToRef(e,t,n,o)},p.FastMatrixSlerp=function(e,t,n,o){BABYLON.Matrix.DecomposeLerpToRef(e,t,n,o)},p.ToEuler=function(e){e=e.toEulerAngles();return e.x=BABYLON.Tools.ToDegrees(e.x),e.y=BABYLON.Tools.ToDegrees(e.y),e.z=BABYLON.Tools.ToDegrees(e.z),e},p.ToEulerToRef=function(e,t){e.toEulerAnglesToRef(t),t.x=BABYLON.Tools.ToDegrees(t.x),t.y=BABYLON.Tools.ToDegrees(t.y),t.z=BABYLON.Tools.ToDegrees(t.z)},p.FromEuler=function(e,t,n){return BABYLON.Quaternion.FromEulerAngles(BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(n))},p.FromEulerToRef=function(e,t,n,o){BABYLON.Quaternion.FromEulerAnglesToRef(BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(n),o)},p.QuaternionDiff=function(e,t){var n=new BABYLON.Quaternion(0,0,0,1);return A.Utilities.QuaternionDiffToRef(e,t,n),n},p.QuaternionDiffToRef=function(e,t,n){BABYLON.Quaternion.InverseToRef(t,A.Utilities.TempQuaternion),A.Utilities.TempQuaternion.multiplyToRef(e,n)},p.QuaternionSubtractToRef=function(e,t,n){n.set(e._x-t._x,e._y-t._y,e._z-t._z,e._w-t._w)},p.RotateVector=function(e,t){var n=2*(t.y*e.z-t.z*e.y),o=2*(t.z*e.x-t.x*e.z),i=2*(t.x*e.y-t.y*e.x);return new BABYLON.Vector3(e.x+t.w*n+(t.y*i-t.z*o),e.y+t.w*o+(t.z*n-t.x*i),e.z+t.w*i+(t.x*o-t.y*n))},p.RotateVectorToRef=function(e,t,n){var o=2*(t.y*e.z-t.z*e.y),i=2*(t.z*e.x-t.x*e.z),r=2*(t.x*e.y-t.y*e.x);n.x=e.x+t.w*o+(t.y*r-t.z*i),n.y=e.y+t.w*i+(t.z*o-t.x*r),n.z=e.z+t.w*r+(t.x*i-t.y*o)},p.LookRotation=function(e){var t=BABYLON.Quaternion.Zero();return A.Utilities.LookRotationToRef(e,t),t},p.LookRotationToRef=function(e,t){A.Utilities.TempMatrix.reset(),BABYLON.Matrix.LookAtLHToRef(A.Utilities.ZeroVector,e,A.Utilities.UpVector,A.Utilities.TempMatrix),A.Utilities.TempMatrix.invert(),BABYLON.Quaternion.FromRotationMatrixToRef(A.Utilities.TempMatrix,t)},p.Vector3Rad2Deg=function(e){var t=BABYLON.Vector3.Zero();return A.Utilities.Vector3Rad2DegToRef(e,t),t},p.Vector3Rad2DegToRef=function(e,t){t.x=BABYLON.Tools.ToDegrees(e.x),t.y=BABYLON.Tools.ToDegrees(e.y),t.z=BABYLON.Tools.ToDegrees(e.z)},p.MultiplyQuaternionByVector=function(e,t){var n=new BABYLON.Vector3(0,0,0);return A.Utilities.MultiplyQuaternionByVectorToRef(e,t,n),n},p.MultiplyQuaternionByVectorToRef=function(e,t,n){var o=2*e.x,i=2*e.y,r=2*e.z,a=e.x*o,l=e.y*i,s=e.z*r,u=e.x*i,c=e.x*r,d=e.y*r,o=e.w*o,i=e.w*i,e=e.w*r;n.x=(1-(l+s))*t.x+(u-e)*t.y+(c+i)*t.z,n.y=(u+e)*t.x+(1-(a+s))*t.y+(d-o)*t.z,n.z=(c-i)*t.x+(d+o)*t.y+(1-(a+l))*t.z},p.ValidateTransformRotation=function(e){null!=e.rotationQuaternion&&(e.rotation=e.rotationQuaternion.toEulerAngles(),e.rotationQuaternion=null)},p.ValidateTransformQuaternion=function(e){null==e.rotationQuaternion&&null!=e.rotation&&(e.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(e.rotation.x,e.rotation.y,e.rotation.z),e.rotation.set(0,0,0))},p.GetKeyboardInputValue=function(e,t,n){var o=n;return o=!0===A.UserInputOptions.KeyboardSmoothing&&(o=BABYLON.Scalar.MoveTowards(t,n,A.UserInputOptions.KeyboardMoveSensibility*A.SceneManager.GetDeltaSeconds(e)),Math.abs(o)<A.UserInputOptions.KeyboardMoveDeadZone)?0:o},p.GenerateRandonNumber=function(e,t,n){void 0===n&&(n=2);t=(Math.random()*(t-e)+e).toFixed(n);return parseFloat(t)},p.ProjectVector=function(e,t){var n=new BABYLON.Vector3(0,0,0);return A.Utilities.ProjectVectorToRef(e,t,n),n},p.ProjectVectorToRef=function(e,t,n){var o=BABYLON.Vector3.Dot(t,t);o<A.System.Epsilon?n.set(0,0,0):(e=BABYLON.Vector3.Dot(e,t),n.set(t.x*e/o,t.y*e/o,t.z*e/o))},p.ProjectVectorOnPlane=function(e,t){var n=new BABYLON.Vector3(0,0,0);return A.Utilities.ProjectVectorOnPlaneToRef(e,t,n),n},p.ProjectVectorOnPlaneToRef=function(e,t,n){var o,i=BABYLON.Vector3.Dot(t,t);i<A.System.Epsilon?n.copyFrom(e):(o=BABYLON.Vector3.Dot(e,t),n.set(e.x-t.x*o/i,e.y-t.y*o/i,e.z-t.z*o/i))},p.AreVectorsEqual=function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n},p.GetVerticalSlopeAngle=function(e,t){void 0===t&&(t=0);e=null!=(e=Math.atan(Math.abs(e.y/Math.sqrt(e.x*e.x+e.z*e.z)))*A.System.Rad2Deg)&&!1===Number.isNaN(e)?e:0;return e=0<t&&t<=e?0:e},p.DownloadEnvironment=function(n,o,t){void 0===o&&(o=null),void 0===t&&(t=null),BABYLON.EnvironmentTextureTools.CreateEnvTextureAsync(n).then(function(e){var t=n.name||"Environment",e=new Blob([e],{type:"octet/stream"});BABYLON.Tools.Download(e,t+".env"),null!=o&&o()}).catch(function(e){console.error(e),null!=t&&t()})},p.HasOwnProperty=function(e,t){return null!=e&&null!=t&&""!==t&&t in e},p.FindMeshCollider=function(e,t){var n=null;return t instanceof BABYLON.TransformNode&&!0==(null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.renderer&&null!=t.metadata.unity.renderer.hasmeshcollider&&!0===t.metadata.unity.renderer.hasmeshcollider)&&(t=t.id+"-collider",n=e.getMeshById(t)),n},p.ColliderInstances=function(){return null==A.SceneManager.GlobalOptions.colliderInstances||A.SceneManager.GlobalOptions.colliderInstances},p.ReparentColliders=function(){return null==A.SceneManager.GlobalOptions.reparentColliders||A.SceneManager.GlobalOptions.reparentColliders},p.UseTriangleNormals=function(){return null!=A.SceneManager.GlobalOptions.useTriangleNormals&&A.SceneManager.GlobalOptions.useTriangleNormals},p.UseConvexTriangles=function(){return null!=A.SceneManager.GlobalOptions.useConvexTriangles&&A.SceneManager.GlobalOptions.useConvexTriangles},p.DefaultRenderGroup=function(){return null!=A.SceneManager.GlobalOptions.defaultRenderGroup?A.SceneManager.GlobalOptions.defaultRenderGroup:0},p.ShowDebugColliders=function(){return!0===A.SceneManager.EnableDebugMode||null!=A.SceneManager.GlobalOptions.showDebugColliders&&A.SceneManager.GlobalOptions.showDebugColliders},p.ColliderVisibility=function(){return null!=A.SceneManager.GlobalOptions.colliderVisibility?A.SceneManager.GlobalOptions.colliderVisibility:0},p.ColliderRenderGroup=function(){return null!=A.SceneManager.GlobalOptions.colliderRenderGroup?A.SceneManager.GlobalOptions.colliderRenderGroup:0},p.CollisionWireframe=function(){return null!=A.SceneManager.GlobalOptions.collisionWireframe&&A.SceneManager.GlobalOptions.collisionWireframe},p.GetColliderMaterial=function(e){var t="Collider-Material",n=e.getMaterialByName(t);return null==n&&((t=new BABYLON.PBRMaterial(t,e)).albedoColor=new BABYLON.Color3(0,.75,0),t.wireframe=A.Utilities.CollisionWireframe(),t.unlit=!0,n=t),n},p.CalculateCombinedFriction=function(e,t){e*=t;return e=10<(e=e<-10?-10:e)?10:e},p.CalculateCombinedRestitution=function(e,t){return e*t},p.AddLoaderItemMarkedForDisposal=function(e){null==A.Utilities.LoaderItemsMarkedForDisposal&&(A.Utilities.LoaderItemsMarkedForDisposal=[]),A.Utilities.LoaderItemsMarkedForDisposal.push(e)},p.ResetLoaderItemsMarkedForDisposal=function(){A.Utilities.LoaderItemsMarkedForDisposal=[]},p.RemoveLoaderItemsMarkedForDisposal=function(){null!=A.Utilities.LoaderItemsMarkedForDisposal&&0<A.Utilities.LoaderItemsMarkedForDisposal.length&&A.Utilities.LoaderItemsMarkedForDisposal.forEach(function(e){try{e.dispose()}catch(e){console.warn(e)}}),A.Utilities.ResetLoaderItemsMarkedForDisposal()},p.GetDirectTargetAngle=function(e,t){return A.Utilities.TempVector3.set(0,0,0),A.Utilities.InverseTransformPointToRef(e,t,A.Utilities.TempVector3),Math.atan2(A.Utilities.TempVector3.x,A.Utilities.TempVector3.z)},p.GetSmoothTargetAngle=function(e,t){return A.Utilities.TempVector3.set(0,0,0),A.Utilities.InverseTransformPointToRef(e,t,A.Utilities.TempVector3),A.Utilities.TempVector3.x/A.Utilities.TempVector3.length()},p.CalculatCatmullRom=function(e,t,n,o,i){var r=new BABYLON.Vector3(0,0,0);return A.Utilities.CalculatCatmullRomToRef(e,t,n,o,i,r),r},p.CalculatCatmullRomToRef=function(e,t,n,o,i,r){},p.StartsWith=function(e,t){return 0===e.lastIndexOf(t,0)},p.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},p.ReplaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},p.IsNullOrEmpty=function(e){return null==e||""===e},p.SafeStringPush=function(e,t){-1===e.indexOf(t)&&e.push(t)},p.ParseColor3=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);return null!=e&&null!=e.r&&null!=e.g&&null!=e.b?!0===n?new BABYLON.Color3(e.r,e.g,e.b).toLinearSpace():new BABYLON.Color3(e.r,e.g,e.b):t},p.ParseColor4=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var o;return null!=e&&null!=e.r&&null!=e.g&&null!=e.b?(o=null!=e.a?e.a:1,!0===n?new BABYLON.Color4(e.r,e.g,e.b,o).toLinearSpace():new BABYLON.Color4(e.r,e.g,e.b,o)):t},p.ParseVector2=function(e,t){void 0===t&&(t=null);return null!=e&&null!=e.x&&null!=e.y?new BABYLON.Vector2(e.x,e.y):t},p.ParseVector3=function(e,t){void 0===t&&(t=null);return null!=e&&null!=e.x&&null!=e.y&&null!=e.z?new BABYLON.Vector3(e.x,e.y,e.z):t},p.ParseVector4=function(e,t){void 0===t&&(t=null);return null!=e&&null!=e.x&&null!=e.y&&null!=e.z&&null!=e.w?new BABYLON.Vector4(e.x,e.y,e.z,e.w):t},p.ParseSound=function(e,t,n,o,i){var r,a=null;return null!=e&&null!=e.filename&&""!==e.filename&&(r=A.SceneManager.GetRootUrl(t),e=e.filename,a=new BABYLON.Sound(n,r+e,t,o,i)),a},p.ParseTexture=function(e,t,n,o,i,r,a,l,s,u){var c,d=null;return null!=e&&null!=e.filename&&""!==e.filename&&(c=A.SceneManager.GetRootUrl(t),e=e.filename,d=new BABYLON.Texture(c+e,t,n,o,i,r,a,l,s,u)),d},p.ParseCubemap=function(e,t){var n,o=null;return null!=e&&null!=e.info&&(n=A.SceneManager.GetRootUrl(t)+e.info.rooturl,null!=(o=BABYLON.CubeTexture.Parse(e.info,t,n)))&&(o.gammaSpace=!1),o},p.ParseTextAsset=function(e,t){void 0===t&&(t=null);return null!=e&&null!=e.base64&&""!==e.base64?A.WindowManager.Atob(e.base64):t},p.ParseJsonAsset=function(e,t,n){void 0===n&&(n=null);e=A.Utilities.ParseTextAsset(e,t=void 0===t?null:t);return null!=e&&""!==e?JSON.parse(e,n):null},p.ParseTransformByID=function(e,t,n){void 0===n&&(n=null);return null!=e&&null!=e.id?A.SceneManager.GetTransformNodeByID(t,e.id):n},p.ParseTransformByName=function(e,t,n){void 0===n&&(n=null);return null!=e&&null!=e.id?A.SceneManager.GetTransformNode(t,e.id):n},p.ParseChildTransform=function(e,t,n){void 0===n&&(n=null);return null!=t&&null!=t.name?A.SceneManager.FindChildTransformNode(e,t.name,A.SearchType.IndexOf,!1):n},p.SetAbsolutePosition=function(e,t){e.setAbsolutePosition(t)},p.GetAbsolutePosition=function(e,t,n){return A.Utilities.TransformPoint(e,(t=void 0===t?null:t)||A.Utilities.ZeroVector,n=void 0===n?!0:n)},p.GetAbsolutePositionToRef=function(e,t,n,o){A.Utilities.TransformPointToRef(e,(n=void 0===n?null:n)||A.Utilities.ZeroVector,t,o=void 0===o?!0:o)},p.SetAbsoluteRotation=function(e,t){null==e.rotationQuaternion&&(e.rotationQuaternion=e.rotation.toQuaternion()),null!=e.parent&&e.parent instanceof BABYLON.TransformNode?(A.Utilities.TempQuaternion2.set(0,0,0,1),A.Utilities.GetAbsoluteRotationToRef(e.parent,A.Utilities.TempQuaternion2),BABYLON.Quaternion.InverseToRef(A.Utilities.TempQuaternion2,A.Utilities.TempQuaternion2),A.Utilities.TempQuaternion2.multiplyInPlace(t),e.rotationQuaternion.copyFrom(A.Utilities.TempQuaternion2)):e.rotationQuaternion.copyFrom(t)},p.GetAbsoluteRotation=function(e){var t=new BABYLON.Quaternion(0,0,0,1);return A.Utilities.GetAbsoluteRotationToRef(e,t),t},p.GetAbsoluteRotationToRef=function(e,t){var n,o,i;null!=e.parent&&e.parent instanceof BABYLON.TransformNode?(A.Utilities.GetAbsoluteRotationToRef(e.parent,t),null==e.rotationQuaternion&&(e.rotationQuaternion=e.rotation.toQuaternion()),t.multiplyInPlace(e.rotationQuaternion)):1==(i=e.scaling).x&&1==i.y&&1==i.z?t.copyFrom(e.absoluteRotationQuaternion):(n=1/i.x,o=1/i.y,i=1/i.z,e=e.getWorldMatrix()._m,A.Utilities.TempMatrix2.reset(),BABYLON.Matrix.FromValuesToRef(e[0]*n,e[1]*n,e[2]*n,0,e[4]*o,e[5]*o,e[6]*o,0,e[8]*i,e[9]*i,e[10]*i,0,0,0,0,1,A.Utilities.TempMatrix2),A.Utilities.TempQuaternion3.set(0,0,0,1),A.Utilities.TempMatrix2.decompose(void 0,A.Utilities.TempQuaternion3,void 0),t.copyFrom(A.Utilities.TempQuaternion3))},p.TransformPoint=function(e,t,n){return!0===(n=void 0===n?!0:n)&&e.computeWorldMatrix(),BABYLON.Vector3.TransformCoordinates(t,e.getWorldMatrix())},p.InverseTransformPoint=function(e,t,n){return!0===(n=void 0===n?!0:n)&&e.computeWorldMatrix(),A.Utilities.TempMatrix.reset(),e.getWorldMatrix().invertToRef(A.Utilities.TempMatrix),BABYLON.Vector3.TransformCoordinates(t,A.Utilities.TempMatrix)},p.TransformPointToRef=function(e,t,n,o){!0===(o=void 0===o?!0:o)&&e.computeWorldMatrix(),BABYLON.Vector3.TransformCoordinatesToRef(t,e.getWorldMatrix(),n)},p.InverseTransformPointToRef=function(e,t,n,o){!0===(o=void 0===o?!0:o)&&e.computeWorldMatrix(),A.Utilities.TempMatrix.reset(),e.getWorldMatrix().invertToRef(A.Utilities.TempMatrix),BABYLON.Vector3.TransformCoordinatesToRef(t,A.Utilities.TempMatrix,n)},p.TransformDirection=function(e,t,n){return!0===(n=void 0===n?!0:n)&&e.computeWorldMatrix(),BABYLON.Vector3.TransformNormal(t,e.getWorldMatrix())},p.InverseTransformDirection=function(e,t,n){return!0===(n=void 0===n?!0:n)&&e.computeWorldMatrix(),A.Utilities.TempMatrix.reset(),e.getWorldMatrix().invertToRef(A.Utilities.TempMatrix),BABYLON.Vector3.TransformNormal(t,A.Utilities.TempMatrix)},p.TransformDirectionToRef=function(e,t,n,o){!0===(o=void 0===o?!0:o)&&e.computeWorldMatrix(),BABYLON.Vector3.TransformNormalToRef(t,e.getWorldMatrix(),n)},p.InverseTransformDirectionToRef=function(e,t,n,o){!0===(o=void 0===o?!0:o)&&e.computeWorldMatrix(),A.Utilities.TempMatrix.reset(),e.getWorldMatrix().invertToRef(A.Utilities.TempMatrix),BABYLON.Vector3.TransformNormalToRef(t,A.Utilities.TempMatrix,n)},p.RecomputeCenterPivotPoint=function(e){var t=e.getBoundingInfo().boundingSphere.center;e.setPivotMatrix(BABYLON.Matrix.Translation(-t.x,-t.y,-t.z))},p.GetDirectionVector=function(e,t){return e.getDirection(t)},p.GetDirectionVectorToRef=function(e,t,n){e.getDirectionToRef(t,n)},p.GetForwardVector=function(e){return e.getDirection(BABYLON.Vector3.Forward())},p.GetForwardVectorToRef=function(e,t){e.getDirectionToRef(BABYLON.Vector3.Forward(),t)},p.GetRightVector=function(e){return e.getDirection(BABYLON.Vector3.Right())},p.GetRightVectorToRef=function(e,t){e.getDirectionToRef(BABYLON.Vector3.Right(),t)},p.GetUpVector=function(e){return e.getDirection(BABYLON.Vector3.Up())},p.GetUpVectorToRef=function(e,t){e.getDirectionToRef(BABYLON.Vector3.Up(),t)},p.BlendFloatValue=function(e,t,n){n=BABYLON.Scalar.Clamp(n,0,1);return 0<n?BABYLON.Scalar.Lerp(e,t,n):e},p.BlendVector2Value=function(e,t,n){n=BABYLON.Scalar.Clamp(n,0,1);0<n&&(t=BABYLON.Vector2.Lerp(e,t,n),e.copyFrom(t))},p.BlendVector3Value=function(e,t,n){n=BABYLON.Scalar.Clamp(n,0,1);0<n&&BABYLON.Vector3.LerpToRef(e,t,n,e)},p.BlendQuaternionValue=function(e,t,n){n=BABYLON.Scalar.Clamp(n,0,1);0<n&&BABYLON.Quaternion.SlerpToRef(e,t,n,e)},p.SetAnimationTargetProperty=function(e,t){null!=e&&(e.targetProperty=t,e.targetPropertyPath=e.targetProperty.split("."))},p.SampleAnimationFloat=function(e,t,n,o){void 0===n&&(n=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===o&&(o=!1);var i=0;return null!=e&&e.dataType===BABYLON.Animation.ANIMATIONTYPE_FLOAT&&(null==e._state&&(e._state={key:0,repeatCount:0,loopMode:n,workValue:BABYLON.Matrix.Zero()}),i=A.Utilities.InterpolateAnimation(e,t,e._state,o)),i},p.SampleAnimationVector2=function(e,t,n,o){void 0===n&&(n=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===o&&(o=!1);var i=null;return null!=e&&e.dataType===BABYLON.Animation.ANIMATIONTYPE_VECTOR2&&(null==e._state&&(e._state={key:0,repeatCount:0,loopMode:n,workValue:BABYLON.Matrix.Zero()}),i=A.Utilities.InterpolateAnimation(e,t,e._state,o)),i},p.SampleAnimationVector3=function(e,t,n,o){void 0===n&&(n=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===o&&(o=!1);var i=null;return null!=e&&e.dataType===BABYLON.Animation.ANIMATIONTYPE_VECTOR3&&(null==e._state&&(e._state={key:0,repeatCount:0,loopMode:n,workValue:BABYLON.Matrix.Zero()}),i=A.Utilities.InterpolateAnimation(e,t,e._state,o)),i},p.SampleAnimationQuaternion=function(e,t,n,o){void 0===n&&(n=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===o&&(o=!1);var i=null;return null!=e&&e.dataType===BABYLON.Animation.ANIMATIONTYPE_QUATERNION&&(null==e._state&&(e._state={key:0,repeatCount:0,loopMode:n,workValue:BABYLON.Matrix.Zero()}),i=A.Utilities.InterpolateAnimation(e,t,e._state,o)),i},p.SampleAnimationMatrix=function(e,t,n,o){void 0===n&&(n=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===o&&(o=!1);var i=null;return null!=e&&e.dataType===BABYLON.Animation.ANIMATIONTYPE_MATRIX&&(null==e._state&&(e._state={key:0,repeatCount:0,loopMode:n,workValue:BABYLON.Matrix.Zero()}),i=A.Utilities.InterpolateAnimation(e,t,e._state,o)),i},p.CreateTweenAnimation=function(e,t,n,o,i,r){void 0===i&&(i=30),void 0===r&&(r=BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE);var a=[],n=(a.push({frame:0,value:n}),a.push({frame:i,value:o}),new BABYLON.Animation(e,t,i,BABYLON.Animation.ANIMATIONTYPE_FLOAT,r));return n.setKeys(a),n},p.GetLastKeyFrameIndex=function(e){var t=0;return t=null!=e&&null!=(e=e.getKeys())&&0<e.length&&null!=(e=e[e.length-1])?e.frame:t},p.InterpolateAnimation=function(e,t,n,o){o=!0===(o=void 0===o?!1:o)?t*A.SceneManager.AnimationTargetFps:t;return e._interpolate(o,n)},p.UpdateLoopBlendPositionSettings=function(e,t,n){null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.settings&&(e.metadata.unity.settings.loopblendpositiony=t,e.metadata.unity.settings.loopblendpositionxz=n)},p.InitializeShaderMaterial=function(a,e,t){void 0===e&&(e=!0),void 0===t&&(t=!1);var l=a,n=A.Utilities.HasOwnProperty(l,"getShaderName")?l.getShaderName():"glsl",o=!!A.Utilities.HasOwnProperty(l,"getAlphaBlending")&&l.getAlphaBlending(),i=!!A.Utilities.HasOwnProperty(l,"getAlphaTesting")&&l.getAlphaTesting(),r=A.Utilities.HasOwnProperty(l,"getDefaultDefines")?l.getDefaultDefines():null,s=A.Utilities.HasOwnProperty(l,"getDefaultAttributes")?l.getDefaultAttributes():null,u=A.Utilities.HasOwnProperty(l,"getDefaultUniforms")?l.getDefaultUniforms():null,n=((null==r||r.length<=0)&&(r=["#define GAMETIME","#define DELTATIME","#define DIFFUSECOLOR","#define DIFFUSETEXTURE"]),{vertex:n,fragment:n}),o={needAlphaBlending:o,needAlphaTesting:i,attributes:s=null==s||s.length<=0?["position","normal","uv","uv2","color"]:s,uniforms:u=null==u||u.length<=0?["world","worldView","worldViewProjection","view","projection","viewProjection","gameTime","deltaTime","diffuseColor","diffuseTexture","diffuseTextureInfos","diffuseTextureMatrix"]:u,defines:r,useClipPlane:t,samplers:[],uniformBuffers:[],externalTextures:[],samplerObjects:[],storageBuffers:[]};l._shaderPath=n,l._options=o,!0===e&&(l.fn_afterBind=l.bind,l.bind=function(e,t,n){if(void 0===n&&(n=null),null!=l.updateGlobalTime&&l.updateGlobalTime(),l.after&&l.after(),l.fn_afterBind)try{l.fn_afterBind(e,t,n)}catch(e){}var o=null!=n?n:l.getEffect();if(a.getScene().texturesEnabled&&null!=o)for(var i in l._textures){var r=l._textures[i];null!=r&&(o.setFloat2(i+"Infos",r.coordinatesIndex,r.level),o.setMatrix(i+"Matrix",r.getTextureMatrix()))}}),l.awake&&l.awake()},p.WorldToScreenPoint=function(e,t,n){var o=null,n=null!=(n=void 0===n?null:n)?n.viewport:null!=e.activeCamera?e.activeCamera.viewport:null;return o=null!=n?BABYLON.Vector3.Project(t,BABYLON.Matrix.Identity(),e.getTransformMatrix(),n.toGlobal(e.getEngine().getRenderWidth(),e.getEngine().getRenderHeight())):o},p.ScreenToWorldPoint=function(e,t){return BABYLON.Vector3.Unproject(t,e.getEngine().getRenderWidth(),e.getEngine().getRenderHeight(),BABYLON.Matrix.Identity(),e.getViewMatrix(),e.getProjectionMatrix())},p.LoadTextFile=function(e,t,n,o){return BABYLON.Tools.LoadFile(e,t,n,null,!1,o)},p.LoadTextFileAsync=function(e){return BABYLON.Tools.LoadFileAsync(e,!1)},p.GetHttpRequest=function(e,t,n,o,i,r,a){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=!1),void 0===a&&(a=null);var l=new XMLHttpRequest;return l.open("GET",e,!0),!0===r&&(l.responseType="arraybuffer"),null!=a&&l.overrideMimeType(a),null!=t&&t.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&l.setRequestHeader(e.name,e.value)}),l.onreadystatechange=function(){l.readyState===XMLHttpRequest.DONE&&null!=n&&n(l)},l.onprogress=function(e){null!=i&&i(e)},l.onerror=function(){null!=o&&o("Failed to get data from server.")},l.onabort=function(){null!=o&&o("Aborted get data from server.")},l.send(null),l},p.GetHttpRequestAsync=function(e,o,i,r,a){return void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=!1),void 0===a&&(a=null),new Promise(function(t,n){A.Utilities.GetHttpRequest(e,o,function(e){t(e)},function(e){n(e)},i,r,a)})},p.PostHttpRequest=function(e,t,n,o,i,r,a,l,s){void 0===n&&(n=null),void 0===o&&(o="application/x-www-form-urlencoded"),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=!1),void 0===s&&(s=null);var u=new XMLHttpRequest;return u.open("POST",e,!0),!0===l&&(u.responseType="arraybuffer"),null!=s&&u.overrideMimeType(s),null!=n&&n.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&u.setRequestHeader(e.name,e.value)}),u.setRequestHeader("Content-Type",o),u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&null!=i&&i(u)},u.onprogress=function(e){null!=a&&a(e)},u.onerror=function(){null!=r&&r("Failed to post data to server.")},u.onabort=function(){null!=r&&r("Aborted post data to server.")},u.send(t),u},p.PostHttpRequestAsync=function(e,o,i,r,a,l,s){return void 0===i&&(i=null),void 0===r&&(r="application/x-www-form-urlencoded"),void 0===a&&(a=null),void 0===l&&(l=!1),void 0===s&&(s=null),new Promise(function(t,n){A.Utilities.PostHttpRequest(e,o,i,r,function(e){t(e)},function(e){n(e)},a,l,s)})},p.RemapValueToRange=function(e,t,n,o,i){return o+(e-t)*(i-o)/(n-t)},p.CloneSkeletonPrefab=function(e,t,n,o,i){void 0===i&&(i=null);var r=new BABYLON.Skeleton(n,o||n,e);r.needInitialSkinMatrix=t.needInitialSkinMatrix;for(var a=0;a<t.bones.length;a++){var l=t.bones[a],s=null,u=l.getParent(),u=(u&&(u=t.bones.indexOf(u),s=r.bones[u]),new BABYLON.Bone(l.name,r,s,l.getBaseMatrix().clone(),l.getRestPose().clone()));u._index=l._index,u.metadata=l.metadata,l._linkedTransformNode&&u.linkTransformNode(l._linkedTransformNode),BABYLON.DeepCopier.DeepCopy(l.animations,u.animations)}var c=r,d=t;if(d._ranges)for(var p in c._ranges={},d._ranges){var h=d._ranges[p];h&&(c._ranges[p]=h.clone())}return d._isDirty=!0,r},p.GetSceneTransforms=function(e){var t=null;return null!=e.transformNodes&&0<e.transformNodes.length&&e.transformNodes.forEach(function(e){null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.prefab&&!1===e.metadata.unity.prefab&&(t=null==t?[]:t).push(e)}),null!=e.meshes&&0<e.meshes.length&&e.meshes.forEach(function(e){null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.prefab&&!1===e.metadata.unity.prefab&&(t=null==t?[]:t).push(e)}),t},p.PostParseSceneComponents=function(e,t,n,o){var i=new A.MetadataParser(e);return null!=t&&0<t.length&&(t.forEach(function(e){i.parseSceneComponents(e)}),i.postProcessSceneComponents(n,o)),i},p.GetAssetContainerMesh=function(e,t){var n=null,o=t.toLowerCase();if(null==n&&null!=e.meshes&&0<e.meshes.length)for(var i=0;i<e.meshes.length;i++){var r=e.meshes[i];if(r instanceof BABYLON.Mesh&&r.name.toLowerCase()===o){n=r;break}}return n},p.GetAssetContainerNode=function(e,t){var n=null,o=t.toLowerCase();if(null==n&&null!=e.transformNodes&&0<e.transformNodes.length)for(var i=0;i<e.transformNodes.length;i++){var r=e.transformNodes[i];if(r.name.toLowerCase()===o){n=r;break}}return n},p.CloneAssetContainerItem=function(u,e,c,t,s,n){void 0===t&&(t=null),void 0===s&&(s=!1),void 0===n&&(n=!0);function d(e,t){null==_&&(_=t),p[e.uniqueId]=t.uniqueId,h[t.uniqueId]=t,c&&(t.name=c(e.name)),null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.entity&&(t.metadata=A.Utilities.CloneEntityMetadata(e.metadata));var n=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.animator?t.metadata.unity.animator:null;if(null!=n&&""!==n&&((g=null==g?[]:g).indexOf(n)<0&&g.push(n),t.metadata.unity.animator=A.Utilities.CreateGuid(),m[n]=t.metadata.unity.animator),e instanceof BABYLON.AbstractMesh&&null!=e.skeleton&&(f=null==f?[]:f).indexOf(e.skeleton)<0&&f.push(e.skeleton),t instanceof BABYLON.Mesh){var o=t;if(o.morphTargetManager){var i=e.morphTargetManager;o.morphTargetManager=i.clone();for(var r=0;r<i.numTargets;r++){var a=i.getTarget(r),l=o.morphTargetManager.getTarget(r);p[a.uniqueId]=l.uniqueId,h[l.uniqueId]=l}}}}var o,i=null,p={},h={},m={},g=null,f=null,y=[],v=[],r=e.toLowerCase(),_=null;if(null==i&&null!=u.transformNodes&&0<u.transformNodes.length)for(var a=0;a<u.transformNodes.length;a++){var l=u.transformNodes[a];if(l.name.toLowerCase()===r){l=A.Utilities.InstantiateHierarchy(l,t,function(e,t){d(e,t)});if(l){i=l;break}}}if(null==i&&null!=u.meshes&&0<u.meshes.length)for(a=0;a<u.meshes.length;a++)if("break"===function(e){var l=u.meshes[e];if(l.name.toLowerCase()===r){e=A.Utilities.InstantiateHierarchy(l,t,function(e,t){d(e,t);var n=t;if(!0===l.isWorldMatrixFrozen&&n.freezeWorldMatrix&&n.freezeWorldMatrix(),t.material&&n.material)if(!0===s){t=e.material;if(-1===v.indexOf(t)){var o=t.clone(c?c(t.name):"Clone of "+t.name);if(!0===t.isFrozen&&o.freeze&&o.freeze(),v.push(t),p[t.uniqueId]=o.uniqueId,h[o.uniqueId]=o,"MultiMaterial"===t.getClassName())for(var i=0,r=t.subMaterials;i<r.length;i++){var a=r[i];a&&(o=a.clone(c?c(a.name):"Clone of "+a.name),!0===a.isFrozen&&o.freeze&&o.freeze(),v.push(a),p[a.uniqueId]=o.uniqueId,h[o.uniqueId]=o)}}n.material=h[p[t.uniqueId]]}else"MultiMaterial"===n.material.getClassName()?-1===u.scene.multiMaterials.indexOf(n.material)&&u.scene.addMultiMaterial(n.material):-1===u.scene.materials.indexOf(n.material)&&u.scene.addMaterial(n.material)});if(e)return i=e,"break"}}(a))break;return null!=f&&0<f.length&&f.forEach(function(e){for(var t=c?c(e.name):"Clone of "+e.name,n=A.Utilities.CloneSkeletonPrefab(u.scene,e,t,t,_),o=0,i=u.meshes;o<i.length;o++){var r=i[o];if(r.skeleton===e&&!r.isAnInstance){r=h[p[r.uniqueId]];if(r.skeleton=n,-1===y.indexOf(n)){y.push(n);for(var a=0,l=n.bones;a<l.length;a++){var s=l[a];s._linkedTransformNode&&(s._linkedTransformNode=h[p[s._linkedTransformNode.uniqueId]])}}}}}),!0===n&&(o=null,u.animationGroups.forEach(function(e){var t=e,n=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.source&&""!==t.metadata.unity.source?t.metadata.unity.source:null;null!=n&&""!==n&&null!=g&&0<=g.indexOf(n)&&(e=e.clone(e.name,function(e){return h[p[e.uniqueId]]||e}),n=m[n]||n,null!=t.metadata&&(e.metadata={},e.metadata.unity={},e.metadata.unity.id=t.metadata.unity.id,e.metadata.unity.clip=t.metadata.unity.clip,e.metadata.unity.source=n,e.metadata.unity.legacy=t.metadata.unity.legacy,e.metadata.unity.length=t.metadata.unity.length,e.metadata.unity.looping=t.metadata.unity.looping,e.metadata.unity.settings=t.metadata.unity.settings,e.metadata.unity.behavior=t.metadata.unity.behavior,e.metadata.unity.wrapmode=t.metadata.unity.wrapmode,e.metadata.unity.framerate=t.metadata.unity.framerate,e.metadata.unity.humanmotion=t.metadata.unity.humanmotion,e.metadata.unity.averagespeed=t.metadata.unity.averagespeed,e.metadata.unity.averageduration=t.metadata.unity.averageduration,e.metadata.unity.averageangularspeed=t.metadata.unity.averageangularspeed),(o=null==o?[]:o).push(e))}),null!=i)&&null!=o&&A.Utilities.AssignAnimationGroupsToInstance(i,o),i},p.AssignAnimationGroupsToInstance=function(e,t){A.Utilities.AssignAnimationGroupsToNode(e,t);e=e.getChildren(null,!1);null!=e&&0<e.length&&e.forEach(function(e){A.Utilities.AssignAnimationGroupsToNode(e,t)})},p.AssignAnimationGroupsToNode=function(e,t){if(null!=e&&null!=e.metadata&&e.metadata.unity){var n=e.metadata.unity;if(null!=n.components&&0<n.components.length)for(var o=0;o<n.components.length;o++)if("UNITY.AnimationState"===n.components[o].klass){e.metadata.unity.sourceAnimationGroups=t;break}}},p.InstantiateHierarchy=function(e,t,n){var o;return void 0===t&&(t=null),e instanceof BABYLON.Mesh?(o=null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.instance&&!0===e.metadata.unity.instance,A.Utilities.InstantiateMeshHierarchy(e,t,o,n)):A.Utilities.InstantiateNodeHierarchy(e,t,n)},p.InstantiateNodeHierarchy=function(e,t,n){var o=e.clone("Clone of "+(e.name||e.id),t=void 0===t?null:t,!0);o&&n&&n(e,o);for(var i=0,r=e.getChildTransformNodes(!0);i<r.length;i++){var a=r[i];A.Utilities.InstantiateHierarchy(a,o,n)}return o},p.InstantiateMeshHierarchy=function(e,t,n,o){void 0===t&&(t=null);var i=0<e.getTotalVertices()&&!0===n?e.createInstance("Instance of "+(e.name||e.id)):e.clone("Clone of "+(e.name||e.id),t||e.parent,!0);i&&(i.parent=t,i.position=e.position.clone(),i.scaling=e.scaling.clone(),e.rotationQuaternion?i.rotationQuaternion=e.rotationQuaternion.clone():i.rotation=e.rotation.clone(),o)&&o(e,i);for(var r=0,a=e.getChildTransformNodes(!0);r<a.length;r++){var l=a[r];A.Utilities.InstantiateHierarchy(l,i,o)}return i},p.RetargetAnimationGroupSkeleton=function(e,o,i){void 0===i&&(i=null),null!=e&&null!=o&&e.targetedAnimations.forEach(function(t,e){var n;null!=t.target&&null!=t.target.name&&(null!=(n=o.bones.filter(function(e){return e.name.toLowerCase()===t.target.name.toLowerCase()})[0])?null!=n.getTransformNode()&&(t.target=n.getTransformNode()):"Armature"===t.target.name&&null!=i?t.target=i:console.warn("Failed to locate matching animation cloning target: "+t.target.name))})},p.RetargetAnimationGroupBlendShapes=function(e,t){null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,t){null!=e.target&&e.target.name})},p.LinkSkeletonMeshes=function(e,t){if(null!=e&&null!=e.bones&&0<e.bones.length&&null!=t&&null!=t.bones&&0<t.bones.length)for(var n=t.bones.length,o=0;o<n;o++){var i,r=t.bones[o];null!=r&&(null!=(i=A.Utilities.FindBoneByName(e,r.name))?r._linkedTransformNode=i._linkedTransformNode:console.warn("Failed to locate bone on mater rig: "+r.name))}},p.FindBoneByName=function(e,t){var n=null;if(null!=e&&null!=e.bones)for(var o=0;o<e.bones.length;o++){var i=e.bones[o];if(i.name.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right")===t.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right")){n=i;break}}return n},p.SwitchHandednessVector3=function(e){return new BABYLON.Vector3(e.x,e.y,-e.z)},p.SwitchHandednessVector4=function(e){return new BABYLON.Vector4(e.x,e.y,-e.z,-e.w)},p.SwitchHandednessQuaternion=function(e){return new BABYLON.Quaternion(e.x,e.y,-e.z,-e.w)},p.ComputeBlendingSpeed=function(e,t,n){e=1/(e*t);return!0===(n=void 0===n?!1:n)&&(e*=.5),e},p.CalculateCameraDistance=function(e,t,n){void 0===n&&(n=1);return Math.round(e*n*t*1)},p.InstantiateClass=function(e){for(var t=e.split("."),n=window||globalThis||this,o=0,i=t.length;o<i;o++)n=n[t[o]];return"function"==typeof n?n:null},p.GetSimpleClassName=function(e){if(e&&e.constructor&&e.constructor.toString){e=e.constructor.toString().match(/function\s*(\w+)/);if(e&&2==e.length)return e[1]}},p.DisposeEntity=function(e){var t;null!=e&&(null!=e.metadata&&e.metadata.unity&&(null!=(t=e.metadata.unity).components&&0<t.components.length&&t.components.forEach(function(e){if(null!=e.instance){try{A.SceneManager.DestroyScriptComponent(e.instance)}catch(e){}e.instance=null}}),delete e.metadata.unity),null!=e.metadata&&e.metadata.mixer&&delete e.metadata.mixer,null!=e.metadata&&null!=e.metadata.clone&&delete e.metadata.clone,null!=e.physicsImpostor&&(null!=(t=e.physicsImpostor).onCollideEvent&&(t.onCollideEvent=null),null!=t.tmpCollisionObjects&&delete t.tmpCollisionObjects,null!=e.physicsImpostor.physicsBody&&(null!=e.physicsImpostor.physicsBody.entity&&delete e.physicsImpostor.physicsBody.entity,null!=e.physicsImpostor.physicsBody.triangleMapInfo)&&delete e.physicsImpostor.physicsBody.triangleMapInfo,e.physicsImpostor.dispose(),e.physicsImpostor=null),null!=e.skeleton&&(null!=e.skeleton._sockets&&delete e.skeleton._sockets,null!=e.skeleton.bones)&&0<e.skeleton.bones.length&&e.skeleton.bones.forEach(function(e){null!=e&&null!=e.metadata&&(e.metadata=null)}),null!=e.cameraRig&&(e.cameraRig.dispose&&e.cameraRig.dispose(),delete e.cameraRig),null!=e.lightRig&&(e.lightRig.dispose&&e.lightRig.dispose(),delete e.lightRig),null!=e.shadowBox&&(e.shadowBox.dispose&&e.shadowBox.dispose(),delete e.shadowBox),null!=e._debugCollider&&(e._debugCollider.dispose&&e._debugCollider.dispose(),delete e._debugCollider),null!=e._meshCollider&&(e._meshCollider=null),null!=e._colliderType&&delete e._colliderType,null!=e._skinnedMesh)&&delete e._skinnedMesh},p.SearchTransformNodes=function(e,t,n){var o=null,i=null!=(n=void 0===n?A.SearchType.ExactMatch:n)?n:A.SearchType.ExactMatch;if(null!=t&&0<t.length)for(var r=0;r<t.length;r++){var a=t[r];if(i===A.SearchType.ExactMatch){if(a.name===e){o=a;break}}else if(i===A.SearchType.StartsWith){if(A.Utilities.StartsWith(a.name,e)){o=a;break}}else if(i===A.SearchType.EndsWith){if(A.Utilities.EndsWith(a.name,e)){o=a;break}}else if(i===A.SearchType.IndexOf){if(0<=a.name.indexOf(e)){o=a;break}}else if(a.name===e){o=a;break}}return o},p.SearchTransformNodeForTags=function(e,t){var n=null;if(null!=t&&0<t.length)for(var o=0;o<t.length;o++){var i=t[o];if(i instanceof BABYLON.TransformNode&&BABYLON.Tags.MatchesQuery(i,e)){n=i;break}}return n},p.SearchAllTransformNodesForTags=function(e,t){var n=null;if(null!=t&&0<t.length)for(var o=0;o<t.length;o++){var i=t[o];i instanceof BABYLON.TransformNode&&BABYLON.Tags.MatchesQuery(i,e)&&(n=null==n?[]:n).push(i)}return n},p.SearchTransformNodeForScript=function(e,t){var n=null;if(null!=t&&0<t.length)for(var o=0;o<t.length;o++){var i=t[o];if(i instanceof BABYLON.TransformNode)if(null!=A.SceneManager.FindScriptComponent(i,e)){n=i;break}}return n},p.SearchAllTransformNodesForScript=function(e,t){var n=null;if(null!=t&&0<t.length)for(var o=0;o<t.length;o++){var i=t[o];i instanceof BABYLON.TransformNode&&null!=A.SceneManager.FindScriptComponent(i,e)&&(n=null==n?[]:n).push(i)}return n},p.CreateGuid=function(e){void 0===e&&(e=null);var t=BABYLON.Tools.RandomId();return A.Utilities.IsNullOrEmpty(e)||(t+="-"+e),t},p.ValidateTransformGuid=function(e){var t;null!=e&&null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.guid&&""!==e.metadata.unity.guid&&(t=e.metadata.unity.guid,e.id!==t&&(e.id=t),delete e.metadata.unity.guid)},p.AddShadowCastersToLight=function(t,e,n){void 0===n&&(n=!1);var o=t.getShadowGenerator();if(null!=o){var i=o.getShadowMap();if(null!=i)for(var r=0;r<e.length;r++){var a=e[r];a instanceof BABYLON.AbstractMesh&&(null!=t.includedOnlyMeshes&&0<t.includedOnlyMeshes.length&&t.includedOnlyMeshes.indexOf(a)<0&&t.includedOnlyMeshes.push(a),null==i.renderList&&(i.renderList=[]),i.renderList.indexOf(a)<0)&&i.renderList.push(a),!0===n&&null!=(a=a.getChildMeshes())&&0<a.length&&a.forEach(function(e){null!=t.includedOnlyMeshes&&0<t.includedOnlyMeshes.length&&t.includedOnlyMeshes.indexOf(e)<0&&t.includedOnlyMeshes.push(e),null==i.renderList&&(i.renderList=[]),i.renderList.indexOf(e)<0&&i.renderList.push(e)})}}},p.RegisterInstancedMeshBuffers=function(t){var e=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.buffers?t.metadata.unity.buffers:null;null!=e&&(null!=e.floats&&0<e.floats.length&&e.floats.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,1),t.instancedBuffers[e.kind]=e.value)}),null!=e.colors&&0<e.colors.length&&e.colors.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,4),t.instancedBuffers[e.kind]=new BABYLON.Color4(e.value.r||0,e.value.g||0,e.value.b||0,e.value.a||1).toLinearSpace())}),null!=e.vector2&&0<e.vector2.length&&e.vector2.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,2),t.instancedBuffers[e.kind]=new BABYLON.Vector2(e.value.x||0,e.value.y||0))}),null!=e.vector3&&0<e.vector3.length&&e.vector3.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,3),t.instancedBuffers[e.kind]=new BABYLON.Vector3(e.value.x||0,e.value.y||0,e.value.z||0))}),null!=e.vector4)&&0<e.vector4.length&&e.vector4.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,4),t.instancedBuffers[e.kind]=new BABYLON.Vector4(e.value.x||0,e.value.y||0,e.value.z||0,e.value.w||0))})},p.CloneValue=function(e,t){return!e||e instanceof BABYLON.Mesh?null:e instanceof BABYLON.SubMesh?e.clone(t):e.clone?e.clone():e},p.CloneEntityMetadata=function(e){var t,n,o,i,r,a,l,s,u,c,d,p,h,m,g,f,y,v,_,B,b,C,T,I,S=null;return S=null!=e&&((t=null)!=e.unity&&(n=null!=e.unity.instance&&e.unity.instance,o=null==e.unity.visible||e.unity.visible,i=null!=e.unity.visibility?e.unity.visibility:1,r=null!=e.unity.billboard?e.unity.billboard:0,a=null!=e.unity.tags?e.unity.tags:"Untagged Layer0",l=null!=e.unity.skin&&e.unity.skin,s=null!=e.unity.bone?e.unity.bone:null,u=null!=e.unity.rootbone&&e.unity.rootbone,c=null!=e.unity.rootpos?e.unity.rootpos:null,d=null!=e.unity.rootrot?e.unity.rootrot:null,p=null!=e.unity.group?e.unity.group:"Untagged",h=null!=e.unity.layer?e.unity.layer:0,m=null!=e.unity.layername?e.unity.layername:"Default",g=null!=e.unity.navigation?e.unity.navigation:null,f=null!=e.unity.lightmapped&&e.unity.lightmapped,y=null!=e.unity.lightmapuvs?e.unity.lightmapuvs:null,v=null!=e.unity.animator?e.unity.animator:null,C=b=B=_=null,e.unity.physics&&A.Utilities.DeepCopyProperties(e.unity.physics,_={}),e.unity.renderer&&A.Utilities.DeepCopyProperties(e.unity.renderer,B={}),e.unity.collision&&A.Utilities.DeepCopyProperties(e.unity.collision,b={}),e.unity.properties&&A.Utilities.DeepCopyProperties(e.unity.properties,C={}),(T=null)!=e.unity.wheels&&0<e.unity.wheels.length&&(T=[],e.unity.wheels.forEach(function(e){null!=e&&(A.Utilities.DeepCopyProperties(e,e={}),T.push(e))})),(I=null)!=e.unity.components&&0<e.unity.components.length&&(I=[],e.unity.components.forEach(function(e){null!=e&&((e=A.Utilities.FastJsonCopy(e)).instance=null,I.push(e))})),(t={parsed:!1,prefab:!1,buffers:null,lods:null,coverages:null,distances:null,handlers:null}).instance=n,t.visible=o,t.visibility=i,t.billboard=r,t.tags=a,t.skin=l,t.bone=s,t.rootbone=u,t.rootpos=c,t.rootrot=d,t.group=p,t.layer=h,t.layername=m,t.navigation=g,t.lightmapped=f,t.lightmapuvs=y,t.animator=v,t.renderer=B,t.physics=_,t.wheels=T,t.collision=b,t.properties=C,t.components=I),null!=t)?{unity:t}:S},p.FastJsonCopy=function(e){if(!e)return e;if(Array.isArray(e)){for(var t=[],n=e.length,o=0;o<n;o++)t.push(A.Utilities.FastJsonCopy(e[o]));return t}if("object"!=typeof e)return e;for(var i=Object.keys(e),r={},o=i.length-1;-1<o;o--){var a=i[o];r[a]=A.Utilities.FastJsonCopy(e[a])}return r},p.DeepCopyProperties=function(e,t,n,o){for(var i in e)if(("_"!==i[0]||o&&-1!==o.indexOf(i))&&(!n||-1===n.indexOf(i))){var r=e[i],a=typeof r;if("function"!=a)if("object"==a)if(r instanceof Array){if(t[i]=[],0<r.length)if("object"==typeof r[0])for(var l=0;l<r.length;l++){var s=A.Utilities.CloneValue(r[l],t);-1===t[i].indexOf(s)&&t[i].push(s)}else t[i]=r.slice(0)}else t[i]=A.Utilities.CloneValue(r,t);else t[i]=r}},p.ValidateTransformMetadata=function(e){null==e.metadata&&(e.metadata={}),null==e.metadata.unity&&(e.metadata.unity={});var t=e.metadata.unity;A.Utilities.HasOwnProperty(t,"entity")||(e.metadata.unity.entity=!0),A.Utilities.HasOwnProperty(t,"parsed")||(e.metadata.unity.parsed=!1),A.Utilities.HasOwnProperty(t,"prefab")||(e.metadata.unity.prefab=!1),A.Utilities.HasOwnProperty(t,"instance")||(e.metadata.unity.instance=!1),A.Utilities.HasOwnProperty(t,"buffers")||(e.metadata.unity.buffers=null),A.Utilities.HasOwnProperty(t,"visible")||(e.metadata.unity.visible=!0),A.Utilities.HasOwnProperty(t,"visibility")||(e.metadata.unity.visibility=1),A.Utilities.HasOwnProperty(t,"billboard")||(e.metadata.unity.billboard=0),A.Utilities.HasOwnProperty(t,"tags")||(e.metadata.unity.tags="Untagged Layer0"),A.Utilities.HasOwnProperty(t,"skin")||(e.metadata.unity.skin=!1),A.Utilities.HasOwnProperty(t,"bone")||(e.metadata.unity.bone=null),A.Utilities.HasOwnProperty(t,"rootbone")||(e.metadata.unity.rootbone=!1),A.Utilities.HasOwnProperty(t,"rootpos")||(e.metadata.unity.rootpos=null),A.Utilities.HasOwnProperty(t,"rootrot")||(e.metadata.unity.rootrot=null),A.Utilities.HasOwnProperty(t,"group")||(e.metadata.unity.group="Untagged"),A.Utilities.HasOwnProperty(t,"layer")||(e.metadata.unity.layer=0),A.Utilities.HasOwnProperty(t,"layername")||(e.metadata.unity.layername="Default"),A.Utilities.HasOwnProperty(t,"navigation")||(e.metadata.unity.navigation=null),A.Utilities.HasOwnProperty(t,"lightmapped")||(e.metadata.unity.lightmapped=!1),A.Utilities.HasOwnProperty(t,"lightmapuvs")||(e.metadata.unity.lightmapuvs=!1),A.Utilities.HasOwnProperty(t,"animator")||(e.metadata.unity.animator=null),A.Utilities.HasOwnProperty(t,"lods")||(e.metadata.unity.lods=null),A.Utilities.HasOwnProperty(t,"coverages")||(e.metadata.unity.coverages=null),A.Utilities.HasOwnProperty(t,"distances")||(e.metadata.unity.distances=null),A.Utilities.HasOwnProperty(t,"handlers")||(e.metadata.unity.handlers=null),A.Utilities.HasOwnProperty(t,"physics")||(e.metadata.unity.physics=null),A.Utilities.HasOwnProperty(t,"wheels")||(e.metadata.unity.wheels=null),A.Utilities.HasOwnProperty(t,"renderer")||(e.metadata.unity.renderer=null),A.Utilities.HasOwnProperty(t,"collision")||(e.metadata.unity.collision=null),A.Utilities.HasOwnProperty(t,"properties")||(e.metadata.unity.properties=null),A.Utilities.HasOwnProperty(t,"components")||(e.metadata.unity.components=null)},p.UpVector=BABYLON.Vector3.Up(),p.AuxVector=BABYLON.Vector3.Zero(),p.ZeroVector=BABYLON.Vector3.Zero(),p.TempMatrix=BABYLON.Matrix.Zero(),p.TempMatrix2=BABYLON.Matrix.Zero(),p.TempVector2=BABYLON.Vector2.Zero(),p.TempVector3=BABYLON.Vector3.Zero(),p.TempQuaternion=BABYLON.Quaternion.Zero(),p.TempQuaternion2=BABYLON.Quaternion.Zero(),p.TempQuaternion3=BABYLON.Quaternion.Zero(),p.TempDirectionBuffer=BABYLON.Vector3.Zero(),p.LoadingState=-1,p.OnPreloaderProgress=null,p.OnPreloaderComplete=null,p.LoaderItemsMarkedForDisposal=[],A.Utilities=p}(UNITY=UNITY||{}),UNITY.Utilities),__extends=(BABYLON.Bone.prototype.linkTransformNode=function(e){(e._linkedBone=this)._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}()),CVTOOLS_NAME=(!function(a){function e(){this._defines={},this._defines={}}e.prototype.getDefines=function(){return this._defines},e.prototype.defineBoolean=function(e){this._defines[e]=!0},e.prototype.defineNumeric=function(e,t){this._defines[e]=t},e.ShaderIndexer=0,a.UniversalShaderDefines=e;a.UniversalAlbedoChunks=function(){},i=BABYLON.PBRMaterial,__extends(n,i),n.prototype.updateShaderChunks=function(){},n.prototype.getShaderName=function(){return"pbr"},n.prototype.getShaderChunk=function(){return null},n.prototype.getShaderDefines=function(){return this._defines},n.prototype.getCustomAttributes=function(){return null},Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){!0===this._enableTime&&(!1===this._timeInitialized?(this._timeInitialized=!0,this.setFloat("gameTime",a.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",a.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",a.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",a.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},n.prototype.getTexture=function(e){return this._textures[e]},n.prototype.getVector4=function(e){return this._vectors4[e]},n.prototype.getFloat=function(e){return this._floats[e]},n.prototype.setTexture=function(e,t,n){return!0===(n=void 0===n?!1:n)&&this.checkSampler(e),this._textures[e]=t,this},n.prototype.setVector4=function(e,t,n){return!0===(n=void 0===n?!1:n)&&this.checkUniform(e),this._vectors4[e]=t,this},n.prototype.setFloat=function(e,t,n){return!0===(n=void 0===n?!1:n)&&this.checkUniform(e),this._floats[e]=t,this},n.prototype.addAttribute=function(e){-1===this._attributes.indexOf(e)&&this._attributes.push(e)},n.prototype.checkUniform=function(e){-1===this._uniforms.indexOf(e)&&(this._uniforms.push(e),this.locals.defineBoolean(e.toUpperCase()))},n.prototype.checkSampler=function(e){-1===this._samplers.indexOf(e)&&(this._samplers.push(e),this.locals.defineBoolean(e.toUpperCase()),this.checkUniform(e+"Infos"),this.checkUniform(e+"Matrix"))},n.prototype.getAnimatables=function(){var e,t=i.prototype.getAnimatables.call(this);for(e in this._textures){var n=this._textures[e];n&&n.animations&&0<n.animations.length&&t.push(n)}return t},n.prototype.getActiveTextures=function(){var e,t=i.prototype.getActiveTextures.call(this);for(e in this._textures){var n=this._textures[e];n&&t.push(n)}return t},n.prototype.hasTexture=function(e){if(i.prototype.hasTexture.call(this,e))return!0;var t,n=!1;for(t in this._textures){var o=this._textures[t];if(o==o){n=!0;break}}return n},n.prototype.dispose=function(e,t){if(t)for(var n in this._textures){var o=this._textures[n];o&&o.dispose(),this._textures[n]=null}this._textures={},i.prototype.dispose.call(this,e,t)},n.prototype.clone=function(e){var t,n=this,o=BABYLON.SerializationHelper.Clone(function(){return new a.UniversalAlbedoMaterial(e,n.getScene())},this);for(t in o._textures={},this._textures){var i=this._textures[t];i&&o.setTexture(t,i.clone(),!0)}for(t in o._vectors4={},this._vectors4)o.setVector4(t,this._vectors4[t].clone(),!0);for(t in o._floats={},this._floats)o.setFloat(t,this._floats[t],!0);return o},n.prototype.serialize=function(){var e,t=BABYLON.SerializationHelper.Serialize(this);for(e in t.customType="UNITY.UniversalAlbedoMaterial",t.textures={},this._textures){var n=this._textures[e];n&&(t.textures[e]=n.serialize())}for(e in t.vectors4={},this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();for(e in t.floats={},this._floats)t.floats[e]=this._floats[e];return t},n.Parse=function(e,t,n){var o,i=BABYLON.SerializationHelper.Parse(function(){return new a.UniversalAlbedoMaterial(e.name,t)},e,t,n);for(o in e.textures){var r=e.textures[o];r&&i.setTexture(o,BABYLON.Texture.Parse(r,t,n),!0)}for(o in e.vectors4)i.setVector4(o,BABYLON.Vector4.FromArray(e.vectors4[o]),!0);for(o in e.floats)i.setFloat(o,e.floats[o],!0);return i},n.prototype.customShaderChunkResolve=function(){var e,t,n=this.getShaderChunk();null!=n&&""!==n&&(n=n+"ShaderChunks",null!=BABYLON.Effect.ShadersStore[n]?(e=BABYLON.Effect.ShadersStore[n],null!=(t=a.Utilities.HasOwnProperty(e,"VertexBegin")?e.VertexBegin:null)&&""!==t&&(this.materialShaderChunks.Vertex_Begin=t),null!=(t=a.Utilities.HasOwnProperty(e,"VertexDefinitions")?e.VertexDefinitions:null)&&""!==t&&(this.materialShaderChunks.Vertex_Definitions=t),null!=(t=a.Utilities.HasOwnProperty(e,"VertexMainBegin")?e.VertexMainBegin:null)&&""!==t&&(this.materialShaderChunks.Vertex_MainBegin=t),null!=(t=a.Utilities.HasOwnProperty(e,"VertexUpdatePosition")?e.VertexUpdatePosition:null)&&""!==t&&(this.materialShaderChunks.Vertex_Before_PositionUpdated=t.replace("result","positionUpdated")),null!=(t=a.Utilities.HasOwnProperty(e,"VertexUpdateNormal")?e.VertexUpdateNormal:null)&&""!==t&&(this.materialShaderChunks.Vertex_Before_NormalUpdated=t.replace("result","normalUpdated")),null!=(t=a.Utilities.HasOwnProperty(e,"VertexWorldPos")?e.VertexWorldPos:null)&&""!==t&&(this.materialShaderChunks.Vertex_After_WorldPosComputed=t),null!=(t=a.Utilities.HasOwnProperty(e,"VertexMainEnd")?e.VertexMainEnd:null)&&""!==t&&(this.materialShaderChunks.Vertex_MainEnd=t),null!=(t=a.Utilities.HasOwnProperty(e,"FragmentBegin")?e.FragmentBegin:null)&&""!==t&&(this.materialShaderChunks.Fragment_Begin=t),null!=(t=a.Utilities.HasOwnProperty(e,"FragmentDefinitions")?e.FragmentDefinitions:null)&&""!==t&&(this.materialShaderChunks.Fragment_Definitions=t),null!=(t=a.Utilities.HasOwnProperty(e,"FragmentMainBegin")?e.FragmentMainBegin:null)&&""!==t&&(this.materialShaderChunks.Fragment_MainBegin=t),null!=(t=a.Utilities.HasOwnProperty(e,"FragmentUpdateAlbedo")?e.FragmentUpdateAlbedo:null)&&""!==t&&(this.materialShaderChunks.Fragment_Custom_Albedo=t.replace("result","surfaceAlbedo")),null!=(t=a.Utilities.HasOwnProperty(e,"FragmentUpdateAlpha")?e.FragmentUpdateAlpha:null)&&""!==t&&(this.materialShaderChunks.Fragment_Custom_Alpha=t.replace("result","alpha")),null!=(t=a.Utilities.HasOwnProperty(e,"FragmentMetallicRoughness")?e.FragmentMetallicRoughness:null)&&""!==t&&(this.materialShaderChunks.Fragment_MetallicRoughness=t),null!=(t=a.Utilities.HasOwnProperty(e,"FragmentMicroSurface")?e.FragmentMicroSurface:null)&&""!==t&&(this.materialShaderChunks.Fragment_MicroSurface=t),null!=(t=a.Utilities.HasOwnProperty(e,"FragmentBeforeLights")?e.FragmentBeforeLights:null)&&""!==t&&(this.materialShaderChunks.Fragment_Before_Lights=t),null!=(t=a.Utilities.HasOwnProperty(e,"FragmentBeforeFog")?e.FragmentBeforeFog:null)&&""!==t&&(this.materialShaderChunks.Fragment_Before_Fog=t),null!=(t=a.Utilities.HasOwnProperty(e,"FragmentBeforeFragColor")?e.FragmentBeforeFragColor:null)&&""!==t&&(this.materialShaderChunks.Fragment_Before_FragColor=t.replace("result","color"))):BABYLON.Tools.Warn("Failed To Locate Shader Chunk Base: "+n))},n.prototype._buildCustomShader=function(e,t,n,o,i,r,a){var l=this,s=(null==a||null!=a.processFinalCode&&null!=a.processFinalCode||(a.processFinalCode=function(e,t){return"vertex"===e?t:((e=new BABYLON.ShaderCodeInliner(t)).inlineToken="#define pbr_inline",e.processCode(),e.code)}),this._defines=i,this.locals.getDefines());if(null!=s&&null!=this._defines){a=Object.keys(s);if(null!=a&&0<a.length){for(var u=this._defines,c=0,d=a;c<d.length;c++){var p=d[c];u[p]=s[p]}this._defines.rebuild()}}var h=0;if(null!=this._uniforms&&0<this._uniforms.length)for(h=0;h<this._uniforms.length;h++){var m=this._uniforms[h];-1===t.indexOf(m)&&t.push(m)}if(h=0,null!=this._samplers&&0<this._samplers.length)for(h=0;h<this._samplers.length;h++){var g=this._samplers[h];-1===o.indexOf(g)&&o.push(g)}if(h=0,null!=this._attributes&&0<this._attributes.length)for(h=0;h<this._attributes.length;h++){var f=this._attributes[h];-1===r.indexOf(f)&&r.push(f)}var y,h=0,v=this.getCustomAttributes();if(null!=v&&0<v.length)for(h=0;h<v.length;h++){var _=v[h];-1===r.indexOf(_)&&r.push(_)}return null!=this._createdShaderName&&""!==this._createdShaderName||(null!=(i=null!=(i=this.getShaderName())&&""!==i?i:e)&&""!==i||(i="pbr"),y=this._afterBind.bind(this),this._afterBind=function(e,t){if(t){l._attachAfterBind(e,t);try{y(e,t)}catch(t){}}},this._createdShaderName=!0===this.enableShaderChunks?this._createShaderChunks(i):i),this._createdShaderName},n.prototype._createShaderChunks=function(e){var t=this.getShaderChunk(),t=(null!=t&&""!==t||(t=e),a.UniversalShaderDefines.ShaderIndexer++,(t+"Custom"+a.UniversalShaderDefines.ShaderIndexer).trim()),n=BABYLON.Effect.ShadersStore[e+"VertexShader"],e=BABYLON.Effect.ShadersStore[e+"PixelShader"],o=(e=(e=(e=e.replace(/#include<pbrBlockAlbedoOpacity>/g,BABYLON.Effect.IncludesShadersStore.pbrBlockAlbedoOpacity)).replace(/#include<pbrBlockReflectivity>/g,BABYLON.Effect.IncludesShadersStore.pbrBlockReflectivity)).replace(/#include<pbrBlockFinalColorComposition>/g,BABYLON.Effect.IncludesShadersStore.pbrBlockFinalColorComposition),this.updateShaderChunks(),t+"VertexShader"),n=(BABYLON.Effect.ShadersStore[o]=n.replace("#define CUSTOM_VERTEX_BEGIN",this.materialShaderChunks.Vertex_Begin||"").replace("#define CUSTOM_VERTEX_DEFINITIONS",this.materialShaderChunks.Vertex_Definitions||"").replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.materialShaderChunks.Vertex_MainBegin||"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.materialShaderChunks.Vertex_Before_PositionUpdated||"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.materialShaderChunks.Vertex_Before_NormalUpdated||"").replace("#define CUSTOM_VERTEX_MAIN_END",this.materialShaderChunks.Vertex_MainEnd||""),this.materialShaderChunks.Vertex_After_WorldPosComputed&&(BABYLON.Effect.ShadersStore[o]=BABYLON.Effect.ShadersStore[o].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS",this.materialShaderChunks.Vertex_After_WorldPosComputed)),t+"PixelShader");return BABYLON.Effect.ShadersStore[n]=e.replace("#define CUSTOM_FRAGMENT_BEGIN",this.materialShaderChunks.Fragment_Begin||"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",this.materialShaderChunks.Fragment_Definitions||"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.materialShaderChunks.Fragment_MainBegin||"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.materialShaderChunks.Fragment_Custom_Albedo||"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.materialShaderChunks.Fragment_Custom_Alpha||"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.materialShaderChunks.Fragment_MetallicRoughness||"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.materialShaderChunks.Fragment_MicroSurface||"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.materialShaderChunks.Fragment_Before_Lights||"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog||"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.materialShaderChunks.Fragment_Before_FragColor||""),this.materialShaderChunks.Fragment_Before_Fog&&(BABYLON.Effect.ShadersStore[n]=BABYLON.Effect.ShadersStore[n].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog)),t},n.prototype._attachAfterBind=function(e,t){this.updateGlobalTime();if(this.after&&this.after(),this.getScene().texturesEnabled)for(var n in this._textures){var o=this._textures[n];null!=o&&o.isReady&&o.isReady()&&(null==o.isChecked&&(o.isChecked=!0,"detailsSampler"===n||"normalsSampler"===n||0<=n.indexOf("(Atlas)"))&&o.updateSamplingMode(8),t.setTexture(n,o),t.setFloat2(n+"Infos",o.coordinatesIndex,o.level),t.setMatrix(n+"Matrix",o.getTextureMatrix()))}for(n in this._vectors4)t.setVector4(n,this._vectors4[n]);for(n in this._floats)t.setFloat(n,this._floats[n])};var i,t=n;function n(e,t,n){void 0===n&&(n=!1);n=i.call(this,e,t)||this,n.universalMaterial=!0,n.locals=null,n.terrainInfo=null,n._defines=null,n._uniforms=[],n._samplers=[],n._attributes=[],n._textures={},n._vectors4={},n._floats={},n._enableTime=!1,n._timeInitialized=!1,n.dumpEffect=!1,n.locals=new a.UniversalShaderDefines,n._defines=null,n._createdShaderName=null,n.enableShaderChunks=!1,n.materialShaderChunks=new a.UniversalAlbedoChunks,n.customShaderNameResolve=n._buildCustomShader,n.customShaderChunkResolve(),e=n;return e.awake&&e.awake(),n}a.UniversalAlbedoMaterial=t,BABYLON.RegisterClass("UNITY.UniversalAlbedoMaterial",t);o=BABYLON.ShaderMaterial,__extends(r,o),Object.defineProperty(r.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),r.prototype.updateGlobalTime=function(){!0===this._enableTime&&(this.setFloat("gameTime",a.SceneManager.GetGameTime()),this.setFloat("deltaTime",a.SceneManager.GetDeltaSeconds(this.getScene())))};var o,t=r;function r(e,t,n){e=o.call(this,e,t,null,n)||this;return e._enableTime=!1,e}a.UniversalShaderMaterial=t,BABYLON.RegisterClass("UNITY.UniversalShaderMaterial",t);l=BABYLON.NodeMaterial,__extends(s,l),s.prototype.compile=function(){},Object.defineProperty(s.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),s.prototype.updateGlobalTime=function(){!0===this._enableTime&&(!1===this._timeInitialized?(this._timeInitialized=!0,this.setFloat("gameTime",a.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",a.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",a.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",a.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},s.prototype.getTexture=function(e){return this._textures[e]},s.prototype.getVector4=function(e){return this._vectors4[e]},s.prototype.getFloat=function(e){return this._floats[e]},s.prototype.setTexture=function(e,t,n){return void 0===n&&(n=!1),this._textures[e]=t,this},s.prototype.setVector4=function(e,t,n){return void 0===n&&(n=!1),this._vectors4[e]=t,this},s.prototype.setFloat=function(e,t,n){return void 0===n&&(n=!1),this._floats[e]=t,this},s.prototype.dispose=function(e,t){if(t)for(var n in this._textures){var o=this._textures[n];o&&o.dispose(),this._textures[n]=null}this._textures={},l.prototype.dispose.call(this,e,t)},s.prototype.clone=function(e){var t,n=this,o=BABYLON.SerializationHelper.Clone(function(){return new a.UniversalNodeMaterial(e,n.getScene())},this);for(t in o._textures={},this._textures){var i=this._textures[t];i&&o.setTexture(t,i.clone(),!0)}for(t in o._vectors4={},this._vectors4)o.setVector4(t,this._vectors4[t].clone(),!0);for(t in o._floats={},this._floats)o.setFloat(t,this._floats[t],!0);return o},s.prototype.serialize=function(){var e,t=BABYLON.SerializationHelper.Serialize(this);for(e in t.customType="UNITY.UniversalNodeMaterial",t.textures={},this._textures){var n=this._textures[e];n&&(t.textures[e]=n.serialize())}for(e in t.vectors4={},this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();for(e in t.floats={},this._floats)t.floats[e]=this._floats[e];return t},s.Parse=function(e,t,n){var o,i=BABYLON.SerializationHelper.Parse(function(){return new a.UniversalNodeMaterial(e.name,t)},e,t,n);for(o in e.textures){var r=e.textures[o];r&&i.setTexture(o,BABYLON.Texture.Parse(r,t,n),!0)}for(o in e.vectors4)i.setVector4(o,BABYLON.Vector4.FromArray(e.vectors4[o]),!0);for(o in e.floats)i.setFloat(o,e.floats[o],!0);return i};var l,t=s;function s(e,t,n){var o=l.call(this,e,t,n)||this,i=(o._textures={},o._vectors4={},o._floats={},o._enableTime=!1,o._timeInitialized=!1,o);return i.awake&&i.awake(),o.onBindObservable.add(function(){o.updateGlobalTime(),i.after&&i.after()}),o}a.UniversalNodeMaterial=t,BABYLON.RegisterClass("UNITY.UniversalNodeMaterial",t);u=a.UniversalAlbedoMaterial,__extends(c,u),c.prototype.getShaderName=function(){return"pbr"},c.prototype.getShaderChunk=function(){return null},c.prototype.updateShaderChunks=function(){var e="surfaceAlbedo",t="splatmapSampler",n="detailsSampler",o="normalsSampler",i=a.SceneManager.TerrainColorCorrection;null!=this.materialShaderChunks.Vertex_Definitions&&""!==this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions()+this.materialShaderChunks.Vertex_Definitions:this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions(),null!=this.materialShaderChunks.Vertex_MainEnd&&""!==this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd()+this.materialShaderChunks.Vertex_MainEnd:this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd(),null!=this.materialShaderChunks.Fragment_Definitions&&""!==this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(t,n,o)+this.materialShaderChunks.Fragment_Definitions:this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(t,n,o),null!=this.materialShaderChunks.Fragment_Custom_Albedo&&""!==this.materialShaderChunks.Fragment_Custom_Albedo?this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,e,t,n,o,i)+this.materialShaderChunks.Fragment_Custom_Albedo:this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,e,t,n,o,i)},c.prototype.formatTerrainVertexDefintions=function(){return"\r\n#define TERRAIN_VERTEX_DEFINITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\n\r\n"},c.prototype.formatTerrainVertexMainEnd=function(){return"\r\n#define TERRAIN_VERTEX_MAIN_END\r\n\r\n#ifdef UV1\r\nvSplatmapUV = uv;\r\n#endif\r\n\r\n"},c.prototype.formatTerrainFragmentDefintions=function(e,t,n){return"\r\n#define TERRAIN_FRAGMENT_DEFNITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\nuniform sampler2D "+e+";\r\nuniform sampler2D "+t+";\r\nuniform sampler2D "+n+";\r\n\r\nfloat calculateMipmapLevel(const in vec2 uvs, const in vec2 size)\r\n{\r\n    vec2 dx = dFdx(uvs * size.x);\r\n    vec2 dy = dFdy(uvs * size.y);\r\n    float d = max(dot(dx, dx), dot(dy, dy));\r\n    return 0.4 * log2(d);\r\n}\r\n\r\nvec4 sampleTextureAtlas2D(const in sampler2D atlas, const in float gamma, const in vec2 tile, const in vec4 rect, in vec2 uvs, in float lod)\r\n{\r\n    if (lod < 0.0) lod = clamp(calculateMipmapLevel(uvs, vec2(tile.x, tile.x)), 0.0, tile.y);   // Tile Info (tile.xy)\r\n    float size = pow(2.0, tile.y - lod);                                                        // Tile Bits (tile.y)\r\n    float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n    float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n    uvs = fract(uvs);                                                                           // Perfrom Tiling (fract)\r\n    uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n    uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    vec4 color = texture2DLodEXT(atlas, uvs, lod);\r\n    if (gamma != 1.0) {\r\n        color.r = pow(color.r, gamma);\r\n        color.g = pow(color.g, gamma);\r\n        color.b = pow(color.b, gamma);\r\n    }\r\n    return color;\r\n}\r\n\r\nvec4 sampleSplatmapAtlas2D(const in sampler2D atlas, const in vec2 tile, const in vec4 rect, in vec2 uvs)\r\n{\r\n    float size = pow(2.0, tile.y);                                                              // Tile Bits (tile.y)\r\n\t   float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n\t   float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n\t   uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n\t   uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    return texture2D(atlas, uvs);\r\n}\r\n\r\nvec3 blendSplatmapAtlasColors(const in vec4 splatmap, in vec4 color1, in vec4 color2, in vec4 color3, in vec4 color4, in vec3 mixbuffer)\r\n{\r\n    vec3 buffer1 = mix(mixbuffer, color1.rgb, splatmap.r);\r\n    vec3 buffer2 = mix(buffer1, color2.rgb, splatmap.g);\r\n    vec3 buffer3 = mix(buffer2, color3.rgb, splatmap.b);\r\n    return mix(buffer3, color4.rgb, splatmap.a);\r\n}\r\n\r\nvec3 perturbNormalSamplerColor(mat3 cotangentFrame, vec3 samplerColor, float scale)\r\n{\r\n    vec3 map = samplerColor.xyz;\r\n    map = map * 2.00787402 - 1.00787402;\r\n    #ifdef NORMALXYSCALE\r\n        map = normalize(map * vec3(scale, scale, 1.0));\r\n    #endif\r\n    return normalize(cotangentFrame * map);\r\n}\r\n\r\n\r\n"},c.prototype.formatTerrainFragmentUpdateColor=function(e,t,n,o,i,r){void 0===r&&(r=1);var a="";if(null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&0<e.splatmapCount){a="\r\n#define TERRAIN_FRAGMENT_UPDATE_COLOR\r\n\r\nvec3 normalsColor = vec3(0.5, 0.5, 1.0);\r\nvec3 normalsBuffer = normalW.rgb;\r\nvec3 splatmapBuffer = "+t+".rgb;\r\nfloat autoMipMapLevel = -1.0;\r\nfloat normalCorrection = 1.0;\r\nfloat detailCorrection = "+r.toFixed(4)+";\r\n\r\n#if defined(ALBEDO) && defined("+n.toUpperCase()+") && defined("+o.toUpperCase()+")\r\n\r\n// Reset Normal Values\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    uvOffset = vec2(0.0, 0.0);\r\n    #ifdef NORMAL\r\n        normalW = normalize(vNormalW);\r\n    #else\r\n        normalW = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n    #endif\r\n    #ifdef CLEARCOAT\r\n        clearCoatNormalW = normalW;\r\n    #endif\r\n    #if defined(BUMP) || defined(PARALLAX)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV);\r\n        #endif\r\n    #elif defined(ANISOTROPIC)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV, vec2(1.0, 1.0));\r\n        #endif\r\n    #endif\r\n    #ifdef PARALLAX\r\n        invTBN = transposeMat3(TBN);\r\n    #endif\r\n    normalW = perturbNormalSamplerColor(TBN, normalsColor, 1.0);\r\n#endif\r\n\r\n// Global Atlas Values\r\nfloat splatTileSize = "+e.splatmapAtlas[2].toFixed(4)+";\r\nfloat splatTileBits = "+e.splatmapAtlas[3].toFixed(4)+";\r\nfloat detailTileSize = "+e.textureAtlas[2].toFixed(4)+";\r\nfloat detailTileBits = "+e.textureAtlas[3].toFixed(4)+";\r\n\r\n// Sample splatmap textures\r\n";for(var l=0;l<e.splatmapCount;l++){var s,u,c=4*l,d=e["splatmapRect"+l];a=(a=(a=a+("vec4 splatmapRect"+l+" = vec4("+d[0].toFixed(4)+", "+d[1].toFixed(4)+", "+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n")+("vec4 splatmapAlbedo"+l+" = sampleSplatmapAtlas2D("+n+", vec2(splatTileSize, splatTileBits), splatmapRect"+l+", (vSplatmapUV + uvOffset));\r\n"))+("vec4 textureAlbedo"+(0+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n")+("vec4 textureAlbedo"+(1+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n"))+("vec4 textureAlbedo"+(2+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n")+("vec4 textureAlbedo"+(3+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n"),e["textureRect"+(0+c)]&&(s=e["textureRect"+(0+c)],u=e["textureInfo"+(0+c)],a=(a=(a=(a+="vec4 textureRect"+(0+c)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n")+"vec2 textureScale"+(0+c)+" = vec2("+u[0].toFixed(4)+", "+u[1].toFixed(4)+");\r\n")+"vec2 textureOffset"+(0+c)+" = vec2("+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n")+"vec2 textureTileUV"+(0+c)+" = ((vSplatmapUV + textureOffset"+(0+c)+") * textureScale"+(0+c)+");\r\ntextureAlbedo"+(0+c)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(0+c)+", textureTileUV"+(0+c)+", autoMipMapLevel);\r\n"),e["textureRect"+(1+c)]&&(s=e["textureRect"+(1+c)],u=e["textureInfo"+(1+c)],a=(a=(a=(a+="vec4 textureRect"+(1+c)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n")+"vec2 textureScale"+(1+c)+" = vec2("+u[0].toFixed(4)+", "+u[1].toFixed(4)+");\r\n")+"vec2 textureOffset"+(1+c)+" = vec2("+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n")+"vec2 textureTileUV"+(1+c)+" = ((vSplatmapUV + textureOffset"+(1+c)+") * textureScale"+(1+c)+");\r\ntextureAlbedo"+(1+c)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(1+c)+", textureTileUV"+(1+c)+", autoMipMapLevel);\r\n"),e["textureRect"+(2+c)]&&(s=e["textureRect"+(2+c)],u=e["textureInfo"+(2+c)],a=(a=(a=(a+="vec4 textureRect"+(2+c)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n")+"vec2 textureScale"+(2+c)+" = vec2("+u[0].toFixed(4)+", "+u[1].toFixed(4)+");\r\n")+"vec2 textureOffset"+(2+c)+" = vec2("+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n")+"vec2 textureTileUV"+(2+c)+" = ((vSplatmapUV + textureOffset"+(2+c)+") * textureScale"+(2+c)+");\r\ntextureAlbedo"+(2+c)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(2+c)+", textureTileUV"+(2+c)+", autoMipMapLevel);\r\n"),e["textureRect"+(3+c)]&&(s=e["textureRect"+(3+c)],u=e["textureInfo"+(3+c)],a=(a=(a=(a+="vec4 textureRect"+(3+c)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n")+"vec2 textureScale"+(3+c)+" = vec2("+u[0].toFixed(4)+", "+u[1].toFixed(4)+");\r\n")+"vec2 textureOffset"+(3+c)+" = vec2("+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n")+"vec2 textureTileUV"+(3+c)+" = ((vSplatmapUV + textureOffset"+(3+c)+") * textureScale"+(3+c)+");\r\ntextureAlbedo"+(3+c)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(3+c)+", textureTileUV"+(3+c)+", autoMipMapLevel);\r\n"),a=(a=(a=(a=a+("splatmapBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+l+", textureAlbedo"+(0+c)+", textureAlbedo"+(1+c)+", textureAlbedo"+(2+c)+", textureAlbedo"+(3+c)+", splatmapBuffer);\r\n")+"#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n")+("    #if defined("+i.toUpperCase()+")\r\n"))+("        vec4 normalColor"+(0+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n")+("        vec4 normalColor"+(1+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n"))+("        vec4 normalColor"+(2+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n")+("        vec4 normalColor"+(3+c)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n"),e["textureRect"+(0+c)]&&(a=(a+="        float normalScale"+(0+c)+" = "+e["normalsScale"+(0+c)].toFixed(4)+";\r\n")+"        normalColor"+(0+c)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(0+c)+", textureTileUV"+(0+c)+", autoMipMapLevel);\r\n        normalColor"+(0+c)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(0+c)+".rgb, normalScale"+(0+c)+");\r\n"),e["textureRect"+(1+c)]&&(a=(a+="        float normalScale"+(1+c)+" = "+e["normalsScale"+(1+c)].toFixed(4)+";\r\n")+"        normalColor"+(1+c)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(1+c)+", textureTileUV"+(1+c)+", autoMipMapLevel);\r\n        normalColor"+(1+c)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(1+c)+".rgb, normalScale"+(1+c)+");\r\n"),e["textureRect"+(2+c)]&&(a=(a+="        float normalScale"+(2+c)+" = "+e["normalsScale"+(2+c)].toFixed(4)+";\r\n")+"        normalColor"+(2+c)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(2+c)+", textureTileUV"+(2+c)+", autoMipMapLevel);\r\n        normalColor"+(2+c)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(2+c)+".rgb, normalScale"+(2+c)+");\r\n"),a=(a=(a=e["textureRect"+(3+c)]?(a+="        float normalScale"+(3+c)+" = "+e["normalsScale"+(3+c)].toFixed(4)+";\r\n")+"        normalColor"+(3+c)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(3+c)+", textureTileUV"+(3+c)+", autoMipMapLevel);\r\n        normalColor"+(3+c)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(3+c)+".rgb, normalScale"+(3+c)+");\r\n":a)+("        normalsBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+l+", normalColor"+(0+c)+", normalColor"+(1+c)+", normalColor"+(2+c)+", normalColor"+(3+c)+", normalsBuffer);\r\n")+"    #endif\r\n")+"#endif\r\n"+"\r\n"}a+="// Update Color Values\r\n"+t+".rgb = splatmapBuffer.rgb;\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    #if defined("+i.toUpperCase()+")\r\n        normalW.rgb = normalsBuffer.rgb;\r\n    #endif\r\n    #if defined(FORCENORMALFORWARD) && defined(NORMAL)\r\n        vec3 faceNormal = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n        #if defined(TWOSIDEDLIGHTING)\r\n            faceNormal = gl_FrontFacing ? faceNormal : -faceNormal;\r\n        #endif\r\n        normalW *= sign(dot(normalW, faceNormal));\r\n    #endif\r\n    #if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\r\n        normalW = gl_FrontFacing ? normalW : -normalW;\r\n    #endif\r\n#endif\r\n\r\n#endif\r\n\r\n"}return a};var u,t=c;function c(e,t){var e=u.call(this,e,t)||this,n=(e.enableShaderChunks=!0,e);return n.awake&&n.awake(),e.onBindObservable.add(function(){n.after&&n.after()}),e}a.UniversalTerrainMaterial=t,BABYLON.RegisterClass("UNITY.UniversalTerrainMaterial",t)}(UNITY=UNITY||{}),!function(l){function e(e,t,n){if(void 0===n&&(n={}),this._update=null,this._late=null,this._step=null,this._fixed=null,this._after=null,this._ready=null,this._lateUpdate=!1,this._properties=null,this._awoken=!1,this._started=!1,this._scene=null,this._delyed=!1,this._transform=null,this._scriptReady=!1,this._registeredClassname=null,this._lateUpdateObserver=null,this.resetScriptComponent=null,this._worldCollisionObserver=null,this._worldCollisionEndedObserver=null,this._worldTriggerEventObserver=null,this.onCollisionEnterObservable=new BABYLON.Observable,this.onCollisionStayObservable=new BABYLON.Observable,this.onCollisionExitObservable=new BABYLON.Observable,this.onTriggerEnterObservable=new BABYLON.Observable,this.onTriggerExitObservable=new BABYLON.Observable,null==e)throw new Error("Null transform object specified.");if(null==t)throw new Error("Null host scene object specified.");this._scene=t,this._transform=e,this._properties=n||{},this._registeredClassname=null;var o=this;o._update=function(){l.ScriptComponent.UpdateInstance(o)},o._late=function(){l.ScriptComponent.LateInstance(o)},o._step=function(){l.ScriptComponent.StepInstance(o)},o._fixed=function(){l.ScriptComponent.FixedInstance(o)},o._after=function(){l.ScriptComponent.AfterInstance(o)},o._ready=function(){l.ScriptComponent.ReadyInstance(o)},o.resetScriptComponent=function(){l.ScriptComponent.ResetInstance(o)},o.registerComponentInstance&&o.destroyComponentInstance||BABYLON.Tools.Warn("Invalid component registration handlers for: "+this._transform.name)}e.prototype.isReady=function(){return this._scriptReady},Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return this._registeredClassname},e.prototype.setProperty=function(e,t){null==this._properties&&(this._properties={}),this._properties[e]=t},e.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=(n=null==(n=null!=this._properties&&null==(n=this._properties[e])?this._properties["auto__"+e]:n)?t:n)?n:null},e.prototype.getTime=function(){return l.SceneManager.GetTime()},e.prototype.getTimeMs=function(){return l.SceneManager.GetTimeMs()},e.prototype.getGameTime=function(){return l.SceneManager.GetGameTime()},e.prototype.getGameTimeMs=function(){return l.SceneManager.GetGameTimeMs()},e.prototype.getDeltaSeconds=function(){return l.SceneManager.GetDeltaSeconds(this.scene)},e.prototype.getDeltaMilliseconds=function(){return l.SceneManager.GetDeltaMilliseconds(this.scene)},e.prototype.getAnimationRatio=function(){return l.SceneManager.GetAnimationRatio(this.scene)},e.prototype.hasSkinnedMesh=function(){return null!=this.getSkinnedMesh()},e.prototype.getSkinnedMesh=function(){return l.SceneManager.GetSkinnedMesh(this.transform)},e.prototype.getTransformMesh=function(){return this._transform instanceof BABYLON.Mesh?this._transform:null},e.prototype.getAbstractMesh=function(){return this._transform instanceof BABYLON.AbstractMesh?this._transform:null},e.prototype.getInstancedMesh=function(){return this._transform instanceof BABYLON.InstancedMesh?this._transform:null},e.prototype.getPrimitiveMeshes=function(){return l.SceneManager.GetPrimitiveMeshes(this.transform)},e.prototype.getMetadata=function(){return l.SceneManager.FindSceneMetadata(this._transform)},e.prototype.getComponent=function(e,t){e=l.SceneManager.FindScriptComponent(this._transform,e,t=void 0===t?!1:t);return null!=e?e:null},e.prototype.getComponents=function(e,t){e=l.SceneManager.FindAllScriptComponents(this._transform,e,t=void 0===t?!1:t);return null!=e?e:null},e.prototype.getLightRig=function(){return l.SceneManager.FindSceneLightRig(this._transform)},e.prototype.getCameraRig=function(){return l.SceneManager.FindSceneCameraRig(this._transform)},e.prototype.getTransformTag=function(){return l.SceneManager.GetTransformTag(this.transform)},e.prototype.hasTransformTags=function(e){return l.SceneManager.HasTransformTags(this._transform,e)},e.prototype.getChildNode=function(e,t,n,o){return void 0===t&&(t=l.SearchType.ExactMatch),l.SceneManager.FindChildTransformNode(this._transform,e,t,n=void 0===n?!0:n,o=void 0===o?null:o)},e.prototype.getChildWithTags=function(e,t,n){return l.SceneManager.FindChildTransformWithTags(this._transform,e,t=void 0===t?!0:t,n=void 0===n?null:n)},e.prototype.getChildrenWithTags=function(e,t,n){return l.SceneManager.FindAllChildTransformsWithTags(this._transform,e,t=void 0===t?!0:t,n=void 0===n?null:n)},e.prototype.getChildWithScript=function(e,t,n){return l.SceneManager.FindChildTransformWithScript(this._transform,e,t=void 0===t?!0:t,n=void 0===n?null:n)},e.prototype.getChildrenWithScript=function(e,t,n){return l.SceneManager.FindAllChildTransformsWithScript(this._transform,e,t=void 0===t?!0:t,n=void 0===n?null:n)},e.prototype.enableCollisionEvents=function(){var n=this,e=l.RigidbodyPhysics.GetHavokPlugin();null!=e&&null!=this.transform.physicsBody&&(this.transform.physicsBody.setCollisionCallbackEnabled(!0),this.transform.physicsBody.setCollisionEndedCallbackEnabled(!0),null==this._worldCollisionObserver&&(this._worldCollisionObserver=e.onCollisionObservable.add(function(e){var t;e.collider!==n.transform.physicsBody&&e.collidedAgainst!==n.transform.physicsBody||(t=e.collider===n.transform.physicsBody?e.collidedAgainst:e.collider,"COLLISION_STARTED"===e.type?n.onCollisionEnterObservable.notifyObservers(t.transformNode):"COLLISION_CONTINUED"===e.type&&n.onCollisionStayObservable.notifyObservers(t.transformNode))})),null==this._worldCollisionEndedObserver&&(this._worldCollisionEndedObserver=e.onCollisionEndedObservable.add(function(e){var t;e.collider!==n.transform.physicsBody&&e.collidedAgainst!==n.transform.physicsBody||(t=e.collider===n.transform.physicsBody?e.collidedAgainst:e.collider,"COLLISION_FINISHED"===e.type&&n.onCollisionExitObservable.notifyObservers(t.transformNode))})),null==this._worldTriggerEventObserver)&&(this._worldTriggerEventObserver=e.onTriggerCollisionObservable.add(function(e){var t;e.collider!==n.transform.physicsBody&&e.collidedAgainst!==n.transform.physicsBody||(t=e.collider===n.transform.physicsBody?e.collidedAgainst:e.collider,"TRIGGER_ENTERED"===e.type?n.onTriggerEnterObservable.notifyObservers(t.transformNode):"TRIGGER_EXITED"===e.type&&n.onTriggerExitObservable.notifyObservers(t.transformNode))}))},e.prototype.disableCollisionEvents=function(){null!=l.RigidbodyPhysics.GetHavokPlugin()&&null!=this.transform.physicsBody&&(this.transform.physicsBody.setCollisionCallbackEnabled(!1),this.transform.physicsBody.setCollisionEndedCallbackEnabled(!1))},e.prototype.setTransformPosition=function(e){this.transform.physicsBody&&(this.transform.physicsBody.disablePreStep=!1),null!=this.transform.position&&this.transform.position.copyFrom(e)},e.prototype.setTransformRotation=function(e){this.transform.physicsBody&&(this.transform.physicsBody.disablePreStep=!1),null!=this.transform.rotationQuaternion&&this.transform.rotationQuaternion.copyFrom(e)},e.prototype.registerOnClickAction=function(e){var t=null;return t=this.transform instanceof BABYLON.AbstractMesh?l.SceneManager.RegisterClickAction(this.scene,this.transform,e):t},e.prototype.unregisterOnClickAction=function(e){var t=!1;return t=this.transform instanceof BABYLON.AbstractMesh?l.SceneManager.UnregisterClickAction(this.transform,e):t},e.prototype.registerComponentInstance=function(e,t,n){var o;!0===(n=void 0===n?!0:n)&&(l.Utilities.ValidateTransformMetadata(this._transform),o={alias:"script",order:0,klass:t,properties:null,instance:e},null==this._transform.metadata.unity.components&&(this._transform.metadata.unity.components=[]),this._transform.metadata.unity.components.push(o)),e._registeredClassname=t,l.ScriptComponent.RegisterInstance(e),!0===n&&e.scene.onAfterRenderObservable.addOnce(function(){e.delayComponentInstance(e)})},e.prototype.delayComponentInstance=function(e){l.WindowManager.SetTimeout(100,function(){e._delyed=!0})},e.prototype.destroyComponentInstance=function(e){l.ScriptComponent.DestroyInstance(e)},e.prototype.setupStepComponentInstance=function(e){e.scene.onBeforePhysicsObservable.add(e._step)},e.prototype.removeStepComponentInstance=function(e){e.scene.onBeforePhysicsObservable.removeCallback(e._step)},e.prototype.setupFixedComponentInstance=function(e){e.scene.onAfterPhysicsObservable.add(e._fixed)},e.prototype.removeFixedComponentInstance=function(e){e.scene.onAfterPhysicsObservable.removeCallback(e._fixed)},e.RegisterInstance=function(e){null!=e&&(null!=e._update&&e.scene.registerBeforeRender(e._update),e.late&&null!=e._late&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&(e._lateUpdateObserver=e.scene.onBeforeRenderTargetsRenderObservable.add(e._late)),e.after&&null!=e._after&&e.scene.registerAfterRender(e._after),e.step&&null!=e._step&&e.setupStepComponentInstance(e),e.fixed)&&null!=e._fixed&&e.setupFixedComponentInstance(e)},e.UpdateInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&(!1===e._awoken?(e._awoken=!0,l.ScriptComponent.ParseAutoProperties(e),e.awake&&e.awake()):!1===e._started?(e._started=!0,e.start&&e.start()):!0===e._awoken&&!0===e._started&&(!0===e._delyed&&(e._delyed=!1,l.ScriptComponent.ReadyInstance(e)),e.update&&e.update(),e._lateUpdate=!0))},e.LateInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&!0===e._lateUpdate&&!(e._lateUpdate=!1)===e._started&&e.late&&e.late()},e.AfterInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&!0===e._started&&e.after&&e.after()},e.StepInstance=function(e){null!=e&&null!=e.transform&&!0===e._started&&e.step&&e.step()},e.FixedInstance=function(e){null!=e&&null!=e.transform&&!0===e._started&&e.fixed&&e.fixed()},e.ReadyInstance=function(e){null!=e&&null!=e.transform&&!1===e._scriptReady&&(e._scriptReady=!0,e.ready)&&e.ready()},e.ResetInstance=function(e){null!=e&&null!=e.transform&&!0===e._started&&e.reset&&e.reset()},e.DestroyInstance=function(e){if(null!=e){e.scene.unregisterBeforeRender(e._update),null!=e._lateUpdateObserver&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&e.scene.onBeforeRenderTargetsRenderObservable.remove(e._lateUpdateObserver),e.after&&null!=e._after&&e.scene.unregisterAfterRender(e._after),e.step&&null!=e._step&&e.removeStepComponentInstance(e),e.fixed&&null!=e._fixed&&e.removeFixedComponentInstance(e);var t=l.RigidbodyPhysics.GetHavokPlugin();if(null!=t){if(null!=e._worldCollisionObserver)try{t.onCollisionObservable.remove(e._worldCollisionObserver)}catch(e){}if(null!=e._worldCollisionEndedObserver)try{t.onCollisionEndedObservable.remove(e._worldCollisionEndedObserver)}catch(e){}if(null!=e._worldTriggerEventObserver)try{t.onTriggerCollisionObservable.remove(e._worldTriggerEventObserver)}catch(e){}}try{e.onCollisionEnterObservable.clear()}catch(e){}try{e.onCollisionStayObservable.clear()}catch(e){}try{e.onCollisionExitObservable.clear()}catch(e){}try{e.onTriggerEnterObservable.clear()}catch(e){}try{e.onTriggerExitObservable.clear()}catch(e){}try{e.destroy&&e.destroy()}catch(e){}e._scriptReady=!1,e._transform=null,e._properties=null,e._started=!1,e._delyed=!1,e._update=null,e._late=null,e._step=null,e._fixed=null,e._after=null,e._ready=null,e._scene=null}},e.ParseAutoProperties=function(r){var a=Object.keys(r._properties);if(null!=a&&0<a.length)for(var e=0;e<a.length;e++)!function(e){var t,n,o,i,e=a[e];l.Utilities.StartsWith(e,"auto__")&&(t=e.replace("auto__",""),l.Utilities.HasOwnProperty(r,t)?null!=(e=r.getProperty(e))&&null!=(o=typeof e)&&o&&"object"==o?Array.isArray(e)?(n=[],e.forEach(function(e){null!=e&&n.push("object"==typeof e?l.ScriptComponent.UnpackObjectProperty(e,r.scene):e)}),r[t]=n):(o=r[t],i=l.ScriptComponent.UnpackObjectProperty(e,r.scene),o instanceof BABYLON.Color3&&i instanceof BABYLON.Color4?r[t]=new BABYLON.Color3(i.r,i.g,i.b):r[t]=i):r[t]=e:BABYLON.Tools.Warn(r.getClassName()||"Unregistered Class: Auto property '"+t+"' not found for transform '"+r.transform.name+"'"))}(e)},e.UnpackObjectProperty=function(e,t){var n=null;if(null!=e)if(void 0!==e.x&&void 0!==e.y)n=void 0!==e.z?void 0!==e.w?new BABYLON.Vector4(e.x,e.y,e.z,e.w):new BABYLON.Vector3(e.x,e.y,e.z):new BABYLON.Vector2(e.x,e.y);else if(void 0!==e.r&&void 0!==e.g&&void 0!==e.b){var o=1;void 0!==e.a&&(o=e.a),n=new BABYLON.Color4(e.r,e.g,e.b,o)}else if(void 0!==e.type)switch(e.type){case"UnityEngine.AnimationCurve":n=BABYLON.Animation.Parse(e.animation);break;case"UnityEngine.Transform":n=l.Utilities.ParseTransformByID(e,t);break;case"UnityEngine.Material":n=t.getMaterialByName(e.name);break;case"UnityEngine.Texture2D":n=l.Utilities.ParseTexture(e,t);break;case"UnityEngine.Cubemap":n=l.Utilities.ParseCubemap(e,t);break;case"UnityEngine.AudioClip":n=e;break;case"UnityEngine.Video.VideoClip":n=e;break;case"UnityEngine.Font":n=e;break;case"UnityEngine.TextAsset":var i=e;n=null!=i.base64?!0===i.json?JSON.parse(l.WindowManager.Atob(i.base64)):l.WindowManager.Atob(i.base64):i;break;case"UnityEditor.DefaultAsset":i=e;n=null!=i.base64?!0===i.json?JSON.parse(l.WindowManager.Atob(i.base64)):l.WindowManager.Atob(i.base64):i;break;default:n=e}else n=e;return n},l.ScriptComponent=e}(UNITY=UNITY||{}),!function(re){function e(e){this._babylonScene=e,this._physicList=[],this._shadowList=[],this._scriptList=[],this._freezeList=[]}e.prototype.parseSceneComponents=function(e){re.MetadataParser.DoParseSceneComponents(this._babylonScene,e,this._physicList,this._shadowList,this._scriptList,this._freezeList)},e.prototype.postProcessSceneComponents=function(e,t){re.MetadataParser.DoProcessPendingPhysics(this._babylonScene,this._physicList),re.MetadataParser.DoProcessPendingShadows(this._babylonScene,this._shadowList),re.MetadataParser.DoProcessPendingScripts(this._babylonScene,this._scriptList,e,t),re.MetadataParser.DoProcessPendingFreezes(this._freezeList),this._babylonScene=null,this._physicList=null,this._shadowList=null,this._scriptList=null,this._freezeList=null},e.DoParseSceneComponents=function(t,n,e,o,i,r){var a,l,s,u,c,d;null!=n&&null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.parsed&&!1===n.metadata.unity.parsed&&(n.onDisposeObservable.addOnce(function(){re.Utilities.DisposeEntity(n)}),n.metadata.unity.parsed=!0,n.metadata.unity.prefab=!1,a=n.metadata.unity,l=null==n.metadata.unity.visible||n.metadata.unity.visible,s=null!=n.metadata.unity.visibility?n.metadata.unity.visibility:1,u=null!=n.metadata.unity.billboard?n.metadata.unity.billboard:0,d=n instanceof BABYLON.AbstractMesh,null!=n.metadata.unity.lightmapped&&n.metadata.unity.lightmapped,null!=(c=a.tags)&&""!==c&&(BABYLON.Tags.AddTagsTo(n,c),0<=c.indexOf("NavigationMesh"))&&(n.isVisible=!1,n.isPickable=!1,n.useVertexColors=!1),null!=a.physics&&null!=e&&e.push(n),n.renderingGroupId,null!=a.renderer&&(!0==d?(n.isPickable=!0,n.useVertexColors=!1,n.isVisible=l,n.visibility=s,n.billboardMode=u,n.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=a.renderer.cullingstrategy&&a.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(n.cullingStrategy=a.renderer.cullingstrategy),null!=a.renderer.castshadows&&!0===a.renderer.castshadows&&null!=o&&o.push(n),null!=a.renderer.receiveshadows&&!0===a.renderer.receiveshadows&&(n.receiveShadows=!0),null!=a.renderer.checkcollisions&&!0===a.renderer.checkcollisions&&(n.checkCollisions=!0),null!=a.renderer.istriggervolume&&!0===a.renderer.istriggervolume&&(n.collisionResponse=!1),null!=a.renderer.usevertexcolors&&(n.useVertexColors=a.renderer.usevertexcolors),null!=a.renderer.setmeshpickable&&(n.isPickable=a.renderer.setmeshpickable),null!=a.renderer.showboundingbox&&(n.showBoundingBox=a.renderer.showboundingbox),null!=a.renderer.defaultellipsoid&&(n.ellipsoid=re.Utilities.ParseVector3(a.renderer.defaultellipsoid)),null!=a.renderer.ellipsoidoffset&&(n.ellipsoidOffset=re.Utilities.ParseVector3(a.renderer.ellipsoidoffset)),null!=a.renderer.rendergroupid&&(n.renderingGroupId=a.renderer.rendergroupid),null!=a.renderer.freezeworldmatrix&&!0===a.renderer.freezeworldmatrix&&null!=r&&r.push(n)):null!=(c=re.SceneManager.GetSkinnedMesh(n))?(c.isPickable=!0,c.useVertexColors=!1,c.isVisible=l,c.visibility=s,c.billboardMode=u,c.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,c.alwaysSelectAsActiveMesh=!0,null!=a.renderer.cullingstrategy&&a.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(c.cullingStrategy=a.renderer.cullingstrategy),null!=a.renderer.castshadows&&!0===a.renderer.castshadows&&null!=o&&o.push(c),null!=a.renderer.receiveshadows&&!0===a.renderer.receiveshadows&&(c.receiveShadows=!0),null!=a.renderer.checkcollisions&&!0===a.renderer.checkcollisions&&(c.checkCollisions=!0),null!=a.renderer.istriggervolume&&!0===a.renderer.istriggervolume&&(c.collisionResponse=!1),null!=a.renderer.usevertexcolors&&(c.useVertexColors=a.renderer.usevertexcolors),null!=a.renderer.setmeshpickable&&(c.isPickable=a.renderer.setmeshpickable),null!=a.renderer.showboundingbox&&(c.showBoundingBox=a.renderer.showboundingbox),null!=a.renderer.defaultellipsoid&&(c.ellipsoid=re.Utilities.ParseVector3(a.renderer.defaultellipsoid)),null!=a.renderer.ellipsoidoffset&&(c.ellipsoidOffset=re.Utilities.ParseVector3(a.renderer.ellipsoidoffset)),null!=a.renderer.rendergroupid&&(c.renderingGroupId=a.renderer.rendergroupid),null!=a.renderer.freezeworldmatrix&&!0===a.renderer.freezeworldmatrix&&null!=r&&r.push(c)):null!=(e=re.SceneManager.GetPrimitiveMeshes(n))&&0<e.length&&e.forEach(function(e){var t=re.SceneManager.GetSkinnedMesh(e);null!=t?(t.isPickable=!0,t.useVertexColors=!1,t.isVisible=l,t.visibility=s,t.billboardMode=u,t.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,t.alwaysSelectAsActiveMesh=!0,null!=a.renderer.cullingstrategy&&a.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(t.cullingStrategy=a.renderer.cullingstrategy),null!=a.renderer.castshadows&&!0===a.renderer.castshadows&&null!=o&&o.push(t),null!=a.renderer.receiveshadows&&!0===a.renderer.receiveshadows&&(t.receiveShadows=!0),null!=a.renderer.checkcollisions&&!0===a.renderer.checkcollisions&&(t.checkCollisions=!0),null!=a.renderer.istriggervolume&&!0===a.renderer.istriggervolume&&(t.collisionResponse=!1),null!=a.renderer.usevertexcolors&&(t.useVertexColors=a.renderer.usevertexcolors),null!=a.renderer.setmeshpickable&&(t.isPickable=a.renderer.setmeshpickable),null!=a.renderer.showboundingbox&&(t.showBoundingBox=a.renderer.showboundingbox),null!=a.renderer.defaultellipsoid&&(t.ellipsoid=re.Utilities.ParseVector3(a.renderer.defaultellipsoid)),null!=a.renderer.ellipsoidoffset&&(t.ellipsoidOffset=re.Utilities.ParseVector3(a.renderer.ellipsoidoffset)),null!=a.renderer.rendergroupid&&(t.renderingGroupId=a.renderer.rendergroupid),null!=a.renderer.freezeworldmatrix&&!0===a.renderer.freezeworldmatrix&&null!=r&&r.push(t)):(e.isPickable=!0,e.useVertexColors=!1,e.isVisible=l,e.visibility=s,e.billboardMode=u,e.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=a.renderer.cullingstrategy&&a.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(e.cullingStrategy=a.renderer.cullingstrategy),null!=a.renderer.castshadows&&!0===a.renderer.castshadows&&null!=o&&o.push(e),null!=a.renderer.receiveshadows&&!0===a.renderer.receiveshadows&&(e.receiveShadows=!0),null!=a.renderer.checkcollisions&&!0===a.renderer.checkcollisions&&(e.checkCollisions=!0),null!=a.renderer.istriggervolume&&!0===a.renderer.istriggervolume&&(e.collisionResponse=!1),null!=a.renderer.usevertexcolors&&(e.useVertexColors=a.renderer.usevertexcolors),null!=a.renderer.setmeshpickable&&(e.isPickable=a.renderer.setmeshpickable),null!=a.renderer.showboundingbox&&(e.showBoundingBox=a.renderer.showboundingbox),null!=a.renderer.defaultellipsoid&&(e.ellipsoid=re.Utilities.ParseVector3(a.renderer.defaultellipsoid)),null!=a.renderer.ellipsoidoffset&&(e.ellipsoidOffset=re.Utilities.ParseVector3(a.renderer.ellipsoidoffset)),null!=a.renderer.rendergroupid&&(e.renderingGroupId=a.renderer.rendergroupid),null!=a.renderer.freezeworldmatrix&&!0===a.renderer.freezeworldmatrix&&null!=r&&r.push(e))})),null!=a.components)&&null!=(d=a.components)&&0<d.length&&d.forEach(function(e){if(null!=e)switch(e.alias){case"camera":re.MetadataParser.SetupCameraComponent(t,n,e);break;case"light":re.MetadataParser.SetupLightComponent(t,n,e);break;case"script":null!=i&&i.push({mesh:n,comp:e})}})},e.DoProcessPendingScripts=function(n,e,o,i){null!=e&&0<e.length&&(e.sort(function(e,t){return e.comp.order<t.comp.order?-1:e.comp.order>t.comp.order?1:0}),e.forEach(function(e){var t;null!=e.comp.klass&&""!==e.comp.klass&&"UNITY.ScriptComponent"!==e.comp.klass&&(null!=(t=re.Utilities.InstantiateClass(e.comp.klass))?null!=(t=new t(e.mesh,n,e.comp.properties))?!0==t instanceof re.ScriptComponent?(e.comp.instance=t,null!=i&&i.push(e.comp.instance),e.comp.instance.addPreloaderTasks&&null!=o&&o.push(e.comp.instance),re.SceneManager.AttachScriptComponent(e.comp.instance,e.comp.klass,!1)):BABYLON.Tools.Warn("Non script component instantiated class: "+e.comp.klass):BABYLON.Tools.Warn("Failed to instantiate script class: "+e.comp.klass):BABYLON.Tools.Warn("Failed to locate script class: "+e.comp.klass))}))},e.DoProcessPendingShadows=function(e,o){null!=o&&0<o.length&&null!=e.lights&&0<e.lights.length&&e.lights.forEach(function(t){var n,e=t.getShadowGenerator();null!=e&&null!=t.metadata&&null!=t.metadata.unity&&!0===t.metadata.unity.autorender&&null!=(n=e.getShadowMap())&&o.forEach(function(e){!0===(!(null!=t.includedOnlyMeshes&&0<t.includedOnlyMeshes.length)||0<=t.includedOnlyMeshes.indexOf(e))&&(null==n.renderList&&(n.renderList=[]),n.renderList.indexOf(e)<0)&&n.renderList.push(e)})})},e.DoProcessPendingPhysics=function(t,e){var n,o;null!=e&&0<e.length&&(o=!0===(n=t.isPhysicsEnabled())?t.getPhysicsEngine():null,!0==(!0===n&&null!=o)?e.forEach(function(e){re.RigidbodyPhysics.SetupPhysicsComponent(t,e)}):BABYLON.Tools.Warn("Physics engine not loaded. Physics impostors will not be created."))},e.DoProcessPendingFreezes=function(e){null!=e&&0<e.length&&e.forEach(function(e){e.freezeWorldMatrix()})},e.SetupCameraComponent=function(n,e,t){e.checkCollisions=!1;var o=0,i=e.name+".Rig",r=null!=t.culling?t.culling:-1,a=null!=t.camerabase?t.camerabase:0,l=(null!=t.clearflags&&t.clearflags,null!=t.renderlist?t.renderlist:null),s=null!=t.maincamera&&t.maincamera,u=new(4===a?BABYLON.FreeCamera:BABYLON.UniversalCamera)(i,BABYLON.Vector3.Zero(),n);switch(u.checkCollisions=!1,u.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(0,0,0),u.parent=e,!0===s&&(n.activeCamera=u),null!=t.type?t.type:0){case 0:u.mode=BABYLON.Camera.PERSPECTIVE_CAMERA,null!=t.perspectiveyfov&&(u.fov=t.perspectiveyfov),null!=t.perspectiveznear&&(u.minZ=t.perspectiveznear),null!=t.perspectivezfar&&(u.maxZ=t.perspectivezfar);break;case 1:u.mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA,null!=t.orthoxmag&&(u.orthoLeft=-t.orthoxmag,u.orthoRight=t.orthoxmag),null!=t.orthoymag&&(u.orthoBottom=-t.orthoymag,u.orthoTop=t.orthoymag),null!=t.orthoznear&&(u.minZ=t.orthoznear),null!=t.orthozfar&&(u.maxZ=t.orthozfar)}if(-1!==r&&0!==r){var c=l;if(null!=c&&0<c.length)for(o=0;o<c.length;o++)!function(){var t,e=c[o],e=re.SceneManager.GetMeshByID(n,e);null!=e&&(t=e.name+".Detail",null!=(e=e.getChildren(function(e){return e.name===t},!0)))&&e.length}()}e.cameraRig=u},e.SetupLightComponent=function(o,e,t){e.checkCollisions=!1;var n=e.name+".Rig",i=0,r=1,a=null!=t.culling?t.culling:-1,l=(null!=t.clearflags&&t.clearflags,null!=t.renderlist?t.renderlist:null),s=null!=t.type?t.type:0,u=re.SceneManager.GetRenderQuality(),c=null!=t.exponentdecayspeed?t.exponentdecayspeed:1,d=!1;switch(s){case 0:var p=BABYLON.Vector3.Forward(),h=null!=t.orthoscale?t.orthoscale:.1,m=null!=t.ortholeft?t.ortholeft:Number.MAX_VALUE,g=null!=t.orthoright?t.orthoright:Number.MAX_VALUE,f=null!=t.orthotop?t.orthotop:Number.MAX_VALUE,y=null!=t.orthobottom?t.orthobottom:Number.MAX_VALUE,v=null!=t.calczbounds&&t.calczbounds,_=null!=t.updateextends&&t.updateextends,B=null!=t.shadowfrustumsize?t.shadowfrustumsize:0,b=new BABYLON.DirectionalLight(n,p,o);b.shadowFrustumSize=B,b.shadowOrthoScale=h,b.autoCalcShadowZBounds=v,b.autoUpdateExtends=_,b.orthoLeft=m,b.orthoRight=g,b.orthoTop=f,b.orthoBottom=y,(C=b).falloffType=BABYLON.Light.FALLOFF_STANDARD,d=u===re.RenderQuality.High||u===re.RenderQuality.Medium,r=re.SceneManager.DirectionalLightIntensity;break;case 1:var C;C=new BABYLON.PointLight(n,BABYLON.Vector3.Zero(),o);(C=C).falloffType=BABYLON.Light.FALLOFF_STANDARD,d=u===re.RenderQuality.High||u===re.RenderQuality.Medium,r=re.SceneManager.PointLightIntensity;break;case 2:p=BABYLON.Vector3.Forward(),B=null!=t.spotangle?t.spotangle:Math.PI/4,h=new BABYLON.SpotLight(n,BABYLON.Vector3.Zero(),p,0,c,o);h.angle=.966*BABYLON.Tools.ToRadians(B),h.innerAngle=.8*h.angle,(C=h).falloffType=BABYLON.Light.FALLOFF_GLTF,d=u===re.RenderQuality.High||u===re.RenderQuality.Medium,r=re.SceneManager.SpotLightIntensity}if(null!=C){var T=null!=t.range?t.range:Number.MAX_VALUE,I=null!=t.color?re.Utilities.ParseColor3(t.color,BABYLON.Color3.White()):BABYLON.Color3.White(),S=null!=t.specular?re.Utilities.ParseColor3(t.specular,BABYLON.Color3.White()):BABYLON.Color3.White(),T=(C.parent=e,C.range=T,C.diffuse=I,C.specular=S,C.intensity=(null!=t.intensity?t.intensity:1)*r,C.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT,C.intensityMode=BABYLON.Light.INTENSITYMODE_AUTOMATIC,C.shadowEnabled=!1,null==t.autorender||t.autorender),I=null!=t.softshadows&&t.softshadows,S=null!=t.numcascades?t.numcascades:0,A=null!=t.cascadelambda?t.cascadelambda:1,O=null!=t.setdepthclamp&&t.setdepthclamp,k=null!=t.blendpertecntage?t.blendpertecntage:1e-8,Y=null!=t.boundsrefreshrate?t.boundsrefreshrate:1,D=null!=t.lightcontactratio?t.lightcontactratio:.1,F=null!=t.stabilizecascades&&t.stabilizecascades,V=null!=t.penumbradarkness?t.penumbradarkness:1,E=null!=t.softshadowsfilter?t.softshadowsfilter:99,G=null!=t.freezeshadows&&t.freezeshadows,H=null!=t.calcdepths&&t.calcdepths,W=null!=t.depthscaling?t.depthscaling:50,z=null!=t.blurscaling?t.blurscaling:2,Q=null==t.kernelblur||t.kernelblur,X=null!=t.blurkernelsize?t.blurkernelsize:1,j=null!=t.blurboxoffset?t.blurboxoffset:1,M=null!=t.shadowmapsize?t.shadowmapsize:1024,x=null!=t.generateshadows&&t.generateshadows,K=null!=t.shadowbiasfactor?t.shadowbiasfactor:.001,q=null!=t.normalbiasfactor?t.normalbiasfactor:.1,Z=null!=t.shadowmapbias?t.shadowmapbias:.05,J=null!=t.normalmapbias?t.normalmapbias:.4,N=null!=t.shadowstrength?t.shadowstrength:1,L=null!=t.shadowdistance?t.shadowdistance:150,$=null!=t.shadownearplane?t.shadownearplane:.2,ee=null!=t.shadowfilterquality?t.shadowfilterquality:"Medium",te=null!=t.transparencyshadow&&t.transparencyshadow,ne=null!=t.softtransparency&&t.softtransparency,oe=null==t.forcebackfacesonly||t.forcebackfacesonly,ie=null!=t.frustumedgefalloff?t.frustumedgefalloff:0,w=null!=t.usefullfloatfirst&&t.usefullfloatfirst;if(!0===d&&!0===x){var x=C,P=re.SceneManager.GetWebGLVersionNumber(o),s=0===s&&2<=S&&2<=P,U=!0==s?new BABYLON.CascadedShadowGenerator(M,C,w):new BABYLON.ShadowGenerator(M,x,w);if(U.bias=Z*K,U.normalBias=J*q,U.depthScale=W,U.useKernelBlur=Q,U.blurKernel=X,U.blurScale=z,U.blurBoxOffset=j,U.frustumEdgeFalloff=ie,U.forceBackFacesOnly=oe,U.transparencyShadow=te,U.enableSoftTransparentShadow=ne,U.contactHardeningLightSizeUVRatio=D,!0===I)if(P<=1)U.usePoissonSampling=!0;else if(!0==s)U.usePercentageCloserFiltering=!0;else switch(E){case 0:U.usePoissonSampling=!0;break;case 1:U.useExponentialShadowMap=!0;break;case 2:U.useBlurExponentialShadowMap=!0;break;case 3:U.useCloseExponentialShadowMap=!0;break;case 4:U.useBlurCloseExponentialShadowMap=!0;break;case 5:U.useContactHardeningShadow=!0;break;case 99:U.usePercentageCloserFiltering=!0;break;default:U.usePoissonSampling=!0}switch(ee){case"High":U.filteringQuality=BABYLON.ShadowGenerator.QUALITY_HIGH;break;case"Medium":U.filteringQuality=BABYLON.ShadowGenerator.QUALITY_MEDIUM;break;case"Low":U.filteringQuality=BABYLON.ShadowGenerator.QUALITY_LOW}!0==s?((M=U).lambda=A,M.depthClamp=O,M.shadowMaxZ=L,M.numCascades=S,M.penumbraDarkness=V,M.autoCalcDepthBounds=H,M.stabilizeCascades=F,M.cascadeBlendPercentage=k,M.autoCalcDepthBoundsRefreshRate=Y,M.freezeShadowCastersBoundingInfo=G,M.setDarkness(1-BABYLON.Scalar.Clamp(N)),x.shadowEnabled=!0,M.splitFrustum()):(U.setDarkness(1-BABYLON.Scalar.Clamp(N)),x.shadowEnabled=!0,x.shadowMinZ=$,x.shadowMaxZ=L),null==C.metadata&&(C.metadata={}),null==C.metadata.unity&&(C.metadata.unity={}),C.metadata.unity.autorender=T}w=e.name+".Holder";if(-1===a)C.includedOnlyMeshes=[];else if(0===a)C.includedOnlyMeshes=[new BABYLON.Mesh(w,o)];else{C.includedOnlyMeshes=[new BABYLON.Mesh(w,o)];var R=l;if(null!=R&&0<R.length)for(i=0;i<R.length;i++)!function(){var t,e,n=R[i],n=re.SceneManager.GetMeshByID(o,n);null!=n&&(t=n.name+".Detail",null!=(e=n.getChildren(function(e){return e.name===t},!0))&&0<e.length?C.includedOnlyMeshes.push(e[0]):C.includedOnlyMeshes.push(n))}()}e.lightRig=C}},re.MetadataParser=e}(UNITY=UNITY||{}),"CVTOOLS_unity_metadata"),CVTOOLS_MESH="CVTOOLS_babylon_mesh",CVTOOLS_HAND="CVTOOLS_left_handed",CubeTextureLoader=function(){},CVTOOLS_unity_metadata=function(){function e(e){this.name=CVTOOLS_NAME,this.enabled=!1,this._babylonScene=null,this._metadataParser=null,this._loaderScene=null,this._assetsManager=null,this._materialMap=null,this._lightmapMap=null,this._reflectionMap=null,this._reflectionCache=null,this._assetContainer=!1,this._activeMeshes=!1,this._parseScene=!1,this._leftHanded=!1,this._disposeRoot=!1,this._sceneParsed=!1,this._preWarmTime=1,this._hideLoader=!1,this._rootUrl=null,this._fileName="Unknown",this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND),this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._rootUrl=null,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._readyList=null,this._preloadList=null,this._materialMap=null,this._lightmapMap=null,this._preWarmTime=1,this._hideLoader=!1,this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._animationGroups=null,this._metadataParser=null,this._babylonScene=null,this.order=100}return e.prototype.dispose=function(){delete this._loader},e.prototype.onLoading=function(){var e=this;UNITY.Utilities.LoadingState=0,this._assetContainer=null!=this._loader._assetContainer,this._metadataParser=null,this._babylonScene=this._loader.babylonScene,this._loaderScene=null,this._assetsManager=null,this._rootUrl=this._loader._uniqueRootUrl||"/",this._fileName=this._loader._fileName||"Unknown",0<=this._fileName.indexOf("?")&&(this._fileName=this._fileName.split("?")[0]),this._loader.parent.onCompleteObservable.addOnce(function(){e.onComplete()}),this._loader.parent.onValidatedObservable.addOnce(function(){e.onValidate()}),this._parseScene=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND)&&!0===UNITY.SceneManager.IsSceneParsingEnabled(),this._leftHanded=this._loader.isExtensionUsed(CVTOOLS_HAND),this._disposeRoot=this._sceneParsed=!1,this._animationGroups=[],this._masterList=[],this._detailList=[],this._parserList=[],this._shaderList=[],this._readyList=[],this._preloadList=[],this._materialMap=new Map,this._lightmapMap=new Map,this._preWarmTime=1,this._hideLoader=!1,this._reflectionMap={},this._reflectionCache={},UNITY.Utilities.ResetLoaderItemsMarkedForDisposal(),this._babylonScene.getEngine().getCaps().supportSRGBBuffers=UNITY.SceneManager.SupportSRGBBuffers,!0===this._leftHanded&&null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.rotationQuaternion=BABYLON.Quaternion.Identity(),this._loader.rootBabylonMesh.scaling=BABYLON.Vector3.One()),!0===this._parseScene&&(UNITY.SceneManager.RenderLoopReady=!1,null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.name="Root."+this._fileName.replace(".gltf","").replace(".glb","")),this.setupLoader())},e.prototype.onReady=function(){!0===this._parseScene&&!0===this._disposeRoot&&null!=this._loader.rootBabylonMesh&&this._loader.rootBabylonMesh.dispose(!0)},e.prototype.onComplete=function(){this._parseScene,this.finishComplete()},e.prototype.getScriptBundleTag=function(){var e,t=null,n=this._loaderScene,n=null!=n&&null!=n.extras&&null!=n.extras.metadata?n.extras.metadata:null;return t=null!=n&&(null!=this._rootUrl&&this._rootUrl,e=null!=n.script?n.script:null,n=null!=n.project?n.project:null,null!=e)&&""!==e&&null!=n&&""!==n?n.toLocaleLowerCase():t},e.prototype.getScriptBundleUrl=function(){var e,t,n=null,o=this._loaderScene,o=null!=o&&null!=o.extras&&null!=o.extras.metadata?o.extras.metadata:null;return n=null!=o&&(e=null!=this._rootUrl?this._rootUrl:"/",t=null!=o.script?o.script:null,o=null!=o.project?o.project:null,null!=t)&&""!==t&&null!=o&&""!==o?e+o:n},e.prototype.finishComplete=function(){var e=this;!0===this._parseScene&&(this.startParsing(),UNITY.SceneManager.RenderLoopReady=!0,this._babylonScene.onAfterRenderObservable.addOnce(function(){UNITY.Utilities.LoadingState=3,e._processPreloadTimeout()}))},e.prototype.onValidate=function(){this._parseScene},e.prototype.onCleanup=function(){this._fileName=null,this._rootUrl=null,this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._preWarmTime=1,this._readyList=null,this._preloadList=null,this._hideLoader=!1,(this._animationGroups=null)!=this._materialMap&&(this._materialMap.clear(),this._materialMap=null),null!=this._lightmapMap&&(this._lightmapMap.clear(),this._lightmapMap=null),this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._metadataParser=null,this._babylonScene=null},e.prototype.setupLoader=function(){var o=this,i=this._fileName;!0===this._parseScene&&(this._assetsManager=new UNITY.PreloadAssetsManager(this._babylonScene),this._assetsManager.onProgress=function(e,t,n){!0===UNITY.SceneManager.AutoUpdateProgress?UNITY.WindowManager.UpdateLoaderDetails("LOADING "+(t-e)+" OF "+t+(1===t?" ASSET":" ASSETS"),UNITY.Utilities.LoadingState):null!=UNITY.Utilities.OnPreloaderProgress&&UNITY.Utilities.OnPreloaderProgress(e,t,n)},this._assetsManager.onFinish=function(n){UNITY.WindowManager.SetTimeout(100,function(){UNITY.Utilities.LoadingState=4,!0===UNITY.SceneManager.AutoUpdateProgress&&UNITY.WindowManager.UpdateLoaderStatus("PLEASE WAIT","PREPARING SCENE VIEW",UNITY.Utilities.LoadingState);var e=0<o._preWarmTime?1e3*o._preWarmTime:100;UNITY.WindowManager.SetTimeout(e,function(){if(null!=UNITY.Utilities.OnPreloaderComplete&&UNITY.Utilities.OnPreloaderComplete(n),o._processShaderMaterials(o._babylonScene,o._shaderList),UNITY.Utilities.RemoveLoaderItemsMarkedForDisposal(),null!=o._readyList&&0<o._readyList.length)for(var e=0;e<o._readyList.length;e++){var t=o._readyList[e];null!=t&&t._ready&&t._ready()}o._babylonScene.onAfterRenderObservable.addOnce(function(){null!=UNITY.SceneManager.OnSceneReadyObservable&&UNITY.SceneManager.OnSceneReadyObservable.notifyObservers(null!=i&&""!==i?i:"Unknown"),1==o._hideLoader&&UNITY.WindowManager.HideSceneLoader(),o.onCleanup()})})})})},e.prototype.startParsing=function(){!0===this._parseScene&&(UNITY.Utilities.LoadingState=2,this._processLevelOfDetail(this._babylonScene,this._detailList),this._processActiveMeshes(this._babylonScene,this._activeMeshes),this._processUnityMeshes(this._masterList),null!=this._loaderScene&&(this.preProcessSceneProperties(this._loaderScene,this._babylonScene),this.postProcessSceneProperties(this._rootUrl,this._loaderScene,this._babylonScene)),!1===this._assetContainer)&&null!=this._parserList&&0<this._parserList.length&&(this._metadataParser=UNITY.Utilities.PostParseSceneComponents(this._babylonScene,this._parserList,this._preloadList,this._readyList))},e.prototype.loadSceneAsync=function(e,t){var n,o;return!0===this._parseScene&&(this._loaderScene=t),!0===this._parseScene&&null!=t.extras&&null!=t.extras.metadata?(null!=t.extras.metadata.rawmaterials&&(o=this._loader,n=t.extras.metadata.rawmaterials,this._preloadRawMaterialsAsync(e,o._gltf.materials,n)),UNITY.Utilities.LoadingState=1,o=this._loader.loadSceneAsync(e,t),this.loadSceneExAsync(e,t),o):(UNITY.Utilities.LoadingState=1,null)},e.prototype.loadSceneExAsync=function(e,t){var r=this,n=this._loader,o=new Array;if(n._gltf.nodes)for(var i=0,a=n._gltf.nodes;i<a.length;i++){var l=a[i];l._babylonTransformNode&&this._animationGroups&&UNITY.Utilities.AssignAnimationGroupsToNode(l._babylonTransformNode,this._animationGroups)}if(null!=this._reflectionMap&&null!=this._reflectionCache){var s,u=0,c=this;for(s in this._reflectionMap)!function(e){var t;u++,c._reflectionMap.hasOwnProperty(e)&&(t=e,null!=c._assetsManager)&&((e=c._assetsManager.addBinaryFileTask("Material.ReflectionTextureTask"+u.toFixed(0),t)).onSuccess=function(e){var i;null!=e.data?(i=new Blob([e.data]),null!=(e=r._reflectionMap[t])&&e.forEach(function(e){var t,n,o;null!=e&&null!=e.mapkey&&(null!=(o=r._reflectionCache[e.mapkey])?null!=e.material&&UNITY.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=o):(o=r._babylonScene,t=URL.createObjectURL(i),n=function(){URL.revokeObjectURL(t)},(o=new BABYLON.CubeTexture(t,o,null,null,null,n,n,null,e.prefiltered,e.extension)).name=e.name,null!=e.boundingBoxSize&&(o.boundingBoxSize=e.boundingBoxSize),null!=e.boundingBoxPosition&&(o.boundingBoxPosition=e.boundingBoxPosition),r._reflectionCache[e.mapkey]=o,null!=e.material&&UNITY.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=o)))})):console.error("Failed to load reflection texture task: "+t)},e.onError=function(e,t,n){console.error(t,n)})}(s)}return n.logClose(),Promise.all(o).then(function(){})},e.prototype._processActiveMeshes=function(e,t){!0===t&&e.freeActiveMeshes()},e.prototype._processUnityMeshes=function(e){null!=e&&0<e.length&&e.forEach(function(e){UNITY.Utilities.RegisterInstancedMeshBuffers(e)})},e.prototype._processPreloadTimeout=function(){if(null!=this._assetsManager){if(null!=this._preloadList&&0<this._preloadList.length)for(var e=0;e<this._preloadList.length;e++){var t=this._preloadList[e];null!=t&&t.addPreloaderTasks&&t.addPreloaderTasks(this._assetsManager)}this._babylonScene._preloaded=!0,this._assetsManager.load()}},e.prototype.loadNodeAsync=function(e,n,o){var i=this;return!0===this._parseScene&&null!=n.extras&&null!=n.extras.metadata?this._loader.loadNodeAsync(e,n,function(e){var t=n.extras.metadata;null==e.metadata&&(e.metadata={}),e.metadata.unity=t,UNITY.Utilities.ValidateTransformGuid(e),UNITY.Utilities.ValidateTransformMetadata(e),UNITY.Utilities.ValidateTransformQuaternion(e),e.isVisible=null==e.metadata.unity.visible||e.metadata.unity.visible,e.visibility=null!=e.metadata.unity.visibility?e.metadata.unity.visibility:1,e.billboardMode=null!=e.metadata.unity.billboard?e.metadata.unity.billboard:0,!0===i._assetContainer&&(e.metadata.unity.prefab=!0),!0===e.metadata.unity.prefab?e.setEnabled(!1):(i._parserList.push(e),null!=n.extras.metadata.lods&&null!=n.extras.metadata.distances&&null!=i._detailList&&i._detailList.push(e)),i._masterList.push(e),o(e)}):null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o,i;return!0===this._parseScene?(o=-1,t.index&&0<=(o=t.index)&&null!=this._materialMap&&(this._materialMap.has(o)||this._materialMap.set(o,n)),n.gltfIndex=o,o=this._loader,i=new Array,n instanceof BABYLON.NodeMaterial?i.push(this._parseNodeMaterialPropertiesAsync("".concat(e,"/nodeMaterial"),t,n)):n instanceof BABYLON.ShaderMaterial?i.push(this._parseShaderMaterialPropertiesAsync("".concat(e,"/shaderMaterial"),t,n)):n instanceof BABYLON.StandardMaterial?i.push(this._parseDiffuseMaterialPropertiesAsync("".concat(e,"/standardMaterial"),t,n)):(o._extensionsLoadMaterialPropertiesAsync(e,t,n)||(i.push(o.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&i.push(o._loadMaterialMetallicRoughnessPropertiesAsync("".concat(e,"/pbrMetallicRoughness"),t.pbrMetallicRoughness,n)),o.loadMaterialAlphaProperties(e,t,n)),this._parseCommonConstantProperties(i,"".concat(e,"/commonConstant"),t,n)),Promise.all(i).then(function(){})):null},e.prototype._getCachedMaterialByIndex=function(e){var t=null;return t=0<=e&&null!=this._materialMap?this._materialMap.get(e)||null:t},e.prototype._getCachedLightmapByIndex=function(e){var t=null;return t=0<=e&&null!=this._lightmapMap?this._lightmapMap.get(e)||null:t},e.prototype.createMaterial=function(e,t,n){if(!0===this._parseScene&&t.index){var o=t.index;if(0<=o){o=this._getCachedMaterialByIndex(o);if(null!=o)return o}}var i,r;return!0===this._parseScene?(o=t.name||"No Name",(i=null)!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.customMaterial&&(r=(t=t.extras.metadata).customMaterial,t.customShader,null!=(t=UNITY.Utilities.InstantiateClass(r))?null!=(t=new t(o,this._loader.babylonScene))?!0==t instanceof BABYLON.Material?((i=t).fillMode=n,i instanceof BABYLON.ShaderMaterial&&UNITY.Utilities.InitializeShaderMaterial(i)):BABYLON.Tools.Warn("Non material instantiated class: "+r):BABYLON.Tools.Warn("Failed to instantiate material class: "+r):BABYLON.Tools.Warn("Failed to locate material class: "+r)),i):null},e.prototype.loadAnimationAsync=function(e,t){if(!0!==this._parseScene)return null;this._loader;var n=t,o=(this._babylonScene._blockEntityCollection=!!this._assetContainer,new BABYLON.AnimationGroup(t.name||"animation".concat(n.index),this._babylonScene)),i=(o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n._babylonAnimationGroup=o,this._animationGroups.push(o),new Array);BABYLON.GLTF2.ArrayItem.Assign(n.channels),BABYLON.GLTF2.ArrayItem.Assign(n.samplers);for(var r=0,a=t.channels;r<a.length;r++){var l=a[r],s=l;i.push(this._loader._loadAnimationChannelAsync("".concat(e,"/channels/").concat(s.index),e,t,l,function(e,t){e.animations=e.animations||[],e.animations.push(t),o.addTargetedAnimation(t,e)}))}return Promise.all(i).then(function(){var e;return null!=t.extras&&null!=t.extras.metadata&&((e={}).unity=t.extras.metadata,null!=(o.metadata=e).label)&&""!==e.label&&(o.name=e.label),o.normalize(0),o})},e.prototype._loadMeshPrimitiveAsync=function(t,e,n,o,i,r){var a,l,s,u,c,d,p,h=this;return!0===this._parseScene?((a=this._loader).logOpen("".concat(t)),u=void 0,(l=0===a._disableInstancedMesh&&a._parent.createInstances&&null==n.skin&&!o.primitives[0].targets)&&i._instanceData?(a._babylonScene._blockEntityCollection=!!a._assetContainer,(s=i._instanceData.babylonSourceMesh.createInstance(e))._parentContainer=a._assetContainer,a._babylonScene._blockEntityCollection=!1,u=i._instanceData.promise):(c=new Array,a._babylonScene._blockEntityCollection=!!a._assetContainer,(d=new BABYLON.Mesh(e,a._babylonScene))._parentContainer=a._assetContainer,!(a._babylonScene._blockEntityCollection=!1)===this._leftHanded?d.overrideMaterialSideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:d.overrideMaterialSideOrientation=a._babylonScene.useRightHandedSystem?BABYLON.Material.CounterClockWiseSideOrientation:BABYLON.Material.ClockWiseSideOrientation,a._createMorphTargets(t,n,o,i,d),c.push(a._loadVertexDataAsync(t,i,d).then(function(e){return a._loadMorphTargetsAsync(t,i,d,e).then(function(){a._disposed||(a._babylonScene._blockEntityCollection=!!a._assetContainer,e.applyToMesh(d),h._setupBabylonMesh(d,n,o,i),e._parentContainer=a._assetContainer,a._babylonScene._blockEntityCollection=!1)})})),e=BABYLON.GLTF2.GLTFLoader._GetDrawMode(t,i.mode),null!=i.extras&&null!=i.extras.metadata&&null!=i.extras.metadata.multimaterial&&null!=i.extras.metadata.submeshes?this._setupBabylonMaterials(t,c,e,d,o,i):null==i.material?((p=a._defaultBabylonMaterialData[e])||(p=a._createDefaultMaterial("__GLTFLoader._default",e),a._parent.onMaterialLoadedObservable.notifyObservers(p),a._defaultBabylonMaterialData[e]=p),d.material=p):a.parent.skipMaterials||(p=BABYLON.GLTF2.ArrayItem.Get("".concat(t,"/material"),a._gltf.materials,i.material),c.push(a._loadMaterialAsync("/materials/".concat(p.index),p,d,e,function(e){d.material=e}))),u=Promise.all(c),l&&(i._instanceData={babylonSourceMesh:d,promise:u}),s=d),BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(s,t),a._parent.onMeshLoadedObservable.notifyObservers(s),r(s),a.logClose(),u.then(function(){return s})):null},e.prototype._setupBabylonMesh=function(e,t,n,o){if(!0===this._parseScene){this._loader;if(null!=o.extras&&null!=o.extras.metadata&&null!=o.extras.metadata.multimaterial&&null!=o.extras.metadata.submeshes){var i=o.extras.metadata.submeshes;e.subMeshes=[];for(var r=0;r<i.length;r++){var a=i[r];BABYLON.SubMesh.AddToMesh(a.materialIndex,a.verticesStart,a.verticesCount,a.indexStart,a.indexCount,e)}}e.computeWorldMatrix(!0)}},e.prototype._setupBabylonMaterials=function(t,e,n,o,i,r){var a,l,s,u,c;!0===this._parseScene&&(a=this._loader,l=(r=r.extras.metadata.multimaterial).materials,s=[],u=r.id||"MM_"+i.name,r=r.name||"MM_"+i.name,(c=new BABYLON.MultiMaterial("["+r+"]",a._babylonScene)).id=u,l.forEach(function(e){null!=e?0<=(e=parseInt(e))?(e=BABYLON.GLTF2.ArrayItem.Get("".concat(t,"/material"),a._gltf.materials,e),s.push(e)):console.warn("Invalid Submesh Material Index Encountered For: "+o.name):console.warn("Null Submesh Material Encountered For: "+o.name)}),e.push(this._parseMultiMaterialAsync("/materials/".concat(r),s,o,n,function(e){c.subMaterials=e,o.material=c})))},e.prototype._processLevelOfDetail=function(e,t){null!=t&&0<t.length&&t.forEach(function(n){var e,o,i,r,t;null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.lods&&null!=n.metadata.unity.distances&&(e=(t=n.metadata.unity).lods,(o=t.distances).length>=e.length)&&(r=i=null,e.forEach(function(e,t){e="*"===e?n:SM.FindChildTransformNode(n,e,UNITY.SearchType.ExactMatch,!1);null!=e&&e instanceof BABYLON.AbstractMesh&&(0===t?i=e:(r=null==r?[]:r).push(e))}),null!=i)&&(i instanceof BABYLON.Mesh?(1/0<=(t=0<o.length?o[o.length-1]:0)&&(t=0),null!=r&&r.forEach(function(e,t){i.addLODLevel(o[t],e)}),0<t&&i.addLODLevel(t,null)):i instanceof BABYLON.InstancedMesh&&null!=r&&r.forEach(function(e,t){try{e.dispose()}catch(e){}BABYLON.Tools.Warn("Destroyed Unused Level Detail: "+e.name+" --\x3e For Transform: "+n.name)}))})},e.prototype._processShaderMaterials=function(e,t){null!=t&&0<t.length&&t.forEach(function(e){e.freeze()})},e.prototype.preProcessSceneProperties=function(e,t){var n,o,i,r,a,l;!0!==this._assetContainer&&!1===this._sceneParsed&&null!=e.extras&&null!=e.extras.metadata&&null!=e.extras.metadata.properties&&!0===e.extras.metadata.properties&&(this._sceneParsed=!0,a=null!=this._rootUrl?this._rootUrl:"/",e=e.extras.metadata,null==t.metadata&&(t.metadata={}),null==t.metadata.unity&&(t.metadata.unity={}),t.metadata.unity=e,this._disposeRoot=null!=e.disposeroot&&!0===e.disposeroot,this._hideLoader=null!=e.hideloader&&!0===e.hideloader,this._preWarmTime=null!=e.prewarmup?e.prewarmup:0,UNITY.SceneManager.SetRootUrl(t,a),UNITY.SceneManager.SetSceneFile(t,this._fileName),UNITY.SceneManager.EnableUserInput=!0,UNITY.SceneManager.GlobalOptions.ktxtextures=null!=e.ktxtextures&&e.ktxtextures,UNITY.SceneManager.GlobalOptions.ktxlightmaps=null!=e.ktxlightmaps&&e.ktxlightmaps,UNITY.SceneManager.GlobalOptions.intensityFactor=null!=e.intensity?e.intensity:1,UNITY.SceneManager.GlobalOptions.debugModeEnabled=null!=e.debugging&&e.debugging,UNITY.SceneManager.GlobalOptions.showDebugColliders=null!=e.showdebugcolliders&&e.showdebugcolliders,UNITY.SceneManager.GlobalOptions.colliderVisibility=null!=e.collidervisibility?e.collidervisibility:0,UNITY.SceneManager.GlobalOptions.colliderRenderGroup=null!=e.colliderrendergroup?e.colliderrendergroup:0,UNITY.SceneManager.GlobalOptions.defaultRenderGroup=null!=e.defaultrendergroup?e.defaultrendergroup:0,UNITY.SceneManager.GlobalOptions.collisionWireframe=null!=e.collisionwireframe&&e.collisionwireframe,UNITY.SceneManager.GlobalOptions.useTriangleNormals=null!=e.trianglenormals&&e.trianglenormals,UNITY.SceneManager.GlobalOptions.useConvexTriangles=null==e.convextriangles||e.convextriangles,UNITY.SceneManager.GlobalOptions.colliderInstances=null==e.colliderinstances||e.colliderinstances,UNITY.SceneManager.GlobalOptions.reparentColliders=null==e.reparentcolliders||e.reparentcolliders,null!=e.clearcolor&&(t.clearColor=UNITY.Utilities.ParseColor4(e.clearcolor)),null!=e.autoclear&&!0===e.autoclear&&(t.autoClear=!0,t.autoClearDepthAndStencil=!0),null!=e.rendergroups&&(BABYLON.RenderingManager.MAX_RENDERINGGROUPS=e.rendergroups),null!=e.imageprocessing&&(n=null!=(a=e.imageprocessing).contrast?a.contrast:1,a=null!=a.exposure?a.exposure:1,null!=t.imageProcessingConfiguration)&&(t.imageProcessingConfiguration.contrast=n,t.imageProcessingConfiguration.exposure=a),n=UNITY.SceneManager.AmbientLightIntensity,null!=e.ambientcoloring&&(t.ambientColor=UNITY.Utilities.ParseColor3(e.ambientcoloring)),null!=e.ambientlighting&&0<e.ambientlighting&&(null==(a=t)._AmbientLight&&(a._AmbientLight=new BABYLON.HemisphericLight("Ambient Lighting",new BABYLON.Vector3(0,1,0),t),a._AmbientLight.falloffType=BABYLON.Light.FALLOFF_STANDARD,a._AmbientLight.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT),null!=a._AmbientLight)&&(null!=e.ambientskycolor&&(a._AmbientLight.diffuse=UNITY.Utilities.ParseColor3(e.ambientskycolor,BABYLON.Color3.Gray())),null!=e.ambientspecularcolor&&(a._AmbientLight.specular=UNITY.Utilities.ParseColor3(e.ambientspecularcolor,BABYLON.Color3.White())),null!=e.ambientgroundcolor&&(a._AmbientLight.groundColor=UNITY.Utilities.ParseColor3(e.ambientgroundcolor,BABYLON.Color3.Gray())),null!=e.ambientlightintensity&&(a._AmbientLight.intensity=e.ambientlightintensity),a._AmbientLight.intensity*=n),null!=e.fogmode&&0<(a=e.fogmode)&&(t.fogMode=a,t.fogEnabled=!0,(n=1)===a?n=.5:2===a&&(n=.75),null!=e.fogdensity&&(t.fogDensity=e.fogdensity*n),null!=e.fogstart&&(t.fogStart=e.fogstart),null!=e.fogend&&(t.fogEnd=e.fogend),null!=e.fogcolor)&&(t.fogColor=UNITY.Utilities.ParseColor3(e.fogcolor)),a=new BABYLON.Vector3(0,-9.81,0),n=null!=e.defaultgravity?UNITY.Utilities.ParseVector3(e.defaultgravity,a):a,t.gravity=n.clone(),t.collisionsEnabled=!0,null!=e.enablephysics&&!0===e.enablephysics&&(a=null==e.ccdenabled||e.ccdenabled,l=null!=e.ccdpenetration?e.ccdpenetration:1e-4,i=null!=e.subtimestep?e.subtimestep:0,r=null!=e.maxworldsweep?e.maxworldsweep:0,o=null==e.deltaworldstep||e.deltaworldstep,UNITY.RigidbodyPhysics.ConfigurePhysicsEngine(t,o,i,r,a,l,n)),null!=e.userinput&&(o=e.userinput,UNITY.UserInputOptions.KeyboardSmoothing=o.keyboardSmoothing,UNITY.UserInputOptions.KeyboardMoveSensibility=o.keyboardSensitivity,UNITY.UserInputOptions.KeyboardMoveDeadZone=o.keyboardDeadZone,UNITY.UserInputOptions.GamepadDeadStickValue=o.padDeadStick,UNITY.UserInputOptions.GamepadLStickXInverted=o.padLStickXInvert,UNITY.UserInputOptions.GamepadLStickYInverted=o.padLStickYInvert,UNITY.UserInputOptions.GamepadRStickXInverted=o.padRStickXInvert,UNITY.UserInputOptions.GamepadRStickYInverted=o.padRStickYInvert,UNITY.UserInputOptions.GamepadLStickSensibility=o.padLStickLevel,UNITY.UserInputOptions.GamepadRStickSensibility=o.padRStickLevel,UNITY.UserInputOptions.SupportedInputDevices=o.supportedDevices,UNITY.UserInputOptions.PointerAngularSensibility=o.mouseSensitivity,UNITY.UserInputOptions.PointerWheelDeadZone=o.wheelDeadZone,UNITY.UserInputOptions.PointerMouseDeadZone=o.mouseDeadZone,UNITY.UserInputOptions.PointerMouseInverted=o.mouseMoveInvert,UNITY.UserInputOptions.UseCanvasElement=o.useCanvasElement,UNITY.UserInputOptions.UseArrowKeyRotation=o.arrowKeyRotation),null!=e.enableinput&&!0===e.enableinput&&(i=null==e.contextmenu||e.contextmenu,r=null!=e.pointerlock&&e.pointerlock,a=null!=e.preventdefault&&e.preventdefault,l=null!=e.usecapture&&e.usecapture,UNITY.InputController.ConfigureUserInput(t,{contextMenu:i,pointerLock:r,preventDefault:a,useCapture:l})),null!=e.freezeactivemeshes&&!0===e.freezeactivemeshes&&(this._activeMeshes=!0),null!=e.performancepriority)&&(t.performancePriority=e.performancepriority)},e.prototype.postProcessSceneProperties=function(e,t,n){var o=this;if(!0!==this._assetContainer&&null!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.properties&&!0===t.extras.metadata.properties){var i,r,a,l,s,t=t.extras.metadata;if(null!=t.skybox){var u,c,d,p,h,m=t.skybox,g=null!=m.skyfog&&m.skyfog,f=null!=m.skytags?m.skytags:"Untagged",y=null!=m.skysize?m.skysize:1e3,v=null!=m.rotation?m.rotation:0,e=null!=m.basename&&""!==m.basename?e+m.basename:null,_=null!=m.skyfaces?m.skyfaces:null,B=null!=m.rendergroup?m.rendergroup:0,b=null!=m.extensions&&0<m.extensions.length?m.extensions:null,C=null!=m.polynomial?m.polynomial:1;try{null!=_&&""!==_&&null!=e&&""!==e&&(c=null,"png"===_?(c=new BABYLON.CubeTexture(e,n,b),0<=e.indexOf("_rgbd")?(c.isRGBD=!0,c.gammaSpace=!1):(c.isRGBD=!1,c.gammaSpace=!0)):"jpg"===_||"ktx2"===_?((c=new BABYLON.CubeTexture(e,n,b)).isRGBD=!1,c.gammaSpace=!0):(u=e+"."+_,(c=new BABYLON.CubeTexture(u,n,null,!0,null,null,null,null,!0)).gammaSpace=!1),c.name=m.basename,c.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,c.rotationY=BABYLON.Tools.ToRadians(v),d="Default Skybox",(p=BABYLON.MeshBuilder.CreateBox(d,{size:y},n)).renderingGroupId=UNITY.Utilities.DefaultRenderGroup(),p.id=d,p.infiniteDistance=!0,p.applyFog=g,p.renderingGroupId=B,null!=f&&""!==f&&BABYLON.Tags.AddTagsTo(p,f),!0===n.useRightHandedSystem&&(p.scaling.x*=-1),(h=new BABYLON.StandardMaterial("Skybox-Material",n)).backFaceCulling=!1,h.disableLighting=!0,h.diffuseColor=new BABYLON.Color3(0,0,0),h.emissiveColor=new BABYLON.Color3(0,0,0),h.specularColor=new BABYLON.Color3(0,0,0),h.ambientColor=new BABYLON.Color3(0,0,0),h.reflectionTexture=c,p.material=h)}catch(e){console.warn(e)}if(null!=m.environment){var b=m.environment,T=(n.environmentIntensity=null!=b.level?BABYLON.Scalar.Clamp(b.level,0,10):1,null!=b.info&&""!==b.info?b.info:null);if(null!=T&&""!==T)try{var I,S=UNITY.SceneManager.GetRootUrl(n)+T.rooturl+T.name;null!=this._assetsManager&&((I=this._assetsManager.addBinaryFileTask("Global.EnvironmentTextureTask",S)).onSuccess=function(e){var t,n;null!=e.data?(e=new Blob([e.data]),t=o._babylonScene,n=URL.createObjectURL(e),e=function(){URL.revokeObjectURL(n)},e=new BABYLON.CubeTexture(n,t,null,null,null,e,e,null,!0,".dds"),t.environmentTexture=e,t.environmentTexture.name="assets/"+T.name,null!=t.environmentTexture&&null!=t.environmentTexture.sphericalPolynomial&&(t.isReady()?t.environmentTexture.sphericalPolynomial.scaleInPlace(C):t.onReadyObservable.addOnce(function(){t.environmentTexture.sphericalPolynomial.scaleInPlace(C)}))):console.error("Failed to load environment texture task: "+S)},I.onError=function(e,t,n){console.error(t,n)})}catch(e){console.warn(e)}}}null!=t.navigation&&null!=t.navigation.prebaked&&""!==t.navigation.prebaked&&(i=null!=t.navigation.collision&&!0===t.navigation.collision,r=null!=t.navigation.showdebug&&!0===t.navigation.showdebug,e=null!=t.navigation.debugcolor?t.navigation.debugcolor:[.05,.225,.75],a=new BABYLON.Color3(e[0],e[1],e[2]),l=null!=t.navigation.timesteps?t.navigation.timesteps:0,null!=this._assetsManager)&&(s=t.navigation.prebaked,(_=this._assetsManager.addBinaryFileTask("System.NavigationMeshTask",s)).onSuccess=function(e){null!=e.data?(e=new Uint8Array(e.data),UNITY.SceneManager.LoadNavigationMesh(n,e,r,a,l,i)):console.error("Failed to load navigation mesh task: "+s)},_.onError=function(e,t,n){console.error(t,n)})}},e.prototype._preloadRawMaterialsAsync=function(n,o,e){var i=this._loader,r=new Array,a=BABYLON.Material.TriangleFillMode;return e.forEach(function(e){var t,e=BABYLON.GLTF2.ArrayItem.Get("".concat(n,"/material"),o,e);null!=e&&(t=i.createMaterial(n,e,a),BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(t,n),i._parent.onMaterialLoadedObservable.notifyObservers(t),r.push(i.loadMaterialPropertiesAsync(n,e,t)))}),Promise.all(r).then(function(){})},e.prototype._parseMultiMaterialAsync=function(o,e,t,i,n){var r,a,l=this,s=(void 0===n&&(n=function(){}),this._loader),u=e,c=(u._data=u._data||{},u._data[i]);return c||(s.logOpen("".concat(o," ").concat(t.name||"")),r=[],a=new Array,e.forEach(function(e){var t,n=null;null==(n=e.index&&0<=(t=e.index)?l._getCachedMaterialByIndex(t):n)&&(n=s.createMaterial(o,e,i),BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(n,o),s._parent.onMaterialLoadedObservable.notifyObservers(n),a.push(s.loadMaterialPropertiesAsync(o,e,n))),r.push(n)}),c={babylonMaterials:r,babylonMeshes:[],promises:a},u._data[i]=c,s.logClose()),c.babylonMeshes.push(t),t.onDisposeObservable.addOnce(function(){var e=c.babylonMeshes.indexOf(t);-1!==e&&c.babylonMeshes.splice(e,1)}),n(c.babylonMaterials),Promise.all(c.promises).then(function(){return c.babylonMaterials})},e.prototype._parseNodeMaterialPropertiesAsync=function(n,t,o){var e,i=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,r=o,a=new Array;r.backFaceCulling=null==i||null==i.backFaceCulling||i.backFaceCulling,t.doubleSided&&(r.backFaceCulling=!1);if(t.pbrMetallicRoughness&&(g=t.pbrMetallicRoughness)&&(g.baseColorFactor?(e=BABYLON.Color4.FromArray(g.baseColorFactor),r.setVector4("_Color",new BABYLON.Vector4(Math.pow(e.r,1/2.2),Math.pow(e.g,1/2.2),Math.pow(e.b,1/2.2),e.a)),e.a):r.setVector4("_Color",new BABYLON.Vector4(1,1,1,1)),g.baseColorTexture)&&a.push(this._loader.loadTextureInfoAsync("".concat(n,"/baseColorTexture"),g.baseColorTexture,function(e){e.name="".concat(o.name," (Base Color)");e.level=null!=i&&null!=i.diffuseIntensity?i.diffuseIntensity:1,r.setTexture("_MainTex",e)})),t.normalTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(n,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(o.name," (Normal)");null!=t.normalTexture.scale&&(e.level=t.normalTexture.scale),r.setTexture("_BumpMap",e)})),t.occlusionTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(n,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(o.name," (Occlusion)");null!=t.occlusionTexture.strength&&(e.level=t.occlusionTexture.strength),r.setTexture("_OcclusionMap",e)})),t.emissiveFactor&&(0<(e=BABYLON.Color4.FromArray(t.emissiveFactor)).r||0<e.g||0<e.b)&&r.setVector4("_EmissionColor",new BABYLON.Vector4(Math.pow(e.r,1/2.2),Math.pow(e.g,1/2.2),Math.pow(e.b,1/2.2),e.a)),t.emissiveTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(n,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(o.name," (Emissive)"),r.setTexture("_EmissionMap",e)})),null!=i){if(r.wireframe=null!=i.useWireframe&&i.useWireframe,r.needDepthPrePass=null!=i.depthPrepass&&i.depthPrepass,i.customTextures){var l,s=this;for(l in i.customTextures)!function(t){var e=i.customTextures[t];null!=e&&a.push(s._loader.loadTextureInfoAsync(n+"/"+t,e,function(e){e.name="".concat(o.name,"detailsSampler"===t||"normalsSampler"===t?" (Atlas)":" (Custom)"),r.setTexture(t,e)}))}(l)}if(i.customVectors)for(var u in i.customVectors){var c=i.customVectors[u];null!=c&&r.setVector4(u,BABYLON.Vector4.FromArray(c))}if(i.customColors)for(var d in i.customColors){var p=i.customColors[d];null!=p&&r.setVector4(d,BABYLON.Vector4.FromArray(p))}if(i.customFloats)for(var h in i.customFloats){var m=i.customFloats[h];null!=m&&r.setFloat(h,m)}null!=i.freezeMaterial&&!0===i.freezeMaterial&&null!=this._shaderList&&this._shaderList.push(r)}var g=Promise.all(a).then(function(){});return r.compile(),g},e.prototype._parseShaderMaterialPropertiesAsync=function(n,t,o){var e,i,r=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,a=o,l=new Array,s=(a.backFaceCulling=null==r||null==r.backFaceCulling||r.backFaceCulling,t.doubleSided&&(a.backFaceCulling=!1),UNITY.Utilities.HasOwnProperty(a,"ambientColor")&&(a.ambientColor=null!=r&&r.ambientColorFactor?BABYLON.Color3.FromArray(r.ambientColorFactor):BABYLON.Color3.Black()),1);switch(t.pbrMetallicRoughness&&(e=t.pbrMetallicRoughness)&&(e.baseColorFactor?(i=BABYLON.Color4.FromArray(e.baseColorFactor),a.setVector4("diffuseColor",new BABYLON.Vector4(Math.pow(i.r,1/2.2),Math.pow(i.g,1/2.2),Math.pow(i.b,1/2.2),i.a)),s=i.a):a.setVector4("diffuseColor",new BABYLON.Vector4(1,1,1,1)),e.baseColorTexture)&&l.push(this._loader.loadTextureInfoAsync("".concat(n,"/baseColorTexture"),e.baseColorTexture,function(e){e.name="".concat(o.name," (Base Color)");e.level=null!=r&&null!=r.diffuseIntensity?r.diffuseIntensity:1,a.setTexture("diffuseTexture",e)})),t.normalTexture&&l.push(this._loader.loadTextureInfoAsync("".concat(n,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(o.name," (Normal)");null!=t.normalTexture.scale&&(e.level=t.normalTexture.scale),a.setTexture("bumpTexture",e)})),t.occlusionTexture&&l.push(this._loader.loadTextureInfoAsync("".concat(n,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(o.name," (Occlusion)");null!=t.occlusionTexture.strength&&(e.level=t.occlusionTexture.strength),a.setTexture("ambientTexture",e)})),t.emissiveFactor&&(0<(i=BABYLON.Color4.FromArray(t.emissiveFactor)).r||0<i.g||0<i.b)&&a.setVector4("emissiveColor",new BABYLON.Vector4(Math.pow(i.r,1/2.2),Math.pow(i.g,1/2.2),Math.pow(i.b,1/2.2),i.a)),t.emissiveTexture&&l.push(this._loader.loadTextureInfoAsync("".concat(n,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(o.name," (Emissive)"),a.setTexture("emissiveTexture",e)})),a.alpha=s,t.alphaMode||"OPAQUE"){case"OPAQUE":a.alpha=1,a.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_OPAQUE;break;case"MASK":a.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHATEST;break;case"BLEND":a.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHABLEND;break;default:throw new Error("".concat(n,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}if(null!=r){if(a.wireframe=null!=r.useWireframe&&r.useWireframe,a.needDepthPrePass=null!=r.depthPrepass&&r.depthPrepass,r.customTextures){var u,c=this;for(u in r.customTextures)!function(t){var e=r.customTextures[t];null!=e&&l.push(c._loader.loadTextureInfoAsync(n+"/"+t,e,function(e){e.name="".concat(o.name,"detailsSampler"===t||"normalsSampler"===t?" (Atlas)":" (Custom)"),a.setTexture(t,e)}))}(u)}if(r.customVectors)for(var d in r.customVectors){var p=r.customVectors[d];null!=p&&a.setVector4(d,BABYLON.Vector4.FromArray(p))}if(r.customColors)for(var h in r.customColors){var m=r.customColors[h];null!=m&&a.setVector4(h,BABYLON.Vector4.FromArray(m))}if(r.customFloats)for(var g in r.customFloats){var f=r.customFloats[g];null!=f&&a.setFloat(g,f)}null!=r.freezeMaterial&&!0===r.freezeMaterial&&null!=this._shaderList&&this._shaderList.push(a)}return Promise.all(l).then(function(){})},e.prototype._parseDiffuseMaterialPropertiesAsync=function(e,t,n){var o,i,r=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,a=n,l=new Array,s=(UNITY.Utilities.HasOwnProperty(a,"ambientColor")&&(a.ambientColor=null!=r&&r.ambientColorFactor?BABYLON.Color3.FromArray(r.ambientColorFactor):BABYLON.Color3.Black()),UNITY.Utilities.HasOwnProperty(a,"backFaceCulling")&&(a.backFaceCulling=null==r||null==r.backFaceCulling||r.backFaceCulling),t.doubleSided&&(UNITY.Utilities.HasOwnProperty(a,"twoSidedLighting")&&(a.twoSidedLighting=!0),UNITY.Utilities.HasOwnProperty(a,"backFaceCulling"))&&(a.backFaceCulling=!1),1);switch(t.pbrMetallicRoughness&&(o=t.pbrMetallicRoughness)&&(UNITY.Utilities.HasOwnProperty(a,"diffuseColor")&&(o.baseColorFactor?(i=BABYLON.Color4.FromArray(o.baseColorFactor),a.diffuseColor=new BABYLON.Color3(Math.pow(i.r,1/2.2),Math.pow(i.g,1/2.2),Math.pow(i.b,1/2.2)),s=i.a):a.diffuseColor=BABYLON.Color3.White()),UNITY.Utilities.HasOwnProperty(a,"diffuseTexture"))&&o.baseColorTexture&&l.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),o.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)"),a.diffuseTexture=e,a.diffuseTexture.level=null!=r&&null!=r.diffuseIntensity?r.diffuseIntensity:1})),UNITY.Utilities.HasOwnProperty(a,"bumpTexture")&&t.normalTexture&&(l.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)"),a.bumpTexture=e,null!=t.normalTexture.scale&&(a.bumpTexture.level=t.normalTexture.scale)})),UNITY.Utilities.HasOwnProperty(a,"invertNormalMapX")&&(a.invertNormalMapX=!this._loader.babylonScene.useRightHandedSystem),UNITY.Utilities.HasOwnProperty(a,"invertNormalMapY"))&&(a.invertNormalMapY=this._loader.babylonScene.useRightHandedSystem),UNITY.Utilities.HasOwnProperty(a,"ambientTexture")&&t.occlusionTexture&&l.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)"),a.ambientTexture=e,null!=t.occlusionTexture.strength&&(a.ambientTexture.level=t.occlusionTexture.strength)})),UNITY.Utilities.HasOwnProperty(a,"emissiveColor")&&(i=t.emissiveFactor?BABYLON.Color4.FromArray(t.emissiveFactor):new BABYLON.Color4(0,0,0,1),a.emissiveColor=new BABYLON.Color3(Math.pow(i.r,1/2.2),Math.pow(i.g,1/2.2),Math.pow(i.b,1/2.2))),UNITY.Utilities.HasOwnProperty(a,"emissiveTexture")&&t.emissiveTexture&&l.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)"),a.emissiveTexture=e,UNITY.Utilities.HasOwnProperty(a,"useEmissiveAsIllumination")&&(a.useEmissiveAsIllumination=null!=r&&null!=r.useEmissiveAsIllumination&&r.useEmissiveAsIllumination)})),UNITY.Utilities.HasOwnProperty(a,"alpha")&&(a.alpha=s),t.alphaMode||"OPAQUE"){case"OPAQUE":UNITY.Utilities.HasOwnProperty(a,"alpha")&&(a.alpha=1);break;case"MASK":a.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff,a.diffuseTexture&&UNITY.Utilities.HasOwnProperty(a,"diffuseTexture")&&(a.diffuseTexture.hasAlpha=!0);break;case"BLEND":a.diffuseTexture&&(UNITY.Utilities.HasOwnProperty(a,"diffuseTexture")&&(a.diffuseTexture.hasAlpha=!0),UNITY.Utilities.HasOwnProperty(a,"useAlphaFromDiffuseTexture"))&&(a.useAlphaFromDiffuseTexture=!0);break;default:throw new Error("".concat(e,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}return this._parseCommonConstantProperties(l,e,t,n),Promise.all(l).then(function(){})},e.prototype._parseCommonConstantProperties=function(n,o,e,i){var r=this,a=null!=e.extras&&null!=e.extras.metadata?e.extras.metadata:null;if(null!=a){var l,s,t,u,c=i,e=(UNITY.Utilities.HasOwnProperty(c,"alphaMode")&&(c.alphaMode=null!=a&&a.alphaMode?a.alphaMode:BABYLON.Engine.ALPHA_COMBINE),UNITY.Utilities.HasOwnProperty(c,"ambientColor")&&(c.ambientColor=null!=a&&a.ambientColorFactor?BABYLON.Color3.FromArray(a.ambientColorFactor):BABYLON.Color3.Black()),UNITY.Utilities.HasOwnProperty(c,"backFaceCulling")&&(c.backFaceCulling=null==a||null==a.backFaceCulling||a.backFaceCulling),i instanceof BABYLON.PBRMaterial&&(i.useMetallnessFromMetallicTextureBlue=!0,i.useRoughnessFromMetallicTextureGreen=!0,i.useRoughnessFromMetallicTextureAlpha=!1,i.useAmbientOcclusionFromMetallicTextureRed=!1,i.directIntensity=null!=a.directIntensity?a.directIntensity:1,i.specularIntensity=null!=a.specularIntensity?a.specularIntensity:1,i.emissiveIntensity=null!=a.emissiveIntensity?a.emissiveIntensity:1,i.environmentIntensity=null!=a.environmentIntensity?a.environmentIntensity:1,i.indexOfRefraction=null!=a.indexOfRefraction?a.indexOfRefraction:1.5,null!=a.useAlphaFromAlbedoTexture&&(i.useAlphaFromAlbedoTexture=a.useAlphaFromAlbedoTexture),null!=a.parallaxBias)&&0<a.parallaxBias&&(i.useParallax=!0,i.parallaxScaleBias=.9*a.parallaxBias,i.useParallaxOcclusion=null==a.parallaxOcclusion||a.parallaxOcclusion,!0===i.useParallaxOcclusion)&&(i.parallaxScaleBias*=.5),UNITY.Utilities.HasOwnProperty(c,"unlit")&&(c.unlit=null!=a.unlitMaterial&&a.unlitMaterial),UNITY.Utilities.HasOwnProperty(c,"wireframe")&&(c.wireframe=null!=a.useWireframe&&a.useWireframe),UNITY.Utilities.HasOwnProperty(c,"disableLighting")&&(c.disableLighting=null!=a.disableLighting&&a.disableLighting),UNITY.Utilities.HasOwnProperty(c,"maxSimultaneousLights")&&(c.maxSimultaneousLights=null!=a.maxSimultaneousLights?a.maxSimultaneousLights:4),UNITY.Utilities.HasOwnProperty(c,"needDepthPrePass")&&(c.needDepthPrePass=null!=a.depthPrepass&&a.depthPrepass),UNITY.Utilities.HasOwnProperty(c,"lightmapTexture")&&a.lightmapTexture&&(l=a.lightmapTexture.nonColorData=!0,UNITY.Utilities.HasOwnProperty(c,"useLightmapAsShadowmap")&&(l=null==a.useLightmapAsShadowmap||a.useLightmapAsShadowmap),(e=null)!=(e=0<=(s=null!=a.lightmapTexture.index?a.lightmapTexture.index:-1)?this._getCachedLightmapByIndex(s):e)?(c.lightmapTexture=e,c.useLightmapAsShadowmap=l,UNITY.Utilities.HasOwnProperty(c,"ambientColor")&&(c.ambientColor=BABYLON.Color3.White())):n.push(this._loader.loadTextureInfoAsync(o+"/lightmapTexture",a.lightmapTexture,function(e){e.name="assets/LightmapTexture-".concat(s),e.level=a.lightmapLevel||1;var t=e;!0==(null!=UNITY.SceneManager.GlobalOptions.ktxlightmaps&&!0===UNITY.SceneManager.GlobalOptions.ktxlightmaps)?e.gammaSpace=!0:(e.gammaSpace=!1,t.onLoadObservable.addOnce(function(){t.isReady()?t.isRGBD=!0:BABYLON.Tools.Warn("Failed to register texture as RGBD: "+t.name)})),c.lightmapTexture=e,0<=s&&null!=r._lightmapMap&&(r._lightmapMap.has(s)||r._lightmapMap.set(s,t)),c.useLightmapAsShadowmap=l,UNITY.Utilities.HasOwnProperty(c,"ambientColor")&&(c.ambientColor=BABYLON.Color3.White())}))),i instanceof BABYLON.PBRMaterial&&a.detailMapTexture&&n.push(this._loader.loadTextureInfoAsync(o+"/detailMapTexture",a.detailMapTexture,function(e){e.name="".concat(i.name," (Detail Map)"),e.level=1,i.detailMap.texture=e,i.detailMap.bumpLevel=a.detailBumpLevel||1,i.detailMap.diffuseBlendLevel=a.detailBlendLevel||.75,i.detailMap.roughnessBlendLevel=a.detailRoughLevel||.5,i.detailMap.isEnabled=!0})),UNITY.SceneManager.GetRenderQuality()),e=e===UNITY.RenderQuality.High||e===UNITY.RenderQuality.Medium;if(!0==e&&UNITY.Utilities.HasOwnProperty(c,"reflectionColor")&&(c.reflectionColor=null!=a&&a.reflectionColorFactor?BABYLON.Color3.FromArray(a.reflectionColorFactor):BABYLON.Color3.White()),!0==e&&UNITY.Utilities.HasOwnProperty(c,"reflectionTexture")&&a.reflectionCubemapInfo&&(u=-1<(u=(e=(this._loader._rootUrl+a.reflectionCubemapInfo.rooturl+a.reflectionCubemapInfo.name).toLowerCase()).lastIndexOf("."))?e.substring(u).toLowerCase():"",(t=new CubeTextureLoader).name="assets/"+a.reflectionCubemapInfo.name,t.mapkey=e,t.material=c,t.extension=u,t.prefiltered=!0,a.reflectionCubemapInfo.boundingBoxSize&&(t.boundingBoxSize=BABYLON.Vector3.FromArray(a.reflectionCubemapInfo.boundingBoxSize),t.name+=" ("+t.boundingBoxSize.x.toString()+" "+t.boundingBoxSize.y.toString()+" "+t.boundingBoxSize.z.toString()+")",t.mapkey+="_"+t.boundingBoxSize.x.toString()+"_"+t.boundingBoxSize.y.toString()+"_"+t.boundingBoxSize.z.toString()),a.reflectionCubemapInfo.boundingBoxPosition&&(t.boundingBoxPosition=BABYLON.Vector3.FromArray(a.reflectionCubemapInfo.boundingBoxPosition),t.name+=" ("+t.boundingBoxPosition.x.toString()+" "+t.boundingBoxPosition.y.toString()+" "+t.boundingBoxPosition.z.toString()+")",t.mapkey+="_"+t.boundingBoxPosition.x.toString()+"_"+t.boundingBoxPosition.y.toString()+"_"+t.boundingBoxPosition.z.toString()),null==(u=this._reflectionMap[e])?this._reflectionMap[e]=u=[t]:u.push(t)),UNITY.Utilities.HasOwnProperty(c,"terrainInfo")&&(c.terrainInfo=null!=a.terrainInfo?a.terrainInfo:null),UNITY.Utilities.HasOwnProperty(i,"universalMaterial")){var d,p,h,m=i;if(a.customTextures){var g=this;for(_ in a.customTextures)!function(t){var e=a.customTextures[t];null!=e&&(m.checkSampler(t),n.push(g._loader.loadTextureInfoAsync(o+"/"+t,e,function(e){e.name="".concat(i.name,"detailsSampler"===t||"normalsSampler"===t?" (Atlas)":" (Custom)"),m.setTexture(t,e,!0)})))}(_)}if(a.customVectors)for(var f in a.customVectors)null!=(d=a.customVectors[f])&&m.setVector4(f,BABYLON.Vector4.FromArray(d),!0);if(a.customColors)for(var y in a.customColors)null!=(p=a.customColors[y])&&m.setVector4(y,BABYLON.Vector4.FromArray(p),!0);if(a.customFloats)for(var v in a.customFloats)null!=(h=a.customFloats[v])&&m.setFloat(v,h,!0)}else{if(a.customTextures){var _,B=this;for(_ in a.customTextures)!function(t){var e=a.customTextures[t];null!=e&&UNITY.Utilities.HasOwnProperty(c,t)&&n.push(B._loader.loadTextureInfoAsync(o+"/"+t,e,function(e){e.name="".concat(i.name,"detailsSampler"===t||"normalsSampler"===t?" (Atlas)":" (Custom)"),c[t]=e}))}(_)}if(a.customVectors)for(var f in a.customVectors)null!=(d=a.customVectors[f])&&UNITY.Utilities.HasOwnProperty(c,f)&&(c[f]=BABYLON.Vector4.FromArray(d));if(a.customColors)for(var y in a.customColors)null!=(p=a.customColors[y])&&UNITY.Utilities.HasOwnProperty(c,y)&&(c[y]instanceof BABYLON.Vector4?c[y]=BABYLON.Vector4.FromArray(p):c[y]instanceof BABYLON.Color4?c[y]=BABYLON.Color4.FromArray(p):c[y]=BABYLON.Color3.FromArray(p));if(a.customFloats)for(var v in a.customFloats)null!=(h=a.customFloats[v])&&UNITY.Utilities.HasOwnProperty(c,v)&&(c[v]instanceof Boolean?c[v]=0<h:c[v]=h)}null!=a.freezeMaterial&&!0===a.freezeMaterial&&null!=this._shaderList&&this._shaderList.push(i)}},e.ScriptBundleCache={},e}(),CVTOOLS_babylon_mesh=function(){function e(e){this.name=CVTOOLS_MESH,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_MESH),this.order=101}return e.prototype.dispose=function(){delete this._loader},e}(),CVTOOLS_left_handed=function(){function e(e){this.name=CVTOOLS_HAND,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_HAND),this.order=102}return e.prototype.dispose=function(){delete this._loader},e}(),__extends=(BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_NAME,function(e){return new CVTOOLS_unity_metadata(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_MESH,function(e){return new CVTOOLS_babylon_mesh(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_HAND,function(e){return new CVTOOLS_left_handed(e)}),BABYLON.SceneLoader.OnPluginActivatedObservable.add(function(e){"gltf"===e.name&&e instanceof BABYLON.GLTFFileLoader&&(e.animationStartMode=UNITY.SceneManager.AnimationStartMode,e.targetFps=UNITY.SceneManager.AnimationTargetFps,e.onSkinLoadedObservable.add(function(e){if(null!=e){try{null!=e.skinnedNode&&(e.skinnedNode.id+=".Skin")}catch(e){console.warn(e)}try{null!=e.skinnedNode&&(e.skinnedNode.name+=".Skin")}catch(e){console.warn(e)}try{var t;null!=e.node&&null!=e.skinnedNode&&(null!=(t=BABYLON.Tags.GetTags(e.node))&&BABYLON.Tags.AddTagsTo(e.skinnedNode,t),e.node._skinnedMesh=e.skinnedNode)}catch(e){console.warn(e)}}}))}),this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}()),__extends=(!function(M){t=M.ScriptComponent,__extends(n,t),n.prototype.awakened=function(){return this._awakened},n.prototype.initialized=function(){return this._initialized},n.prototype.hasRootMotion=function(){return this._hasrootmotion},n.prototype.isFirstFrame=function(){return 0===this._frametime},n.prototype.isLastFrame=function(){return.985<=this._frametime},n.prototype.ikFrameEnabled=function(){return this._ikFrameEanbled},n.prototype.getAnimationTime=function(){return this._frametime},n.prototype.getFrameLoopTime=function(){return this._looptime},n.prototype.getFrameLoopBlend=function(){return this._loopblend},n.prototype.getAnimationPlaying=function(){return this._animationplaying},n.prototype.getRuntimeController=function(){return this._runtimecontroller},n.prototype.getRootBoneTransform=function(){return this._rootBoneTransform},n.prototype.getDeltaRootMotionAngle=function(){return this._angularVelocity.y},n.prototype.getDeltaRootMotionSpeed=function(){return this._rootMotionSpeed},n.prototype.getDeltaRootMotionPosition=function(){return this._deltaPosition},n.prototype.getDeltaRootMotionRotation=function(){return this._deltaRotation},n.prototype.getFixedRootMotionPosition=function(){return null!=this._dirtyMotionMatrix?this._rootMotionPosition:null},n.prototype.getFixedRootMotionRotation=function(){return null!=this._dirtyMotionMatrix?this._rootMotionRotation:null},n.prototype.awake=function(){this.awakeStateMachine()},n.prototype.update=function(){this.updateStateMachine()},n.prototype.destroy=function(){this.destroyStateMachine()},n.prototype.playDefaultAnimation=function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=null);var o,i=!1;return!0===this._initialized?null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>t?(o=null!=(t=this._machine.layers[t]).animationStateMachine&&t.animationStateMachine.rate||M.AnimationState.FPS,n=0<e?M.Utilities.ComputeBlendingSpeed(n||o,e):0,this.playCurrentAnimationState(t,t.entry,n),i=!0):BABYLON.Tools.Warn("No animation state layers on "+this.transform.name):BABYLON.Tools.Warn("Animation state machine not initialized for "+this.transform.name),i},n.prototype.playAnimation=function(e,t,n,o){void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=null);var i,r=!1;return!0===this._initialized?null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>n?(i=null!=(n=this._machine.layers[n]).animationStateMachine&&n.animationStateMachine.rate||M.AnimationState.FPS,o=0<t?M.Utilities.ComputeBlendingSpeed(o||i,t):0,this.playCurrentAnimationState(n,e,o),r=!0):BABYLON.Tools.Warn("No animation state layers on "+this.transform.name):BABYLON.Tools.Warn("Animation state machine not initialized for "+this.transform.name),r},n.prototype.stopAnimation=function(e){void 0===e&&(e=0);var t=!1;return!0===this._initialized?null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>e?(e=this._machine.layers[e],this.stopCurrentAnimationState(e),t=!0):BABYLON.Tools.Warn("No animation state layers on "+this.transform.name):BABYLON.Tools.Warn("Animation state machine not initialized for "+this.transform.name),t},n.prototype.hasBool=function(e){return null!=this._booleans.get(e)},n.prototype.getBool=function(e){return this._booleans.get(e)||!1},n.prototype.setBool=function(e,t){this._booleans.set(e,t)},n.prototype.hasFloat=function(e){return null!=this._numbers.get(e)},n.prototype.getFloat=function(e){return this._numbers.get(e)||0},n.prototype.setFloat=function(e,t){this._numbers.set(e,t)},n.prototype.hasInteger=function(e){return null!=this._numbers.get(e)},n.prototype.getInteger=function(e){return this._numbers.get(e)||0},n.prototype.setInteger=function(e,t){this._numbers.set(e,t)},n.prototype.hasTrigger=function(e){return null!=this._triggers.get(e)},n.prototype.getTrigger=function(e){return this._triggers.get(e)||!1},n.prototype.setTrigger=function(e){this._triggers.set(e,!0)},n.prototype.resetTrigger=function(e){this._triggers.set(e,!1)},n.prototype.setSmoothFloat=function(e,t,n,o){var i=this._timers.get(e)||-1,r=this._starts.get(e)||null,a=this._stops.get(e)||null;(i=null!=a&&null!=t&&a!=t?-1:i)<0&&(i=0,a=r=null),null==r&&(r=this.getFloat(e)),null==a&&(a=t),0<=i&&null!=r&&null!=a&&(t=0,i<n?(t=BABYLON.Scalar.Lerp(r,a,i/n),i+=o):(t=a,i=-1,a=r=null),this._numbers.set(e,t)),this._timers.set(e,i),this._starts.set(e,r),this._stops.set(e,a)},n.prototype.setSmoothInteger=function(e,t,n,o){this.setSmoothFloat(e,t,n,o)},n.prototype.resetSmoothProperty=function(e){this._timers.delete(e),this._starts.delete(e),this._stops.delete(e),this._numbers.delete(e)},n.prototype.getMachineState=function(e){return this._data.get(e)},n.prototype.setMachineState=function(e,t){this._data.set(e,t)},n.prototype.getCurrentState=function(e){return null!=this._machine.layers&&this._machine.layers.length>e?this._machine.layers[e].animationStateMachine:null},n.prototype.getDefaultClips=function(){return this._clips},n.prototype.getDefaultSource=function(){return this._source},n.prototype.fixAnimationGroup=function(e){var t=null;if(null!=this._clips&&0<this._clips.length)for(var n=0;n<this._clips.length;n++){var o=this._clips[n];if(null!=o.clip){var i=("."+o.clip).toLowerCase();if(e.name.toLowerCase().endsWith(i)){null==e.metadata&&(e.metadata={}),null==e.metadata.unity&&(e.metadata.unity=o),e.metadata.unity.source=this._source,t=o;break}}}return t},n.prototype.getAnimationGroup=function(e){return this._anims.get(e)},n.prototype.getAnimationGroups=function(){return this.sourceAnimationGroups},n.prototype.setAnimationGroups=function(e){null==this.transform.metadata&&(this.transform.metadata={}),null==this.transform.metadata.unity&&(this.transform.metadata.unity={}),this.transform.metadata.unity.sourceAnimationGroups=e,this.setupSourceAnimationGroups()},n.prototype.updateAnimationGroups=function(e){var s=this;null!=e&&0<e.length&&(this._anims=new Map,this.m_animationTargets=[],this.m_defaultGroup=null,this.sourceAnimationGroups=null,e.forEach(function(e){var t=!1,n=e;if(!0===(t=null!=n&&null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.source&&""!==n.metadata.unity.source&&n.metadata.unity.source===s._source?!0:t)&&null!=n&&null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.clip&&""!==n.metadata.unity.clip){try{e.stop()}catch(e){}null==s.sourceAnimationGroups&&(s.sourceAnimationGroups=[]),s.sourceAnimationGroups.push(e),s._anims.set(n.metadata.unity.clip,e),null==s.m_defaultGroup&&(s.m_defaultGroup=e),null!=e.targetedAnimations&&0<e.targetedAnimations.length&&e.targetedAnimations.forEach(function(e){for(var t=-1,n=0;n<s.m_animationTargets.length;n++)if(s.m_animationTargets[n].target===e.target){t=n;break}if(t<0)if(s.m_animationTargets.push(e),null==e.target.metadata&&(e.target.metadata={}),e.target instanceof BABYLON.TransformNode){M.Utilities.ValidateTransformQuaternion(e.target);for(var o=[],i=0;i<s._layercount;i++){var r=new M.AnimationMixer;r.positionBuffer=null,r.rotationBuffer=null,r.scalingBuffer=null,r.originalMatrix=null,r.blendingFactor=0,r.blendingSpeed=0,r.rootPosition=null,r.rootRotation=null,o.push(r)}e.target.metadata.mixer=o}else if(e.target instanceof BABYLON.MorphTarget){for(var a=[],i=0;i<s._layercount;i++){var l=new M.AnimationMixer;l.influenceBuffer=null,a.push(l)}e.target.metadata.mixer=a}})}}))},n.prototype.awakeStateMachine=function(){var r=this;M.Utilities.ValidateTransformQuaternion(this.transform),this.m_animationTargets=[],this.m_defaultGroup=null,this.m_rotationIdentity=BABYLON.Quaternion.Identity(),this._source=null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.animator&&""!==this.transform.metadata.unity.animator?this.transform.metadata.unity.animator:null,this._clips=this.getProperty("clips",this._clips),this._machine=this.getProperty("machine",this._machine),this._updatemode=this.getProperty("updatemode",this._updatemode),this._animationrig=this.getProperty("animationrig",this._animationrig),this._animationmode=this.getProperty("animationmode",this._animationmode),this._hasrootmotion=this.getProperty("hasrootmotion",this._hasrootmotion),this._runtimecontroller=this.getProperty("runtimecontroller",this._runtimecontroller),this._hastransformhierarchy=this.getProperty("hastransformhierarchy",this._hastransformhierarchy),this._leftfeetbottomheight=this.getProperty("leftfeetbottomheight",this._leftfeetbottomheight),this._rightfeetbottomheight=this.getProperty("rightfeetbottomheight",this._rightfeetbottomheight),this.applyRootMotion=this.getProperty("applyrootmotion",this.applyRootMotion),null!=this._machine&&(null!=this._machine.owner&&null!=this._machine.owner&&""!==this._machine.owner&&"*"!==this._machine.owner||(this._machine.owner=(null!=this.transform.parent?this.transform.parent:this.transform).name),null!=this._machine.speed&&(this.speedRatio=this._machine.speed),null!=this._machine.parameters&&0<this._machine.parameters.length&&this._machine.parameters.forEach(function(e){var t=e.name,n=e.type,o=(e.curve,e.defaultFloat),i=e.defaultBool,e=e.defaultInt;r._parameters.set(t,n),n===M.AnimatorParameterType.Bool?r.setBool(t,i):n===M.AnimatorParameterType.Float?r.setFloat(t,o):n===M.AnimatorParameterType.Int?r.setInteger(t,e):n===M.AnimatorParameterType.Trigger&&r.resetTrigger(t)}),null!=this._machine.layers)&&0<this._machine.layers.length&&(this._layercount=this._machine.layers.length,this._machine.layers.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this._machine.layers.forEach(function(e){if(null!=e.owner&&null!=e.owner&&""!==e.owner&&e.owner,e.animationMaskMap=new Map,null!=e.avatarMask&&null!=e.avatarMask.transformPaths&&0<e.avatarMask.transformPaths.length)for(var t=0;t<e.avatarMask.transformPaths.length;t++)e.animationMaskMap.set(e.avatarMask.transformPaths[t],t)})),this._awakened=!0,this.onAnimationAwakeObservable&&this.onAnimationAwakeObservable.hasObservers()&&this.onAnimationAwakeObservable.notifyObservers(this.transform)},n.prototype.updateStateMachine=function(e){var t=this;void 0===e&&(e=null),(!1===this.delayUpdateUntilReady||!0===this.delayUpdateUntilReady&&this.isReady())&&(null==this.sourceAnimationGroups&&this.setupSourceAnimationGroups(),null!=this.sourceAnimationGroups)&&(!1===this._executed&&(this._executed=!0,null!=this._machine.layers&&0<this._machine.layers.length&&this._machine.layers.forEach(function(e){t.playCurrentAnimationState(e,e.entry,0)}),this._initialized=!0,this.onAnimationInitObservable)&&this.onAnimationInitObservable.hasObservers()&&this.onAnimationInitObservable.notifyObservers(this.transform),!0===this.enableAnimation)&&(e=e||this.getDeltaSeconds(),this.updateAnimationState(e),this.updateAnimationTargets(e),this.onAnimationUpdateObservable)&&this.onAnimationUpdateObservable.hasObservers()&&this.onAnimationUpdateObservable.notifyObservers(this.transform)},n.prototype.setupSourceAnimationGroups=function(){var e=this,t=null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.sourceAnimationGroups?this.transform.metadata.unity.sourceAnimationGroups:null;null!=t&&(this.updateAnimationGroups(t),null!=this.sourceAnimationGroups)&&null!=this._machine&&null!=this._machine.states&&0<this._machine.states.length&&this._machine.states.forEach(function(t){null!=t&&null!=t.name&&(null!=t.ccurves&&0<t.ccurves.length&&t.ccurves.forEach(function(e){null!=e.animation&&null!=(e=BABYLON.Animation.Parse(e.animation))&&(null==t.tcurves&&(t.tcurves=[]),t.tcurves.push(e))}),e.setupTreeBranches(t.blendtree),e.setMachineState(t.name,t))})},n.prototype.destroyStateMachine=function(){this._data=null,this._clips=null,this._anims=null,this._numbers=null,this._booleans=null,this._triggers=null,this._parameters=null,this._checkers=null,this._machine=null,this.sourceAnimationGroups=null,this.onAnimationAwakeObservable.clear(),this.onAnimationAwakeObservable=null,this.onAnimationInitObservable.clear(),this.onAnimationInitObservable=null,this.onAnimationIKObservable.clear(),this.onAnimationIKObservable=null,this.onAnimationEndObservable.clear(),this.onAnimationEndObservable=null,this.onAnimationLoopObservable.clear(),this.onAnimationLoopObservable=null,this.onAnimationEventObservable.clear(),this.onAnimationEventObservable=null,this.onAnimationUpdateObservable.clear(),this.onAnimationUpdateObservable=null,this.onAnimationTransitionObservable.clear(),this.onAnimationTransitionObservable=null},n.prototype.updateAnimationState=function(t){var n=this;null!=this._machine.layers&&0<this._machine.layers.length&&this._machine.layers.forEach(function(e){n.checkStateMachine(e,t)})},n.prototype.updateAnimationTargets=function(A){var O=this;this._looptime=!1,this._loopblend=!1,this._ikFrameEanbled=!1,this._animationplaying=!1,null!=this._machine.layers&&0<this._machine.layers.length&&this._machine.layers.forEach(function(i){if(0===i.index&&(O._frametime=i.animationTime),null!=i.animationStateMachine&&null!=i.animationStateMachine.blendtree){!0===i.animationStateMachine.iKOnFeet&&(O._ikFrameEanbled=!0),!0===i.iKPass&&O.onAnimationIKObservable&&O.onAnimationIKObservable.hasObservers()&&O.onAnimationIKObservable.notifyObservers(i.index);var e=i.animationStateMachine;if(e.type===M.MotionType.Clip&&-1!==e.played&&(e.played+=A),null!=e.blendtree.children&&0<e.blendtree.children.length){var t=e.blendtree.children[0];if(null!=t)if(e.blendtree.blendType==M.BlendTreeType.Clip){var n,r,a,o,l,s,u,c,d,p,t=t.track;null!=t&&(s=t.metadata.unity.length,g=M.AnimationState.TIME/s,i.animationTime+=A*g*Math.abs(e.speed)*Math.abs(O.speedRatio)*M.AnimationState.SPEED,i.animationTime>M.AnimationState.TIME&&(i.animationTime=M.AnimationState.TIME),i.animationNormal=0<i.animationTime?BABYLON.Scalar.Clamp(i.animationTime/M.AnimationState.TIME,0,1):0,f=.99<=i.animationNormal?1:i.animationNormal,n=parseFloat(f.toFixed(3)),e.speed<0&&(i.animationNormal=1-i.animationNormal),r=s*i.animationNormal,h=s=!1,p=d=c=!(u=l=o=a=0),null!=t.metadata&&null!=t.metadata.unity&&(null!=t.metadata.unity.averagespeed&&(o=null!=t.metadata.unity.averagespeed.x?t.metadata.unity.averagespeed.x:0,l=null!=t.metadata.unity.averagespeed.z?t.metadata.unity.averagespeed.z:0),null!=t.metadata.unity.settings)&&(a=null!=t.metadata.unity.settings.level?t.metadata.unity.settings.level:0,s=null!=t.metadata.unity.settings.looptime&&t.metadata.unity.settings.looptime,h=null!=t.metadata.unity.settings.loopblend&&t.metadata.unity.settings.loopblend,u=null!=t.metadata.unity.settings.orientationoffsety?t.metadata.unity.settings.orientationoffsety:0,c=null==t.metadata.unity.settings.loopblendorientation||t.metadata.unity.settings.loopblendorientation,d=null==t.metadata.unity.settings.loopblendpositiony||t.metadata.unity.settings.loopblendpositiony,p=null==t.metadata.unity.settings.loopblendpositionxz||t.metadata.unity.settings.loopblendpositionxz),0===i.index&&(O._looptime=s,O._loopblend=h),u=BABYLON.Tools.ToRadians(u),o=Math.abs(o),l=Math.abs(l),a*=-1,i.animationTime>=M.AnimationState.TIME&&(i.animationFirstRun=!1,(i.animationLoopFrame=!0)===s?(i.animationLoopCount++,O.onAnimationLoopObservable&&O.onAnimationLoopObservable.hasObservers()&&O.onAnimationLoopObservable.notifyObservers(i.index)):!1===i.animationEndFrame&&(i.animationEndFrame=!0,O.onAnimationEndObservable)&&O.onAnimationEndObservable.hasObservers()&&O.onAnimationEndObservable.notifyObservers(i.index)),!0!==i.animationFirstRun&&!0!==s||(O._animationplaying=!0,t.targetedAnimations.forEach(function(e){var t,n,o;e.target instanceof BABYLON.TransformNode?(o=e.target,0!==i.index&&null!=i.avatarMask&&!O.filterTargetAvatarMask(i,o)||(!0===(t=null!=o.metadata&&null!=o.metadata.unity&&null!=o.metadata.unity.rootbone&&o.metadata.unity.rootbone)&&null==O._rootBoneTransform&&(O._rootBoneTransform=o),null==o.metadata)||null==o.metadata.mixer||null==(o=o.metadata.mixer[i.index])||("position"===e.animation.targetProperty?(O._targetPosition=M.Utilities.SampleAnimationVector3(e.animation,r,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===t&&null!=O._rootBoneTransform?(O._positionWeight=!0,O._positionHolder.set(0,0,0),O._rootBoneWeight=!1,O._rootBoneHolder.set(0,0,0),!0!==O.applyRootMotion||!0===d&&!0===p?(O._positionWeight=!0,O._positionHolder.set(O._targetPosition.x,O._targetPosition.y+a,O._targetPosition.z)):!1===d&&!1===p?(O._rootBoneWeight=!0,O._rootBoneHolder.set(O._targetPosition.x,O._targetPosition.y+a,O._targetPosition.z)):!0===d&&!1===p?(O._positionWeight=!0,O._positionHolder.set(O.m_zeroVector.x,O._targetPosition.y+a,O.m_zeroVector.z),O._rootBoneWeight=!0,O._rootBoneHolder.set(O._targetPosition.x,O.m_zeroVector.y,O._targetPosition.z)):!0===p&&!1===d&&(O._positionWeight=!0,O._positionHolder.set(O._targetPosition.x,O.m_zeroVector.y,O._targetPosition.z),O._rootBoneWeight=!0,O._rootBoneHolder.set(O.m_zeroVector.x,O._targetPosition.y+a,O.m_zeroVector.z)),!0===O._positionWeight&&(null==o.positionBuffer&&(o.positionBuffer=new BABYLON.Vector3(0,0,0)),M.Utilities.BlendVector3Value(o.positionBuffer,O._positionHolder,1)),!0===O._rootBoneWeight&&(null==o.rootPosition&&(o.rootPosition=new BABYLON.Vector3(0,0,0)),M.Utilities.BlendVector3Value(o.rootPosition,O._rootBoneHolder,1))):(null==o.positionBuffer&&(o.positionBuffer=new BABYLON.Vector3(0,0,0)),M.Utilities.BlendVector3Value(o.positionBuffer,O._targetPosition,1))):"rotationQuaternion"===e.animation.targetProperty?(O._targetRotation=M.Utilities.SampleAnimationQuaternion(e.animation,r,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===t&&null!=O._rootBoneTransform?(O._rotationWeight=!1,O._rotationHolder.copyFrom(O.m_rotationIdentity),O._rootQuatWeight=!1,O._rootQuatHolder.copyFrom(O.m_rotationIdentity),n=(t=O._targetRotation.toEulerAngles()).y,!0!==O.applyRootMotion||!0===c?(O._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(t.x,n+u,t.z,O._rotationHolder)):(O._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(t.x,O.m_zeroVector.y,t.z,O._rotationHolder),O._rootQuatWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(O.m_zeroVector.x,n+u,O.m_zeroVector.z,O._rootQuatHolder)),!0===O._rotationWeight&&(null==o.rotationBuffer&&(o.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),M.Utilities.BlendQuaternionValue(o.rotationBuffer,O._rotationHolder,1)),!0===O._rootQuatWeight&&(null==o.rootRotation&&(o.rootRotation=new BABYLON.Quaternion(0,0,0,0)),M.Utilities.BlendQuaternionValue(o.rootRotation,O._rootQuatHolder,1))):(null==o.rotationBuffer&&(o.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),M.Utilities.BlendQuaternionValue(o.rotationBuffer,O._targetRotation,1))):"scaling"===e.animation.targetProperty&&(O._targetScaling=M.Utilities.SampleAnimationVector3(e.animation,r,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==o.scalingBuffer&&(o.scalingBuffer=new BABYLON.Vector3(1,1,1)),M.Utilities.BlendVector3Value(o.scalingBuffer,O._targetScaling,1)))):e.target instanceof BABYLON.MorphTarget&&null!=(t=e.target).metadata&&null!=t.metadata.mixer&&(n=t.metadata.mixer[i.index],"influence"===e.animation.targetProperty)&&(o=M.Utilities.SampleAnimationFloat(e.animation,r,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==n.influenceBuffer&&(n.influenceBuffer=0),n.influenceBuffer=M.Utilities.BlendFloatValue(n.influenceBuffer,o,1))})),1==O._animationplaying&&(null!=i.animationStateMachine.tcurves&&0<i.animationStateMachine.tcurves.length&&i.animationStateMachine.tcurves.forEach(function(e){var t;null!=e.targetProperty&&""!==e.targetProperty&&(t=M.Utilities.SampleAnimationFloat(e,i.animationNormal,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),O.setFloat(e.targetProperty,t))}),null!=i.animationStateMachine.events)&&0<i.animationStateMachine.events.length&&i.animationStateMachine.events.forEach(function(e){var t;n>=e.time-.01&&n<=e.time+.01&&(t=e.function+"_"+e.time,null==i.animationLoopEvents&&(i.animationLoopEvents={}),i.animationLoopEvents[t]||(i.animationLoopEvents[t]=!0,O.onAnimationEventObservable&&O.onAnimationEventObservable.hasObservers()&&O.onAnimationEventObservable.notifyObservers(e)))}),!0===i.animationLoopFrame)&&(i.animationTime=0,i.animationNormal=0,i.animationLoopFrame=!1,i.animationLoopEvents=null)}else{O._animationplaying=!0,O._blendWeights.primary=null,O._blendWeights.secondary=null;var h=[],m=e.blendtree,g=(O.parseTreeBranches(i,m,1,h),O.computeWeightedFrameRatio(h)),f=(i.animationTime+=A*g*Math.abs(e.speed)*Math.abs(O.speedRatio)*M.AnimationState.SPEED,i.animationTime>M.AnimationState.TIME&&(i.animationTime=M.AnimationState.TIME),i.animationNormal=0<i.animationTime?BABYLON.Scalar.Clamp(i.animationTime/M.AnimationState.TIME,0,1):0,.99<=i.animationNormal?1:i.animationNormal),y=parseFloat(f.toFixed(3)),v=(e.speed<0&&(i.animationNormal=1-i.animationNormal),i.animationNormal),_=(i.animationTime>=M.AnimationState.TIME&&(i.animationFirstRun=!1,i.animationLoopFrame=!0,i.animationLoopCount++),null!=h&&0<h.length&&null!=h[0].track?h[0].track:null);if(null!=_)for(var B=_.targetedAnimations.length,b=0;b<B;b++){var C,T,I,S=_.targetedAnimations[b];S.target instanceof BABYLON.TransformNode&&(C=S.target,0!==i.index&&null!=i.avatarMask&&!O.filterTargetAvatarMask(i,C)||(!0===(T=null!=C.metadata&&null!=C.metadata.unity&&null!=C.metadata.unity.rootbone&&C.metadata.unity.rootbone)&&null==O._rootBoneTransform&&(O._rootBoneTransform=C),null==C.metadata)||null==C.metadata.mixer||(O._initialtargetblending=!0,I=C.metadata.mixer[i.index],O.updateBlendableTargets(A,i,m,S,b,I,v,T,C)))}null!=i.animationStateMachine.tcurves&&0<i.animationStateMachine.tcurves.length&&i.animationStateMachine.tcurves.forEach(function(e){var t;null!=e.targetProperty&&""!==e.targetProperty&&(t=M.Utilities.SampleAnimationFloat(e,i.animationNormal,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),O.setFloat(e.targetProperty,t))}),null!=i.animationStateMachine.events&&0<i.animationStateMachine.events.length&&i.animationStateMachine.events.forEach(function(e){var t;y>=e.time-.01&&y<=e.time+.01&&(t=e.function+"_"+e.time,null==i.animationLoopEvents&&(i.animationLoopEvents={}),i.animationLoopEvents[t]||(i.animationLoopEvents[t]=!0,O.onAnimationEventObservable&&O.onAnimationEventObservable.hasObservers()&&O.onAnimationEventObservable.notifyObservers(e)))}),!0===i.animationLoopFrame&&(i.animationTime=0,i.animationNormal=0,i.animationLoopFrame=!1,i.animationLoopEvents=null)}}}}),this.finalizeAnimationTargets(A)},n.prototype.updateBlendableTargets=function(e,t,n,o,i,r,a,l,s){if(null!=r&&null!=n.children&&0<n.children.length)for(var u=0;u<n.children.length;u++){var c,d,p,h,m,g,f,y,v,_=n.children[u];0<_.weight&&(_.type===M.MotionType.Clip?null!=_.track&&(g=!1,v=h=p=!(d=f=y=c=0),null!=(m=_.track).metadata&&null!=m.metadata.unity&&(null!=m.metadata.unity.averagespeed&&(y=null!=m.metadata.unity.averagespeed.x?m.metadata.unity.averagespeed.x:0,f=null!=m.metadata.unity.averagespeed.z?m.metadata.unity.averagespeed.z:0),null!=m.metadata.unity.settings)&&(c=null!=m.metadata.unity.settings.level?m.metadata.unity.settings.level:0,g=null!=m.metadata.unity.settings.loopblend&&m.metadata.unity.settings.loopblend,d=null!=m.metadata.unity.settings.orientationoffsety?m.metadata.unity.settings.orientationoffsety:0,p=null==m.metadata.unity.settings.loopblendorientation||m.metadata.unity.settings.loopblendorientation,h=null==m.metadata.unity.settings.loopblendpositiony||m.metadata.unity.settings.loopblendpositiony,v=null==m.metadata.unity.settings.loopblendpositionxz||m.metadata.unity.settings.loopblendpositionxz),0===t.index&&(this._looptime=!0,this._loopblend=g),d=BABYLON.Tools.ToRadians(d),y=Math.abs(y),f=Math.abs(f),c*=-1,m=_.track.targetedAnimations[i],g=!0===this._initialtargetblending?1:parseFloat(_.weight.toFixed(2)),this._initialtargetblending=!1,m.target===o.target&&m.animation.targetProperty===o.animation.targetProperty?(y=a,_.timescale<0&&(y=1-a),f=_.track.metadata.unity.length*y,"position"===o.animation.targetProperty?(this._targetPosition=M.Utilities.SampleAnimationVector3(m.animation,f,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===l&&null!=this._rootBoneTransform?(this._positionWeight=!0,this._positionHolder.set(0,0,0),this._rootBoneWeight=!1,this._rootBoneHolder.set(0,0,0),!0!==this.applyRootMotion||!0===h&&!0===v?(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+c,this._targetPosition.z)):!1===h&&!1===v?(this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this._targetPosition.y+c,this._targetPosition.z)):!0===h&&!1===v?(this._positionWeight=!0,this._positionHolder.set(this.m_zeroVector.x,this._targetPosition.y+c,this.m_zeroVector.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this.m_zeroVector.y,this._targetPosition.z)):!0===v&&!1===h&&(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this.m_zeroVector.y,this._targetPosition.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(this.m_zeroVector.x,this._targetPosition.y+c,this.m_zeroVector.z)),!0===this._positionWeight&&(null==r.positionBuffer&&(r.positionBuffer=new BABYLON.Vector3(0,0,0)),M.Utilities.BlendVector3Value(r.positionBuffer,this._positionHolder,g)),!0===this._rootBoneWeight&&(null==r.rootPosition&&(r.rootPosition=new BABYLON.Vector3(0,0,0)),M.Utilities.BlendVector3Value(r.rootPosition,this._rootBoneHolder,g))):(null==r.positionBuffer&&(r.positionBuffer=new BABYLON.Vector3(0,0,0)),M.Utilities.BlendVector3Value(r.positionBuffer,this._targetPosition,g))):"rotationQuaternion"===o.animation.targetProperty?(this._targetRotation=M.Utilities.SampleAnimationQuaternion(m.animation,f,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),!0===l&&null!=this._rootBoneTransform?(this._rotationWeight=!1,this._rotationHolder.copyFrom(this.m_rotationIdentity),this._rootQuatWeight=!1,this._rootQuatHolder.copyFrom(this.m_rotationIdentity),v=(y=this._targetRotation.toEulerAngles()).y,!0!==this.applyRootMotion||!0===p?(this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(y.x,v+d,y.z,this._rotationHolder)):(this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(y.x,this.m_zeroVector.y,y.z,this._rotationHolder),this._rootQuatWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(this.m_zeroVector.x,v+d,this.m_zeroVector.z,this._rootQuatHolder)),!0===this._rotationWeight&&(null==r.rotationBuffer&&(r.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),M.Utilities.BlendQuaternionValue(r.rotationBuffer,this._rotationHolder,g)),!0===this._rootQuatWeight&&(null==r.rootRotation&&(r.rootRotation=new BABYLON.Quaternion(0,0,0,0)),M.Utilities.BlendQuaternionValue(r.rootRotation,this._rootQuatHolder,g))):(null==r.rotationBuffer&&(r.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),M.Utilities.BlendQuaternionValue(r.rotationBuffer,this._targetRotation,g))):"scaling"===o.animation.targetProperty&&(this._targetScaling=M.Utilities.SampleAnimationVector3(m.animation,f,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==r.scalingBuffer&&(r.scalingBuffer=new BABYLON.Vector3(1,1,1)),M.Utilities.BlendVector3Value(r.scalingBuffer,this._targetScaling,g))):BABYLON.Tools.Warn(n.name+" - "+_.track.name+" blend tree mismatch ("+i+"): "+o.target.name+" >>> "+m.target.name)):_.type===M.MotionType.Tree&&this.updateBlendableTargets(e,t,_.subtree,o,i,r,a,l,s))}},n.prototype.finalizeAnimationTargets=function(e){var t,o=this;this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),null!=this.m_animationTargets&&0<this.m_animationTargets.length&&this.m_animationTargets.forEach(function(e){var n=e.target;null!=n.metadata&&null!=n.metadata.mixer&&null!=o._machine.layers&&0<o._machine.layers.length&&(o._blenderMatrix.reset(),o._dirtyBlenderMatrix=null,o._machine.layers.forEach(function(e){var t=n.metadata.mixer[e.index];null!=t&&(n instanceof BABYLON.TransformNode?(null==t.positionBuffer&&null==t.rotationBuffer&&null==t.scalingBuffer||(BABYLON.Matrix.ComposeToRef(t.scalingBuffer||n.scaling,t.rotationBuffer||n.rotationQuaternion,t.positionBuffer||n.position,o._updateMatrix),0<t.blendingSpeed&&(t.blendingFactor<=1&&null==t.originalMatrix&&(t.originalMatrix=BABYLON.Matrix.Compose(n.scaling,n.rotationQuaternion,n.position)),t.blendingFactor<=1)&&null!=t.originalMatrix&&(M.Utilities.FastMatrixSlerp(t.originalMatrix,o._updateMatrix,t.blendingFactor,o._updateMatrix),t.blendingFactor+=t.blendingSpeed),M.Utilities.FastMatrixSlerp(o._blenderMatrix,o._updateMatrix,e.defaultWeight,o._blenderMatrix),o._dirtyBlenderMatrix=!0,t.positionBuffer=null,t.rotationBuffer=null,t.scalingBuffer=null),null==t.rootPosition&&null==t.rootRotation||(BABYLON.Matrix.ComposeToRef(o._emptyScaling,t.rootRotation||o._emptyRotation,t.rootPosition||o._emptyPosition,o._updateMatrix),M.Utilities.FastMatrixSlerp(o._rootMotionMatrix,o._updateMatrix,e.defaultWeight,o._rootMotionMatrix),o._dirtyMotionMatrix=!0,t.rootPosition=null,t.rootRotation=null)):n instanceof BABYLON.MorphTarget&&null!=t.influenceBuffer&&(n.influence=BABYLON.Scalar.Lerp(n.influence,t.influenceBuffer,e.defaultWeight),t.influenceBuffer=null))}),null!=o._dirtyBlenderMatrix)&&o._blenderMatrix.decompose(n.scaling,n.rotationQuaternion,n.position)}),!0===this.applyRootMotion&&null!=this._dirtyMotionMatrix&&(this._rootMotionMatrix.decompose(this._rootMotionScaling,this._rootMotionRotation,this._rootMotionPosition),!0===this.isFirstFrame()?(this._deltaPosition.copyFrom(this._rootMotionPosition),this._deltaRotation.copyFrom(this._rootMotionRotation)):!0===this.isLastFrame()?(this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),M.Utilities.QuaternionDiffToRef(this._rootMotionRotation,this._lastMotionRotation,this._deltaRotation),!0===this._looptime&&!0===this._loopblend&&(0!==(t=this._loopMotionSpeed+this._lastMotionSpeed)&&(t/=2),this._deltaPosition.normalize(),this._deltaPosition.scaleInPlace(t*e),0!==(t=this._loopRotateSpeed+this._lastRotateSpeed)&&(t/=2),this._deltaRotation.toEulerAnglesToRef(this._angularVelocity),BABYLON.Quaternion.FromEulerAnglesToRef(this._angularVelocity.x,t,this._angularVelocity.z,this._deltaRotation))):(this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),M.Utilities.QuaternionDiffToRef(this._rootMotionRotation,this._lastMotionRotation,this._deltaRotation)),t=this._deltaPosition.length(),this._rootMotionSpeed=0<t?t/e:t,this._deltaRotation.toEulerAnglesToRef(this._angularVelocity),this._lastMotionPosition.copyFrom(this._rootMotionPosition),this._lastMotionRotation.copyFrom(this._rootMotionRotation),this._lastMotionSpeed=this._rootMotionSpeed,this._lastRotateSpeed=this._angularVelocity.y,0===this._frametime)&&(this._loopMotionSpeed=this._rootMotionSpeed,this._loopRotateSpeed=this._angularVelocity.y)},n.prototype.checkStateMachine=function(e,t){var n=this;this._checkers.result=null,this._checkers.offest=0,this._checkers.blending=0,this._checkers.triggered=[],null!=e.animationStateMachine&&(e.animationStateMachine.time+=t,this.checkStateTransitions(e,e.animationStateMachine.transitions),null==this._checkers.result)&&null!=this._machine.transitions&&this.checkStateTransitions(e,this._machine.transitions),null!=this._checkers.triggered&&0<this._checkers.triggered.length&&(this._checkers.triggered.forEach(function(e){n.resetTrigger(e)}),this._checkers.triggered=null),null!=this._checkers.result&&(this.onAnimationTransitionObservable&&this.onAnimationTransitionObservable.hasObservers()&&this.onAnimationTransitionObservable.notifyObservers(this.transform),this.playCurrentAnimationState(e,this._checkers.result,this._checkers.blending,this._checkers.offest))},n.prototype.checkStateTransitions=function(i,a){var l=this,s=i.animationStateMachine.rate,u=i.animationStateMachine.length;if(null!=a&&0<a.length){for(var c=0,d=-1,c=0;c<a.length;c++)if(!0===a[c].solo&&!1===a[c].mute){d=c;break}var p=this;for(c=0;c<a.length;c++)if("break"===function(){var r,e,t,n,o=a[c];return o.layerIndex!==i.index||!0===o.mute||0<=d&&d!==c||(e=!(t=0),0<o.exitTime&&(t=u*o.exitTime/p.speedRatio,e=!0!==o.hasExitTime||i.animationStateMachine.time>=t),!!1===o.hasExitTime&&o.intSource==M.InterruptionSource.None&&!1===e)?"continue":!0===(null!=o.conditions&&0<o.conditions.length?(r=0,t=o.conditions.length,o.conditions.forEach(function(e){var t=l._parameters.get(e.parameter);if(null!=t)if(t==M.AnimatorParameterType.Float||t==M.AnimatorParameterType.Int){var n=parseFloat(l.getFloat(e.parameter).toFixed(2));(e.mode===M.ConditionMode.Greater&&n>e.threshold||e.mode===M.ConditionMode.Less&&n<e.threshold||e.mode===M.ConditionMode.Equals&&n===e.threshold||e.mode===M.ConditionMode.NotEqual&&n!==e.threshold)&&r++}else if(t==M.AnimatorParameterType.Bool){n=l.getBool(e.parameter);(e.mode===M.ConditionMode.If&&!0===n||e.mode===M.ConditionMode.IfNot&&!1===n)&&r++}else if(t==M.AnimatorParameterType.Trigger)if(!0===l.getTrigger(e.parameter)){r++;for(var o=-1,i=0;i<l._checkers.triggered.length;i++)if(l._checkers.triggered[i]===e.parameter){o=i;break}o<0&&l._checkers.triggered.push(e.parameter)}}),(!0!==o.hasExitTime||!0===e)&&r===t):!0===o.hasExitTime&&!0===e)?(!0===o.hasExitTime&&!0===e&&p.onAnimationEndObservable&&p.onAnimationEndObservable.hasObservers()&&p.onAnimationEndObservable.notifyObservers(i.index),t=0<s?s:M.AnimationState.FPS,e=!1===o.isExit?o.destination:M.AnimationState.EXIT,n=!0===o.fixedDuration?o.duration:BABYLON.Scalar.Denormalize(o.duration,0,u),t=M.Utilities.ComputeBlendingSpeed(t,n),n=o.offset,p._checkers.result=e,p._checkers.offest=n,p._checkers.blending=t,"break"):void 0}())break}},n.prototype.playCurrentAnimationState=function(t,e,n,o){void 0===o&&(o=0),null==t||null==e||""===e||e===M.AnimationState.EXIT||null!=t.animationStateMachine&&t.animationStateMachine.name===e||(null!=this.m_animationTargets&&0<this.m_animationTargets.length&&this.m_animationTargets.forEach(function(e){var e=e.target;null!=e.metadata&&null!=e.metadata.mixer&&null!=(e=e.metadata.mixer[t.index])&&(e.originalMatrix=null,e.blendingFactor=0,e.blendingSpeed=n)}),null!=(e=this.getMachineState(e))&&e.layerIndex===t.index&&(e.time=0,e.played=0,e.interrupted=!1,t.animationTime=BABYLON.Scalar.Clamp(o),t.animationNormal=0,t.animationFirstRun=!0,t.animationEndFrame=!1,t.animationLoopFrame=!1,t.animationLoopCount=0,t.animationLoopEvents=null,t.animationStateMachine=e,this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),this._lastMotionPosition.set(0,0,0),this._lastMotionRotation.set(0,0,0,0)))},n.prototype.stopCurrentAnimationState=function(t){null!=t&&(null!=this.m_animationTargets&&0<this.m_animationTargets.length&&this.m_animationTargets.forEach(function(e){var e=e.target;null!=e.metadata&&null!=e.metadata.mixer&&null!=(e=e.metadata.mixer[t.index])&&(e.originalMatrix=null,e.blendingFactor=0,e.blendingSpeed=0)}),t.animationTime=0,t.animationNormal=0,t.animationFirstRun=!0,t.animationEndFrame=!1,t.animationLoopFrame=!1,t.animationLoopCount=0,t.animationLoopEvents=null,t.animationStateMachine=null,this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),this._lastMotionPosition.set(0,0,0),this._lastMotionRotation.set(0,0,0,0))},n.prototype.checkAvatarTransformPath=function(e,t){var n=!1;return n=null!=e.animationMaskMap&&null!=(e=e.animationMaskMap.get(t))&&0<=e?!0:n},n.prototype.filterTargetAvatarMask=function(e,t){var n=!1;return null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.bone&&""!==t.metadata.unity.bone&&(t=t.metadata.unity.bone,n=this.checkAvatarTransformPath(e,t)),n},n.prototype.sortWeightedBlendingList=function(e){null!=e&&0<e.length&&e.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0})},n.prototype.computeWeightedFrameRatio=function(e){var t=1;return null!=e&&0<e.length&&(this.sortWeightedBlendingList(e),this._blendWeights.primary=e[0],this._blendWeights.primary.weight<1&&1<e.length&&(this._blendWeights.secondary=e[1]),null!=this._blendWeights.primary&&null!=this._blendWeights.secondary?(e=BABYLON.Scalar.Clamp(this._blendWeights.primary.weight),t=BABYLON.Scalar.Lerp(this._blendWeights.secondary.ratio,this._blendWeights.primary.ratio,e)):null!=this._blendWeights.primary&&null==this._blendWeights.secondary&&(t=this._blendWeights.primary.ratio)),t},n.prototype.setupTreeBranches=function(e){var n=this;null!=e&&null!=e.children&&0<e.children.length&&e.children.forEach(function(e){var t;e.type===M.MotionType.Tree?n.setupTreeBranches(e.subtree):e.type===M.MotionType.Clip&&null!=e.motion&&""!==e.motion&&(e.weight=0,e.ratio=0,e.track=n.getAnimationGroup(e.motion),null!=e.track)&&(t=e.track.metadata.unity.length,e.ratio=M.AnimationState.TIME/t)})},n.prototype.parseTreeBranches=function(e,t,n,o){if(null!=t)switch(t.valueParameterX=null!=t.blendParameterX?parseFloat(this.getFloat(t.blendParameterX).toFixed(2)):0,t.valueParameterY=null!=t.blendParameterY?parseFloat(this.getFloat(t.blendParameterY).toFixed(2)):0,t.blendType){case M.BlendTreeType.Simple1D:this.parse1DSimpleTreeBranches(e,t,n,o);break;case M.BlendTreeType.SimpleDirectional2D:this.parse2DSimpleDirectionalTreeBranches(e,t,n,o);break;case M.BlendTreeType.FreeformDirectional2D:this.parse2DFreeformDirectionalTreeBranches(e,t,n,o);break;case M.BlendTreeType.FreeformCartesian2D:this.parse2DFreeformCartesianTreeBranches(e,t,n,o)}},n.prototype.parse1DSimpleTreeBranches=function(t,e,n,o){var i,r=this;null!=e&&null!=e.children&&0<e.children.length&&(i=[],e.children.forEach(function(e){e.weight=0;e={source:e,motion:e.motion,posX:e.threshold,posY:e.threshold,weight:e.weight};i.push(e)}),M.BlendTreeSystem.Calculate1DSimpleBlendTree(e.valueParameterX,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),e.children.forEach(function(e){e.weight*=n,e.type===M.MotionType.Clip&&0<e.weight&&o.push(e),e.type===M.MotionType.Tree&&r.parseTreeBranches(t,e.subtree,e.weight,o)}))},n.prototype.parse2DSimpleDirectionalTreeBranches=function(t,e,n,o){var i,r=this;null!=e&&null!=e.children&&0<e.children.length&&(i=[],e.children.forEach(function(e){e.weight=0;e={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};i.push(e)}),M.BlendTreeSystem.Calculate2DFreeformDirectional(e.valueParameterX,e.valueParameterY,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),e.children.forEach(function(e){e.weight*=n,e.type===M.MotionType.Clip&&0<e.weight&&o.push(e),e.type===M.MotionType.Tree&&r.parseTreeBranches(t,e.subtree,e.weight,o)}))},n.prototype.parse2DFreeformDirectionalTreeBranches=function(t,e,n,o){var i,r=this;null!=e&&null!=e.children&&0<e.children.length&&(i=[],e.children.forEach(function(e){e.weight=0;e={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};i.push(e)}),M.BlendTreeSystem.Calculate2DFreeformDirectional(e.valueParameterX,e.valueParameterY,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),e.children.forEach(function(e){e.weight*=n,e.type===M.MotionType.Clip&&0<e.weight&&o.push(e),e.type===M.MotionType.Tree&&r.parseTreeBranches(t,e.subtree,e.weight,o)}))},n.prototype.parse2DFreeformCartesianTreeBranches=function(t,e,n,o){var i,r=this;null!=e&&null!=e.children&&0<e.children.length&&(i=[],e.children.forEach(function(e){e.weight=0;e={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};i.push(e)}),M.BlendTreeSystem.Calculate2DFreeformCartesian(e.valueParameterX,e.valueParameterY,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),e.children.forEach(function(e){e.weight*=n,e.type===M.MotionType.Clip&&0<e.weight&&o.push(e),e.type===M.MotionType.Tree&&r.parseTreeBranches(t,e.subtree,e.weight,o)}))},n.FPS=30,n.EXIT="[EXIT]",n.TIME=1,n.SPEED=1;var t,e=n;function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._looptime=!1,e._loopblend=!1,e._frametime=0,e._layercount=0,e._updatemode=0,e._hasrootmotion=!1,e._animationplaying=!1,e._initialtargetblending=!1,e._hastransformhierarchy=!1,e._leftfeetbottomheight=0,e._rightfeetbottomheight=0,e._runtimecontroller=null,e._executed=!1,e._awakened=!1,e._initialized=!1,e._checkers=new M.TransitionCheck,e._source="",e._machine=null,e._animationmode=0,e._animationrig=null,e._deltaPosition=new BABYLON.Vector3(0,0,0),e._deltaRotation=new BABYLON.Quaternion(0,0,0,0),e._angularVelocity=new BABYLON.Vector3(0,0,0),e._rootMotionSpeed=0,e._lastMotionSpeed=0,e._loopMotionSpeed=0,e._lastRotateSpeed=0,e._loopRotateSpeed=0,e._lastMotionRotation=new BABYLON.Quaternion(0,0,0,0),e._lastMotionPosition=new BABYLON.Vector3(0,0,0),e._positionWeight=!1,e._rootBoneWeight=!1,e._rotationWeight=!1,e._rootQuatWeight=!1,e._rootBoneTransform=null,e._positionHolder=new BABYLON.Vector3(0,0,0),e._rootBoneHolder=new BABYLON.Vector3(0,0,0),e._rotationHolder=new BABYLON.Quaternion(0,0,0,0),e._rootQuatHolder=new BABYLON.Quaternion(0,0,0,0),e._rootMotionMatrix=BABYLON.Matrix.Zero(),e._rootMotionScaling=new BABYLON.Vector3(0,0,0),e._rootMotionRotation=new BABYLON.Quaternion(0,0,0,0),e._rootMotionPosition=new BABYLON.Vector3(0,0,0),e._dirtyMotionMatrix=null,e._dirtyBlenderMatrix=null,e._targetPosition=new BABYLON.Vector3(0,0,0),e._targetRotation=new BABYLON.Quaternion(0,0,0,0),e._targetScaling=new BABYLON.Vector3(1,1,1),e._updateMatrix=BABYLON.Matrix.Zero(),e._blenderMatrix=BABYLON.Matrix.Zero(),e._blendWeights=new M.BlendingWeights,e._emptyScaling=new BABYLON.Vector3(1,1,1),e._emptyPosition=new BABYLON.Vector3(0,0,0),e._emptyRotation=new BABYLON.Quaternion(0,0,0,0),e._ikFrameEanbled=!1,e._data=new Map,e._anims=new Map,e._clips=null,e._timers=new Map,e._starts=new Map,e._stops=new Map,e._numbers=new Map,e._booleans=new Map,e._triggers=new Map,e._parameters=new Map,e.speedRatio=1,e.delayUpdateUntilReady=!0,e.enableAnimation=!0,e.applyRootMotion=!1,e.onAnimationAwakeObservable=new BABYLON.Observable,e.onAnimationInitObservable=new BABYLON.Observable,e.onAnimationIKObservable=new BABYLON.Observable,e.onAnimationEndObservable=new BABYLON.Observable,e.onAnimationLoopObservable=new BABYLON.Observable,e.onAnimationEventObservable=new BABYLON.Observable,e.onAnimationUpdateObservable=new BABYLON.Observable,e.onAnimationTransitionObservable=new BABYLON.Observable,e.m_zeroVector=new BABYLON.Vector3(0,0,0),e.m_defaultGroup=null,e.m_animationTargets=null,e.m_rotationIdentity=new BABYLON.Quaternion(0,0,0,0),e.sourceAnimationGroups=null,e}M.AnimationState=e;M.BlendTreeValue=function(e){this.source=e.source,this.motion=e.motion,this.posX=e.posX||0,this.posY=e.posY||0,this.weight=e.weight||0},o.ClampValue=function(e,t,n){return e<=t?t:n<=e?n:e},o.GetSignedAngle=function(e,t){return Math.atan2(e.x*t.y-e.y*t.x,e.x*t.x+e.y*t.y)},o.GetLinearInterpolation=function(e,t,n,o,i){return t+(o-t)/(n-e)*(i-e)},o.GetRightNeighbourIndex=function(e,t){t.sort(function(e,t){return e.posX-t.posX});for(var n=0;n<t.length;++n)if(t[n].posX>e)return n;return-1};e=o;function o(){}function i(){}M.BlendTreeUtils=e,i.Calculate1DSimpleBlendTree=function(e,t){var n=t[0],o=t[t.length-1];e<=n.posX?n.weight=1:e>=o.posX?o.weight=1:(o=t[(n=M.BlendTreeUtils.GetRightNeighbourIndex(e,t))-1],t=t[n],n=M.BlendTreeUtils.GetLinearInterpolation(o.posX,1,t.posX,0,e),o.weight=n,t.weight=1-o.weight)},i.Calculate2DFreeformDirectional=function(e,t,n){M.BlendTreeSystem.TempVector2_IP.set(e,t),M.BlendTreeSystem.TempVector2_POSI.set(0,0),M.BlendTreeSystem.TempVector2_POSJ.set(0,0),M.BlendTreeSystem.TempVector2_POSIP.set(0,0),M.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var o=0,i=M.BlendTreeSystem.TempVector2_IP.length(),r=0;r<n.length;++r){for(var a,l,s,u=n[r],c=(M.BlendTreeSystem.TempVector2_POSI.set(u.posX,u.posY),M.BlendTreeSystem.TempVector2_POSI.length()),d=i-c,p=M.BlendTreeUtils.GetSignedAngle(M.BlendTreeSystem.TempVector2_POSI,M.BlendTreeSystem.TempVector2_IP),h=1,m=0;m<n.length;++m)m!==r&&(M.BlendTreeSystem.TempVector2_POSJ.set(n[m].posX,n[m].posY),l=d/(a=(c+(s=M.BlendTreeSystem.TempVector2_POSJ.length()))/2),s=(s-c)/a,a=M.BlendTreeUtils.GetSignedAngle(M.BlendTreeSystem.TempVector2_POSI,M.BlendTreeSystem.TempVector2_POSJ),M.BlendTreeSystem.TempVector2_POSIP.set(l,2*p),M.BlendTreeSystem.TempVector2_POSIJ.set(s,2*a),l=M.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),s=BABYLON.Vector2.Dot(M.BlendTreeSystem.TempVector2_POSIP,M.BlendTreeSystem.TempVector2_POSIJ)/l,s=M.BlendTreeUtils.ClampValue(s=1-s,0,1),h=Math.min(s,h));o+=u.weight=h}for(var g=0,f=n;g<f.length;g++)(u=f[g]).weight/=o},i.Calculate2DFreeformCartesian=function(e,t,n){M.BlendTreeSystem.TempVector2_IP.set(e,t),M.BlendTreeSystem.TempVector2_POSI.set(0,0),M.BlendTreeSystem.TempVector2_POSJ.set(0,0),M.BlendTreeSystem.TempVector2_POSIP.set(0,0),M.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var o=0,i=0;i<n.length;++i){for(var r,a=n[i],l=(M.BlendTreeSystem.TempVector2_POSI.set(a.posX,a.posY),M.BlendTreeSystem.TempVector2_IP.subtractToRef(M.BlendTreeSystem.TempVector2_POSI,M.BlendTreeSystem.TempVector2_POSIP),1),s=0;s<n.length;++s)s!==i&&(M.BlendTreeSystem.TempVector2_POSJ.set(n[s].posX,n[s].posY),M.BlendTreeSystem.TempVector2_POSJ.subtractToRef(M.BlendTreeSystem.TempVector2_POSI,M.BlendTreeSystem.TempVector2_POSIJ),r=M.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),r=BABYLON.Vector2.Dot(M.BlendTreeSystem.TempVector2_POSIP,M.BlendTreeSystem.TempVector2_POSIJ)/r,r=M.BlendTreeUtils.ClampValue(r=1-r,0,1),l=Math.min(l,r));o+=a.weight=l}for(var u=0,c=n;u<c.length;u++)(a=c[u]).weight/=o},i.TempVector2_IP=new BABYLON.Vector2(0,0),i.TempVector2_POSI=new BABYLON.Vector2(0,0),i.TempVector2_POSJ=new BABYLON.Vector2(0,0),i.TempVector2_POSIP=new BABYLON.Vector2(0,0),i.TempVector2_POSIJ=new BABYLON.Vector2(0,0),M.BlendTreeSystem=i;function r(){}function a(){}function l(){}M.MachineState=function(){},M.TransitionCheck=r,M.AnimationMixer=a;M.BlendingWeights=l,(e=M.MotionType||(M.MotionType={}))[e.Clip=0]="Clip",e[e.Tree=1]="Tree",(e=M.ConditionMode||(M.ConditionMode={}))[e.If=1]="If",e[e.IfNot=2]="IfNot",e[e.Greater=3]="Greater",e[e.Less=4]="Less",e[e.Equals=6]="Equals",e[e.NotEqual=7]="NotEqual",(e=M.InterruptionSource||(M.InterruptionSource={}))[e.None=0]="None",e[e.Source=1]="Source",e[e.Destination=2]="Destination",e[e.SourceThenDestination=3]="SourceThenDestination",e[e.DestinationThenSource=4]="DestinationThenSource",(e=M.BlendTreeType||(M.BlendTreeType={}))[e.Simple1D=0]="Simple1D",e[e.SimpleDirectional2D=1]="SimpleDirectional2D",e[e.FreeformDirectional2D=2]="FreeformDirectional2D",e[e.FreeformCartesian2D=3]="FreeformCartesian2D",e[e.Direct=4]="Direct",e[e.Clip=5]="Clip",(e=M.BlendTreePosition||(M.BlendTreePosition={}))[e.Lower=0]="Lower",e[e.Upper=1]="Upper",(e=M.AnimatorParameterType||(M.AnimatorParameterType={}))[e.Float=1]="Float",e[e.Int=3]="Int",e[e.Bool=4]="Bool",e[e.Trigger=9]="Trigger"}(UNITY=UNITY||{}),this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}()),__extends=(!function(r){t=r.ScriptComponent,__extends(n,t),n.prototype.getSoundClip=function(){return this._audio},n.prototype.getAudioElement=function(){return null!=this._audio?this._audio._htmlAudioElement:null},n.prototype.awake=function(){this.awakeAudioSource()},n.prototype.start=function(){this.startAudioSource()},n.prototype.destroy=function(){this.destroyAudioSource()},n.prototype.awakeAudioSource=function(){this._name=this.getProperty("name",this._name),this._loop=this.getProperty("loop",this._loop),this._mute=this.getProperty("mute",this._mute),this._pitch=this.getProperty("pitch",this._pitch),this._volume=this.getProperty("volume",this._volume),this._preload=this.getProperty("preload",this._preload),this._priority=this.getProperty("priority",this._priority),this._panstereo=this.getProperty("panstereo",this._panstereo),this._playonawake=this.getProperty("playonawake",this._playonawake),this._mindistance=this.getProperty("mindistance",this._mindistance),this._maxdistance=this.getProperty("maxdistance",this._maxdistance),this._rolloffmode=this.getProperty("rolloffmode",this._rolloffmode),this._spatialblend=this.getProperty("spatialblend",this._spatialblend),this._reverbzonemix=this.getProperty("reverbzonemix",this._reverbzonemix),this._bypasseffects=this.getProperty("bypasseffects",this._bypasseffects),this._bypassreverbzones=this.getProperty("bypassreverbzones",this._bypassreverbzones),this._bypasslistenereffects=this.getProperty("bypasslistenereffects",this._bypasslistenereffects),null!=this._name&&""!==this._name||(this._name="Unknown");var e=this.getProperty("file");null!=e&&""!==e&&null!=(e=r.SceneManager.GetRootUrl(this.scene)+e)&&""!==e&&(!0===this._preload?this._preloaderUrl=e:this.setDataSource(e))},n.prototype.startAudioSource=function(){this._volume>=r.AudioSource.MAX_VOLUME&&(this._volume=r.AudioSource.DEFAULT_LEVEL)},n.prototype.destroyAudioSource=function(){this.onReadyObservable.clear(),(this.onReadyObservable=null)!=this._audio&&(this._audio.dispose(),this._audio=null)},n.prototype.isReady=function(){var e=!1;return e=null!=this._audio?this._audio.isReady():e},n.prototype.isPlaying=function(){var e=!1;return e=null!=this._audio?this._audio.isPlaying:e},n.prototype.isPaused=function(){var e=!1;return e=null!=this._audio?this._audio.isPaused:e},n.prototype.play=function(e,t,n){var o=this;return r.SceneManager.HasAudioContext()?this.internalPlay(e,t,n):BABYLON.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){o.internalPlay(e,t,n)}),!0},n.prototype.internalPlay=function(e,t,n){var o=this;null!=this._audio&&(!0===this._initializedReadyInstance?this._audio.play(e,t,n):this.onReadyObservable.addOnce(function(){o._audio.play(e,t,n)}))},n.prototype.pause=function(){var e=!1;return null!=this._audio&&(this._audio.pause(),e=!0),e},n.prototype.stop=function(e){var t=!1;return null!=this._audio&&(this._audio.stop(e),t=!0),t},n.prototype.mute=function(e){return null!=this._audio&&(this._lastmutedvolume=this._audio.getVolume(),this._audio.setVolume(0,e)),!1},n.prototype.unmute=function(e){return null!=this._audio&&null!=this._lastmutedvolume&&(this._audio.setVolume(this._lastmutedvolume,e),this._lastmutedvolume=null),!1},n.prototype.getVolume=function(){return null!=this._audio?this._audio.getVolume():this._volume},n.prototype.setVolume=function(e,t){return this._volume=e,null!=this._audio&&this._audio.setVolume(this._volume,t),!0},n.prototype.getSpatialSound=function(){var e=!1;return e=null!=this._audio?this._audio.spatialSound:e},n.prototype.setSpatialSound=function(e){null!=this._audio&&(this._audio.spatialSound=e)},n.prototype.setPlaybackSpeed=function(e){null!=this._audio&&this._audio.setPlaybackRate(e)},n.prototype.getCurrentTrackTime=function(){var e=0;return e=null!=this._audio?this._audio.currentTime:e},n.prototype.setDataSource=function(e){var t=this,n=(null!=this._audio&&(this._audio.dispose(),this._audio=null),.1<=this._spatialblend),o="logarithmic"===this._rolloffmode?"exponential":"linear",i=null!=this.transform.metadata&&null!=this.transform.metadata.vtt&&!0===this.transform.metadata.vtt;this._initializedReadyInstance=!1,this._audio=new BABYLON.Sound(this._name,e,this.scene,function(){t._lastmutedvolume=t._volume,t._audio.setVolume(!0===t._mute?0:t._volume),t._audio.setPlaybackRate(t._pitch),t._initializedReadyInstance=!0,t.onReadyObservable&&t.onReadyObservable.hasObservers()&&t.onReadyObservable.notifyObservers(t._audio),!0===t._playonawake&&t.play()},{loop:this._loop,autoplay:!1,refDistance:this._mindistance,maxDistance:this._maxdistance,rolloffFactor:r.AudioSource.DEFAULT_ROLLOFF,spatialSound:n,distanceModel:o,streaming:i}),this._audio.setPosition(this.transform.position.clone()),!0==n&&this._audio.attachToMesh(this.transform)},n.prototype.addPreloaderTasks=function(e){var t=this;!0===this._preload&&((e=e.addBinaryFileTask(this.transform.name+".AudioTask",this._preloaderUrl)).onSuccess=function(e){t.setDataSource(e.data)},e.onError=function(e,t,n){console.error(t,n)})},n.MAX_VOLUME=1,n.DEFAULT_LEVEL=1,n.DEFAULT_ROLLOFF=1;var t,e=n;function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._audio=null,e._name=null,e._loop=!1,e._mute=!1,e._pitch=1,e._volume=1,e._preload=!1,e._playonawake=!0,e._spatialblend=0,e._preloaderUrl=null,e._lastmutedvolume=null,e._priority=128,e._panstereo=0,e._mindistance=10,e._maxdistance=50,e._rolloffmode="linear",e._reverbzonemix=1,e._bypasseffects=!1,e._bypassreverbzones=!1,e._bypasslistenereffects=!1,e._initializedReadyInstance=!1,e.onReadyObservable=new BABYLON.Observable,e}r.AudioSource=e}(UNITY=UNITY||{}),!function(B){function e(e){this.chassisBody=null,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=0,this.indexForwardAxis=2,this.indexUpAxis=1,this.minimumWheelContacts=4,this.smoothFlyingImpulse=0,this.stabilizingForce=0,this.maxImpulseForce=0,this.currentVehicleSpeedKmHour=0,this.chassisBody=e.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==e.indexRightAxis?e.indexRightAxis:0,this.indexForwardAxis=void 0!==e.indexForwardAxis?e.indexForwardAxis:2,this.indexUpAxis=void 0!==e.indexUpAxis?e.indexUpAxis:1}function t(e){this.maxSuspensionTravel=0,this.customSlidingRotationalSpeed=0,this.useCustomSlidingRotationalSpeed=0,this.sliding=!1,this.isInContact=!1,this.hub=null,this.spinner=null,this.defaultFriction=10,this.steeringAngle=0,this.rotationBoost=0,this.locked=!1,e=B.HavokVehicleUtilities.Utilsdefaults(e,{chassisConnectionPointLocal:new BABYLON.Vector3,chassisConnectionPointWorld:new BABYLON.Vector3,directionLocal:new BABYLON.Vector3,directionWorld:new BABYLON.Vector3,axleLocal:new BABYLON.Vector3,axleWorld:new BABYLON.Vector3,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=e.maxSuspensionTravel,this.customSlidingRotationalSpeed=e.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=e.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=e.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=e.chassisConnectionPointLocal.clone(),this.directionLocal=e.directionLocal.clone(),this.directionWorld=e.directionLocal.clone(),this.axleLocal=e.axleLocal.clone(),this.axleWorld=e.axleLocal.clone(),this.suspensionRestLength=e.suspensionRestLength,this.suspensionMaxLength=e.suspensionMaxLength,this.radius=e.radius,this.suspensionStiffness=e.suspensionStiffness,this.dampingCompression=e.dampingCompression,this.dampingRelaxation=e.dampingRelaxation,this.frictionSlip=e.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=e.rollInfluence,this.maxSuspensionForce=e.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=e.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new BABYLON.PhysicsRaycastResult,this.raycastResult.directionWorld=new BABYLON.Vector3,this.worldTransform=new BABYLON.TransformNode(""),this.worldTransform.rotationQuaternion=new BABYLON.Quaternion,this.isInContact=!1}function n(){}e.prototype.addWheel=function(e){var e=new B.HavokWheelInfo(e=e||{}),t=this.wheelInfos.length;return this.wheelInfos.push(e),t},e.prototype.getNumWheels=function(){return this.wheelInfos.length},e.prototype.getWheelInfo=function(e){return this.wheelInfos[e]},e.prototype.getSteeringValue=function(e){return this.wheelInfos[e].steering},e.prototype.setSteeringValue=function(e,t){this.wheelInfos[t].steering=e},e.prototype.applyEngineForce=function(e,t){this.wheelInfos[t].engineForce=e},e.prototype.setBrake=function(e,t){this.wheelInfos[t].brake=e},e.prototype.addToWorld=function(e){this.world=e},e.prototype.getVehicleAxisWorld=function(e,t){return t.set(0===e?1:0,1===e?1:0,2===e?1:0),BABYLON.Vector3.TransformCoordinatesToRef(t,B.HavokVehicleUtilities.bodyTransform(this.chassisBody,new BABYLON.Matrix),t),t},e.prototype.getCurrentSpeedKmHour=function(){return this.currentVehicleSpeedKmHour},e.prototype.updateVehicle=function(e){for(var t=this.wheelInfos,n=t.length,o=this.chassisBody,i=0;i<n;i++)this.updateWheelTransform(i);var r=B.HavokVehicleUtilities.bodyLinearVelocity(o,new BABYLON.Vector3),r=BABYLON.Vector3.TransformNormalToRef(r,B.HavokVehicleUtilities.bodyTransform(o,new BABYLON.Matrix).invert(),new BABYLON.Vector3),r=(this.currentVehicleSpeedKmHour=r.z,new BABYLON.Vector3);this.getVehicleAxisWorld(this.indexForwardAxis,r),BABYLON.Vector3.Dot(r,B.HavokVehicleUtilities.bodyLinearVelocity(o,new BABYLON.Vector3));for(i=0;i<n;i++)this.castRay(t[i]);for(var a=0,i=0;i<n;i++)(h=t[i]).raycastResult.body&&a++;0==a&&this.smoothFlyingImpulse,this.updateSuspension(e);for(var l=new BABYLON.Vector3,i=0;i<n;i++){var s=(h=t[i]).suspensionForce;s>h.maxSuspensionForce&&(s=h.maxSuspensionForce),l.copyFrom(h.raycastResult.hitNormalWorld).scaleInPlace(s*e),B.HavokVehicleUtilities.addImpulseAt(o,l,h.raycastResult.hitPointWorld)}this.updateFriction(e),0<this.stabilizingForce&&0<this.minimumWheelContacts&&this.minimumWheelContacts;var u=new BABYLON.Vector3,c=new BABYLON.Vector3,d=new BABYLON.Vector3;for(i=0;i<n;i++){var p,h=t[i],m=(B.HavokVehicleUtilities.velocityAt(o,h.chassisConnectionPointWorld,d),1);1===this.indexUpAxis&&(m=-1),h.isInContact&&(this.getVehicleAxisWorld(this.indexForwardAxis,c),p=BABYLON.Vector3.Dot(c,h.raycastResult.hitNormalWorld),u.copyFrom(h.raycastResult.hitNormalWorld).scaleInPlace(p),c.subtractToRef(u,c),p=BABYLON.Vector3.Dot(c,d),h.deltaRotation=m*p*e/h.radius),!h.sliding&&h.isInContact||0===h.engineForce||!h.useCustomSlidingRotationalSpeed||(h.deltaRotation=(0<h.engineForce?1:-1)*h.customSlidingRotationalSpeed*e),!0===h.locked&&(h.deltaRotation=0),h.rotation+=h.deltaRotation,h.deltaRotation*=.99}},e.prototype.updateSuspension=function(e){for(var t=this.chassisBody,n=B.HavokVehicleUtilities.bodyMass(t),o=this.wheelInfos,i=o.length,r=0;r<i;r++){var a,l,s=o[r];(!s.isInContact||(a=s.suspensionRestLength,l=s.suspensionLength,a=s.suspensionStiffness*(a-l)*s.clippedInvContactDotSuspension,a-=((l=s.suspensionRelativeVelocity)<0?s.dampingCompression:s.dampingRelaxation)*l,s.suspensionForce=a*n,s.suspensionForce<0))&&(s.suspensionForce=0)}},e.prototype.removeFromWorld=function(e){e.removeBody(this.chassisBody),this.world=null},e.prototype.castRay2=function(e){var t=B.HavokVehicleUtilities.castRay_rayvector,n=B.HavokVehicleUtilities.castRay_target,o=(this.updateWheelTransformWorld(e),this.chassisBody),i=-1,r=e.suspensionRestLength+e.radius,r=(e.directionWorld.scaleToRef(r,t),e.chassisConnectionPointWorld),t=(r.addToRef(t,n),e.raycastResult),n=(t.reset(),this.world.raycastToRef(r,n,t),t.body);return e.raycastResult.groundObject=0,n?(t.distance=BABYLON.Vector3.Distance(r,t.hitPointWorld),i=t.distance,e.isInContact=!0,n=t.distance,e.suspensionLength=n-e.radius,r=e.suspensionRestLength-e.maxSuspensionTravel,t=e.suspensionRestLength+e.maxSuspensionTravel,e.suspensionLength<r&&(e.suspensionLength=r),e.suspensionLength>t&&(e.suspensionLength=t,e.raycastResult.reset()),n=BABYLON.Vector3.Dot(e.raycastResult.hitNormalWorld,e.directionWorld),r=new BABYLON.Vector3,B.HavokVehicleUtilities.velocityAt(o,e.raycastResult.hitPointWorld,r),t=BABYLON.Vector3.Dot(e.raycastResult.hitNormalWorld,r),-.1<=n?(e.suspensionRelativeVelocity=0,e.clippedInvContactDotSuspension=10):(e.suspensionRelativeVelocity=t*(o=-1/n),e.clippedInvContactDotSuspension=o)):(e.suspensionLength=e.suspensionRestLength+0*e.maxSuspensionTravel,e.suspensionRelativeVelocity=0,e.directionWorld.scaleToRef(-1,e.raycastResult.hitNormalWorld),e.clippedInvContactDotSuspension=1),i},e.prototype.castRay=function(e){var t=B.HavokVehicleUtilities.castRay_rayvector,n=B.HavokVehicleUtilities.castRay_target,o=(this.updateWheelTransformWorld(e),this.chassisBody),i=-1,r=e.suspensionRestLength+e.radius,r=(t.copyFrom(e.directionWorld).scaleInPlace(r),e.chassisConnectionPointWorld),t=(n.copyFrom(r).addInPlace(t),e.raycastResult),n=(t.reset(),this.world.raycastToRef(r,n,t),t.body);return e.raycastResult.groundObject=0,n?(i=n=BABYLON.Vector3.Distance(r,t.hitPointWorld),e.raycastResult.hitNormalWorld.copyFrom(t.hitNormalWorld),e.isInContact=!0,e.suspensionLength=n-e.radius,r=e.suspensionRestLength-e.maxSuspensionTravel,t=e.suspensionRestLength+e.maxSuspensionTravel,e.suspensionLength<r&&(e.suspensionLength=r),e.suspensionLength>t&&(e.suspensionLength=t,e.raycastResult.reset()),n=BABYLON.Vector3.Dot(e.raycastResult.hitNormalWorld,e.directionWorld),r=new BABYLON.Vector3,B.HavokVehicleUtilities.velocityAt(o,e.raycastResult.hitPointWorld,r),t=BABYLON.Vector3.Dot(e.raycastResult.hitNormalWorld,r),-.1<=n?(e.suspensionRelativeVelocity=0,e.clippedInvContactDotSuspension=10):(e.suspensionRelativeVelocity=t*(o=-1/n),e.clippedInvContactDotSuspension=o)):(e.suspensionLength=e.suspensionRestLength+0*e.maxSuspensionTravel,e.suspensionRelativeVelocity=0,e.raycastResult.hitNormalWorld.copyFrom(e.directionWorld).scaleInPlace(-1),e.clippedInvContactDotSuspension=1),i},e.prototype.updateWheelTransformWorld=function(e){e.isInContact=!1;var t=this.chassisBody,t=B.HavokVehicleUtilities.bodyTransform(t,new BABYLON.Matrix);BABYLON.Vector3.TransformCoordinatesToRef(e.chassisConnectionPointLocal,t,e.chassisConnectionPointWorld),BABYLON.Vector3.TransformNormalToRef(e.directionLocal,t,e.directionWorld),BABYLON.Vector3.TransformNormalToRef(e.axleLocal,t,e.axleWorld)},e.prototype.updateWheelTransform=function(e){var t=B.HavokVehicleUtilities.tmpVec4,n=B.HavokVehicleUtilities.tmpVec5,o=B.HavokVehicleUtilities.tmpVec6,e=this.wheelInfos[e],o=(this.updateWheelTransformWorld(e),e.directionLocal.scaleToRef(-1,t),n.copyFrom(e.axleLocal),BABYLON.Vector3.CrossToRef(t,n,o),o.normalize(),n.normalize(),e.steering),i=new BABYLON.Quaternion,t=(BABYLON.Quaternion.RotationAxisToRef(t,o,i),new BABYLON.Quaternion),o=(BABYLON.Quaternion.RotationAxisToRef(n,e.rotation,t),e.worldTransform.rotationQuaternion),n=(B.HavokVehicleUtilities.bodyOrientation(this.chassisBody,new BABYLON.Quaternion).multiplyToRef(i,o),o.multiplyToRef(t,o),o.normalize(),e.worldTransform.position);n.copyFrom(e.directionWorld),n.scaleToRef(e.suspensionLength,n),n.addToRef(e.chassisConnectionPointWorld,n),e.worldTransform.computeWorldMatrix(!0)},e.prototype.getWheelTransformWorld=function(e){return this.wheelInfos[e].worldTransform},e.prototype.updateFriction=function(e){for(var t=B.HavokVehicleUtilities.updateFriction_surfNormalWS_scaled_proj,n=this.wheelInfos,o=n.length,i=this.chassisBody,r=B.HavokVehicleUtilities.updateFriction_forwardWS,a=B.HavokVehicleUtilities.updateFriction_axle,l=0;l<o;l++)m=(v=n[l]).raycastResult.body,v.sideImpulse=0,v.forwardImpulse=0,r[l]||(r[l]=new BABYLON.Vector3),a[l]||(a[l]=new BABYLON.Vector3);for(var s,u,c,l=0;l<o;l++)(m=(v=n[l]).raycastResult.body)&&(s=a[l],u=this.getWheelTransformWorld(l),BABYLON.Vector3.TransformNormalToRef(B.HavokVehicleUtilities.directions[this.indexRightAxis],u.getWorldMatrix(),s),u=v.raycastResult.hitNormalWorld,c=BABYLON.Vector3.Dot(s,u),u.scaleToRef(c,t),s.subtractToRef(t,s),s.normalize(),BABYLON.Vector3.CrossToRef(u,s,r[l]),r[l].normalize(),v.sideImpulse=B.HavokVehicleUtilities.resolveSingleBilateral(i,v.raycastResult.hitPointWorld,m,v.raycastResult.hitPointWorld,s),v.sideImpulse*=B.HavokVehicleUtilities.sideFrictionStiffness2);this.sliding=!1;for(l=0;l<o;l++){var d,p,h,m=(v=n[l]).raycastResult.body,g=0;v.slipInfo=1,m&&(h=v.brake||0,g=B.HavokVehicleUtilities.calcRollingFriction(i,m,v.raycastResult.hitPointWorld,r[l],h),h=h/(g+=v.engineForce*e),v.slipInfo*=h),v.forwardImpulse=0,v.skidInfo=1,m&&(v.skidInfo=1,p=(d=v.suspensionForce*e*v.frictionSlip)*d,v.forwardImpulse=g,g=(g=.5*v.forwardImpulse)*g+(g=+v.sideImpulse)*g,v.sliding=!1,p<g)&&(this.sliding=!0,v.sliding=!0,h=d/Math.sqrt(g),v.skidInfo*=h)}if(this.sliding)for(l=0;l<o;l++)0!==(v=n[l]).sideImpulse&&v.skidInfo<1&&(v.forwardImpulse*=v.skidInfo,v.sideImpulse*=v.skidInfo);for(l=0;l<o;l++){var f,y,v=n[l],_=new BABYLON.Vector3;v.raycastResult.hitPointWorld.subtractToRef(B.HavokVehicleUtilities.bodyPosition(i,new BABYLON.Vector3),_),0!==v.forwardImpulse&&((f=new BABYLON.Vector3).copyFrom(r[l]).scaleInPlace(v.forwardImpulse),B.HavokVehicleUtilities.addImpulseAt(i,f,v.raycastResult.hitPointWorld)),0!==v.sideImpulse&&(m=v.raycastResult.body,f=new BABYLON.Vector3,v.raycastResult.hitPointWorld.subtractToRef(B.HavokVehicleUtilities.bodyPosition(m,new BABYLON.Vector3),f),(y=new BABYLON.Vector3).copyFrom(a[l]).scaleInPlace(v.sideImpulse),BABYLON.Vector3.TransformNormalToRef(_,B.HavokVehicleUtilities.bodyTransform(i,new BABYLON.Matrix).invert(),_),_["xyz"[this.indexUpAxis]]*=v.rollInfluence,BABYLON.Vector3.TransformNormalToRef(_,B.HavokVehicleUtilities.bodyTransform(i,new BABYLON.Matrix),_),B.HavokVehicleUtilities.addImpulseAt(i,y,B.HavokVehicleUtilities.bodyPosition(i,new BABYLON.Vector3).add(_)),y.scaleToRef(-1,y),B.HavokVehicleUtilities.addImpulseAt(m,y,v.raycastResult.hitPointWorld))}},B.HavokRaycastVehicle=e,t.prototype.updateWheel=function(e){var t,n=this.raycastResult;this.isInContact?(t=BABYLON.Vector3.Dot(n.hitNormalWorld,this.raycastResult.directionWorld),n.hitPointWorld.subtractToRef(B.HavokVehicleUtilities.bodyPosition(e,new BABYLON.Vector3),B.HavokVehicleUtilities.relpos),B.HavokVehicleUtilities.velocityAt(e,B.HavokVehicleUtilities.relpos,B.HavokVehicleUtilities.chassis_velocity_at_contactPoint),e=BABYLON.Vector3.Dot(n.hitNormalWorld,B.HavokVehicleUtilities.chassis_velocity_at_contactPoint),-.1<=t?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(this.suspensionRelativeVelocity=e*(e=-1/t),this.clippedInvContactDotSuspension=e)):(this.raycastResult.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,n.hitNormalWorld.copyFrom(this.raycastResult.directionWorld).scaleInPlace(-1),this.clippedInvContactDotSuspension=1)},B.HavokWheelInfo=t,n.calcRollingFriction=function(e,t,n,o,i){var r=0,a=n,l=B.HavokVehicleUtilities.calcRollingFriction_vel1,s=B.HavokVehicleUtilities.calcRollingFriction_vel2,u=B.HavokVehicleUtilities.calcRollingFriction_vel;B.HavokVehicleUtilities.velocityAt(e,a,l),B.HavokVehicleUtilities.velocityAt(t,a,s),l.subtractToRef(s,u);return r=(r=i<(r=-BABYLON.Vector3.Dot(o,u)*(1/(B.HavokVehicleUtilities.computeImpulseDenominator(e,n,o)+B.HavokVehicleUtilities.computeImpulseDenominator(t,n,o))))?i:r)<-i?-i:r},n.computeImpulseDenominator=function(e,t,n){var o=B.HavokVehicleUtilities.computeImpulseDenominator_r0,i=B.HavokVehicleUtilities.computeImpulseDenominator_c0,r=B.HavokVehicleUtilities.computeImpulseDenominator_vec,a=B.HavokVehicleUtilities.computeImpulseDenominator_m;return t.subtractToRef(B.HavokVehicleUtilities.bodyPosition(e,new BABYLON.Vector3),o),BABYLON.Vector3.CrossToRef(o,n,i),B.HavokVehicleUtilities.bodyInertiaWorld(e,new BABYLON.Vector3).multiplyToRef(i,a),BABYLON.Vector3.CrossToRef(a,o,r),B.HavokVehicleUtilities.bodyInvMass(e)+BABYLON.Vector3.Dot(n,r)},n.resolveSingleBilateral=function(e,t,n,o,i){if(1.1<i.lengthSquared())return 0;var r=B.HavokVehicleUtilities.resolveSingleBilateral_vel1,a=B.HavokVehicleUtilities.resolveSingleBilateral_vel2,l=B.HavokVehicleUtilities.resolveSingleBilateral_vel;B.HavokVehicleUtilities.velocityAt(e,t,r),B.HavokVehicleUtilities.velocityAt(n,o,a),r.subtractToRef(a,l);return-.1*BABYLON.Vector3.Dot(i,l)*(1/(B.HavokVehicleUtilities.bodyInvMass(e)+B.HavokVehicleUtilities.bodyInvMass(n)))},n.directions=[new BABYLON.Vector3(1,0,0),new BABYLON.Vector3(0,1,0),new BABYLON.Vector3(0,0,1)],n.calcRollingFriction_vel1=new BABYLON.Vector3,n.calcRollingFriction_vel2=new BABYLON.Vector3,n.calcRollingFriction_vel=new BABYLON.Vector3,n.updateFriction_surfNormalWS_scaled_proj=new BABYLON.Vector3,n.updateFriction_axle=[],n.updateFriction_forwardWS=[],n.sideFrictionStiffness2=1,n.castRay_rayvector=new BABYLON.Vector3,n.castRay_target=new BABYLON.Vector3,n.torque=new BABYLON.Vector3,n.tmpVec1=new BABYLON.Vector3,n.tmpVec2=new BABYLON.Vector3,n.tmpVec3=new BABYLON.Vector3,n.tmpVec4=new BABYLON.Vector3,n.tmpVec5=new BABYLON.Vector3,n.tmpVec6=new BABYLON.Vector3,n.tmpVel2=new BABYLON.Vector3,n.tmpMat1=new BABYLON.Matrix,n.velocityAt=function(e,t,n){return e.getObjectCenterWorldToRef(B.HavokVehicleUtilities.tmpVel2),t.subtractToRef(B.HavokVehicleUtilities.tmpVel2,n),e.getAngularVelocityToRef(B.HavokVehicleUtilities.tmpVel2),BABYLON.Vector3.CrossToRef(B.HavokVehicleUtilities.tmpVel2,n,n),e.getLinearVelocityToRef(B.HavokVehicleUtilities.tmpVel2),n.addInPlace(B.HavokVehicleUtilities.tmpVel2),n},n.bodyPosition=function(e,t){return e.getObjectCenterWorldToRef(t),t},n.bodyLinearVelocity=function(e,t){return e.getLinearVelocityToRef(t),t},n.bodyAngularVelocity=function(e,t){return e.getAngularVelocityToRef(t),t},n.bodyTransform=function(e,t){return t.copyFrom(e.transformNode.getWorldMatrix()),t},n.addImpulseAt=function(e,t,n){e.applyImpulse(t,n)},n.addForceAt=function(e,t,n){e.applyForce(t,n)},n.bodyOrientation=function(e,t){return t.copyFrom(e.transformNode.rotationQuaternion),t},n.bodyMass=function(e){return e.getMassProperties().mass},n.bodyInvMass=function(e){e=e.getMassProperties().mass;return 0<e?1/e:0},n.bodyInertiaWorld=function(e,t){var n=e.getMassProperties();return t.copyFrom(n.inertia),BABYLON.Vector3.TransformNormalToRef(t,e.transformNode.getWorldMatrix(),t),t.x=0<t.x?1/t.x:0,t.y=0<t.y?1/t.y:0,t.z=0<t.z?1/t.z:0,t},n.computeImpulseDenominator_r0=new BABYLON.Vector3,n.computeImpulseDenominator_c0=new BABYLON.Vector3,n.computeImpulseDenominator_vec=new BABYLON.Vector3,n.computeImpulseDenominator_m=new BABYLON.Vector3,n.resolveSingleBilateral_vel1=new BABYLON.Vector3,n.resolveSingleBilateral_vel2=new BABYLON.Vector3,n.resolveSingleBilateral_vel=new BABYLON.Vector3,n.chassis_velocity_at_contactPoint=new BABYLON.Vector3,n.relpos=new BABYLON.Vector3,n.Utilsdefaults=function(e,t){for(var n in e=e||{},t)n in e||(e[n]=t[n]);return e},B.HavokVehicleUtilities=n}(UNITY=UNITY||{}),this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}()),__extends=(!function(i){t=i.ScriptComponent,__extends(n,t),n.prototype.isReady=function(){return this.m_agentReady},n.prototype.isNavigating=function(){return null!=this.m_agentDestination},n.prototype.isTeleporting=function(){return this.teleporting},n.prototype.isOnOffMeshLink=function(){return this.m_agentState===i.CrowdAgentState.DT_CROWDAGENT_STATE_OFFMESH},n.prototype.getAgentType=function(){return this.type},n.prototype.getAgentState=function(){return this.m_agentState},n.prototype.getAgentIndex=function(){return this.m_agentIndex},n.prototype.getAgentOffset=function(){return this.baseOffset},n.prototype.getTargetDistance=function(){return this.distanceToTarget},n.prototype.getCurrentPosition=function(){return this.currentPosition},n.prototype.getCurrentRotation=function(){return this.currentRotation},n.prototype.getCurrentVelocity=function(){return this.currentVelocity},n.prototype.getAgentParameters=function(){return this.m_agentParams},n.prototype.setAgentParameters=function(e){this.m_agentParams=e,this.updateAgentParameters()},n.prototype.awake=function(){this.awakeNavigationAgent()},n.prototype.update=function(){this.updateNavigationAgent()},n.prototype.destroy=function(){this.destroyNavigationAgent()},n.prototype.awakeNavigationAgent=function(){this.type=this.getProperty("type",this.type),this.speed=this.getProperty("speed",this.speed),this.baseOffset=this.getProperty("offset",this.baseOffset),this.angularSpeed=this.getProperty("angularspeed",this.angularSpeed),this.acceleration=this.getProperty("acceleration",this.acceleration),this.stoppingDistance=this.getProperty("stoppingdistance",this.stoppingDistance),this.autoBraking=this.getProperty("autobraking",this.autoBraking),this.avoidRadius=this.getProperty("avoidradius",this.avoidRadius),this.avoidHeight=this.getProperty("avoidheight",this.avoidHeight),this.obstacleAvoidanceType=this.getProperty("avoidquality",this.obstacleAvoidanceType),this.avoidancePriority=this.getProperty("avoidpriority",this.avoidancePriority),this.autoTraverseOffMeshLink=this.getProperty("autotraverse",this.autoTraverseOffMeshLink),this.autoRepath=this.getProperty("autopepath",this.autoRepath),this.areaMask=this.getProperty("areamask",this.areaMask),i.Utilities.ValidateTransformQuaternion(this.transform),this.m_agentGhost=new BABYLON.TransformNode(this.transform.name+".Agent",this.scene),this.m_agentGhost.position=new BABYLON.Vector3(0,0,0),this.m_agentGhost.rotation=new BABYLON.Vector3(0,0,0),i.Utilities.ValidateTransformQuaternion(this.m_agentGhost),this.m_agentGhost.position.copyFrom(this.transform.position),this.lastPosition.copyFrom(this.transform.position)},n.prototype.updateNavigationAgent=function(){var e,t=i.SceneManager.GetCrowdInterface(this.scene);null!=t&&(this.m_agentIndex<0?(this.m_agentParams={radius:this.avoidRadius,height:this.avoidHeight,maxSpeed:this.speed,maxAcceleration:this.acceleration,collisionQueryRange:2,pathOptimizationRange:20,separationWeight:1},i.Utilities.GetAbsolutePositionToRef(this.transform,this.resetPosition),this.m_agentIndex=t.addAgent(this.resetPosition,this.m_agentParams,this.m_agentGhost),0<=this.m_agentIndex&&(this.m_agentReady=!0,this.onReadyObservable)&&this.onReadyObservable.hasObservers()&&this.onReadyObservable.notifyObservers(this.transform)):(this.m_agentState=t.getAgentState(this.m_agentIndex),this.getAgentWaypointToRef(this.currentWaypoint),this.getAgentPositionToRef(this.currentPosition),this.distancePosition.copyFrom(this.currentPosition),this.isOnOffMeshLink()?(this.currentPosition.subtractToRef(this.lastPosition,this.currentVelocity),this.currentVelocity.scaleInPlace(this.speed*this.offMeshVelocity)):this.getAgentVelocityToRef(this.currentVelocity),this.onPreUpdateObservable&&this.onPreUpdateObservable.hasObservers()&&this.onPreUpdateObservable.notifyObservers(this.transform),this.currentPosition.y+=this.baseOffset+this.heightOffset,this.currentVelocity.length()>=this.velocityEpsilon&&(this.currentVelocity.normalize(),t=this.angularSpeed*i.NavigationAgent.ANGULAR_SPEED_RATIO*this.getDeltaSeconds(),this.isOnOffMeshLink()?(this.moveDirection.copyFrom(this.m_agentDirection),this.m_agentDirection.set(this.moveDirection.x+(this.currentVelocity.x-this.moveDirection.x),this.moveDirection.y+(this.currentVelocity.y-this.moveDirection.y),this.moveDirection.z+(this.currentVelocity.z-this.moveDirection.z)),this.m_agentDirection.normalize(),e=i.NavigationAgent.TARGET_ANGLE_FACTOR-Math.atan2(this.m_agentDirection.x,this.m_agentDirection.z),BABYLON.Quaternion.FromEulerAnglesToRef(0,e,0,this.currentRotation),this.isNavigating()&&!0===this.updateRotation&&BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.currentRotation,t,this.transform.rotationQuaternion)):(this.m_agentQuaternion.copyFrom(this.transform.rotationQuaternion),this.isNavigating()&&!0===this.updateRotation&&this.transform.lookAt(this.currentWaypoint),this.transform.rotationQuaternion.toEulerAnglesToRef(this.m_agentDirection),BABYLON.Quaternion.FromEulerAnglesToRef(0,this.m_agentDirection.y,0,this.currentRotation),this.isNavigating()&&!0===this.updateRotation&&BABYLON.Quaternion.SlerpToRef(this.m_agentQuaternion,this.currentRotation,t,this.transform.rotationQuaternion))),this.isNavigating()&&!0===this.updatePosition&&this.transform.position.copyFrom(this.currentPosition),this.isNavigating()?(this.distanceToTarget=BABYLON.Vector3.Distance(this.distancePosition,this.m_agentDestination),this.distanceToTarget<=Math.max(this.distanceEpsilon,this.stoppingDistance)&&(this.cancelNavigation(),this.onNavCompleteObservable)&&this.onNavCompleteObservable.hasObservers()&&this.onNavCompleteObservable.notifyObservers(this.transform)):this.distanceToTarget=0,this.lastPosition.copyFrom(this.currentPosition),this.onPostUpdateObservable&&this.onPostUpdateObservable.hasObservers()&&this.onPostUpdateObservable.notifyObservers(this.transform),this.teleporting=!1))},n.prototype.updateAgentParameters=function(){var e=i.SceneManager.GetCrowdInterface(this.scene);null!=e&&0<=this.m_agentIndex&&e.updateAgentParameters(this.m_agentIndex,this.m_agentParams)},n.prototype.destroyNavigationAgent=function(){this.m_agentIndex=-1,this.m_agentReady=!1,this.m_agentMovement=null,this.m_agentDirection=null,this.m_agentDestination=null,this.moveDirection=null,this.resetPosition=null,this.lastPosition=null,this.currentPosition=null,this.currentRotation=null,this.currentVelocity=null,this.currentWaypoint=null,this.onReadyObservable.clear(),this.onReadyObservable=null,this.onPreUpdateObservable.clear(),this.onPreUpdateObservable=null,this.onPostUpdateObservable.clear(),this.onPostUpdateObservable=null,this.onNavCompleteObservable.clear(),(this.onNavCompleteObservable=null)!=this.m_agentGhost&&(this.m_agentGhost.dispose(),this.m_agentGhost=null)},n.prototype.move=function(e,t){void 0===t&&(t=!0);var n=i.SceneManager.GetNavigationTools(),o=i.SceneManager.GetCrowdInterface(this.scene);null!=n&&null!=o?(o.getAgentPosition(this.m_agentIndex).addToRef(e,this.m_agentMovement),this.m_agentDestination=!0===t?n.getClosestPoint(this.m_agentMovement):this.m_agentMovement.clone(),0<=this.m_agentIndex&&o.agentGoto(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.teleport=function(e,t){void 0===t&&(t=!0);var n=i.SceneManager.GetNavigationTools(),o=i.SceneManager.GetCrowdInterface(this.scene);null!=n&&null!=o?(this.teleporting=!0,this.m_agentDestination=!0===t?n.getClosestPoint(e):e.clone(),0<=this.m_agentIndex&&o.agentTeleport(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.setDestination=function(e,t){void 0===t&&(t=!0);var n=i.SceneManager.GetNavigationTools(),o=i.SceneManager.GetCrowdInterface(this.scene);null!=n&&null!=o?(this.m_agentDestination=!0===t?n.getClosestPoint(e):e.clone(),0<=this.m_agentIndex&&o.agentGoto(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.getAgentVelocity=function(){var e=i.SceneManager.GetCrowdInterface(this.scene);return null!=e&&0<=this.m_agentIndex?e.getAgentVelocity(this.m_agentIndex):null},n.prototype.getAgentVelocityToRef=function(e){var t=i.SceneManager.GetCrowdInterface(this.scene);null!=t&&0<=this.m_agentIndex&&t.getAgentVelocityToRef(this.m_agentIndex,e)},n.prototype.getAgentPosition=function(){var e=i.SceneManager.GetCrowdInterface(this.scene);return null!=e&&0<=this.m_agentIndex?e.getAgentPosition(this.m_agentIndex):null},n.prototype.getAgentPositionToRef=function(e){var t=i.SceneManager.GetCrowdInterface(this.scene);null!=t&&0<=this.m_agentIndex&&t.getAgentPositionToRef(this.m_agentIndex,e)},n.prototype.getAgentWaypoint=function(){var e=i.SceneManager.GetCrowdInterface(this.scene);return null!=e&&0<=this.m_agentIndex?e.getAgentNextTargetPath(this.m_agentIndex):null},n.prototype.getAgentWaypointToRef=function(e){var t=i.SceneManager.GetCrowdInterface(this.scene);null!=t&&0<=this.m_agentIndex&&t.getAgentNextTargetPathToRef(this.m_agentIndex,e)},n.prototype.cancelNavigation=function(){this.m_agentDestination=null;var e=i.SceneManager.GetCrowdInterface(this.scene),t=this.getAgentPosition();null!=t&&null!=e&&0<=this.m_agentIndex&&e.agentTeleport(this.m_agentIndex,t)},n.TARGET_ANGLE_FACTOR=.5*Math.PI,n.ANGULAR_SPEED_RATIO=.05;var t,e=n;function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.distanceToTarget=0,e.teleporting=!1,e.moveDirection=new BABYLON.Vector3(0,0,0),e.resetPosition=new BABYLON.Vector3(0,0,0),e.lastPosition=new BABYLON.Vector3(0,0,0),e.distancePosition=new BABYLON.Vector3(0,0,0),e.currentPosition=new BABYLON.Vector3(0,0,0),e.currentRotation=new BABYLON.Quaternion(0,0,0,1),e.currentVelocity=new BABYLON.Vector3(0,0,0),e.currentWaypoint=new BABYLON.Vector3(0,0,0),e.heightOffset=0,e.angularSpeed=0,e.updatePosition=!0,e.updateRotation=!0,e.distanceEpsilon=.1,e.velocityEpsilon=1.1,e.offMeshVelocity=1.5,e.stoppingDistance=0,e.onReadyObservable=new BABYLON.Observable,e.onPreUpdateObservable=new BABYLON.Observable,e.onPostUpdateObservable=new BABYLON.Observable,e.onNavCompleteObservable=new BABYLON.Observable,e.m_agentState=0,e.m_agentIndex=-1,e.m_agentReady=!1,e.m_agentGhost=null,e.m_agentParams=null,e.m_agentMovement=new BABYLON.Vector3(0,0,0),e.m_agentDirection=new BABYLON.Vector3(0,0,1),e.m_agentQuaternion=new BABYLON.Quaternion(0,0,0,1),e.m_agentDestination=null,e}i.NavigationAgent=e,(e=i.CrowdAgentState||(i.CrowdAgentState={}))[e.DT_CROWDAGENT_STATE_INVALID=0]="DT_CROWDAGENT_STATE_INVALID",e[e.DT_CROWDAGENT_STATE_WALKING=1]="DT_CROWDAGENT_STATE_WALKING",e[e.DT_CROWDAGENT_STATE_OFFMESH=2]="DT_CROWDAGENT_STATE_OFFMESH"}(UNITY=UNITY||{}),!function(l){function e(e,t,n){this._centerMass=new BABYLON.Vector3(0,0,0),this._chassisMesh=null,this._tempVectorPos=new BABYLON.Vector3(0,0,0),this.lockedWheelIndexes=null,this.m_vehicleColliders=null,this.m_vehicle=null,this.m_scene=null,this._chassisMesh=t,this._centerMass=n,this.m_vehicleColliders=null!=this._chassisMesh.metadata&&null!=this._chassisMesh.metadata.unity&&null!=this._chassisMesh.metadata.unity.wheels?this._chassisMesh.metadata.unity.wheels:null,this.m_vehicle=new l.HavokRaycastVehicle({chassisBody:this._chassisMesh.physicsBody}),this.m_scene=e,this.setupWheelInformation();t=this.m_scene.getPhysicsEngine();null!=t&&this.m_vehicle.addToWorld(t)}e.prototype.getNumWheels=function(){if(null!=this.m_vehicle)return this.m_vehicle.getNumWheels()},e.prototype.getWheelInfo=function(e){if(null!=this.m_vehicle)return this.m_vehicle.getWheelInfo(e)},e.prototype.setEngineForce=function(e,t){null!=this.m_vehicle&&this.m_vehicle.applyEngineForce(-e,t)},e.prototype.setBrakingForce=function(e,t){null!=this.m_vehicle&&this.m_vehicle.setBrake(e,t)},e.prototype.getWheelTransform=function(e){if(null!=this.m_vehicle)return this.m_vehicle.getWheelTransformWorld(e)},e.prototype.updateWheelTransform=function(e){null!=this.m_vehicle&&this.m_vehicle.updateWheelTransform(e)},e.prototype.getRawCurrentSpeedKph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()},e.prototype.getRawCurrentSpeedMph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()*l.System.Kph2Mph},e.prototype.getAbsCurrentSpeedKph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())},e.prototype.getAbsCurrentSpeedMph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())*l.System.Kph2Mph},e.prototype.dispose=function(){this.deleteWheelInformation(),this.m_vehicleColliders=null},e.prototype.getWheelIndexByID=function(e){var t=-1;if(null!=this.m_vehicleColliders&&0<this.m_vehicleColliders.length)for(var n=0;n<this.m_vehicleColliders.length;n++){var o=this.m_vehicleColliders[n];if(e.toLowerCase()===o.id.toLowerCase()){t=n;break}}return t},e.prototype.getWheelIndexByName=function(e){var t=-1;if(null!=this.m_vehicleColliders&&0<this.m_vehicleColliders.length)for(var n=0;n<this.m_vehicleColliders.length;n++){var o=this.m_vehicleColliders[n];if(e.toLowerCase()===o.name.toLowerCase()){t=n;break}}return t},e.prototype.getWheelColliderInfo=function(e){var t=-1;return t=null!=this.m_vehicleColliders&&0<this.m_vehicleColliders.length&&this.m_vehicleColliders.length>e?this.m_vehicleColliders[e]:t},e.prototype.getVisualSteeringAngle=function(e){var t=0,e=this.getWheelInfo(e);return t=null!=e&&null!=e.steeringAngle?e.steeringAngle:t},e.prototype.setVisualSteeringAngle=function(e,t){t=this.getWheelInfo(t);null!=t&&(t.steeringAngle=e)},e.prototype.getPhysicsSteeringAngle=function(e){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getSteeringValue(e))},e.prototype.setPhysicsSteeringAngle=function(e,t){null!=this.m_vehicle&&this.m_vehicle.setSteeringValue(e,t)},e.prototype.getStabilizingForce=function(){var e=-1;return e=null!=this.m_vehicle&&null!=this.m_vehicle.chassisBody?this.m_vehicle.chassisBody.getGravityFactor():e},e.prototype.setStabilizingForce=function(e){null!=this.m_vehicle&&null!=this.m_vehicle.chassisBody&&this.m_vehicle.chassisBody.setGravityFactor(e)},e.prototype.getSmoothFlyingImpulse=function(){var e=-1;return e=null!=this.m_vehicle?this.m_vehicle.smoothFlyingImpulse:e},e.prototype.setSmoothFlyingImpulse=function(e){null!=this.m_vehicle&&(this.m_vehicle.smoothFlyingImpulse=e)},e.prototype.setupWheelInformation=function(){if(null!=this.m_vehicle&&null!=this.m_vehicleColliders&&0<this.m_vehicleColliders.length){for(var e=-1,t=0,e=0;e<this.m_vehicleColliders.length;e++){var n=this.m_vehicleColliders[e],o=null!=n.name?n.name:"Unknown",i=null!=n.radius?n.radius:.35,r=null!=n.position&&3<=n.position.length?n.position[0]:1,a=null!=n.position&&3<=n.position.length?n.position[2]:-1,l=null!=n.wheelconnectionpoint?n.wheelconnectionpoint:.5,s=null!=n.suspensionrestlength?n.suspensionrestlength:.3,o=null!=n.frontwheel||0<=o.toLowerCase().indexOf("front"),u=-this._centerMass.x,c=-this._centerMass.z,t=null!=n.frictionslip?n.frictionslip:10,d=null!=n.totalsuspensionforces?n.totalsuspensionforces:1e5,p=null!=n.suspensiontravelcm?n.suspensiontravelcm:100,h=null!=n.rollinfluence?n.rollinfluence:.2,m=null!=n.suspensionstiffness?n.suspensionstiffness:50,g=null!=n.dampingcompression?n.dampingcompression:2.5,n=null!=n.dampingrelaxation?n.dampingrelaxation:4.5,r=new BABYLON.Vector3(r+u,l,a+c);this.m_vehicle.addWheel({radius:i,isFrontWheel:o,directionLocal:new BABYLON.Vector3(0,-1,0),suspensionStiffness:m,suspensionRestLength:s,frictionSlip:t,dampingRelaxation:n,dampingCompression:g,maxSuspensionForce:d,rollInfluence:h,axleLocal:new BABYLON.Vector3(-1,0,0),chassisConnectionPointLocal:r,maxSuspensionTravel:p})}if(this.m_vehicle.getNumWheels()===this.m_vehicleColliders.length)for(e=0;e<this.m_vehicleColliders.length;e++){var f=this.m_vehicle.getWheelInfo(e);null!=f&&(f.steeringAngle=0,f.rotationBoost=0,f.defaultFriction=t)}else BABYLON.Tools.Warn("Failed to create proper number of wheels for: "+this._chassisMesh.name)}},e.prototype.tickVehicleController=function(e){null!=this.m_vehicle&&this.m_vehicle.updateVehicle(e)},e.prototype.updateWheelInformation=function(){var e=this.m_vehicle.getCurrentSpeedKmHour(),t=this.getNumWheels();if(0<t)for(var n=0;n<t;n++){var o,i,r,a=this.getWheelInfo(n);null!=a&&(a.locked=this.lockedWheelInformation(n),this.updateWheelTransform(n),null!=(o=this.getWheelTransform(n))&&this._tempVectorPos.copyFrom(o.position),null!=a.hub)&&null!=(o=a.hub).parent&&(l.Utilities.InverseTransformPointToRef(o.parent,this._tempVectorPos,this._tempVectorPos),o.position.y=this._tempVectorPos.y,r=null!=a.steeringAngle?a.steeringAngle:0,BABYLON.Quaternion.FromEulerAnglesToRef(0,r,0,o.rotationQuaternion),null!=a.spinner)&&!1===a.locked&&(r=this.m_scene.getEngine().getDeltaTime()/1e3,o=2*Math.PI*a.radius,i=null!=a.rotationBoost?a.rotationBoost:0,r=BABYLON.Tools.ToRadians(e*r/o*360)+i*Math.sign(e),a.spinner.addRotation(r,0,0))}},e.prototype.lockedWheelInformation=function(e){var t=!1;if(null!=this.lockedWheelIndexes&&0<this.lockedWheelIndexes.length)for(var n=0;n<this.lockedWheelIndexes.length;n++)if(this.lockedWheelIndexes[n]===e){t=!0;break}return t},e.prototype.deleteWheelInformation=function(){var e=this.getNumWheels();if(0<e)for(var t=0;t<e;t++){var n=this.getWheelInfo(t);null!=n&&(n.hub=null,n.spinner=null,n.steeringAngle=0,n.rotationBoost=0,n.defaultFriction=0)}},l.RaycastVehicle=e}(UNITY=UNITY||{}),this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}()),__awaiter=this&&this.__awaiter||function(e,a,l,s){return new(l=l||Promise)(function(n,t){function o(e){try{r(s.next(e))}catch(e){t(e)}}function i(e){try{r(s.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(o,i)}r((s=s.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(o,i){var r,a,l,s={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]},u={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function e(n){return function(e){var t=[n,e];if(r)throw new TypeError("Generator is already executing.");for(;s=u&&t[u=0]?0:s;)try{if(r=1,a&&(l=2&t[0]?a.return:t[0]?a.throw||((l=a.return)&&l.call(a),0):a.next)&&!(l=l.call(a,t[1])).done)return l;switch(a=0,(t=l?[2&t[0],l.value]:t)[0]){case 0:case 1:l=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(l=0<(l=s.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3]))s.label=t[1];else if(6===t[0]&&s.label<l[1])s.label=l[1],l=t;else{if(!(l&&s.label<l[2])){l[2]&&s.ops.pop(),s.trys.pop();continue}s.label=l[2],s.ops.push(t)}}t=i.call(o,s)}catch(e){t=[6,e],a=0}finally{r=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__extends=(!function(P){t=P.ScriptComponent,__extends(n,t),n.prototype.awake=function(){this.awakeRigidbodyState()},n.prototype.update=function(){this.updateRigidbodyState()},n.prototype.late=function(){this.lateRigidbodyState()},n.prototype.destroy=function(){this.destroyRigidbodyState()},n.prototype.awakeRigidbodyState=function(){this._isKinematic=this.getProperty("isKinematic",this._isKinematic),null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.physics&&(this._centerOfMass=null!=this.transform.metadata.unity.physics.center?P.Utilities.ParseVector3(this.transform.metadata.unity.physics.center,this._centerOfMass):this._centerOfMass),this.hasWheelColliders()&&(this.m_raycastVehicle=new P.RaycastVehicle(this.scene,this.transform,this._centerOfMass),P.Utilities.ShowDebugColliders())&&console.log("Raycase Vehicle Created For: "+this.transform.name)},n.prototype.updateRigidbodyState=function(){null!=this.m_raycastVehicle&&this.m_raycastVehicle.updateWheelInformation()},n.prototype.lateRigidbodyState=function(){null!=this.m_raycastVehicle&&this.m_raycastVehicle.tickVehicleController(P.RigidbodyPhysics.PHYSICS_STEP_TIME)},n.prototype.destroyRigidbodyState=function(){null!=this.m_raycastVehicle&&(this.m_raycastVehicle.dispose(),this.m_raycastVehicle=null)},n.prototype.isKinematic=function(){return this._isKinematic},n.prototype.hasWheelColliders=function(){return null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.wheels},n.prototype.getRaycastVehicle=function(){return this.m_raycastVehicle},n.GetHavokInstance=function(){return globalThis.HK},n.GetHavokPlugin=function(){return globalThis.HKP},n.Raycast=function(e,t,n,o){return null==P.RigidbodyPhysics.RaycastResult&&(P.RigidbodyPhysics.RaycastResult=new BABYLON.PhysicsRaycastResult),null==P.RigidbodyPhysics.RaycastDestination&&(P.RigidbodyPhysics.RaycastDestination=new BABYLON.Vector3(0,0,0)),P.RigidbodyPhysics.RaycastResult.reset(),P.RigidbodyPhysics.RaycastDestination.set(0,0,0),P.Utilities.CalculateDestinationPointToRef(e,t,n,P.RigidbodyPhysics.RaycastDestination),P.RigidbodyPhysics.RaycastToRef(e,P.RigidbodyPhysics.RaycastDestination,P.RigidbodyPhysics.RaycastResult,o),P.RigidbodyPhysics.RaycastResult},n.Shapecast=function(e){return null==P.RigidbodyPhysics.LocalShapeResult&&(P.RigidbodyPhysics.LocalShapeResult=new BABYLON.ShapeCastResult),null==P.RigidbodyPhysics.WorldShapeResult&&(P.RigidbodyPhysics.WorldShapeResult=new BABYLON.ShapeCastResult),P.RigidbodyPhysics.LocalShapeResult.reset(),P.RigidbodyPhysics.WorldShapeResult.reset(),P.RigidbodyPhysics.ShapecastToRef(e,P.RigidbodyPhysics.LocalShapeResult,P.RigidbodyPhysics.WorldShapeResult),{local:P.RigidbodyPhysics.LocalShapeResult,world:P.RigidbodyPhysics.WorldShapeResult}},n.RaycastToRef=function(e,t,n,o){var i=P.RigidbodyPhysics.GetHavokPlugin();i?i.raycast(e,t,n,o):BABYLON.Tools.Warn("Havok.js physics library not loaded")},n.ShapecastToRef=function(e,t,n){var o=P.RigidbodyPhysics.GetHavokPlugin();o?o.shapeCast(e,t,n):BABYLON.Tools.Warn("Havok.js physics library not loaded")},n.SetMaxVelocities=function(e,t){var n,o=P.RigidbodyPhysics.GetHavokPlugin();o?(n=o._hknp.HEAP8.buffer,o=new Int32Array(n,Number(o.world),100),o=new Int32Array(n,o[8],500),o=new Int32Array(n,o[428],100),(n=new Float32Array(n,o[8],300))[32]=e,n[33]=t,n[60]=e,n[61]=t,n[88]=e,n[89]=t,n[144]=e,n[145]=t,n[172]=e,n[173]=t,n[200]=e,n[201]=t,n[228]=e):BABYLON.Tools.Warn("Havok.js physics library not loaded")},n.ConfigurePhysicsEngine=function(r,a,l,e,t,n,s){var u;return void 0===a&&(a=!0),void 0===l&&(l=0),void 0===e&&(e=0),void 0===t&&(t=!0),void 0===n&&(n=1e-4),void 0===s&&(s=null),__awaiter(this,void 0,void 0,function(){var t,n,o,i;return __generator(this,function(e){switch(e.label){case 0:if(!BABYLON.HavokPlugin)return[3,8];BABYLON.Tools.Log("Havok.js physics engine initializing..."),e.label=1;case 1:return(e.trys.push([1,6,7,8]),r.isPhysicsEnabled())?[3,4]:null!=(t=P.RigidbodyPhysics.GetHavokInstance())?[3,3]:(n=globalThis,[4,BABYLON.HavokPhysics()]);case 2:n.HK=e.sent(),t=globalThis.HK,e.label=3;case 3:return o=new BABYLON.Vector3(0,-9.81,0),o=null!=s?s:o,globalThis.HKP=new BABYLON.HavokPlugin(a,t),r.enablePhysics(o,globalThis.HKP),[3,5];case 4:BABYLON.Tools.Warn("Havok.js physics plugin already enabled"),e.label=5;case 5:return[3,8];case 6:return o=e.sent(),console.warn(o),[3,8];case 7:P.RigidbodyPhysics.PhysicsShapeCache={},P.RigidbodyPhysics.NewPhysicsShapeCount=0,P.RigidbodyPhysics.CachedPhysicsShapeCount=0;try{0<l&&null!=(u=r.getPhysicsEngine())&&u.setSubTimeStep(l),i=P.RigidbodyPhysics.GetPhysicsHeapSize(),BABYLON.Tools.Log("Havok.js initialized with a heap size of "+i+" MB")}catch(e){console.warn(e)}try{null!=P.RigidbodyPhysics.OnSetupPhysicsPlugin&&P.RigidbodyPhysics.OnSetupPhysicsPlugin(r)}catch(e){console.warn(e)}return[7];case 8:return[2]}})})},n.SetupPhysicsComponent=function(c,d){var p,h,e,t,n,o,u,m,g,f,y,i,v,_,B,b,C,r,a,l,s,T,I,S,A,O,M,x,N,L=null!=d.metadata&&null!=d.metadata.unity?d.metadata.unity:null,w=null!=L.layermask?L.layermask:-1;null==L||null==L.physics&&null==L.collision||(S=null!=L.physics,p=null!=L.physics&&null!=L.physics.filter?L.physics.filter:-1,l=null!=L.physics&&null!=L.physics.vehicle&&L.physics.vehicle,h=null!=L.physics&&null!=L.physics.root&&L.physics.root,T=null!=L.collision&&null!=L.collision.compoundcolliders,e=null!=L.physics&&null!=L.physics.mass?L.physics.mass:0,t=null!=L.physics&&null!=L.physics.center?L.physics.center:{x:0,y:0,z:0},s=null==L.physics||null==L.physics.kinematic||L.physics.kinematic,n=null==L.physics||null==L.physics.truestatic||L.physics.truestatic,N=BABYLON.PhysicsMotionType.DYNAMIC,N=!0===n?BABYLON.PhysicsMotionType.STATIC:!0===s?BABYLON.PhysicsMotionType.ANIMATED:BABYLON.PhysicsMotionType.DYNAMIC,!0==S&&(l&&((o=null)!=(s=d.getChildren(null,!1))&&0<s.length&&s.forEach(function(e){var t;null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.collision&&null!=(t=null!=(t=e.metadata.unity.collision).wheelinformation?t.wheelinformation:null)&&(P.Utilities.ShowDebugColliders()&&console.log("Setup raycast wheel collider: "+e.name+" --\x3e on to: "+d.name,d),(o=null==o?[]:o).push(t))}),null!=o)&&0<o.length&&(null==d.metadata&&(d.metadata={}),null==d.metadata.unity&&(d.metadata.unity={}),d.metadata.unity.wheels=o),T?null!=(S=L.collision.compoundcolliders)&&0<S.length&&(g=m=u=0,f=!1,y=[],S.forEach(function(e){var t=null!=e.type?e.type:"BoxCollider",n=null!=e.dynamicfriction?e.dynamicfriction:.6,o=null!=e.staticfriction?e.staticfriction:.6,i=null!=e.restitution?e.restitution:0,r=null!=e.trigger&&e.trigger,o=(u<n&&(u=n),m<o&&(m=o),g<i&&(g=i),1==r&&(f=!0),BABYLON.PhysicsImpostor.BoxImpostor),o="MeshCollider"===t?BABYLON.PhysicsImpostor.ConvexHullImpostor:"CapsuleCollider"===t?BABYLON.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===t?BABYLON.PhysicsImpostor.SphereImpostor:BABYLON.PhysicsImpostor.BoxImpostor,a=null!=e.center?e.center:{x:0,y:0,z:0},l=null!=e.persist&&e.persist,s=new P.PhyscisContainerData;P.Utilities.ShowDebugColliders()&&console.log("Setup simple compound child collider type ("+t+") --\x3e on to: "+d.name,d),P.RigidbodyPhysics.CreateCompoundPhysicsShapeAndBody(c,d,d,e,o,n,i,y,s,a,!1,r,l,w,p)}),0<y.length)&&(P.Utilities.ReparentColliders()||d.setParent(null,!0,!0),I=new BABYLON.Vector3(t.x,t.y,t.z),i=new BABYLON.PhysicsShapeContainer(c),y.forEach(function(e){i.addChild(e.shape,e.translation,e.rotation,e.scale)}),(l=new BABYLON.PhysicsBody(d,N,!1,c)).shape=i,P.RigidbodyPhysics.ConfigRigidbodyPhysics(c,d,!1,f,L.physics,e,I),P.Utilities.ShowDebugColliders()||"CenterBox-Material"===d.material.name&&(d.isVisible=!1),P.Utilities.ShowDebugColliders())&&(null==P.RigidbodyPhysics.DebugPhysicsViewer&&(P.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=P.RigidbodyPhysics.DebugPhysicsViewer)&&P.RigidbodyPhysics.DebugPhysicsViewer.showBody(l):h?(B=_=v=0,b=!1,C=[],r=null!=L.physics&&null!=L.physics.center?P.Utilities.ParseVector3(L.physics.center,BABYLON.Vector3.Zero()):BABYLON.Vector3.Zero(),null!=(s=d.getChildren(null,!0))&&0<s.length&&s.forEach(function(e){e.position.subtractInPlace(r)}),null!=(T=d.getChildren(null,!1))&&0<T.length&&T.forEach(function(e){var t,n,o,i,r,a,l,s,u;null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.collision&&(t=null!=(a=e.metadata.unity.collision).dynamicfriction?a.dynamicfriction:.6,r=null!=a.staticfriction?a.staticfriction:.6,n=null!=a.restitution?a.restitution:0,o=null!=a.trigger&&a.trigger,i=null!=a.type?a.type:"BoxCollider",v<t&&(v=t),_<r&&(_=r),B<n&&(B=n),1==o&&(b=!0),r=BABYLON.PhysicsImpostor.BoxImpostor,r="MeshCollider"===i?BABYLON.PhysicsImpostor.ConvexHullImpostor:"CapsuleCollider"===i?BABYLON.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===i?BABYLON.PhysicsImpostor.SphereImpostor:BABYLON.PhysicsImpostor.BoxImpostor,l=null!=(a=a).center?a.center:{x:0,y:0,z:0},s=null!=a.persist&&a.persist,u=new P.PhyscisContainerData,P.Utilities.ShowDebugColliders()&&console.log("Setup complex compound child collider type ("+i+") --\x3e on to: "+d.name,d),P.RigidbodyPhysics.CreateCompoundPhysicsShapeAndBody(c,d,e,a,r,t,n,C,u,l,h,o,s,w,p))}),0<C.length&&(P.Utilities.ReparentColliders()||d.setParent(null,!0,!0),I=new BABYLON.Vector3(t.x,t.y,t.z),a=new BABYLON.PhysicsShapeContainer(c),C.forEach(function(e){a.addChild(e.shape,e.translation,e.rotation,e.scale)}),(S=new BABYLON.PhysicsBody(d,N,!1,c)).shape=a,P.RigidbodyPhysics.ConfigRigidbodyPhysics(c,d,!1,b,L.physics,e,I),P.Utilities.ShowDebugColliders()||"CenterBox-Material"===d.material.name&&(d.isVisible=!1),P.Utilities.ShowDebugColliders())&&(null==P.RigidbodyPhysics.DebugPhysicsViewer&&(P.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=P.RigidbodyPhysics.DebugPhysicsViewer)&&P.RigidbodyPhysics.DebugPhysicsViewer.showBody(S)):null!=L.collision&&(l=null!=L.collision.type?L.collision.type:"BoxCollider",s=null!=L.collision.convexmesh&&L.collision.convexmesh,T=null!=L.collision.dynamicfriction?L.collision.dynamicfriction:.6,I=null!=L.collision.staticfriction?L.collision.staticfriction:.6,S=null!=L.collision.restitution?L.collision.restitution:0,A=null!=L.collision.terraindata?L.collision.terraindata:null,O=null!=L.collision.trigger&&L.collision.trigger,M=null!=L.collision.persist&&L.collision.persist,x=BABYLON.PhysicsImpostor.BoxImpostor,x="MeshCollider"===l?!0===s?BABYLON.PhysicsImpostor.ConvexHullImpostor:BABYLON.PhysicsImpostor.MeshImpostor:"TerrainCollider"===l?BABYLON.PhysicsImpostor.HeightmapImpostor:"CapsuleCollider"===l?BABYLON.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===l?BABYLON.PhysicsImpostor.SphereImpostor:BABYLON.PhysicsImpostor.BoxImpostor,P.RigidbodyPhysics.CreateStandardPhysicsShapeAndBody(c,d,L,x,O,n,N,e,I,T,S,A,t,M,w,p))))},n.GetCachedPhysicsMeshShape=function(e,t,n,o,i,r,a){var l;return null==n||""===n?(console.warn("Invalid mesh key specfifed for child collider: "+t.name),null):(null==(l=P.RigidbodyPhysics.PhysicsShapeCache[n+="_F"+o+"_R"+i+"_T0_L"+r+"_X"+a])?((l=new BABYLON.PhysicsShapeMesh(t,e)).material={friction:o,restitution:i},l.isTrigger=!1,l.filterMembershipMask=r,l.filterCollideMask=a,P.RigidbodyPhysics.NewPhysicsShapeCount++,P.RigidbodyPhysics.PhysicsShapeCache[n]=l):P.RigidbodyPhysics.CachedPhysicsShapeCount++,l)},n.GetCachedPhysicsConvexHullShape=function(e,t,n,o,i,r,a){var l;return null==n||""===n?(console.warn("Invalid mesh key specfifed for child collider: "+t.name),null):(null==(l=P.RigidbodyPhysics.PhysicsShapeCache[n+="_F"+o+"_R"+i+"_T0_L"+r+"_X"+a])?((l=new BABYLON.PhysicsShapeConvexHull(t,e)).material={friction:o,restitution:i},l.isTrigger=!1,l.filterMembershipMask=r,l.filterCollideMask=a,P.RigidbodyPhysics.NewPhysicsShapeCount++,P.RigidbodyPhysics.PhysicsShapeCache[n]=l):P.RigidbodyPhysics.CachedPhysicsShapeCount++,l)},n.GetCachedPhysicsBoxShape=function(e,t,n,o,i,r){var a="SHAPE_BOX_F"+n+"_R"+o+"_T"+(1==t?"1":"0")+"_L"+i+"_X"+r,l=P.RigidbodyPhysics.PhysicsShapeCache[a];return null==l?((l=new BABYLON.PhysicsShapeBox(new BABYLON.Vector3(0,0,0),new BABYLON.Quaternion(0,0,0,1),new BABYLON.Vector3(1,1,1),e)).material={friction:n,restitution:o},l.isTrigger=t,l.filterMembershipMask=i,l.filterCollideMask=r,P.RigidbodyPhysics.NewPhysicsShapeCount++,P.RigidbodyPhysics.PhysicsShapeCache[a]=l):P.RigidbodyPhysics.CachedPhysicsShapeCount++,l},n.GetCachedPhysicsSphereShape=function(e,t,n,o,i,r){var a="SHAPE_SPHERE_F"+n+"_R"+o+"_T"+(1==t?"1":"0")+"_L"+i+"_X"+r,l=P.RigidbodyPhysics.PhysicsShapeCache[a];return null==l?((l=new BABYLON.PhysicsShapeSphere(new BABYLON.Vector3(0,0,0),1,e)).material={friction:n,restitution:o},l.isTrigger=t,l.filterMembershipMask=i,l.filterCollideMask=r,P.RigidbodyPhysics.NewPhysicsShapeCount++,P.RigidbodyPhysics.PhysicsShapeCache[a]=l):P.RigidbodyPhysics.CachedPhysicsShapeCount++,l},n.GetCachedPhysicsCapsuleShape=function(e,t,n,o,i,r){var a="SHAPE_CAPSULE_F"+n+"_R"+o+"_T"+(1==t?"1":"0")+"_L"+i+"_X"+r,l=P.RigidbodyPhysics.PhysicsShapeCache[a];return null==l?((l=new BABYLON.PhysicsShapeCapsule(new BABYLON.Vector3(0,-1,0),new BABYLON.Vector3(0,1,0),1,e)).material={friction:n,restitution:o},l.isTrigger=t,l.filterMembershipMask=i,l.filterCollideMask=r,P.RigidbodyPhysics.NewPhysicsShapeCount++,P.RigidbodyPhysics.PhysicsShapeCache[a]=l):P.RigidbodyPhysics.CachedPhysicsShapeCount++,l},n.GetCachedPhysicsCylinderShape=function(e,t,n,o,i,r){var a="SHAPE_CYLINDER_F"+n+"_R"+o+"_T"+(1==t?"1":"0")+"_L"+i+"_X"+r,l=P.RigidbodyPhysics.PhysicsShapeCache[a];return null==l?((l=new BABYLON.PhysicsShapeCylinder(new BABYLON.Vector3(0,-.5,0),new BABYLON.Vector3(0,.5,0),1,e)).material={friction:n,restitution:o},l.isTrigger=t,l.filterMembershipMask=i,l.filterCollideMask=r,P.RigidbodyPhysics.NewPhysicsShapeCount++,P.RigidbodyPhysics.PhysicsShapeCache[a]=l):P.RigidbodyPhysics.CachedPhysicsShapeCount++,l},n.CreateStandardPhysicsShapeAndBody=function(e,t,n,o,i,r,a,l,s,u,c,d,p,h,m,g){var f,y,v,_,B,b,C,T,I,S,A,O,M,x=n.collision,N=null!=x.meshkey?x.meshkey:null,L=null!=x.center?x.center:{x:0,y:0,z:0};o==BABYLON.PhysicsImpostor.HeightmapImpostor?null!=d?(P.Utilities.ReparentColliders()||t.setParent(null,!0,!0),_=d.index,M=d.segments,T=d.resolution,B=d.width,d.height,d=d.length,b=v=0,(y=f=1)===M?(v=.5*(B+(f=B/(T-1))),b=.5*(d-(y=d/(T-1)))):2===M&&(C=B/M,M=d/M,f=B/(T-1),y=d/(T-1),0===_?(v=.5*(C+f)+0,b=.5*(M-y)+0):1===_?(v=.5*(C+f)+0,b=.5*(M-y)+M):2===_?(v=.5*(C+f)+C,b=.5*(M-y)+0):3===_&&(v=.5*(C+f)+C,b=.5*(M-y)+M)),d=P.RigidbodyPhysics.CreateHeightFieldTerrainShapeFromMesh(B=t,f,y),(T=new BABYLON.PhysicsShape({type:BABYLON.PhysicsShapeType.HEIGHTFIELD,pluginData:d},e)).filterMembershipMask=m,T.filterCollideMask=g,T.material={friction:s,restitution:c},_="TERRAIN_MESH_ID"+B.uniqueId+"_F"+s+"_R"+c+"_T0_L"+m+"_X"+g,P.RigidbodyPhysics.NewPhysicsShapeCount++,P.RigidbodyPhysics.PhysicsShapeCache[_]=T,C=new BABYLON.Vector3(v,0,b),M=new BABYLON.Quaternion(0,0,0,1),f=new BABYLON.Vector3(1,1,1),y=new BABYLON.PhysicsShapeContainer(e),P.Utilities.FromEulerToRef(0,90,0,M),T.isTrigger=!1,y.addChild(T,C,M,f),(d=new BABYLON.PhysicsBody(t,BABYLON.PhysicsMotionType.STATIC,!1,e)).shape=y,P.Utilities.ShowDebugColliders()&&console.log("Setup standard terrain heightmap physics collider for: "+t.name,t),P.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!1,i,n.physics,0,new BABYLON.Vector3(p.x,p.y,p.z)),P.Utilities.ShowDebugColliders()||"CenterBox-Material"===t.material.name&&(t.isVisible=!1),P.Utilities.ShowDebugColliders()&&(null==P.RigidbodyPhysics.DebugPhysicsViewer&&(P.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=P.RigidbodyPhysics.DebugPhysicsViewer)&&P.RigidbodyPhysics.DebugPhysicsViewer.showBody(d)):BABYLON.Tools.Warn("No terrain collision data found for: "+t.name+". No terrain collision impostor will be created."):o==BABYLON.PhysicsImpostor.MeshImpostor?null!=(B=P.SceneManager.FindChildTransformNode(t,t.name+".Collider",P.SearchType.ExactMatch,!0))?(!1===h&&P.Utilities.AddLoaderItemMarkedForDisposal(B),P.Utilities.ReparentColliders()||t.setParent(null,!0,!0),_=P.RigidbodyPhysics.GetCachedPhysicsMeshShape(e,B,N,s,c,m,g),v=new BABYLON.PhysicsShapeContainer(e),P.RigidbodyPhysics.AddChildShapeFromParent(v,t,_,B),(b=new BABYLON.PhysicsBody(t,BABYLON.PhysicsMotionType.STATIC,!1,e)).shape=v,P.Utilities.ShowDebugColliders()&&console.log("Setup standard mesh physics collider for: "+t.name,t),P.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!1,i,n.physics,0,new BABYLON.Vector3(p.x,p.y,p.z)),P.Utilities.ShowDebugColliders()||"CenterBox-Material"===t.material.name&&(t.isVisible=!1),P.Utilities.ShowDebugColliders()&&(null==P.RigidbodyPhysics.DebugPhysicsViewer&&(P.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=P.RigidbodyPhysics.DebugPhysicsViewer)&&P.RigidbodyPhysics.DebugPhysicsViewer.showBody(b)):BABYLON.Tools.Warn("No mesh collider found for: "+t.name+"."):o==BABYLON.PhysicsImpostor.ConvexHullImpostor?null!=(T=P.SceneManager.FindChildTransformNode(t,t.name+".Collider",P.SearchType.ExactMatch,!0))?(!1===h&&P.Utilities.AddLoaderItemMarkedForDisposal(T),P.Utilities.ReparentColliders()||t.setParent(null,!0,!0),C=P.RigidbodyPhysics.GetCachedPhysicsConvexHullShape(e,T,N,r?s:u,c,m,g),M=new BABYLON.PhysicsShapeContainer(e),P.RigidbodyPhysics.AddChildShapeFromParent(M,t,C,T),(f=new BABYLON.PhysicsBody(t,a,!1,e)).shape=M,P.Utilities.ShowDebugColliders()&&console.log("Setup standard convex hull physics collider for: "+t.name,t),P.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!0,!1,n.physics,l,new BABYLON.Vector3(p.x,p.y,p.z)),P.Utilities.ShowDebugColliders()||"CenterBox-Material"===t.material.name&&(t.isVisible=!1),P.Utilities.ShowDebugColliders()&&(null==P.RigidbodyPhysics.DebugPhysicsViewer&&(P.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=P.RigidbodyPhysics.DebugPhysicsViewer)&&P.RigidbodyPhysics.DebugPhysicsViewer.showBody(f)):BABYLON.Tools.Warn("No convex hull child mesh collider found for: "+t.name+"."):o==BABYLON.PhysicsImpostor.BoxImpostor?(P.Utilities.ReparentColliders()||t.setParent(null,!0,!0),d=(y=null!=x.boxsize?x.boxsize:{x:1,y:1,z:1}).x*parseFloat(t.scaling.x.toFixed(4)),_=y.y*parseFloat(t.scaling.y.toFixed(4)),B=y.z*parseFloat(t.scaling.z.toFixed(4)),I=L.x*parseFloat(t.scaling.x.toFixed(4)),S=L.y*parseFloat(t.scaling.y.toFixed(4)),A=L.z*parseFloat(t.scaling.z.toFixed(4)),O=new BABYLON.Vector3(I,S,A),(v=P.RigidbodyPhysics.GetCachedPhysicsBoxShape(e,i,r?s:u,c,m,g)).material={friction:r?s:u,restitution:c},(b=new BABYLON.PhysicsShapeContainer(e)).addChild(v,O,new BABYLON.Quaternion(0,0,0,1),new BABYLON.Vector3(d,_,B)),(h=new BABYLON.PhysicsBody(t,a,!1,e)).shape=b,P.Utilities.ShowDebugColliders()&&console.log("Setup standard box physics collider for: "+t.name,t),P.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!1,!1,n.physics,l,O.add(new BABYLON.Vector3(p.x,p.y,p.z))),P.Utilities.ShowDebugColliders()||"CenterBox-Material"===t.material.name&&(t.isVisible=!1),P.Utilities.ShowDebugColliders()&&(null==P.RigidbodyPhysics.DebugPhysicsViewer&&(P.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=P.RigidbodyPhysics.DebugPhysicsViewer)&&P.RigidbodyPhysics.DebugPhysicsViewer.showBody(h)):o==BABYLON.PhysicsImpostor.SphereImpostor?(P.Utilities.ReparentColliders()||t.setParent(null,!0,!0),N=null!=x.sphereradius?x.sphereradius:.5,C=parseFloat(t.scaling.x.toFixed(4)),T=parseFloat(t.scaling.y.toFixed(4)),M=parseFloat(t.scaling.z.toFixed(4)),f=Math.max(C,T,M)*N,I=L.x*parseFloat(t.scaling.x.toFixed(4)),S=L.y*parseFloat(t.scaling.y.toFixed(4)),A=L.z*parseFloat(t.scaling.z.toFixed(4)),O=new BABYLON.Vector3(I,S,A),(y=P.RigidbodyPhysics.GetCachedPhysicsSphereShape(e,i,r?s:u,c,m,g)).material={friction:r?s:u,restitution:c},(v=new BABYLON.PhysicsShapeContainer(e)).addChild(y,O,new BABYLON.Quaternion(0,0,0,1),new BABYLON.Vector3(f,f,f)),(d=new BABYLON.PhysicsBody(t,a,!1,e)).shape=v,P.Utilities.ShowDebugColliders()&&console.log("Setup standard sphere physics collider for: "+t.name,t),P.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!1,!1,n.physics,l,O.add(new BABYLON.Vector3(p.x,p.y,p.z))),P.Utilities.ShowDebugColliders()||"CenterBox-Material"===t.material.name&&(t.isVisible=!1),P.Utilities.ShowDebugColliders()&&(null==P.RigidbodyPhysics.DebugPhysicsViewer&&(P.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=P.RigidbodyPhysics.DebugPhysicsViewer)&&P.RigidbodyPhysics.DebugPhysicsViewer.showBody(d)):o==BABYLON.PhysicsImpostor.CapsuleImpostor&&(P.Utilities.ReparentColliders()||t.setParent(null,!0,!0),_=null!=x.cylinder&&x.cylinder,b=(B=null!=x.capsulesize?x.capsulesize:{x:.5,y:2,z:1}).x*parseFloat(t.scaling.x.toFixed(4)),h=B.y*parseFloat(t.scaling.y.toFixed(4)),parseFloat(t.scaling.z.toFixed(4)),(C=!(C=null)===_?P.RigidbodyPhysics.GetCachedPhysicsCylinderShape(e,i,r?s:u,c,m,g):P.RigidbodyPhysics.GetCachedPhysicsCapsuleShape(e,i,r?s:u,c,m,g)).material={friction:r?s:u,restitution:c},T=new BABYLON.Quaternion(0,0,0,1),0!==B.z&&2!==B.z||(0===B.z?P.Utilities.FromEulerToRef(0,0,90,T):2===B.z&&P.Utilities.FromEulerToRef(90,0,0,T)),I=L.x*parseFloat(t.scaling.x.toFixed(4)),S=L.y*parseFloat(t.scaling.y.toFixed(4)),A=L.z*parseFloat(t.scaling.z.toFixed(4)),O=new BABYLON.Vector3(I,S,A),(M=new BABYLON.PhysicsShapeContainer(e)).addChild(C,O,T,new BABYLON.Vector3(b,h,b)),(N=new BABYLON.PhysicsBody(t,a,!1,e)).shape=M,P.Utilities.ShowDebugColliders()&&console.log("Setup standard "+(!0===_?"cylinder":"capsule")+" physics collider for: "+t.name,t),P.RigidbodyPhysics.ConfigRigidbodyPhysics(e,t,!1,!1,n.physics,l,O.add(new BABYLON.Vector3(p.x,p.y,p.z))),P.Utilities.ShowDebugColliders()||"CenterBox-Material"===t.material.name&&(t.isVisible=!1),P.Utilities.ShowDebugColliders())&&(null==P.RigidbodyPhysics.DebugPhysicsViewer&&(P.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=P.RigidbodyPhysics.DebugPhysicsViewer)&&P.RigidbodyPhysics.DebugPhysicsViewer.showBody(N)},n.CreateCompoundPhysicsShapeAndBody=function(e,t,n,o,i,r,a,l,s,u,c,d,p,h,m){var g,f,y,v,_,B,b,C,T,I=0,S=0,A=0,O=new BABYLON.Vector3(0,0,0),M=new BABYLON.Quaternion(0,0,0,1),x=new BABYLON.Vector3(1,1,1);!1===p&&!0===c&&P.Utilities.AddLoaderItemMarkedForDisposal(n),i==BABYLON.PhysicsImpostor.ConvexHullImpostor?null!=(p=P.SceneManager.FindChildTransformNode(n,n.name+".Collider",P.SearchType.ExactMatch,!0))&&(f=y=_=1,p instanceof BABYLON.InstancedMesh?(!0===c&&(_*=parseFloat(t.scaling.x.toFixed(4)),y*=parseFloat(t.scaling.y.toFixed(4)),f*=parseFloat(t.scaling.z.toFixed(4))),x.set(_,y,f),null!=(B=p.sourceMesh)&&(v=null!=p.metadata&&null!=p.metadata.unity&&null!=p.metadata.unity.collision&&null!=p.metadata.unity.collision.sourcescale?p.metadata.unity.collision.sourcescale:null,null!=(B=null!=B.metadata&&null!=B.metadata.unity&&null!=B.metadata.unity.collision&&null!=B.metadata.unity.collision.sourcescale?B.metadata.unity.collision.sourcescale:null))&&null!=v&&(g=new BABYLON.Vector3(1,1,1),v=new BABYLON.Vector3(v.x,v.y,v.z),B=new BABYLON.Vector3(B.x,B.y,B.z),v.divideToRef(B,g),x.multiplyInPlace(g))):x.set(_,y,f),v=null!=o.meshkey?o.meshkey:null,B=P.RigidbodyPhysics.GetCachedPhysicsConvexHullShape(e,p,v,r,a,h,m),!0===c?(b=n.position.x*parseFloat(t.scaling.x.toFixed(4)),C=n.position.y*parseFloat(t.scaling.y.toFixed(4)),T=n.position.z*parseFloat(t.scaling.z.toFixed(4)),O.set(b,C,T),M.multiplyInPlace(n.rotationQuaternion)):(I=u.x*parseFloat(n.scaling.x.toFixed(4)),S=u.y*parseFloat(n.scaling.y.toFixed(4)),A=u.z*parseFloat(n.scaling.z.toFixed(4)),O.set(I,S,A)),s.shape=B,s.translation=O,s.rotation=M,s.scale=x,l.push(s)):i==BABYLON.PhysicsImpostor.CapsuleImpostor?(g=null!=o.cylinder&&o.cylinder,y=(_=null!=o.capsulesize?o.capsulesize:{x:.5,y:2,z:1}).x*parseFloat(n.scaling.x.toFixed(4)),f=_.y*parseFloat(n.scaling.y.toFixed(4)),parseFloat(n.scaling.z.toFixed(4)),!0===c&&(y*=parseFloat(t.scaling.x.toFixed(4)),f*=parseFloat(t.scaling.y.toFixed(4)),parseFloat(t.scaling.z.toFixed(4))),x.set(y,f,y),p=!(p=null)===g?P.RigidbodyPhysics.GetCachedPhysicsCylinderShape(e,d,r,a,h,m):P.RigidbodyPhysics.GetCachedPhysicsCapsuleShape(e,d,r,a,h,m),0!==_.z&&2!==_.z||(0===_.z?P.Utilities.FromEulerToRef(0,0,90,M):2===_.z&&P.Utilities.FromEulerToRef(90,0,0,M)),!0===c?(0===u.x&&0===u.y&&0===u.z||console.warn("WARNING: Center offset not supported for complex compound item: "+n.name),b=n.position.x*parseFloat(t.scaling.x.toFixed(4)),C=n.position.y*parseFloat(t.scaling.y.toFixed(4)),T=n.position.z*parseFloat(t.scaling.z.toFixed(4)),O.set(b,C,T),M.multiplyInPlace(n.rotationQuaternion)):(I=u.x*parseFloat(n.scaling.x.toFixed(4)),S=u.y*parseFloat(n.scaling.y.toFixed(4)),A=u.z*parseFloat(n.scaling.z.toFixed(4)),O.set(I,S,A)),s.shape=p,s.translation=O,s.rotation=M,s.scale=x,l.push(s)):i==BABYLON.PhysicsImpostor.SphereImpostor?(v=null!=o.sphereradius?o.sphereradius:.5,B=parseFloat(n.scaling.x.toFixed(4)),f=parseFloat(n.scaling.y.toFixed(4)),y=parseFloat(n.scaling.z.toFixed(4)),g=Math.max(B,f,y)*v,!0===c&&(_=parseFloat(t.scaling.x.toFixed(4)),p=parseFloat(t.scaling.y.toFixed(4)),B=parseFloat(t.scaling.z.toFixed(4)),g*=Math.max(_,p,B)),x.set(g,g,g),f=P.RigidbodyPhysics.GetCachedPhysicsSphereShape(e,d,r,a,h,m),!0===c?(0===u.x&&0===u.y&&0===u.z||console.warn("WARNING: Center offset not supported for complex compound item: "+n.name),b=n.position.x*parseFloat(t.scaling.x.toFixed(4)),C=n.position.y*parseFloat(t.scaling.y.toFixed(4)),T=n.position.z*parseFloat(t.scaling.z.toFixed(4)),O.set(b,C,T),M.multiplyInPlace(n.rotationQuaternion)):(I=u.x*parseFloat(n.scaling.x.toFixed(4)),S=u.y*parseFloat(n.scaling.y.toFixed(4)),A=u.z*parseFloat(n.scaling.z.toFixed(4)),O.set(I,S,A)),s.shape=f,s.translation=O,s.rotation=M,s.scale=x,l.push(s)):i==BABYLON.PhysicsImpostor.BoxImpostor&&(v=(y=null!=o.boxsize?o.boxsize:{x:1,y:1,z:1}).x*parseFloat(n.scaling.x.toFixed(4)),_=y.y*parseFloat(n.scaling.y.toFixed(4)),p=y.z*parseFloat(n.scaling.z.toFixed(4)),!0===c&&(v*=parseFloat(t.scaling.x.toFixed(4)),_*=parseFloat(t.scaling.y.toFixed(4)),p*=parseFloat(t.scaling.z.toFixed(4))),x.set(v,_,p),B=P.RigidbodyPhysics.GetCachedPhysicsBoxShape(e,d,r,a,h,m),!0===c?(0===u.x&&0===u.y&&0===u.z||console.warn("WARNING: Center offset not supported for complex compound item: "+n.name),b=n.position.x*parseFloat(t.scaling.x.toFixed(4)),C=n.position.y*parseFloat(t.scaling.y.toFixed(4)),T=n.position.z*parseFloat(t.scaling.z.toFixed(4)),O.set(b,C,T),M.multiplyInPlace(n.rotationQuaternion)):(I=u.x*parseFloat(n.scaling.x.toFixed(4)),S=u.y*parseFloat(n.scaling.y.toFixed(4)),A=u.z*parseFloat(n.scaling.z.toFixed(4)),O.set(I,S,A)),s.shape=B,s.translation=O,s.rotation=M,s.scale=x,l.push(s))},n.CreateHeightFieldTerrainShapeFromMesh=function(e,t,n){var o=P.RigidbodyPhysics.GetHavokInstance();if(!o)return BABYLON.Tools.Warn("Havok.js physics library not loaded"),null;var i=e.getVerticesData(BABYLON.VertexBuffer.PositionKind),r=i.length/3,a=o._malloc(4*r),l=Math.sqrt(r),r=l;if(l%1!=0)return console.error("Terrain mesh does not seem to be a regular square grid: "+e.name),null;for(var s=0,u=r-1;0<=u;u--)for(var c=0;c<l;c++)o.HEAPF32[a+s>>2]=i[3*(u*l+c)+1],s+=4;e=o.HP_Shape_CreateHeightField(l,r,[t,1,n],a)[1];return o._free(a),e},n.GetPhysicsHeapSize=function(){var e,t=P.RigidbodyPhysics.GetHavokInstance();return t?(e=0,t.HEAP8&&t.HEAP8.length?t.HEAP8.length/1048576:e):(BABYLON.Tools.Warn("Havok.js physics library not loaded"),0)},n.ConfigRigidbodyPhysics=function(e,t,n,o,i,r,a){var l,s,u;null!=t&&null!=t.physicsBody&&(!1===(null==i||null==i.gravity||i.gravity)&&t.physicsBody.setGravityFactor(0),l=null!=i&&null!=i.ldrag?i.ldrag:0,s=null!=i&&null!=i.adrag?i.adrag:.05,t.physicsBody.setLinearDamping(l),t.physicsBody.setAngularDamping(s),u=s=l=1,null!=(i=null!=i&&null!=i.freeze?i.freeze:null)&&(null!=i.positionx&&i.positionx,null!=i.positiony&&i.positiony,null!=i.positionz&&i.positionz,l=null!=i.rotationx&&!0===i.rotationx?0:1,s=null!=i.rotationy&&!0===i.rotationy?0:1,u=null!=i.rotationz&&!0===i.rotationz?0:1),t.physicsBody.setMassProperties({mass:r,centerOfMass:a,inertia:new BABYLON.Vector3(l,s,u)}))},n.CreatePhysicsMetadata=function(e,t,n,o){void 0===t&&(t=0),void 0===n&&(n=.05);o=null!=(o=void 0===o?null:o)?o:new BABYLON.Vector3(0,0,0);return{type:"rigidbody",mass:e,ldrag:t,adrag:n,center:{x:o.x,y:o.y,z:o.z}}},n.CreateCollisionMetadata=function(e,t,n,o,i,r){return{type:e,trigger:t=void 0===t?!1:t,convexmesh:n=void 0===n?!1:n,restitution:o=void 0===o?0:o,dynamicfriction:i=void 0===i?.6:i,staticfriction:r=void 0===r?.6:r,wheelinformation:null}},n.CreatePhysicsProperties=function(e,t,n,o,i){return{mass:e,drag:t=void 0===t?0:t,angularDrag:n=void 0===n?.05:n,useGravity:o=void 0===o?!0:o,isKinematic:i=void 0===i?!1:i}},n.AddChildShapeFromParent=function(e,t,n,o){var i,r=o.computeWorldMatrix(!0),t=t.computeWorldMatrix(!0),a=BABYLON.TmpVectors.Matrix[0],r=(r.multiplyToRef(BABYLON.Matrix.Invert(t),a),BABYLON.TmpVectors.Vector3[0]),t=BABYLON.TmpVectors.Quaternion[0],l=BABYLON.TmpVectors.Vector3[1],a=(a.decompose(l,t,r),new BABYLON.Vector3(l.x,l.y,l.z));o instanceof BABYLON.InstancedMesh&&null!=(l=o.sourceMesh)&&(o=null!=o.metadata&&null!=o.metadata.unity&&null!=o.metadata.unity.collision&&null!=o.metadata.unity.collision.sourcescale?o.metadata.unity.collision.sourcescale:null,null!=(l=null!=l.metadata&&null!=l.metadata.unity&&null!=l.metadata.unity.collision&&null!=l.metadata.unity.collision.sourcescale?l.metadata.unity.collision.sourcescale:null))&&null!=o&&(i=new BABYLON.Vector3(1,1,1),o=new BABYLON.Vector3(o.x,o.y,o.z),l=new BABYLON.Vector3(l.x,l.y,l.z),o.divideToRef(l,i),a.multiplyInPlace(i)),null!=(o=P.RigidbodyPhysics.GetHavokPlugin())&&o.addChild(e,n,r,t,a)},n.PHYSICS_STEP_TIME=.016,n.RaycastResult=null,n.LocalShapeResult=null,n.WorldShapeResult=null,n.RaycastDestination=null,n.PhysicsShapeCache={},n.NewPhysicsShapeCount=0,n.CachedPhysicsShapeCount=0,n.DebugPhysicsViewer=null,n.OnSetupPhysicsPlugin=null;var t,e=n;function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._isKinematic=!1,e._centerOfMass=new BABYLON.Vector3(0,0,0),e.m_raycastVehicle=null,e}P.RigidbodyPhysics=e,P.PhyscisContainerData=function(){}}(UNITY=UNITY||{}),this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}()),__extends=(!function(e){t=e.ScriptComponent,__extends(o,t),o.prototype.awake=function(){},o.prototype.start=function(){},o.prototype.ready=function(){},o.prototype.update=function(){},o.prototype.late=function(){},o.prototype.step=function(){},o.prototype.fixed=function(){},o.prototype.after=function(){},o.prototype.destroy=function(){};var t,n=o;function o(){return null!==t&&t.apply(this,arguments)||this}e.ShurikenParticles=n}(UNITY=UNITY||{}),this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}()),__extends=(!function(e){t=e.ScriptComponent,__extends(o,t),o.prototype.awake=function(){},o.prototype.start=function(){},o.prototype.ready=function(){},o.prototype.update=function(){},o.prototype.late=function(){},o.prototype.step=function(){},o.prototype.fixed=function(){},o.prototype.after=function(){},o.prototype.destroy=function(){};var t,n=o;function o(){return null!==t&&t.apply(this,arguments)||this}e.TerrainGenerator=n}(UNITY=UNITY||{}),this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}());!function(n){t=n.ScriptComponent,__extends(o,t),o.prototype.getVideoMaterial=function(){return this.m_videoMaterial},o.prototype.getVideoTexture=function(){return this.m_videoTexture},o.prototype.getVideoElement=function(){return null!=this.m_videoTexture?this.m_videoTexture.video:null},o.prototype.getVideoScreen=function(){return this.m_abstractMesh},o.prototype.getVideoBlobUrl=function(){return this.videoBlobUrl},o.prototype.awake=function(){this.awakeWebVideoPlayer()},o.prototype.destroy=function(){this.destroyWebVideoPlayer()},o.prototype.awakeWebVideoPlayer=function(){this.videoLoop=this.getProperty("looping",!1),this.videoMuted=this.getProperty("muted",!1),this.videoInvert=this.getProperty("inverty",!0),this.videoSample=this.getProperty("sampling",3),this.videoVolume=this.getProperty("volume",1),this.videoMipmaps=this.getProperty("mipmaps",!1),this.videoAlpha=this.getProperty("texturealpha",!1),this.videoFaded=this.getProperty("diffusealpha",!1),this.videoPlayback=this.getProperty("playbackspeed",1),this.videoPlayOnAwake=this.getProperty("playonawake",!0),this.videoPreload=this.getProperty("preload",this.videoPreload),this.m_diffuseIntensity=this.getProperty("intensity",1),this.m_abstractMesh=this.getAbstractMesh();!0===this.getProperty("poster")&&null!=this.m_abstractMesh&&null!=this.m_abstractMesh.material&&(this.m_abstractMesh.material instanceof BABYLON.PBRMaterial?null!=this.m_abstractMesh.material.albedoTexture&&null!=this.m_abstractMesh.material.albedoTexture.url&&""!==this.m_abstractMesh.material.albedoTexture.url&&(this.videoPoster=this.m_abstractMesh.material.albedoTexture.url.replace("data:","")):this.m_abstractMesh.material instanceof BABYLON.StandardMaterial&&null!=this.m_abstractMesh.material.diffuseTexture&&null!=this.m_abstractMesh.material.diffuseTexture.url&&""!==this.m_abstractMesh.material.diffuseTexture.url&&(this.videoPoster=this.m_abstractMesh.material.diffuseTexture.url.replace("data:","")));var e=this.getProperty("url",null),t=this.getProperty("source",null);null!=(e=null!=t&&null!=t.filename&&""!==t.filename?n.SceneManager.GetRootUrl(this.scene)+t.filename:e)&&""!==e&&(!0===this.videoPreload?this.videoPreloaderUrl=e:this.setDataSource(e))},o.prototype.destroyWebVideoPlayer=function(){(this.m_abstractMesh=null)!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),null!=this.m_videoMaterial&&(this.m_videoMaterial.dispose(),this.m_videoMaterial=null),this.revokeVideoBlobUrl()},o.prototype.isReady=function(){return null!=this.getVideoElement()},o.prototype.isPlaying=function(){var e=!1,t=this.getVideoElement();return e=null!=t?!1===t.paused:e},o.prototype.isPaused=function(){var e=!1,t=this.getVideoElement();return e=null!=t?!0===t.paused:e},o.prototype.play=function(){var e=this;return n.SceneManager.HasAudioContext()?this.internalPlay():BABYLON.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){e.internalPlay()}),!0},o.prototype.internalPlay=function(){var e=this;!0===this._initializedReadyInstance?this.checkedPlay():this.onReadyObservable.addOnce(function(){e.checkedPlay()})},o.prototype.checkedPlay=function(){var e=this,t=this.getVideoElement();null!=t&&t.play().then(function(){!0===t.paused&&e.checkedRePlay()})},o.prototype.checkedRePlay=function(){var e=this.getVideoElement();null!=e&&e.play().then(function(){})},o.prototype.pause=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.pause(),e=!0),e},o.prototype.mute=function(){var e=!1,t=this.getVideoElement();return e=null!=t?t.muted=!0:e},o.prototype.unmute=function(){var e=!1,t=this.getVideoElement();return e=null!=t?!(t.muted=!1):e},o.prototype.getVolume=function(){var e=0,t=this.getVideoElement();return e=null!=t?t.volume:e},o.prototype.setVolume=function(e){var t=!1,n=this.getVideoElement();return null!=n&&(n.volume=e,t=!0),t},o.prototype.setDataSource=function(e){var t=this;null!=this.m_abstractMesh&&(null==this.m_videoMaterial&&(this.m_videoMaterial=new BABYLON.StandardMaterial(this.transform.name+".VideoMat",this.scene),this.m_videoMaterial.roughness=1,this.m_videoMaterial.diffuseColor=new BABYLON.Color3(1,1,1),this.m_videoMaterial.emissiveColor=new BABYLON.Color3(1,1,1),this.m_videoMaterial.useAlphaFromDiffuseTexture=this.videoFaded,this.m_abstractMesh.material=this.m_videoMaterial),null!=this.m_videoMaterial?((this.m_videoMaterial.diffuseTexture=null)!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),this._initializedReadyInstance=!1,this.m_videoTexture=new BABYLON.VideoTexture(this.transform.name+".VideoTex",e,this.scene,this.videoMipmaps,this.videoInvert,this.videoSample,{autoUpdateTexture:!0,poster:this.videoPoster}),null!=this.m_videoTexture&&(this.m_videoTexture.hasAlpha=this.videoAlpha,null!=this.m_videoTexture.video)&&(this.m_videoTexture.video.loop=this.videoLoop,this.m_videoTexture.video.muted=this.videoMuted,this.m_videoTexture.video.volume=this.videoVolume,this.m_videoTexture.video.playbackRate=this.videoPlayback,this.m_videoTexture.video.addEventListener("loadeddata",function(){t._initializedReadyInstance=!0,t.onReadyObservable&&t.onReadyObservable.hasObservers()&&t.onReadyObservable.notifyObservers(t.m_videoTexture),!0===t.videoPlayOnAwake&&t.play()}),this.m_videoTexture.video.load()),null!=this.m_videoTexture&&(this.m_videoTexture.level=this.m_diffuseIntensity,this.m_videoMaterial.diffuseTexture=this.m_videoTexture)):BABYLON.Tools.Warn("No video mesh or material available for: "+this.transform.name))},o.prototype.revokeVideoBlobUrl=function(){null!=this.videoBlobUrl&&(URL.revokeObjectURL(this.videoBlobUrl),this.videoBlobUrl=null)},o.prototype.addPreloaderTasks=function(e){var t=this;!0===this.videoPreload&&((e=e.addBinaryFileTask(this.transform.name+".VideoTask",this.videoPreloaderUrl)).onSuccess=function(e){t.revokeVideoBlobUrl(),t.videoBlobUrl=URL.createObjectURL(new Blob([e.data])),t.setDataSource(t.videoBlobUrl)},e.onError=function(e,t,n){console.error(t,n)})};var t,e=o;function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.videoLoop=!1,e.videoMuted=!1,e.videoAlpha=!1,e.videoFaded=!1,e.videoPoster=null,e.videoInvert=!0,e.videoSample=3,e.videoVolume=1,e.videoMipmaps=!1,e.videoPlayback=1,e.videoPlayOnAwake=!0,e.videoPreloaderUrl=null,e.videoBlobUrl=null,e.videoPreload=!1,e._initializedReadyInstance=!1,e.onReadyObservable=new BABYLON.Observable,e.m_abstractMesh=null,e.m_videoTexture=null,e.m_videoMaterial=null,e.m_diffuseIntensity=1,e}n.WebVideoPlayer=e}(UNITY=UNITY||{});