var BABYLON;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"Version",{get:function(){return"7.0.0 - BETA - A1"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Copyright",{get:function(){return"All rights reserved (c) 2020 Mackey Kinard"},enumerable:!1,configurable:!0}),t.HasAudioContext=function(){return null!=e.Engine.audioEngine&&null!=e.Engine.audioEngine.audioContext&&null!=e.Engine.audioEngine.audioContext.state&&"running"===e.Engine.audioEngine.audioContext.state},t.EnableSceneParsing=function(t){e.SceneManager.SceneParsingEnabled=t},t.IsSceneParsingEnabled=function(){return e.SceneManager.SceneParsingEnabled},t.HasSceneBeenPreLoaded=function(e){var t=e;return null!=t._preloaded&&t._preloaded===!0},t.GetFullscreenUI=function(t,n){return void 0===n&&(n=e.Texture.BILINEAR_SAMPLINGMODE),null==e.SceneManager.AdvDynamicTexture&&(e.SceneManager.AdvDynamicTexture=e.GUI.AdvancedDynamicTexture.CreateFullscreenUI("Default-Screen-UI",!0,t,n)),e.SceneManager.AdvDynamicTexture},t.GetDefaultSkybox=function(e){return e.getMeshById("Default Skybox")},t.GetIntensityFactor=function(){return null!=e.SceneManager.GlobalOptions.intensityFactor?e.SceneManager.GlobalOptions.intensityFactor:2},t.GetRenderQuality=function(){var t=e.RenderQuality.High,n=e.SceneManager.GlobalOptions.renderQuality;return null!=n&&(t=n),t},t.SetRenderQuality=function(t){e.SceneManager.GlobalOptions.renderQuality=t},t.GetWebGLVersionString=function(t){var n="WebGL - Unknown",r=t||e.SceneManager.GetLastCreatedScene();if(null!=r){var o=r.getEngine();if(null!=o){var a=o.getGlInfo();null!=a&&(n=a.version+" - "+a.renderer)}}return n},t.GetWebGLVersionNumber=function(t){var n=0,r=t||e.SceneManager.GetLastCreatedScene();if(null!=r){var o=r.getEngine();null!=o&&(n=o.webGLVersion)}return n},t.SetWindowState=function(t,n){e.SceneManager.WindowState[t]=n},t.GetWindowState=function(t){var n=e.SceneManager.WindowState[t];return null!=n?n:null},t.IsDebugMode=function(){return null!=e.SceneManager.GlobalOptions.debugModeEnabled&&e.SceneManager.GlobalOptions.debugModeEnabled===!0},t.ConsoleLog=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.log.apply(console,t)},t.ConsoleInfo=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.info.apply(console,t)},t.ConsoleWarn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.warn.apply(console,t)},t.ConsoleError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,e)},t.LogMessage=function(t){e.SceneManager.IsDebugMode()&&e.Tools.Log(t)},t.LogWarning=function(t){e.SceneManager.IsDebugMode()&&e.Tools.Warn(t)},t.LogError=function(t){e.Tools.Error(t)},t.ShowSceneLoader=function(){window.showSceneLoader&&window.showSceneLoader()},t.HideSceneLoader=function(){window.hideSceneLoader&&window.hideSceneLoader()},t.UpdateLoaderStatus=function(e,t,n){window.updateStatus&&window.updateStatus(e,t,n)},t.UpdateLoaderDetails=function(e,t){window.updateDetails&&window.updateDetails(e,t)},t.UpdateLoaderProgress=function(e,t){window.updateProgress&&window.updateProgress(e,t)},t.ShowPageErrorMessage=function(e,t,n){void 0===t&&(t="Error"),void 0===n&&(n=0),window.showErrorMessage&&window.showErrorMessage(e,t,n)},t.SetTimeout=function(e,t){return window.setTimeout(t,e)},t.ClearTimeout=function(e){window.clearTimeout(e)},t.SetInterval=function(e,t){return window.setInterval(t,e)},t.ClearInterval=function(e){window.clearInterval(e)},t.GetTimeMilliseconds=function(){return null!=window.performance?window.performance.now():null!=window.Date?Date.now():0},t.GetTime=function(){return.001*e.SceneManager.GetTimeMilliseconds()},t.GetTimeMs=function(){return e.SceneManager.GetTimeMilliseconds()},t.GetGameTime=function(){return.001*(e.SceneManager.GetTimeMilliseconds()-e.SceneManager.GameTimeMilliseconds)},t.GetGameTimeMs=function(){return e.SceneManager.GetTimeMilliseconds()-e.SceneManager.GameTimeMilliseconds},t.GetDeltaSeconds=function(t,n){void 0===n&&(n=!1);var r=t||e.SceneManager.GetLastCreatedScene(),o=.001*Math.max(e.Scene.MinDeltaTime,Math.min(r.getEngine().getDeltaTime(),e.Scene.MaxDeltaTime));return n===!0&&(o*=r.getAnimationRatio()),o},t.GetDeltaMilliseconds=function(t,n){void 0===n&&(n=!1);var r=t||e.SceneManager.GetLastCreatedScene(),o=Math.max(e.Scene.MinDeltaTime,Math.min(r.getEngine().getDeltaTime(),e.Scene.MaxDeltaTime));return n===!0&&(o*=r.getAnimationRatio()),o},t.GetAnimationRatio=function(t){var n=t||e.SceneManager.GetLastCreatedScene();return n.getAnimationRatio()},t.RunOnce=function(e,t,n){e.executeOnceBeforeRender(t,n)},t.DisposeScene=function(t,n){void 0===n&&(n=new e.Color4(0,0,0,1));var r=t.getEngine();t.dispose(),r.clear(n,!0,!0,!0)},t.SafeDestroy=function(t,n,r){void 0===n&&(n=5),void 0===r&&(r=!1),n>0?(r===!0&&t.setEnabled(!1),e.SceneManager.SetTimeout(n,function(){t.dispose(!1,!1)})):t.dispose(!1,!1)},t.GetRootUrl=function(e){return null!=e._rootUrl&&""!==e._rootUrl?e._rootUrl:"/"},t.SetRootUrl=function(e,t){e._rootUrl=t},t.GetSceneFile=function(e){return null!=e._fileName&&""!==e._fileName?e._fileName:null},t.SetSceneFile=function(e,t){e._fileName=t},t.GetEngineInstances=function(){return e.EngineStore.Instances},t.GetLastCreatedEngine=function(){return e.EngineStore.LastCreatedEngine},t.GetLastCreatedScene=function(){return e.EngineStore.LastCreatedScene},t.GetImportMeshes=function(e,t){return null==e||null==t||""===t?null:null!=e.importMeshes?e.importMeshes.get(t.toLowerCase()):null},t.GetImportMeshMap=function(e){return null==e?null:null!=e.importMeshes?e.importMeshes:null},t.ClearImportMeshes=function(e){return null==e?null:(null!=e.importMeshes,void(e.importMeshes=new Map))},t.RegisterImportMeshes=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.importMeshes&&(e.importMeshes=new Map),e.importMeshes.set(t.toLowerCase(),n))},t.GetAssetContainer=function(e,t){return null==e||null==t||""===t?null:null!=e.assetContainers?e.assetContainers.get(t.toLowerCase()):null},t.GetAssetContainerMap=function(e){return null==e?null:null!=e.assetContainers?e.assetContainers:null},t.ClearAssetContainers=function(e){return null==e?null:(null!=e.assetContainers,void(e.assetContainers=new Map))},t.RegisterAssetContainer=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.assetContainers&&(e.assetContainers=new Map),e.assetContainers.set(t.toLowerCase(),n))},t.GetMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetAbstractMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetAbstractMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformNode=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetTransformNodeByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformDetailMesh=function(t){var n=null,r=t.name+".Detail",o=t.getChildren(function(t){return t.name===r&&t instanceof e.AbstractMesh},!0);return null!=o&&o.length>0&&(n=o[0]),n},t.GetSkinnedMesh=function(e){return null!=e._skinnedMesh?e._skinnedMesh:null},t.GetPrimitiveMeshes=function(e){return e.getChildMeshes(!0,function(e){return e.name.indexOf("_primitive")>=0})},t.GetTransformLayer=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.layer?e.metadata.unity.layer:0},t.GetTransformLayerMask=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.layermask?e.metadata.unity.layermask:1},t.GetTransformLayerName=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.layername&&""!==e.metadata.unity.layername?e.metadata.unity.layername:"Default"},t.GetTransformTag=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.group&&""!==e.metadata.unity.group?e.metadata.unity.group:"Untagged"},t.HasTransformTags=function(t,n){return e.Tags.MatchesQuery(t,n)},t.TextureFloatSupported=function(e){var t=!1,n=!1,r=e.getEngine(),o=r.getCaps();return o.textureHalfFloatRender&&o.textureHalfFloatLinearFiltering?t=!0:o.textureFloatRender&&o.textureFloatLinearFiltering&&(n=!0),t||n},t.RegisterClickAction=function(t,n,r){var o=null;return null!=n&&(n.isPickable=!0,null==n.actionManager&&(n.actionManager=new e.ActionManager(t)),o=n.actionManager.registerAction(new e.ExecuteCodeAction({trigger:e.ActionManager.OnPickTrigger},r))),o},t.UnregisterClickAction=function(e,t){var n=!1;return null!=e&&null!=t&&(n=e.actionManager.unregisterAction(t)),n},t.StartTweenAnimation=function(t,n,r,o,a,i,l,s,u,d,p){void 0===l&&(l=1),void 0===s&&(s=null),void 0===u&&(u=null),void 0===d&&(d=null),void 0===p&&(p=null);var c=l||1,m=s||30,h=u||e.Animation.ANIMATIONLOOPMODE_CONSTANT,f=e.Utilities.CreateTweenAnimation(n,o,a,i,m,h);null!=d&&f.setEasingFunction(d);var g=e.Utilities.GetLastKeyFrameIndex(f),y=h!=e.Animation.ANIMATIONLOOPMODE_CONSTANT;return t.beginDirectAnimation(r,[f],0,g,y,c,p)},t.StartNativeTween=function(e,t){return createjs.Tween.get(e,t)},t.GetMaterialWithName=function(e,t){var n=null;if(null!=e.materials&&e.materials.length>0)for(var r=(e.materials.length,0);r<e.materials.length;r++){var o=e.materials[r];if(o.name.startsWith(t)){n=o;break}}return n},t.GetAllMaterialsWithName=function(e,t){var n=null;if(null!=e.materials&&e.materials.length>0)for(var r=(e.materials.length,0);r<e.materials.length;r++){var o=e.materials[r];o.name.startsWith(t)&&(null==n&&(n=[]),n.push(o))}return n},t.InstantiatePrefabFromScene=function(t,n,r,o,a,i,l,s){void 0===o&&(o=null),void 0===a&&(a=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===s&&(s=!0);var u=null;if(null!=t&&null!=n&&""!==n){var d=t.getNodeByName(n);if(null!=d)if(u=d.clone(r,o,!1),null!=u){null!=a&&(u.position=a.clone()),null!=i&&(u.rotationQuaternion=i.clone()),null!=l&&(u.scaling=l.clone());var p=null,c=u.getChildren(null,!1);null!=c&&(p=c),null==p?p=[u]:p.unshift(u),p.forEach(function(n){if(n.setEnabled(!0),n instanceof e.AbstractMesh&&null!=n.metadata&&null!=n.metadata.shadowCastingMode&&0!==n.metadata.shadowCastingMode&&t.lights.forEach(function(e){var t=e.getShadowGenerator();if(null!=t){var r=null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0;if(r===!1){var o=t.getShadowMap();null==o.renderList&&(o.renderList=[]),o.renderList.indexOf(n)<0&&o.renderList.push(n)}}}),n instanceof e.Mesh)if(null!=n.source){if(null==n.skeleton&&null!=n.source.skeleton){var r=n.source.skeleton.name+".Skeleton",o=r+"."+n.source.skeleton.id;if(n.skeleton=n.source.skeleton.clone(r,o),null!=n.skeleton&&null!=n.skeleton.bones&&null!=n.source.skeleton.bones&&n.skeleton.bones.length===n.source.skeleton.bones.length)for(var a=n.skeleton.bones.length,i=0;i<a;i++)null==n.skeleton.bones[i].metadata&&null!=n.source.skeleton.bones[i].metadata&&(n.skeleton.bones[i].metadata=n.source.skeleton.bones[i].metadata)}}else e.Tools.Warn("Babylon.js encountered a null clone source for: "+n.name)});var m=[];if(p.forEach(function(e){m.push(e)}),null!=m&&m.length>0){var h=[];e.Utilities.PostParseSceneComponents(t,m,null,h),t.onAfterRenderObservable.addOnce(function(){if(null!=h&&h.length>0)for(var e=0;e<h.length;e++){var t=h[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})}}else e.Tools.Warn("Failed to create prefab of: "+n);else e.Tools.Warn("Failed to lookup prefab map: "+n)}else e.Tools.Warn("Unable to locate prefab master: "+n);return u},t.InstantiatePrefabFromContainer=function(t,n,r,o,a,i,l,s,u){void 0===o&&(o=null),void 0===a&&(a=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===s&&(s=!0),void 0===u&&(u=!1);var d=e.Utilities.CloneAssetContainerItem(t,n,function(e){return e},o,u,s);if(null!=d){null!=r&&""!==r&&(d.name=r),null!=a&&(d.position=a.clone()),null!=i&&(d.rotationQuaternion=i.clone()),null!=l&&(d.scaling=l.clone());var p=[];p.push(d);var c=d.getChildren(null,!1);null!=c&&c.length>0&&c.forEach(function(e){p.push(e)}),p.forEach(function(t){t.id=e.Utilities.CreateGuid(),t.setEnabled(!0)});var m=[];e.Utilities.PostParseSceneComponents(t.scene,p,null,m),t.scene.onAfterRenderObservable.addOnce(function(){if(null!=m&&m.length>0)for(var e=0;e<m.length;e++){var t=m[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})}return d},t.CloneTransformNode=function(t,n,r,o,a,i,l){void 0===o&&(o=null),void 0===a&&(a=null),void 0===i&&(i=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerNode(t,n),u=s.clone(r,o,!0);return null!=u&&(null!=a&&(u.position=a.clone()),null!=i&&(u.rotationQuaternion=i.clone()),null!=l&&(u.scaling=l.clone()),u.setEnabled(!0)),u},t.CloneAbstractMesh=function(t,n,r,o,a,i,l){void 0===o&&(o=null),void 0===a&&(a=null),void 0===i&&(i=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerMesh(t,n),u=s.clone(r,o,!0);return null!=u&&(null!=a&&(u.position=a.clone()),null!=i&&(u.rotationQuaternion=i.clone()),null!=l&&(u.scaling=l.clone()),u.setEnabled(!0)),u},t.CreateInstancedMesh=function(t,n,r,o,a,i,l){void 0===o&&(o=null),void 0===a&&(a=null),void 0===i&&(i=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerMesh(t,n),u=s.createInstance(r);return null!=u&&(null!=o&&(u.parent=o),null!=a&&(u.position=a.clone()),null!=i&&(u.rotationQuaternion=i.clone()),null!=l&&(u.scaling=l.clone()),u.setEnabled(!0)),u},t.RegisterScriptComponent=function(e,t,n){void 0===n&&(n=!0),null!=e&&e.registerComponentInstance&&e.registerComponentInstance(e,t,n)},t.DestroyScriptComponent=function(e){null!=e&&e.destroyComponentInstance&&e.destroyComponentInstance(e)},t.FindScriptComponent=function(e,t){if(null==e)return null;var n=null;if(null!=e.metadata&&e.metadata.unity){var r=e.metadata.unity;if(null!=r.components&&r.components.length>0)for(var o=0;o<r.components.length;o++){var a=r.components[o];if(null!=a.instance&&a.klass===t){n=a.instance;break}}}return null!=n?n:null},t.FindAllScriptComponents=function(e,t){if(null==e)return null;var n=null;if(null!=e.metadata&&e.metadata.unity){var r=e.metadata.unity;if(null!=r.components&&r.components.length>0)for(var o=0;o<r.components.length;o++){var a=r.components[o];null!=a.instance&&a.klass===t&&(null==n&&(n=[]),n.push(a.instance))}}return null!=n?n:null},t.FindSceneMetadata=function(e){return null==e?null:null!=e.metadata&&e.metadata.unity?e.metadata.unity:null},t.FindSceneCameraRig=function(e){return null==e?null:null!=e.cameraRig?e.cameraRig:null},t.FindSceneLightRig=function(e){return null==e?null:null!=e.lightRig?e.lightRig:null},t.FindTransformWithScript=function(t,n){var r=t.getNodes();return e.Utilities.SearchTransformNodeForScript(n,r)},t.FindAllTransformsWithScript=function(t,n){var r=t.getNodes();return e.Utilities.SearchAllTransformNodesForScript(n,r)},t.FindChildTransformNode=function(t,n,r,o,a){if(void 0===r&&(r=e.SearchType.ExactMatch),void 0===o&&(o=!0),void 0===a&&(a=null),null==t)return null;var i=null!=r?r:e.SearchType.ExactMatch,l=t.getChildren(a,o);return e.Utilities.SearchTransformNodes(n,l,i)},t.FindChildTransformWithTags=function(t,n,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=null),null==t)return null;var a=t.getChildren(o,r);return e.Utilities.SearchTransformNodeForTags(n,a)},t.FindAllChildTransformsWithTags=function(t,n,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=null),null==t)return null;var a=t.getChildren(o,r);return e.Utilities.SearchAllTransformNodesForTags(n,a)},t.FindChildTransformWithScript=function(t,n,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=null),null==t)return null;var a=t.getChildren(o,r);return e.Utilities.SearchTransformNodeForScript(n,a)},t.FindAllChildTransformsWithScript=function(t,n,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=null),null==t)return null;var a=t.getChildren(o,r);return e.Utilities.SearchAllTransformNodesForScript(n,a)},t.SearchForScriptComponentByName=function(t,n){var r=t.getNodes(),o=e.Utilities.SearchTransformNodeForScript(n,r);return e.SceneManager.FindScriptComponent(o,n)},t.SearchForAllScriptComponentsByName=function(t,n){var r=null,o=t.getNodes(),a=e.Utilities.SearchAllTransformNodesForScript(n,o);return null!=a&&a.length>0&&a.forEach(function(t){var o=e.SceneManager.FindScriptComponent(t,n);null!=o&&(null==r&&(r=[]),r.push(o))}),null!=r?r:null},t.MoveWithCollisions=function(e,t){return null==e?null:void(null!=t&&e.moveWithCollisions(t))},t.MoveWithTranslation=function(e,t){return null==e?null:void(null!=t&&e.position.addInPlace(t))},t.TurnWithRotation=function(t,n,r){return void 0===r&&(r=e.Space.LOCAL),null==t?null:void(0!=n&&t.rotate(e.Axis.Y,n,r))},t.GetRecastHeapSize=function(){if("undefined"==typeof Recast)return 0;var e=0;return Recast&&Recast.HEAP8&&Recast.HEAP8.length&&(e=Recast.HEAP8.length/1048576),e},t.GetNavigationTools=function(){if("undefined"!=typeof Recast)return null==e.SceneManager.PluginInstance&&(e.SceneManager.PluginInstance=new e.RecastJSPlugin),e.SceneManager.PluginInstance},t.GetCrowdInterface=function(t){if("undefined"==typeof Recast)return null;if(e.SceneManager.HasNavigationData()){var n=e.SceneManager.GetNavigationTools();return null!=n&&null==e.SceneManager.CrowdInterface&&(e.SceneManager.CrowdInterface=n.createCrowd(e.SceneManager.MAX_AGENT_COUNT,e.SceneManager.MAX_AGENT_RADIUS,t)),e.SceneManager.CrowdInterface}return null},t.HasNavigationData=function(){if("undefined"==typeof Recast)return!1;var t=e.SceneManager.GetNavigationTools();return null!=t&&null!=t.navMesh},t.GetNavigationMesh=function(){return"undefined"==typeof Recast?null:e.SceneManager.NavigationMesh},t.BakeNavigationMesh=function(t,n,r,o,a,i){if(void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1),"undefined"==typeof Recast)return null;e.Tools.Log("Recast.js baking navigation mesh data");var l=e.SceneManager.GetNavigationTools();if(null!=l)if(l.createNavMesh(n,r),null!=l.navMesh){var s="NavigationMesh",u=t.getMaterialByName(s);null==u&&(u=new e.StandardMaterial(s,t),u.diffuseColor=a||new e.Color3(.05,.225,.75),u.alpha=.5),e.SceneManager.NavigationMesh=l.createDebugNavMesh(t),null!=e.SceneManager.NavigationMesh&&(e.SceneManager.NavigationMesh.material=u,e.SceneManager.NavigationMesh.isPickable=!0,e.SceneManager.NavigationMesh.isVisible=!0,e.SceneManager.NavigationMesh.visibility=o===!0?1:0,e.SceneManager.NavigationMesh.renderingGroupId=e.Utilities.ColliderRenderGroup(),e.Tags.AddTagsTo(e.SceneManager.NavigationMesh,"Navigation"),e.Utilities.ValidateTransformMetadata(e.SceneManager.NavigationMesh),i===!0&&(e.SceneManager.NavigationMesh.checkCollisions=!0,e.RigidbodyPhysics&&(e.SceneManager.NavigationMesh.metadata.unity.physics=e.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new e.Vector3(0,0,0)),e.SceneManager.NavigationMesh.metadata.unity.collision=e.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),e.RigidbodyPhysics.SetupPhysicsComponent(t,e.SceneManager.NavigationMesh)))),null!=e.SceneManager.NavigationMesh?e.SceneManager.OnNavMeshReadyObservable.hasObservers()===!0&&e.SceneManager.OnNavMeshReadyObservable.notifyObservers(e.SceneManager.NavigationMesh):e.Tools.Warn("Failed to generate navigation mesh geometry")}else e.Tools.Warn("Failed to create navigation mesh data");return e.SceneManager.NavigationMesh},t.LoadNavigationMesh=function(t,n,r,o,a,i){if(void 0===r&&(r=!1),void 0===o&&(o=null),void 0===a&&(a=0),void 0===i&&(i=!1),"undefined"==typeof Recast)return null;e.Tools.Log("Recast.js loading prebaked navigation mesh");var l=e.SceneManager.GetNavigationTools();if(null!=l)if(l.setTimeStep&&l.setTimeStep(a),l.buildFromNavmeshData(n),null!=l.navMesh){var s="NavigationMesh",u=t.getMaterialByName(s);null==u&&(u=new e.StandardMaterial(s,t),u.diffuseColor=o||new e.Color3(.05,.225,.75),u.alpha=.5),e.SceneManager.NavigationMesh=l.createDebugNavMesh(t),null!=e.SceneManager.NavigationMesh&&(e.SceneManager.NavigationMesh.material=u,e.SceneManager.NavigationMesh.isPickable=!0,e.SceneManager.NavigationMesh.isVisible=!0,e.SceneManager.NavigationMesh.visibility=r===!0?1:0,e.SceneManager.NavigationMesh.renderingGroupId=e.Utilities.ColliderRenderGroup(),e.Tags.AddTagsTo(e.SceneManager.NavigationMesh,"Navigation"),e.Utilities.ValidateTransformMetadata(e.SceneManager.NavigationMesh),i===!0&&(e.SceneManager.NavigationMesh.checkCollisions=!0,e.RigidbodyPhysics&&(e.SceneManager.NavigationMesh.metadata.unity.physics=e.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new e.Vector3(0,0,0)),e.SceneManager.NavigationMesh.metadata.unity.collision=e.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),e.RigidbodyPhysics.SetupPhysicsComponent(t,e.SceneManager.NavigationMesh)))),null!=e.SceneManager.NavigationMesh?e.SceneManager.OnNavMeshReadyObservable.hasObservers()===!0&&e.SceneManager.OnNavMeshReadyObservable.notifyObservers(e.SceneManager.NavigationMesh):e.Tools.Warn("Failed to generate navigation mesh geometry")}else e.Tools.Warn("Failed to build navigation mesh data");return e.SceneManager.NavigationMesh},t.SaveNavigationMesh=function(){if("undefined"==typeof Recast)return null;var t=e.SceneManager.GetNavigationTools();return null!=t&&null!=t.navMesh?t.getNavmeshData():null},t.ComputeNavigationPath=function(t,n,r){if(void 0===r&&(r=!0),"undefined"==typeof Recast)return null;var o=e.SceneManager.GetNavigationTools(),a=r===!0?o.getClosestPoint(t):t,i=r===!0?o.getClosestPoint(n):n;return null!=o&&null!=o.navMesh?o.computePath(a,i):null},t.MoveAlongNavigationPath=function(t,n,r,o,a,i){void 0===a&&(a=null);var l=null;if(r&&r.length>0){for(var s=0,u=[{frame:0,value:n.position}],d=0;d<r.length;d++)s+=e.Vector3.Distance(u[d].value,r[d]),u.push({frame:s,value:r[d]});l=new e.Animation("Navigation","position",3,e.Animation.ANIMATIONTYPE_VECTOR3,e.Animation.ANIMATIONLOOPMODE_CONSTANT),null!=a&&l.setEasingFunction(a),l.setKeys(u),n.animations=[l],t.beginAnimation(n,0,s,!1,o,i)}return l},t.AddNavigationCylinderObstacle=function(t,n,r){if("undefined"==typeof Recast)return null;var o=e.SceneManager.GetNavigationTools();return null!=o&&null!=o.navMesh?o.addCylinderObstacle(t,n,r):null},t.AddNavigationBoxObstacle=function(t,n,r){if("undefined"==typeof Recast)return null;var o=e.SceneManager.GetNavigationTools();return null!=o&&null!=o.navMesh?o.addBoxObstacle(t,n,r):null},t.RemoveNavigationObstacle=function(t){if("undefined"==typeof Recast)return null;var n=e.SceneManager.GetNavigationTools();null!=n&&null!=n.navMesh&&n.removeObstacle(t)},t.ToggleFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().switchFullscreen(t)},t.EnterFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().enterFullscreen(t)},t.ExitFullscreenMode=function(e){e.getEngine().exitFullscreen()},t.WindowState={},t.GlobalOptions={},t.ServerEndPoint="http://127.0.0.1:2567",t.EnableUserInput=!0,t.RenderLoopReady=!0,t.PauseRenderLoop=!1,t.LostRenderContext=!1,t.AutoUpdateProgress=!0,t.PhysicsCapsuleShape=0,t.SupportSRGBBuffers=!1,t.AnimationStartMode=e.GLTFLoaderAnimationStartMode.NONE,t.AnimationTargetFps=30,t.DefaultConvexHullMargin=.001,t.DefaultHeightFieldMargin=.001,t.AmbientLightIntensity=.5,t.PointLightIntensity=1,t.SpotLightIntensity=10,t.DirectionalLightIntensity=2,t.TerrainColorCorrection=2.2,t.AllowCameraMovement=!0,t.AllowCameraRotation=!0,t.VirtualJoystickEnabled=!1,t.GameTimeMilliseconds=0,t.WaitForSeconds=function(t){return new Promise(function(n){return e.SceneManager.SetTimeout(1e3*t,n)})},t.OnPreRenderLoopObservable=new e.Observable,t.OnPostRenderLoopObservable=new e.Observable,t.OnEngineResizeObservable=new e.Observable,t.OnLoadCompleteObservable=new e.Observable,t.OnRebuildContextObservable=new e.Observable,t.OnAssetManagerProgress=null,t.SceneParsingEnabled=!0,t.AdvDynamicTexture=null,t.MAX_AGENT_COUNT=200,t.MAX_AGENT_RADIUS=2,t.NavigationMesh=null,t.CrowdInterface=null,t.PluginInstance=null,t.OnNavMeshReadyObservable=new e.Observable,t}();e.SceneManager=t}(BABYLON||(BABYLON={}));var SM=BABYLON.SceneManager;BABYLON.SceneManager.GameTimeMilliseconds=BABYLON.SceneManager.GetTimeMilliseconds();var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BABYLON;!function(e){var t;!function(t){t[t.Deg2Rad=2*Math.PI/360]="Deg2Rad",t[t.Rad2Deg=1/e.System.Deg2Rad]="Rad2Deg",t[t.Epsilon=1e-6]="Epsilon",t[t.SingleEpsilon=1.401298e-45]="SingleEpsilon",t[t.EpsilonNormalSqrt=1e-15]="EpsilonNormalSqrt",t[t.Kph2Mph=.621371]="Kph2Mph",t[t.Mph2Kph=1.60934]="Mph2Kph",t[t.Mps2Kph=3.6]="Mps2Kph",t[t.Mps2Mph=2.23694]="Mps2Mph",t[t.Meter2Inch=39.3701]="Meter2Inch",t[t.Inch2Meter=.0254]="Inch2Meter",t[t.Gravity=9.81]="Gravity",t[t.Gravity3G=29.400000000000002]="Gravity3G",t[t.SkidFactor=.25]="SkidFactor",t[t.MaxInteger=2147483647]="MaxInteger",t[t.WalkingVelocity=4.4]="WalkingVelocity",t[t.TerminalVelocity=55]="TerminalVelocity",t[t.SmoothDeltaFactor=.2]="SmoothDeltaFactor",t[t.ToLinearSpace=2.2]="ToLinearSpace",t[t.ToGammaSpace=.45454545454545453]="ToGammaSpace"}(t=e.System||(e.System={}));var n;!function(e){e[e.Default=-1]="Default",e[e.Right=0]="Right",e[e.Left=1]="Left"}(n=e.Handedness||(e.Handedness={}));var r;!function(e){e[e.ExactMatch=0]="ExactMatch",e[e.StartsWith=1]="StartsWith",e[e.EndsWith=2]="EndsWith",e[e.IndexOf=3]="IndexOf"}(r=e.SearchType||(e.SearchType={}));var o;!function(e){e[e.Auto=0]="Auto",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four"}(o=e.PlayerNumber||(e.PlayerNumber={}));var a;!function(e){e[e.FirstPerson=0]="FirstPerson",e[e.ThirdPerson=1]="ThirdPerson"}(a=e.PlayerControl||(e.PlayerControl={}));var i;!function(e){e[e.High=0]="High",e[e.Medium=1]="Medium",e[e.Low=2]="Low"}(i=e.RenderQuality||(e.RenderQuality={}));var l;!function(e){e[e.None=-1]="None",e[e.Generic=0]="Generic",e[e.Xbox360=1]="Xbox360",e[e.DualShock=2]="DualShock",e[e.PoseController=3]="PoseController"}(l=e.GamepadType||(e.GamepadType={}));var s;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(s=e.Xbox360Trigger||(e.Xbox360Trigger={}));var u;!function(e){e[e.DirectVelocity=0]="DirectVelocity",e[e.AppliedForces=1]="AppliedForces"}(u=e.MovementType||(e.MovementType={}));var d;!function(e){e[e.Top=0]="Top",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Bottom=3]="Bottom"}(d=e.CollisionContact||(e.CollisionContact={}));var p;!function(e){e[e.AABB=0]="AABB",e[e.OBB=1]="OBB"}(p=e.IntersectionPrecision||(e.IntersectionPrecision={}));var c;!function(e){e[e.DefaultFilter=1]="DefaultFilter",e[e.StaticFilter=2]="StaticFilter",e[e.KinematicFilter=4]="KinematicFilter",e[e.DebrisFilter=8]="DebrisFilter",e[e.SensorTrigger=16]="SensorTrigger",e[e.CharacterFilter=32]="CharacterFilter",e[e.AllFilter=-1]="AllFilter"}(c=e.CollisionFilters||(e.CollisionFilters={}));var m;!function(e){e[e.ACTIVE_TAG=1]="ACTIVE_TAG",e[e.ISLAND_SLEEPING=2]="ISLAND_SLEEPING",e[e.WANTS_DEACTIVATION=3]="WANTS_DEACTIVATION",e[e.DISABLE_DEACTIVATION=4]="DISABLE_DEACTIVATION",e[e.DISABLE_SIMULATION=5]="DISABLE_SIMULATION"}(m=e.CollisionState||(e.CollisionState={}));var h;!function(e){e[e.CF_STATIC_OBJECT=1]="CF_STATIC_OBJECT",e[e.CF_KINEMATIC_OBJECT=2]="CF_KINEMATIC_OBJECT",e[e.CF_NO_CONTACT_RESPONSE=4]="CF_NO_CONTACT_RESPONSE",e[e.CF_CUSTOM_MATERIAL_CALLBACK=8]="CF_CUSTOM_MATERIAL_CALLBACK",e[e.CF_CHARACTER_OBJECT=16]="CF_CHARACTER_OBJECT",e[e.CF_DISABLE_VISUALIZE_OBJECT=32]="CF_DISABLE_VISUALIZE_OBJECT",e[e.CF_DISABLE_SPU_COLLISION_PROCESSING=64]="CF_DISABLE_SPU_COLLISION_PROCESSING",e[e.CF_HAS_CONTACT_STIFFNESS_DAMPING=128]="CF_HAS_CONTACT_STIFFNESS_DAMPING",e[e.CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR=256]="CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR",e[e.CF_HAS_FRICTION_ANCHOR=512]="CF_HAS_FRICTION_ANCHOR",e[e.CF_HAS_COLLISION_SOUND_TRIGGER=1024]="CF_HAS_COLLISION_SOUND_TRIGGER"}(h=e.CollisionFlags||(e.CollisionFlags={}));var f;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(f=e.UserInputPointer||(e.UserInputPointer={}));var g;!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.ClientX=2]="ClientX",e[e.ClientY=3]="ClientY",e[e.MouseX=4]="MouseX",e[e.MouseY=5]="MouseY",e[e.Wheel=6]="Wheel"}(g=e.UserInputAxis||(e.UserInputAxis={}));var y;!function(e){e[e.BackSpace=8]="BackSpace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Pause=19]="Pause",e[e.Break=19]="Break",e[e.CapsLock=20]="CapsLock",e[e.Escape=27]="Escape",e[e.SpaceBar=32]="SpaceBar",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.LeftArrow=37]="LeftArrow",e[e.UpArrow=38]="UpArrow",e[e.RightArrow=39]="RightArrow",e[e.DownArrow=40]="DownArrow",e[e.Insert=45]="Insert",e[e.Delete=46]="Delete",e[e.Num0=48]="Num0",e[e.Num1=49]="Num1",e[e.Num2=50]="Num2",e[e.Num3=51]="Num3",e[e.Num4=52]="Num4",e[e.Num5=53]="Num5",e[e.Num6=54]="Num6",e[e.Num7=55]="Num7",e[e.Num8=56]="Num8",e[e.Num9=57]="Num9",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.LeftWindowKey=91]="LeftWindowKey",e[e.RightWindowKey=92]="RightWindowKey",e[e.SelectKey=93]="SelectKey",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.Multiply=106]="Multiply",e[e.Add=107]="Add",e[e.Subtract=109]="Subtract",e[e.DecimalPoint=110]="DecimalPoint",e[e.Divide=111]="Divide",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=144]="NumLock",e[e.ScrollLock=145]="ScrollLock",e[e.SemiColon=186]="SemiColon",e[e.EqualSign=187]="EqualSign",e[e.Comma=188]="Comma",e[e.Dash=189]="Dash",e[e.Period=190]="Period",e[e.ForwardSlash=191]="ForwardSlash",e[e.GraveAccent=192]="GraveAccent",e[e.OpenBracket=219]="OpenBracket",e[e.BackSlash=220]="BackSlash",e[e.CloseBraket=221]="CloseBraket",e[e.SingleQuote=222]="SingleQuote"}(y=e.UserInputKey||(e.UserInputKey={}));var v=function(){function e(){}return e.KeyboardSmoothing=!1,e.KeyboardMoveSensibility=3,e.KeyboardMoveDeadZone=.001,e.GamepadDeadStickValue=.25,e.GamepadLStickXInverted=!1,e.GamepadLStickYInverted=!1,e.GamepadRStickXInverted=!1,e.GamepadRStickYInverted=!0,e.GamepadLStickSensibility=1,e.GamepadRStickSensibility=1,e.SupportedInputDevices=null,e.PointerAngularSensibility=.5,e.PointerWheelDeadZone=.1,e.PointerMouseDeadZone=.1,e.PointerMouseInverted=!0,e.UseCanvasElement=!0,e.UseArrowKeyRotation=!1,e}();e.UserInputOptions=v;var _=function(){function e(){}return e}();e.RequestHeader=_;var b=function(){function e(){this.mesh=null,this.state=0}return e}();e.TriggerVolume=b;var C=function(){function e(){}return e}();e.RoomErrorMessage=C;var S=function(){function e(){this.ListenerDictionary={}}return e.prototype.AddListener=function(e,t){var n;null==this.ListenerDictionary[e]?(n=[],this.ListenerDictionary[e]=n):n=this.ListenerDictionary[e],n.push(t)},e.prototype.RemoveListener=function(e,t){var n=this.ListenerDictionary[e];if(null!=n){var r=n.findIndex(function(e){return t==e});r>=0&&n.splice(r,1)}},e.prototype.RaiseMessage=function(e,t){void 0===t&&(t=null);var n=this.ListenerDictionary[e];null!=n&&n.forEach(function(e){e(t)})},e}();e.EventMessageBus=S;var T=function(){function t(e,t,n,r,o,a){void 0===n&&(n=1),void 0===r&&(r=!0),void 0===o&&(o=!1),
void 0===a&&(a=!0),this.prefabName=null,this.allowGrowth=!0,this.assetContainer=null,this.cloneAnimations=!0,this.makeNewMaterials=!1,this.availableInstances=null,this.prefabName=t,this.allowGrowth=r,this.assetContainer=e,this.cloneAnimations=a,this.makeNewMaterials=o,this.availableInstances=[],this.populatePool(n)}return t.prototype.getAvailableCount=function(){return this.availableInstances.length},t.prototype.populatePool=function(e){if(e>0)for(var t=0;t<e;t++){var n=this.createNewInstance();null!=n&&this.freeInstance(n)}},t.prototype.getInstance=function(t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=this.availableInstances.length>0?this.availableInstances.pop():this.appendNewInstance();return null!=r&&(null!=t?r.position.copyFrom(t):r.position.set(0,0,0),null!=n?null!=r.rotationQuaternion?r.rotationQuaternion.copyFrom(n):r.rotationQuaternion=n.clone():null!=r.rotationQuaternion?r.rotationQuaternion.set(0,0,0,1):r.rotationQuaternion=new e.Quaternion(0,0,0,1),r.name=this.prefabName+".Instance",r.setEnabled(!0)),r},t.prototype.freeInstance=function(t){null!=t&&(t.setEnabled(!1),t.position.set(0,0,0),null!=t.rotationQuaternion?t.rotationQuaternion.set(0,0,0,1):t.rotationQuaternion=new e.Quaternion(0,0,0,1),null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.components&&t.metadata.unity.components.forEach(function(e){if(null!=e)try{e.resetScriptComponent()}catch(t){}}),t.name=this.prefabName+".Unassigned",this.availableInstances.push(t))},t.prototype.appendNewInstance=function(){var e=null;return this.allowGrowth===!0&&(e=this.createNewInstance()),e},t.prototype.createNewInstance=function(t,n,r,o){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null);var a=null;return null!=this.assetContainer&&null!=this.prefabName&&""!==this.prefabName&&(this.assetContainer instanceof e.AssetContainer?a=e.SceneManager.InstantiatePrefabFromContainer(this.assetContainer,this.prefabName,this.prefabName+".Instance",t,n,r,o,this.cloneAnimations,this.makeNewMaterials):this.assetContainer instanceof e.Scene&&(a=e.SceneManager.InstantiatePrefabFromScene(this.assetContainer,this.prefabName,this.prefabName+".Instance",t,n,r,o,this.cloneAnimations))),a},t}();e.PrefabObjectPool=T;var I=function(){function t(){this._hit=!1,this._dest=new e.Vector3(0,0,0),this._origin=new e.Vector3(0,0,0),this._hitPoint=new e.Vector3(0,0,0),this._hitNormal=new e.Vector3(0,0,0),this._hitDistance=0,this._collisionObject=null,this.reset(e.Vector3.Zero(),e.Vector3.Zero())}return Object.defineProperty(t.prototype,"hasHit",{get:function(){return this._hit},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hitPoint",{get:function(){return this._hitPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hitNormal",{get:function(){return this._hitNormal},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionObject",{get:function(){return this._collisionObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rayDestination",{get:function(){return this._dest},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rayOrigin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),t.prototype.reset=function(e,t){this._hit=!1,this._hitPoint.set(0,0,0),this._hitNormal.set(0,0,0),this._hitDistance=0,this._collisionObject=null,this._origin.copyFrom(e),this._dest.copyFrom(t)},t.prototype.update=function(t,n,r,o,a,i,l,s){void 0===s&&(s=null),this._hit=t,this._hitPoint.set(n,r,o),this._hitNormal.set(a,i,l),this._hitDistance=e.Vector3.Distance(this._origin,this.hitPoint),this._collisionObject=s},t}();e.RaycastHitResult=I;var M=function(){function t(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=.5),this._numPoints=-1,this._pointMesh=null,this._pointSize=.5,this._pointType=0,this._linesName="MeshLines",this._linesMesh=null,this._babylonScene=null,this._pointMesh=null,this._linesMesh=null,this._linesName=e,this._babylonScene=t,this._pointType=n,this._pointSize=r}return Object.defineProperty(t.prototype,"pointMesh",{get:function(){return this._pointMesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linesMesh",{get:function(){return this._linesMesh},enumerable:!1,configurable:!0}),t.prototype.dispose=function(e){void 0===e&&(e=!0),this._babylonScene=null,this._linesName=null,null!=this._pointMesh&&(this._pointMesh.dispose(e),this._pointMesh=null),null!=this._linesMesh&&(this._linesMesh.dispose(e),this._linesMesh=null)},t.prototype.hidePoint=function(e){void 0===e&&(e=!0),null!=this._pointMesh&&(this._pointMesh.isVisible=!e)},t.prototype.drawPoint=function(t){null==this._pointMesh&&(1===this._pointType?(this._pointMesh=e.MeshBuilder.CreateBox(this._linesName+".EndPoint",{size:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25):(this._pointMesh=e.MeshBuilder.CreateSphere(this._linesName+".EndPoint",{segments:24,diameter:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25)),null!=this._pointMesh&&(this._pointMesh.isVisible=!0,this._pointMesh.position.copyFrom(t))},t.prototype.drawLine=function(t,n){void 0===n&&(n=null),null==this._linesMesh?(this._numPoints=t.length,this._linesMesh=e.MeshBuilder.CreateLines(this._linesName,{points:t,updatable:!0},this._babylonScene),this._linesMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),null!=n&&(this._linesMesh.color=n),this._linesMesh.refreshBoundingInfo(!1)):t.length===this._numPoints?(this._linesMesh=e.MeshBuilder.CreateLines(this._linesName,{points:t,instance:this._linesMesh},this._babylonScene),this._linesMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),null!=n&&(this._linesMesh.color=n),this._linesMesh.refreshBoundingInfo(!1)):e.Tools.Warn("Dynamic line mesh point count mismatch for "+this._linesName)},t}();e.LinesMeshRenderer=M;var x=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.addContainerTask=function(t,n,r,o){var a=this,i=new e.ContainerAssetTask(t,n,r,o),l=i;return l._lengthComputable=0,l._loaded=0,l._total=0,l.runTask=function(t,n,r){e.SceneLoader.LoadAssetContainer(i.rootUrl,i.sceneFilename,t,function(e){i.loadedContainer=e,i.loadedMeshes=e.meshes,i.loadedParticleSystems=e.particleSystems,i.loadedSkeletons=e.skeletons,i.loadedAnimationGroups=e.animationGroups,n()},function(e){l._lengthComputable=e.lengthComputable,l._loaded=e.loaded,l._total=e.total,a.handlePreloadingProgress()},function(e,t,n){r(t,n)})},this._tasks.push(i),i},n.prototype.addMeshTask=function(t,n,r,o){var a=this,i=new e.MeshAssetTask(t,n,r,o),l=i;return l._lengthComputable=0,l._loaded=0,l._total=0,l.runTask=function(t,n,r){e.SceneLoader.ImportMesh(i.meshesNames,i.rootUrl,i.sceneFilename,t,function(e,t,r,o){i.loadedMeshes=e,i.loadedParticleSystems=t,i.loadedSkeletons=r,i.loadedAnimationGroups=o,n()},function(e){l._lengthComputable=e.lengthComputable,l._loaded=e.loaded,l._total=e.total,a.handlePreloadingProgress()},function(e,t,n){r(t,n)})},this._tasks.push(i),i},n.prototype.addTextFileTask=function(t,n){var r=this,o=new e.TextFileAssetTask(t,n),a=o;return a._lengthComputable=0,a._loaded=0,a._total=0,a.runTask=function(e,t,n){e._loadFile(o.url,function(e){o.text=e,t()},function(e){a._lengthComputable=e.lengthComputable,a._loaded=e.loaded,a._total=e.total,r.handlePreloadingProgress()},!1,!1,function(e,t){e&&n(e.status+" "+e.statusText,t)})},this._tasks.push(o),o},n.prototype.addBinaryFileTask=function(t,n){var r=this,o=new e.BinaryFileAssetTask(t,n),a=o;return a._lengthComputable=0,a._loaded=0,a._total=0,a.runTask=function(e,t,n){e._loadFile(o.url,function(e){o.data=e,t()},function(e){a._lengthComputable=e.lengthComputable,a._loaded=e.loaded,a._total=e.total,r.handlePreloadingProgress()},!0,!0,function(e,t){e&&n(e.status+" "+e.statusText,t)})},this._tasks.push(o),o},n.prototype.addImageTask=function(t,n){var r=this,o=new e.ImageAssetTask(t,n),a=o;return a._lengthComputable=0,a._loaded=0,a._total=0,a.runTask=function(t,n,i){var l=new Image;e.Tools.SetCorsBehavior(o.url,l),l.onload=function(){o.image=l,n()},l.onerror=function(e){i("Error loading image",e)},l.onprogress=function(e){a._lengthComputable=e.lengthComputable,a._loaded=e.loaded,a._total=e.total,r.handlePreloadingProgress()},l.src=o.url},this._tasks.push(o),o},n.prototype.handlePreloadingProgress=function(){var t=!0,n=0,r=0;if(null!=this._tasks&&this._tasks.length>0)for(var o=0;o<this._tasks.length;o++){var a=this._tasks[o];null!=a._lengthComputable&&null!=a._loaded&&null!=a._total&&(t=t&&a._lengthComputable,n+=a._loaded,r+=a._total)}if(null!=e.SceneManager.OnAssetManagerProgress){var i={lengthComputable:t,loaded:n,total:t?r:0};e.SceneManager.OnAssetManagerProgress(i)}},n}(e.AssetsManager);e.PreloadAssetsManager=x;var A=function(){function e(){}return e.HasNetworkEntity=function(e){return null!=e&&null!=e.networkEntity},e.GetNetworkEntityId=function(e){return null==e?null:null!=e.networkEntity?e.networkEntity.id:null},e.GetNetworkEntityType=function(e){return null==e?0:null!=e.networkEntityType?e.networkEntityType:0},e.GetNetworkEntitySessionId=function(e){return null==e?null:null!=e.networkEntity?e.networkEntity.ownerId:null},e.QueryNetworkAttribute=function(e,t){var n=null;return null!=e&&null!=e.networkEntity&&null!=e.networkEntity.attributes&&(n=e.networkEntity.attributes.get(t)),n},e.QueryBufferedAttribute=function(e,t){var n=0;return null!=e&&null!=e.networkEntityAttributeBuffer&&(n=e.networkEntityAttributeBuffer[t.toFixed(0)]),n},e.PostBufferedAttribute=function(e,t,n){null==e.networkEntityBatch&&(e.networkEntityBatch={}),e.networkEntityBatch[t.toFixed(0)]=n},e}();e.EntityController=A;var O=function(){function t(){}return t.ZeroPad=function(e,t){var n=t-e.toString().length+1;return Array(+(n>0&&n)).join("0")+e},t.ShiftArray=function(e,t){return t?e.unshift(e.pop()):e.push(e.shift()),e},t.GetLayerMask=function(e){return 1<<e},t.IsLayerMasked=function(e,t){return 0!=(e&1<<t)},t.GetLoadingState=function(){return e.Utilities.LoadingState},t.GetRandomRange=function(t,n,r,o){void 0===r&&(r=null),void 0===o&&(o=null);var a=e.Scalar.RandomRange(t,n);if(null!=r){var i=null!=o?o:100;if(a===r)for(var l=0;l<i&&(a=e.Scalar.RandomRange(t,n),a===r);l++);}return a},t.GetRandomFloat=function(t,n,r,o){return void 0===r&&(r=null),void 0===o&&(o=null),parseFloat(e.Utilities.GetRandomRange(t,n,r,o).toFixed(2))},t.GetRandomInteger=function(t,n,r,o){return void 0===r&&(r=null),void 0===o&&(o=null),parseInt(e.Utilities.GetRandomRange(t,n,r,o).toFixed(0))},t.Approximately=function(t,n){return Math.abs(n-t)<Math.max(e.System.Epsilon*Math.max(Math.abs(t),Math.abs(n)),8*e.System.SingleEpsilon)},t.GetVertexDataFromMesh=function(t){var n=t.computeWorldMatrix(!0),r=e.VertexData.ExtractFromMesh(t,!0,!0);return r.transform(n),r},t.UpdateAbstractMeshMaterial=function(t,n,r){if(null!=t){var o=t instanceof e.InstancedMesh;if(o===!1){var a=t.material;if(a instanceof e.MultiMaterial){var i=a.clone(a.name+".Clone");i.subMaterials[r]=n,t.material=i}else t.material=n}else console.warn("Instanced mesh not supported as a node material on mesh: "+t.name)}else console.warn("Null source mesh for mesh: "+t.name)},t.HermiteVector3=function(t,n,r,o,a){var i=new e.Vector3(0,0,0);return e.Utilities.HermiteVector3ToRef(t,n,r,o,a,i),i},t.HermiteVector3ToRef=function(e,t,n,r,o,a){var i=o*o,l=o*i,s=2*l-3*i+1,u=-2*l+3*i,d=l-2*i+o,p=l-i,c=e._x*s+n._x*u+t._x*d+r._x*p,m=e._y*s+n._y*u+t._y*d+r._y*p,h=e._z*s+n._z*u+t._z*d+r._z*p;a.set(c,m,h)},t.LerpLog=function(e,t,n){var r=Math.min(Math.max(n,0),1),o=Math.sin(r*Math.PI*.5);return e+(t-e)*o},t.LerpExp=function(e,t,n){var r=Math.min(Math.max(n,0),1),o=1-Math.cos(r*Math.PI*.5);return e+(t-e)*o},t.LerpUnclamped=function(e,t,n){return e+(t-e)*n},t.LerpUnclampedColor3=function(t,n,r){var o=new e.Color3(0,0,0);return e.Utilities.LerpUnclampedColor3ToRef(t,n,r,o),o},t.LerpUnclampedColor3ToRef=function(e,t,n,r){r.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n)},t.LerpUnclampedColor4=function(t,n,r){var o=new e.Color4(0,0,0,1);return e.Utilities.LerpUnclampedColor4ToRef(t,n,r,o),o},t.LerpUnclampedColor4ToRef=function(e,t,n,r){r.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n,e.a+(t.a-e.a)*n)},t.LerpUnclampedVector2=function(t,n,r){var o=new e.Vector2(0,0);return e.Utilities.LerpUnclampedVector2ToRef(t,n,r,o),o},t.LerpUnclampedVector2ToRef=function(e,t,n,r){r.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},t.LerpUnclampedVector3=function(t,n,r){var o=new e.Vector3(0,0,0);return e.Utilities.LerpUnclampedVector3ToRef(t,n,r,o),o},t.LerpUnclampedVector3ToRef=function(e,t,n,r){r.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n)},t.LerpUnclampedVector4=function(t,n,r){var o=new e.Vector4(0,0,0,0);return e.Utilities.LerpUnclampedVector4ToRef(t,n,r,o),o},t.LerpUnclampedVector4ToRef=function(e,t,n,r){r.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n,e.w+(t.w-e.w)*n)},t.IsEqualUsingDot=function(t){return t>1-e.System.Epsilon},t.QuaternionAngle=function(t,n){var r=Math.min(Math.abs(e.Quaternion.Dot(t,n)),1);return e.Utilities.IsEqualUsingDot(r)?0:2*Math.acos(r)*e.System.Rad2Deg},t.QuaternionLengthSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},t.QuaternionRotateTowards=function(t,n,r){var o=new e.Quaternion(0,0,0,1);return e.Utilities.QuaternionRotateTowardsToRef(t,n,r,o),o},t.QuaternionRotateTowardsToRef=function(t,n,r,o){var a=e.Utilities.QuaternionAngle(t,n);0==a?o.copyFrom(n):e.Utilities.QuaternionSlerpUnclampedToRef(t,n,Math.min(1,r/a),o)},t.QuaternionSlerpUnclamped=function(t,n,r){var o=new e.Quaternion(0,0,0,1);return e.Utilities.QuaternionSlerpUnclampedToRef(t,n,r,o),o},t.QuaternionSlerpUnclampedToRef=function(e,t,n,r){},t.MoveTowardsVector2=function(t,n,r){var o=new e.Vector2(0,0);return e.Utilities.MoveTowardsVector2ToRef(t,n,r,o),o},t.MoveTowardsVector2ToRef=function(e,t,n,r){var o=t.x-e.x,a=t.y-e.y,i=o*o+a*a;if(0==i||n>=0&&i<=n*n)r.set(t.x,t.y);else{var l=Math.sqrt(i);r.set(e.x+o/l*n,e.y+a/l*n)}},t.MoveTowardsVector3=function(t,n,r){var o=new e.Vector3(0,0,0);return e.Utilities.MoveTowardsVector3ToRef(t,n,r,o),o},t.MoveTowardsVector3ToRef=function(e,t,n,r){var o=t.x-e.x,a=t.y-e.y,i=t.z-e.z,l=o*o+a*a+i*i;if(0==l||n>=0&&l<=n*n)r.set(t.x,t.y,t.z);else{var s=Math.sqrt(l);r.set(e.x+o/s*n,e.y+a/s*n,e.z+i/s*n)}},t.MoveTowardsVector4=function(t,n,r){var o=new e.Vector4(0,0,0,0);return e.Utilities.MoveTowardsVector4ToRef(t,n,r,o),o},t.MoveTowardsVector4ToRef=function(e,t,n,r){var o=t.x-e.x,a=t.y-e.y,i=t.z-e.z,l=t.w-e.w,s=o*o+a*a+i*i+l*l;if(0==s||n>=0&&s<=n*n)r.set(t.x,t.y,t.z,t.w);else{var u=Math.sqrt(s);r.set(e.x+o/u*n,e.y+a/u*n,e.z+i/u*n,e.w+l/u*n)}},t.ClampMagnitudeVector2=function(t,n){var r=new e.Vector2(0,0);return e.Utilities.ClampMagnitudeVector2ToRef(t,n,r),r},t.ClampMagnitudeVector2ToRef=function(e,t,n){var r=e.lengthSquared();if(r>t*t){var o=Math.sqrt(r),a=e.x/o,i=e.y/o;n.set(a*t,i*t)}},t.ClampMagnitudeVector3=function(t,n){var r=new e.Vector3(0,0,0);return e.Utilities.ClampMagnitudeVector3ToRef(t,n,r),r},t.ClampMagnitudeVector3ToRef=function(e,t,n){var r=e.lengthSquared();if(r>t*t){var o=Math.sqrt(r),a=e.x/o,i=e.y/o,l=e.z/o;n.set(a*t,i*t,l*t)}},t.GetAngle=function(t,n){return e.Utilities.GetAngleRadians(t,n)*e.System.Rad2Deg},t.GetAngleRadians=function(t,n){return Math.acos(e.Vector3.Dot(t,n))},t.ClampAngle=function(t,n,r){var o=t;do o<-360&&(o+=360),o>360&&(o-=360);while(o<-360||o>360);return e.Scalar.Clamp(o,n,r)},t.ClampAngle180=function(t,n,r){return t>180&&(t-=360),t=e.Scalar.Clamp(t,n,r),t<0&&(t+=360),t},t.ClampAngle360=function(t,n,r){return(t<90||t>270)&&(t>180&&(t-=360),r>180&&(r-=360),n>180&&(n-=360)),t=e.Scalar.Clamp(t,n,r),t<0&&(t+=360),t},t.SmoothDamp=function(t,n,r,o,a,i){if(!i)return 0;var l=t-n,s=Math.max(1e-4,r),u=2/s,d=u*a,p=1/(1+d+.48*d*d+.235*d*d*d),c=n,m=o*s;l=e.Scalar.Clamp(l,-m,m);var h=t-l,f=(i.x+u*l)*a;i.x=(i.x-u*f)*p;var g=h+(l+f)*p;return c-t>0==g>c&&(g=c,i.x=(g-c)/a),g},t.SmoothDampAngle=function(t,n,r,o,a,i){var l=t+e.Scalar.DeltaAngle(t,n);return e.Utilities.SmoothDamp(t,l,r,o,a,i)},t.SmoothDampVector2=function(t,n,r,o,a,i){var l=new e.Vector2(0,0);return e.Utilities.SmoothDampVector2ToRef(t,n,r,o,a,i,l),l},t.SmoothDampVector2ToRef=function(e,t,n,r,o,a,i){n=Math.max(1e-4,n);var l=2/n,s=l*o,u=1/(1+s+.48*s*s+.235*s*s*s),d=e.x-t.x,p=e.y-t.y,c=t.clone(),m=r*n,h=m*m,f=d*d+p*p;if(f>h){var g=Math.sqrt(f);d=d/g*m,p=p/g*m}t.x=e.x-d,t.y=e.y-p;var y=(a.x+l*d)*o,v=(a.y+l*p)*o;a.x=(a.x-l*y)*u,a.y=(a.y-l*v)*u;var _=t.x+(d+y)*u,b=t.y+(p+v)*u,C=c.x-e.x,S=c.y-e.y,T=_-c.x,I=b-c.y;C*T+S*I>0&&(_=c.x,b=c.y,a.x=(_-c.x)/o,a.y=(b-c.y)/o),i.set(_,b)},t.SmoothDampVector3=function(t,n,r,o,a,i){var l=new e.Vector3(0,0,0);return e.Utilities.SmoothDampVector3ToRef(t,n,r,o,a,i,l),l},t.SmoothDampVector3ToRef=function(e,t,n,r,o,a,i){var l=0,s=0,u=0;n=Math.max(1e-4,n);var d=2/n,p=d*o,c=1/(1+p+.48*p*p+.235*p*p*p),m=e.x-t.x,h=e.y-t.y,f=e.z-t.z,g=t.clone(),y=r*n,v=y*y,_=m*m+h*h+f*f;if(_>v){var b=Math.sqrt(_);m=m/b*y,h=h/b*y,f=f/b*y}t.x=e.x-m,t.y=e.y-h,t.z=e.z-f;var C=(a.x+d*m)*o,S=(a.y+d*h)*o,T=(a.z+d*f)*o;a.x=(a.x-d*C)*c,a.y=(a.y-d*S)*c,a.z=(a.z-d*T)*c,l=t.x+(m+C)*c,s=t.y+(h+S)*c,u=t.z+(f+T)*c;var I=g.x-e.x,M=g.y-e.y,x=g.z-e.z,A=l-g.x,O=s-g.y,w=u-g.z;I*A+M*O+x*w>0&&(l=g.x,s=g.y,u=g.z,a.x=(l-g.x)/o,a.y=(s-g.y)/o,a.z=(u-g.z)/o),i.set(l,s,u)},t.ToMatrix=function(t,n,r){return e.Matrix.RotationYawPitchRoll(e.Tools.ToRadians(n),e.Tools.ToRadians(t),e.Tools.ToRadians(r))},t.ToMatrixToRef=function(t,n,r,o){e.Matrix.RotationYawPitchRollToRef(e.Tools.ToRadians(n),e.Tools.ToRadians(t),e.Tools.ToRadians(r),o)},t.FastMatrixLerp=function(t,n,r,o){e.Matrix.LerpToRef(t,n,r,o)},t.FastMatrixSlerp=function(t,n,r,o){e.Matrix.DecomposeLerpToRef(t,n,r,o)},t.ToEuler=function(t){var n=t.toEulerAngles();return n.x=e.Tools.ToDegrees(n.x),n.y=e.Tools.ToDegrees(n.y),n.z=e.Tools.ToDegrees(n.z),n},t.ToEulerToRef=function(t,n){t.toEulerAnglesToRef(n),n.x=e.Tools.ToDegrees(n.x),n.y=e.Tools.ToDegrees(n.y),n.z=e.Tools.ToDegrees(n.z)},t.FromEuler=function(t,n,r){return e.Quaternion.FromEulerAngles(e.Tools.ToRadians(t),e.Tools.ToRadians(n),e.Tools.ToRadians(r))},t.FromEulerToRef=function(t,n,r,o){e.Quaternion.FromEulerAnglesToRef(e.Tools.ToRadians(t),e.Tools.ToRadians(n),e.Tools.ToRadians(r),o)},t.QuaternionDiff=function(t,n){var r=new e.Quaternion(0,0,0,1);return e.Utilities.QuaternionDiffToRef(t,n,r),r},t.QuaternionDiffToRef=function(t,n,r){e.Quaternion.InverseToRef(n,e.Utilities.TempQuaternion),e.Utilities.TempQuaternion.multiplyToRef(t,r)},t.QuaternionSubtractToRef=function(e,t,n){n.set(e._x-t._x,e._y-t._y,e._z-t._z,e._w-t._w)},t.RotateVector=function(t,n){var r=2*(n.y*t.z-n.z*t.y),o=2*(n.z*t.x-n.x*t.z),a=2*(n.x*t.y-n.y*t.x);return new e.Vector3(t.x+n.w*r+(n.y*a-n.z*o),t.y+n.w*o+(n.z*r-n.x*a),t.z+n.w*a+(n.x*o-n.y*r))},t.RotateVectorToRef=function(e,t,n){var r=2*(t.y*e.z-t.z*e.y),o=2*(t.z*e.x-t.x*e.z),a=2*(t.x*e.y-t.y*e.x);n.x=e.x+t.w*r+(t.y*a-t.z*o),n.y=e.y+t.w*o+(t.z*r-t.x*a),n.z=e.z+t.w*a+(t.x*o-t.y*r)},t.LookRotation=function(t){var n=e.Quaternion.Zero();return e.Utilities.LookRotationToRef(t,n),n},t.LookRotationToRef=function(t,n){e.Utilities.TempMatrix.reset(),e.Matrix.LookAtLHToRef(e.Utilities.ZeroVector,t,e.Utilities.UpVector,e.Utilities.TempMatrix),e.Utilities.TempMatrix.invert(),e.Quaternion.FromRotationMatrixToRef(e.Utilities.TempMatrix,n)},t.Vector3Rad2Deg=function(t){var n=e.Vector3.Zero();return e.Utilities.Vector3Rad2DegToRef(t,n),n},t.Vector3Rad2DegToRef=function(t,n){n.x=e.Tools.ToDegrees(t.x),n.y=e.Tools.ToDegrees(t.y),n.z=e.Tools.ToDegrees(t.z)},t.MultiplyQuaternionByVector=function(t,n){var r=new e.Vector3(0,0,0);return e.Utilities.MultiplyQuaternionByVectorToRef(t,n,r),r},t.MultiplyQuaternionByVectorToRef=function(e,t,n){var r=2*e.x,o=2*e.y,a=2*e.z,i=e.x*r,l=e.y*o,s=e.z*a,u=e.x*o,d=e.x*a,p=e.y*a,c=e.w*r,m=e.w*o,h=e.w*a;n.x=(1-(l+s))*t.x+(u-h)*t.y+(d+m)*t.z,n.y=(u+h)*t.x+(1-(i+s))*t.y+(p-c)*t.z,n.z=(d-m)*t.x+(p+c)*t.y+(1-(i+l))*t.z},t.ValidateTransformRotation=function(e){null!=e.rotationQuaternion&&(e.rotation=e.rotationQuaternion.toEulerAngles(),e.rotationQuaternion=null)},t.ValidateTransformQuaternion=function(t){null==t.rotationQuaternion&&null!=t.rotation&&(t.rotationQuaternion=e.Quaternion.FromEulerAngles(t.rotation.x,t.rotation.y,t.rotation.z),t.rotation.set(0,0,0))},t.GetKeyboardInputValue=function(t,n,r){var o=r;return e.UserInputOptions.KeyboardSmoothing===!0&&(o=e.Scalar.MoveTowards(n,r,e.UserInputOptions.KeyboardMoveSensibility*e.SceneManager.GetDeltaSeconds(t)),Math.abs(o)<e.UserInputOptions.KeyboardMoveDeadZone&&(o=0)),o},t.GenerateRandonNumber=function(e,t,n){void 0===n&&(n=2);var r=(Math.random()*(t-e)+e).toFixed(n);return parseFloat(r)},t.ProjectVector=function(t,n){var r=new e.Vector3(0,0,0);return e.Utilities.ProjectVectorToRef(t,n,r),r},t.ProjectVectorToRef=function(t,n,r){var o=e.Vector3.Dot(n,n);if(o<e.System.Epsilon)r.set(0,0,0);else{var a=e.Vector3.Dot(t,n);r.set(n.x*a/o,n.y*a/o,n.z*a/o)}},t.ProjectVectorOnPlane=function(t,n){var r=new e.Vector3(0,0,0);return e.Utilities.ProjectVectorOnPlaneToRef(t,n,r),r},t.ProjectVectorOnPlaneToRef=function(t,n,r){var o=e.Vector3.Dot(n,n);if(o<e.System.Epsilon)r.copyFrom(t);else{var a=e.Vector3.Dot(t,n);r.set(t.x-n.x*a/o,t.y-n.y*a/o,t.z-n.z*a/o)}},t.AreVectorsEqual=function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n},t.GetVerticalSlopeAngle=function(t,n){void 0===n&&(n=0);var r=Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))*e.System.Rad2Deg;return r=null!=r&&Number.isNaN(r)===!1?r:0,n>0&&r>=n&&(r=0),r},t.DownloadEnvironment=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=null),e.EnvironmentTextureTools.CreateEnvTextureAsync(t).then(function(r){var o=t.name||"Environment",a=new Blob([r],{type:"octet/stream"});e.Tools.Download(a,o+".env"),null!=n&&n()})["catch"](function(e){console.error(e),null!=r&&r()})},t.HasOwnProperty=function(e,t){return null!=e&&null!=t&&""!==t&&t in e},t.FindMeshCollider=function(t,n){var r=null;if(n instanceof e.TransformNode){var o=null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.renderer&&null!=n.metadata.unity.renderer.hasmeshcollider&&n.metadata.unity.renderer.hasmeshcollider===!0;if(o===!0){var a=n.id+"-collider";r=t.getMeshById(a)}}return r},t.ColliderInstances=function(){return null==e.SceneManager.GlobalOptions.colliderInstances||e.SceneManager.GlobalOptions.colliderInstances},t.ReparentColliders=function(){return null==e.SceneManager.GlobalOptions.reparentColliders||e.SceneManager.GlobalOptions.reparentColliders},t.UseTriangleNormals=function(){return null!=e.SceneManager.GlobalOptions.useTriangleNormals&&e.SceneManager.GlobalOptions.useTriangleNormals},t.UseConvexTriangles=function(){return null!=e.SceneManager.GlobalOptions.useConvexTriangles&&e.SceneManager.GlobalOptions.useConvexTriangles},t.DefaultRenderGroup=function(){return null!=e.SceneManager.GlobalOptions.defaultRenderGroup?e.SceneManager.GlobalOptions.defaultRenderGroup:0},t.ShowDebugColliders=function(){return null!=e.SceneManager.GlobalOptions.showDebugColliders&&e.SceneManager.GlobalOptions.showDebugColliders},t.ColliderVisibility=function(){return null!=e.SceneManager.GlobalOptions.colliderVisibility?e.SceneManager.GlobalOptions.colliderVisibility:0},t.ColliderRenderGroup=function(){return null!=e.SceneManager.GlobalOptions.colliderRenderGroup?e.SceneManager.GlobalOptions.colliderRenderGroup:0},t.CollisionWireframe=function(){return null!=e.SceneManager.GlobalOptions.collisionWireframe&&e.SceneManager.GlobalOptions.collisionWireframe},t.GetColliderMaterial=function(t){var n="Collider-Material",r=t.getMaterialByName(n);if(null==r){var o=new e.PBRMaterial(n,t);o.albedoColor=new e.Color3(0,.75,0),o.wireframe=e.Utilities.CollisionWireframe(),o.unlit=!0,r=o}return r},t.CalculateCombinedFriction=function(e,t){var n=10,r=e*t;return r<-n&&(r=-n),r>n&&(r=n),r},t.CalculateCombinedRestitution=function(e,t){return e*t},t.AddLoaderItemMarkedForDisposal=function(t){null==e.Utilities.LoaderItemsMarkedForDisposal&&(e.Utilities.LoaderItemsMarkedForDisposal=[]),e.Utilities.LoaderItemsMarkedForDisposal.push(t)},t.ResetLoaderItemsMarkedForDisposal=function(){e.Utilities.LoaderItemsMarkedForDisposal=[]},t.RemoveLoaderItemsMarkedForDisposal=function(){null!=e.Utilities.LoaderItemsMarkedForDisposal&&e.Utilities.LoaderItemsMarkedForDisposal.length>0&&e.Utilities.LoaderItemsMarkedForDisposal.forEach(function(e){try{e.dispose()}catch(t){console.warn(t)}}),e.Utilities.ResetLoaderItemsMarkedForDisposal()},t.GetDirectTargetAngle=function(t,n){return e.Utilities.TempVector3.set(0,0,0),e.Utilities.InverseTransformPointToRef(t,n,e.Utilities.TempVector3),Math.atan2(e.Utilities.TempVector3.x,e.Utilities.TempVector3.z)},t.GetSmoothTargetAngle=function(t,n){return e.Utilities.TempVector3.set(0,0,0),e.Utilities.InverseTransformPointToRef(t,n,e.Utilities.TempVector3),e.Utilities.TempVector3.x/e.Utilities.TempVector3.length()},t.CalculatCatmullRom=function(t,n,r,o,a){var i=new e.Vector3(0,0,0);return e.Utilities.CalculatCatmullRomToRef(t,n,r,o,a,i),i},t.CalculatCatmullRomToRef=function(e,t,n,r,o,a){},t.StartsWith=function(e,t){return 0===e.lastIndexOf(t,0)},t.EndsWith=function(e,t){return e.indexOf(t,e.length-t.length)!==-1},t.ReplaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},t.IsNullOrEmpty=function(e){return null==e||""===e},t.SafeStringPush=function(e,t){e.indexOf(t)===-1&&e.push(t)},t.ParseColor3=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var o=null;return o=null!=t&&null!=t.r&&null!=t.g&&null!=t.b?r===!0?new e.Color3(t.r,t.g,t.b).toLinearSpace():new e.Color3(t.r,t.g,t.b):n},t.ParseColor4=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var o=null;if(null!=t&&null!=t.r&&null!=t.g&&null!=t.b){var a=null!=t.a?t.a:1;o=r===!0?new e.Color4(t.r,t.g,t.b,a).toLinearSpace():new e.Color4(t.r,t.g,t.b,a)}else o=n;return o},t.ParseVector2=function(t,n){void 0===n&&(n=null);var r=null;return r=null!=t&&null!=t.x&&null!=t.y?new e.Vector2(t.x,t.y):n},t.ParseVector3=function(t,n){void 0===n&&(n=null);var r=null;return r=null!=t&&null!=t.x&&null!=t.y&&null!=t.z?new e.Vector3(t.x,t.y,t.z):n},t.ParseVector4=function(t,n){void 0===n&&(n=null);var r=null;return r=null!=t&&null!=t.x&&null!=t.y&&null!=t.z&&null!=t.w?new e.Vector4(t.x,t.y,t.z,t.w):n},t.ParseSound=function(t,n,r,o,a){var i=null;if(null!=t&&null!=t.filename&&""!==t.filename){var l=e.SceneManager.GetRootUrl(n),s=t.filename;i=new e.Sound(r,l+s,n,o,a)}return i},t.ParseTexture=function(t,n,r,o,a,i,l,s,u,d){var p=null;if(null!=t&&null!=t.filename&&""!==t.filename){var c=e.SceneManager.GetRootUrl(n),m=t.filename;p=new e.Texture(c+m,n,r,o,a,i,l,s,u,d)}return p},t.ParseCubemap=function(t,n){var r=null;if(null!=t&&null!=t.info){var o=e.SceneManager.GetRootUrl(n),a=o+t.info.rooturl;r=e.CubeTexture.Parse(t.info,n,a),null!=r&&(r.gammaSpace=!1)}return r},t.ParseTextAsset=function(e,t){void 0===t&&(t=null);var n=null;return n=null!=e&&null!=e.base64&&""!==e.base64?window.atob(e.base64):t},t.ParseJsonAsset=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=null);var o=e.Utilities.ParseTextAsset(t,n);return null!=o&&""!==o?JSON.parse(o,r):null},t.ParseTransformByID=function(t,n,r){void 0===r&&(r=null);var o=null;return o=null!=t&&null!=t.id?e.SceneManager.GetTransformNodeByID(n,t.id):r},t.ParseTransformByName=function(t,n,r){void 0===r&&(r=null);var o=null;return o=null!=t&&null!=t.id?e.SceneManager.GetTransformNode(n,t.id):r},t.ParseChildTransform=function(t,n,r){void 0===r&&(r=null);var o=null;return o=null!=n&&null!=n.name?e.SceneManager.FindChildTransformNode(t,n.name,e.SearchType.IndexOf,!1):r},t.SetAbsolutePosition=function(e,t){e.setAbsolutePosition(t)},t.GetAbsolutePosition=function(t,n,r){return void 0===n&&(n=null),void 0===r&&(r=!0),e.Utilities.TransformPoint(t,n||e.Utilities.ZeroVector,r)},t.GetAbsolutePositionToRef=function(t,n,r,o){void 0===r&&(r=null),void 0===o&&(o=!0),e.Utilities.TransformPointToRef(t,r||e.Utilities.ZeroVector,n,o)},t.SetAbsoluteRotation=function(t,n){null==t.rotationQuaternion&&(t.rotationQuaternion=t.rotation.toQuaternion()),null!=t.parent&&t.parent instanceof e.TransformNode?(e.Utilities.TempQuaternion2.set(0,0,0,1),e.Utilities.GetAbsoluteRotationToRef(t.parent,e.Utilities.TempQuaternion2),e.Quaternion.InverseToRef(e.Utilities.TempQuaternion2,e.Utilities.TempQuaternion2),e.Utilities.TempQuaternion2.multiplyInPlace(n),t.rotationQuaternion.copyFrom(e.Utilities.TempQuaternion2)):t.rotationQuaternion.copyFrom(n)},t.GetAbsoluteRotation=function(t){var n=new e.Quaternion(0,0,0,1);return e.Utilities.GetAbsoluteRotationToRef(t,n),n},t.GetAbsoluteRotationToRef=function(t,n){if(null!=t.parent&&t.parent instanceof e.TransformNode)return e.Utilities.GetAbsoluteRotationToRef(t.parent,n),null==t.rotationQuaternion&&(t.rotationQuaternion=t.rotation.toQuaternion()),void n.multiplyInPlace(t.rotationQuaternion);var r=t.scaling;if(1==r.x&&1==r.y&&1==r.z)n.copyFrom(t.absoluteRotationQuaternion);else{var o=1/r.x,a=1/r.y,i=1/r.z,l=t.getWorldMatrix()._m;e.Utilities.TempMatrix2.reset(),e.Matrix.FromValuesToRef(l[0]*o,l[1]*o,l[2]*o,0,l[4]*a,l[5]*a,l[6]*a,0,l[8]*i,l[9]*i,l[10]*i,0,0,0,0,1,e.Utilities.TempMatrix2),e.Utilities.TempQuaternion3.set(0,0,0,1),e.Utilities.TempMatrix2.decompose(void 0,e.Utilities.TempQuaternion3,void 0),n.copyFrom(e.Utilities.TempQuaternion3)}},t.TransformPoint=function(t,n,r){return void 0===r&&(r=!0),r===!0&&t.computeWorldMatrix(),e.Vector3.TransformCoordinates(n,t.getWorldMatrix())},t.InverseTransformPoint=function(t,n,r){return void 0===r&&(r=!0),r===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformCoordinates(n,e.Utilities.TempMatrix)},t.TransformPointToRef=function(t,n,r,o){void 0===o&&(o=!0),o===!0&&t.computeWorldMatrix(),e.Vector3.TransformCoordinatesToRef(n,t.getWorldMatrix(),r)},t.InverseTransformPointToRef=function(t,n,r,o){void 0===o&&(o=!0),o===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformCoordinatesToRef(n,e.Utilities.TempMatrix,r)},t.TransformDirection=function(t,n,r){return void 0===r&&(r=!0),r===!0&&t.computeWorldMatrix(),e.Vector3.TransformNormal(n,t.getWorldMatrix())},t.InverseTransformDirection=function(t,n,r){return void 0===r&&(r=!0),r===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformNormal(n,e.Utilities.TempMatrix)},t.TransformDirectionToRef=function(t,n,r,o){void 0===o&&(o=!0),o===!0&&t.computeWorldMatrix(),e.Vector3.TransformNormalToRef(n,t.getWorldMatrix(),r)},t.InverseTransformDirectionToRef=function(t,n,r,o){void 0===o&&(o=!0),o===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),e.Vector3.TransformNormalToRef(n,e.Utilities.TempMatrix,r)},t.RecomputeCenterPivotPoint=function(t){var n=t.getBoundingInfo().boundingSphere.center;t.setPivotMatrix(e.Matrix.Translation(-n.x,-n.y,-n.z))},t.GetDirectionVector=function(e,t){return e.getDirection(t)},t.GetDirectionVectorToRef=function(e,t,n){e.getDirectionToRef(t,n)},t.GetForwardVector=function(t){return t.getDirection(e.Vector3.Forward())},t.GetForwardVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Forward(),n)},t.GetRightVector=function(t){return t.getDirection(e.Vector3.Right())},t.GetRightVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Right(),n)},t.GetUpVector=function(t){return t.getDirection(e.Vector3.Up())},t.GetUpVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Up(),n)},t.BlendFloatValue=function(t,n,r){var o=e.Scalar.Clamp(r,0,1);return o>0?e.Scalar.Lerp(t,n,o):t},t.BlendVector2Value=function(t,n,r){var o=e.Scalar.Clamp(r,0,1);if(o>0){var a=e.Vector2.Lerp(t,n,o);t.copyFrom(a)}},t.BlendVector3Value=function(t,n,r){
var o=e.Scalar.Clamp(r,0,1);o>0&&e.Vector3.LerpToRef(t,n,o,t)},t.BlendQuaternionValue=function(t,n,r){var o=e.Scalar.Clamp(r,0,1);o>0&&e.Quaternion.SlerpToRef(t,n,o,t)},t.SetAnimationTargetProperty=function(e,t){null!=e&&(e.targetProperty=t,e.targetPropertyPath=e.targetProperty.split("."))},t.SampleAnimationFloat=function(t,n,r,o){void 0===r&&(r=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===o&&(o=!1);var a=0;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_FLOAT&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:r,workValue:e.Matrix.Zero()}),a=e.Utilities.InterpolateAnimation(t,n,t._state,o)),a},t.SampleAnimationVector2=function(t,n,r,o){void 0===r&&(r=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===o&&(o=!1);var a=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_VECTOR2&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:r,workValue:e.Matrix.Zero()}),a=e.Utilities.InterpolateAnimation(t,n,t._state,o)),a},t.SampleAnimationVector3=function(t,n,r,o){void 0===r&&(r=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===o&&(o=!1);var a=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_VECTOR3&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:r,workValue:e.Matrix.Zero()}),a=e.Utilities.InterpolateAnimation(t,n,t._state,o)),a},t.SampleAnimationQuaternion=function(t,n,r,o){void 0===r&&(r=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===o&&(o=!1);var a=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_QUATERNION&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:r,workValue:e.Matrix.Zero()}),a=e.Utilities.InterpolateAnimation(t,n,t._state,o)),a},t.SampleAnimationMatrix=function(t,n,r,o){void 0===r&&(r=e.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===o&&(o=!1);var a=null;return null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_MATRIX&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:r,workValue:e.Matrix.Zero()}),a=e.Utilities.InterpolateAnimation(t,n,t._state,o)),a},t.CreateTweenAnimation=function(t,n,r,o,a,i){void 0===a&&(a=30),void 0===i&&(i=e.Animation.ANIMATIONLOOPMODE_RELATIVE);var l=[];l.push({frame:0,value:r}),l.push({frame:a,value:o});var s=new e.Animation(t,n,a,e.Animation.ANIMATIONTYPE_FLOAT,i);return s.setKeys(l),s},t.GetLastKeyFrameIndex=function(e){var t=0;if(null!=e){var n=e.getKeys();if(null!=n&&n.length>0){var r=n[n.length-1];null!=r&&(t=r.frame)}}return t},t.InterpolateAnimation=function(t,n,r,o){void 0===o&&(o=!1);var a=o===!0?n*e.SceneManager.AnimationTargetFps:n;return t._interpolate(a,r)},t.UpdateLoopBlendPositionSettings=function(e,t,n){var r=e;null!=r.metadata&&null!=r.metadata.unity&&null!=r.metadata.unity.settings&&(r.metadata.unity.settings.loopblendpositiony=t,r.metadata.unity.settings.loopblendpositionxz=n)},t.InitializeShaderMaterial=function(t,n,r){void 0===n&&(n=!0),void 0===r&&(r=!1);var o=t,a=e.Utilities.HasOwnProperty(o,"getShaderName")?o.getShaderName():"glsl",i=!!e.Utilities.HasOwnProperty(o,"getAlphaBlending")&&o.getAlphaBlending(),l=!!e.Utilities.HasOwnProperty(o,"getAlphaTesting")&&o.getAlphaTesting(),s=e.Utilities.HasOwnProperty(o,"getDefaultDefines")?o.getDefaultDefines():null,u=e.Utilities.HasOwnProperty(o,"getDefaultAttributes")?o.getDefaultAttributes():null,d=e.Utilities.HasOwnProperty(o,"getDefaultUniforms")?o.getDefaultUniforms():null;(null==s||s.length<=0)&&(s=["#define GAMETIME","#define DELTATIME","#define DIFFUSECOLOR","#define DIFFUSETEXTURE"]),(null==u||u.length<=0)&&(u=["position","normal","uv","uv2","color"]),(null==d||d.length<=0)&&(d=["world","worldView","worldViewProjection","view","projection","viewProjection","gameTime","deltaTime","diffuseColor","diffuseTexture","diffuseTextureInfos","diffuseTextureMatrix"]);var p={vertex:a,fragment:a},c={needAlphaBlending:i,needAlphaTesting:l,attributes:u,uniforms:d,defines:s,useClipPlane:r,samplers:[],uniformBuffers:[],externalTextures:[],samplerObjects:[],storageBuffers:[]};o._shaderPath=p,o._options=c,n===!0&&(o.fn_afterBind=o.bind,o.bind=function(e,n,r){if(void 0===r&&(r=null),null!=o.updateGlobalTime&&o.updateGlobalTime(),o.after&&o.after(),o.fn_afterBind)try{o.fn_afterBind(e,n,r)}catch(a){}var i=null!==r&&void 0!==r?r:o.getEffect(),l=t.getScene();if(l.texturesEnabled&&null!=i)for(var s in o._textures){var u=o._textures[s];null!=u&&(i.setFloat2(s+"Infos",u.coordinatesIndex,u.level),i.setMatrix(s+"Matrix",u.getTextureMatrix()))}}),o.awake&&o.awake()},t.WorldToScreenPoint=function(t,n,r){void 0===r&&(r=null);var o=null,a=null!=r?r.viewport:null!=t.activeCamera?t.activeCamera.viewport:null;return null!=a&&(o=e.Vector3.Project(n,e.Matrix.Identity(),t.getTransformMatrix(),a.toGlobal(t.getEngine().getRenderWidth(),t.getEngine().getRenderHeight()))),o},t.ScreenToWorldPoint=function(t,n){return e.Vector3.Unproject(n,t.getEngine().getRenderWidth(),t.getEngine().getRenderHeight(),e.Matrix.Identity(),t.getViewMatrix(),t.getProjectionMatrix())},t.LoadTextFile=function(t,n,r,o){return e.Tools.LoadFile(t,n,r,null,!1,o)},t.LoadTextFileAsync=function(t){return e.Tools.LoadFileAsync(t,!1)},t.GetHttpRequest=function(e,t,n,r,o,a,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=!1),void 0===i&&(i=null);var l=new XMLHttpRequest;return l.open("GET",e,!0),a===!0&&(l.responseType="arraybuffer"),null!=i&&l.overrideMimeType(i),null!=t&&t.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&l.setRequestHeader(e.name,e.value)}),l.onreadystatechange=function(){l.readyState===XMLHttpRequest.DONE&&null!=n&&n(l)},l.onprogress=function(e){null!=o&&o(e)},l.onerror=function(){null!=r&&r("Failed to get data from server.")},l.onabort=function(){null!=r&&r("Aborted get data from server.")},l.send(null),l},t.GetHttpRequestAsync=function(t,n,r,o,a){return void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=!1),void 0===a&&(a=null),new Promise(function(i,l){e.Utilities.GetHttpRequest(t,n,function(e){i(e)},function(e){l(e)},r,o,a)})},t.PostHttpRequest=function(e,t,n,r,o,a,i,l,s){void 0===n&&(n=null),void 0===r&&(r="application/x-www-form-urlencoded"),void 0===o&&(o=null),void 0===a&&(a=null),void 0===i&&(i=null),void 0===l&&(l=!1),void 0===s&&(s=null);var u=new XMLHttpRequest;return u.open("POST",e,!0),l===!0&&(u.responseType="arraybuffer"),null!=s&&u.overrideMimeType(s),null!=n&&n.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&u.setRequestHeader(e.name,e.value)}),u.setRequestHeader("Content-Type",r),u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&null!=o&&o(u)},u.onprogress=function(e){null!=i&&i(e)},u.onerror=function(){null!=a&&a("Failed to post data to server.")},u.onabort=function(){null!=a&&a("Aborted post data to server.")},u.send(t),u},t.PostHttpRequestAsync=function(t,n,r,o,a,i,l){return void 0===r&&(r=null),void 0===o&&(o="application/x-www-form-urlencoded"),void 0===a&&(a=null),void 0===i&&(i=!1),void 0===l&&(l=null),new Promise(function(s,u){e.Utilities.PostHttpRequest(t,n,r,o,function(e){s(e)},function(e){u(e)},a,i,l)})},t.RemapValueToRange=function(e,t,n,r,o){return r+(e-t)*(o-r)/(n-t)},t.CloneSkeletonPrefab=function(t,n,r,o,a){void 0===a&&(a=null);var i=new e.Skeleton(r,o||r,t);i.needInitialSkinMatrix=n.needInitialSkinMatrix;for(var l=0;l<n.bones.length;l++){var s=n.bones[l],u=null,d=s.getParent();if(d){var p=n.bones.indexOf(d);u=i.bones[p]}var c=new e.Bone(s.name,i,u,s.getBaseMatrix().clone(),s.getRestPose().clone());c._index=s._index,c.metadata=s.metadata,s._linkedTransformNode&&c.linkTransformNode(s._linkedTransformNode),e.DeepCopier.DeepCopy(s.animations,c.animations)}var m=i,h=n;if(h._ranges){m._ranges={};for(var f in h._ranges){var g=h._ranges[f];g&&(m._ranges[f]=g.clone())}}return h._isDirty=!0,i},t.GetSceneTransforms=function(e){var t=null;return null!=e.transformNodes&&e.transformNodes.length>0&&e.transformNodes.forEach(function(e){null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.prefab&&e.metadata.unity.prefab===!1&&(null==t&&(t=[]),t.push(e))}),null!=e.meshes&&e.meshes.length>0&&e.meshes.forEach(function(e){null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.prefab&&e.metadata.unity.prefab===!1&&(null==t&&(t=[]),t.push(e))}),t},t.PostParseSceneComponents=function(t,n,r,o){if(null!=n&&n.length>0){var a=new e.MetadataParser(t);n.forEach(function(e){a.parseSceneComponents(e)}),a.postProcessSceneComponents(r,o)}},t.GetAssetContainerMesh=function(t,n){var r=null,o=n.toLowerCase();if(null==r&&null!=t.meshes&&t.meshes.length>0)for(var a=0;a<t.meshes.length;a++){var i=t.meshes[a];if(i instanceof e.Mesh&&i.name.toLowerCase()===o){r=i;break}}return r},t.GetAssetContainerNode=function(e,t){var n=null,r=t.toLowerCase();if(null==n&&null!=e.transformNodes&&e.transformNodes.length>0)for(var o=0;o<e.transformNodes.length;o++){var a=e.transformNodes[o];if(a.name.toLowerCase()===r){n=a;break}}return n},t.CloneAssetContainerItem=function(t,n,r,o,a,i){void 0===o&&(o=null),void 0===a&&(a=!1),void 0===i&&(i=!0);var l=null,s={},u={},d={},p=null,c=null,m=[],h=[],f=n.toLowerCase(),g=null,y=function(t,n){null==g&&(g=n),s[t.uniqueId]=n.uniqueId,u[n.uniqueId]=n,r&&(n.name=r(t.name)),null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.entity&&(n.metadata=e.Utilities.CloneEntityMetadata(t.metadata));var o=null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.animator?n.metadata.unity.animator:null;if(null!=o&&""!==o&&(null==p&&(p=[]),p.indexOf(o)<0&&p.push(o),n.metadata.unity.animator=e.Utilities.CreateGuid(),d[o]=n.metadata.unity.animator),t instanceof e.AbstractMesh&&null!=t.skeleton&&(null==c&&(c=[]),c.indexOf(t.skeleton)<0&&c.push(t.skeleton)),n instanceof e.Mesh){var a=n;if(a.morphTargetManager){var i=t.morphTargetManager;a.morphTargetManager=i.clone();for(var l=0;l<i.numTargets;l++){var m=i.getTarget(l),h=a.morphTargetManager.getTarget(l);s[m.uniqueId]=h.uniqueId,u[h.uniqueId]=h}}}};if(null==l&&null!=t.transformNodes&&t.transformNodes.length>0)for(var v=0;v<t.transformNodes.length;v++){var _=t.transformNodes[v];if(_.name.toLowerCase()===f){var b=e.Utilities.InstantiateHierarchy(_,o,function(e,t){y(e,t)});if(b){l=b;break}}}if(null==l&&null!=t.meshes&&t.meshes.length>0)for(var C=function(n){var i=t.meshes[n];if(i.name.toLowerCase()===f){var d=e.Utilities.InstantiateHierarchy(i,o,function(e,n){y(e,n);var o=n;if(i.isWorldMatrixFrozen===!0&&o.freezeWorldMatrix&&o.freezeWorldMatrix(),n.material&&o.material)if(a===!0){var l=e.material;if(h.indexOf(l)===-1){var d=l.clone(r?r(l.name):"Clone of "+l.name);if(l.isFrozen===!0&&d.freeze&&d.freeze(),h.push(l),s[l.uniqueId]=d.uniqueId,u[d.uniqueId]=d,"MultiMaterial"===l.getClassName())for(var p=l,c=0,m=p.subMaterials;c<m.length;c++){var f=m[c];f&&(d=f.clone(r?r(f.name):"Clone of "+f.name),f.isFrozen===!0&&d.freeze&&d.freeze(),h.push(f),s[f.uniqueId]=d.uniqueId,u[d.uniqueId]=d)}}o.material=u[s[l.uniqueId]]}else"MultiMaterial"===o.material.getClassName()?t.scene.multiMaterials.indexOf(o.material)===-1&&t.scene.addMultiMaterial(o.material):t.scene.materials.indexOf(o.material)===-1&&t.scene.addMaterial(o.material)});if(d)return l=d,"break"}},v=0;v<t.meshes.length;v++){var S=C(v);if("break"===S)break}if(null!=c&&c.length>0&&c.forEach(function(n){for(var o=r?r(n.name):"Clone of "+n.name,a=e.Utilities.CloneSkeletonPrefab(t.scene,n,o,o,g),i=0,l=t.meshes;i<l.length;i++){var d=l[i];if(d.skeleton===n&&!d.isAnInstance){var p=u[s[d.uniqueId]];if(p.skeleton=a,m.indexOf(a)!==-1)continue;m.push(a);for(var c=0,h=a.bones;c<h.length;c++){var f=h[c];f._linkedTransformNode&&(f._linkedTransformNode=u[s[f._linkedTransformNode.uniqueId]])}}}}),i===!0){var T=null;t.animationGroups.forEach(function(e){var t=e,n=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.source&&""!==t.metadata.unity.source?t.metadata.unity.source:null;if(null!=n&&""!==n&&null!=p&&p.indexOf(n)>=0){var r=e.clone(e.name,function(e){var t=u[s[e.uniqueId]];return t||e}),o=d[n]||n;null!=t.metadata&&(r.metadata={},r.metadata.unity={},r.metadata.unity.id=t.metadata.unity.id,r.metadata.unity.clip=t.metadata.unity.clip,r.metadata.unity.source=o,r.metadata.unity.legacy=t.metadata.unity.legacy,r.metadata.unity.length=t.metadata.unity.length,r.metadata.unity.looping=t.metadata.unity.looping,r.metadata.unity.settings=t.metadata.unity.settings,r.metadata.unity.behavior=t.metadata.unity.behavior,r.metadata.unity.wrapmode=t.metadata.unity.wrapmode,r.metadata.unity.framerate=t.metadata.unity.framerate,r.metadata.unity.humanmotion=t.metadata.unity.humanmotion,r.metadata.unity.averagespeed=t.metadata.unity.averagespeed,r.metadata.unity.averageduration=t.metadata.unity.averageduration,r.metadata.unity.averageangularspeed=t.metadata.unity.averageangularspeed),null==T&&(T=[]),T.push(r)}}),null!=l&&null!=T&&e.Utilities.AssignAnimationGroupsToInstance(l,T)}return l},t.AssignAnimationGroupsToInstance=function(t,n){e.Utilities.AssignAnimationGroupsToNode(t,n);var r=t.getChildren(null,!1);null!=r&&r.length>0&&r.forEach(function(t){e.Utilities.AssignAnimationGroupsToNode(t,n)})},t.AssignAnimationGroupsToNode=function(e,t){if(null!=e&&null!=e.metadata&&e.metadata.unity){var n=e.metadata.unity;if(null!=n.components&&n.components.length>0)for(var r=0;r<n.components.length;r++){var o=n.components[r];if("BABYLON.AnimationState"===o.klass){e.metadata.unity.sourceAnimationGroups=t;break}}}},t.InstantiateHierarchy=function(t,n,r){if(void 0===n&&(n=null),t instanceof e.Mesh){var o=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.instance&&t.metadata.unity.instance===!0;return e.Utilities.InstantiateMeshHierarchy(t,n,o,r)}return e.Utilities.InstantiateNodeHierarchy(t,n,r)},t.InstantiateNodeHierarchy=function(t,n,r){void 0===n&&(n=null);var o=t.clone("Clone of "+(t.name||t.id),n,!0);o&&r&&r(t,o);for(var a=0,i=t.getChildTransformNodes(!0);a<i.length;a++){var l=i[a];e.Utilities.InstantiateHierarchy(l,o,r)}return o},t.InstantiateMeshHierarchy=function(t,n,r,o){void 0===n&&(n=null);var a=t.getTotalVertices()>0&&r===!0?t.createInstance("Instance of "+(t.name||t.id)):t.clone("Clone of "+(t.name||t.id),n||t.parent,!0);a&&(a.parent=n,a.position=t.position.clone(),a.scaling=t.scaling.clone(),t.rotationQuaternion?a.rotationQuaternion=t.rotationQuaternion.clone():a.rotation=t.rotation.clone(),o&&o(t,a));for(var i=0,l=t.getChildTransformNodes(!0);i<l.length;i++){var s=l[i];e.Utilities.InstantiateHierarchy(s,a,o)}return a},t.RetargetAnimationGroupSkeleton=function(e,t,n){void 0===n&&(n=null),null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,r){if(null!=e.target&&null!=e.target.name){var o=t.bones.filter(function(t){return t.name.toLowerCase()===e.target.name.toLowerCase()})[0];if(null!=o){var a=o.getTransformNode();null!=a&&(e.target=o.getTransformNode())}else"Armature"===e.target.name&&null!=n?e.target=n:console.warn("Failed to locate matching animation cloning target: "+e.target.name)}})},t.RetargetAnimationGroupBlendShapes=function(e,t){null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,t){null!=e.target&&null!=e.target.name})},t.LinkSkeletonMeshes=function(t,n){if(null!=t&&null!=t.bones&&t.bones.length>0&&null!=n&&null!=n.bones&&n.bones.length>0)for(var r=n.bones.length,o=0;o<r;o++){var a=n.bones[o];if(null!=a){var i=e.Utilities.FindBoneByName(t,a.name);null!=i?a._linkedTransformNode=i._linkedTransformNode:console.warn("Failed to locate bone on mater rig: "+a.name)}}},t.FindBoneByName=function(e,t){var n=null;if(null!=e&&null!=e.bones)for(var r=0;r<e.bones.length;r++){var o=e.bones[r],a=o.name.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right"),i=t.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right");if(a===i){n=o;break}}return n},t.SwitchHandednessVector3=function(t){return new e.Vector3(t.x,t.y,(-t.z))},t.SwitchHandednessVector4=function(t){return new e.Vector4(t.x,t.y,(-t.z),(-t.w))},t.SwitchHandednessQuaternion=function(t){return new e.Quaternion(t.x,t.y,(-t.z),(-t.w))},t.ComputeBlendingSpeed=function(e,t,n){void 0===n&&(n=!1);var r=1/(e*t);return n===!0&&(r*=.5),r},t.CalculateCameraDistance=function(e,t,n){void 0===n&&(n=1);var r=1;return Math.round(e*n*t*r)},t.InstantiateClass=function(e){for(var t=e.split("."),n=window||this,r=0,o=t.length;r<o;r++)n=n[t[r]];return"function"==typeof n?n:null},t.GetSimpleClassName=function(e){if(e&&e.constructor&&e.constructor.toString){var t=e.constructor.toString().match(/function\s*(\w+)/);if(t&&2==t.length)return t[1]}},t.DisposeEntity=function(t){if(null!=t){if(null!=t.metadata&&t.metadata.unity){var n=t.metadata.unity;null!=n.components&&n.components.length>0&&n.components.forEach(function(t){if(null!=t.instance){try{e.SceneManager.DestroyScriptComponent(t.instance)}catch(n){}t.instance=null}}),delete t.metadata.unity}if(null!=t.metadata&&t.metadata.mixer&&delete t.metadata.mixer,null!=t.metadata&&null!=t.metadata.clone&&delete t.metadata.clone,null!=t.physicsImpostor){var r=t.physicsImpostor;null!=r.onCollideEvent&&(r.onCollideEvent=null),null!=r.tmpCollisionObjects&&delete r.tmpCollisionObjects,null!=t.physicsImpostor.physicsBody&&(null!=t.physicsImpostor.physicsBody.entity&&delete t.physicsImpostor.physicsBody.entity,null!=t.physicsImpostor.physicsBody.triangleMapInfo&&delete t.physicsImpostor.physicsBody.triangleMapInfo),t.physicsImpostor.dispose(),t.physicsImpostor=null}null!=t.skeleton&&(null!=t.skeleton._sockets&&delete t.skeleton._sockets,null!=t.skeleton.bones&&t.skeleton.bones.length>0&&t.skeleton.bones.forEach(function(e){null!=e&&null!=e.metadata&&(e.metadata=null)})),null!=t.cameraRig&&(t.cameraRig.dispose&&t.cameraRig.dispose(),delete t.cameraRig),null!=t.lightRig&&(t.lightRig.dispose&&t.lightRig.dispose(),delete t.lightRig),null!=t.shadowBox&&(t.shadowBox.dispose&&t.shadowBox.dispose(),delete t.shadowBox),null!=t._debugCollider&&(t._debugCollider.dispose&&t._debugCollider.dispose(),delete t._debugCollider),null!=t._meshCollider&&(t._meshCollider=null),null!=t._colliderType&&delete t._colliderType,null!=t._skinnedMesh&&delete t._skinnedMesh}},t.SearchTransformNodes=function(t,n,r){void 0===r&&(r=e.SearchType.ExactMatch);var o=null,a=null!=r?r:e.SearchType.ExactMatch;if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var l=n[i];if(a===e.SearchType.ExactMatch){if(l.name===t){o=l;break}}else if(a===e.SearchType.StartsWith){if(e.Utilities.StartsWith(l.name,t)){o=l;break}}else if(a===e.SearchType.EndsWith){if(e.Utilities.EndsWith(l.name,t)){o=l;break}}else if(a===e.SearchType.IndexOf){if(l.name.indexOf(t)>=0){o=l;break}}else if(l.name===t){o=l;break}}return o},t.SearchTransformNodeForTags=function(t,n){var r=null;if(null!=n&&n.length>0)for(var o=0;o<n.length;o++){var a=n[o];if(a instanceof e.TransformNode&&e.Tags.MatchesQuery(a,t)){r=a;break}}return r},t.SearchAllTransformNodesForTags=function(t,n){var r=null;if(null!=n&&n.length>0)for(var o=0;o<n.length;o++){var a=n[o];a instanceof e.TransformNode&&e.Tags.MatchesQuery(a,t)&&(null==r&&(r=[]),r.push(a))}return r},t.SearchTransformNodeForScript=function(t,n){var r=null;if(null!=n&&n.length>0)for(var o=0;o<n.length;o++){var a=n[o];if(a instanceof e.TransformNode){var i=e.SceneManager.FindScriptComponent(a,t);if(null!=i){r=a;break}}}return r},t.SearchAllTransformNodesForScript=function(t,n){var r=null;if(null!=n&&n.length>0)for(var o=0;o<n.length;o++){var a=n[o];if(a instanceof e.TransformNode){var i=e.SceneManager.FindScriptComponent(a,t);null!=i&&(null==r&&(r=[]),r.push(a))}}return r},t.CreateGuid=function(t){void 0===t&&(t=null);var n=e.Tools.RandomId();return e.Utilities.IsNullOrEmpty(t)||(n+="-"+t),n},t.ValidateTransformGuid=function(e){if(null!=e&&null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.guid&&""!==e.metadata.unity.guid){var t=e.metadata.unity.guid;e.id!==t&&(e.id=t),delete e.metadata.unity.guid}},t.AddShadowCastersToLight=function(t,n,r){void 0===r&&(r=!1);var o=t.getShadowGenerator();if(null!=o){var a=o.getShadowMap();if(null!=a)for(var i=0;i<n.length;i++){var l=n[i];if(l instanceof e.AbstractMesh&&(null!=t.includedOnlyMeshes&&t.includedOnlyMeshes.length>0&&t.includedOnlyMeshes.indexOf(l)<0&&t.includedOnlyMeshes.push(l),null==a.renderList&&(a.renderList=[]),a.renderList.indexOf(l)<0&&a.renderList.push(l)),r===!0){var s=l.getChildMeshes();null!=s&&s.length>0&&s.forEach(function(e){null!=t.includedOnlyMeshes&&t.includedOnlyMeshes.length>0&&t.includedOnlyMeshes.indexOf(e)<0&&t.includedOnlyMeshes.push(e),null==a.renderList&&(a.renderList=[]),a.renderList.indexOf(e)<0&&a.renderList.push(e)})}}}},t.RegisterInstancedMeshBuffers=function(t){var n=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.buffers?t.metadata.unity.buffers:null;null!=n&&(null!=n.floats&&n.floats.length>0&&n.floats.forEach(function(e){null!=e.kind&&""!==e.kind&&null!=e.value&&(t.registerInstancedBuffer(e.kind,1),t.instancedBuffers[e.kind]=e.value)}),null!=n.colors&&n.colors.length>0&&n.colors.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,4),t.instancedBuffers[n.kind]=new e.Color4(n.value.r||0,n.value.g||0,n.value.b||0,n.value.a||1).toLinearSpace())}),null!=n.vector2&&n.vector2.length>0&&n.vector2.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,2),t.instancedBuffers[n.kind]=new e.Vector2(n.value.x||0,n.value.y||0))}),null!=n.vector3&&n.vector3.length>0&&n.vector3.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,3),t.instancedBuffers[n.kind]=new e.Vector3(n.value.x||0,n.value.y||0,n.value.z||0))}),null!=n.vector4&&n.vector4.length>0&&n.vector4.forEach(function(n){null!=n.kind&&""!==n.kind&&null!=n.value&&(t.registerInstancedBuffer(n.kind,4),t.instancedBuffers[n.kind]=new e.Vector4(n.value.x||0,n.value.y||0,n.value.z||0,n.value.w||0))}))},t.CloneValue=function(t,n){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(n):t.clone?t.clone():t:null},t.CloneEntityMetadata=function(t){var n=null;if(null!=t){var r=null;if(null!=t.unity){var o=null!=t.unity.instance&&t.unity.instance,a=null==t.unity.visible||t.unity.visible,i=null!=t.unity.visibility?t.unity.visibility:1,l=null!=t.unity.billboard?t.unity.billboard:0,s=null!=t.unity.tags?t.unity.tags:"Untagged Layer0",u=null!=t.unity.skin&&t.unity.skin,d=null!=t.unity.bone?t.unity.bone:null,p=null!=t.unity.rootbone&&t.unity.rootbone,c=null!=t.unity.rootpos?t.unity.rootpos:null,m=null!=t.unity.rootrot?t.unity.rootrot:null,h=null!=t.unity.group?t.unity.group:"Untagged",f=null!=t.unity.layer?t.unity.layer:0,g=null!=t.unity.layername?t.unity.layername:"Default",y=null!=t.unity.navigation?t.unity.navigation:null,v=null!=t.unity.lightmapped&&t.unity.lightmapped,_=null!=t.unity.lightmapuvs?t.unity.lightmapuvs:null,b=null!=t.unity.animator?t.unity.animator:null,C=null,S=null,T=null,I=null;t.unity.physics&&(C={},e.Utilities.DeepCopyProperties(t.unity.physics,C)),t.unity.renderer&&(S={},e.Utilities.DeepCopyProperties(t.unity.renderer,S)),t.unity.collision&&(T={},e.Utilities.DeepCopyProperties(t.unity.collision,T)),t.unity.properties&&(I={},e.Utilities.DeepCopyProperties(t.unity.properties,I));var M=null;null!=t.unity.wheels&&t.unity.wheels.length>0&&(M=[],t.unity.wheels.forEach(function(t){if(null!=t){var n={};e.Utilities.DeepCopyProperties(t,n),M.push(n)}}));var x=null;null!=t.unity.components&&t.unity.components.length>0&&(x=[],t.unity.components.forEach(function(t){if(null!=t){var n=e.Utilities.FastJsonCopy(t);n.instance=null,x.push(n)}})),r={},r.parsed=!1,r.prefab=!1,r.buffers=null,r.lods=null,r.coverages=null,r.distances=null,r.handlers=null,r.instance=o,r.visible=a,r.visibility=i,r.billboard=l,r.tags=s,r.skin=u,r.bone=d,r.rootbone=p,r.rootpos=c,r.rootrot=m,r.group=h,r.layer=f,r.layername=g,r.navigation=y,r.lightmapped=v,r.lightmapuvs=_,r.animator=b,r.renderer=S,r.physics=C,r.wheels=M,r.collision=T,r.properties=I,r.components=x}null!=r&&(n={unity:r})}return n},t.FastJsonCopy=function(t){if(!t)return t;if(Array.isArray(t)){for(var n=[],r=t.length,o=0;o<r;o++)n.push(e.Utilities.FastJsonCopy(t[o]));return n}if("object"==typeof t){for(var a=Object.keys(t),i={},o=a.length-1;o>-1;o--){var l=a[o];i[l]=e.Utilities.FastJsonCopy(t[l])}return i}return t},t.DeepCopyProperties=function(t,n,r,o){for(var a in t)if(("_"!==a[0]||o&&o.indexOf(a)!==-1)&&(!r||r.indexOf(a)===-1)){var i=t[a],l=typeof i;if("function"!==l)if("object"===l)if(i instanceof Array){if(n[a]=[],i.length>0)if("object"==typeof i[0])for(var s=0;s<i.length;s++){var u=e.Utilities.CloneValue(i[s],n);n[a].indexOf(u)===-1&&n[a].push(u)}else n[a]=i.slice(0)}else n[a]=e.Utilities.CloneValue(i,n);else n[a]=i}},t.ValidateTransformMetadata=function(t){null==t.metadata&&(t.metadata={}),null==t.metadata.unity&&(t.metadata.unity={});var n=t.metadata.unity;e.Utilities.HasOwnProperty(n,"entity")||(t.metadata.unity.entity=!0),e.Utilities.HasOwnProperty(n,"parsed")||(t.metadata.unity.parsed=!1),e.Utilities.HasOwnProperty(n,"prefab")||(t.metadata.unity.prefab=!1),e.Utilities.HasOwnProperty(n,"instance")||(t.metadata.unity.instance=!1),e.Utilities.HasOwnProperty(n,"buffers")||(t.metadata.unity.buffers=null),e.Utilities.HasOwnProperty(n,"visible")||(t.metadata.unity.visible=!0),e.Utilities.HasOwnProperty(n,"visibility")||(t.metadata.unity.visibility=1),e.Utilities.HasOwnProperty(n,"billboard")||(t.metadata.unity.billboard=0),e.Utilities.HasOwnProperty(n,"tags")||(t.metadata.unity.tags="Untagged Layer0"),e.Utilities.HasOwnProperty(n,"skin")||(t.metadata.unity.skin=!1),e.Utilities.HasOwnProperty(n,"bone")||(t.metadata.unity.bone=null),e.Utilities.HasOwnProperty(n,"rootbone")||(t.metadata.unity.rootbone=!1),e.Utilities.HasOwnProperty(n,"rootpos")||(t.metadata.unity.rootpos=null),e.Utilities.HasOwnProperty(n,"rootrot")||(t.metadata.unity.rootrot=null),e.Utilities.HasOwnProperty(n,"group")||(t.metadata.unity.group="Untagged"),e.Utilities.HasOwnProperty(n,"layer")||(t.metadata.unity.layer=0),e.Utilities.HasOwnProperty(n,"layername")||(t.metadata.unity.layername="Default"),e.Utilities.HasOwnProperty(n,"navigation")||(t.metadata.unity.navigation=null),e.Utilities.HasOwnProperty(n,"lightmapped")||(t.metadata.unity.lightmapped=!1),e.Utilities.HasOwnProperty(n,"lightmapuvs")||(t.metadata.unity.lightmapuvs=!1),e.Utilities.HasOwnProperty(n,"animator")||(t.metadata.unity.animator=null),e.Utilities.HasOwnProperty(n,"lods")||(t.metadata.unity.lods=null),e.Utilities.HasOwnProperty(n,"coverages")||(t.metadata.unity.coverages=null),e.Utilities.HasOwnProperty(n,"distances")||(t.metadata.unity.distances=null),e.Utilities.HasOwnProperty(n,"handlers")||(t.metadata.unity.handlers=null),e.Utilities.HasOwnProperty(n,"physics")||(t.metadata.unity.physics=null),e.Utilities.HasOwnProperty(n,"wheels")||(t.metadata.unity.wheels=null),e.Utilities.HasOwnProperty(n,"renderer")||(t.metadata.unity.renderer=null),e.Utilities.HasOwnProperty(n,"collision")||(t.metadata.unity.collision=null),e.Utilities.HasOwnProperty(n,"properties")||(t.metadata.unity.properties=null),e.Utilities.HasOwnProperty(n,"components")||(t.metadata.unity.components=null)},t.UpVector=e.Vector3.Up(),t.AuxVector=e.Vector3.Zero(),t.ZeroVector=e.Vector3.Zero(),t.TempMatrix=e.Matrix.Zero(),t.TempMatrix2=e.Matrix.Zero(),t.TempVector2=e.Vector2.Zero(),t.TempVector3=e.Vector3.Zero(),t.TempQuaternion=e.Quaternion.Zero(),t.TempQuaternion2=e.Quaternion.Zero(),t.TempQuaternion3=e.Quaternion.Zero(),t.LoadingState=-1,t.OnPreloaderProgress=null,t.OnPreloaderComplete=null,t.LoaderItemsMarkedForDisposal=[],t}();e.Utilities=O}(BABYLON||(BABYLON={}));var UTIL=BABYLON.Utilities;BABYLON.Bone.prototype.linkTransformNode=function(e){e._linkedBone=this,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++};var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BABYLON;!function(e){var t=function(){function e(){this._defines={},this._defines={}}return e.prototype.getDefines=function(){return this._defines},e.prototype.defineBoolean=function(e){this._defines[e]=!0},e.prototype.defineNumeric=function(e,t){this._defines[e]=t},e.ShaderIndexer=0,e}();e.UniversalShaderDefines=t;var n=function(){function e(){}return e}();e.UniversalAlbedoChunks=n;var r=function(t){function n(n,r,o){void 0===o&&(o=!1);var a=t.call(this,n,r)||this;a.universalMaterial=!0,a.locals=null,a.terrainInfo=null,a._defines=null,a._uniforms=[],a._samplers=[],a._attributes=[],a._textures={},a._vectors4={},a._floats={},a._enableTime=!1,a._timeInitialized=!1,a.dumpEffect=!1,a.locals=new e.UniversalShaderDefines,a._defines=null,a._createdShaderName=null,a.enableShaderChunks=!1,a.materialShaderChunks=new e.UniversalAlbedoChunks,a.customShaderNameResolve=a._buildCustomShader,a.customShaderChunkResolve();var i=a;return i.awake&&i.awake(),a}return __extends(n,t),n.prototype.updateShaderChunks=function(){},n.prototype.getShaderName=function(){return"pbr"},n.prototype.getShaderChunk=function(){return null},n.prototype.getShaderDefines=function(){return this._defines},n.prototype.getCustomAttributes=function(){return null},Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this._timeInitialized===!1?(this._timeInitialized=!0,this.setFloat("gameTime",e.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",e.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},n.prototype.getTexture=function(e){return this._textures[e]},n.prototype.getVector4=function(e){return this._vectors4[e]},n.prototype.getFloat=function(e){return this._floats[e]},n.prototype.setTexture=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkSampler(e),this._textures[e]=t,this},n.prototype.setVector4=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkUniform(e),this._vectors4[e]=t,this},n.prototype.setFloat=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkUniform(e),this._floats[e]=t,this},n.prototype.addAttribute=function(e){this._attributes.indexOf(e)===-1&&this._attributes.push(e)},n.prototype.checkUniform=function(e){this._uniforms.indexOf(e)===-1&&(this._uniforms.push(e),this.locals.defineBoolean(e.toUpperCase()))},n.prototype.checkSampler=function(e){this._samplers.indexOf(e)===-1&&(this._samplers.push(e),this.locals.defineBoolean(e.toUpperCase()),this.checkUniform(e+"Infos"),this.checkUniform(e+"Matrix"))},n.prototype.getAnimatables=function(){var e=t.prototype.getAnimatables.call(this);for(var n in this._textures){var r=this._textures[n];r&&r.animations&&r.animations.length>0&&e.push(r)}return e},n.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);for(var n in this._textures){var r=this._textures[n];r&&e.push(r)}return e},n.prototype.hasTexture=function(e){if(t.prototype.hasTexture.call(this,e))return!0;var n=!1;for(var r in this._textures){var o=this._textures[r];if(o===o){n=!0;break}}return n},n.prototype.dispose=function(e,n){if(n)for(var r in this._textures){var o=this._textures[r];o&&o.dispose(),this._textures[r]=null}this._textures={},t.prototype.dispose.call(this,e,n)},n.prototype.clone=function(t){var n,r=this,o=e.SerializationHelper.Clone(function(){return new e.UniversalAlbedoMaterial(t,r.getScene())},this);o._textures={};for(n in this._textures){var a=this._textures[n];a&&o.setTexture(n,a.clone(),!0)}o._vectors4={};for(n in this._vectors4)o.setVector4(n,this._vectors4[n].clone(),!0);
o._floats={};for(n in this._floats)o.setFloat(n,this._floats[n],!0);return o},n.prototype.serialize=function(){var t,n=e.SerializationHelper.Serialize(this);n.customType="BABYLON.UniversalAlbedoMaterial",n.textures={};for(t in this._textures){var r=this._textures[t];r&&(n.textures[t]=r.serialize())}n.vectors4={};for(t in this._vectors4)n.vectors4[t]=this._vectors4[t].asArray();n.floats={};for(t in this._floats)n.floats[t]=this._floats[t];return n},n.Parse=function(t,n,r){var o,a=e.SerializationHelper.Parse(function(){return new e.UniversalAlbedoMaterial(t.name,n)},t,n,r);for(o in t.textures){var i=t.textures[o];i&&a.setTexture(o,e.Texture.Parse(i,n,r),!0)}for(o in t.vectors4)a.setVector4(o,e.Vector4.FromArray(t.vectors4[o]),!0);for(o in t.floats)a.setFloat(o,t.floats[o],!0);return a},n.prototype.customShaderChunkResolve=function(){var t=this.getShaderChunk();if(null!=t&&""!==t){var n=t+"ShaderChunks";if(null!=e.Effect.ShadersStore[n]){var r=e.Effect.ShadersStore[n],o=e.Utilities.HasOwnProperty(r,"VertexBegin")?r.VertexBegin:null;null!=o&&""!==o&&(this.materialShaderChunks.Vertex_Begin=o);var a=e.Utilities.HasOwnProperty(r,"VertexDefinitions")?r.VertexDefinitions:null;null!=a&&""!==a&&(this.materialShaderChunks.Vertex_Definitions=a);var i=e.Utilities.HasOwnProperty(r,"VertexMainBegin")?r.VertexMainBegin:null;null!=i&&""!==i&&(this.materialShaderChunks.Vertex_MainBegin=i);var l=e.Utilities.HasOwnProperty(r,"VertexUpdatePosition")?r.VertexUpdatePosition:null;null!=l&&""!==l&&(this.materialShaderChunks.Vertex_Before_PositionUpdated=l.replace("result","positionUpdated"));var s=e.Utilities.HasOwnProperty(r,"VertexUpdateNormal")?r.VertexUpdateNormal:null;null!=s&&""!==s&&(this.materialShaderChunks.Vertex_Before_NormalUpdated=s.replace("result","normalUpdated"));var u=e.Utilities.HasOwnProperty(r,"VertexWorldPos")?r.VertexWorldPos:null;null!=u&&""!==u&&(this.materialShaderChunks.Vertex_After_WorldPosComputed=u);var d=e.Utilities.HasOwnProperty(r,"VertexMainEnd")?r.VertexMainEnd:null;null!=d&&""!==d&&(this.materialShaderChunks.Vertex_MainEnd=d);var p=e.Utilities.HasOwnProperty(r,"FragmentBegin")?r.FragmentBegin:null;null!=p&&""!==p&&(this.materialShaderChunks.Fragment_Begin=p);var c=e.Utilities.HasOwnProperty(r,"FragmentDefinitions")?r.FragmentDefinitions:null;null!=c&&""!==c&&(this.materialShaderChunks.Fragment_Definitions=c);var m=e.Utilities.HasOwnProperty(r,"FragmentMainBegin")?r.FragmentMainBegin:null;null!=m&&""!==m&&(this.materialShaderChunks.Fragment_MainBegin=m);var h=e.Utilities.HasOwnProperty(r,"FragmentUpdateAlbedo")?r.FragmentUpdateAlbedo:null;null!=h&&""!==h&&(this.materialShaderChunks.Fragment_Custom_Albedo=h.replace("result","surfaceAlbedo"));var f=e.Utilities.HasOwnProperty(r,"FragmentUpdateAlpha")?r.FragmentUpdateAlpha:null;null!=f&&""!==f&&(this.materialShaderChunks.Fragment_Custom_Alpha=f.replace("result","alpha"));var g=e.Utilities.HasOwnProperty(r,"FragmentMetallicRoughness")?r.FragmentMetallicRoughness:null;null!=g&&""!==g&&(this.materialShaderChunks.Fragment_MetallicRoughness=g);var y=e.Utilities.HasOwnProperty(r,"FragmentMicroSurface")?r.FragmentMicroSurface:null;null!=y&&""!==y&&(this.materialShaderChunks.Fragment_MicroSurface=y);var v=e.Utilities.HasOwnProperty(r,"FragmentBeforeLights")?r.FragmentBeforeLights:null;null!=v&&""!==v&&(this.materialShaderChunks.Fragment_Before_Lights=v);var _=e.Utilities.HasOwnProperty(r,"FragmentBeforeFog")?r.FragmentBeforeFog:null;null!=_&&""!==_&&(this.materialShaderChunks.Fragment_Before_Fog=_);var b=e.Utilities.HasOwnProperty(r,"FragmentBeforeFragColor")?r.FragmentBeforeFragColor:null;null!=b&&""!==b&&(this.materialShaderChunks.Fragment_Before_FragColor=b.replace("result","color"))}else e.Tools.Warn("Failed To Locate Shader Chunk Base: "+n)}},n.prototype._buildCustomShader=function(t,n,r,o,a,i,l){var s=this;null==l||null!=l.processFinalCode&&void 0!=l.processFinalCode||(l.processFinalCode=function(t,n){if("vertex"===t)return n;var r=new e.ShaderCodeInliner(n);return r.inlineToken="#define pbr_inline",r.processCode(),r.code}),this._defines=a;var u=this.locals.getDefines();if(null!=u&&null!=this._defines){var d=Object.keys(u);if(null!=d&&d.length>0){for(var p=this._defines,c=0,m=d;c<m.length;c++){var h=m[c];p[h]=u[h]}this._defines.rebuild()}}var f=0;if(null!=this._uniforms&&this._uniforms.length>0)for(f=0;f<this._uniforms.length;f++){var g=this._uniforms[f];n.indexOf(g)===-1&&n.push(g)}if(f=0,null!=this._samplers&&this._samplers.length>0)for(f=0;f<this._samplers.length;f++){var y=this._samplers[f];o.indexOf(y)===-1&&o.push(y)}if(f=0,null!=this._attributes&&this._attributes.length>0)for(f=0;f<this._attributes.length;f++){var v=this._attributes[f];i.indexOf(v)===-1&&i.push(v)}f=0;var _=this.getCustomAttributes();if(null!=_&&_.length>0)for(f=0;f<_.length;f++){var b=_[f];i.indexOf(b)===-1&&i.push(b)}if(null!=this._createdShaderName&&""!==this._createdShaderName)return this._createdShaderName;var C=this.getShaderName();null!=C&&""!==C||(C=t),null!=C&&""!==C||(C="pbr");var S=this._afterBind.bind(this);return this._afterBind=function(e,t){if(t){s._attachAfterBind(e,t);try{S(e,t)}catch(t){}}},this._createdShaderName=this.enableShaderChunks===!0?this._createShaderChunks(C):C,this._createdShaderName},n.prototype._createShaderChunks=function(t){var n=this.getShaderChunk();null!=n&&""!==n||(n=t),e.UniversalShaderDefines.ShaderIndexer++;var r=(n+"Custom"+e.UniversalShaderDefines.ShaderIndexer).trim(),o=e.Effect.ShadersStore[t+"VertexShader"],a=e.Effect.ShadersStore[t+"PixelShader"];a=a.replace(/#include<pbrBlockAlbedoOpacity>/g,e.Effect.IncludesShadersStore.pbrBlockAlbedoOpacity),a=a.replace(/#include<pbrBlockReflectivity>/g,e.Effect.IncludesShadersStore.pbrBlockReflectivity),a=a.replace(/#include<pbrBlockFinalColorComposition>/g,e.Effect.IncludesShadersStore.pbrBlockFinalColorComposition),this.updateShaderChunks();var i=r+"VertexShader";e.Effect.ShadersStore[i]=o.replace("#define CUSTOM_VERTEX_BEGIN",this.materialShaderChunks.Vertex_Begin?this.materialShaderChunks.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions:"").replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.materialShaderChunks.Vertex_MainBegin?this.materialShaderChunks.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.materialShaderChunks.Vertex_Before_PositionUpdated?this.materialShaderChunks.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.materialShaderChunks.Vertex_Before_NormalUpdated?this.materialShaderChunks.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd:""),this.materialShaderChunks.Vertex_After_WorldPosComputed&&(e.Effect.ShadersStore[i]=e.Effect.ShadersStore[i].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS",this.materialShaderChunks.Vertex_After_WorldPosComputed));var l=r+"PixelShader";return e.Effect.ShadersStore[l]=a.replace("#define CUSTOM_FRAGMENT_BEGIN",this.materialShaderChunks.Fragment_Begin?this.materialShaderChunks.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.materialShaderChunks.Fragment_MainBegin?this.materialShaderChunks.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.materialShaderChunks.Fragment_Custom_Albedo?this.materialShaderChunks.Fragment_Custom_Albedo:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.materialShaderChunks.Fragment_Custom_Alpha?this.materialShaderChunks.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.materialShaderChunks.Fragment_MetallicRoughness?this.materialShaderChunks.Fragment_MetallicRoughness:"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.materialShaderChunks.Fragment_MicroSurface?this.materialShaderChunks.Fragment_MicroSurface:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.materialShaderChunks.Fragment_Before_Lights?this.materialShaderChunks.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog?this.materialShaderChunks.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.materialShaderChunks.Fragment_Before_FragColor?this.materialShaderChunks.Fragment_Before_FragColor:""),this.materialShaderChunks.Fragment_Before_Fog&&(e.Effect.ShadersStore[l]=e.Effect.ShadersStore[l].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog)),r},n.prototype._attachAfterBind=function(e,t){this.updateGlobalTime();var n=this;n.after&&n.after();var r,o=this.getScene();if(o.texturesEnabled)for(r in this._textures){var a=this._textures[r];null!=a&&a.isReady&&a.isReady()&&(null==a.isChecked&&(a.isChecked=!0,("detailsSampler"===r||"normalsSampler"===r||r.indexOf("(Atlas)")>=0)&&a.updateSamplingMode(8)),t.setTexture(r,a),t.setFloat2(r+"Infos",a.coordinatesIndex,a.level),t.setMatrix(r+"Matrix",a.getTextureMatrix()))}for(r in this._vectors4)t.setVector4(r,this._vectors4[r]);for(r in this._floats)t.setFloat(r,this._floats[r])},n}(e.PBRMaterial);e.UniversalAlbedoMaterial=r,e.RegisterClass("BABYLON.UniversalAlbedoMaterial",r);var o=function(t){function n(e,n,r){var o=t.call(this,e,n,null,r)||this;return o._enableTime=!1,o}return __extends(n,t),Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this.setFloat("gameTime",e.SceneManager.GetGameTime()),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene())))},n}(e.ShaderMaterial);e.UniversalShaderMaterial=o,e.RegisterClass("BABYLON.UniversalShaderMaterial",o);var a=function(t){function n(e,n,r){var o=t.call(this,e,n,r)||this;o._textures={},o._vectors4={},o._floats={},o._enableTime=!1,o._timeInitialized=!1;var a=o;return a.awake&&a.awake(),o.onBindObservable.add(function(){o.updateGlobalTime(),a.after&&a.after()}),o}return __extends(n,t),n.prototype.compile=function(){},Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this._timeInitialized===!1?(this._timeInitialized=!0,this.setFloat("gameTime",e.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",e.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},n.prototype.getTexture=function(e){return this._textures[e]},n.prototype.getVector4=function(e){return this._vectors4[e]},n.prototype.getFloat=function(e){return this._floats[e]},n.prototype.setTexture=function(e,t,n){return void 0===n&&(n=!1),this._textures[e]=t,this},n.prototype.setVector4=function(e,t,n){return void 0===n&&(n=!1),this._vectors4[e]=t,this},n.prototype.setFloat=function(e,t,n){return void 0===n&&(n=!1),this._floats[e]=t,this},n.prototype.dispose=function(e,n){if(n)for(var r in this._textures){var o=this._textures[r];o&&o.dispose(),this._textures[r]=null}this._textures={},t.prototype.dispose.call(this,e,n)},n.prototype.clone=function(t){var n,r=this,o=e.SerializationHelper.Clone(function(){return new e.UniversalNodeMaterial(t,r.getScene())},this);o._textures={};for(n in this._textures){var a=this._textures[n];a&&o.setTexture(n,a.clone(),!0)}o._vectors4={};for(n in this._vectors4)o.setVector4(n,this._vectors4[n].clone(),!0);o._floats={};for(n in this._floats)o.setFloat(n,this._floats[n],!0);return o},n.prototype.serialize=function(){var t,n=e.SerializationHelper.Serialize(this);n.customType="BABYLON.UniversalNodeMaterial",n.textures={};for(t in this._textures){var r=this._textures[t];r&&(n.textures[t]=r.serialize())}n.vectors4={};for(t in this._vectors4)n.vectors4[t]=this._vectors4[t].asArray();n.floats={};for(t in this._floats)n.floats[t]=this._floats[t];return n},n.Parse=function(t,n,r){var o,a=e.SerializationHelper.Parse(function(){return new e.UniversalNodeMaterial(t.name,n)},t,n,r);for(o in t.textures){var i=t.textures[o];i&&a.setTexture(o,e.Texture.Parse(i,n,r),!0)}for(o in t.vectors4)a.setVector4(o,e.Vector4.FromArray(t.vectors4[o]),!0);for(o in t.floats)a.setFloat(o,t.floats[o],!0);return a},n}(e.NodeMaterial);e.UniversalNodeMaterial=a,e.RegisterClass("BABYLON.UniversalNodeMaterial",a);var i=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.enableShaderChunks=!0;var o=r;return o.awake&&o.awake(),r.onBindObservable.add(function(){o.after&&o.after()}),r}return __extends(n,t),n.prototype.getShaderName=function(){return"pbr"},n.prototype.getShaderChunk=function(){return null},n.prototype.updateShaderChunks=function(){var t="surfaceAlbedo",n="splatmapSampler",r="detailsSampler",o="normalsSampler",a=e.SceneManager.TerrainColorCorrection;null!=this.materialShaderChunks.Vertex_Definitions&&""!==this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions()+this.materialShaderChunks.Vertex_Definitions:this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions(),null!=this.materialShaderChunks.Vertex_MainEnd&&""!==this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd()+this.materialShaderChunks.Vertex_MainEnd:this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd(),null!=this.materialShaderChunks.Fragment_Definitions&&""!==this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(n,r,o)+this.materialShaderChunks.Fragment_Definitions:this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(n,r,o),null!=this.materialShaderChunks.Fragment_Custom_Albedo&&""!==this.materialShaderChunks.Fragment_Custom_Albedo?this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,t,n,r,o,a)+this.materialShaderChunks.Fragment_Custom_Albedo:this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,t,n,r,o,a)},n.prototype.formatTerrainVertexDefintions=function(){return"\r\n#define TERRAIN_VERTEX_DEFINITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\n\r\n"},n.prototype.formatTerrainVertexMainEnd=function(){return"\r\n#define TERRAIN_VERTEX_MAIN_END\r\n\r\n#ifdef UV1\r\nvSplatmapUV = uv;\r\n#endif\r\n\r\n"},n.prototype.formatTerrainFragmentDefintions=function(e,t,n){return"\r\n#define TERRAIN_FRAGMENT_DEFNITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\nuniform sampler2D "+e+";\r\nuniform sampler2D "+t+";\r\nuniform sampler2D "+n+";\r\n\r\nfloat calculateMipmapLevel(const in vec2 uvs, const in vec2 size)\r\n{\r\n    vec2 dx = dFdx(uvs * size.x);\r\n    vec2 dy = dFdy(uvs * size.y);\r\n    float d = max(dot(dx, dx), dot(dy, dy));\r\n    return 0.4 * log2(d);\r\n}\r\n\r\nvec4 sampleTextureAtlas2D(const in sampler2D atlas, const in float gamma, const in vec2 tile, const in vec4 rect, in vec2 uvs, in float lod)\r\n{\r\n    if (lod < 0.0) lod = clamp(calculateMipmapLevel(uvs, vec2(tile.x, tile.x)), 0.0, tile.y);   // Tile Info (tile.xy)\r\n    float size = pow(2.0, tile.y - lod);                                                        // Tile Bits (tile.y)\r\n    float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n    float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n    uvs = fract(uvs);                                                                           // Perfrom Tiling (fract)\r\n    uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n    uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    vec4 color = texture2DLodEXT(atlas, uvs, lod);\r\n    if (gamma != 1.0) {\r\n        color.r = pow(color.r, gamma);\r\n        color.g = pow(color.g, gamma);\r\n        color.b = pow(color.b, gamma);\r\n    }\r\n    return color;\r\n}\r\n\r\nvec4 sampleSplatmapAtlas2D(const in sampler2D atlas, const in vec2 tile, const in vec4 rect, in vec2 uvs)\r\n{\r\n    float size = pow(2.0, tile.y);                                                              // Tile Bits (tile.y)\r\n\t   float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n\t   float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n\t   uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n\t   uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    return texture2D(atlas, uvs);\r\n}\r\n\r\nvec3 blendSplatmapAtlasColors(const in vec4 splatmap, in vec4 color1, in vec4 color2, in vec4 color3, in vec4 color4, in vec3 mixbuffer)\r\n{\r\n    vec3 buffer1 = mix(mixbuffer, color1.rgb, splatmap.r);\r\n    vec3 buffer2 = mix(buffer1, color2.rgb, splatmap.g);\r\n    vec3 buffer3 = mix(buffer2, color3.rgb, splatmap.b);\r\n    return mix(buffer3, color4.rgb, splatmap.a);\r\n}\r\n\r\nvec3 perturbNormalSamplerColor(mat3 cotangentFrame, vec3 samplerColor, float scale)\r\n{\r\n    vec3 map = samplerColor.xyz;\r\n    map = map * 2.00787402 - 1.00787402;\r\n    #ifdef NORMALXYSCALE\r\n        map = normalize(map * vec3(scale, scale, 1.0));\r\n    #endif\r\n    return normalize(cotangentFrame * map);\r\n}\r\n\r\n\r\n"},n.prototype.formatTerrainFragmentUpdateColor=function(e,t,n,r,o,a){void 0===a&&(a=1);var i="";if(null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0){i="\r\n#define TERRAIN_FRAGMENT_UPDATE_COLOR\r\n\r\nvec3 normalsColor = vec3(0.5, 0.5, 1.0);\r\nvec3 normalsBuffer = normalW.rgb;\r\nvec3 splatmapBuffer = "+t+".rgb;\r\nfloat autoMipMapLevel = -1.0;\r\nfloat normalCorrection = 1.0;\r\nfloat detailCorrection = "+a.toFixed(4)+";\r\n\r\n#if defined(ALBEDO) && defined("+n.toUpperCase()+") && defined("+r.toUpperCase()+")\r\n\r\n// Reset Normal Values\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    uvOffset = vec2(0.0, 0.0);\r\n    #ifdef NORMAL\r\n        normalW = normalize(vNormalW);\r\n    #else\r\n        normalW = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n    #endif\r\n    #ifdef CLEARCOAT\r\n        clearCoatNormalW = normalW;\r\n    #endif\r\n    #if defined(BUMP) || defined(PARALLAX)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV);\r\n        #endif\r\n    #elif defined(ANISOTROPIC)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV, vec2(1.0, 1.0));\r\n        #endif\r\n    #endif\r\n    #ifdef PARALLAX\r\n        invTBN = transposeMat3(TBN);\r\n    #endif\r\n    normalW = perturbNormalSamplerColor(TBN, normalsColor, 1.0);\r\n#endif\r\n\r\n// Global Atlas Values\r\nfloat splatTileSize = "+e.splatmapAtlas[2].toFixed(4)+";\r\nfloat splatTileBits = "+e.splatmapAtlas[3].toFixed(4)+";\r\nfloat detailTileSize = "+e.textureAtlas[2].toFixed(4)+";\r\nfloat detailTileBits = "+e.textureAtlas[3].toFixed(4)+";\r\n\r\n// Sample splatmap textures\r\n";for(var l=0,s=0;s<e.splatmapCount;s++){l=4*s;var u=e["splatmapRect"+s];if(i+="vec4 splatmapRect"+s+" = vec4("+u[0].toFixed(4)+", "+u[1].toFixed(4)+", "+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n",i+="vec4 splatmapAlbedo"+s+" = sampleSplatmapAtlas2D("+n+", vec2(splatTileSize, splatTileBits), splatmapRect"+s+", (vSplatmapUV + uvOffset));\r\n",i+="vec4 textureAlbedo"+(l+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",i+="vec4 textureAlbedo"+(l+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",i+="vec4 textureAlbedo"+(l+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",i+="vec4 textureAlbedo"+(l+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(l+0)]){var d=e["textureRect"+(l+0)],p=e["textureInfo"+(l+0)];i+="vec4 textureRect"+(l+0)+" = vec4("+d[0].toFixed(4)+", "+d[1].toFixed(4)+", "+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",i+="vec2 textureScale"+(l+0)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",i+="vec2 textureOffset"+(l+0)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",i+="vec2 textureTileUV"+(l+0)+" = ((vSplatmapUV + textureOffset"+(l+0)+") * textureScale"+(l+0)+");\r\n",i+="textureAlbedo"+(l+0)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+0)+", textureTileUV"+(l+0)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(l+1)]){var d=e["textureRect"+(l+1)],p=e["textureInfo"+(l+1)];i+="vec4 textureRect"+(l+1)+" = vec4("+d[0].toFixed(4)+", "+d[1].toFixed(4)+", "+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",i+="vec2 textureScale"+(l+1)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",i+="vec2 textureOffset"+(l+1)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",i+="vec2 textureTileUV"+(l+1)+" = ((vSplatmapUV + textureOffset"+(l+1)+") * textureScale"+(l+1)+");\r\n",i+="textureAlbedo"+(l+1)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+1)+", textureTileUV"+(l+1)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(l+2)]){var d=e["textureRect"+(l+2)],p=e["textureInfo"+(l+2)];i+="vec4 textureRect"+(l+2)+" = vec4("+d[0].toFixed(4)+", "+d[1].toFixed(4)+", "+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",i+="vec2 textureScale"+(l+2)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",i+="vec2 textureOffset"+(l+2)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",i+="vec2 textureTileUV"+(l+2)+" = ((vSplatmapUV + textureOffset"+(l+2)+") * textureScale"+(l+2)+");\r\n",i+="textureAlbedo"+(l+2)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+2)+", textureTileUV"+(l+2)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(l+3)]){var d=e["textureRect"+(l+3)],p=e["textureInfo"+(l+3)];i+="vec4 textureRect"+(l+3)+" = vec4("+d[0].toFixed(4)+", "+d[1].toFixed(4)+", "+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",i+="vec2 textureScale"+(l+3)+" = vec2("+p[0].toFixed(4)+", "+p[1].toFixed(4)+");\r\n",i+="vec2 textureOffset"+(l+3)+" = vec2("+p[2].toFixed(4)+", "+p[3].toFixed(4)+");\r\n",i+="vec2 textureTileUV"+(l+3)+" = ((vSplatmapUV + textureOffset"+(l+3)+") * textureScale"+(l+3)+");\r\n",i+="textureAlbedo"+(l+3)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+3)+", textureTileUV"+(l+3)+", autoMipMapLevel);\r\n"}if(i+="splatmapBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", textureAlbedo"+(l+0)+", textureAlbedo"+(l+1)+", textureAlbedo"+(l+2)+", textureAlbedo"+(l+3)+", splatmapBuffer);\r\n",i+="#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n",i+="    #if defined("+o.toUpperCase()+")\r\n",i+="        vec4 normalColor"+(l+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",i+="        vec4 normalColor"+(l+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",i+="        vec4 normalColor"+(l+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",i+="        vec4 normalColor"+(l+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(l+0)]){var c=e["normalsScale"+(l+0)];i+="        float normalScale"+(l+0)+" = "+c.toFixed(4)+";\r\n",i+="        normalColor"+(l+0)+" = sampleTextureAtlas2D("+o+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+0)+", textureTileUV"+(l+0)+", autoMipMapLevel);\r\n",i+="        normalColor"+(l+0)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+0)+".rgb, normalScale"+(l+0)+");\r\n"}if(e["textureRect"+(l+1)]){var c=e["normalsScale"+(l+1)];i+="        float normalScale"+(l+1)+" = "+c.toFixed(4)+";\r\n",i+="        normalColor"+(l+1)+" = sampleTextureAtlas2D("+o+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+1)+", textureTileUV"+(l+1)+", autoMipMapLevel);\r\n",i+="        normalColor"+(l+1)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+1)+".rgb, normalScale"+(l+1)+");\r\n"}if(e["textureRect"+(l+2)]){var c=e["normalsScale"+(l+2)];i+="        float normalScale"+(l+2)+" = "+c.toFixed(4)+";\r\n",i+="        normalColor"+(l+2)+" = sampleTextureAtlas2D("+o+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+2)+", textureTileUV"+(l+2)+", autoMipMapLevel);\r\n",i+="        normalColor"+(l+2)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+2)+".rgb, normalScale"+(l+2)+");\r\n"}if(e["textureRect"+(l+3)]){var c=e["normalsScale"+(l+3)];i+="        float normalScale"+(l+3)+" = "+c.toFixed(4)+";\r\n",i+="        normalColor"+(l+3)+" = sampleTextureAtlas2D("+o+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+3)+", textureTileUV"+(l+3)+", autoMipMapLevel);\r\n",i+="        normalColor"+(l+3)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+3)+".rgb, normalScale"+(l+3)+");\r\n"}i+="        normalsBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", normalColor"+(l+0)+", normalColor"+(l+1)+", normalColor"+(l+2)+", normalColor"+(l+3)+", normalsBuffer);\r\n",i+="    #endif\r\n",i+="#endif\r\n",i+="\r\n"}i+="// Update Color Values\r\n"+t+".rgb = splatmapBuffer.rgb;\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    #if defined("+o.toUpperCase()+")\r\n        normalW.rgb = normalsBuffer.rgb;\r\n    #endif\r\n    #if defined(FORCENORMALFORWARD) && defined(NORMAL)\r\n        vec3 faceNormal = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n        #if defined(TWOSIDEDLIGHTING)\r\n            faceNormal = gl_FrontFacing ? faceNormal : -faceNormal;\r\n        #endif\r\n        normalW *= sign(dot(normalW, faceNormal));\r\n    #endif\r\n    #if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\r\n        normalW = gl_FrontFacing ? normalW : -normalW;\r\n    #endif\r\n#endif\r\n\r\n#endif\r\n\r\n"}return i},n}(e.UniversalAlbedoMaterial);e.UniversalTerrainMaterial=i,e.RegisterClass("BABYLON.UniversalTerrainMaterial",i)}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,n,r){if(void 0===r&&(r={}),this._update=null,this._late=null,this._step=null,this._fixed=null,this._after=null,this._ready=null,this._lateUpdate=!1,this._properties=null,this._awoken=!1,this._started=!1,this._scene=null,this._delyed=!1,this._transform=null,this._scriptReady=!1,this._registeredClassname=null,this._lateUpdateObserver=null,this.resetScriptComponent=null,this._worldCollisionObserver=null,this._worldCollisionEndedObserver=null,this._worldTriggerEventObserver=null,this.onCollisionEnterObservable=new e.Observable,this.onCollisionStayObservable=new e.Observable,this.onCollisionExitObservable=new e.Observable,this.onTriggerEnterObservable=new e.Observable,this.onTriggerExitObservable=new e.Observable,null==t)throw new Error("Null transform object specified.");if(null==n)throw new Error("Null host scene object specified.");this._scene=n,this._transform=t,this._properties=r||{},this._registeredClassname=null;var o=this;o._update=function(){e.ScriptComponent.UpdateInstance(o)},o._late=function(){e.ScriptComponent.LateInstance(o)},o._step=function(){e.ScriptComponent.StepInstance(o)},o._fixed=function(){e.ScriptComponent.FixedInstance(o)},o._after=function(){e.ScriptComponent.AfterInstance(o)},o._ready=function(){e.ScriptComponent.ReadyInstance(o)},o.resetScriptComponent=function(){e.ScriptComponent.ResetInstance(o)},o.registerComponentInstance&&o.destroyComponentInstance||e.Tools.Warn("Invalid component registration handlers for: "+this._transform.name)}return t.prototype.isReady=function(){return this._scriptReady},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return this._registeredClassname},t.prototype.setProperty=function(e,t){null==this._properties&&(this._properties={}),this._properties[e]=t},t.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=this._properties&&(n=this._properties[e],null==n&&(n=this._properties["auto__"+e])),null==n&&(n=t),null!=n?n:null},t.prototype.getTime=function(){return e.SceneManager.GetTime()},t.prototype.getTimeMs=function(){return e.SceneManager.GetTimeMs()},t.prototype.getGameTime=function(){return e.SceneManager.GetGameTime()},t.prototype.getGameTimeMs=function(){return e.SceneManager.GetGameTimeMs()},t.prototype.getDeltaSeconds=function(){return e.SceneManager.GetDeltaSeconds(this.scene)},t.prototype.getDeltaMilliseconds=function(){return e.SceneManager.GetDeltaMilliseconds(this.scene)},t.prototype.getAnimationRatio=function(){return e.SceneManager.GetAnimationRatio(this.scene)},t.prototype.hasSkinnedMesh=function(){return null!=this.getSkinnedMesh()},t.prototype.getSkinnedMesh=function(){return e.SceneManager.GetSkinnedMesh(this.transform)},t.prototype.getTransformMesh=function(){return this._transform instanceof e.Mesh?this._transform:null},t.prototype.getAbstractMesh=function(){return this._transform instanceof e.AbstractMesh?this._transform:null},t.prototype.getInstancedMesh=function(){return this._transform instanceof e.InstancedMesh?this._transform:null},t.prototype.getPrimitiveMeshes=function(){return e.SceneManager.GetPrimitiveMeshes(this.transform)},t.prototype.getMetadata=function(){return e.SceneManager.FindSceneMetadata(this._transform)},t.prototype.getComponent=function(t){var n=e.SceneManager.FindScriptComponent(this._transform,t);return null!=n?n:null},t.prototype.getComponents=function(t){var n=e.SceneManager.FindAllScriptComponents(this._transform,t);return null!=n?n:null},t.prototype.getLightRig=function(){return e.SceneManager.FindSceneLightRig(this._transform)},t.prototype.getCameraRig=function(){return e.SceneManager.FindSceneCameraRig(this._transform)},t.prototype.getTransformTag=function(){return e.SceneManager.GetTransformTag(this.transform)},t.prototype.hasTransformTags=function(t){return e.SceneManager.HasTransformTags(this._transform,t)},t.prototype.getChildNode=function(t,n,r,o){return void 0===n&&(n=e.SearchType.ExactMatch),void 0===r&&(r=!0),void 0===o&&(o=null),e.SceneManager.FindChildTransformNode(this._transform,t,n,r,o)},t.prototype.getChildWithTags=function(t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=null),e.SceneManager.FindChildTransformWithTags(this._transform,t,n,r)},t.prototype.getChildrenWithTags=function(t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=null),e.SceneManager.FindAllChildTransformsWithTags(this._transform,t,n,r)},t.prototype.getChildWithScript=function(t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=null),e.SceneManager.FindChildTransformWithScript(this._transform,t,n,r)},t.prototype.getChildrenWithScript=function(t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=null),e.SceneManager.FindAllChildTransformsWithScript(this._transform,t,n,r)},t.prototype.enableCollisionEvents=function(){var e=this,t=window.havokPlugin;null!=t&&null!=this.transform.physicsBody&&(this.transform.physicsBody.setCollisionCallbackEnabled(!0),this.transform.physicsBody.setCollisionEndedCallbackEnabled(!0),null==this._worldCollisionObserver&&(this._worldCollisionObserver=t.onCollisionObservable.add(function(t){if(t.collider===e.transform.physicsBody||t.collidedAgainst===e.transform.physicsBody){var n=t.collider===e.transform.physicsBody?t.collidedAgainst:t.collider;
"COLLISION_STARTED"===t.type?e.onCollisionEnterObservable.notifyObservers(n.transformNode):"COLLISION_CONTINUED"===t.type&&e.onCollisionStayObservable.notifyObservers(n.transformNode)}})),null==this._worldCollisionEndedObserver&&(this._worldCollisionEndedObserver=t.onCollisionEndedObservable.add(function(t){if(t.collider===e.transform.physicsBody||t.collidedAgainst===e.transform.physicsBody){var n=t.collider===e.transform.physicsBody?t.collidedAgainst:t.collider;"COLLISION_FINISHED"===t.type&&e.onCollisionExitObservable.notifyObservers(n.transformNode)}})),null==this._worldTriggerEventObserver&&(this._worldTriggerEventObserver=t.onTriggerCollisionObservable.add(function(t){if(t.collider===e.transform.physicsBody||t.collidedAgainst===e.transform.physicsBody){var n=t.collider===e.transform.physicsBody?t.collidedAgainst:t.collider;"TRIGGER_ENTERED"===t.type?e.onTriggerEnterObservable.notifyObservers(n.transformNode):"TRIGGER_EXITED"===t.type&&e.onTriggerExitObservable.notifyObservers(n.transformNode)}})))},t.prototype.disableCollisionEvents=function(){var e=window.havokPlugin;null!=e&&null!=this.transform.physicsBody&&(this.transform.physicsBody.setCollisionCallbackEnabled(!1),this.transform.physicsBody.setCollisionEndedCallbackEnabled(!1))},t.prototype.setTransformPosition=function(e){this.transform.physicsBody&&(this.transform.physicsBody.disablePreStep=!1),null!=this.transform.position&&this.transform.position.copyFrom(e)},t.prototype.setTransformRotation=function(e){this.transform.physicsBody&&(this.transform.physicsBody.disablePreStep=!1),null!=this.transform.rotationQuaternion&&this.transform.rotationQuaternion.copyFrom(e)},t.prototype.registerOnClickAction=function(t){var n=null;return this.transform instanceof e.AbstractMesh&&(n=e.SceneManager.RegisterClickAction(this.scene,this.transform,t)),n},t.prototype.unregisterOnClickAction=function(t){var n=!1;return this.transform instanceof e.AbstractMesh&&(n=e.SceneManager.UnregisterClickAction(this.transform,t)),n},t.prototype.registerComponentInstance=function(t,n,r){if(void 0===r&&(r=!0),r===!0){e.Utilities.ValidateTransformMetadata(this._transform);var o={alias:"script",order:0,klass:n,properties:null,instance:t};null==this._transform.metadata.unity.components&&(this._transform.metadata.unity.components=[]),this._transform.metadata.unity.components.push(o)}t._registeredClassname=n,e.ScriptComponent.RegisterInstance(t),r===!0&&t.scene.onAfterRenderObservable.addOnce(function(){t.delayComponentInstance(t)})},t.prototype.delayComponentInstance=function(t){e.SceneManager.SetTimeout(100,function(){t._delyed=!0})},t.prototype.destroyComponentInstance=function(t){e.ScriptComponent.DestroyInstance(t)},t.prototype.setupStepComponentInstance=function(e){e.scene.onBeforePhysicsObservable.add(e._step)},t.prototype.removeStepComponentInstance=function(e){e.scene.onBeforePhysicsObservable.removeCallback(e._step)},t.prototype.setupFixedComponentInstance=function(e){e.scene.onAfterPhysicsObservable.add(e._fixed)},t.prototype.removeFixedComponentInstance=function(e){e.scene.onAfterPhysicsObservable.removeCallback(e._fixed)},t.RegisterInstance=function(e){null!=e&&(null!=e._update&&e.scene.registerBeforeRender(e._update),e.late&&null!=e._late&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&(e._lateUpdateObserver=e.scene.onBeforeRenderTargetsRenderObservable.add(e._late)),e.after&&null!=e._after&&e.scene.registerAfterRender(e._after),e.step&&null!=e._step&&e.setupStepComponentInstance(e),e.fixed&&null!=e._fixed&&e.setupFixedComponentInstance(e))},t.UpdateInstance=function(t){null!=t&&null!=t.transform&&t.transform.isEnabled(!1)&&(t._awoken===!1?(t._awoken=!0,e.ScriptComponent.ParseAutoProperties(t),t.awake&&t.awake()):t._started===!1?(t._started=!0,t.start&&t.start()):t._awoken===!0&&t._started===!0&&(t._delyed===!0&&(t._delyed=!1,e.ScriptComponent.ReadyInstance(t)),t.update&&t.update(),t._lateUpdate=!0))},t.LateInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&e._lateUpdate===!0&&(e._lateUpdate=!1,e._started===!0&&e.late&&e.late())},t.AfterInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&e._started===!0&&e.after&&e.after()},t.StepInstance=function(e){null!=e&&null!=e.transform&&e._started===!0&&e.step&&e.step()},t.FixedInstance=function(e){null!=e&&null!=e.transform&&e._started===!0&&e.fixed&&e.fixed()},t.ReadyInstance=function(e){null!=e&&null!=e.transform&&e._scriptReady===!1&&(e._scriptReady=!0,e.ready&&e.ready())},t.ResetInstance=function(e){null!=e&&null!=e.transform&&e._started===!0&&e.reset&&e.reset()},t.DestroyInstance=function(e){if(null!=e){e.scene.unregisterBeforeRender(e._update),null!=e._lateUpdateObserver&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&e.scene.onBeforeRenderTargetsRenderObservable.remove(e._lateUpdateObserver),e.after&&null!=e._after&&e.scene.unregisterAfterRender(e._after),e.step&&null!=e._step&&e.removeStepComponentInstance(e),e.fixed&&null!=e._fixed&&e.removeFixedComponentInstance(e);var t=window.havokPlugin;if(null!=t){if(null!=e._worldCollisionObserver)try{t.onCollisionObservable.remove(e._worldCollisionObserver)}catch(n){}if(null!=e._worldCollisionEndedObserver)try{t.onCollisionEndedObservable.remove(e._worldCollisionEndedObserver)}catch(n){}if(null!=e._worldTriggerEventObserver)try{t.onTriggerCollisionObservable.remove(e._worldTriggerEventObserver)}catch(n){}}try{e.onCollisionEnterObservable.clear()}catch(n){}try{e.onCollisionStayObservable.clear()}catch(n){}try{e.onCollisionExitObservable.clear()}catch(n){}try{e.onTriggerEnterObservable.clear()}catch(n){}try{e.onTriggerExitObservable.clear()}catch(n){}try{e.destroy&&e.destroy()}catch(n){}e._scriptReady=!1,e._transform=null,e._properties=null,e._started=!1,e._delyed=!1,e._update=null,e._late=null,e._step=null,e._fixed=null,e._after=null,e._ready=null,e._scene=null}},t.ParseAutoProperties=function(t){var n=Object.keys(t._properties);if(null!=n&&n.length>0)for(var r=function(r){var o=n[r];if(e.Utilities.StartsWith(o,"auto__")){var a=o.replace("auto__","");if(e.Utilities.HasOwnProperty(t,a)){var i=t.getProperty(o);if(null!=i){var l=typeof i;if(null!=l&&""!==l)if("object"===l)if(Array.isArray(i)){var s=[],u=i;u.forEach(function(n){if(null!=n){var r=typeof n;"object"===r?s.push(e.ScriptComponent.UnpackObjectProperty(n,t.scene)):s.push(n)}}),t[a]=s}else{var d=t[a],p=e.ScriptComponent.UnpackObjectProperty(i,t.scene);d instanceof e.Color3&&p instanceof e.Color4?t[a]=new e.Color3(p.r,p.g,p.b):t[a]=p}else t[a]=i;else t[a]=i}else t[a]=i}else e.Tools.Warn(t.getClassName()||"Unregistered Class: Auto property '"+a+"' not found for transform '"+t.transform.name+"'")}},o=0;o<n.length;o++)r(o)},t.UnpackObjectProperty=function(t,n){var r=null;if(null!=t)if(void 0!==t.x&&void 0!==t.y)r=void 0!==t.z?void 0!==t.w?new e.Vector4(t.x,t.y,t.z,t.w):new e.Vector3(t.x,t.y,t.z):new e.Vector2(t.x,t.y);else if(void 0!==t.r&&void 0!==t.g&&void 0!==t.b){var o=1;void 0!==t.a&&(o=t.a),r=new e.Color4(t.r,t.g,t.b,o)}else if(void 0!==t.type)switch(t.type){case"UnityEngine.AnimationCurve":var a=t;r=e.Animation.Parse(a.animation);break;case"UnityEngine.Transform":var i=t;r=e.Utilities.ParseTransformByID(i,n);break;case"UnityEngine.Material":var l=t;r=n.getMaterialByName(l.name);break;case"UnityEngine.Texture2D":var s=t;r=e.Utilities.ParseTexture(s,n);break;case"UnityEngine.Cubemap":var u=t;r=e.Utilities.ParseCubemap(u,n);break;case"UnityEngine.AudioClip":var d=t;r=d;break;case"UnityEngine.Video.VideoClip":var p=t;r=p;break;case"UnityEngine.Font":var c=t;r=c;break;case"UnityEngine.TextAsset":var m=t;r=null!=m.base64?m.json===!0?JSON.parse(window.atob(m.base64)):window.atob(m.base64):m;break;case"UnityEditor.DefaultAsset":var h=t;r=null!=h.base64?h.json===!0?JSON.parse(window.atob(h.base64)):window.atob(h.base64):h;break;default:r=t}else r=t;return r},t}();e.ScriptComponent=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._babylonScene=e,this._physicList=[],this._shadowList=[],this._scriptList=[],this._freezeList=[]}return t.prototype.parseSceneComponents=function(t){e.MetadataParser.DoParseSceneComponents(this._babylonScene,t,this._physicList,this._shadowList,this._scriptList,this._freezeList)},t.prototype.postProcessSceneComponents=function(t,n){e.MetadataParser.DoProcessPendingPhysics(this._babylonScene,this._physicList),e.MetadataParser.DoProcessPendingShadows(this._babylonScene,this._shadowList),e.MetadataParser.DoProcessPendingScripts(this._babylonScene,this._scriptList,t,n),e.MetadataParser.DoProcessPendingFreezes(this._freezeList),this._babylonScene=null,this._physicList=null,this._shadowList=null,this._scriptList=null,this._freezeList=null},t.DoParseSceneComponents=function(t,n,r,o,a,i){if(null!=n&&null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.parsed&&n.metadata.unity.parsed===!1){n.onDisposeObservable.addOnce(function(){e.Utilities.DisposeEntity(n)}),n.metadata.unity.parsed=!0,n.metadata.unity.prefab=!1;var l=n.metadata.unity,s=null==n.metadata.unity.visible||n.metadata.unity.visible,u=null!=n.metadata.unity.visibility?n.metadata.unity.visibility:1,d=null!=n.metadata.unity.billboard?n.metadata.unity.billboard:0,p=n instanceof e.AbstractMesh,c=(null!=n.metadata.unity.lightmapped&&n.metadata.unity.lightmapped,l.tags);if(null!=c&&""!==c&&(e.Tags.AddTagsTo(n,c),c.indexOf("NavigationMesh")>=0&&(n.isVisible=!1,n.isPickable=!1,n.useVertexColors=!1)),null!=l.physics&&null!=r&&r.push(n),n.renderingGroupId,null!=l.renderer)if(p===!0)n.isPickable=!0,n.useVertexColors=!1,n.isVisible=s,n.visibility=u,n.billboardMode=d,n.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(n.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=o&&o.push(n),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(n.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(n.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(n.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(n.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(n.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(n.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(n.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(n.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(n.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=i&&i.push(n);else{var m=e.SceneManager.GetSkinnedMesh(n);if(null!=m)m.isPickable=!0,m.useVertexColors=!1,m.isVisible=s,m.visibility=u,m.billboardMode=d,m.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,m.alwaysSelectAsActiveMesh=!0,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(m.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=o&&o.push(m),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(m.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(m.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(m.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(m.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(m.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(m.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(m.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(m.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(m.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=i&&i.push(m);else{var h=e.SceneManager.GetPrimitiveMeshes(n);null!=h&&h.length>0&&h.forEach(function(t){var n=e.SceneManager.GetSkinnedMesh(t);null!=n?(n.isPickable=!0,n.useVertexColors=!1,n.isVisible=s,n.visibility=u,n.billboardMode=d,n.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,n.alwaysSelectAsActiveMesh=!0,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(n.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=o&&o.push(n),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(n.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(n.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(n.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(n.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(n.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(n.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(n.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(n.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(n.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=i&&i.push(n)):(t.isPickable=!0,t.useVertexColors=!1,t.isVisible=s,t.visibility=u,t.billboardMode=d,t.cullingStrategy=e.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==e.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(t.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=o&&o.push(t),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(t.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(t.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(t.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(t.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(t.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(t.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(t.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(t.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(t.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=i&&i.push(t))})}}if(null!=l.components){var f=l.components;null!=f&&f.length>0&&f.forEach(function(r){if(null!=r)switch(r.alias){case"camera":e.MetadataParser.SetupCameraComponent(t,n,r);break;case"light":e.MetadataParser.SetupLightComponent(t,n,r);break;case"script":null!=a&&a.push({mesh:n,comp:r})}})}}},t.DoProcessPendingScripts=function(t,n,r,o){null!=n&&n.length>0&&(n.sort(function(e,t){return e.comp.order<t.comp.order?-1:e.comp.order>t.comp.order?1:0}),n.forEach(function(n){if(null!=n.comp.klass&&""!==n.comp.klass&&"BABYLON.ScriptComponent"!==n.comp.klass){var a=e.Utilities.InstantiateClass(n.comp.klass);if(null!=a){var i=new a(n.mesh,t,n.comp.properties);if(null!=i){var l=i instanceof e.ScriptComponent;l===!0?(n.comp.instance=i,null!=o&&o.push(n.comp.instance),n.comp.instance.addPreloaderTasks&&null!=r&&r.push(n.comp.instance),e.SceneManager.RegisterScriptComponent(n.comp.instance,n.comp.klass,!1)):e.Tools.Warn("Non script component instantiated class: "+n.comp.klass)}else e.Tools.Warn("Failed to instantiate script class: "+n.comp.klass)}else e.Tools.Warn("Failed to locate script class: "+n.comp.klass)}}))},t.DoProcessPendingShadows=function(e,t){null!=t&&t.length>0&&null!=e.lights&&e.lights.length>0&&e.lights.forEach(function(e){var n=e.getShadowGenerator();if(null!=n&&null!=e.metadata&&null!=e.metadata.unity&&e.metadata.unity.autorender===!0){var r=n.getShadowMap();null!=r&&t.forEach(function(t){var n=!1;n=!(null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0)||e.includedOnlyMeshes.indexOf(t)>=0,n===!0&&(null==r.renderList&&(r.renderList=[]),r.renderList.indexOf(t)<0&&r.renderList.push(t))})}})},t.DoProcessPendingPhysics=function(t,n){if(null!=n&&n.length>0){var r=t.isPhysicsEnabled(),o=r===!0?t.getPhysicsEngine():null,a=r===!0&&null!=o;a===!0?n.forEach(function(n){e.RigidbodyPhysics?e.RigidbodyPhysics.SetupPhysicsComponent(t,n):e.Tools.Warn("Rigidbody physics system not loaded. Physics impostors will not be created for: "+n.name)}):e.Tools.Warn("Physics engine not loaded. Physics impostors will not be created.")}},t.DoProcessPendingFreezes=function(e){null!=e&&e.length>0&&e.forEach(function(e){e.freezeWorldMatrix()})},t.SetupCameraComponent=function(t,n,r){n.checkCollisions=!1;var o=0,a=n.name+".Rig",i=0,l=null!=r.culling?r.culling:-1,s=null!=r.camerabase?r.camerabase:0,u=(null!=r.clearflags?r.clearflags:0,null!=r.renderlist?r.renderlist:null),d=null!=r.maincamera&&r.maincamera,p=4===s?new e.FreeCamera(a,e.Vector3.Zero(),t):new e.UniversalCamera(a,e.Vector3.Zero(),t);p.checkCollisions=!1,p.rotationQuaternion=e.Quaternion.FromEulerAngles(0,i,0),p.parent=n,d===!0&&(t.activeCamera=p);var c=null!=r.type?r.type:0;switch(c){case 0:p.mode=e.Camera.PERSPECTIVE_CAMERA,null!=r.perspectiveyfov&&(p.fov=r.perspectiveyfov),null!=r.perspectiveznear&&(p.minZ=r.perspectiveznear),null!=r.perspectivezfar&&(p.maxZ=r.perspectivezfar);break;case 1:p.mode=e.Camera.ORTHOGRAPHIC_CAMERA,null!=r.orthoxmag&&(p.orthoLeft=-r.orthoxmag,p.orthoRight=r.orthoxmag),null!=r.orthoymag&&(p.orthoBottom=-r.orthoymag,p.orthoTop=r.orthoymag),null!=r.orthoznear&&(p.minZ=r.orthoznear),null!=r.orthozfar&&(p.maxZ=r.orthozfar)}if(l===-1);else if(0===l);else{var m=u;if(null!=m&&m.length>0){var h=function(){var n=m[o],r=e.SceneManager.GetMeshByID(t,n);if(null!=r){var a=r.name+".Detail",i=r.getChildren(function(e){return e.name===a},!0);null!=i&&i.length>0}};for(o=0;o<m.length;o++)h()}}n.cameraRig=p},t.SetupLightComponent=function(t,n,r){n.checkCollisions=!1;var o,a=n.name+".Rig",i=0,l=1,s=null!=r.culling?r.culling:-1,u=(null!=r.clearflags?r.clearflags:0,null!=r.renderlist?r.renderlist:null),d=null!=r.type?r.type:0,p=e.SceneManager.GetRenderQuality(),c=null!=r.exponentdecayspeed?r.exponentdecayspeed:1,m=!1;switch(d){case 0:var h=e.Vector3.Forward(),f=null!=r.orthoscale?r.orthoscale:.1,g=null!=r.ortholeft?r.ortholeft:Number.MAX_VALUE,y=null!=r.orthoright?r.orthoright:Number.MAX_VALUE,v=null!=r.orthotop?r.orthotop:Number.MAX_VALUE,_=null!=r.orthobottom?r.orthobottom:Number.MAX_VALUE,b=null!=r.calczbounds&&r.calczbounds,C=null!=r.updateextends&&r.updateextends,S=null!=r.shadowfrustumsize?r.shadowfrustumsize:0,T=new e.DirectionalLight(a,h,t);T.shadowFrustumSize=S,T.shadowOrthoScale=f,T.autoCalcShadowZBounds=b,T.autoUpdateExtends=C,T.orthoLeft=g,T.orthoRight=y,T.orthoTop=v,T.orthoBottom=_,o=T,o.falloffType=e.Light.FALLOFF_STANDARD,m=p===e.RenderQuality.High||p===e.RenderQuality.Medium,l=e.SceneManager.DirectionalLightIntensity;break;case 1:var I=o=new e.PointLight(a,e.Vector3.Zero(),t);o=I,o.falloffType=e.Light.FALLOFF_STANDARD,m=p===e.RenderQuality.High||p===e.RenderQuality.Medium,l=e.SceneManager.PointLightIntensity;break;case 2:var h=e.Vector3.Forward(),M=null!=r.spotangle?r.spotangle:Math.PI/4,x=new e.SpotLight(a,e.Vector3.Zero(),h,0,c,t);x.angle=.966*e.Tools.ToRadians(M),x.innerAngle=.8*x.angle,o=x,o.falloffType=e.Light.FALLOFF_GLTF,m=p===e.RenderQuality.High||p===e.RenderQuality.Medium,l=e.SceneManager.SpotLightIntensity}if(null!=o){var A=null!=r.range?r.range:Number.MAX_VALUE,O=null!=r.color?e.Utilities.ParseColor3(r.color,e.Color3.White()):e.Color3.White(),w=null!=r.specular?e.Utilities.ParseColor3(r.specular,e.Color3.White()):e.Color3.White();o.parent=n,o.range=A,o.diffuse=O,o.specular=w,o.intensity=(null!=r.intensity?r.intensity:1)*l,o.lightmapMode=e.Light.LIGHTMAP_DEFAULT,o.intensityMode=e.Light.INTENSITYMODE_AUTOMATIC,o.shadowEnabled=!1;var B=null==r.autorender||r.autorender,P=null!=r.softshadows&&r.softshadows,L=null!=r.numcascades?r.numcascades:0,k=null!=r.cascadelambda?r.cascadelambda:1,N=null!=r.setdepthclamp&&r.setdepthclamp,U=null!=r.blendpertecntage?r.blendpertecntage:1e-8,E=null!=r.boundsrefreshrate?r.boundsrefreshrate:1,R=null!=r.lightcontactratio?r.lightcontactratio:.1,D=null!=r.stabilizecascades&&r.stabilizecascades,F=null!=r.penumbradarkness?r.penumbradarkness:1,V=null!=r.softshadowsfilter?r.softshadowsfilter:99,G=null!=r.freezeshadows&&r.freezeshadows,H=null!=r.calcdepths&&r.calcdepths,z=null!=r.depthscaling?r.depthscaling:50,Y=null!=r.blurscaling?r.blurscaling:2,W=null==r.kernelblur||r.kernelblur,Q=null!=r.blurkernelsize?r.blurkernelsize:1,X=null!=r.blurboxoffset?r.blurboxoffset:1,j=null!=r.shadowmapsize?r.shadowmapsize:1024,K=null!=r.generateshadows&&r.generateshadows,q=null!=r.shadowbiasfactor?r.shadowbiasfactor:.001,Z=null!=r.normalbiasfactor?r.normalbiasfactor:.1,J=null!=r.shadowmapbias?r.shadowmapbias:.05,$=null!=r.normalmapbias?r.normalmapbias:.4,ee=null!=r.shadowstrength?r.shadowstrength:1,te=null!=r.shadowdistance?r.shadowdistance:150,ne=null!=r.shadownearplane?r.shadownearplane:.2,re=null!=r.shadowfilterquality?r.shadowfilterquality:"Medium",oe=null!=r.transparencyshadow&&r.transparencyshadow,ae=null!=r.softtransparency&&r.softtransparency,ie=null==r.forcebackfacesonly||r.forcebackfacesonly,le=null!=r.frustumedgefalloff?r.frustumedgefalloff:0,se=null!=r.usefullfloatfirst&&r.usefullfloatfirst;if(m===!0&&K===!0){var ue=o,de=e.SceneManager.GetWebGLVersionNumber(t),pe=0===d&&L>=2&&de>=2,ce=pe===!0?new e.CascadedShadowGenerator(j,o,se):new e.ShadowGenerator(j,ue,se);if(ce.bias=J*q,ce.normalBias=$*Z,ce.depthScale=z,ce.useKernelBlur=W,ce.blurKernel=Q,ce.blurScale=Y,ce.blurBoxOffset=X,ce.frustumEdgeFalloff=le,ce.forceBackFacesOnly=ie,ce.transparencyShadow=oe,ce.enableSoftTransparentShadow=ae,ce.contactHardeningLightSizeUVRatio=R,P===!0)if(de<=1)ce.usePoissonSampling=!0;else if(pe===!0)ce.usePercentageCloserFiltering=!0;else switch(V){case 0:ce.usePoissonSampling=!0;break;case 1:ce.useExponentialShadowMap=!0;break;case 2:ce.useBlurExponentialShadowMap=!0;break;case 3:ce.useCloseExponentialShadowMap=!0;break;case 4:ce.useBlurCloseExponentialShadowMap=!0;break;case 5:ce.useContactHardeningShadow=!0;break;case 99:ce.usePercentageCloserFiltering=!0;break;default:ce.usePoissonSampling=!0}switch(re){case"High":ce.filteringQuality=e.ShadowGenerator.QUALITY_HIGH;break;case"Medium":ce.filteringQuality=e.ShadowGenerator.QUALITY_MEDIUM;break;case"Low":ce.filteringQuality=e.ShadowGenerator.QUALITY_LOW}if(pe===!0){var me=ce;me.lambda=k,me.depthClamp=N,me.shadowMaxZ=te,me.numCascades=L,me.penumbraDarkness=F,me.autoCalcDepthBounds=H,me.stabilizeCascades=D,me.cascadeBlendPercentage=U,me.autoCalcDepthBoundsRefreshRate=E,me.freezeShadowCastersBoundingInfo=G,me.setDarkness(1-e.Scalar.Clamp(ee)),ue.shadowEnabled=!0,me.splitFrustum()}else{var he=ce;he.setDarkness(1-e.Scalar.Clamp(ee)),ue.shadowEnabled=!0,ue.shadowMinZ=ne,ue.shadowMaxZ=te}null==o.metadata&&(o.metadata={}),null==o.metadata.unity&&(o.metadata.unity={}),o.metadata.unity.autorender=B}var fe=n.name+".Holder";if(s===-1)o.includedOnlyMeshes=[];else if(0===s)o.includedOnlyMeshes=[new e.Mesh(fe,t)];else{o.includedOnlyMeshes=[new e.Mesh(fe,t)];var ge=u;if(null!=ge&&ge.length>0){var ye=function(){var n=ge[i],r=e.SceneManager.GetMeshByID(t,n);if(null!=r){var a=r.name+".Detail",l=r.getChildren(function(e){return e.name===a},!0);null!=l&&l.length>0?o.includedOnlyMeshes.push(l[0]):o.includedOnlyMeshes.push(r)}};for(i=0;i<ge.length;i++)ye()}}n.lightRig=o}},t}();e.MetadataParser=t}(BABYLON||(BABYLON={}));var CVTOOLS_NAME="CVTOOLS_unity_metadata",CVTOOLS_MESH="CVTOOLS_babylon_mesh",CVTOOLS_HAND="CVTOOLS_left_handed",CubeTextureLoader=function(){function e(){}return e}(),CVTOOLS_unity_metadata=function(){function e(e){this.name=CVTOOLS_NAME,this.enabled=!1,this._babylonScene=null,this._loaderScene=null,this._assetsManager=null,this._materialMap=null,this._lightmapMap=null,this._reflectionMap=null,this._reflectionCache=null,this._assetContainer=!1,this._activeMeshes=!1,this._parseScene=!1,this._leftHanded=!1,this._disposeRoot=!1,this._sceneParsed=!1,this._preWarmTime=1,this._hideLoader=!1,this._fileName="Unknown",this._rootUrl=null,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND),this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._rootUrl=null,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._readyList=null,this._preloadList=null,this._materialMap=null,this._lightmapMap=null,this._preWarmTime=1,this._hideLoader=!1,this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._animationGroups=null,this._babylonScene=null,this.order=100}return e.prototype.dispose=function(){delete this._loader},e.prototype.onLoading=function(){var e=this;BABYLON.Utilities.LoadingState=0,this._assetContainer=null!=this._loader._assetContainer,this._babylonScene=this._loader.babylonScene,this._loaderScene=null,this._assetsManager=null,this._rootUrl=this._loader._uniqueRootUrl?this._loader._uniqueRootUrl:"/",this._fileName=this._loader._fileName?this._loader._fileName:"Unknown",this._fileName.indexOf("?")>=0&&(this._fileName=this._fileName.split("?")[0]),this._loader.parent.onCompleteObservable.addOnce(function(){e.onComplete()}),this._loader.parent.onValidatedObservable.addOnce(function(){e.onValidate()}),this._parseScene=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND)&&BABYLON.SceneManager.IsSceneParsingEnabled()===!0,this._leftHanded=this._loader.isExtensionUsed(CVTOOLS_HAND),this._disposeRoot=this._sceneParsed=!1,this._animationGroups=[],this._masterList=[],this._detailList=[],this._parserList=[],this._shaderList=[],this._readyList=[],this._preloadList=[],this._materialMap=new Map,this._lightmapMap=new Map,this._preWarmTime=1,this._hideLoader=!1,this._reflectionMap={},this._reflectionCache={},BABYLON.Utilities.ResetLoaderItemsMarkedForDisposal(),this._babylonScene.getEngine().getCaps().supportSRGBBuffers=BABYLON.SceneManager.SupportSRGBBuffers,this._leftHanded===!0&&null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.rotationQuaternion=BABYLON.Quaternion.Identity(),this._loader.rootBabylonMesh.scaling=BABYLON.Vector3.One()),this._parseScene===!0&&(BABYLON.SceneManager.RenderLoopReady=!1,null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.name="Root."+this._fileName.replace(".gltf","").replace(".glb","")),this.setupLoader())},e.prototype.onReady=function(){this._parseScene===!0&&this._disposeRoot===!0&&null!=this._loader.rootBabylonMesh&&this._loader.rootBabylonMesh.dispose(!0)},e.prototype.onComplete=function(){var e=this;this._parseScene===!0&&(this.startParsing(),BABYLON.SceneManager.RenderLoopReady=!0,this._babylonScene.onAfterRenderObservable.addOnce(function(){BABYLON.Utilities.LoadingState=3,e._processPreloadTimeout()}))},e.prototype.onValidate=function(){this._parseScene===!0},e.prototype.onCleanup=function(){this._rootUrl=null,this._fileName=null,this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._preWarmTime=1,this._readyList=null,this._preloadList=null,this._hideLoader=!1,this._animationGroups=null,null!=this._materialMap&&(this._materialMap.clear(),this._materialMap=null),null!=this._lightmapMap&&(this._lightmapMap.clear(),this._lightmapMap=null),this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._babylonScene=null},e.prototype.setupLoader=function(){var e=this;this._parseScene===!0&&(this._assetsManager=new BABYLON.PreloadAssetsManager(this._babylonScene),this._assetsManager.onProgress=function(e,t,n){if(BABYLON.SceneManager.AutoUpdateProgress===!0){var r=1===t?" ASSET":" ASSETS",o="LOADING "+(t-e)+" OF "+t+r;BABYLON.SceneManager.UpdateLoaderDetails(o,BABYLON.Utilities.LoadingState)}else null!=BABYLON.Utilities.OnPreloaderProgress&&BABYLON.Utilities.OnPreloaderProgress(e,t,n)},this._assetsManager.onFinish=function(t){BABYLON.SceneManager.SetTimeout(1e3,function(){BABYLON.Utilities.LoadingState=4,BABYLON.SceneManager.AutoUpdateProgress===!0&&BABYLON.SceneManager.UpdateLoaderStatus("PLEASE WAIT","PREPARING VIEWPORT",BABYLON.Utilities.LoadingState);var n=e._preWarmTime>0?1e3*(e._preWarmTime+1):1e3;BABYLON.SceneManager.SetTimeout(n,function(){if(null!=BABYLON.Utilities.OnPreloaderComplete&&BABYLON.Utilities.OnPreloaderComplete(t),e._processShaderMaterials(e._babylonScene,e._shaderList),BABYLON.Utilities.RemoveLoaderItemsMarkedForDisposal(),null!=e._readyList&&e._readyList.length>0)for(var n=0;n<e._readyList.length;n++){var r=e._readyList[n];null!=r&&r._ready&&r._ready()}e._babylonScene.onAfterRenderObservable.addOnce(function(){1==e._hideLoader&&BABYLON.SceneManager.HideSceneLoader(),e.onCleanup()})})})})},e.prototype.startParsing=function(){this._parseScene===!0&&(BABYLON.Utilities.LoadingState=2,this._processLevelOfDetail(this._babylonScene,this._detailList),this._processActiveMeshes(this._babylonScene,this._activeMeshes),this._processUnityMeshes(this._masterList),null!=this._loaderScene&&(this.preProcessSceneProperties(this._loaderScene,this._babylonScene),this.postProcessSceneProperties(this._rootUrl,this._loaderScene,this._babylonScene)),this._assetContainer===!1&&null!=this._parserList&&this._parserList.length>0&&BABYLON.Utilities.PostParseSceneComponents(this._babylonScene,this._parserList,this._preloadList,this._readyList))},e.prototype.loadSceneAsync=function(e,t){if(this._parseScene===!0&&(this._loaderScene=t),this._parseScene===!0&&null!=t.extras&&null!=t.extras.metadata){if(null!=t.extras.metadata.rawmaterials){var n=this._loader,r=t.extras.metadata.rawmaterials;this._preloadRawMaterialsAsync(e,n._gltf.materials,r)}BABYLON.Utilities.LoadingState=1;var o=this._loader.loadSceneAsync(e,t);return this.loadSceneExAsync(e,t),o}return BABYLON.Utilities.LoadingState=1,null},e.prototype.loadSceneExAsync=function(e,t){var n=this,r=this._loader,o=new Array;if(r._gltf.nodes)for(var a=0,i=r._gltf.nodes;a<i.length;a++){var l=i[a];l._babylonTransformNode&&this._animationGroups&&BABYLON.Utilities.AssignAnimationGroupsToNode(l._babylonTransformNode,this._animationGroups)}if(null!=this._reflectionMap&&null!=this._reflectionCache){var s=0,u=function(e){if(s++,d._reflectionMap.hasOwnProperty(e)){var t=e;if(null!=d._assetsManager){var r=d._assetsManager.addBinaryFileTask("Material.ReflectionTextureTask"+s.toFixed(0),t);r.onSuccess=function(e){if(null!=e.data){var r=new Blob([e.data]),o=n._reflectionMap[t];null!=o&&o.forEach(function(e){if(null!=e&&null!=e.mapkey){var t=n._reflectionCache[e.mapkey];if(null!=t)null!=e.material&&BABYLON.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=t);else{var o=n._babylonScene,a=URL.createObjectURL(r),i=function(){URL.revokeObjectURL(a)},l=new BABYLON.CubeTexture(a,o,null,null,null,i,i,null,e.prefiltered,e.extension);l.name=e.name,null!=e.boundingBoxSize&&(l.boundingBoxSize=e.boundingBoxSize),null!=e.boundingBoxPosition&&(l.boundingBoxPosition=e.boundingBoxPosition),n._reflectionCache[e.mapkey]=l,null!=e.material&&BABYLON.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=l)}}})}else console.error("Failed to load reflection texture task: "+t)},r.onError=function(e,t,n){console.error(t,n)}}}},d=this;for(var p in this._reflectionMap)u(p)}return r.logClose(),Promise.all(o).then(function(){})},e.prototype._processActiveMeshes=function(e,t){t===!0&&e.freeActiveMeshes()},e.prototype._processUnityMeshes=function(e){
null!=e&&e.length>0&&e.forEach(function(e){BABYLON.Utilities.RegisterInstancedMeshBuffers(e)})},e.prototype._processPreloadTimeout=function(){if(null!=this._assetsManager){if(null!=this._preloadList&&this._preloadList.length>0)for(var e=0;e<this._preloadList.length;e++){var t=this._preloadList[e];null!=t&&t.addPreloaderTasks&&t.addPreloaderTasks(this._assetsManager)}this._babylonScene._preloaded=!0,this._assetsManager.load()}},e.prototype.loadNodeAsync=function(e,t,n){var r=this;return this._parseScene===!0&&null!=t.extras&&null!=t.extras.metadata?this._loader.loadNodeAsync(e,t,function(e){var o=e,a=t.extras.metadata;null==o.metadata&&(o.metadata={}),o.metadata.unity=a,BABYLON.Utilities.ValidateTransformGuid(o),BABYLON.Utilities.ValidateTransformMetadata(o),BABYLON.Utilities.ValidateTransformQuaternion(o),o.isVisible=null==o.metadata.unity.visible||o.metadata.unity.visible,o.visibility=null!=o.metadata.unity.visibility?o.metadata.unity.visibility:1,o.billboardMode=null!=o.metadata.unity.billboard?o.metadata.unity.billboard:0,r._assetContainer===!0&&(o.metadata.unity.prefab=!0),o.metadata.unity.prefab===!0?o.setEnabled(!1):(r._parserList.push(o),null!=t.extras.metadata.lods&&null!=t.extras.metadata.distances&&null!=r._detailList&&r._detailList.push(o)),r._masterList.push(o),n(o)}):null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){if(this._parseScene===!0){var r=-1;t.index&&(r=t.index,r>=0&&null!=this._materialMap&&(this._materialMap.has(r)||this._materialMap.set(r,n))),n.gltfIndex=r;var o=this._loader,a=new Array;if(n instanceof BABYLON.NodeMaterial)a.push(this._parseNodeMaterialPropertiesAsync("".concat(e,"/nodeMaterial"),t,n));else if(n instanceof BABYLON.ShaderMaterial)a.push(this._parseShaderMaterialPropertiesAsync("".concat(e,"/shaderMaterial"),t,n));else if(n instanceof BABYLON.StandardMaterial)a.push(this._parseDiffuseMaterialPropertiesAsync("".concat(e,"/standardMaterial"),t,n));else{var i=o._extensionsLoadMaterialPropertiesAsync(e,t,n);i?this._parseCommonConstantProperties(a,"".concat(e,"/commonConstant"),t,n):(a.push(o.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&a.push(o._loadMaterialMetallicRoughnessPropertiesAsync("".concat(e,"/pbrMetallicRoughness"),t.pbrMetallicRoughness,n)),o.loadMaterialAlphaProperties(e,t,n),this._parseCommonConstantProperties(a,"".concat(e,"/commonConstant"),t,n))}return Promise.all(a).then(function(){})}return null},e.prototype._getCachedMaterialByIndex=function(e){var t=null;return e>=0&&null!=this._materialMap&&(t=this._materialMap.get(e)||null),t},e.prototype._getCachedLightmapByIndex=function(e){var t=null;return e>=0&&null!=this._lightmapMap&&(t=this._lightmapMap.get(e)||null),t},e.prototype.createMaterial=function(e,t,n){if(this._parseScene===!0&&t.index){var r=t.index;if(r>=0){var o=this._getCachedMaterialByIndex(r);if(null!=o)return o}}if(this._parseScene===!0){var a=null,i=t.name||"No Name";if(null!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.customMaterial){var l=t.extras.metadata,s=l.customMaterial,u=(l.customShader,BABYLON.Utilities.InstantiateClass(s));if(null!=u){var d=new u(i,this._loader.babylonScene);if(null!=d){var p=d instanceof BABYLON.Material;p===!0?(a=d,a.fillMode=n,a instanceof BABYLON.ShaderMaterial&&BABYLON.Utilities.InitializeShaderMaterial(a)):BABYLON.Tools.Warn("Non material instantiated class: "+s)}else BABYLON.Tools.Warn("Failed to instantiate material class: "+s)}else BABYLON.Tools.Warn("Failed to locate material class: "+s)}return a}return null},e.prototype.loadAnimationAsync=function(e,t){if(this._parseScene===!0){var n=(this._loader,t);this._babylonScene._blockEntityCollection=!!this._assetContainer;var r=new BABYLON.AnimationGroup(t.name||"animation".concat(n.index),this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n._babylonAnimationGroup=r,this._animationGroups.push(r);var o=new Array;BABYLON.GLTF2.ArrayItem.Assign(n.channels),BABYLON.GLTF2.ArrayItem.Assign(n.samplers);for(var a=0,i=t.channels;a<i.length;a++){var l=i[a],s=l;o.push(this._loader._loadAnimationChannelAsync("".concat(e,"/channels/").concat(s.index),e,t,l,function(e,t){e.animations=e.animations||[],e.animations.push(t),r.addTargetedAnimation(t,e)}))}return Promise.all(o).then(function(){if(null!=t.extras&&null!=t.extras.metadata){var e={};e.unity=t.extras.metadata,r.metadata=e,null!=e.label&&""!==e.label&&(r.name=e.label)}return r.normalize(0),r})}return null},e.prototype._loadMeshPrimitiveAsync=function(e,t,n,r,o,a){var i=this;if(this._parseScene===!0){var l=this._loader;l.logOpen("".concat(e));var s,u=0===l._disableInstancedMesh&&l._parent.createInstances&&void 0==n.skin&&!r.primitives[0].targets,d=void 0;if(u&&o._instanceData)l._babylonScene._blockEntityCollection=!!l._assetContainer,s=o._instanceData.babylonSourceMesh.createInstance(t),s._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1,d=o._instanceData.promise;else{var p=new Array;l._babylonScene._blockEntityCollection=!!l._assetContainer;var c=new BABYLON.Mesh(t,l._babylonScene);c._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1,this._leftHanded===!0?c.overrideMaterialSideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:c.overrideMaterialSideOrientation=l._babylonScene.useRightHandedSystem?BABYLON.Material.CounterClockWiseSideOrientation:BABYLON.Material.ClockWiseSideOrientation,l._createMorphTargets(e,n,r,o,c),p.push(l._loadVertexDataAsync(e,o,c).then(function(t){return l._loadMorphTargetsAsync(e,o,c,t).then(function(){l._disposed||(l._babylonScene._blockEntityCollection=!!l._assetContainer,t.applyToMesh(c),i._setupBabylonMesh(c,n,r,o),t._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1)})}));var m=BABYLON.GLTF2.GLTFLoader._GetDrawMode(e,o.mode);if(null!=o.extras&&null!=o.extras.metadata&&null!=o.extras.metadata.multimaterial&&null!=o.extras.metadata.submeshes)this._setupBabylonMaterials(e,p,m,c,r,o);else if(void 0==o.material){var h=l._defaultBabylonMaterialData[m];h||(h=l._createDefaultMaterial("__GLTFLoader._default",m),l._parent.onMaterialLoadedObservable.notifyObservers(h),l._defaultBabylonMaterialData[m]=h),c.material=h}else if(!l.parent.skipMaterials){var f=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),l._gltf.materials,o.material);p.push(l._loadMaterialAsync("/materials/".concat(f.index),f,c,m,function(e){c.material=e}))}d=Promise.all(p),u&&(o._instanceData={babylonSourceMesh:c,promise:d}),s=c}return BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(s,e),l._parent.onMeshLoadedObservable.notifyObservers(s),a(s),l.logClose(),d.then(function(){return s})}return null},e.prototype._setupBabylonMesh=function(e,t,n,r){if(this._parseScene===!0){this._loader;if(null!=r.extras&&null!=r.extras.metadata&&null!=r.extras.metadata.multimaterial&&null!=r.extras.metadata.submeshes){var o=r.extras.metadata.submeshes;e.subMeshes=[];for(var a=0;a<o.length;a++){var i=o[a];BABYLON.SubMesh.AddToMesh(i.materialIndex,i.verticesStart,i.verticesCount,i.indexStart,i.indexCount,e)}}e.computeWorldMatrix(!0)}},e.prototype._setupBabylonMaterials=function(e,t,n,r,o,a){if(this._parseScene===!0){var i=this._loader,l=a.extras.metadata.multimaterial,s=l.materials,u=[],d=l.id||"MM_"+o.name,p=l.name||"MM_"+o.name,c=new BABYLON.MultiMaterial("["+p+"]",i._babylonScene);c.id=d,s.forEach(function(t){if(null!=t){var n=parseInt(t);if(n>=0){var o=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),i._gltf.materials,n);u.push(o)}else console.warn("Invalid Submesh Material Index Encountered For: "+r.name)}else console.warn("Null Submesh Material Encountered For: "+r.name)}),t.push(this._parseMultiMaterialAsync("/materials/".concat(p),u,r,n,function(e){c.subMaterials=e,r.material=c}))}},e.prototype._processLevelOfDetail=function(e,t){null!=t&&t.length>0&&t.forEach(function(e){if(null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.lods&&null!=e.metadata.unity.distances){var t=e.metadata.unity,n=t.lods,r=t.distances;if(r.length>=n.length){var o=null,a=null;if(n.forEach(function(t,n){var r="*"===t?e:SM.FindChildTransformNode(e,t,BABYLON.SearchType.ExactMatch,!1);null!=r&&r instanceof BABYLON.AbstractMesh&&(0===n?o=r:(null==a&&(a=[]),a.push(r)))}),null!=o)if(o instanceof BABYLON.Mesh){var i=r.length>0?r[r.length-1]:0;i>=1/0&&(i=0),null!=a&&a.forEach(function(e,t){o.addLODLevel(r[t],e)}),i>0&&o.addLODLevel(i,null)}else o instanceof BABYLON.InstancedMesh&&null!=a&&a.forEach(function(t,n){try{t.dispose()}catch(r){}BABYLON.Tools.Warn("Destroyed Unused Level Detail: "+t.name+" --> For Transform: "+e.name)})}}})},e.prototype._processShaderMaterials=function(e,t){null!=t&&t.length>0&&t.forEach(function(e){e.freeze()})},e.prototype.preProcessSceneProperties=function(e,t){if(this._assetContainer!==!0&&this._sceneParsed===!1&&null!=e.extras&&null!=e.extras.metadata&&null!=e.extras.metadata.properties&&e.extras.metadata.properties===!0){this._sceneParsed=!0;var n=null!=this._rootUrl?this._rootUrl:"/",r=e.extras.metadata;if(null==t.metadata&&(t.metadata={}),null==t.metadata.unity&&(t.metadata.unity={}),t.metadata.unity=r,this._disposeRoot=null!=r.disposeroot&&r.disposeroot===!0,this._hideLoader=null!=r.hideloader&&r.hideloader===!0,this._preWarmTime=null!=r.prewarmup?r.prewarmup:0,BABYLON.SceneManager.SetRootUrl(t,n),BABYLON.SceneManager.SetSceneFile(t,this._fileName),BABYLON.SceneManager.EnableUserInput=!0,BABYLON.SceneManager.GlobalOptions.ktxtextures=null!=r.ktxtextures&&r.ktxtextures,BABYLON.SceneManager.GlobalOptions.ktxlightmaps=null!=r.ktxlightmaps&&r.ktxlightmaps,BABYLON.SceneManager.GlobalOptions.intensityFactor=null!=r.intensity?r.intensity:1,BABYLON.SceneManager.GlobalOptions.debugModeEnabled=null!=r.debugging&&r.debugging,BABYLON.SceneManager.GlobalOptions.showDebugColliders=null!=r.showdebugcolliders&&r.showdebugcolliders,BABYLON.SceneManager.GlobalOptions.colliderVisibility=null!=r.collidervisibility?r.collidervisibility:0,BABYLON.SceneManager.GlobalOptions.colliderRenderGroup=null!=r.colliderrendergroup?r.colliderrendergroup:0,BABYLON.SceneManager.GlobalOptions.defaultRenderGroup=null!=r.defaultrendergroup?r.defaultrendergroup:0,BABYLON.SceneManager.GlobalOptions.collisionWireframe=null!=r.collisionwireframe&&r.collisionwireframe,BABYLON.SceneManager.GlobalOptions.useTriangleNormals=null!=r.trianglenormals&&r.trianglenormals,BABYLON.SceneManager.GlobalOptions.useConvexTriangles=null==r.convextriangles||r.convextriangles,BABYLON.SceneManager.GlobalOptions.colliderInstances=null==r.colliderinstances||r.colliderinstances,BABYLON.SceneManager.GlobalOptions.reparentColliders=null==r.reparentcolliders||r.reparentcolliders,null!=r.clearcolor&&(t.clearColor=BABYLON.Utilities.ParseColor4(r.clearcolor)),null!=r.autoclear&&r.autoclear===!0&&(t.autoClear=!0,t.autoClearDepthAndStencil=!0),null!=r.rendergroups&&(BABYLON.RenderingManager.MAX_RENDERINGGROUPS=r.rendergroups),null!=r.imageprocessing){var o=r.imageprocessing,a=null!=o.contrast?o.contrast:1,i=null!=o.exposure?o.exposure:1;null!=t.imageProcessingConfiguration&&(t.imageProcessingConfiguration.contrast=a,t.imageProcessingConfiguration.exposure=i)}var l=BABYLON.SceneManager.AmbientLightIntensity;if(null!=r.ambientcoloring&&(t.ambientColor=BABYLON.Utilities.ParseColor3(r.ambientcoloring)),null!=r.ambientlighting&&r.ambientlighting>0){var s=t;null==s._AmbientLight&&(s._AmbientLight=new BABYLON.HemisphericLight("Ambient Lighting",new BABYLON.Vector3(0,1,0),t),s._AmbientLight.falloffType=BABYLON.Light.FALLOFF_STANDARD,s._AmbientLight.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT),null!=s._AmbientLight&&(null!=r.ambientskycolor&&(s._AmbientLight.diffuse=BABYLON.Utilities.ParseColor3(r.ambientskycolor,BABYLON.Color3.Gray())),null!=r.ambientspecularcolor&&(s._AmbientLight.specular=BABYLON.Utilities.ParseColor3(r.ambientspecularcolor,BABYLON.Color3.White())),null!=r.ambientgroundcolor&&(s._AmbientLight.groundColor=BABYLON.Utilities.ParseColor3(r.ambientgroundcolor,BABYLON.Color3.Gray())),null!=r.ambientlightintensity&&(s._AmbientLight.intensity=r.ambientlightintensity),s._AmbientLight.intensity*=l)}if(null!=r.fogmode){var u=r.fogmode;if(u>0){t.fogMode=u,t.fogEnabled=!0;var d=1;1===u?d=.5:2===u&&(d=.75),null!=r.fogdensity&&(t.fogDensity=r.fogdensity*d),null!=r.fogstart&&(t.fogStart=r.fogstart),null!=r.fogend&&(t.fogEnd=r.fogend),null!=r.fogcolor&&(t.fogColor=BABYLON.Utilities.ParseColor3(r.fogcolor))}}var p=new BABYLON.Vector3(0,(-9.81),0),c=null!=r.defaultgravity?BABYLON.Utilities.ParseVector3(r.defaultgravity,p):p;if(t.gravity=c.clone(),t.collisionsEnabled=!0,null!=r.enablephysics){var m=r.enablephysics;if(m===!0){var h=null==r.ccdenabled||r.ccdenabled,f=null!=r.ccdpenetration?r.ccdpenetration:1e-4,g=null!=r.subtimestep?r.subtimestep:0,y=null!=r.maxworldsweep?r.maxworldsweep:0,v=null==r.deltaworldstep||r.deltaworldstep;BABYLON.RigidbodyPhysics?BABYLON.RigidbodyPhysics.ConfigurePhysicsEngine(t,v,g,y,h,f,c):BABYLON.Tools.Warn("Rigidbody physics system not loaded. Physics system not configured")}}if(null!=r.userinput){var _=r.userinput;BABYLON.UserInputOptions.KeyboardSmoothing=_.keyboardSmoothing,BABYLON.UserInputOptions.KeyboardMoveSensibility=_.keyboardSensitivity,BABYLON.UserInputOptions.KeyboardMoveDeadZone=_.keyboardDeadZone,BABYLON.UserInputOptions.GamepadDeadStickValue=_.padDeadStick,BABYLON.UserInputOptions.GamepadLStickXInverted=_.padLStickXInvert,BABYLON.UserInputOptions.GamepadLStickYInverted=_.padLStickYInvert,BABYLON.UserInputOptions.GamepadRStickXInverted=_.padRStickXInvert,BABYLON.UserInputOptions.GamepadRStickYInverted=_.padRStickYInvert,BABYLON.UserInputOptions.GamepadLStickSensibility=_.padLStickLevel,BABYLON.UserInputOptions.GamepadRStickSensibility=_.padRStickLevel,BABYLON.UserInputOptions.SupportedInputDevices=_.supportedDevices,BABYLON.UserInputOptions.PointerAngularSensibility=_.mouseSensitivity,BABYLON.UserInputOptions.PointerWheelDeadZone=_.wheelDeadZone,BABYLON.UserInputOptions.PointerMouseDeadZone=_.mouseDeadZone,BABYLON.UserInputOptions.PointerMouseInverted=_.mouseMoveInvert,BABYLON.UserInputOptions.UseCanvasElement=_.useCanvasElement,BABYLON.UserInputOptions.UseArrowKeyRotation=_.arrowKeyRotation}if(null!=r.enableinput){var b=r.enableinput;if(b===!0){var C=null==r.contextmenu||r.contextmenu,S=null!=r.pointerlock&&r.pointerlock,T=null!=r.preventdefault&&r.preventdefault,I=null!=r.usecapture&&r.usecapture,M={contextMenu:C,pointerLock:S,preventDefault:T,useCapture:I};BABYLON.InputController&&BABYLON.InputController.ConfigureUserInput(t,M)}}null!=r.freezeactivemeshes&&r.freezeactivemeshes===!0&&(this._activeMeshes=!0),null!=r.performancepriority&&(t.performancePriority=r.performancepriority)}},e.prototype.postProcessSceneProperties=function(e,t,n){var r=this;if(this._assetContainer!==!0&&null!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.properties&&t.extras.metadata.properties===!0){var o=t.extras.metadata;if(null!=o.skybox){var a=o.skybox,i=null!=a.skyfog&&a.skyfog,l=null!=a.skytags?a.skytags:"Untagged",s=null!=a.skysize?a.skysize:1e3,u=null!=a.rotation?a.rotation:0,d=null!=a.basename&&""!==a.basename?e+a.basename:null,p=null!=a.skyfaces?a.skyfaces:null,c=null!=a.rendergroup?a.rendergroup:0,m=null!=a.extensions&&a.extensions.length>0?a.extensions:null,h=null!=a.polynomial?a.polynomial:1;try{if(null!=p&&""!==p&&null!=d&&""!==d){var f=null;if("png"===p)f=new BABYLON.CubeTexture(d,n,m),d.indexOf("_rgbd")>=0?(f.isRGBD=!0,f.gammaSpace=!1):(f.isRGBD=!1,f.gammaSpace=!0);else if("jpg"===p)f=new BABYLON.CubeTexture(d,n,m),f.isRGBD=!1,f.gammaSpace=!0;else if("ktx2"===p)f=new BABYLON.CubeTexture(d,n,m),f.isRGBD=!1,f.gammaSpace=!0;else{var g=!0,y=d+"."+p;f=new BABYLON.CubeTexture(y,n,null,(!0),null,null,null,null,g),f.gammaSpace=!1}f.name=a.basename,f.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,f.rotationY=BABYLON.Tools.ToRadians(u);var v="Default Skybox",_=BABYLON.MeshBuilder.CreateBox(v,{size:s},n);_.renderingGroupId=BABYLON.Utilities.DefaultRenderGroup(),_.id=v,_.infiniteDistance=!0,_.applyFog=i,_.renderingGroupId=c,null!=l&&""!==l&&BABYLON.Tags.AddTagsTo(_,l),n.useRightHandedSystem===!0&&(_.scaling.x*=-1);var b=new BABYLON.StandardMaterial("Skybox-Material",n);b.backFaceCulling=!1,b.disableLighting=!0,b.diffuseColor=new BABYLON.Color3(0,0,0),b.emissiveColor=new BABYLON.Color3(0,0,0),b.specularColor=new BABYLON.Color3(0,0,0),b.ambientColor=new BABYLON.Color3(0,0,0),b.reflectionTexture=f,_.material=b}}catch(C){console.warn(C)}if(null!=a.environment){var S=a.environment;n.environmentIntensity=null!=S.level?BABYLON.Scalar.Clamp(S.level,0,10):1;var T=null!=S.info&&""!==S.info?S.info:null;if(null!=T&&""!==T)try{var I=BABYLON.SceneManager.GetRootUrl(n),M=I+T.rooturl,x=M+T.name;if(null!=this._assetsManager){var A=this._assetsManager.addBinaryFileTask("Global.EnvironmentTextureTask",x);A.onSuccess=function(e){if(null!=e.data){var t=new Blob([e.data]),n=r._babylonScene,o=URL.createObjectURL(t),a=function(){URL.revokeObjectURL(o)},i=new BABYLON.CubeTexture(o,n,null,null,null,a,a,null,(!0),".dds");n.environmentTexture=i,n.environmentTexture.name="assets/"+T.name,null!=n.environmentTexture&&null!=n.environmentTexture.sphericalPolynomial&&(n.isReady()?n.environmentTexture.sphericalPolynomial.scaleInPlace(h):n.onReadyObservable.addOnce(function(){n.environmentTexture.sphericalPolynomial.scaleInPlace(h)}))}else console.error("Failed to load environment texture task: "+x)},A.onError=function(e,t,n){console.error(t,n)}}}catch(O){console.warn(O)}}}if(null!=o.navigation&&null!=o.navigation.prebaked&&""!==o.navigation.prebaked){var w=null!=o.navigation.collision&&o.navigation.collision===!0,B=null!=o.navigation.showdebug&&o.navigation.showdebug===!0,P=null!=o.navigation.debugcolor?o.navigation.debugcolor:[.05,.225,.75],L=new BABYLON.Color3(P[0],P[1],P[2]),k=null!=o.navigation.timesteps?o.navigation.timesteps:0;if(null!=this._assetsManager){var N=o.navigation.prebaked,U=this._assetsManager.addBinaryFileTask("System.NavigationMeshTask",N);U.onSuccess=function(e){if(null!=e.data){var t=new Uint8Array(e.data);BABYLON.SceneManager.LoadNavigationMesh(n,t,B,L,k,w)}else console.error("Failed to load navigation mesh task: "+N)},U.onError=function(e,t,n){console.error(t,n)}}}}},e.prototype._preloadRawMaterialsAsync=function(e,t,n){var r=this._loader,o=new Array,a=BABYLON.Material.TriangleFillMode;return n.forEach(function(n){var i=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),t,n);if(null!=i){var l=r.createMaterial(e,i,a);BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(l,e),r._parent.onMaterialLoadedObservable.notifyObservers(l),o.push(r.loadMaterialPropertiesAsync(e,i,l))}}),Promise.all(o).then(function(){})},e.prototype._parseMultiMaterialAsync=function(e,t,n,r,o){var a=this;void 0===o&&(o=function(){});var i=this._loader,l=t;l._data=l._data||{};var s=l._data[r];if(!s){i.logOpen("".concat(e," ").concat(n.name||""));var u=[],d=new Array;t.forEach(function(t){var n=null;if(t.index){var o=t.index;o>=0&&(n=a._getCachedMaterialByIndex(o))}null==n&&(n=i.createMaterial(e,t,r),BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(n,e),i._parent.onMaterialLoadedObservable.notifyObservers(n),d.push(i.loadMaterialPropertiesAsync(e,t,n))),u.push(n)}),s={babylonMaterials:u,babylonMeshes:[],promises:d},l._data[r]=s,i.logClose()}return s.babylonMeshes.push(n),n.onDisposeObservable.addOnce(function(){var e=s.babylonMeshes.indexOf(n);e!==-1&&s.babylonMeshes.splice(e,1)}),o(s.babylonMaterials),Promise.all(s.promises).then(function(){return s.babylonMaterials})},e.prototype._parseNodeMaterialPropertiesAsync=function(e,t,n){var r=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,o=n,a=new Array;o.backFaceCulling=null==r||null==r.backFaceCulling||r.backFaceCulling,t.doubleSided&&(o.backFaceCulling=!1);var i=1;if(t.pbrMetallicRoughness){var l=t.pbrMetallicRoughness;if(l){if(l.baseColorFactor){var s=BABYLON.Color4.FromArray(l.baseColorFactor);o.setVector4("_Color",new BABYLON.Vector4(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2),s.a)),i=s.a}else o.setVector4("_Color",new BABYLON.Vector4(1,1,1,1));l.baseColorTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),l.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)");var t=e;t.level=null!=r&&null!=r.diffuseIntensity?r.diffuseIntensity:1,o.setTexture("_MainTex",t)}))}}if(t.normalTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)");var r=e;void 0!=t.normalTexture.scale&&(r.level=t.normalTexture.scale),o.setTexture("_BumpMap",r)})),t.occlusionTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)");var r=e;void 0!=t.occlusionTexture.strength&&(r.level=t.occlusionTexture.strength),o.setTexture("_OcclusionMap",r)})),t.emissiveFactor){var u=BABYLON.Color4.FromArray(t.emissiveFactor);(u.r>0||u.g>0||u.b>0)&&o.setVector4("_EmissionColor",new BABYLON.Vector4(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2),u.a))}if(t.emissiveTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)");var t=e;o.setTexture("_EmissionMap",t)})),null!=r){if(o.wireframe=null!=r.useWireframe&&r.useWireframe,o.needDepthPrePass=null!=r.depthPrepass&&r.depthPrepass,r.customTextures){var d=function(t){var i=r.customTextures[t];null!=i&&a.push(p._loader.loadTextureInfoAsync(e+"/"+t,i,function(e){"detailsSampler"===t||"normalsSampler"===t?e.name="".concat(n.name," (Atlas)"):e.name="".concat(n.name," (Custom)"),o.setTexture(t,e)}))},p=this;for(var c in r.customTextures)d(c)}if(r.customVectors)for(var m in r.customVectors){var h=r.customVectors[m];null!=h&&o.setVector4(m,BABYLON.Vector4.FromArray(h))}if(r.customColors)for(var f in r.customColors){var g=r.customColors[f];null!=g&&o.setVector4(f,BABYLON.Vector4.FromArray(g))}if(r.customFloats)for(var y in r.customFloats){var v=r.customFloats[y];null!=v&&o.setFloat(y,v)}null!=r.freezeMaterial&&r.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(o)}var _=Promise.all(a).then(function(){});return o.compile(),_},e.prototype._parseShaderMaterialPropertiesAsync=function(e,t,n){var r=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,o=n,a=new Array;o.backFaceCulling=null==r||null==r.backFaceCulling||r.backFaceCulling,t.doubleSided&&(o.backFaceCulling=!1),BABYLON.Utilities.HasOwnProperty(o,"ambientColor")&&(o.ambientColor=null!=r&&r.ambientColorFactor?BABYLON.Color3.FromArray(r.ambientColorFactor):BABYLON.Color3.Black());var i=1;if(t.pbrMetallicRoughness){var l=t.pbrMetallicRoughness;if(l){if(l.baseColorFactor){var s=BABYLON.Color4.FromArray(l.baseColorFactor);o.setVector4("diffuseColor",new BABYLON.Vector4(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2),s.a)),i=s.a}else o.setVector4("diffuseColor",new BABYLON.Vector4(1,1,1,1));l.baseColorTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),l.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)");var t=e;t.level=null!=r&&null!=r.diffuseIntensity?r.diffuseIntensity:1,o.setTexture("diffuseTexture",t)}))}}if(t.normalTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)");var r=e;void 0!=t.normalTexture.scale&&(r.level=t.normalTexture.scale),o.setTexture("bumpTexture",r)})),t.occlusionTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)");var r=e;void 0!=t.occlusionTexture.strength&&(r.level=t.occlusionTexture.strength),o.setTexture("ambientTexture",r)})),t.emissiveFactor){var u=BABYLON.Color4.FromArray(t.emissiveFactor);(u.r>0||u.g>0||u.b>0)&&o.setVector4("emissiveColor",new BABYLON.Vector4(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2),u.a))}t.emissiveTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)");var t=e;o.setTexture("emissiveTexture",t)})),o.alpha=i;var d=t.alphaMode||"OPAQUE";switch(d){case"OPAQUE":o.alpha=1,o.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_OPAQUE;break;case"MASK":o.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHATEST;break;case"BLEND":o.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHABLEND;break;default:throw new Error("".concat(e,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}if(null!=r){if(o.wireframe=null!=r.useWireframe&&r.useWireframe,o.needDepthPrePass=null!=r.depthPrepass&&r.depthPrepass,r.customTextures){var p=function(t){var i=r.customTextures[t];null!=i&&a.push(c._loader.loadTextureInfoAsync(e+"/"+t,i,function(e){"detailsSampler"===t||"normalsSampler"===t?e.name="".concat(n.name," (Atlas)"):e.name="".concat(n.name," (Custom)"),o.setTexture(t,e)}))},c=this;for(var m in r.customTextures)p(m)}if(r.customVectors)for(var h in r.customVectors){var f=r.customVectors[h];null!=f&&o.setVector4(h,BABYLON.Vector4.FromArray(f))}if(r.customColors)for(var g in r.customColors){var y=r.customColors[g];null!=y&&o.setVector4(g,BABYLON.Vector4.FromArray(y))}if(r.customFloats)for(var v in r.customFloats){var _=r.customFloats[v];null!=_&&o.setFloat(v,_)}null!=r.freezeMaterial&&r.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(o)}return Promise.all(a).then(function(){})},e.prototype._parseDiffuseMaterialPropertiesAsync=function(e,t,n){var r=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,o=n,a=new Array;BABYLON.Utilities.HasOwnProperty(o,"ambientColor")&&(o.ambientColor=null!=r&&r.ambientColorFactor?BABYLON.Color3.FromArray(r.ambientColorFactor):BABYLON.Color3.Black()),BABYLON.Utilities.HasOwnProperty(o,"backFaceCulling")&&(o.backFaceCulling=null==r||null==r.backFaceCulling||r.backFaceCulling),t.doubleSided&&(BABYLON.Utilities.HasOwnProperty(o,"twoSidedLighting")&&(o.twoSidedLighting=!0),BABYLON.Utilities.HasOwnProperty(o,"backFaceCulling")&&(o.backFaceCulling=!1));var i=1;if(t.pbrMetallicRoughness){var l=t.pbrMetallicRoughness;if(l){if(BABYLON.Utilities.HasOwnProperty(o,"diffuseColor"))if(l.baseColorFactor){var s=BABYLON.Color4.FromArray(l.baseColorFactor);o.diffuseColor=new BABYLON.Color3(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2)),i=s.a}else o.diffuseColor=BABYLON.Color3.White();BABYLON.Utilities.HasOwnProperty(o,"diffuseTexture")&&l.baseColorTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),l.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)"),o.diffuseTexture=e,o.diffuseTexture.level=null!=r&&null!=r.diffuseIntensity?r.diffuseIntensity:1}))}}if(BABYLON.Utilities.HasOwnProperty(o,"bumpTexture")&&t.normalTexture&&(a.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)"),o.bumpTexture=e,void 0!=t.normalTexture.scale&&(o.bumpTexture.level=t.normalTexture.scale)})),BABYLON.Utilities.HasOwnProperty(o,"invertNormalMapX")&&(o.invertNormalMapX=!this._loader.babylonScene.useRightHandedSystem),BABYLON.Utilities.HasOwnProperty(o,"invertNormalMapY")&&(o.invertNormalMapY=this._loader.babylonScene.useRightHandedSystem)),BABYLON.Utilities.HasOwnProperty(o,"ambientTexture")&&t.occlusionTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)"),o.ambientTexture=e,void 0!=t.occlusionTexture.strength&&(o.ambientTexture.level=t.occlusionTexture.strength)})),BABYLON.Utilities.HasOwnProperty(o,"emissiveColor")){var u=t.emissiveFactor?BABYLON.Color4.FromArray(t.emissiveFactor):new BABYLON.Color4(0,0,0,1);o.emissiveColor=new BABYLON.Color3(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2))}BABYLON.Utilities.HasOwnProperty(o,"emissiveTexture")&&t.emissiveTexture&&a.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)"),o.emissiveTexture=e,BABYLON.Utilities.HasOwnProperty(o,"useEmissiveAsIllumination")&&(o.useEmissiveAsIllumination=null!=r&&null!=r.useEmissiveAsIllumination&&r.useEmissiveAsIllumination)})),BABYLON.Utilities.HasOwnProperty(o,"alpha")&&(o.alpha=i);var d=t.alphaMode||"OPAQUE";switch(d){case"OPAQUE":BABYLON.Utilities.HasOwnProperty(o,"alpha")&&(o.alpha=1);break;case"MASK":o.alphaCutOff=void 0==t.alphaCutoff?.5:t.alphaCutoff,o.diffuseTexture&&BABYLON.Utilities.HasOwnProperty(o,"diffuseTexture")&&(o.diffuseTexture.hasAlpha=!0);break;case"BLEND":o.diffuseTexture&&(BABYLON.Utilities.HasOwnProperty(o,"diffuseTexture")&&(o.diffuseTexture.hasAlpha=!0),BABYLON.Utilities.HasOwnProperty(o,"useAlphaFromDiffuseTexture")&&(o.useAlphaFromDiffuseTexture=!0));break;default:throw new Error("".concat(e,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}return this._parseCommonConstantProperties(a,e,t,n),Promise.all(a).then(function(){})},e.prototype._parseCommonConstantProperties=function(e,t,n,r){var o=this,a=null!=n.extras&&null!=n.extras.metadata?n.extras.metadata:null;if(null!=a){var i=r;if(BABYLON.Utilities.HasOwnProperty(i,"alphaMode")&&(i.alphaMode=null!=a&&a.alphaMode?a.alphaMode:BABYLON.Engine.ALPHA_COMBINE),BABYLON.Utilities.HasOwnProperty(i,"ambientColor")&&(i.ambientColor=null!=a&&a.ambientColorFactor?BABYLON.Color3.FromArray(a.ambientColorFactor):BABYLON.Color3.Black()),BABYLON.Utilities.HasOwnProperty(i,"backFaceCulling")&&(i.backFaceCulling=null==a||null==a.backFaceCulling||a.backFaceCulling),r instanceof BABYLON.PBRMaterial&&(r.useMetallnessFromMetallicTextureBlue=!0,r.useRoughnessFromMetallicTextureGreen=!0,r.useRoughnessFromMetallicTextureAlpha=!1,r.useAmbientOcclusionFromMetallicTextureRed=!1,r.directIntensity=null!=a.directIntensity?a.directIntensity:1,r.specularIntensity=null!=a.specularIntensity?a.specularIntensity:1,r.emissiveIntensity=null!=a.emissiveIntensity?a.emissiveIntensity:1,r.environmentIntensity=null!=a.environmentIntensity?a.environmentIntensity:1,r.indexOfRefraction=null!=a.indexOfRefraction?a.indexOfRefraction:1.5,null!=a.useAlphaFromAlbedoTexture&&(r.useAlphaFromAlbedoTexture=a.useAlphaFromAlbedoTexture),null!=a.parallaxBias&&a.parallaxBias>0&&(r.useParallax=!0,r.parallaxScaleBias=.9*a.parallaxBias,r.useParallaxOcclusion=null==a.parallaxOcclusion||a.parallaxOcclusion,r.useParallaxOcclusion===!0&&(r.parallaxScaleBias*=.5))),BABYLON.Utilities.HasOwnProperty(i,"unlit")&&(i.unlit=null!=a.unlitMaterial&&a.unlitMaterial),BABYLON.Utilities.HasOwnProperty(i,"wireframe")&&(i.wireframe=null!=a.useWireframe&&a.useWireframe),BABYLON.Utilities.HasOwnProperty(i,"disableLighting")&&(i.disableLighting=null!=a.disableLighting&&a.disableLighting),BABYLON.Utilities.HasOwnProperty(i,"maxSimultaneousLights")&&(i.maxSimultaneousLights=null!=a.maxSimultaneousLights?a.maxSimultaneousLights:4),BABYLON.Utilities.HasOwnProperty(i,"needDepthPrePass")&&(i.needDepthPrePass=null!=a.depthPrepass&&a.depthPrepass),BABYLON.Utilities.HasOwnProperty(i,"lightmapTexture")&&a.lightmapTexture){a.lightmapTexture.nonColorData=!0;var l=!0;BABYLON.Utilities.HasOwnProperty(i,"useLightmapAsShadowmap")&&(l=null==a.useLightmapAsShadowmap||a.useLightmapAsShadowmap);var s=null,u=null!=a.lightmapTexture.index?a.lightmapTexture.index:-1;u>=0&&(s=this._getCachedLightmapByIndex(u)),null!=s?(i.lightmapTexture=s,i.useLightmapAsShadowmap=l,BABYLON.Utilities.HasOwnProperty(i,"ambientColor")&&(i.ambientColor=BABYLON.Color3.White())):e.push(this._loader.loadTextureInfoAsync(t+"/lightmapTexture",a.lightmapTexture,function(e){e.name="assets/LightmapTexture-".concat(u),e.level=a.lightmapLevel?a.lightmapLevel:1;var t=e,n=null!=BABYLON.SceneManager.GlobalOptions.ktxlightmaps&&BABYLON.SceneManager.GlobalOptions.ktxlightmaps===!0;n===!0?e.gammaSpace=!0:(e.gammaSpace=!1,t.onLoadObservable.addOnce(function(){t.isReady()?t.isRGBD=!0:BABYLON.Tools.Warn("Failed to register texture as RGBD: "+t.name);
})),i.lightmapTexture=e,u>=0&&null!=o._lightmapMap&&(o._lightmapMap.has(u)||o._lightmapMap.set(u,t)),i.useLightmapAsShadowmap=l,BABYLON.Utilities.HasOwnProperty(i,"ambientColor")&&(i.ambientColor=BABYLON.Color3.White())}))}r instanceof BABYLON.PBRMaterial&&a.detailMapTexture&&e.push(this._loader.loadTextureInfoAsync(t+"/detailMapTexture",a.detailMapTexture,function(e){e.name="".concat(r.name," (Detail Map)"),e.level=1,r.detailMap.texture=e,r.detailMap.bumpLevel=a.detailBumpLevel?a.detailBumpLevel:1,r.detailMap.diffuseBlendLevel=a.detailBlendLevel?a.detailBlendLevel:.75,r.detailMap.roughnessBlendLevel=a.detailRoughLevel?a.detailRoughLevel:.5,r.detailMap.isEnabled=!0}));var d=BABYLON.SceneManager.GetRenderQuality(),p=d===BABYLON.RenderQuality.High||d===BABYLON.RenderQuality.Medium;if(p===!0&&BABYLON.Utilities.HasOwnProperty(i,"reflectionColor")&&(i.reflectionColor=null!=a&&a.reflectionColorFactor?BABYLON.Color3.FromArray(a.reflectionColorFactor):BABYLON.Color3.White()),p===!0&&BABYLON.Utilities.HasOwnProperty(i,"reflectionTexture")&&a.reflectionCubemapInfo){var c=this._loader._rootUrl,m=(c+a.reflectionCubemapInfo.rooturl+a.reflectionCubemapInfo.name).toLowerCase(),h=m.lastIndexOf("."),f=h>-1?m.substring(h).toLowerCase():"",g=!0,y=new CubeTextureLoader;y.name="assets/"+a.reflectionCubemapInfo.name,y.mapkey=m,y.material=i,y.extension=f,y.prefiltered=g,a.reflectionCubemapInfo.boundingBoxSize&&(y.boundingBoxSize=BABYLON.Vector3.FromArray(a.reflectionCubemapInfo.boundingBoxSize),y.name+=" ("+y.boundingBoxSize.x.toString()+" "+y.boundingBoxSize.y.toString()+" "+y.boundingBoxSize.z.toString()+")",y.mapkey+="_"+y.boundingBoxSize.x.toString()+"_"+y.boundingBoxSize.y.toString()+"_"+y.boundingBoxSize.z.toString()),a.reflectionCubemapInfo.boundingBoxPosition&&(y.boundingBoxPosition=BABYLON.Vector3.FromArray(a.reflectionCubemapInfo.boundingBoxPosition),y.name+=" ("+y.boundingBoxPosition.x.toString()+" "+y.boundingBoxPosition.y.toString()+" "+y.boundingBoxPosition.z.toString()+")",y.mapkey+="_"+y.boundingBoxPosition.x.toString()+"_"+y.boundingBoxPosition.y.toString()+"_"+y.boundingBoxPosition.z.toString());var v=this._reflectionMap[m];null==v?(v=[y],this._reflectionMap[m]=v):v.push(y)}if(BABYLON.Utilities.HasOwnProperty(i,"terrainInfo")&&(i.terrainInfo=null!=a.terrainInfo?a.terrainInfo:null),BABYLON.Utilities.HasOwnProperty(r,"universalMaterial")){var _=r;if(a.customTextures){var b=function(n){var o=a.customTextures[n];null!=o&&(_.checkSampler(n),e.push(C._loader.loadTextureInfoAsync(t+"/"+n,o,function(e){"detailsSampler"===n||"normalsSampler"===n?e.name="".concat(r.name," (Atlas)"):e.name="".concat(r.name," (Custom)"),_.setTexture(n,e,!0)})))},C=this;for(var S in a.customTextures)b(S)}if(a.customVectors)for(var T in a.customVectors){var I=a.customVectors[T];null!=I&&_.setVector4(T,BABYLON.Vector4.FromArray(I),!0)}if(a.customColors)for(var M in a.customColors){var x=a.customColors[M];null!=x&&_.setVector4(M,BABYLON.Vector4.FromArray(x),!0)}if(a.customFloats)for(var A in a.customFloats){var O=a.customFloats[A];null!=O&&_.setFloat(A,O,!0)}}else{if(a.customTextures){var w=function(n){var o=a.customTextures[n];null!=o&&BABYLON.Utilities.HasOwnProperty(i,n)&&e.push(B._loader.loadTextureInfoAsync(t+"/"+n,o,function(e){"detailsSampler"===n||"normalsSampler"===n?e.name="".concat(r.name," (Atlas)"):e.name="".concat(r.name," (Custom)"),i[n]=e}))},B=this;for(var S in a.customTextures)w(S)}if(a.customVectors)for(var T in a.customVectors){var I=a.customVectors[T];null!=I&&BABYLON.Utilities.HasOwnProperty(i,T)&&(i[T]=BABYLON.Vector4.FromArray(I))}if(a.customColors)for(var M in a.customColors){var x=a.customColors[M];null!=x&&BABYLON.Utilities.HasOwnProperty(i,M)&&(i[M]instanceof BABYLON.Vector4?i[M]=BABYLON.Vector4.FromArray(x):i[M]instanceof BABYLON.Color4?i[M]=BABYLON.Color4.FromArray(x):i[M]=BABYLON.Color3.FromArray(x))}if(a.customFloats)for(var A in a.customFloats){var O=a.customFloats[A];null!=O&&BABYLON.Utilities.HasOwnProperty(i,A)&&(i[A]instanceof Boolean?i[A]=O>0:i[A]=O)}}null!=a.freezeMaterial&&a.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(r)}},e}(),CVTOOLS_babylon_mesh=function(){function e(e){this.name=CVTOOLS_MESH,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_MESH),this.order=101}return e.prototype.dispose=function(){delete this._loader},e}(),CVTOOLS_left_handed=function(){function e(e){this.name=CVTOOLS_HAND,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_HAND),this.order=102}return e.prototype.dispose=function(){delete this._loader},e}();BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_NAME,function(e){return new CVTOOLS_unity_metadata(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_MESH,function(e){return new CVTOOLS_babylon_mesh(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_HAND,function(e){return new CVTOOLS_left_handed(e)}),BABYLON.SceneLoader.OnPluginActivatedObservable.add(function(e){"gltf"===e.name&&e instanceof BABYLON.GLTFFileLoader&&(e.animationStartMode=BABYLON.SceneManager.AnimationStartMode,e.targetFps=BABYLON.SceneManager.AnimationTargetFps,e.onSkinLoadedObservable.add(function(e){if(null!=e){try{null!=e.skinnedNode&&(e.skinnedNode.id+=".Skin")}catch(t){console.warn(t)}try{null!=e.skinnedNode&&(e.skinnedNode.name+=".Skin")}catch(n){console.warn(n)}try{if(null!=e.node&&null!=e.skinnedNode){var r=BABYLON.Tags.GetTags(e.node);null!=r&&BABYLON.Tags.AddTagsTo(e.skinnedNode,r),e.node._skinnedMesh=e.skinnedNode}}catch(o){console.warn(o)}}}))});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BABYLON;!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n._looptime=!1,n._loopblend=!1,n._frametime=0,n._layercount=0,n._updatemode=0,n._hasrootmotion=!1,n._animationplaying=!1,n._initialtargetblending=!1,n._hastransformhierarchy=!1,n._leftfeetbottomheight=0,n._rightfeetbottomheight=0,n._runtimecontroller=null,n._executed=!1,n._awakened=!1,n._initialized=!1,n._checkers=new e.TransitionCheck,n._source="",n._machine=null,n._animationmode=0,n._animationrig=null,n._deltaPosition=new e.Vector3(0,0,0),n._deltaRotation=new e.Quaternion(0,0,0,0),n._angularVelocity=new e.Vector3(0,0,0),n._rootMotionSpeed=0,n._lastMotionSpeed=0,n._loopMotionSpeed=0,n._lastRotateSpeed=0,n._loopRotateSpeed=0,n._lastMotionRotation=new e.Quaternion(0,0,0,0),n._lastMotionPosition=new e.Vector3(0,0,0),n._positionWeight=!1,n._rootBoneWeight=!1,n._rotationWeight=!1,n._rootQuatWeight=!1,n._rootBoneTransform=null,n._positionHolder=new e.Vector3(0,0,0),n._rootBoneHolder=new e.Vector3(0,0,0),n._rotationHolder=new e.Quaternion(0,0,0,0),n._rootQuatHolder=new e.Quaternion(0,0,0,0),n._rootMotionMatrix=e.Matrix.Zero(),n._rootMotionScaling=new e.Vector3(0,0,0),n._rootMotionRotation=new e.Quaternion(0,0,0,0),n._rootMotionPosition=new e.Vector3(0,0,0),n._dirtyMotionMatrix=null,n._dirtyBlenderMatrix=null,n._targetPosition=new e.Vector3(0,0,0),n._targetRotation=new e.Quaternion(0,0,0,0),n._targetScaling=new e.Vector3(1,1,1),n._updateMatrix=e.Matrix.Zero(),n._blenderMatrix=e.Matrix.Zero(),n._blendWeights=new e.BlendingWeights,n._emptyScaling=new e.Vector3(1,1,1),n._emptyPosition=new e.Vector3(0,0,0),n._emptyRotation=new e.Quaternion(0,0,0,0),n._ikFrameEanbled=!1,n._data=new Map,n._anims=new Map,n._clips=null,n._timers=new Map,n._starts=new Map,n._stops=new Map,n._numbers=new Map,n._booleans=new Map,n._triggers=new Map,n._parameters=new Map,n.speedRatio=1,n.delayUpdateUntilReady=!0,n.enableAnimation=!0,n.applyRootMotion=!1,n.onAnimationAwakeObservable=new e.Observable,n.onAnimationInitObservable=new e.Observable,n.onAnimationIKObservable=new e.Observable,n.onAnimationEndObservable=new e.Observable,n.onAnimationLoopObservable=new e.Observable,n.onAnimationEventObservable=new e.Observable,n.onAnimationUpdateObservable=new e.Observable,n.onAnimationTransitionObservable=new e.Observable,n.m_zeroVector=new e.Vector3(0,0,0),n.m_defaultGroup=null,n.m_animationTargets=null,n.m_rotationIdentity=new e.Quaternion(0,0,0,0),n.sourceAnimationGroups=null,n}return __extends(n,t),n.prototype.awakened=function(){return this._awakened},n.prototype.initialized=function(){return this._initialized},n.prototype.hasRootMotion=function(){return this._hasrootmotion},n.prototype.isFirstFrame=function(){return 0===this._frametime},n.prototype.isLastFrame=function(){return this._frametime>=.985},n.prototype.ikFrameEnabled=function(){return this._ikFrameEanbled},n.prototype.getAnimationTime=function(){return this._frametime},n.prototype.getFrameLoopTime=function(){return this._looptime},n.prototype.getFrameLoopBlend=function(){return this._loopblend},n.prototype.getAnimationPlaying=function(){return this._animationplaying},n.prototype.getRuntimeController=function(){return this._runtimecontroller},n.prototype.getRootBoneTransform=function(){return this._rootBoneTransform},n.prototype.getDeltaRootMotionAngle=function(){return this._angularVelocity.y},n.prototype.getDeltaRootMotionSpeed=function(){return this._rootMotionSpeed},n.prototype.getDeltaRootMotionPosition=function(){return this._deltaPosition},n.prototype.getDeltaRootMotionRotation=function(){return this._deltaRotation},n.prototype.getFixedRootMotionPosition=function(){return null!=this._dirtyMotionMatrix?this._rootMotionPosition:null},n.prototype.getFixedRootMotionRotation=function(){return null!=this._dirtyMotionMatrix?this._rootMotionRotation:null},n.prototype.awake=function(){this.awakeStateMachine()},n.prototype.update=function(){this.updateStateMachine()},n.prototype.destroy=function(){this.destroyStateMachine()},n.prototype.playDefaultAnimation=function(t,n,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=null);var o=!1;if(this._initialized===!0)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>n){var a=this._machine.layers[n],i=null!=a.animationStateMachine?a.animationStateMachine.rate||e.AnimationState.FPS:e.AnimationState.FPS,l=t>0?e.Utilities.ComputeBlendingSpeed(r||i,t):0;this.playCurrentAnimationState(a,a.entry,l),o=!0}else e.Tools.Warn("No animation state layers on "+this.transform.name);else e.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return o},n.prototype.playAnimation=function(t,n,r,o){void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=null);var a=!1;if(this._initialized===!0)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>r){var i=this._machine.layers[r],l=null!=i.animationStateMachine?i.animationStateMachine.rate||e.AnimationState.FPS:e.AnimationState.FPS,s=n>0?e.Utilities.ComputeBlendingSpeed(o||l,n):0;this.playCurrentAnimationState(i,t,s),a=!0}else e.Tools.Warn("No animation state layers on "+this.transform.name);else e.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return a},n.prototype.stopAnimation=function(t){void 0===t&&(t=0);var n=!1;if(this._initialized===!0)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>t){var r=this._machine.layers[t];this.stopCurrentAnimationState(r),n=!0}else e.Tools.Warn("No animation state layers on "+this.transform.name);else e.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return n},n.prototype.hasBool=function(e){return null!=this._booleans.get(e)},n.prototype.getBool=function(e){return this._booleans.get(e)||!1},n.prototype.setBool=function(e,t){this._booleans.set(e,t)},n.prototype.hasFloat=function(e){return null!=this._numbers.get(e)},n.prototype.getFloat=function(e){return this._numbers.get(e)||0},n.prototype.setFloat=function(e,t){this._numbers.set(e,t)},n.prototype.hasInteger=function(e){return null!=this._numbers.get(e)},n.prototype.getInteger=function(e){return this._numbers.get(e)||0},n.prototype.setInteger=function(e,t){this._numbers.set(e,t)},n.prototype.hasTrigger=function(e){return null!=this._triggers.get(e)},n.prototype.getTrigger=function(e){return this._triggers.get(e)||!1},n.prototype.setTrigger=function(e){this._triggers.set(e,!0)},n.prototype.resetTrigger=function(e){this._triggers.set(e,!1)},n.prototype.setSmoothFloat=function(t,n,r,o){var a=this._timers.get(t)||-1,i=this._starts.get(t)||null,l=this._stops.get(t)||null;if(null!=l&&null!=n&&l!=n&&(a=-1),a<0&&(a=0,i=null,l=null),null==i&&(i=this.getFloat(t)),null==l&&(l=n),a>=0&&null!=i&&null!=l){var s=0;a<r?(s=e.Scalar.Lerp(i,l,a/r),a+=o):(s=l,a=-1,i=null,l=null),this._numbers.set(t,s)}this._timers.set(t,a),this._starts.set(t,i),this._stops.set(t,l)},n.prototype.setSmoothInteger=function(e,t,n,r){this.setSmoothFloat(e,t,n,r)},n.prototype.resetSmoothProperty=function(e){this._timers["delete"](e),this._starts["delete"](e),this._stops["delete"](e),this._numbers["delete"](e)},n.prototype.getMachineState=function(e){return this._data.get(e)},n.prototype.setMachineState=function(e,t){this._data.set(e,t)},n.prototype.getCurrentState=function(e){return null!=this._machine.layers&&this._machine.layers.length>e?this._machine.layers[e].animationStateMachine:null},n.prototype.getDefaultClips=function(){return this._clips},n.prototype.getDefaultSource=function(){return this._source},n.prototype.fixAnimationGroup=function(e){var t=null;if(null!=this._clips&&this._clips.length>0)for(var n=0;n<this._clips.length;n++){var r=this._clips[n];if(null!=r.clip){var o=("."+r.clip).toLowerCase();if(e.name.toLowerCase().endsWith(o)){null==e.metadata&&(e.metadata={}),null==e.metadata.unity&&(e.metadata.unity=r),e.metadata.unity.source=this._source,t=r;break}}}return t},n.prototype.getAnimationGroup=function(e){return this._anims.get(e)},n.prototype.getAnimationGroups=function(){return this.sourceAnimationGroups},n.prototype.setAnimationGroups=function(e){null==this.transform.metadata&&(this.transform.metadata={}),null==this.transform.metadata.unity&&(this.transform.metadata.unity={}),this.transform.metadata.unity.sourceAnimationGroups=e,this.setupSourceAnimationGroups()},n.prototype.updateAnimationGroups=function(t){var n=this;null!=t&&t.length>0&&(this._anims=new Map,this.m_animationTargets=[],this.m_defaultGroup=null,this.sourceAnimationGroups=null,t.forEach(function(t){var r=!1,o=t;if(null!=o&&null!=o.metadata&&null!=o.metadata.unity&&null!=o.metadata.unity.source&&""!==o.metadata.unity.source&&o.metadata.unity.source===n._source&&(r=!0),r===!0&&null!=o&&null!=o.metadata&&null!=o.metadata.unity&&null!=o.metadata.unity.clip&&""!==o.metadata.unity.clip){try{t.stop()}catch(a){}null==n.sourceAnimationGroups&&(n.sourceAnimationGroups=[]),n.sourceAnimationGroups.push(t),n._anims.set(o.metadata.unity.clip,t),null==n.m_defaultGroup&&(n.m_defaultGroup=t),null!=t.targetedAnimations&&t.targetedAnimations.length>0&&t.targetedAnimations.forEach(function(t){for(var r=-1,o=0;o<n.m_animationTargets.length;o++)if(n.m_animationTargets[o].target===t.target){r=o;break}if(r<0)if(n.m_animationTargets.push(t),null==t.target.metadata&&(t.target.metadata={}),t.target instanceof e.TransformNode){e.Utilities.ValidateTransformQuaternion(t.target);for(var a=[],i=0;i<n._layercount;i++){var l=new e.AnimationMixer;l.positionBuffer=null,l.rotationBuffer=null,l.scalingBuffer=null,l.originalMatrix=null,l.blendingFactor=0,l.blendingSpeed=0,l.rootPosition=null,l.rootRotation=null,a.push(l)}t.target.metadata.mixer=a}else if(t.target instanceof e.MorphTarget){for(var s=[],i=0;i<n._layercount;i++){var u=new e.AnimationMixer;u.influenceBuffer=null,s.push(u)}t.target.metadata.mixer=s}})}}))},n.prototype.awakeStateMachine=function(){var t=this;if(e.Utilities.ValidateTransformQuaternion(this.transform),this.m_animationTargets=[],this.m_defaultGroup=null,this.m_rotationIdentity=e.Quaternion.Identity(),this._source=null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.animator&&""!==this.transform.metadata.unity.animator?this.transform.metadata.unity.animator:null,this._clips=this.getProperty("clips",this._clips),this._machine=this.getProperty("machine",this._machine),this._updatemode=this.getProperty("updatemode",this._updatemode),this._animationrig=this.getProperty("animationrig",this._animationrig),this._animationmode=this.getProperty("animationmode",this._animationmode),this._hasrootmotion=this.getProperty("hasrootmotion",this._hasrootmotion),this._runtimecontroller=this.getProperty("runtimecontroller",this._runtimecontroller),this._hastransformhierarchy=this.getProperty("hastransformhierarchy",this._hastransformhierarchy),this._leftfeetbottomheight=this.getProperty("leftfeetbottomheight",this._leftfeetbottomheight),this._rightfeetbottomheight=this.getProperty("rightfeetbottomheight",this._rightfeetbottomheight),this.applyRootMotion=this.getProperty("applyrootmotion",this.applyRootMotion),null!=this._machine){if(null!=this._machine.owner&&void 0!=this._machine.owner&&""!==this._machine.owner&&"*"!==this._machine.owner||(this._machine.owner=null!=this.transform.parent?this.transform.parent.name:this.transform.name),null!=this._machine.speed&&(this.speedRatio=this._machine.speed),null!=this._machine.parameters&&this._machine.parameters.length>0){var n=this._machine.parameters;n.forEach(function(n){var r=n.name,o=n.type,a=(n.curve,n.defaultFloat),i=n.defaultBool,l=n.defaultInt;t._parameters.set(r,o),o===e.AnimatorParameterType.Bool?t.setBool(r,i):o===e.AnimatorParameterType.Float?t.setFloat(r,a):o===e.AnimatorParameterType.Int?t.setInteger(r,l):o===e.AnimatorParameterType.Trigger&&t.resetTrigger(r)})}null!=this._machine.layers&&this._machine.layers.length>0&&(this._layercount=this._machine.layers.length,this._machine.layers.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this._machine.layers.forEach(function(e){if(null==e.owner||void 0==e.owner||""===e.owner||"*"===e.owner,e.animationMaskMap=new Map,null!=e.avatarMask&&null!=e.avatarMask.transformPaths&&e.avatarMask.transformPaths.length>0)for(var t=0;t<e.avatarMask.transformPaths.length;t++)e.animationMaskMap.set(e.avatarMask.transformPaths[t],t)}))}this._awakened=!0,this.onAnimationAwakeObservable&&this.onAnimationAwakeObservable.hasObservers()&&this.onAnimationAwakeObservable.notifyObservers(this.transform)},n.prototype.updateStateMachine=function(e){var t=this;if(void 0===e&&(e=null),(this.delayUpdateUntilReady===!1||this.delayUpdateUntilReady===!0&&this.isReady())&&(null==this.sourceAnimationGroups&&this.setupSourceAnimationGroups(),null!=this.sourceAnimationGroups&&(this._executed===!1&&(this._executed=!0,null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(e){t.playCurrentAnimationState(e,e.entry,0)}),this._initialized=!0,this.onAnimationInitObservable&&this.onAnimationInitObservable.hasObservers()&&this.onAnimationInitObservable.notifyObservers(this.transform)),this.enableAnimation===!0))){var n=e||this.getDeltaSeconds();this.updateAnimationState(n),this.updateAnimationTargets(n),this.onAnimationUpdateObservable&&this.onAnimationUpdateObservable.hasObservers()&&this.onAnimationUpdateObservable.notifyObservers(this.transform)}},n.prototype.setupSourceAnimationGroups=function(){var t=this,n=null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.sourceAnimationGroups?this.transform.metadata.unity.sourceAnimationGroups:null;null!=n&&(this.updateAnimationGroups(n),null!=this.sourceAnimationGroups&&null!=this._machine&&null!=this._machine.states&&this._machine.states.length>0&&this._machine.states.forEach(function(n){null!=n&&null!=n.name&&(null!=n.ccurves&&n.ccurves.length>0&&n.ccurves.forEach(function(t){if(null!=t.animation){var r=e.Animation.Parse(t.animation);null!=r&&(null==n.tcurves&&(n.tcurves=[]),n.tcurves.push(r))}}),t.setupTreeBranches(n.blendtree),t.setMachineState(n.name,n))}))},n.prototype.destroyStateMachine=function(){this._data=null,this._clips=null,this._anims=null,this._numbers=null,this._booleans=null,this._triggers=null,this._parameters=null,this._checkers=null,this._machine=null,this.sourceAnimationGroups=null,this.onAnimationAwakeObservable.clear(),this.onAnimationAwakeObservable=null,this.onAnimationInitObservable.clear(),this.onAnimationInitObservable=null,this.onAnimationIKObservable.clear(),this.onAnimationIKObservable=null,this.onAnimationEndObservable.clear(),this.onAnimationEndObservable=null,this.onAnimationLoopObservable.clear(),this.onAnimationLoopObservable=null,this.onAnimationEventObservable.clear(),this.onAnimationEventObservable=null,this.onAnimationUpdateObservable.clear(),this.onAnimationUpdateObservable=null,this.onAnimationTransitionObservable.clear(),this.onAnimationTransitionObservable=null},n.prototype.updateAnimationState=function(e){var t=this;null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(n){t.checkStateMachine(n,e)})},n.prototype.updateAnimationTargets=function(t){var n=this;this._looptime=!1,this._loopblend=!1,this._ikFrameEanbled=!1,this._animationplaying=!1,null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(r){if(0===r.index&&(n._frametime=r.animationTime),null!=r.animationStateMachine&&null!=r.animationStateMachine.blendtree){r.animationStateMachine.iKOnFeet===!0&&(n._ikFrameEanbled=!0),r.iKPass===!0&&n.onAnimationIKObservable&&n.onAnimationIKObservable.hasObservers()&&n.onAnimationIKObservable.notifyObservers(r.index);var o=r.animationStateMachine;if(o.type===e.MotionType.Clip&&o.played!==-1&&(o.played+=t),null!=o.blendtree.children&&o.blendtree.children.length>0){var a=o.blendtree.children[0];if(null!=a)if(o.blendtree.blendType==e.BlendTreeType.Clip){var i=a.track;if(null!=i){var l=i.metadata.unity.length,s=e.AnimationState.TIME/l;r.animationTime+=t*s*Math.abs(o.speed)*Math.abs(n.speedRatio)*e.AnimationState.SPEED,r.animationTime>e.AnimationState.TIME&&(r.animationTime=e.AnimationState.TIME),r.animationNormal=r.animationTime>0?e.Scalar.Clamp(r.animationTime/e.AnimationState.TIME,0,1):0;var u=r.animationNormal>=.99?1:r.animationNormal,d=parseFloat(u.toFixed(3));o.speed<0&&(r.animationNormal=1-r.animationNormal);var p=l*r.animationNormal,c=0,m=0,h=0,f=!1,g=!1,y=0,v=!0,_=!0,b=!0,C=i;null!=C.metadata&&null!=C.metadata.unity&&(null!=C.metadata.unity.averagespeed&&(m=null!=C.metadata.unity.averagespeed.x?C.metadata.unity.averagespeed.x:0,h=null!=C.metadata.unity.averagespeed.z?C.metadata.unity.averagespeed.z:0),null!=C.metadata.unity.settings&&(c=null!=C.metadata.unity.settings.level?C.metadata.unity.settings.level:0,f=null!=C.metadata.unity.settings.looptime&&C.metadata.unity.settings.looptime,g=null!=C.metadata.unity.settings.loopblend&&C.metadata.unity.settings.loopblend,y=null!=C.metadata.unity.settings.orientationoffsety?C.metadata.unity.settings.orientationoffsety:0,v=null==C.metadata.unity.settings.loopblendorientation||C.metadata.unity.settings.loopblendorientation,_=null==C.metadata.unity.settings.loopblendpositiony||C.metadata.unity.settings.loopblendpositiony,b=null==C.metadata.unity.settings.loopblendpositionxz||C.metadata.unity.settings.loopblendpositionxz)),0===r.index&&(n._looptime=f,n._loopblend=g),y=e.Tools.ToRadians(y),m=Math.abs(m),h=Math.abs(h),c*=-1,r.animationTime>=e.AnimationState.TIME&&(r.animationFirstRun=!1,r.animationLoopFrame=!0,f===!0?(r.animationLoopCount++,n.onAnimationLoopObservable&&n.onAnimationLoopObservable.hasObservers()&&n.onAnimationLoopObservable.notifyObservers(r.index)):r.animationEndFrame===!1&&(r.animationEndFrame=!0,n.onAnimationEndObservable&&n.onAnimationEndObservable.hasObservers()&&n.onAnimationEndObservable.notifyObservers(r.index))),r.animationFirstRun!==!0&&f!==!0||(n._animationplaying=!0,i.targetedAnimations.forEach(function(t){if(t.target instanceof e.TransformNode){var o=t.target;if(0===r.index||null==r.avatarMask||n.filterTargetAvatarMask(r,o)){var a=null!=o.metadata&&null!=o.metadata.unity&&null!=o.metadata.unity.rootbone&&o.metadata.unity.rootbone;if(a===!0&&null==n._rootBoneTransform&&(n._rootBoneTransform=o),null!=o.metadata&&null!=o.metadata.mixer){var i=o.metadata.mixer[r.index];if(null!=i)if("position"===t.animation.targetProperty)n._targetPosition=e.Utilities.SampleAnimationVector3(t.animation,p,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),a===!0&&null!=n._rootBoneTransform?(n._positionWeight=!0,n._positionHolder.set(0,0,0),n._rootBoneWeight=!1,n._rootBoneHolder.set(0,0,0),n.applyRootMotion===!0?_===!0&&b===!0?(n._positionWeight=!0,n._positionHolder.set(n._targetPosition.x,n._targetPosition.y+c,n._targetPosition.z)):_===!1&&b===!1?(n._rootBoneWeight=!0,n._rootBoneHolder.set(n._targetPosition.x,n._targetPosition.y+c,n._targetPosition.z)):_===!0&&b===!1?(n._positionWeight=!0,n._positionHolder.set(n.m_zeroVector.x,n._targetPosition.y+c,n.m_zeroVector.z),n._rootBoneWeight=!0,n._rootBoneHolder.set(n._targetPosition.x,n.m_zeroVector.y,n._targetPosition.z)):b===!0&&_===!1&&(n._positionWeight=!0,n._positionHolder.set(n._targetPosition.x,n.m_zeroVector.y,n._targetPosition.z),n._rootBoneWeight=!0,n._rootBoneHolder.set(n.m_zeroVector.x,n._targetPosition.y+c,n.m_zeroVector.z)):(n._positionWeight=!0,n._positionHolder.set(n._targetPosition.x,n._targetPosition.y+c,n._targetPosition.z)),n._positionWeight===!0&&(null==i.positionBuffer&&(i.positionBuffer=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(i.positionBuffer,n._positionHolder,1)),n._rootBoneWeight===!0&&(null==i.rootPosition&&(i.rootPosition=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(i.rootPosition,n._rootBoneHolder,1))):(null==i.positionBuffer&&(i.positionBuffer=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(i.positionBuffer,n._targetPosition,1));else if("rotationQuaternion"===t.animation.targetProperty)if(n._targetRotation=e.Utilities.SampleAnimationQuaternion(t.animation,p,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),a===!0&&null!=n._rootBoneTransform){n._rotationWeight=!1,n._rotationHolder.copyFrom(n.m_rotationIdentity),n._rootQuatWeight=!1,n._rootQuatHolder.copyFrom(n.m_rotationIdentity);var l=n._targetRotation.toEulerAngles(),s=l.y;n.applyRootMotion===!0?v===!0?(n._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(l.x,s+y,l.z,n._rotationHolder)):(n._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(l.x,n.m_zeroVector.y,l.z,n._rotationHolder),n._rootQuatWeight=!0,e.Quaternion.FromEulerAnglesToRef(n.m_zeroVector.x,s+y,n.m_zeroVector.z,n._rootQuatHolder)):(n._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(l.x,s+y,l.z,n._rotationHolder)),n._rotationWeight===!0&&(null==i.rotationBuffer&&(i.rotationBuffer=new e.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(i.rotationBuffer,n._rotationHolder,1)),n._rootQuatWeight===!0&&(null==i.rootRotation&&(i.rootRotation=new e.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(i.rootRotation,n._rootQuatHolder,1))}else null==i.rotationBuffer&&(i.rotationBuffer=new e.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(i.rotationBuffer,n._targetRotation,1);else"scaling"===t.animation.targetProperty&&(n._targetScaling=e.Utilities.SampleAnimationVector3(t.animation,p,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==i.scalingBuffer&&(i.scalingBuffer=new e.Vector3(1,1,1)),e.Utilities.BlendVector3Value(i.scalingBuffer,n._targetScaling,1))}}}else if(t.target instanceof e.MorphTarget){var u=t.target;if(null!=u.metadata&&null!=u.metadata.mixer){var d=u.metadata.mixer[r.index];if("influence"===t.animation.targetProperty){var m=e.Utilities.SampleAnimationFloat(t.animation,p,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0);null==d.influenceBuffer&&(d.influenceBuffer=0),d.influenceBuffer=e.Utilities.BlendFloatValue(d.influenceBuffer,m,1)}}}})),1==n._animationplaying&&(null!=r.animationStateMachine.tcurves&&r.animationStateMachine.tcurves.length>0&&r.animationStateMachine.tcurves.forEach(function(t){if(null!=t.targetProperty&&""!==t.targetProperty){var o=e.Utilities.SampleAnimationFloat(t,r.animationNormal,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0);n.setFloat(t.targetProperty,o)}}),null!=r.animationStateMachine.events&&r.animationStateMachine.events.length>0&&r.animationStateMachine.events.forEach(function(e){if(d>=e.time-.01&&d<=e.time+.01){var t=e["function"]+"_"+e.time;null==r.animationLoopEvents&&(r.animationLoopEvents={}),r.animationLoopEvents[t]||(r.animationLoopEvents[t]=!0,n.onAnimationEventObservable&&n.onAnimationEventObservable.hasObservers()&&n.onAnimationEventObservable.notifyObservers(e))}})),r.animationLoopFrame===!0&&(r.animationTime=0,r.animationNormal=0,r.animationLoopFrame=!1,r.animationLoopEvents=null)}}else{n._animationplaying=!0,n._blendWeights.primary=null,n._blendWeights.secondary=null;var S=[],T=o.blendtree;n.parseTreeBranches(r,T,1,S);var s=n.computeWeightedFrameRatio(S);r.animationTime+=t*s*Math.abs(o.speed)*Math.abs(n.speedRatio)*e.AnimationState.SPEED,r.animationTime>e.AnimationState.TIME&&(r.animationTime=e.AnimationState.TIME),r.animationNormal=r.animationTime>0?e.Scalar.Clamp(r.animationTime/e.AnimationState.TIME,0,1):0;var u=r.animationNormal>=.99?1:r.animationNormal,I=parseFloat(u.toFixed(3));o.speed<0&&(r.animationNormal=1-r.animationNormal);var M=r.animationNormal;r.animationTime>=e.AnimationState.TIME&&(r.animationFirstRun=!1,r.animationLoopFrame=!0,r.animationLoopCount++);var x=null!=S&&S.length>0&&null!=S[0].track?S[0].track:null;if(null!=x)for(var A=x.targetedAnimations.length,O=0;O<A;O++){var w=x.targetedAnimations[O];if(w.target instanceof e.TransformNode){var B=w.target;if(0===r.index||null==r.avatarMask||n.filterTargetAvatarMask(r,B)){var P=null!=B.metadata&&null!=B.metadata.unity&&null!=B.metadata.unity.rootbone&&B.metadata.unity.rootbone;if(P===!0&&null==n._rootBoneTransform&&(n._rootBoneTransform=B),null!=B.metadata&&null!=B.metadata.mixer){n._initialtargetblending=!0;var L=B.metadata.mixer[r.index];n.updateBlendableTargets(t,r,T,w,O,L,M,P,B)}}}}null!=r.animationStateMachine.tcurves&&r.animationStateMachine.tcurves.length>0&&r.animationStateMachine.tcurves.forEach(function(t){if(null!=t.targetProperty&&""!==t.targetProperty){var o=e.Utilities.SampleAnimationFloat(t,r.animationNormal,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0);n.setFloat(t.targetProperty,o)}}),null!=r.animationStateMachine.events&&r.animationStateMachine.events.length>0&&r.animationStateMachine.events.forEach(function(e){if(I>=e.time-.01&&I<=e.time+.01){var t=e["function"]+"_"+e.time;null==r.animationLoopEvents&&(r.animationLoopEvents={}),r.animationLoopEvents[t]||(r.animationLoopEvents[t]=!0,n.onAnimationEventObservable&&n.onAnimationEventObservable.hasObservers()&&n.onAnimationEventObservable.notifyObservers(e))}}),r.animationLoopFrame===!0&&(r.animationTime=0,r.animationNormal=0,r.animationLoopFrame=!1,r.animationLoopEvents=null)}}}}),this.finalizeAnimationTargets(t)},n.prototype.updateBlendableTargets=function(t,n,r,o,a,i,l,s,u){if(null!=i&&null!=r.children&&r.children.length>0)for(var d=0;d<r.children.length;d++){var p=r.children[d];if(p.weight>0)if(p.type===e.MotionType.Clip){if(null!=p.track){var c=0,m=0,h=0,f=!1,g=0,y=!0,v=!0,_=!0,b=p.track;null!=b.metadata&&null!=b.metadata.unity&&(null!=b.metadata.unity.averagespeed&&(m=null!=b.metadata.unity.averagespeed.x?b.metadata.unity.averagespeed.x:0,h=null!=b.metadata.unity.averagespeed.z?b.metadata.unity.averagespeed.z:0),null!=b.metadata.unity.settings&&(c=null!=b.metadata.unity.settings.level?b.metadata.unity.settings.level:0,f=null!=b.metadata.unity.settings.loopblend&&b.metadata.unity.settings.loopblend,g=null!=b.metadata.unity.settings.orientationoffsety?b.metadata.unity.settings.orientationoffsety:0,y=null==b.metadata.unity.settings.loopblendorientation||b.metadata.unity.settings.loopblendorientation,v=null==b.metadata.unity.settings.loopblendpositiony||b.metadata.unity.settings.loopblendpositiony,
_=null==b.metadata.unity.settings.loopblendpositionxz||b.metadata.unity.settings.loopblendpositionxz)),0===n.index&&(this._looptime=!0,this._loopblend=f),g=e.Tools.ToRadians(g),m=Math.abs(m),h=Math.abs(h),c*=-1;var C=p.track.targetedAnimations[a],S=this._initialtargetblending===!0?1:parseFloat(p.weight.toFixed(2));if(this._initialtargetblending=!1,C.target===o.target&&C.animation.targetProperty===o.animation.targetProperty){var T=l;p.timescale<0&&(T=1-T);var I=p.track.metadata.unity.length,M=I*T;if("position"===o.animation.targetProperty)this._targetPosition=e.Utilities.SampleAnimationVector3(C.animation,M,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),s===!0&&null!=this._rootBoneTransform?(this._positionWeight=!0,this._positionHolder.set(0,0,0),this._rootBoneWeight=!1,this._rootBoneHolder.set(0,0,0),this.applyRootMotion===!0?v===!0&&_===!0?(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+c,this._targetPosition.z)):v===!1&&_===!1?(this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this._targetPosition.y+c,this._targetPosition.z)):v===!0&&_===!1?(this._positionWeight=!0,this._positionHolder.set(this.m_zeroVector.x,this._targetPosition.y+c,this.m_zeroVector.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this.m_zeroVector.y,this._targetPosition.z)):_===!0&&v===!1&&(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this.m_zeroVector.y,this._targetPosition.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(this.m_zeroVector.x,this._targetPosition.y+c,this.m_zeroVector.z)):(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+c,this._targetPosition.z)),this._positionWeight===!0&&(null==i.positionBuffer&&(i.positionBuffer=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(i.positionBuffer,this._positionHolder,S)),this._rootBoneWeight===!0&&(null==i.rootPosition&&(i.rootPosition=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(i.rootPosition,this._rootBoneHolder,S))):(null==i.positionBuffer&&(i.positionBuffer=new e.Vector3(0,0,0)),e.Utilities.BlendVector3Value(i.positionBuffer,this._targetPosition,S));else if("rotationQuaternion"===o.animation.targetProperty)if(this._targetRotation=e.Utilities.SampleAnimationQuaternion(C.animation,M,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),s===!0&&null!=this._rootBoneTransform){this._rotationWeight=!1,this._rotationHolder.copyFrom(this.m_rotationIdentity),this._rootQuatWeight=!1,this._rootQuatHolder.copyFrom(this.m_rotationIdentity);var x=this._targetRotation.toEulerAngles(),A=x.y;this.applyRootMotion===!0?y===!0?(this._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(x.x,A+g,x.z,this._rotationHolder)):(this._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(x.x,this.m_zeroVector.y,x.z,this._rotationHolder),this._rootQuatWeight=!0,e.Quaternion.FromEulerAnglesToRef(this.m_zeroVector.x,A+g,this.m_zeroVector.z,this._rootQuatHolder)):(this._rotationWeight=!0,e.Quaternion.FromEulerAnglesToRef(x.x,A+g,x.z,this._rotationHolder)),this._rotationWeight===!0&&(null==i.rotationBuffer&&(i.rotationBuffer=new e.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(i.rotationBuffer,this._rotationHolder,S)),this._rootQuatWeight===!0&&(null==i.rootRotation&&(i.rootRotation=new e.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(i.rootRotation,this._rootQuatHolder,S))}else null==i.rotationBuffer&&(i.rotationBuffer=new e.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(i.rotationBuffer,this._targetRotation,S);else"scaling"===o.animation.targetProperty&&(this._targetScaling=e.Utilities.SampleAnimationVector3(C.animation,M,e.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==i.scalingBuffer&&(i.scalingBuffer=new e.Vector3(1,1,1)),e.Utilities.BlendVector3Value(i.scalingBuffer,this._targetScaling,S))}else e.Tools.Warn(r.name+" - "+p.track.name+" blend tree mismatch ("+a+"): "+o.target.name+" >>> "+C.target.name)}}else p.type===e.MotionType.Tree&&this.updateBlendableTargets(t,n,p.subtree,o,a,i,l,s,u)}},n.prototype.finalizeAnimationTargets=function(t){var n=this;if(this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(t){var r=t.target;null!=r.metadata&&null!=r.metadata.mixer&&null!=n._machine.layers&&n._machine.layers.length>0&&(n._blenderMatrix.reset(),n._dirtyBlenderMatrix=null,n._machine.layers.forEach(function(t){var o=r.metadata.mixer[t.index];null!=o&&(r instanceof e.TransformNode?(null==o.positionBuffer&&null==o.rotationBuffer&&null==o.scalingBuffer||(e.Matrix.ComposeToRef(o.scalingBuffer||r.scaling,o.rotationBuffer||r.rotationQuaternion,o.positionBuffer||r.position,n._updateMatrix),o.blendingSpeed>0&&(o.blendingFactor<=1&&null==o.originalMatrix&&(o.originalMatrix=e.Matrix.Compose(r.scaling,r.rotationQuaternion,r.position)),o.blendingFactor<=1&&null!=o.originalMatrix&&(e.Utilities.FastMatrixSlerp(o.originalMatrix,n._updateMatrix,o.blendingFactor,n._updateMatrix),o.blendingFactor+=o.blendingSpeed)),e.Utilities.FastMatrixSlerp(n._blenderMatrix,n._updateMatrix,t.defaultWeight,n._blenderMatrix),n._dirtyBlenderMatrix=!0,o.positionBuffer=null,o.rotationBuffer=null,o.scalingBuffer=null),null==o.rootPosition&&null==o.rootRotation||(e.Matrix.ComposeToRef(n._emptyScaling,o.rootRotation||n._emptyRotation,o.rootPosition||n._emptyPosition,n._updateMatrix),e.Utilities.FastMatrixSlerp(n._rootMotionMatrix,n._updateMatrix,t.defaultWeight,n._rootMotionMatrix),n._dirtyMotionMatrix=!0,o.rootPosition=null,o.rootRotation=null)):r instanceof e.MorphTarget&&null!=o.influenceBuffer&&(r.influence=e.Scalar.Lerp(r.influence,o.influenceBuffer,t.defaultWeight),o.influenceBuffer=null))}),null!=n._dirtyBlenderMatrix&&n._blenderMatrix.decompose(r.scaling,r.rotationQuaternion,r.position))}),this.applyRootMotion===!0&&null!=this._dirtyMotionMatrix){if(this._rootMotionMatrix.decompose(this._rootMotionScaling,this._rootMotionRotation,this._rootMotionPosition),this.isFirstFrame()===!0)this._deltaPosition.copyFrom(this._rootMotionPosition),this._deltaRotation.copyFrom(this._rootMotionRotation);else if(this.isLastFrame()===!0){if(this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),e.Utilities.QuaternionDiffToRef(this._rootMotionRotation,this._lastMotionRotation,this._deltaRotation),this._looptime===!0&&this._loopblend===!0){var r=this._loopMotionSpeed+this._lastMotionSpeed;0!==r&&(r/=2),this._deltaPosition.normalize(),this._deltaPosition.scaleInPlace(r*t);var o=this._loopRotateSpeed+this._lastRotateSpeed;0!==o&&(o/=2),this._deltaRotation.toEulerAnglesToRef(this._angularVelocity),e.Quaternion.FromEulerAnglesToRef(this._angularVelocity.x,o,this._angularVelocity.z,this._deltaRotation)}}else this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),e.Utilities.QuaternionDiffToRef(this._rootMotionRotation,this._lastMotionRotation,this._deltaRotation);var a=this._deltaPosition.length();this._rootMotionSpeed=a>0?a/t:a,this._deltaRotation.toEulerAnglesToRef(this._angularVelocity),this._lastMotionPosition.copyFrom(this._rootMotionPosition),this._lastMotionRotation.copyFrom(this._rootMotionRotation),this._lastMotionSpeed=this._rootMotionSpeed,this._lastRotateSpeed=this._angularVelocity.y,0===this._frametime&&(this._loopMotionSpeed=this._rootMotionSpeed,this._loopRotateSpeed=this._angularVelocity.y)}},n.prototype.checkStateMachine=function(e,t){var n=this;this._checkers.result=null,this._checkers.offest=0,this._checkers.blending=0,this._checkers.triggered=[],null!=e.animationStateMachine&&(e.animationStateMachine.time+=t,this.checkStateTransitions(e,e.animationStateMachine.transitions),null==this._checkers.result&&null!=this._machine.transitions&&this.checkStateTransitions(e,this._machine.transitions)),null!=this._checkers.triggered&&this._checkers.triggered.length>0&&(this._checkers.triggered.forEach(function(e){n.resetTrigger(e)}),this._checkers.triggered=null),null!=this._checkers.result&&(this.onAnimationTransitionObservable&&this.onAnimationTransitionObservable.hasObservers()&&this.onAnimationTransitionObservable.notifyObservers(this.transform),this.playCurrentAnimationState(e,this._checkers.result,this._checkers.blending,this._checkers.offest))},n.prototype.checkStateTransitions=function(t,n){var r=this,o=t.animationStateMachine.rate,a=t.animationStateMachine.length;if(null!=n&&n.length>0){var i=0,l=-1;for(i=0;i<n.length;i++)if(n[i].solo===!0&&n[i].mute===!1){l=i;break}var s=function(){var s=n[i];if(s.layerIndex!==t.index)return"continue";if(s.mute===!0)return"continue";if(l>=0&&l!==i)return"continue";var d=!1,p=0,c=!0;if(s.exitTime>0&&(p=a*s.exitTime/u.speedRatio,c=s.hasExitTime!==!0||t.animationStateMachine.time>=p),s.hasExitTime===!0&&s.intSource==e.InterruptionSource.None&&c===!1)return"continue";if(null!=s.conditions&&s.conditions.length>0){var m=0,h=s.conditions.length;s.conditions.forEach(function(t){var n=r._parameters.get(t.parameter);if(null!=n)if(n==e.AnimatorParameterType.Float||n==e.AnimatorParameterType.Int){var o=parseFloat(r.getFloat(t.parameter).toFixed(2));t.mode===e.ConditionMode.Greater&&o>t.threshold?m++:t.mode===e.ConditionMode.Less&&o<t.threshold?m++:t.mode===e.ConditionMode.Equals&&o===t.threshold?m++:t.mode===e.ConditionMode.NotEqual&&o!==t.threshold&&m++}else if(n==e.AnimatorParameterType.Bool){var a=r.getBool(t.parameter);t.mode===e.ConditionMode.If&&a===!0?m++:t.mode===e.ConditionMode.IfNot&&a===!1&&m++}else if(n==e.AnimatorParameterType.Trigger){var i=r.getTrigger(t.parameter);if(i===!0){m++;for(var l=-1,s=0;s<r._checkers.triggered.length;s++)if(r._checkers.triggered[s]===t.parameter){l=s;break}l<0&&r._checkers.triggered.push(t.parameter)}}}),d=s.hasExitTime===!0?c===!0&&m===h:m===h}else d=s.hasExitTime===!0&&c===!0;if(d===!0){s.hasExitTime===!0&&c===!0&&u.onAnimationEndObservable&&u.onAnimationEndObservable.hasObservers()&&u.onAnimationEndObservable.notifyObservers(t.index);var f=o>0?o:e.AnimationState.FPS,g=s.isExit===!1?s.destination:e.AnimationState.EXIT,y=s.fixedDuration===!0?s.duration:e.Scalar.Denormalize(s.duration,0,a),v=e.Utilities.ComputeBlendingSpeed(f,y),_=s.offset;return u._checkers.result=g,u._checkers.offest=_,u._checkers.blending=v,"break"}},u=this;for(i=0;i<n.length;i++){var d=s();if("break"===d)break}}},n.prototype.playCurrentAnimationState=function(t,n,r,o){if(void 0===o&&(o=0),null!=t&&null!=n&&""!==n&&n!==e.AnimationState.EXIT&&(null==t.animationStateMachine||t.animationStateMachine.name!==n)){null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(e){var n=e.target;if(null!=n.metadata&&null!=n.metadata.mixer){var o=n.metadata.mixer[t.index];null!=o&&(o.originalMatrix=null,o.blendingFactor=0,o.blendingSpeed=r)}});var a=this.getMachineState(n);null!=a&&a.layerIndex===t.index&&(a.time=0,a.played=0,a.interrupted=!1,t.animationTime=e.Scalar.Clamp(o),t.animationNormal=0,t.animationFirstRun=!0,t.animationEndFrame=!1,t.animationLoopFrame=!1,t.animationLoopCount=0,t.animationLoopEvents=null,t.animationStateMachine=a,this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),this._lastMotionPosition.set(0,0,0),this._lastMotionRotation.set(0,0,0,0))}},n.prototype.stopCurrentAnimationState=function(e){null!=e&&(null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(t){var n=t.target;if(null!=n.metadata&&null!=n.metadata.mixer){var r=n.metadata.mixer[e.index];null!=r&&(r.originalMatrix=null,r.blendingFactor=0,r.blendingSpeed=0)}}),e.animationTime=0,e.animationNormal=0,e.animationFirstRun=!0,e.animationEndFrame=!1,e.animationLoopFrame=!1,e.animationLoopCount=0,e.animationLoopEvents=null,e.animationStateMachine=null,this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),this._lastMotionPosition.set(0,0,0),this._lastMotionRotation.set(0,0,0,0))},n.prototype.checkAvatarTransformPath=function(e,t){var n=!1;if(null!=e.animationMaskMap){var r=e.animationMaskMap.get(t);null!=r&&r>=0&&(n=!0)}return n},n.prototype.filterTargetAvatarMask=function(e,t){var n=!1;if(null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.bone&&""!==t.metadata.unity.bone){var r=t.metadata.unity.bone;n=this.checkAvatarTransformPath(e,r)}return n},n.prototype.sortWeightedBlendingList=function(e){null!=e&&e.length>0&&e.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0})},n.prototype.computeWeightedFrameRatio=function(t){var n=1;if(null!=t&&t.length>0){this.sortWeightedBlendingList(t),this._blendWeights.primary=t[0];var r=this._blendWeights.primary.weight;if(r<1&&t.length>1&&(this._blendWeights.secondary=t[1]),null!=this._blendWeights.primary&&null!=this._blendWeights.secondary){var o=e.Scalar.Clamp(this._blendWeights.primary.weight);n=e.Scalar.Lerp(this._blendWeights.secondary.ratio,this._blendWeights.primary.ratio,o)}else null!=this._blendWeights.primary&&null==this._blendWeights.secondary&&(n=this._blendWeights.primary.ratio)}return n},n.prototype.setupTreeBranches=function(t){var n=this;null!=t&&null!=t.children&&t.children.length>0&&t.children.forEach(function(t){if(t.type===e.MotionType.Tree)n.setupTreeBranches(t.subtree);else if(t.type===e.MotionType.Clip&&null!=t.motion&&""!==t.motion&&(t.weight=0,t.ratio=0,t.track=n.getAnimationGroup(t.motion),null!=t.track)){var r=t.track.metadata.unity.length;t.ratio=e.AnimationState.TIME/r}})},n.prototype.parseTreeBranches=function(t,n,r,o){if(null!=n)switch(n.valueParameterX=null!=n.blendParameterX?parseFloat(this.getFloat(n.blendParameterX).toFixed(2)):0,n.valueParameterY=null!=n.blendParameterY?parseFloat(this.getFloat(n.blendParameterY).toFixed(2)):0,n.blendType){case e.BlendTreeType.Simple1D:this.parse1DSimpleTreeBranches(t,n,r,o);break;case e.BlendTreeType.SimpleDirectional2D:this.parse2DSimpleDirectionalTreeBranches(t,n,r,o);break;case e.BlendTreeType.FreeformDirectional2D:this.parse2DFreeformDirectionalTreeBranches(t,n,r,o);break;case e.BlendTreeType.FreeformCartesian2D:this.parse2DFreeformCartesianTreeBranches(t,n,r,o)}},n.prototype.parse1DSimpleTreeBranches=function(t,n,r,o){var a=this;if(null!=n&&null!=n.children&&n.children.length>0){var i=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.threshold,posY:e.threshold,weight:e.weight};i.push(t)}),e.BlendTreeSystem.Calculate1DSimpleBlendTree(n.valueParameterX,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=r,n.type===e.MotionType.Clip&&n.weight>0&&o.push(n),n.type===e.MotionType.Tree&&a.parseTreeBranches(t,n.subtree,n.weight,o)})}},n.prototype.parse2DSimpleDirectionalTreeBranches=function(t,n,r,o){var a=this;if(null!=n&&null!=n.children&&n.children.length>0){var i=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};i.push(t)}),e.BlendTreeSystem.Calculate2DFreeformDirectional(n.valueParameterX,n.valueParameterY,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=r,n.type===e.MotionType.Clip&&n.weight>0&&o.push(n),n.type===e.MotionType.Tree&&a.parseTreeBranches(t,n.subtree,n.weight,o)})}},n.prototype.parse2DFreeformDirectionalTreeBranches=function(t,n,r,o){var a=this;if(null!=n&&null!=n.children&&n.children.length>0){var i=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};i.push(t)}),e.BlendTreeSystem.Calculate2DFreeformDirectional(n.valueParameterX,n.valueParameterY,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=r,n.type===e.MotionType.Clip&&n.weight>0&&o.push(n),n.type===e.MotionType.Tree&&a.parseTreeBranches(t,n.subtree,n.weight,o)})}},n.prototype.parse2DFreeformCartesianTreeBranches=function(t,n,r,o){var a=this;if(null!=n&&null!=n.children&&n.children.length>0){var i=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};i.push(t)}),e.BlendTreeSystem.Calculate2DFreeformCartesian(n.valueParameterX,n.valueParameterY,i),i.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=r,n.type===e.MotionType.Clip&&n.weight>0&&o.push(n),n.type===e.MotionType.Tree&&a.parseTreeBranches(t,n.subtree,n.weight,o)})}},n.FPS=30,n.EXIT="[EXIT]",n.TIME=1,n.SPEED=1,n}(e.ScriptComponent);e.AnimationState=t;var n=function(){function e(e){this.source=e.source,this.motion=e.motion,this.posX=e.posX||0,this.posY=e.posY||0,this.weight=e.weight||0}return e}();e.BlendTreeValue=n;var r=function(){function e(){}return e.ClampValue=function(e,t,n){return e<=t?t:e>=n?n:e},e.GetSignedAngle=function(e,t){return Math.atan2(e.x*t.y-e.y*t.x,e.x*t.x+e.y*t.y)},e.GetLinearInterpolation=function(e,t,n,r,o){return t+(o-e)*((r-t)/(n-e))},e.GetRightNeighbourIndex=function(e,t){t.sort(function(e,t){return e.posX-t.posX});for(var n=0;n<t.length;++n)if(t[n].posX>e)return n;return-1},e}();e.BlendTreeUtils=r;var o=function(){function t(){}return t.Calculate1DSimpleBlendTree=function(t,n){var r=n[0],o=n[n.length-1];if(t<=r.posX)r.weight=1;else if(t>=o.posX)o.weight=1;else{var a=e.BlendTreeUtils.GetRightNeighbourIndex(t,n),i=n[a-1],l=n[a],s=e.BlendTreeUtils.GetLinearInterpolation(i.posX,1,l.posX,0,t);i.weight=s,l.weight=1-i.weight}},t.Calculate2DFreeformDirectional=function(t,n,r){e.BlendTreeSystem.TempVector2_IP.set(t,n),e.BlendTreeSystem.TempVector2_POSI.set(0,0),e.BlendTreeSystem.TempVector2_POSJ.set(0,0),e.BlendTreeSystem.TempVector2_POSIP.set(0,0),e.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var o=2,a=0,i=e.BlendTreeSystem.TempVector2_IP.length(),l=0;l<r.length;++l){var s=r[l];e.BlendTreeSystem.TempVector2_POSI.set(s.posX,s.posY);for(var u=e.BlendTreeSystem.TempVector2_POSI.length(),d=i-u,p=e.BlendTreeUtils.GetSignedAngle(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_IP),c=1,m=0;m<r.length;++m)if(m!==l){e.BlendTreeSystem.TempVector2_POSJ.set(r[m].posX,r[m].posY);var h=e.BlendTreeSystem.TempVector2_POSJ.length(),f=(u+h)/2,g=d/f,y=(h-u)/f,v=e.BlendTreeUtils.GetSignedAngle(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSJ);e.BlendTreeSystem.TempVector2_POSIP.set(g,p*o),e.BlendTreeSystem.TempVector2_POSIJ.set(y,v*o);var _=e.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),b=e.Vector2.Dot(e.BlendTreeSystem.TempVector2_POSIP,e.BlendTreeSystem.TempVector2_POSIJ)/_;b=1-b,b=e.BlendTreeUtils.ClampValue(b,0,1),c=Math.min(b,c)}s.weight=c,a+=c}for(var C=0,S=r;C<S.length;C++){var s=S[C];s.weight/=a}},t.Calculate2DFreeformCartesian=function(t,n,r){e.BlendTreeSystem.TempVector2_IP.set(t,n),e.BlendTreeSystem.TempVector2_POSI.set(0,0),e.BlendTreeSystem.TempVector2_POSJ.set(0,0),e.BlendTreeSystem.TempVector2_POSIP.set(0,0),e.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var o=0,a=0;a<r.length;++a){var i=r[a];e.BlendTreeSystem.TempVector2_POSI.set(i.posX,i.posY),e.BlendTreeSystem.TempVector2_IP.subtractToRef(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSIP);for(var l=1,s=0;s<r.length;++s)if(s!==a){e.BlendTreeSystem.TempVector2_POSJ.set(r[s].posX,r[s].posY),e.BlendTreeSystem.TempVector2_POSJ.subtractToRef(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSIJ);var u=e.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),d=e.Vector2.Dot(e.BlendTreeSystem.TempVector2_POSIP,e.BlendTreeSystem.TempVector2_POSIJ)/u;d=1-d,d=e.BlendTreeUtils.ClampValue(d,0,1),l=Math.min(l,d)}i.weight=l,o+=l}for(var p=0,c=r;p<c.length;p++){var i=c[p];i.weight/=o}},t.TempVector2_IP=new e.Vector2(0,0),t.TempVector2_POSI=new e.Vector2(0,0),t.TempVector2_POSJ=new e.Vector2(0,0),t.TempVector2_POSIP=new e.Vector2(0,0),t.TempVector2_POSIJ=new e.Vector2(0,0),t}();e.BlendTreeSystem=o;var a=function(){function e(){}return e}();e.MachineState=a;var i=function(){function e(){}return e}();e.TransitionCheck=i;var l=function(){function e(){}return e}();e.AnimationMixer=l;var s=function(){function e(){}return e}();e.BlendingWeights=s;var u;!function(e){e[e.Clip=0]="Clip",e[e.Tree=1]="Tree"}(u=e.MotionType||(e.MotionType={}));var d;!function(e){e[e.If=1]="If",e[e.IfNot=2]="IfNot",e[e.Greater=3]="Greater",e[e.Less=4]="Less",e[e.Equals=6]="Equals",e[e.NotEqual=7]="NotEqual"}(d=e.ConditionMode||(e.ConditionMode={}));var p;!function(e){e[e.None=0]="None",e[e.Source=1]="Source",e[e.Destination=2]="Destination",e[e.SourceThenDestination=3]="SourceThenDestination",e[e.DestinationThenSource=4]="DestinationThenSource"}(p=e.InterruptionSource||(e.InterruptionSource={}));var c;!function(e){e[e.Simple1D=0]="Simple1D",e[e.SimpleDirectional2D=1]="SimpleDirectional2D",e[e.FreeformDirectional2D=2]="FreeformDirectional2D",e[e.FreeformCartesian2D=3]="FreeformCartesian2D",e[e.Direct=4]="Direct",e[e.Clip=5]="Clip"}(c=e.BlendTreeType||(e.BlendTreeType={}));var m;!function(e){e[e.Lower=0]="Lower",e[e.Upper=1]="Upper"}(m=e.BlendTreePosition||(e.BlendTreePosition={}));var h;!function(e){e[e.Float=1]="Float",e[e.Int=3]="Int",e[e.Bool=4]="Bool",e[e.Trigger=9]="Trigger"}(h=e.AnimatorParameterType||(e.AnimatorParameterType={}))}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BABYLON;!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n._audio=null,n._name=null,n._loop=!1,n._mute=!1,n._pitch=1,n._volume=1,n._preload=!1,n._playonawake=!0,n._spatialblend=0,n._preloaderUrl=null,n._lastmutedvolume=null,n._priority=128,n._panstereo=0,n._mindistance=10,n._maxdistance=50,n._rolloffmode="linear",n._reverbzonemix=1,n._bypasseffects=!1,n._bypassreverbzones=!1,n._bypasslistenereffects=!1,n._initializedReadyInstance=!1,n.onReadyObservable=new e.Observable,n}return __extends(n,t),n.prototype.getSoundClip=function(){return this._audio},n.prototype.getAudioElement=function(){return null!=this._audio?this._audio._htmlAudioElement:null},n.prototype.awake=function(){this.awakeAudioSource()},n.prototype.start=function(){this.startAudioSource()},n.prototype.destroy=function(){this.destroyAudioSource()},n.prototype.awakeAudioSource=function(){this._name=this.getProperty("name",this._name),this._loop=this.getProperty("loop",this._loop),this._mute=this.getProperty("mute",this._mute),this._pitch=this.getProperty("pitch",this._pitch),this._volume=this.getProperty("volume",this._volume),this._preload=this.getProperty("preload",this._preload),this._priority=this.getProperty("priority",this._priority),this._panstereo=this.getProperty("panstereo",this._panstereo),this._playonawake=this.getProperty("playonawake",this._playonawake),this._mindistance=this.getProperty("mindistance",this._mindistance),this._maxdistance=this.getProperty("maxdistance",this._maxdistance),this._rolloffmode=this.getProperty("rolloffmode",this._rolloffmode),this._spatialblend=this.getProperty("spatialblend",this._spatialblend),this._reverbzonemix=this.getProperty("reverbzonemix",this._reverbzonemix),this._bypasseffects=this.getProperty("bypasseffects",this._bypasseffects),this._bypassreverbzones=this.getProperty("bypassreverbzones",this._bypassreverbzones),this._bypasslistenereffects=this.getProperty("bypasslistenereffects",this._bypasslistenereffects),null!=this._name&&""!==this._name||(this._name="Unknown");var t=this.getProperty("file");if(null!=t&&""!==t){var n=e.SceneManager.GetRootUrl(this.scene),r=n+t;null!=r&&""!==r&&(this._preload===!0?this._preloaderUrl=r:this.setDataSource(r))}},n.prototype.startAudioSource=function(){this._volume>=e.AudioSource.MAX_VOLUME&&(this._volume=e.AudioSource.DEFAULT_LEVEL)},n.prototype.destroyAudioSource=function(){this.onReadyObservable.clear(),this.onReadyObservable=null,null!=this._audio&&(this._audio.dispose(),this._audio=null)},n.prototype.isReady=function(){var e=!1;return null!=this._audio&&(e=this._audio.isReady()),e},n.prototype.isPlaying=function(){var e=!1;return null!=this._audio&&(e=this._audio.isPlaying),e},n.prototype.isPaused=function(){var e=!1;return null!=this._audio&&(e=this._audio.isPaused),e},n.prototype.play=function(t,n,r){var o=this;return e.SceneManager.HasAudioContext()?this.internalPlay(t,n,r):e.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){o.internalPlay(t,n,r)}),!0},n.prototype.internalPlay=function(e,t,n){var r=this;null!=this._audio&&(this._initializedReadyInstance===!0?this._audio.play(e,t,n):this.onReadyObservable.addOnce(function(){r._audio.play(e,t,n)}))},n.prototype.pause=function(){var e=!1;return null!=this._audio&&(this._audio.pause(),e=!0),e},n.prototype.stop=function(e){var t=!1;return null!=this._audio&&(this._audio.stop(e),t=!0),t},n.prototype.mute=function(e){var t=!1;return null!=this._audio&&(this._lastmutedvolume=this._audio.getVolume(),this._audio.setVolume(0,e)),t},n.prototype.unmute=function(e){var t=!1;return null!=this._audio&&null!=this._lastmutedvolume&&(this._audio.setVolume(this._lastmutedvolume,e),this._lastmutedvolume=null),t},n.prototype.getVolume=function(){var e=0;return e=null!=this._audio?this._audio.getVolume():this._volume},n.prototype.setVolume=function(e,t){var n=!1;return this._volume=e,null!=this._audio&&this._audio.setVolume(this._volume,t),n=!0},n.prototype.getSpatialSound=function(){var e=!1;return null!=this._audio&&(e=this._audio.spatialSound),e},n.prototype.setSpatialSound=function(e){null!=this._audio&&(this._audio.spatialSound=e)},n.prototype.setPlaybackSpeed=function(e){null!=this._audio&&this._audio.setPlaybackRate(e)},n.prototype.getCurrentTrackTime=function(){var e=0;return null!=this._audio&&(e=this._audio.currentTime),e},n.prototype.setDataSource=function(t){var n=this;null!=this._audio&&(this._audio.dispose(),this._audio=null);var r=this._spatialblend>=.1,o="logarithmic"===this._rolloffmode?"exponential":"linear",a=null!=this.transform.metadata&&null!=this.transform.metadata.vtt&&this.transform.metadata.vtt===!0;this._initializedReadyInstance=!1,this._audio=new e.Sound(this._name,t,this.scene,function(){n._lastmutedvolume=n._volume,n._audio.setVolume(n._mute===!0?0:n._volume),n._audio.setPlaybackRate(n._pitch),n._initializedReadyInstance=!0,n.onReadyObservable&&n.onReadyObservable.hasObservers()&&n.onReadyObservable.notifyObservers(n._audio),n._playonawake===!0&&n.play()},{loop:this._loop,autoplay:!1,refDistance:this._mindistance,maxDistance:this._maxdistance,rolloffFactor:e.AudioSource.DEFAULT_ROLLOFF,spatialSound:r,distanceModel:o,streaming:a}),this._audio.setPosition(this.transform.position.clone()),r===!0&&this._audio.attachToMesh(this.transform)},n.prototype.addPreloaderTasks=function(e){var t=this;if(this._preload===!0){var n=e.addBinaryFileTask(this.transform.name+".AudioTask",this._preloaderUrl);n.onSuccess=function(e){t.setDataSource(e.data)},n.onError=function(e,t,n){console.error(t,n)}}},n.MAX_VOLUME=1,n.DEFAULT_LEVEL=1,n.DEFAULT_ROLLOFF=1,n}(e.ScriptComponent);e.AudioSource=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BABYLON;!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.distanceToTarget=0,n.teleporting=!1,n.moveDirection=new e.Vector3(0,0,0),n.resetPosition=new e.Vector3(0,0,0),n.lastPosition=new e.Vector3(0,0,0),n.distancePosition=new e.Vector3(0,0,0),n.currentPosition=new e.Vector3(0,0,0),n.currentRotation=new e.Quaternion(0,0,0,1),n.currentVelocity=new e.Vector3(0,0,0),n.currentWaypoint=new e.Vector3(0,0,0),n.heightOffset=0,n.angularSpeed=0,n.updatePosition=!0,n.updateRotation=!0,n.distanceEpsilon=.1,n.velocityEpsilon=1.1,n.offMeshVelocity=1.5,n.stoppingDistance=0,n.onReadyObservable=new e.Observable,n.onPreUpdateObservable=new e.Observable,n.onPostUpdateObservable=new e.Observable,n.onNavCompleteObservable=new e.Observable,n.m_agentState=0,n.m_agentIndex=-1,n.m_agentReady=!1,n.m_agentGhost=null,n.m_agentParams=null,n.m_agentMovement=new e.Vector3(0,0,0),n.m_agentDirection=new e.Vector3(0,0,1),n.m_agentQuaternion=new e.Quaternion(0,0,0,1),n.m_agentDestination=null,n}return __extends(n,t),n.prototype.isReady=function(){return this.m_agentReady},n.prototype.isNavigating=function(){return null!=this.m_agentDestination},n.prototype.isTeleporting=function(){return this.teleporting},n.prototype.isOnOffMeshLink=function(){return this.m_agentState===e.CrowdAgentState.DT_CROWDAGENT_STATE_OFFMESH},n.prototype.getAgentType=function(){return this.type},n.prototype.getAgentState=function(){return this.m_agentState},n.prototype.getAgentIndex=function(){return this.m_agentIndex},n.prototype.getAgentOffset=function(){return this.baseOffset},n.prototype.getTargetDistance=function(){return this.distanceToTarget},n.prototype.getCurrentPosition=function(){return this.currentPosition},n.prototype.getCurrentRotation=function(){return this.currentRotation},n.prototype.getCurrentVelocity=function(){return this.currentVelocity},n.prototype.getAgentParameters=function(){return this.m_agentParams},n.prototype.setAgentParameters=function(e){this.m_agentParams=e,this.updateAgentParameters()},n.prototype.awake=function(){this.awakeNavigationAgent()},n.prototype.update=function(){this.updateNavigationAgent()},n.prototype.destroy=function(){this.destroyNavigationAgent()},n.prototype.awakeNavigationAgent=function(){this.type=this.getProperty("type",this.type),this.speed=this.getProperty("speed",this.speed),this.baseOffset=this.getProperty("offset",this.baseOffset),this.angularSpeed=this.getProperty("angularspeed",this.angularSpeed),this.acceleration=this.getProperty("acceleration",this.acceleration),this.stoppingDistance=this.getProperty("stoppingdistance",this.stoppingDistance),this.autoBraking=this.getProperty("autobraking",this.autoBraking),this.avoidRadius=this.getProperty("avoidradius",this.avoidRadius),this.avoidHeight=this.getProperty("avoidheight",this.avoidHeight),this.obstacleAvoidanceType=this.getProperty("avoidquality",this.obstacleAvoidanceType),this.avoidancePriority=this.getProperty("avoidpriority",this.avoidancePriority),this.autoTraverseOffMeshLink=this.getProperty("autotraverse",this.autoTraverseOffMeshLink),this.autoRepath=this.getProperty("autopepath",this.autoRepath),this.areaMask=this.getProperty("areamask",this.areaMask),e.Utilities.ValidateTransformQuaternion(this.transform),this.m_agentGhost=new e.TransformNode(this.transform.name+".Agent",this.scene),this.m_agentGhost.position=new e.Vector3(0,0,0),this.m_agentGhost.rotation=new e.Vector3(0,0,0),e.Utilities.ValidateTransformQuaternion(this.m_agentGhost),this.m_agentGhost.position.copyFrom(this.transform.position),
this.lastPosition.copyFrom(this.transform.position)},n.prototype.updateNavigationAgent=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);if(null!=t){if(this.m_agentIndex<0)return this.m_agentParams={radius:this.avoidRadius,height:this.avoidHeight,maxSpeed:this.speed,maxAcceleration:this.acceleration,collisionQueryRange:2,pathOptimizationRange:20,separationWeight:1},e.Utilities.GetAbsolutePositionToRef(this.transform,this.resetPosition),this.m_agentIndex=t.addAgent(this.resetPosition,this.m_agentParams,this.m_agentGhost),void(this.m_agentIndex>=0&&(this.m_agentReady=!0,this.onReadyObservable&&this.onReadyObservable.hasObservers()&&this.onReadyObservable.notifyObservers(this.transform)));if(this.m_agentState=t.getAgentState(this.m_agentIndex),this.getAgentWaypointToRef(this.currentWaypoint),this.getAgentPositionToRef(this.currentPosition),this.distancePosition.copyFrom(this.currentPosition),this.isOnOffMeshLink()?(this.currentPosition.subtractToRef(this.lastPosition,this.currentVelocity),this.currentVelocity.scaleInPlace(this.speed*this.offMeshVelocity)):this.getAgentVelocityToRef(this.currentVelocity),this.onPreUpdateObservable&&this.onPreUpdateObservable.hasObservers()&&this.onPreUpdateObservable.notifyObservers(this.transform),this.currentPosition.y+=this.baseOffset+this.heightOffset,this.currentVelocity.length()>=this.velocityEpsilon){this.currentVelocity.normalize();var n=this.angularSpeed*e.NavigationAgent.ANGULAR_SPEED_RATIO*this.getDeltaSeconds();if(this.isOnOffMeshLink()){this.moveDirection.copyFrom(this.m_agentDirection),this.m_agentDirection.set(this.moveDirection.x+(this.currentVelocity.x-this.moveDirection.x),this.moveDirection.y+(this.currentVelocity.y-this.moveDirection.y),this.moveDirection.z+(this.currentVelocity.z-this.moveDirection.z)),this.m_agentDirection.normalize();var r=e.NavigationAgent.TARGET_ANGLE_FACTOR-Math.atan2(this.m_agentDirection.x,this.m_agentDirection.z);e.Quaternion.FromEulerAnglesToRef(0,r,0,this.currentRotation),this.isNavigating()&&this.updateRotation===!0&&e.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.currentRotation,n,this.transform.rotationQuaternion)}else this.m_agentQuaternion.copyFrom(this.transform.rotationQuaternion),this.isNavigating()&&this.updateRotation===!0&&this.transform.lookAt(this.currentWaypoint),this.transform.rotationQuaternion.toEulerAnglesToRef(this.m_agentDirection),e.Quaternion.FromEulerAnglesToRef(0,this.m_agentDirection.y,0,this.currentRotation),this.isNavigating()&&this.updateRotation===!0&&e.Quaternion.SlerpToRef(this.m_agentQuaternion,this.currentRotation,n,this.transform.rotationQuaternion)}this.isNavigating()&&this.updatePosition===!0&&this.transform.position.copyFrom(this.currentPosition),this.isNavigating()?(this.distanceToTarget=e.Vector3.Distance(this.distancePosition,this.m_agentDestination),this.distanceToTarget<=Math.max(this.distanceEpsilon,this.stoppingDistance)&&(this.cancelNavigation(),this.onNavCompleteObservable&&this.onNavCompleteObservable.hasObservers()&&this.onNavCompleteObservable.notifyObservers(this.transform))):this.distanceToTarget=0,this.lastPosition.copyFrom(this.currentPosition),this.onPostUpdateObservable&&this.onPostUpdateObservable.hasObservers()&&this.onPostUpdateObservable.notifyObservers(this.transform),this.teleporting=!1}},n.prototype.updateAgentParameters=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);null!=t&&this.m_agentIndex>=0&&t.updateAgentParameters(this.m_agentIndex,this.m_agentParams)},n.prototype.destroyNavigationAgent=function(){this.m_agentIndex=-1,this.m_agentReady=!1,this.m_agentMovement=null,this.m_agentDirection=null,this.m_agentDestination=null,this.moveDirection=null,this.resetPosition=null,this.lastPosition=null,this.currentPosition=null,this.currentRotation=null,this.currentVelocity=null,this.currentWaypoint=null,this.onReadyObservable.clear(),this.onReadyObservable=null,this.onPreUpdateObservable.clear(),this.onPreUpdateObservable=null,this.onPostUpdateObservable.clear(),this.onPostUpdateObservable=null,this.onNavCompleteObservable.clear(),this.onNavCompleteObservable=null,null!=this.m_agentGhost&&(this.m_agentGhost.dispose(),this.m_agentGhost=null)},n.prototype.move=function(t,n){void 0===n&&(n=!0);var r=e.SceneManager.GetNavigationTools(),o=e.SceneManager.GetCrowdInterface(this.scene);null!=r&&null!=o?(o.getAgentPosition(this.m_agentIndex).addToRef(t,this.m_agentMovement),n===!0?this.m_agentDestination=r.getClosestPoint(this.m_agentMovement):this.m_agentDestination=this.m_agentMovement.clone(),this.m_agentIndex>=0&&o.agentGoto(this.m_agentIndex,this.m_agentDestination)):e.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.teleport=function(t,n){void 0===n&&(n=!0);var r=e.SceneManager.GetNavigationTools(),o=e.SceneManager.GetCrowdInterface(this.scene);null!=r&&null!=o?(this.teleporting=!0,n===!0?this.m_agentDestination=r.getClosestPoint(t):this.m_agentDestination=t.clone(),this.m_agentIndex>=0&&o.agentTeleport(this.m_agentIndex,this.m_agentDestination)):e.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.setDestination=function(t,n){void 0===n&&(n=!0);var r=e.SceneManager.GetNavigationTools(),o=e.SceneManager.GetCrowdInterface(this.scene);null!=r&&null!=o?(n===!0?this.m_agentDestination=r.getClosestPoint(t):this.m_agentDestination=t.clone(),this.m_agentIndex>=0&&o.agentGoto(this.m_agentIndex,this.m_agentDestination)):e.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.getAgentVelocity=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);return null!=t&&this.m_agentIndex>=0?t.getAgentVelocity(this.m_agentIndex):null},n.prototype.getAgentVelocityToRef=function(t){var n=e.SceneManager.GetCrowdInterface(this.scene);null!=n&&this.m_agentIndex>=0&&n.getAgentVelocityToRef(this.m_agentIndex,t)},n.prototype.getAgentPosition=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);return null!=t&&this.m_agentIndex>=0?t.getAgentPosition(this.m_agentIndex):null},n.prototype.getAgentPositionToRef=function(t){var n=e.SceneManager.GetCrowdInterface(this.scene);null!=n&&this.m_agentIndex>=0&&n.getAgentPositionToRef(this.m_agentIndex,t)},n.prototype.getAgentWaypoint=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);return null!=t&&this.m_agentIndex>=0?t.getAgentNextTargetPath(this.m_agentIndex):null},n.prototype.getAgentWaypointToRef=function(t){var n=e.SceneManager.GetCrowdInterface(this.scene);null!=n&&this.m_agentIndex>=0&&n.getAgentNextTargetPathToRef(this.m_agentIndex,t)},n.prototype.cancelNavigation=function(){this.m_agentDestination=null;var t=e.SceneManager.GetCrowdInterface(this.scene),n=this.getAgentPosition();null!=n&&null!=t&&this.m_agentIndex>=0&&t.agentTeleport(this.m_agentIndex,n)},n.TARGET_ANGLE_FACTOR=.5*Math.PI,n.ANGULAR_SPEED_RATIO=.05,n}(e.ScriptComponent);e.NavigationAgent=t;var n;!function(e){e[e.DT_CROWDAGENT_STATE_INVALID=0]="DT_CROWDAGENT_STATE_INVALID",e[e.DT_CROWDAGENT_STATE_WALKING=1]="DT_CROWDAGENT_STATE_WALKING",e[e.DT_CROWDAGENT_STATE_OFFMESH=2]="DT_CROWDAGENT_STATE_OFFMESH"}(n=e.CrowdAgentState||(e.CrowdAgentState={}))}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BABYLON;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.awake=function(){},t.prototype.start=function(){},t.prototype.ready=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.fixed=function(){},t.prototype.destroy=function(){},t}(e.ScriptComponent);e.ShurikenParticles=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BABYLON;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.awake=function(){},t.prototype.start=function(){},t.prototype.fixed=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.ready=function(){},t.prototype.destroy=function(){},t}(e.ScriptComponent);e.TerrainGenerator=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BABYLON;!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.videoLoop=!1,n.videoMuted=!1,n.videoAlpha=!1,n.videoFaded=!1,n.videoPoster=null,n.videoInvert=!0,n.videoSample=3,n.videoVolume=1,n.videoMipmaps=!1,n.videoPlayback=1,n.videoPlayOnAwake=!0,n.videoPreloaderUrl=null,n.videoBlobUrl=null,n.videoPreload=!1,n._initializedReadyInstance=!1,n.onReadyObservable=new e.Observable,n.m_abstractMesh=null,n.m_videoTexture=null,n.m_videoMaterial=null,n.m_diffuseIntensity=1,n}return __extends(n,t),n.prototype.getVideoMaterial=function(){return this.m_videoMaterial},n.prototype.getVideoTexture=function(){return this.m_videoTexture},n.prototype.getVideoElement=function(){return null!=this.m_videoTexture?this.m_videoTexture.video:null},n.prototype.getVideoScreen=function(){return this.m_abstractMesh},n.prototype.getVideoBlobUrl=function(){return this.videoBlobUrl},n.prototype.awake=function(){this.awakeWebVideoPlayer()},n.prototype.destroy=function(){this.destroyWebVideoPlayer()},n.prototype.awakeWebVideoPlayer=function(){this.videoLoop=this.getProperty("looping",!1),this.videoMuted=this.getProperty("muted",!1),this.videoInvert=this.getProperty("inverty",!0),this.videoSample=this.getProperty("sampling",3),this.videoVolume=this.getProperty("volume",1),this.videoMipmaps=this.getProperty("mipmaps",!1),this.videoAlpha=this.getProperty("texturealpha",!1),this.videoFaded=this.getProperty("diffusealpha",!1),this.videoPlayback=this.getProperty("playbackspeed",1),this.videoPlayOnAwake=this.getProperty("playonawake",!0),this.videoPreload=this.getProperty("preload",this.videoPreload),this.m_diffuseIntensity=this.getProperty("intensity",1),this.m_abstractMesh=this.getAbstractMesh();var t=this.getProperty("poster");t===!0&&null!=this.m_abstractMesh&&null!=this.m_abstractMesh.material&&(this.m_abstractMesh.material instanceof e.PBRMaterial?null!=this.m_abstractMesh.material.albedoTexture&&null!=this.m_abstractMesh.material.albedoTexture.url&&""!==this.m_abstractMesh.material.albedoTexture.url&&(this.videoPoster=this.m_abstractMesh.material.albedoTexture.url.replace("data:","")):this.m_abstractMesh.material instanceof e.StandardMaterial&&null!=this.m_abstractMesh.material.diffuseTexture&&null!=this.m_abstractMesh.material.diffuseTexture.url&&""!==this.m_abstractMesh.material.diffuseTexture.url&&(this.videoPoster=this.m_abstractMesh.material.diffuseTexture.url.replace("data:","")));var n=this.getProperty("url",null),r=this.getProperty("source",null),o=n;if(null!=r&&null!=r.filename&&""!==r.filename){var a=e.SceneManager.GetRootUrl(this.scene);o=a+r.filename}null!=o&&""!==o&&(this.videoPreload===!0?this.videoPreloaderUrl=o:this.setDataSource(o))},n.prototype.destroyWebVideoPlayer=function(){this.m_abstractMesh=null,null!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),null!=this.m_videoMaterial&&(this.m_videoMaterial.dispose(),this.m_videoMaterial=null),this.revokeVideoBlobUrl()},n.prototype.isReady=function(){return null!=this.getVideoElement()},n.prototype.isPlaying=function(){var e=!1,t=this.getVideoElement();return null!=t&&(e=t.paused===!1),e},n.prototype.isPaused=function(){var e=!1,t=this.getVideoElement();return null!=t&&(e=t.paused===!0),e},n.prototype.play=function(){var t=this;return e.SceneManager.HasAudioContext()?this.internalPlay():e.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){t.internalPlay()}),!0},n.prototype.internalPlay=function(){var e=this;this._initializedReadyInstance===!0?this.checkedPlay():this.onReadyObservable.addOnce(function(){e.checkedPlay()})},n.prototype.checkedPlay=function(){var e=this,t=this.getVideoElement();null!=t&&t.play().then(function(){t.paused===!0&&e.checkedRePlay()})},n.prototype.checkedRePlay=function(){var e=this.getVideoElement();null!=e&&e.play().then(function(){})},n.prototype.pause=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.pause(),e=!0),e},n.prototype.mute=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.muted=!0,e=!0),e},n.prototype.unmute=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.muted=!1,e=!0),e},n.prototype.getVolume=function(){var e=0,t=this.getVideoElement();return null!=t&&(e=t.volume),e},n.prototype.setVolume=function(e){var t=!1,n=this.getVideoElement();return null!=n&&(n.volume=e,t=!0),t},n.prototype.setDataSource=function(t){var n=this;null!=this.m_abstractMesh&&(null==this.m_videoMaterial&&(this.m_videoMaterial=new e.StandardMaterial(this.transform.name+".VideoMat",this.scene),this.m_videoMaterial.roughness=1,this.m_videoMaterial.diffuseColor=new e.Color3(1,1,1),this.m_videoMaterial.emissiveColor=new e.Color3(1,1,1),this.m_videoMaterial.useAlphaFromDiffuseTexture=this.videoFaded,this.m_abstractMesh.material=this.m_videoMaterial),null!=this.m_videoMaterial?(this.m_videoMaterial.diffuseTexture=null,null!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),this._initializedReadyInstance=!1,this.m_videoTexture=new e.VideoTexture(this.transform.name+".VideoTex",t,this.scene,this.videoMipmaps,this.videoInvert,this.videoSample,{autoUpdateTexture:!0,poster:this.videoPoster}),null!=this.m_videoTexture&&(this.m_videoTexture.hasAlpha=this.videoAlpha,null!=this.m_videoTexture.video&&(this.m_videoTexture.video.loop=this.videoLoop,this.m_videoTexture.video.muted=this.videoMuted,this.m_videoTexture.video.volume=this.videoVolume,this.m_videoTexture.video.playbackRate=this.videoPlayback,this.m_videoTexture.video.addEventListener("loadeddata",function(){n._initializedReadyInstance=!0,n.onReadyObservable&&n.onReadyObservable.hasObservers()&&n.onReadyObservable.notifyObservers(n.m_videoTexture),n.videoPlayOnAwake===!0&&n.play()}),this.m_videoTexture.video.load())),null!=this.m_videoTexture&&(this.m_videoTexture.level=this.m_diffuseIntensity,this.m_videoMaterial.diffuseTexture=this.m_videoTexture)):e.Tools.Warn("No video mesh or material available for: "+this.transform.name))},n.prototype.revokeVideoBlobUrl=function(){null!=this.videoBlobUrl&&(URL.revokeObjectURL(this.videoBlobUrl),this.videoBlobUrl=null)},n.prototype.addPreloaderTasks=function(e){var t=this;if(this.videoPreload===!0){var n=e.addBinaryFileTask(this.transform.name+".VideoTask",this.videoPreloaderUrl);n.onSuccess=function(e){t.revokeVideoBlobUrl(),t.videoBlobUrl=URL.createObjectURL(new Blob([e.data])),t.setDataSource(t.videoBlobUrl)},n.onError=function(e,t,n){console.error(t,n)}}},n}(e.ScriptComponent);e.WebVideoPlayer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.ConfigureUserInput=function(t,n){void 0===n&&(n=null);var r=null==n||null==n.contextMenu||n.contextMenu,o=null!=n&&null!=n.pointerLock&&n.pointerLock,a=null!=n&&null!=n.preventDefault&&n.preventDefault,i=null!=n&&null!=n.useCapture&&n.useCapture;if(e.InputController.resetUserInput(),!e.InputController.input){document.documentElement.tabIndex=1,document.documentElement.addEventListener("keyup",e.InputController.inputKeyUpHandler,i),document.documentElement.addEventListener("pointerup",e.InputController.inputPointerUpHandler,i);var l=document.getElementById("renderingCanvas")||t.getEngine().getRenderingCanvas();null!=l&&(r===!0?(e.Tools.Log("Canvas element context menu enabled."),l.oncontextmenu=null):(l.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation()},e.Tools.Log("Canvas element context menu disabled."))),e.UserInputOptions.UseCanvasElement===!0?(l.tabIndex=2,l.addEventListener("focusout",e.InputController.resetKeyMapHandler,i),l.addEventListener("keydown",e.InputController.inputKeyDownHandler,i),l.addEventListener("pointerdown",e.InputController.inputPointerDownHandler,i),l.addEventListener("pointermove",e.InputController.inputPointerMoveHandler,i),l.addEventListener("onwheel"in document?"wheel":"mousewheel",e.InputController.inputPointerWheelHandler,i)):(document.documentElement.addEventListener("focusout",e.InputController.resetKeyMapHandler,i),document.documentElement.addEventListener("keydown",e.InputController.inputKeyDownHandler,i),document.documentElement.addEventListener("pointerdown",e.InputController.inputPointerDownHandler,i),document.documentElement.addEventListener("pointermove",e.InputController.inputPointerMoveHandler,i),document.documentElement.addEventListener("onwheel"in document?"wheel":"mousewheel",e.InputController.inputPointerWheelHandler,i)),e.InputController.preventDefault=a,null==e.InputController.GamepadManager&&(e.InputController.GamepadManager=new e.GamepadManager,e.InputController.GamepadManager.onGamepadConnectedObservable.add(e.InputController.inputManagerGamepadConnected),e.InputController.GamepadManager.onGamepadDisconnectedObservable.add(e.InputController.inputManagerGamepadDisconnected)),e.InputController.input=!0,document.documentElement.focus(),o===!0&&e.InputController.LockMousePointer(t,!0)}t.registerAfterRender(function(){e.InputController.updateUserInput(t)})},t.SetLeftJoystickBuffer=function(t,n,r){void 0===r&&(r=!0),e.InputController.j_horizontal=t,e.InputController.j_vertical=r===!0?-n:n},t.SetRightJoystickBuffer=function(t,n,r){void 0===r&&(r=!0),e.InputController.j_mousex=t,e.InputController.j_mousey=r===!0?-n:n},t.DisableUserInput=function(t,n){void 0===n&&(n=!1),e.InputController.LockMousePointer(t,!1),e.InputController.resetUserInput()},t.LockMousePointer=function(t,n){n===!0?e.InputController.LockMousePointerObserver=t.onPointerObservable.add(function(n,r){n.type==e.PointerEventTypes.POINTERDOWN&&(document.pointerLockElement||t.getEngine().enterPointerlock())}):e.InputController.IsPointerLockHandled()&&(t.onPointerObservable.remove(e.InputController.LockMousePointerObserver),e.InputController.LockMousePointerObserver=null)},t.IsPointerLocked=function(){return e.InputController.PointerLockedFlag},t.IsPointerLockHandled=function(){return null!=e.InputController.LockMousePointerObserver},t.GetUserInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var r=0;if(e.InputController.input)switch(t){case e.UserInputAxis.Vertical:case e.UserInputAxis.Horizontal:r=n===e.PlayerNumber.Four?t===e.UserInputAxis.Horizontal?e.InputController.horizontal4:e.InputController.vertical4:n===e.PlayerNumber.Three?t===e.UserInputAxis.Horizontal?e.InputController.horizontal3:e.InputController.vertical3:n===e.PlayerNumber.Two?t===e.UserInputAxis.Horizontal?e.InputController.horizontal2:e.InputController.vertical2:t===e.UserInputAxis.Horizontal?e.InputController.horizontal:e.InputController.vertical;break;case e.UserInputAxis.MouseX:case e.UserInputAxis.MouseY:r=n===e.PlayerNumber.Four?t===e.UserInputAxis.MouseX?e.InputController.mousex4:e.InputController.mousey4:n===e.PlayerNumber.Three?t===e.UserInputAxis.MouseX?e.InputController.mousex3:e.InputController.mousey3:n===e.PlayerNumber.Two?t===e.UserInputAxis.MouseX?e.InputController.mousex2:e.InputController.mousey2:t===e.UserInputAxis.MouseX?e.InputController.mousex:e.InputController.mousey;break;case e.UserInputAxis.Wheel:n===e.PlayerNumber.One&&(r=e.InputController.wheel)}return r},t.OnKeyboardUp=function(t){e.InputController.input&&e.InputController.keyButtonUp.push(t)},t.OnKeyboardDown=function(t){e.InputController.input&&e.InputController.keyButtonDown.push(t)},t.OnKeyboardPress=function(t,n){e.InputController.input&&e.InputController.keyButtonPress.push({index:t,action:n})},t.GetKeyboardInput=function(t){var n=!1;if(e.InputController.input){var r="k:"+t.toString();null!=e.InputController.keymap[r]&&(n=e.InputController.keymap[r])}return n},t.OnPointerUp=function(t){e.InputController.input&&e.InputController.mouseButtonUp.push(t)},t.OnPointerDown=function(t){e.InputController.input&&e.InputController.mouseButtonDown.push(t)},t.OnPointerPress=function(t,n){e.InputController.input&&e.InputController.mouseButtonPress.push({index:t,action:n})},t.GetPointerInput=function(t){var n=!1;if(e.InputController.input){var r="p:"+t.toString();null!=e.InputController.keymap[r]&&(n=e.InputController.keymap[r])}return n},t.IsWheelScrolling=function(){return 0!==e.InputController.scroll},t.OnGamepadButtonUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1ButtonUp.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonUp.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonUp.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonUp.push(t)}},t.OnGamepadButtonDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1ButtonDown.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonDown.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonDown.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonDown.push(t)}},t.OnGamepadButtonPress=function(t,n,r){if(void 0===r&&(r=e.PlayerNumber.One),e.InputController.input)switch(r){case e.PlayerNumber.One:e.InputController.gamepad1ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonPress.push({index:t,action:n})}},t.GetGamepadButtonInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var r=!1;if(e.InputController.input){var o=null;switch(n){case e.PlayerNumber.One:o="b1:"+t.toString();break;case e.PlayerNumber.Two:o="b2:"+t.toString();break;case e.PlayerNumber.Three:o="b3:"+t.toString();break;case e.PlayerNumber.Four:o="b4:"+t.toString()}null!=o&&null!=e.InputController.keymap[o]&&(r=e.InputController.keymap[o])}return r},t.OnGamepadDirectionUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1DpadUp.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadUp.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadUp.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadUp.push(t)}},t.OnGamepadDirectionDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1DpadDown.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadDown.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadDown.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadDown.push(t)}},t.OnGamepadDirectionPress=function(t,n,r){if(void 0===r&&(r=e.PlayerNumber.One),e.InputController.input)switch(r){case e.PlayerNumber.One:e.InputController.gamepad1DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadPress.push({index:t,action:n})}},t.GetGamepadDirectionInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var r=!1;if(e.InputController.input){var o=null;switch(n){case e.PlayerNumber.One:o="d1:"+t.toString();break;case e.PlayerNumber.Two:o="d2:"+t.toString();break;case e.PlayerNumber.Three:o="d3:"+t.toString();break;case e.PlayerNumber.Four:o="d4:"+t.toString()}null!=o&&null!=e.InputController.keymap[o]&&(r=e.InputController.keymap[o])}return r},t.OnGamepadTriggerLeft=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1LeftTrigger.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2LeftTrigger.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3LeftTrigger.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4LeftTrigger.push(t)}},t.OnGamepadTriggerRight=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1RightTrigger.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2RightTrigger.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3RightTrigger.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4RightTrigger.push(t)}},t.GetGamepadTriggerInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var r=0;if(e.InputController.input){var o=null;switch(n){case e.PlayerNumber.One:o="t1:"+t.toString();break;case e.PlayerNumber.Two:o="t2:"+t.toString();break;case e.PlayerNumber.Three:o="t3:"+t.toString();break;case e.PlayerNumber.Four:o="t4:"+t.toString()}null!=o&&null!=e.InputController.keymap[o]&&(r=e.InputController.keymap[o])}return r},t.GetGamepadType=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=e.GamepadType.None;if(e.InputController.input)switch(t){case e.PlayerNumber.One:n=e.InputController.gamepad1Type;break;case e.PlayerNumber.Two:n=e.InputController.gamepad2Type;break;case e.PlayerNumber.Three:n=e.InputController.gamepad3Type;break;case e.PlayerNumber.Four:n=e.InputController.gamepad4Type}return n},t.GetGamepad=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(e.InputController.input)switch(t){case e.PlayerNumber.One:n=e.InputController.gamepad1;break;case e.PlayerNumber.Two:n=e.InputController.gamepad2;break;case e.PlayerNumber.Three:n=e.InputController.gamepad3;break;case e.PlayerNumber.Four:n=e.InputController.gamepad4}return n},t.tickKeyboardInput=function(t){if(e.SceneManager.EnableUserInput!==!1){var n=e.InputController.GetKeyboardInput(e.UserInputKey.W)||e.InputController.GetKeyboardInput(e.UserInputKey.UpArrow),r=e.InputController.GetKeyboardInput(e.UserInputKey.A),o=e.InputController.GetKeyboardInput(e.UserInputKey.S)||e.InputController.GetKeyboardInput(e.UserInputKey.DownArrow),a=e.InputController.GetKeyboardInput(e.UserInputKey.D),i=e.InputController.GetKeyboardInput(e.UserInputKey.LeftArrow),l=e.InputController.GetKeyboardInput(e.UserInputKey.RightArrow);n===!0?e.InputController.k_vertical=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_vertical,1):o===!0?e.InputController.k_vertical=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_vertical,-1):e.InputController.k_vertical=0,e.UserInputOptions.UseArrowKeyRotation===!0?(a===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,1):r===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,-1):e.InputController.k_horizontal=0,l===!0?e.InputController.a_mousex=1:i===!0?e.InputController.a_mousex=-1:e.InputController.a_mousex=0):a===!0||l===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,1):r===!0||i===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,-1):e.InputController.k_horizontal=0}},t.updateUserInput=function(t){e.SceneManager.EnableUserInput!==!1&&(e.InputController.PointerLockedFlag=t.getEngine().isPointerLock,e.InputController.tickKeyboardInput(t),e.InputController.x_horizontal=0,e.InputController.x_vertical=0,e.InputController.x_mousex=0,e.InputController.x_mousey=0,0!==e.InputController.j_horizontal?e.InputController.x_horizontal=e.InputController.j_horizontal:0!==e.InputController.g_horizontal1?e.InputController.x_horizontal=e.InputController.g_horizontal1:0!==e.InputController.k_horizontal&&(e.InputController.x_horizontal=e.InputController.k_horizontal),0!==e.InputController.j_vertical?e.InputController.x_vertical=e.InputController.j_vertical:0!==e.InputController.g_vertical1?e.InputController.x_vertical=e.InputController.g_vertical1:0!==e.InputController.k_vertical&&(e.InputController.x_vertical=e.InputController.k_vertical),0!==e.InputController.j_mousex?e.InputController.x_mousex=e.InputController.j_mousex:0!==e.InputController.g_mousex1?e.InputController.x_mousex=e.InputController.g_mousex1:0!==e.InputController.a_mousex?e.InputController.x_mousex=e.InputController.a_mousex:0!==e.InputController.k_mousex&&(e.InputController.x_mousex=e.InputController.k_mousex),0!==e.InputController.j_mousey?e.InputController.x_mousey=e.InputController.j_mousey:0!==e.InputController.g_mousey1?e.InputController.x_mousey=e.InputController.g_mousey1:0!==e.InputController.k_mousey&&(e.InputController.x_mousey=e.InputController.k_mousey),e.InputController.horizontal=e.InputController.x_horizontal,e.InputController.vertical=e.InputController.x_vertical,e.InputController.mousex=e.InputController.x_mousex,e.InputController.mousey=e.InputController.x_mousey,e.InputController.scroll=e.InputController.x_scroll,e.InputController.wheel=e.InputController.x_wheel,e.InputController.horizontal2=e.InputController.g_horizontal2,e.InputController.vertical2=e.InputController.g_vertical2,e.InputController.mousex2=e.InputController.g_mousex2,e.InputController.mousey2=e.InputController.g_mousey2,e.InputController.horizontal3=e.InputController.g_horizontal3,e.InputController.vertical3=e.InputController.g_vertical3,e.InputController.mousex3=e.InputController.g_mousex3,e.InputController.mousey3=e.InputController.g_mousey3,e.InputController.horizontal4=e.InputController.g_horizontal4,e.InputController.vertical4=e.InputController.g_vertical4,e.InputController.mousex4=e.InputController.g_mousex4,e.InputController.mousey4=e.InputController.g_mousey4,e.InputController.k_mousex=0,e.InputController.k_mousey=0,e.InputController.x_mousey=0,e.InputController.x_scroll=0)},t.resetUserInput=function(){e.InputController.input=!1,e.InputController.keymap={},e.InputController.scroll=0,e.InputController.wheel=0,e.InputController.mousex=0,e.InputController.mousey=0,e.InputController.vertical=0,e.InputController.horizontal=0,e.InputController.mousex2=0,e.InputController.mousey2=0,e.InputController.vertical2=0,e.InputController.horizontal2=0,e.InputController.mousex3=0,e.InputController.mousey3=0,e.InputController.vertical3=0,e.InputController.horizontal3=0,e.InputController.mousex4=0,e.InputController.mousey4=0,e.InputController.vertical4=0,e.InputController.horizontal4=0,e.InputController.a_mousex=0,e.InputController.x_scroll=0,e.InputController.x_wheel=0,e.InputController.x_mousex=0,e.InputController.x_mousey=0,e.InputController.x_vertical=0,e.InputController.x_horizontal=0,e.InputController.k_mousex=0,e.InputController.k_mousey=0,e.InputController.k_vertical=0,e.InputController.k_horizontal=0,
e.InputController.j_mousex=0,e.InputController.j_mousey=0,e.InputController.j_vertical=0,e.InputController.j_horizontal=0,e.InputController.g_mousex1=0,e.InputController.g_mousey1=0,e.InputController.g_vertical1=0,e.InputController.g_horizontal1=0,e.InputController.g_mousex2=0,e.InputController.g_mousey2=0,e.InputController.g_vertical2=0,e.InputController.g_horizontal2=0,e.InputController.g_mousex3=0,e.InputController.g_mousey3=0,e.InputController.g_vertical3=0,e.InputController.g_horizontal3=0,e.InputController.g_mousex4=0,e.InputController.g_mousey4=0,e.InputController.g_vertical4=0,e.InputController.g_horizontal4=0,e.InputController.preventDefault=!1,e.InputController.mouseButtonUp=[],e.InputController.mouseButtonDown=[],e.InputController.mouseButtonPress=[],e.InputController.keyButtonUp=[],e.InputController.keyButtonDown=[],e.InputController.keyButtonPress=[],e.InputController.gamepad1ButtonUp=[],e.InputController.gamepad1ButtonDown=[],e.InputController.gamepad1ButtonPress=[],e.InputController.gamepad1DpadUp=[],e.InputController.gamepad1DpadDown=[],e.InputController.gamepad1DpadPress=[],e.InputController.gamepad1LeftTrigger=[],e.InputController.gamepad1RightTrigger=[],e.InputController.gamepad2ButtonUp=[],e.InputController.gamepad2ButtonDown=[],e.InputController.gamepad2ButtonPress=[],e.InputController.gamepad2DpadUp=[],e.InputController.gamepad2DpadDown=[],e.InputController.gamepad2DpadPress=[],e.InputController.gamepad2LeftTrigger=[],e.InputController.gamepad2RightTrigger=[],e.InputController.gamepad3ButtonUp=[],e.InputController.gamepad3ButtonDown=[],e.InputController.gamepad3ButtonPress=[],e.InputController.gamepad3DpadUp=[],e.InputController.gamepad3DpadDown=[],e.InputController.gamepad3DpadPress=[],e.InputController.gamepad3LeftTrigger=[],e.InputController.gamepad3RightTrigger=[],e.InputController.gamepad4ButtonUp=[],e.InputController.gamepad4ButtonDown=[],e.InputController.gamepad4ButtonPress=[],e.InputController.gamepad4DpadUp=[],e.InputController.gamepad4DpadDown=[],e.InputController.gamepad4DpadPress=[],e.InputController.gamepad4LeftTrigger=[],e.InputController.gamepad4RightTrigger=[],e.InputController.previousPosition=null},t.resetKeyMapHandler=function(t){e.InputController.keymap={}},t.inputKeyDownHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n="k:"+t.keyCode.toString(),r=!1;return null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.keyButtonDown&&e.InputController.keyButtonDown.length>0&&e.InputController.keyButtonDown.forEach(function(e){e(t.keyCode)}),r||null!=e.InputController.keyButtonPress&&e.InputController.keyButtonPress.length>0&&e.InputController.keyButtonPress.forEach(function(e){e.index===t.keyCode&&e.action()}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputKeyUpHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n="k:"+t.keyCode.toString();return e.InputController.keymap[n]=!1,null!=e.InputController.keyButtonUp&&e.InputController.keyButtonUp.length>0&&e.InputController.keyButtonUp.forEach(function(e){e(t.keyCode)}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerWheelHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n=t.deltaY?-t.deltaY:t.wheelDelta/40;return e.InputController.x_scroll=1,e.InputController.x_wheel=Math.abs(n)>e.UserInputOptions.PointerWheelDeadZone?0+n:0,e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerDownHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;e.InputController.previousPosition={x:t.clientX,y:t.clientY};var n="p:"+t.button.toString(),r=!1;return null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.mouseButtonDown&&e.InputController.mouseButtonDown.length>0&&e.InputController.mouseButtonDown.forEach(function(e){e(t.button)}),r||null!=e.InputController.mouseButtonPress&&e.InputController.mouseButtonPress.length>0&&e.InputController.mouseButtonPress.forEach(function(e){e.index===t.button&&e.action()}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerUpHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;e.InputController.previousPosition=null,e.InputController.k_mousex=0,e.InputController.k_mousey=0;var n="p:"+t.button.toString();return e.InputController.keymap[n]=!1,null!=e.InputController.mouseButtonUp&&e.InputController.mouseButtonUp.length>0&&e.InputController.mouseButtonUp.forEach(function(e){e(t.button)}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerMoveHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;if(e.SceneManager.VirtualJoystickEnabled===!1){var n=0,r=0;e.InputController.IsPointerLocked()?(n=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,r=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0,e.InputController.previousPosition=null):null!=e.InputController.previousPosition&&(n=t.clientX-e.InputController.previousPosition.x,r=t.clientY-e.InputController.previousPosition.y,e.InputController.previousPosition={x:t.clientX,y:t.clientY}),e.UserInputOptions.PointerMouseInverted===!0&&(n*=-1,r*=-1),e.InputController.rightHanded&&(n*=-1);var o=n*e.UserInputOptions.PointerAngularSensibility*e.InputController.MOUSE_DAMPENER,a=r*e.UserInputOptions.PointerAngularSensibility*e.InputController.MOUSE_DAMPENER;Math.abs(n)<=e.UserInputOptions.PointerMouseDeadZone&&(o=0),Math.abs(r)<=e.UserInputOptions.PointerMouseDeadZone&&(a=0),o=e.Scalar.Clamp(o,-1,1),a=e.Scalar.Clamp(a,-1,1),e.InputController.k_mousex+=o,e.InputController.k_mousey+=a}return e.InputController.preventDefault&&t.preventDefault(),!0},t.inputOneButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="b1:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1ButtonDown&&e.InputController.gamepad1ButtonDown.length>0&&e.InputController.gamepad1ButtonDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad1ButtonPress&&e.InputController.gamepad1ButtonPress.length>0&&e.InputController.gamepad1ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="b1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1ButtonUp&&e.InputController.gamepad1ButtonUp.length>0&&e.InputController.gamepad1ButtonUp.forEach(function(e){e(t)})}},t.inputOneXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1DpadDown&&e.InputController.gamepad1DpadDown.length>0&&e.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad1DpadPress&&e.InputController.gamepad1DpadPress.length>0&&e.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1DpadDown&&e.InputController.gamepad1DpadDown.length>0&&e.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad1DpadPress&&e.InputController.gamepad1DpadPress.length>0&&e.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1DpadUp&&e.InputController.gamepad1DpadUp.length>0&&e.InputController.gamepad1DpadUp.forEach(function(e){e(t)})}},t.inputOneShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1DpadUp&&e.InputController.gamepad1DpadUp.length>0&&e.InputController.gamepad1DpadUp.forEach(function(e){e(t)})}},t.inputOneXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1&&(e.InputController.keymap["t1:0"]=t,null!=e.InputController.gamepad1LeftTrigger&&e.InputController.gamepad1LeftTrigger.length>0&&e.InputController.gamepad1LeftTrigger.forEach(function(e){e(t)}))},t.inputOneXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1&&(e.InputController.keymap["t1:1"]=t,null!=e.InputController.gamepad1RightTrigger&&e.InputController.gamepad1RightTrigger.length>0&&e.InputController.gamepad1RightTrigger.forEach(function(e){e(t)}))},t.inputOneLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n=t,r=n.x*e.UserInputOptions.GamepadLStickSensibility,o=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal1=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical1=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputOneRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n=t,r=n.x*e.UserInputOptions.GamepadRStickSensibility,o=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex1=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey1=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputTwoButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="b2:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2ButtonDown&&e.InputController.gamepad2ButtonDown.length>0&&e.InputController.gamepad2ButtonDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad2ButtonPress&&e.InputController.gamepad2ButtonPress.length>0&&e.InputController.gamepad2ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="b2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2ButtonUp&&e.InputController.gamepad2ButtonUp.length>0&&e.InputController.gamepad2ButtonUp.forEach(function(e){e(t)})}},t.inputTwoXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2DpadDown&&e.InputController.gamepad2DpadDown.length>0&&e.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad2DpadPress&&e.InputController.gamepad2DpadPress.length>0&&e.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2DpadDown&&e.InputController.gamepad2DpadDown.length>0&&e.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad2DpadPress&&e.InputController.gamepad2DpadPress.length>0&&e.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2DpadUp&&e.InputController.gamepad2DpadUp.length>0&&e.InputController.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2DpadUp&&e.InputController.gamepad2DpadUp.length>0&&e.InputController.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2&&(e.InputController.keymap["t2:0"]=t,null!=e.InputController.gamepad2LeftTrigger&&e.InputController.gamepad2LeftTrigger.length>0&&e.InputController.gamepad2LeftTrigger.forEach(function(e){e(t)}))},t.inputTwoXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2&&(e.InputController.keymap["t2:1"]=t,null!=e.InputController.gamepad2RightTrigger&&e.InputController.gamepad2RightTrigger.length>0&&e.InputController.gamepad2RightTrigger.forEach(function(e){e(t)}))},t.inputTwoLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n=t,r=n.x*e.UserInputOptions.GamepadLStickSensibility,o=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal2=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical2=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputTwoRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n=t,r=n.x*e.UserInputOptions.GamepadRStickSensibility,o=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex2=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey2=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputThreeButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="b3:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3ButtonDown&&e.InputController.gamepad3ButtonDown.length>0&&e.InputController.gamepad3ButtonDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad3ButtonPress&&e.InputController.gamepad3ButtonPress.length>0&&e.InputController.gamepad3ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="b3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3ButtonUp&&e.InputController.gamepad3ButtonUp.length>0&&e.InputController.gamepad3ButtonUp.forEach(function(e){e(t)})}},t.inputThreeXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3DpadDown&&e.InputController.gamepad3DpadDown.length>0&&e.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad3DpadPress&&e.InputController.gamepad3DpadPress.length>0&&e.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3DpadDown&&e.InputController.gamepad3DpadDown.length>0&&e.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad3DpadPress&&e.InputController.gamepad3DpadPress.length>0&&e.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3DpadUp&&e.InputController.gamepad3DpadUp.length>0&&e.InputController.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3DpadUp&&e.InputController.gamepad3DpadUp.length>0&&e.InputController.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3&&(e.InputController.keymap["t3:0"]=t,null!=e.InputController.gamepad3LeftTrigger&&e.InputController.gamepad3LeftTrigger.length>0&&e.InputController.gamepad3LeftTrigger.forEach(function(e){e(t)}))},t.inputThreeXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3&&(e.InputController.keymap["t3:1"]=t,null!=e.InputController.gamepad3RightTrigger&&e.InputController.gamepad3RightTrigger.length>0&&e.InputController.gamepad3RightTrigger.forEach(function(e){e(t)}))},t.inputThreeLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n=t,r=n.x*e.UserInputOptions.GamepadLStickSensibility,o=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal3=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical3=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputThreeRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n=t,r=n.x*e.UserInputOptions.GamepadRStickSensibility,o=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex3=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey3=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputFourButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="b4:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4ButtonDown&&e.InputController.gamepad4ButtonDown.length>0&&e.InputController.gamepad4ButtonDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad4ButtonPress&&e.InputController.gamepad4ButtonPress.length>0&&e.InputController.gamepad4ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="b4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4ButtonUp&&e.InputController.gamepad4ButtonUp.length>0&&e.InputController.gamepad4ButtonUp.forEach(function(e){e(t)})}},t.inputFourXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4DpadDown&&e.InputController.gamepad4DpadDown.length>0&&e.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad4DpadPress&&e.InputController.gamepad4DpadPress.length>0&&e.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString(),r=!1;null!=e.InputController.keymap[n]&&(r=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4DpadDown&&e.InputController.gamepad4DpadDown.length>0&&e.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),r||null!=e.InputController.gamepad4DpadPress&&e.InputController.gamepad4DpadPress.length>0&&e.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4DpadUp&&e.InputController.gamepad4DpadUp.length>0&&e.InputController.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4DpadUp&&e.InputController.gamepad4DpadUp.length>0&&e.InputController.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4&&(e.InputController.keymap["t4:0"]=t,null!=e.InputController.gamepad4LeftTrigger&&e.InputController.gamepad4LeftTrigger.length>0&&e.InputController.gamepad4LeftTrigger.forEach(function(e){e(t)}))},t.inputFourXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4&&(e.InputController.keymap["t4:1"]=t,null!=e.InputController.gamepad4RightTrigger&&e.InputController.gamepad4RightTrigger.length>0&&e.InputController.gamepad4RightTrigger.forEach(function(e){e(t)}))},t.inputFourLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n=t,r=n.x*e.UserInputOptions.GamepadLStickSensibility,o=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal4=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical4=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputFourRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n=t,r=n.x*e.UserInputOptions.GamepadRStickSensibility,o=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?r:0,n.y=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.x=e.Scalar.Clamp(n.x,-1,1),n.y=e.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex4=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey4=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputManagerGamepadConnected=function(t,n){if(null==e.InputController.gamepad1&&0===t.index)if(e.InputController.gamepad1=t,e.Tools.Log("Gamepad One Connected: "+e.InputController.gamepad1.id),e.InputController.gamepad1 instanceof e.Xbox360Pad){e.InputController.gamepad1Type=e.GamepadType.Xbox360;var r=e.InputController.gamepad1;r.onbuttonup(e.InputController.inputOneButtonUpHandler),r.onbuttondown(e.InputController.inputOneButtonDownHandler),r.onleftstickchanged(e.InputController.inputOneLeftStickHandler),r.onrightstickchanged(e.InputController.inputOneRightStickHandler),r.ondpadup(e.InputController.inputOneXboxDPadUpHandler),r.ondpaddown(e.InputController.inputOneXboxDPadDownHandler),r.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),r.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad1 instanceof e.DualShockPad){e.InputController.gamepad1Type=e.GamepadType.DualShock;var o=e.InputController.gamepad1;o.onbuttonup(e.InputController.inputOneButtonUpHandler),o.onbuttondown(e.InputController.inputOneButtonDownHandler),o.onleftstickchanged(e.InputController.inputOneLeftStickHandler),o.onrightstickchanged(e.InputController.inputOneRightStickHandler),o.ondpadup(e.InputController.inputOneShockDPadUpHandler),o.ondpaddown(e.InputController.inputOneShockDPadDownHandler),o.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),o.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad1Type=e.GamepadType.Generic;var a=e.InputController.gamepad1;a.onbuttonup(e.InputController.inputOneButtonUpHandler),a.onbuttondown(e.InputController.inputOneButtonDownHandler),a.onleftstickchanged(e.InputController.inputOneLeftStickHandler),a.onrightstickchanged(e.InputController.inputOneRightStickHandler)}if(null==e.InputController.gamepad2&&1===t.index)if(e.InputController.gamepad2=t,e.Tools.Log("Gamepad Two Connected: "+e.InputController.gamepad2.id),e.InputController.gamepad2 instanceof e.Xbox360Pad){e.InputController.gamepad2Type=e.GamepadType.Xbox360;var i=e.InputController.gamepad2;i.onbuttonup(e.InputController.inputTwoButtonUpHandler),i.onbuttondown(e.InputController.inputTwoButtonDownHandler),i.onleftstickchanged(e.InputController.inputTwoLeftStickHandler),i.onrightstickchanged(e.InputController.inputTwoRightStickHandler),i.ondpadup(e.InputController.inputTwoXboxDPadUpHandler),i.ondpaddown(e.InputController.inputTwoXboxDPadDownHandler),i.onlefttriggerchanged(e.InputController.inputTwoXboxLeftTriggerHandler),i.onrighttriggerchanged(e.InputController.inputTwoXboxRightTriggerHandler)}else if(e.InputController.gamepad2 instanceof e.DualShockPad){e.InputController.gamepad2Type=e.GamepadType.DualShock;var l=e.InputController.gamepad2;l.onbuttonup(e.InputController.inputOneButtonUpHandler),l.onbuttondown(e.InputController.inputOneButtonDownHandler),l.onleftstickchanged(e.InputController.inputOneLeftStickHandler),l.onrightstickchanged(e.InputController.inputOneRightStickHandler),l.ondpadup(e.InputController.inputOneShockDPadUpHandler),l.ondpaddown(e.InputController.inputOneShockDPadDownHandler),l.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),l.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad2Type=e.GamepadType.Generic;var s=e.InputController.gamepad2;s.onbuttonup(e.InputController.inputTwoButtonUpHandler),s.onbuttondown(e.InputController.inputTwoButtonDownHandler),s.onleftstickchanged(e.InputController.inputTwoLeftStickHandler),s.onrightstickchanged(e.InputController.inputTwoRightStickHandler)}if(null==e.InputController.gamepad3&&2===t.index)if(e.InputController.gamepad3=t,e.Tools.Log("Gamepad Three Connected: "+e.InputController.gamepad3.id),e.InputController.gamepad3 instanceof e.Xbox360Pad){e.InputController.gamepad3Type=e.GamepadType.Xbox360;var u=e.InputController.gamepad3;u.onbuttonup(e.InputController.inputThreeButtonUpHandler),u.onbuttondown(e.InputController.inputThreeButtonDownHandler),u.onleftstickchanged(e.InputController.inputThreeLeftStickHandler),u.onrightstickchanged(e.InputController.inputThreeRightStickHandler),u.ondpadup(e.InputController.inputThreeXboxDPadUpHandler),u.ondpaddown(e.InputController.inputThreeXboxDPadDownHandler),u.onlefttriggerchanged(e.InputController.inputThreeXboxLeftTriggerHandler),u.onrighttriggerchanged(e.InputController.inputThreeXboxRightTriggerHandler)}else if(e.InputController.gamepad3 instanceof e.DualShockPad){var d=e.InputController.gamepad3;d.onbuttonup(e.InputController.inputOneButtonUpHandler),d.onbuttondown(e.InputController.inputOneButtonDownHandler),d.onleftstickchanged(e.InputController.inputOneLeftStickHandler),d.onrightstickchanged(e.InputController.inputOneRightStickHandler),d.ondpadup(e.InputController.inputOneShockDPadUpHandler),d.ondpaddown(e.InputController.inputOneShockDPadDownHandler),d.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),d.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad3Type=e.GamepadType.Generic;var p=e.InputController.gamepad3;p.onbuttonup(e.InputController.inputThreeButtonUpHandler),p.onbuttondown(e.InputController.inputThreeButtonDownHandler),p.onleftstickchanged(e.InputController.inputThreeLeftStickHandler),p.onrightstickchanged(e.InputController.inputThreeRightStickHandler)}if(null==e.InputController.gamepad4&&3===t.index)if(e.InputController.gamepad4=t,e.Tools.Log("Gamepad Four Connected: "+e.InputController.gamepad4.id),e.InputController.gamepad4 instanceof e.Xbox360Pad){e.InputController.gamepad4Type=e.GamepadType.Xbox360;var c=e.InputController.gamepad4;c.onbuttonup(e.InputController.inputFourButtonUpHandler),c.onbuttondown(e.InputController.inputFourButtonDownHandler),c.onleftstickchanged(e.InputController.inputFourLeftStickHandler),c.onrightstickchanged(e.InputController.inputFourRightStickHandler),c.ondpadup(e.InputController.inputFourXboxDPadUpHandler),c.ondpaddown(e.InputController.inputFourXboxDPadDownHandler),c.onlefttriggerchanged(e.InputController.inputFourXboxLeftTriggerHandler),c.onrighttriggerchanged(e.InputController.inputFourXboxRightTriggerHandler)}else if(e.InputController.gamepad4 instanceof e.DualShockPad){var m=e.InputController.gamepad4;m.onbuttonup(e.InputController.inputOneButtonUpHandler),m.onbuttondown(e.InputController.inputOneButtonDownHandler),m.onleftstickchanged(e.InputController.inputOneLeftStickHandler),m.onrightstickchanged(e.InputController.inputOneRightStickHandler),m.ondpadup(e.InputController.inputOneShockDPadUpHandler),m.ondpaddown(e.InputController.inputOneShockDPadDownHandler),m.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),m.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad4Type=e.GamepadType.Generic;var h=e.InputController.gamepad4;h.onbuttonup(e.InputController.inputFourButtonUpHandler),h.onbuttondown(e.InputController.inputFourButtonDownHandler),h.onleftstickchanged(e.InputController.inputFourLeftStickHandler),h.onrightstickchanged(e.InputController.inputFourRightStickHandler)}null!=e.InputController.GamepadConnected&&e.InputController.GamepadConnected(t,n)},t.inputManagerGamepadDisconnected=function(t,n){null!=e.InputController.GamepadDisconnected&&e.InputController.GamepadDisconnected(t,n)},t.MOUSE_DAMPENER=.5,t.GamepadManager=null,t.GamepadConnected=null,t.GamepadDisconnected=null,t.PointerLockedFlag=!1,t.LockMousePointerObserver=null,t.input=!1,t.keymap={},t.scroll=0,t.wheel=0,t.mousex=0,t.mousey=0,t.vertical=0,t.horizontal=0,t.mousex2=0,t.mousey2=0,t.vertical2=0,t.horizontal2=0,t.mousex3=0,t.mousey3=0,t.vertical3=0,t.horizontal3=0,t.mousex4=0,t.mousey4=0,t.vertical4=0,t.horizontal4=0,t.a_mousex=0,t.x_scroll=0,t.x_wheel=0,t.x_mousex=0,t.x_mousey=0,t.x_vertical=0,t.x_horizontal=0,t.k_mousex=0,t.k_mousey=0,t.k_vertical=0,t.k_horizontal=0,t.j_mousex=0,t.j_mousey=0,t.j_vertical=0,t.j_horizontal=0,t.g_mousex1=0,t.g_mousey1=0,t.g_vertical1=0,t.g_horizontal1=0,t.g_mousex2=0,t.g_mousey2=0,t.g_vertical2=0,t.g_horizontal2=0,t.g_mousex3=0,t.g_mousey3=0,t.g_vertical3=0,t.g_horizontal3=0,t.g_mousex4=0,t.g_mousey4=0,t.g_vertical4=0,t.g_horizontal4=0,t.mouseButtonPress=[],t.mouseButtonDown=[],t.mouseButtonUp=[],t.keyButtonPress=[],t.keyButtonDown=[],t.keyButtonUp=[],t.previousPosition=null,t.preventDefault=!1,t.rightHanded=!0,t.gamepad1=null,t.gamepad1Type=-1,t.gamepad1ButtonPress=[],t.gamepad1ButtonDown=[],
t.gamepad1ButtonUp=[],t.gamepad1DpadPress=[],t.gamepad1DpadDown=[],t.gamepad1DpadUp=[],t.gamepad1LeftTrigger=[],t.gamepad1RightTrigger=[],t.gamepad2=null,t.gamepad2Type=-1,t.gamepad2ButtonPress=[],t.gamepad2ButtonDown=[],t.gamepad2ButtonUp=[],t.gamepad2DpadPress=[],t.gamepad2DpadDown=[],t.gamepad2DpadUp=[],t.gamepad2LeftTrigger=[],t.gamepad2RightTrigger=[],t.gamepad3=null,t.gamepad3Type=-1,t.gamepad3ButtonPress=[],t.gamepad3ButtonDown=[],t.gamepad3ButtonUp=[],t.gamepad3DpadPress=[],t.gamepad3DpadDown=[],t.gamepad3DpadUp=[],t.gamepad3LeftTrigger=[],t.gamepad3RightTrigger=[],t.gamepad4=null,t.gamepad4Type=-1,t.gamepad4ButtonPress=[],t.gamepad4ButtonDown=[],t.gamepad4ButtonUp=[],t.gamepad4DpadPress=[],t.gamepad4DpadDown=[],t.gamepad4DpadUp=[],t.gamepad4LeftTrigger=[],t.gamepad4RightTrigger=[],t}();e.InputController=t;var n=function(){function e(e,t,n){var r=this;this.active=!1,this.touchId=null,this.dragStart=null,this.maxDistance=0,this.deadZone=0,this.xvalue=0,this.yvalue=0,this.stick=null,this.touchId=null,this.dragStart=null,this.active=!1,this.xvalue=0,this.yvalue=0,this.deadZone=n,this.maxDistance=t,this.stick=document.getElementById(e),null!=this.stick?(this.stick.addEventListener("mousedown",function(e){r.handleDown(e)}),this.stick.addEventListener("touchstart",function(e){r.handleDown(e)}),document.addEventListener("mousemove",function(e){r.handleMove(e)},{passive:!1}),document.addEventListener("touchmove",function(e){r.handleMove(e)},{passive:!1}),document.addEventListener("mouseup",function(e){r.handleUp(e)}),document.addEventListener("touchend",function(e){r.handleUp(e)})):console.warn("Failed to locate joystick element: "+e)}return e.prototype.getValueX=function(){return this.xvalue},e.prototype.getValueY=function(){return this.yvalue},e.prototype.getStickElement=function(){return this.stick},e.prototype.dispose=function(){},e.prototype.handleDown=function(e){this.active=!0,this.stick.style.transition="0s",e.preventDefault(),e.changedTouches?this.dragStart={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:this.dragStart={x:e.clientX,y:e.clientY},e.changedTouches&&(this.touchId=e.changedTouches[0].identifier)},e.prototype.handleMove=function(e){if(this.active){var t=null;if(e.changedTouches){for(var n=0;n<e.changedTouches.length;n++)this.touchId==e.changedTouches[n].identifier&&(t=n,e.clientX=e.changedTouches[n].clientX,e.clientY=e.changedTouches[n].clientY);if(null==t)return}var r=e.clientX-this.dragStart.x,o=e.clientY-this.dragStart.y,a=Math.atan2(o,r),i=Math.min(this.maxDistance,Math.hypot(r,o)),l=i*Math.cos(a),s=i*Math.sin(a);this.stick.style.transform="translate3d(".concat(l,"px, ").concat(s,"px, 0px)");var u=i<this.deadZone?0:this.maxDistance/(this.maxDistance-this.deadZone)*(i-this.deadZone),d=u*Math.cos(a),p=u*Math.sin(a),c=parseFloat((d/this.maxDistance).toFixed(4)),m=parseFloat((p/this.maxDistance).toFixed(4));this.xvalue=c,this.yvalue=m}},e.prototype.handleUp=function(e){this.active&&(e.changedTouches&&this.touchId!=e.changedTouches[0].identifier||(this.stick.style.transition=".2s",this.stick.style.transform="translate3d(0px, 0px, 0px)",this.xvalue=0,this.yvalue=0,this.touchId=null,this.active=!1))},e}();e.TouchJoystickHandler=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.IsWindows=function(){return"undefined"!=typeof Windows&&"undefined"!=typeof Windows.UI&&"undefined"!=typeof Windows.System&&"undefined"!=typeof Windows.Foundation},t.IsCordova=function(){return null!=window.cordova},t.IsWebAssembly=function(){return window.WebAssembly},t.IsOculusBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/OculusBrowser/i)&&(e=!0),e},t.IsSamsungBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/SamsungBrowser/i)&&(e=!0),e},t.IsWindowsPhone=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Windows Phone/i)&&(e=!0),e},t.IsBlackBerry=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/BlackBerry/i)&&(e=!0),e},t.IsOperaMini=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Opera Mini/i)&&(e=!0),e},t.IsAndroid=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Android/i)&&(e=!0),e},t.IsWebOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/webOS/i)&&(e=!0),e},t.IsIOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone|iPad|iPod/i)&&(e=!0),e},t.IsIPHONE=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone/i)&&(e=!0),e},t.IsIPAD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPad/i)&&(e=!0),e},t.IsIPOD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPod/i)&&(e=!0),e},t.IsIE11=function(){return void 0!==navigator.maxTouchPoints},t.IsMobile=function(){var e=!1;if(null!=navigator&&null!=navigator.userAgent){var t=navigator.userAgent;(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone|iPad|iPod/i)||t.match(/BlackBerry/i)||t.match(/Opera Mini/i)||t.match(/Windows Phone/i))&&(e=!0)}return e},t.IsPlaystation=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Playstation/i)&&(e=!0),e},t.IsXboxConsole=function(){var t=!1;if(e.WindowManager.IsWindows()&&"undefined"!=typeof Windows.System.Profile&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily){var n=Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily;n.match(/Xbox/i)&&(t=!0)}return t},t.IsXboxLive=function(){return e.WindowManager.IsWindows()&&"undefined"!=typeof Microsoft&&"undefined"!=typeof Microsoft.Xbox&&"undefined"!=typeof Microsoft.Xbox.Services},t.IsFrameWindow=function(){return null!=window.parent&&window!==window.parent},t.AlertMessage=function(t,n){void 0===n&&(n="Babylon.js");var r=null;return e.WindowManager.IsWindows()?r=new Windows.UI.Popups.MessageDialog(t,n).showAsync():window.alert(t),r},t.GetQueryStringParam=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),r=n.exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},t.PostWindowMessage=function(e,t,n){void 0===t&&(t="*"),void 0===n&&(n=!1),n===!0?window.postMessage(e,t):window.top?window.top.postMessage(e,t):console.warn("No Valid Top Window")},t.SetGameWindowState=function(t,n){null!=window.parent&&null!=window.parent.gameState?window.parent.gameState[t]=n:e.Tools.Warn("Game window required to set state for: "+t)},t.GetGameWindowState=function(t){var n=null;return null!=window.parent&&null!=window.parent.gameState&&null!=window.parent.gameState[t]?n=window.parent.gameState[t]:e.Tools.Warn("Game window required to get state for: "+t),null!=n?n:null},t.IsGameWindowEnabled=function(){return null!=window.parent&&null!=window.parent.setGameWindow},t.LoadSceneFile=function(t,n){if(void 0===n&&(n=null),e.WindowManager.IsGameWindowEnabled()){var r=window.location.protocol+"//"+window.location.host+window.location.pathname+"?scene="+t;null!=n&&""!==n&&(r+=n),null!=window.parent&&null!=window.parent.setGameWindow?window.parent.setGameWindow(r):e.Tools.Warn("Invalid set game window function found to load scene file: "+t)}else e.Tools.Warn("Game window required to load scene file: "+t)},t.PopupDebug=function(e){e.debugLayer&&(e.debugLayer.hide(),e.debugLayer.show({enablePopup:!0,globalRoot:null}))},t.ToggleDebug=function(t,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=null),t.debugLayer){var o=window;e.WindowManager.debugLayerVisible===!0?(e.WindowManager.debugLayerVisible=!1,o.METER&&o.METER.show&&o.METER.show(),t.debugLayer.hide()):(e.WindowManager.debugLayerVisible=!0,o.METER&&o.METER.hide&&o.METER.hide(),t.debugLayer.show({embedMode:n,globalRoot:r}))}},t.GetLocalStorageItem=function(e){return null!=window.localStorage?window.localStorage.getItem(e):null},t.SetLocalStorageItem=function(e,t){null!=window.localStorage&&window.localStorage.setItem(e,t)},t.GetSessionStorageItem=function(e){return null!=window.sessionStorage?window.sessionStorage.getItem(e):null},t.SetSessionStorageItem=function(e,t){null!=window.sessionStorage&&window.sessionStorage.setItem(e,t)},t.GetFilenameFromUrl=function(e){return e.substring(e.lastIndexOf("/")+1)},t.GetUrlParameter=function(e){var t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=n.exec(window.location.search);return null!==r?decodeURIComponent(r[1].replace(/\+/g," ")):null},t.GetVirtualRealityEnabled=function(){var t=e.WindowManager.GetLocalStorageItem("virtualReality");return null!=t&&"true"===t},t.SetVirtualRealityEnabled=function(t){e.WindowManager.SetLocalStorageItem("virtualReality",t.toString().toLowerCase())},t.SetWindowsLaunchMode=function(t){void 0===t&&(t=1),e.WindowManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationView&&(Windows.UI.ViewManagement.ApplicationView.preferredLaunchWindowingMode=t)},t.QuitWindowsApplication=function(){e.WindowManager.IsWindows()&&window.close()},t.PrintToScreen=function(t,n){if(void 0===n&&(n="white"),e.WindowManager.PrintElement=document.getElementById("print"),null==e.WindowManager.PrintElement){var r=document.createElement("div");r.id="print",r.style.position="absolute",r.style.left="6px",r.style.bottom="3px",r.style.fontSize="12px",r.style.zIndex="10000",r.style.color="#0c0",document.body.appendChild(r),e.WindowManager.PrintElement=r}null!=e.WindowManager.PrintElement&&e.WindowManager.PrintElement.innerHTML!==t&&(e.WindowManager.PrintElement.style.color!==n&&(e.WindowManager.PrintElement.style.color=n),e.WindowManager.PrintElement.innerHTML=t)},t.debugLayerVisible=!1,t.PrintElement=null,t}();e.WindowManager=t}(BABYLON||(BABYLON={})),BABYLON.WindowManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow&&Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow),BABYLON.WindowManager.IsXboxConsole()&&navigator.gamepadInputEmulation&&(navigator.gamepadInputEmulation="gamepad");var WM=BABYLON.WindowManager;