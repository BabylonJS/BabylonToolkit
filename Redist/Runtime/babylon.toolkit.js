var __awaiter=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,r){function a(e){try{s(o.next(e))}catch(t){r(t)}}function l(e){try{s(o["throw"](e))}catch(t){r(t)}}function s(e){e.done?n(e.value):i(e.value).then(a,l)}s((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(i)throw new TypeError("Generator is already executing.");for(;l&&(l=0,n[0]&&(s=0)),s;)try{if(i=1,r&&(a=2&n[0]?r["return"]:n[0]?r["throw"]||((a=r["return"])&&a.call(r),0):r.next)&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(o){n=[6,o],r=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,r,a,l,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l},UNITY;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"Version",{get:function(){return"1.0.50 - BETA"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Copyright",{get:function(){return"All rights reserved (c) 2024 Mackey Kinard"},enumerable:!1,configurable:!0}),t.HasAudioContext=function(){return null!=BABYLON.Engine.audioEngine&&null!=BABYLON.Engine.audioEngine.audioContext&&null!=BABYLON.Engine.audioEngine.audioContext.state&&"running"===BABYLON.Engine.audioEngine.audioContext.state},Object.defineProperty(t,"PlaygroundRepo",{get:function(){return"https://www.babylontoolkit.com/playground/"},enumerable:!1,configurable:!0}),t.InitializePlayground=function(t,n,o,i){void 0===n&&(n=!1),void 0===o&&(o=!0),void 0===i&&(i="150px"),BABYLON.Tools.Log("Unity Toolkit Playground Version: "+e.SceneManager.Version),n===!0&&e.SceneManager.ShowLoadingScreen(t,o,i)},t.ShowLoadingScreen=function(e,t,n){if(void 0===t&&(t=!0),void 0===n&&(n="150px"),null!=e.loadingScreen){t===!1&&(e.loadingScreen.hideLoadingUI=function(){}),e.displayLoadingUI();var o=e.loadingScreen;null!=o._loadingTextDiv&&null!=o._loadingTextDiv.style&&(o._loadingTextDiv.style.marginTop=n)}},t.HideLoadingScreen=function(e){if(e.loadingScreen instanceof BABYLON.DefaultLoadingScreen){var t=e.loadingScreen;if(!t||!t._loadingDiv)return;var n=function(){t._loadingTextDiv&&(t._loadingTextDiv.remove(),t._loadingTextDiv=null),t._loadingDiv&&(t._loadingDiv.remove(),t._loadingDiv=null),t._style&&(t._style.remove(),t._style=null),t._resizeLoadingUI&&window.removeEventListener("resize",t._resizeLoadingUI)};t._loadingDiv.style.opacity="0",t._loadingDiv.addEventListener("transitionend",n)}},t.LoadScriptBundle=function(e,t){return void 0===t&&(t=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,BABYLON.Tools.LoadScriptAsync(e)]})})},t.EnableSceneParsing=function(t){e.SceneManager.SceneParsingEnabled=t},t.IsSceneParsingEnabled=function(){return e.SceneManager.SceneParsingEnabled},t.HasSceneBeenPreLoaded=function(e){var t=e;return null!=t._preloaded&&t._preloaded===!0},t.GetFullscreenUI=function(t,n){return void 0===n&&(n=BABYLON.Texture.BILINEAR_SAMPLINGMODE),null==e.SceneManager.AdvDynamicTexture&&(e.SceneManager.AdvDynamicTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("Default-Screen-UI",!0,t,n)),e.SceneManager.AdvDynamicTexture},t.GetDefaultSkybox=function(e){return e.getMeshById("Default Skybox")},t.GetIntensityFactor=function(){return null!=e.SceneManager.GlobalOptions.intensityFactor?e.SceneManager.GlobalOptions.intensityFactor:2},t.GetRenderQuality=function(){var t=e.RenderQuality.High,n=e.SceneManager.GlobalOptions.renderQuality;return null!=n&&(t=n),t},t.SetRenderQuality=function(t){e.SceneManager.GlobalOptions.renderQuality=t},t.GetWebGLVersionString=function(t){var n="WebGL - Unknown",o=t||e.SceneManager.GetLastCreatedScene();if(null!=o){var i=o.getEngine();if(null!=i){var r=i.getGlInfo();null!=r&&(n=r.version+" - "+r.renderer)}}return n},t.GetWebGLVersionNumber=function(t){var n=0,o=t||e.SceneManager.GetLastCreatedScene();if(null!=o){var i=o.getEngine();null!=i&&(n=i.webGLVersion)}return n},t.SetWindowState=function(t,n){e.SceneManager.WindowState[t]=n},t.GetWindowState=function(t){var n=e.SceneManager.WindowState[t];return null!=n?n:null},t.IsDebugMode=function(){return null!=e.SceneManager.GlobalOptions.debugModeEnabled&&e.SceneManager.GlobalOptions.debugModeEnabled===!0},t.ConsoleLog=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.log.apply(console,t)},t.ConsoleInfo=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.info.apply(console,t)},t.ConsoleWarn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.SceneManager.IsDebugMode()&&console.warn.apply(console,t)},t.ConsoleError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,e)},t.LogMessage=function(t){e.SceneManager.IsDebugMode()&&BABYLON.Tools.Log(t)},t.LogWarning=function(t){e.SceneManager.IsDebugMode()&&BABYLON.Tools.Warn(t)},t.LogError=function(e){BABYLON.Tools.Error(e)},t.ShowSceneLoader=function(){window.showSceneLoader&&window.showSceneLoader()},t.HideSceneLoader=function(){window.hideSceneLoader&&window.hideSceneLoader()},t.UpdateLoaderStatus=function(e,t,n){window.updateStatus&&window.updateStatus(e,t,n)},t.UpdateLoaderDetails=function(e,t){window.updateDetails&&window.updateDetails(e,t)},t.UpdateLoaderProgress=function(e,t){window.updateProgress&&window.updateProgress(e,t)},t.ShowPageErrorMessage=function(e,t,n){void 0===t&&(t="Error"),void 0===n&&(n=0),window.showErrorMessage&&window.showErrorMessage(e,t,n)},t.SetTimeout=function(e,t){return window.setTimeout(t,e)},t.ClearTimeout=function(e){window.clearTimeout(e)},t.SetInterval=function(e,t){return window.setInterval(t,e)},t.ClearInterval=function(e){window.clearInterval(e)},t.GetTimeMilliseconds=function(){return null!=window.performance?window.performance.now():null!=window.Date?Date.now():0},t.GetTime=function(){return.001*e.SceneManager.GetTimeMilliseconds()},t.GetTimeMs=function(){return e.SceneManager.GetTimeMilliseconds()},t.GetGameTime=function(){return.001*(e.SceneManager.GetTimeMilliseconds()-e.SceneManager.GameTimeMilliseconds)},t.GetGameTimeMs=function(){return e.SceneManager.GetTimeMilliseconds()-e.SceneManager.GameTimeMilliseconds},t.GetDeltaSeconds=function(t,n){void 0===n&&(n=!1);var o=t||e.SceneManager.GetLastCreatedScene(),i=.001*Math.max(BABYLON.Scene.MinDeltaTime,Math.min(o.getEngine().getDeltaTime(),BABYLON.Scene.MaxDeltaTime));return n===!0&&(i*=o.getAnimationRatio()),i},t.GetDeltaMilliseconds=function(t,n){void 0===n&&(n=!1);var o=t||e.SceneManager.GetLastCreatedScene(),i=Math.max(BABYLON.Scene.MinDeltaTime,Math.min(o.getEngine().getDeltaTime(),BABYLON.Scene.MaxDeltaTime));return n===!0&&(i*=o.getAnimationRatio()),i},t.GetAnimationRatio=function(t){var n=t||e.SceneManager.GetLastCreatedScene();return n.getAnimationRatio()},t.RunOnce=function(e,t,n){e.executeOnceBeforeRender(t,n)},t.DisposeScene=function(e,t){void 0===t&&(t=new BABYLON.Color4(0,0,0,1));var n=e.getEngine();e.dispose(),n.clear(t,!0,!0,!0)},t.SafeDestroy=function(t,n,o){void 0===n&&(n=5),void 0===o&&(o=!1),n>0?(o===!0&&t.setEnabled(!1),e.SceneManager.SetTimeout(n,function(){t.dispose(!1,!1)})):t.dispose(!1,!1)},t.GetRootUrl=function(e){return null!=e._rootUrl&&""!==e._rootUrl?e._rootUrl:"/"},t.SetRootUrl=function(e,t){e._rootUrl=t},t.GetSceneFile=function(e){return null!=e._fileName&&""!==e._fileName?e._fileName:null},t.SetSceneFile=function(e,t){e._fileName=t},t.GetEngineInstances=function(){return BABYLON.EngineStore.Instances},t.GetLastCreatedEngine=function(){return BABYLON.EngineStore.LastCreatedEngine},t.GetLastCreatedScene=function(){return BABYLON.EngineStore.LastCreatedScene},t.GetImportMeshes=function(e,t){return null==e||null==t||""===t?null:null!=e.importMeshes?e.importMeshes.get(t.toLowerCase()):null},t.GetImportMeshMap=function(e){return null==e?null:null!=e.importMeshes?e.importMeshes:null},t.ClearImportMeshes=function(e){return null==e?null:(null!=e.importMeshes,void(e.importMeshes=new Map))},t.RegisterImportMeshes=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.importMeshes&&(e.importMeshes=new Map),e.importMeshes.set(t.toLowerCase(),n))},t.GetAssetContainer=function(e,t){return null==e||null==t||""===t?null:null!=e.assetContainers?e.assetContainers.get(t.toLowerCase()):null},t.GetAssetContainerMap=function(e){return null==e?null:null!=e.assetContainers?e.assetContainers:null},t.ClearAssetContainers=function(e){return null==e?null:(null!=e.assetContainers,void(e.assetContainers=new Map))},t.RegisterAssetContainer=function(e,t,n){null!=e&&null!=t&&""!==t&&null!=n&&(null==e.assetContainers&&(e.assetContainers=new Map),e.assetContainers.set(t.toLowerCase(),n))},t.GetMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetAbstractMesh=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetAbstractMeshByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformNode=function(e,t){return null==e?null:e.getNodeByName(t)},t.GetTransformNodeByID=function(e,t){return null==e?null:e.getNodeById(t)},t.GetTransformDetailMesh=function(e){var t=null,n=e.name+".Detail",o=e.getChildren(function(e){return e.name===n&&e instanceof BABYLON.AbstractMesh},!0);return null!=o&&o.length>0&&(t=o[0]),t},t.GetSkinnedMesh=function(e){return null!=e._skinnedMesh?e._skinnedMesh:null},t.GetPrimitiveMeshes=function(e){return e.getChildMeshes(!0,function(e){return e.name.indexOf("_primitive")>=0})},t.GetTransformLayer=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.layer?e.metadata.unity.layer:0},t.GetTransformLayerMask=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.layermask?e.metadata.unity.layermask:1},t.GetTransformLayerName=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.layername&&""!==e.metadata.unity.layername?e.metadata.unity.layername:"Default"},t.GetTransformTag=function(e){return null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.group&&""!==e.metadata.unity.group?e.metadata.unity.group:"Untagged"},t.HasTransformTags=function(e,t){return BABYLON.Tags.MatchesQuery(e,t)},t.TextureFloatSupported=function(e){var t=!1,n=!1,o=e.getEngine(),i=o.getCaps();return i.textureHalfFloatRender&&i.textureHalfFloatLinearFiltering?t=!0:i.textureFloatRender&&i.textureFloatLinearFiltering&&(n=!0),t||n},t.RegisterClickAction=function(e,t,n){var o=null;return null!=t&&(t.isPickable=!0,null==t.actionManager&&(t.actionManager=new BABYLON.ActionManager(e)),o=t.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnPickTrigger},n))),o},t.UnregisterClickAction=function(e,t){var n=!1;return null!=e&&null!=t&&(n=e.actionManager.unregisterAction(t)),n},t.StartTweenAnimation=function(t,n,o,i,r,a,l,s,u,c,d){void 0===l&&(l=1),void 0===s&&(s=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null);var p=l||1,h=s||30,m=u||BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,f=e.Utilities.CreateTweenAnimation(n,i,r,a,h,m);null!=c&&f.setEasingFunction(c);var g=e.Utilities.GetLastKeyFrameIndex(f),y=m!=BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT;return t.beginDirectAnimation(o,[f],0,g,y,p,d)},t.StartNativeTween=function(e,t){return createjs.Tween.get(e,t)},t.GetMaterialWithName=function(e,t){var n=null;if(null!=e.materials&&e.materials.length>0)for(var o=(e.materials.length,0);o<e.materials.length;o++){var i=e.materials[o];if(i.name.startsWith(t)){n=i;break}}return n},t.GetAllMaterialsWithName=function(e,t){var n=null;if(null!=e.materials&&e.materials.length>0)for(var o=(e.materials.length,0);o<e.materials.length;o++){var i=e.materials[o];i.name.startsWith(t)&&(null==n&&(n=[]),n.push(i))}return n},t.InstantiatePrefabFromScene=function(t,n,o,i,r,a,l,s){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===s&&(s=!0);var u=null;if(null!=t&&null!=n&&""!==n){var c=t.getNodeByName(n);if(null!=c)if(u=c.clone(o,i,!1),null!=u){null!=r&&(u.position=r.clone()),null!=a&&(u.rotationQuaternion=a.clone()),null!=l&&(u.scaling=l.clone());var d=null,p=u.getChildren(null,!1);null!=p&&(d=p),null==d?d=[u]:d.unshift(u),d.forEach(function(e){if(e.setEnabled(!0),e instanceof BABYLON.AbstractMesh&&null!=e.metadata&&null!=e.metadata.shadowCastingMode&&0!==e.metadata.shadowCastingMode&&t.lights.forEach(function(t){var n=t.getShadowGenerator();if(null!=n){var o=null!=t.includedOnlyMeshes&&t.includedOnlyMeshes.length>0;if(o===!1){var i=n.getShadowMap();null==i.renderList&&(i.renderList=[]),i.renderList.indexOf(e)<0&&i.renderList.push(e)}}}),e instanceof BABYLON.Mesh)if(null!=e.source){if(null==e.skeleton&&null!=e.source.skeleton){var n=e.source.skeleton.name+".Skeleton",o=n+"."+e.source.skeleton.id;if(e.skeleton=e.source.skeleton.clone(n,o),null!=e.skeleton&&null!=e.skeleton.bones&&null!=e.source.skeleton.bones&&e.skeleton.bones.length===e.source.skeleton.bones.length)for(var i=e.skeleton.bones.length,r=0;r<i;r++)null==e.skeleton.bones[r].metadata&&null!=e.source.skeleton.bones[r].metadata&&(e.skeleton.bones[r].metadata=e.source.skeleton.bones[r].metadata)}}else BABYLON.Tools.Warn("Babylon.js encountered a null clone source for: "+e.name)});var h=[];if(d.forEach(function(e){h.push(e)}),null!=h&&h.length>0){var m=[];e.Utilities.PostParseSceneComponents(t,h,null,m),t.onAfterRenderObservable.addOnce(function(){if(null!=m&&m.length>0)for(var e=0;e<m.length;e++){var t=m[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})}}else BABYLON.Tools.Warn("Failed to create prefab of: "+n);else BABYLON.Tools.Warn("Failed to lookup prefab map: "+n)}else BABYLON.Tools.Warn("Unable to locate prefab master: "+n);return u},t.InstantiatePrefabFromContainer=function(t,n,o,i,r,a,l,s,u){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===s&&(s=!0),void 0===u&&(u=!1);var c=e.Utilities.CloneAssetContainerItem(t,n,function(e){return e},i,u,s);if(null!=c){null!=o&&""!==o&&(c.name=o),null!=r&&(c.position=r.clone()),null!=a&&(c.rotationQuaternion=a.clone()),null!=l&&(c.scaling=l.clone());var d=[];d.push(c);var p=c.getChildren(null,!1);null!=p&&p.length>0&&p.forEach(function(e){d.push(e)}),d.forEach(function(t){t.id=e.Utilities.CreateGuid(),t.setEnabled(!0)});var h=[];e.Utilities.PostParseSceneComponents(t.scene,d,null,h),t.scene.onAfterRenderObservable.addOnce(function(){if(null!=h&&h.length>0)for(var e=0;e<h.length;e++){var t=h[e];null!=t&&t.delayComponentInstance&&t.delayComponentInstance(t)}})}return c},t.CloneTransformNode=function(t,n,o,i,r,a,l){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerNode(t,n),u=s.clone(o,i,!0);return null!=u&&(null!=r&&(u.position=r.clone()),null!=a&&(u.rotationQuaternion=a.clone()),null!=l&&(u.scaling=l.clone()),u.setEnabled(!0)),u},t.CloneAbstractMesh=function(t,n,o,i,r,a,l){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerMesh(t,n),u=s.clone(o,i,!0);return null!=u&&(null!=r&&(u.position=r.clone()),null!=a&&(u.rotationQuaternion=a.clone()),null!=l&&(u.scaling=l.clone()),u.setEnabled(!0)),u},t.CreateInstancedMesh=function(t,n,o,i,r,a,l){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null);var s=e.Utilities.GetAssetContainerMesh(t,n),u=s.createInstance(o);return null!=u&&(null!=i&&(u.parent=i),null!=r&&(u.position=r.clone()),null!=a&&(u.rotationQuaternion=a.clone()),null!=l&&(u.scaling=l.clone()),u.setEnabled(!0)),u},t.AttachScriptComponent=function(e,t,n){void 0===n&&(n=!0),null!=e&&e.registerComponentInstance&&e.registerComponentInstance(e,t,n)},t.DestroyScriptComponent=function(e){null!=e&&e.destroyComponentInstance&&e.destroyComponentInstance(e)},t.FindScriptComponent=function(e,t){if(null==e)return null;var n=null;if(null!=e.metadata&&e.metadata.unity){var o=e.metadata.unity;if(null!=o.components&&o.components.length>0)for(var i=0;i<o.components.length;i++){var r=o.components[i];if(null!=r.instance&&r.klass===t){n=r.instance;break}}}return null!=n?n:null},t.FindAllScriptComponents=function(e,t){if(null==e)return null;var n=null;if(null!=e.metadata&&e.metadata.unity){var o=e.metadata.unity;if(null!=o.components&&o.components.length>0)for(var i=0;i<o.components.length;i++){var r=o.components[i];null!=r.instance&&r.klass===t&&(null==n&&(n=[]),n.push(r.instance))}}return null!=n?n:null},t.FindSceneMetadata=function(e){return null==e?null:null!=e.metadata&&e.metadata.unity?e.metadata.unity:null},t.FindSceneCameraRig=function(e){return null==e?null:null!=e.cameraRig?e.cameraRig:null},t.FindSceneLightRig=function(e){return null==e?null:null!=e.lightRig?e.lightRig:null},t.FindTransformWithScript=function(t,n){var o=t.getNodes();return e.Utilities.SearchTransformNodeForScript(n,o)},t.FindAllTransformsWithScript=function(t,n){var o=t.getNodes();return e.Utilities.SearchAllTransformNodesForScript(n,o)},t.FindChildTransformNode=function(t,n,o,i,r){if(void 0===o&&(o=e.SearchType.ExactMatch),void 0===i&&(i=!0),void 0===r&&(r=null),null==t)return null;var a=null!=o?o:e.SearchType.ExactMatch,l=t.getChildren(r,i);return e.Utilities.SearchTransformNodes(n,l,a)},t.FindChildTransformWithTags=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchTransformNodeForTags(n,r)},t.FindAllChildTransformsWithTags=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchAllTransformNodesForTags(n,r)},t.FindChildTransformWithScript=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchTransformNodeForScript(n,r)},t.FindAllChildTransformsWithScript=function(t,n,o,i){if(void 0===o&&(o=!0),void 0===i&&(i=null),null==t)return null;var r=t.getChildren(i,o);return e.Utilities.SearchAllTransformNodesForScript(n,r)},t.SearchForScriptComponentByName=function(t,n){var o=t.getNodes(),i=e.Utilities.SearchTransformNodeForScript(n,o);return e.SceneManager.FindScriptComponent(i,n)},t.SearchForAllScriptComponentsByName=function(t,n){var o=null,i=t.getNodes(),r=e.Utilities.SearchAllTransformNodesForScript(n,i);return null!=r&&r.length>0&&r.forEach(function(t){var i=e.SceneManager.FindScriptComponent(t,n);null!=i&&(null==o&&(o=[]),o.push(i))}),null!=o?o:null},t.MoveWithCollisions=function(e,t){return null==e?null:void(null!=t&&e.moveWithCollisions(t))},t.MoveWithTranslation=function(e,t){return null==e?null:void(null!=t&&e.position.addInPlace(t))},t.TurnWithRotation=function(e,t,n){return void 0===n&&(n=BABYLON.Space.LOCAL),null==e?null:void(0!=t&&e.rotate(BABYLON.Axis.Y,t,n))},t.GetRecastHeapSize=function(){if("undefined"==typeof Recast)return 0;var e=0;return Recast&&Recast.HEAP8&&Recast.HEAP8.length&&(e=Recast.HEAP8.length/1048576),e},t.GetNavigationTools=function(){if("undefined"!=typeof Recast)return null==e.SceneManager.PluginInstance&&(e.SceneManager.PluginInstance=new BABYLON.RecastJSPlugin),e.SceneManager.PluginInstance},t.GetCrowdInterface=function(t){if("undefined"==typeof Recast)return null;if(e.SceneManager.HasNavigationData()){var n=e.SceneManager.GetNavigationTools();return null!=n&&null==e.SceneManager.CrowdInterface&&(e.SceneManager.CrowdInterface=n.createCrowd(e.SceneManager.MAX_AGENT_COUNT,e.SceneManager.MAX_AGENT_RADIUS,t)),e.SceneManager.CrowdInterface}return null},t.HasNavigationData=function(){if("undefined"==typeof Recast)return!1;var t=e.SceneManager.GetNavigationTools();return null!=t&&null!=t.navMesh},t.GetNavigationMesh=function(){return"undefined"==typeof Recast?null:e.SceneManager.NavigationMesh},t.BakeNavigationMesh=function(t,n,o,i,r,a){if(void 0===i&&(i=!1),void 0===r&&(r=null),void 0===a&&(a=!1),"undefined"==typeof Recast)return null;BABYLON.Tools.Log("Recast.js baking navigation mesh data");var l=e.SceneManager.GetNavigationTools();if(null!=l)if(l.createNavMesh(n,o),null!=l.navMesh){var s="NavigationMesh",u=t.getMaterialByName(s);null==u&&(u=new BABYLON.StandardMaterial(s,t),u.diffuseColor=r||new BABYLON.Color3(.05,.225,.75),u.alpha=.5),e.SceneManager.NavigationMesh=l.createDebugNavMesh(t),null!=e.SceneManager.NavigationMesh&&(e.SceneManager.NavigationMesh.material=u,e.SceneManager.NavigationMesh.isPickable=!0,e.SceneManager.NavigationMesh.isVisible=!0,e.SceneManager.NavigationMesh.visibility=i===!0?1:0,e.SceneManager.NavigationMesh.renderingGroupId=e.Utilities.ColliderRenderGroup(),BABYLON.Tags.AddTagsTo(e.SceneManager.NavigationMesh,"Navigation"),e.Utilities.ValidateTransformMetadata(e.SceneManager.NavigationMesh),a===!0&&(e.SceneManager.NavigationMesh.checkCollisions=!0,e.SceneManager.NavigationMesh.metadata.unity.physics=e.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new BABYLON.Vector3(0,0,0)),e.SceneManager.NavigationMesh.metadata.unity.collision=e.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),e.RigidbodyPhysics.SetupPhysicsComponent(t,e.SceneManager.NavigationMesh))),null!=e.SceneManager.NavigationMesh?e.SceneManager.OnNavMeshReadyObservable.hasObservers()===!0&&e.SceneManager.OnNavMeshReadyObservable.notifyObservers(e.SceneManager.NavigationMesh):BABYLON.Tools.Warn("Failed to generate navigation mesh geometry")}else BABYLON.Tools.Warn("Failed to create navigation mesh data");return e.SceneManager.NavigationMesh},t.LoadNavigationMesh=function(t,n,o,i,r,a){if(void 0===o&&(o=!1),void 0===i&&(i=null),void 0===r&&(r=0),void 0===a&&(a=!1),"undefined"==typeof Recast)return null;BABYLON.Tools.Log("Recast.js loading prebaked navigation mesh");var l=e.SceneManager.GetNavigationTools();if(null!=l)if(l.setTimeStep&&l.setTimeStep(r),l.buildFromNavmeshData(n),null!=l.navMesh){var s="NavigationMesh",u=t.getMaterialByName(s);null==u&&(u=new BABYLON.StandardMaterial(s,t),u.diffuseColor=i||new BABYLON.Color3(.05,.225,.75),u.alpha=.5),e.SceneManager.NavigationMesh=l.createDebugNavMesh(t),null!=e.SceneManager.NavigationMesh&&(e.SceneManager.NavigationMesh.material=u,e.SceneManager.NavigationMesh.isPickable=!0,e.SceneManager.NavigationMesh.isVisible=!0,e.SceneManager.NavigationMesh.visibility=o===!0?1:0,e.SceneManager.NavigationMesh.renderingGroupId=e.Utilities.ColliderRenderGroup(),BABYLON.Tags.AddTagsTo(e.SceneManager.NavigationMesh,"Navigation"),e.Utilities.ValidateTransformMetadata(e.SceneManager.NavigationMesh),a===!0&&(e.SceneManager.NavigationMesh.checkCollisions=!0,e.SceneManager.NavigationMesh.metadata.unity.physics=e.RigidbodyPhysics.CreatePhysicsMetadata(0,0,.05,new BABYLON.Vector3(0,0,0)),e.SceneManager.NavigationMesh.metadata.unity.collision=e.RigidbodyPhysics.CreateCollisionMetadata("MeshCollider",!1,!1,0,.6,.6),e.RigidbodyPhysics.SetupPhysicsComponent(t,e.SceneManager.NavigationMesh))),null!=e.SceneManager.NavigationMesh?e.SceneManager.OnNavMeshReadyObservable.hasObservers()===!0&&e.SceneManager.OnNavMeshReadyObservable.notifyObservers(e.SceneManager.NavigationMesh):BABYLON.Tools.Warn("Failed to generate navigation mesh geometry")}else BABYLON.Tools.Warn("Failed to build navigation mesh data");return e.SceneManager.NavigationMesh},t.SaveNavigationMesh=function(){if("undefined"==typeof Recast)return null;var t=e.SceneManager.GetNavigationTools();return null!=t&&null!=t.navMesh?t.getNavmeshData():null},t.ComputeNavigationPath=function(t,n,o){if(void 0===o&&(o=!0),"undefined"==typeof Recast)return null;var i=e.SceneManager.GetNavigationTools(),r=o===!0?i.getClosestPoint(t):t,a=o===!0?i.getClosestPoint(n):n;return null!=i&&null!=i.navMesh?i.computePath(r,a):null},t.MoveAlongNavigationPath=function(e,t,n,o,i,r){void 0===i&&(i=null);var a=null;if(n&&n.length>0){for(var l=0,s=[{frame:0,value:t.position}],u=0;u<n.length;u++)l+=BABYLON.Vector3.Distance(s[u].value,n[u]),s.push({frame:l,value:n[u]});a=new BABYLON.Animation("Navigation","position",3,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),null!=i&&a.setEasingFunction(i),a.setKeys(s),t.animations=[a],e.beginAnimation(t,0,l,!1,o,r)}return a},t.AddNavigationCylinderObstacle=function(t,n,o){if("undefined"==typeof Recast)return null;var i=e.SceneManager.GetNavigationTools();return null!=i&&null!=i.navMesh?i.addCylinderObstacle(t,n,o):null},t.AddNavigationBoxObstacle=function(t,n,o){if("undefined"==typeof Recast)return null;var i=e.SceneManager.GetNavigationTools();return null!=i&&null!=i.navMesh?i.addBoxObstacle(t,n,o):null},t.RemoveNavigationObstacle=function(t){if("undefined"==typeof Recast)return null;var n=e.SceneManager.GetNavigationTools();null!=n&&null!=n.navMesh&&n.removeObstacle(t)},t.ToggleFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().switchFullscreen(t)},t.EnterFullscreenMode=function(e,t){void 0===t&&(t=!0),e.getEngine().enterFullscreen(t)},t.ExitFullscreenMode=function(e){e.getEngine().exitFullscreen()},t.WindowState={},t.GlobalOptions={},t.ServerEndPoint="http://127.0.0.1:2567",t.EnableDebugMode=!1,t.EnableUserInput=!0,t.RenderLoopReady=!0,t.PauseRenderLoop=!1,t.LostRenderContext=!1,t.AutoUpdateProgress=!0,t.PhysicsCapsuleShape=0,t.SupportSRGBBuffers=!1,t.AnimationStartMode=0,t.AnimationTargetFps=30,t.DefaultConvexHullMargin=.001,t.DefaultHeightFieldMargin=.001,t.AmbientLightIntensity=.5,t.PointLightIntensity=1,t.SpotLightIntensity=10,t.DirectionalLightIntensity=2,t.TerrainColorCorrection=2.2,t.AllowCameraMovement=!0,t.AllowCameraRotation=!0,t.VirtualJoystickEnabled=!1,t.GameTimeMilliseconds=0,t.ParseScriptComponents=!0,t.AutoLoadScriptBundles=!0,t.WaitForSeconds=function(t){return new Promise(function(n){return e.SceneManager.SetTimeout(1e3*t,n)})},t.OnPreRenderLoopObservable=new BABYLON.Observable,t.OnPostRenderLoopObservable=new BABYLON.Observable,t.OnSceneReadyObservable=new BABYLON.Observable,t.OnEngineResizeObservable=new BABYLON.Observable,t.OnLoadCompleteObservable=new BABYLON.Observable,t.OnRebuildContextObservable=new BABYLON.Observable,t.OnAssetManagerProgress=null,t.SceneParsingEnabled=!0,t.AdvDynamicTexture=null,t.MAX_AGENT_COUNT=200,t.MAX_AGENT_RADIUS=2,t.NavigationMesh=null,t.CrowdInterface=null,t.PluginInstance=null,t.OnNavMeshReadyObservable=new BABYLON.Observable,t}();e.SceneManager=t}(UNITY||(UNITY={}));var SM=UNITY.SceneManager;UNITY.SceneManager.GameTimeMilliseconds=UNITY.SceneManager.GetTimeMilliseconds();var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),UNITY;!function(e){var t;!function(t){t[t.Deg2Rad=2*Math.PI/360]="Deg2Rad",t[t.Rad2Deg=1/e.System.Deg2Rad]="Rad2Deg",t[t.Epsilon=1e-6]="Epsilon",t[t.SingleEpsilon=1.401298e-45]="SingleEpsilon",t[t.EpsilonNormalSqrt=1e-15]="EpsilonNormalSqrt",t[t.Kph2Mph=.621371]="Kph2Mph",t[t.Mph2Kph=1.60934]="Mph2Kph",t[t.Mps2Kph=3.6]="Mps2Kph",t[t.Mps2Mph=2.23694]="Mps2Mph",t[t.Meter2Inch=39.3701]="Meter2Inch",t[t.Inch2Meter=.0254]="Inch2Meter",t[t.Gravity=9.81]="Gravity",t[t.Gravity3G=29.400000000000002]="Gravity3G",t[t.SkidFactor=.25]="SkidFactor",t[t.MaxInteger=2147483647]="MaxInteger",t[t.WalkingVelocity=4.4]="WalkingVelocity",t[t.TerminalVelocity=55]="TerminalVelocity",t[t.SmoothDeltaFactor=.2]="SmoothDeltaFactor",t[t.ToLinearSpace=2.2]="ToLinearSpace",t[t.ToGammaSpace=.45454545454545453]="ToGammaSpace"}(t=e.System||(e.System={}));var n;!function(e){e[e.Default=-1]="Default",e[e.Right=0]="Right",e[e.Left=1]="Left"}(n=e.Handedness||(e.Handedness={}));var o;!function(e){e[e.ExactMatch=0]="ExactMatch",e[e.StartsWith=1]="StartsWith",e[e.EndsWith=2]="EndsWith",e[e.IndexOf=3]="IndexOf"}(o=e.SearchType||(e.SearchType={}));var i;!function(e){e[e.Auto=0]="Auto",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four"}(i=e.PlayerNumber||(e.PlayerNumber={}));var r;!function(e){e[e.FirstPerson=0]="FirstPerson",e[e.ThirdPerson=1]="ThirdPerson"}(r=e.PlayerControl||(e.PlayerControl={}));var a;!function(e){e[e.High=0]="High",e[e.Medium=1]="Medium",e[e.Low=2]="Low"}(a=e.RenderQuality||(e.RenderQuality={}));var l;!function(e){e[e.None=-1]="None",e[e.Generic=0]="Generic",e[e.Xbox360=1]="Xbox360",e[e.DualShock=2]="DualShock",e[e.PoseController=3]="PoseController"}(l=e.GamepadType||(e.GamepadType={}));var s;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(s=e.Xbox360Trigger||(e.Xbox360Trigger={}));var u;!function(e){e[e.DirectVelocity=0]="DirectVelocity",e[e.AppliedForces=1]="AppliedForces"}(u=e.MovementType||(e.MovementType={}));var c;!function(e){e[e.Top=0]="Top",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Bottom=3]="Bottom"}(c=e.CollisionContact||(e.CollisionContact={}));var d;!function(e){e[e.AABB=0]="AABB",e[e.OBB=1]="OBB"}(d=e.IntersectionPrecision||(e.IntersectionPrecision={}));var p;!function(e){e[e.DefaultFilter=1]="DefaultFilter",e[e.StaticFilter=2]="StaticFilter",e[e.KinematicFilter=4]="KinematicFilter",e[e.DebrisFilter=8]="DebrisFilter",e[e.SensorTrigger=16]="SensorTrigger",e[e.CharacterFilter=32]="CharacterFilter",e[e.AllFilter=-1]="AllFilter"}(p=e.CollisionFilters||(e.CollisionFilters={}));var h;!function(e){e[e.ACTIVE_TAG=1]="ACTIVE_TAG",e[e.ISLAND_SLEEPING=2]="ISLAND_SLEEPING",e[e.WANTS_DEACTIVATION=3]="WANTS_DEACTIVATION",e[e.DISABLE_DEACTIVATION=4]="DISABLE_DEACTIVATION",e[e.DISABLE_SIMULATION=5]="DISABLE_SIMULATION"}(h=e.CollisionState||(e.CollisionState={}));var m;!function(e){e[e.CF_STATIC_OBJECT=1]="CF_STATIC_OBJECT",e[e.CF_KINEMATIC_OBJECT=2]="CF_KINEMATIC_OBJECT",e[e.CF_NO_CONTACT_RESPONSE=4]="CF_NO_CONTACT_RESPONSE",e[e.CF_CUSTOM_MATERIAL_CALLBACK=8]="CF_CUSTOM_MATERIAL_CALLBACK",e[e.CF_CHARACTER_OBJECT=16]="CF_CHARACTER_OBJECT",e[e.CF_DISABLE_VISUALIZE_OBJECT=32]="CF_DISABLE_VISUALIZE_OBJECT",e[e.CF_DISABLE_SPU_COLLISION_PROCESSING=64]="CF_DISABLE_SPU_COLLISION_PROCESSING",e[e.CF_HAS_CONTACT_STIFFNESS_DAMPING=128]="CF_HAS_CONTACT_STIFFNESS_DAMPING",e[e.CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR=256]="CF_HAS_CUSTOM_DEBUG_RENDERING_COLOR",e[e.CF_HAS_FRICTION_ANCHOR=512]="CF_HAS_FRICTION_ANCHOR",e[e.CF_HAS_COLLISION_SOUND_TRIGGER=1024]="CF_HAS_COLLISION_SOUND_TRIGGER"}(m=e.CollisionFlags||(e.CollisionFlags={}));var f;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(f=e.UserInputPointer||(e.UserInputPointer={}));var g;!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.ClientX=2]="ClientX",e[e.ClientY=3]="ClientY",e[e.MouseX=4]="MouseX",e[e.MouseY=5]="MouseY",e[e.Wheel=6]="Wheel"}(g=e.UserInputAxis||(e.UserInputAxis={}));var y;!function(e){e[e.BackSpace=8]="BackSpace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Pause=19]="Pause",e[e.Break=19]="Break",e[e.CapsLock=20]="CapsLock",e[e.Escape=27]="Escape",e[e.SpaceBar=32]="SpaceBar",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.LeftArrow=37]="LeftArrow",e[e.UpArrow=38]="UpArrow",e[e.RightArrow=39]="RightArrow",
e[e.DownArrow=40]="DownArrow",e[e.Insert=45]="Insert",e[e.Delete=46]="Delete",e[e.Num0=48]="Num0",e[e.Num1=49]="Num1",e[e.Num2=50]="Num2",e[e.Num3=51]="Num3",e[e.Num4=52]="Num4",e[e.Num5=53]="Num5",e[e.Num6=54]="Num6",e[e.Num7=55]="Num7",e[e.Num8=56]="Num8",e[e.Num9=57]="Num9",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.LeftWindowKey=91]="LeftWindowKey",e[e.RightWindowKey=92]="RightWindowKey",e[e.SelectKey=93]="SelectKey",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.Multiply=106]="Multiply",e[e.Add=107]="Add",e[e.Subtract=109]="Subtract",e[e.DecimalPoint=110]="DecimalPoint",e[e.Divide=111]="Divide",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=144]="NumLock",e[e.ScrollLock=145]="ScrollLock",e[e.SemiColon=186]="SemiColon",e[e.EqualSign=187]="EqualSign",e[e.Comma=188]="Comma",e[e.Dash=189]="Dash",e[e.Period=190]="Period",e[e.ForwardSlash=191]="ForwardSlash",e[e.GraveAccent=192]="GraveAccent",e[e.OpenBracket=219]="OpenBracket",e[e.BackSlash=220]="BackSlash",e[e.CloseBraket=221]="CloseBraket",e[e.SingleQuote=222]="SingleQuote"}(y=e.UserInputKey||(e.UserInputKey={}));var v=function(){function e(){}return e.KeyboardSmoothing=!1,e.KeyboardMoveSensibility=3,e.KeyboardMoveDeadZone=.001,e.GamepadDeadStickValue=.25,e.GamepadLStickXInverted=!1,e.GamepadLStickYInverted=!1,e.GamepadRStickXInverted=!1,e.GamepadRStickYInverted=!0,e.GamepadLStickSensibility=1,e.GamepadRStickSensibility=1,e.SupportedInputDevices=null,e.PointerAngularSensibility=.5,e.PointerWheelDeadZone=.1,e.PointerMouseDeadZone=.1,e.PointerMouseInverted=!0,e.UseCanvasElement=!0,e.UseArrowKeyRotation=!1,e}();e.UserInputOptions=v;var _=function(){function e(){}return e}();e.RequestHeader=_;var B=function(){function e(){this.mesh=null,this.state=0}return e}();e.TriggerVolume=B;var b=function(){function e(){}return e}();e.RoomErrorMessage=b;var C=function(){function e(e,t,n,o,i){void 0===n&&(n=!0),void 0===o&&(o=null),void 0===i&&(i=null),this.loadingDivId=e,this.loadingUIText=t,this.hideLoadingUIWithEngine=n,this.customInnerHtml=o,this.customInnerCss=i,this.loadingUIBackgroundColor="#000000",null!=this.loadingDivId&&""!==this.loadingDivId||(this.loadingDivId="customLoadingScreen"),null!=this.loadingUIText&&""!==this.loadingUIText||(this.loadingUIText="Please Wait")}return e.prototype.displayLoadingUI=function(){if(this.hasLoadingDiv())return void this.showLoadingDiv(!0);var e="",t=document.createElement("style");t.type="text/css",t.innerHTML=this.customInnerCss||e,document.getElementsByTagName("head")[0].appendChild(t);var n=this.loadingUIText,o=document.createElement("div");o.id=this.loadingDivId,o.innerHTML=this.customInnerHtml||n,document.body.appendChild(o)},e.prototype.hideLoadingUI=function(){this.hideLoadingUIWithEngine===!0&&this.showLoadingDiv(!1)},e.prototype.showLoadingDiv=function(e){var t=this.getLoadingDiv();null!=t&&(t.style.display=e?"initial":"none")},e.prototype.getLoadingDiv=function(){return document.getElementById(this.loadingDivId)},e.prototype.hasLoadingDiv=function(){return null!=document.getElementById(this.loadingDivId)},e}();e.CustomLoadingScreen=C;var T=function(){function e(){this.ListenerDictionary={}}return e.prototype.AddListener=function(e,t){var n;null==this.ListenerDictionary[e]?(n=[],this.ListenerDictionary[e]=n):n=this.ListenerDictionary[e],n.push(t)},e.prototype.RemoveListener=function(e,t){var n=this.ListenerDictionary[e];if(null!=n){var o=n.findIndex(function(e){return t==e});o>=0&&n.splice(o,1)}},e.prototype.RaiseMessage=function(e,t){void 0===t&&(t=null);var n=this.ListenerDictionary[e];null!=n&&n.forEach(function(e){e(t)})},e}();e.EventMessageBus=T;var I=function(){function t(e,t,n,o,i,r){void 0===n&&(n=1),void 0===o&&(o=!0),void 0===i&&(i=!1),void 0===r&&(r=!0),this.prefabName=null,this.allowGrowth=!0,this.assetContainer=null,this.cloneAnimations=!0,this.makeNewMaterials=!1,this.availableInstances=null,this.prefabName=t,this.allowGrowth=o,this.assetContainer=e,this.cloneAnimations=r,this.makeNewMaterials=i,this.availableInstances=[],this.populatePool(n)}return t.prototype.getAvailableCount=function(){return this.availableInstances.length},t.prototype.populatePool=function(e){if(e>0)for(var t=0;t<e;t++){var n=this.createNewInstance();null!=n&&this.freeInstance(n)}},t.prototype.getInstance=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var n=this.availableInstances.length>0?this.availableInstances.pop():this.appendNewInstance();return null!=n&&(null!=e?n.position.copyFrom(e):n.position.set(0,0,0),null!=t?null!=n.rotationQuaternion?n.rotationQuaternion.copyFrom(t):n.rotationQuaternion=t.clone():null!=n.rotationQuaternion?n.rotationQuaternion.set(0,0,0,1):n.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),n.name=this.prefabName+".Instance",n.setEnabled(!0)),n},t.prototype.freeInstance=function(e){null!=e&&(e.setEnabled(!1),e.position.set(0,0,0),null!=e.rotationQuaternion?e.rotationQuaternion.set(0,0,0,1):e.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.components&&e.metadata.unity.components.forEach(function(e){if(null!=e)try{e.resetScriptComponent()}catch(t){}}),e.name=this.prefabName+".Unassigned",this.availableInstances.push(e))},t.prototype.appendNewInstance=function(){var e=null;return this.allowGrowth===!0&&(e=this.createNewInstance()),e},t.prototype.createNewInstance=function(t,n,o,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null);var r=null;return null!=this.assetContainer&&null!=this.prefabName&&""!==this.prefabName&&(this.assetContainer instanceof BABYLON.AssetContainer?r=e.SceneManager.InstantiatePrefabFromContainer(this.assetContainer,this.prefabName,this.prefabName+".Instance",t,n,o,i,this.cloneAnimations,this.makeNewMaterials):this.assetContainer instanceof BABYLON.Scene&&(r=e.SceneManager.InstantiatePrefabFromScene(this.assetContainer,this.prefabName,this.prefabName+".Instance",t,n,o,i,this.cloneAnimations))),r},t}();e.PrefabObjectPool=I;var S=function(){function e(){this._hit=!1,this._dest=new BABYLON.Vector3(0,0,0),this._origin=new BABYLON.Vector3(0,0,0),this._hitPoint=new BABYLON.Vector3(0,0,0),this._hitNormal=new BABYLON.Vector3(0,0,0),this._hitDistance=0,this._collisionObject=null,this.reset(BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero())}return Object.defineProperty(e.prototype,"hasHit",{get:function(){return this._hit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitPoint",{get:function(){return this._hitPoint},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitNormal",{get:function(){return this._hitNormal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionObject",{get:function(){return this._collisionObject},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rayDestination",{get:function(){return this._dest},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rayOrigin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),e.prototype.reset=function(e,t){this._hit=!1,this._hitPoint.set(0,0,0),this._hitNormal.set(0,0,0),this._hitDistance=0,this._collisionObject=null,this._origin.copyFrom(e),this._dest.copyFrom(t)},e.prototype.update=function(e,t,n,o,i,r,a,l){void 0===l&&(l=null),this._hit=e,this._hitPoint.set(t,n,o),this._hitNormal.set(i,r,a),this._hitDistance=BABYLON.Vector3.Distance(this._origin,this.hitPoint),this._collisionObject=l},e}();e.RaycastHitResult=S;var A=function(){function t(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=.5),this._numPoints=-1,this._pointMesh=null,this._pointSize=.5,this._pointType=0,this._linesName="MeshLines",this._linesMesh=null,this._babylonScene=null,this._pointMesh=null,this._linesMesh=null,this._linesName=e,this._babylonScene=t,this._pointType=n,this._pointSize=o}return Object.defineProperty(t.prototype,"pointMesh",{get:function(){return this._pointMesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linesMesh",{get:function(){return this._linesMesh},enumerable:!1,configurable:!0}),t.prototype.dispose=function(e){void 0===e&&(e=!0),this._babylonScene=null,this._linesName=null,null!=this._pointMesh&&(this._pointMesh.dispose(e),this._pointMesh=null),null!=this._linesMesh&&(this._linesMesh.dispose(e),this._linesMesh=null)},t.prototype.hidePoint=function(e){void 0===e&&(e=!0),null!=this._pointMesh&&(this._pointMesh.isVisible=!e)},t.prototype.drawPoint=function(t){null==this._pointMesh&&(1===this._pointType?(this._pointMesh=BABYLON.MeshBuilder.CreateBox(this._linesName+".EndPoint",{size:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25):(this._pointMesh=BABYLON.MeshBuilder.CreateSphere(this._linesName+".EndPoint",{segments:24,diameter:2*this._pointSize},this._babylonScene),this._pointMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),this._pointMesh.visibility=.25)),null!=this._pointMesh&&(this._pointMesh.isVisible=!0,this._pointMesh.position.copyFrom(t))},t.prototype.drawLine=function(t,n){void 0===n&&(n=null),null==this._linesMesh?(this._numPoints=t.length,this._linesMesh=BABYLON.MeshBuilder.CreateLines(this._linesName,{points:t,updatable:!0},this._babylonScene),this._linesMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),null!=n&&(this._linesMesh.color=n),this._linesMesh.refreshBoundingInfo(!1)):t.length===this._numPoints?(this._linesMesh=BABYLON.MeshBuilder.CreateLines(this._linesName,{points:t,instance:this._linesMesh},this._babylonScene),this._linesMesh.renderingGroupId=e.Utilities.DefaultRenderGroup(),null!=n&&(this._linesMesh.color=n),this._linesMesh.refreshBoundingInfo(!1)):BABYLON.Tools.Warn("Dynamic line mesh point count mismatch for "+this._linesName)},t}();e.LinesMeshRenderer=A;var O=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.addContainerTask=function(e,t,n,o){var i=this,r=new BABYLON.ContainerAssetTask(e,t,n,o),a=r;return a._lengthComputable=0,a._loaded=0,a._total=0,a.runTask=function(e,t,n){BABYLON.SceneLoader.LoadAssetContainer(r.rootUrl,r.sceneFilename,e,function(e){r.loadedContainer=e,r.loadedMeshes=e.meshes,r.loadedParticleSystems=e.particleSystems,r.loadedSkeletons=e.skeletons,r.loadedAnimationGroups=e.animationGroups,t()},function(e){a._lengthComputable=e.lengthComputable,a._loaded=e.loaded,a._total=e.total,i.handlePreloadingProgress()},function(e,t,o){n(t,o)})},this._tasks.push(r),r},n.prototype.addMeshTask=function(e,t,n,o){var i=this,r=new BABYLON.MeshAssetTask(e,t,n,o),a=r;return a._lengthComputable=0,a._loaded=0,a._total=0,a.runTask=function(e,t,n){BABYLON.SceneLoader.ImportMesh(r.meshesNames,r.rootUrl,r.sceneFilename,e,function(e,n,o,i){r.loadedMeshes=e,r.loadedParticleSystems=n,r.loadedSkeletons=o,r.loadedAnimationGroups=i,t()},function(e){a._lengthComputable=e.lengthComputable,a._loaded=e.loaded,a._total=e.total,i.handlePreloadingProgress()},function(e,t,o){n(t,o)})},this._tasks.push(r),r},n.prototype.addTextFileTask=function(e,t){var n=this,o=new BABYLON.TextFileAssetTask(e,t),i=o;return i._lengthComputable=0,i._loaded=0,i._total=0,i.runTask=function(e,t,r){e._loadFile(o.url,function(e){o.text=e,t()},function(e){i._lengthComputable=e.lengthComputable,i._loaded=e.loaded,i._total=e.total,n.handlePreloadingProgress()},!1,!1,function(e,t){e&&r(e.status+" "+e.statusText,t)})},this._tasks.push(o),o},n.prototype.addBinaryFileTask=function(e,t){var n=this,o=new BABYLON.BinaryFileAssetTask(e,t),i=o;return i._lengthComputable=0,i._loaded=0,i._total=0,i.runTask=function(e,t,r){e._loadFile(o.url,function(e){o.data=e,t()},function(e){i._lengthComputable=e.lengthComputable,i._loaded=e.loaded,i._total=e.total,n.handlePreloadingProgress()},!0,!0,function(e,t){e&&r(e.status+" "+e.statusText,t)})},this._tasks.push(o),o},n.prototype.addImageTask=function(e,t){var n=this,o=new BABYLON.ImageAssetTask(e,t),i=o;return i._lengthComputable=0,i._loaded=0,i._total=0,i.runTask=function(e,t,r){var a=new Image;BABYLON.Tools.SetCorsBehavior(o.url,a),a.onload=function(){o.image=a,t()},a.onerror=function(e){r("Error loading image",e)},a.onprogress=function(e){i._lengthComputable=e.lengthComputable,i._loaded=e.loaded,i._total=e.total,n.handlePreloadingProgress()},a.src=o.url},this._tasks.push(o),o},n.prototype.handlePreloadingProgress=function(){var t=!0,n=0,o=0;if(null!=this._tasks&&this._tasks.length>0)for(var i=0;i<this._tasks.length;i++){var r=this._tasks[i];null!=r._lengthComputable&&null!=r._loaded&&null!=r._total&&(t=t&&r._lengthComputable,n+=r._loaded,o+=r._total)}if(null!=e.SceneManager.OnAssetManagerProgress){var a={lengthComputable:t,loaded:n,total:t?o:0};e.SceneManager.OnAssetManagerProgress(a)}},n}(BABYLON.AssetsManager);e.PreloadAssetsManager=O;var x=function(){function e(){}return e.HasNetworkEntity=function(e){return null!=e&&null!=e.networkEntity},e.GetNetworkEntityId=function(e){return null==e?null:null!=e.networkEntity?e.networkEntity.id:null},e.GetNetworkEntityType=function(e){return null==e?0:null!=e.networkEntityType?e.networkEntityType:0},e.GetNetworkEntitySessionId=function(e){return null==e?null:null!=e.networkEntity?e.networkEntity.ownerId:null},e.QueryNetworkAttribute=function(e,t){var n=null;return null!=e&&null!=e.networkEntity&&null!=e.networkEntity.attributes&&(n=e.networkEntity.attributes.get(t)),n},e.QueryBufferedAttribute=function(e,t){var n=0;return null!=e&&null!=e.networkEntityAttributeBuffer&&(n=e.networkEntityAttributeBuffer[t.toFixed(0)]),n},e.PostBufferedAttribute=function(e,t,n){null==e.networkEntityBatch&&(e.networkEntityBatch={}),e.networkEntityBatch[t.toFixed(0)]=n},e}();e.EntityController=x;var M=function(){function t(){}return t.ZeroPad=function(e,t){var n=t-e.toString().length+1;return Array(+(n>0&&n)).join("0")+e},t.ShiftArray=function(e,t){return t?e.unshift(e.pop()):e.push(e.shift()),e},t.GetLayerMask=function(e){return 1<<e},t.IsLayerMasked=function(e,t){return 0!=(e&1<<t)},t.GetLoadingState=function(){return e.Utilities.LoadingState},t.GetRandomRange=function(e,t,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var i=BABYLON.Scalar.RandomRange(e,t);if(null!=n){var r=null!=o?o:100;if(i===n)for(var a=0;a<r&&(i=BABYLON.Scalar.RandomRange(e,t),i===n);a++);}return i},t.GetRandomFloat=function(t,n,o,i){return void 0===o&&(o=null),void 0===i&&(i=null),parseFloat(e.Utilities.GetRandomRange(t,n,o,i).toFixed(2))},t.GetRandomInteger=function(t,n,o,i){return void 0===o&&(o=null),void 0===i&&(i=null),parseInt(e.Utilities.GetRandomRange(t,n,o,i).toFixed(0))},t.Approximately=function(t,n){return Math.abs(n-t)<Math.max(e.System.Epsilon*Math.max(Math.abs(t),Math.abs(n)),8*e.System.SingleEpsilon)},t.GetVertexDataFromMesh=function(e){var t=e.computeWorldMatrix(!0),n=BABYLON.VertexData.ExtractFromMesh(e,!0,!0);return n.transform(t),n},t.UpdateAbstractMeshMaterial=function(e,t,n){if(null!=e){var o=e instanceof BABYLON.InstancedMesh;if(o===!1){var i=e.material;if(i instanceof BABYLON.MultiMaterial){var r=i.clone(i.name+".Clone");r.subMaterials[n]=t,e.material=r}else e.material=t}else console.warn("Instanced mesh not supported as a node material on mesh: "+e.name)}else console.warn("Null source mesh for mesh: "+e.name)},t.HermiteVector3=function(t,n,o,i,r){var a=new BABYLON.Vector3(0,0,0);return e.Utilities.HermiteVector3ToRef(t,n,o,i,r,a),a},t.HermiteVector3ToRef=function(e,t,n,o,i,r){var a=i*i,l=i*a,s=2*l-3*a+1,u=-2*l+3*a,c=l-2*a+i,d=l-a,p=e._x*s+n._x*u+t._x*c+o._x*d,h=e._y*s+n._y*u+t._y*c+o._y*d,m=e._z*s+n._z*u+t._z*c+o._z*d;r.set(p,h,m)},t.LerpLog=function(e,t,n){var o=Math.min(Math.max(n,0),1),i=Math.sin(o*Math.PI*.5);return e+(t-e)*i},t.LerpExp=function(e,t,n){var o=Math.min(Math.max(n,0),1),i=1-Math.cos(o*Math.PI*.5);return e+(t-e)*i},t.LerpUnclamped=function(e,t,n){return e+(t-e)*n},t.LerpUnclampedColor3=function(t,n,o){var i=new BABYLON.Color3(0,0,0);return e.Utilities.LerpUnclampedColor3ToRef(t,n,o,i),i},t.LerpUnclampedColor3ToRef=function(e,t,n,o){o.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n)},t.LerpUnclampedColor4=function(t,n,o){var i=new BABYLON.Color4(0,0,0,1);return e.Utilities.LerpUnclampedColor4ToRef(t,n,o,i),i},t.LerpUnclampedColor4ToRef=function(e,t,n,o){o.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n,e.a+(t.a-e.a)*n)},t.LerpUnclampedVector2=function(t,n,o){var i=new BABYLON.Vector2(0,0);return e.Utilities.LerpUnclampedVector2ToRef(t,n,o,i),i},t.LerpUnclampedVector2ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},t.LerpUnclampedVector3=function(t,n,o){var i=new BABYLON.Vector3(0,0,0);return e.Utilities.LerpUnclampedVector3ToRef(t,n,o,i),i},t.LerpUnclampedVector3ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n)},t.LerpUnclampedVector4=function(t,n,o){var i=new BABYLON.Vector4(0,0,0,0);return e.Utilities.LerpUnclampedVector4ToRef(t,n,o,i),i},t.LerpUnclampedVector4ToRef=function(e,t,n,o){o.set(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n,e.w+(t.w-e.w)*n)},t.IsEqualUsingDot=function(t){return t>1-e.System.Epsilon},t.QuaternionAngle=function(t,n){var o=Math.min(Math.abs(BABYLON.Quaternion.Dot(t,n)),1);return e.Utilities.IsEqualUsingDot(o)?0:2*Math.acos(o)*e.System.Rad2Deg},t.QuaternionLengthSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},t.QuaternionRotateTowards=function(t,n,o){var i=new BABYLON.Quaternion(0,0,0,1);return e.Utilities.QuaternionRotateTowardsToRef(t,n,o,i),i},t.QuaternionRotateTowardsToRef=function(t,n,o,i){var r=e.Utilities.QuaternionAngle(t,n);0==r?i.copyFrom(n):e.Utilities.QuaternionSlerpUnclampedToRef(t,n,Math.min(1,o/r),i)},t.QuaternionSlerpUnclamped=function(t,n,o){var i=new BABYLON.Quaternion(0,0,0,1);return e.Utilities.QuaternionSlerpUnclampedToRef(t,n,o,i),i},t.QuaternionSlerpUnclampedToRef=function(e,t,n,o){},t.MoveTowardsVector2=function(t,n,o){var i=new BABYLON.Vector2(0,0);return e.Utilities.MoveTowardsVector2ToRef(t,n,o,i),i},t.MoveTowardsVector2ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=i*i+r*r;if(0==a||n>=0&&a<=n*n)o.set(t.x,t.y);else{var l=Math.sqrt(a);o.set(e.x+i/l*n,e.y+r/l*n)}},t.MoveTowardsVector3=function(t,n,o){var i=new BABYLON.Vector3(0,0,0);return e.Utilities.MoveTowardsVector3ToRef(t,n,o,i),i},t.MoveTowardsVector3ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z,l=i*i+r*r+a*a;if(0==l||n>=0&&l<=n*n)o.set(t.x,t.y,t.z);else{var s=Math.sqrt(l);o.set(e.x+i/s*n,e.y+r/s*n,e.z+a/s*n)}},t.MoveTowardsVector4=function(t,n,o){var i=new BABYLON.Vector4(0,0,0,0);return e.Utilities.MoveTowardsVector4ToRef(t,n,o,i),i},t.MoveTowardsVector4ToRef=function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z,l=t.w-e.w,s=i*i+r*r+a*a+l*l;if(0==s||n>=0&&s<=n*n)o.set(t.x,t.y,t.z,t.w);else{var u=Math.sqrt(s);o.set(e.x+i/u*n,e.y+r/u*n,e.z+a/u*n,e.w+l/u*n)}},t.ClampMagnitudeVector2=function(t,n){var o=new BABYLON.Vector2(0,0);return e.Utilities.ClampMagnitudeVector2ToRef(t,n,o),o},t.ClampMagnitudeVector2ToRef=function(e,t,n){var o=e.lengthSquared();if(o>t*t){var i=Math.sqrt(o),r=e.x/i,a=e.y/i;n.set(r*t,a*t)}},t.ClampMagnitudeVector3=function(t,n){var o=new BABYLON.Vector3(0,0,0);return e.Utilities.ClampMagnitudeVector3ToRef(t,n,o),o},t.ClampMagnitudeVector3ToRef=function(e,t,n){var o=e.lengthSquared();if(o>t*t){var i=Math.sqrt(o),r=e.x/i,a=e.y/i,l=e.z/i;n.set(r*t,a*t,l*t)}},t.GetAngle=function(t,n){return e.Utilities.GetAngleRadians(t,n)*e.System.Rad2Deg},t.GetAngleRadians=function(e,t){return Math.acos(BABYLON.Vector3.Dot(e,t))},t.ClampAngle=function(e,t,n){var o=e;do o<-360&&(o+=360),o>360&&(o-=360);while(o<-360||o>360);return BABYLON.Scalar.Clamp(o,t,n)},t.ClampAngle180=function(e,t,n){return e>180&&(e-=360),e=BABYLON.Scalar.Clamp(e,t,n),e<0&&(e+=360),e},t.ClampAngle360=function(e,t,n){return(e<90||e>270)&&(e>180&&(e-=360),n>180&&(n-=360),t>180&&(t-=360)),e=BABYLON.Scalar.Clamp(e,t,n),e<0&&(e+=360),e},t.SmoothDamp=function(e,t,n,o,i,r){if(!r)return 0;var a=e-t,l=Math.max(1e-4,n),s=2/l,u=s*i,c=1/(1+u+.48*u*u+.235*u*u*u),d=t,p=o*l;a=BABYLON.Scalar.Clamp(a,-p,p);var h=e-a,m=(r.x+s*a)*i;r.x=(r.x-s*m)*c;var f=h+(a+m)*c;return d-e>0==f>d&&(f=d,r.x=(f-d)/i),f},t.SmoothDampAngle=function(t,n,o,i,r,a){var l=t+BABYLON.Scalar.DeltaAngle(t,n);return e.Utilities.SmoothDamp(t,l,o,i,r,a)},t.SmoothDampVector2=function(t,n,o,i,r,a){var l=new BABYLON.Vector2(0,0);return e.Utilities.SmoothDampVector2ToRef(t,n,o,i,r,a,l),l},t.SmoothDampVector2ToRef=function(e,t,n,o,i,r,a){n=Math.max(1e-4,n);var l=2/n,s=l*i,u=1/(1+s+.48*s*s+.235*s*s*s),c=e.x-t.x,d=e.y-t.y,p=t.clone(),h=o*n,m=h*h,f=c*c+d*d;if(f>m){var g=Math.sqrt(f);c=c/g*h,d=d/g*h}t.x=e.x-c,t.y=e.y-d;var y=(r.x+l*c)*i,v=(r.y+l*d)*i;r.x=(r.x-l*y)*u,r.y=(r.y-l*v)*u;var _=t.x+(c+y)*u,B=t.y+(d+v)*u,b=p.x-e.x,C=p.y-e.y,T=_-p.x,I=B-p.y;b*T+C*I>0&&(_=p.x,B=p.y,r.x=(_-p.x)/i,r.y=(B-p.y)/i),a.set(_,B)},t.SmoothDampVector3=function(t,n,o,i,r,a){var l=new BABYLON.Vector3(0,0,0);return e.Utilities.SmoothDampVector3ToRef(t,n,o,i,r,a,l),l},t.SmoothDampVector3ToRef=function(e,t,n,o,i,r,a){var l=0,s=0,u=0;n=Math.max(1e-4,n);var c=2/n,d=c*i,p=1/(1+d+.48*d*d+.235*d*d*d),h=e.x-t.x,m=e.y-t.y,f=e.z-t.z,g=t.clone(),y=o*n,v=y*y,_=h*h+m*m+f*f;if(_>v){var B=Math.sqrt(_);h=h/B*y,m=m/B*y,f=f/B*y}t.x=e.x-h,t.y=e.y-m,t.z=e.z-f;var b=(r.x+c*h)*i,C=(r.y+c*m)*i,T=(r.z+c*f)*i;r.x=(r.x-c*b)*p,r.y=(r.y-c*C)*p,r.z=(r.z-c*T)*p,l=t.x+(h+b)*p,s=t.y+(m+C)*p,u=t.z+(f+T)*p;var I=g.x-e.x,S=g.y-e.y,A=g.z-e.z,O=l-g.x,x=s-g.y,M=u-g.z;I*O+S*x+A*M>0&&(l=g.x,s=g.y,u=g.z,r.x=(l-g.x)/i,r.y=(s-g.y)/i,r.z=(u-g.z)/i),a.set(l,s,u)},t.ToMatrix=function(e,t,n){return BABYLON.Matrix.RotationYawPitchRoll(BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(n))},t.ToMatrixToRef=function(e,t,n,o){BABYLON.Matrix.RotationYawPitchRollToRef(BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(n),o)},t.FastMatrixLerp=function(e,t,n,o){BABYLON.Matrix.LerpToRef(e,t,n,o)},t.FastMatrixSlerp=function(e,t,n,o){BABYLON.Matrix.DecomposeLerpToRef(e,t,n,o)},t.ToEuler=function(e){var t=e.toEulerAngles();return t.x=BABYLON.Tools.ToDegrees(t.x),t.y=BABYLON.Tools.ToDegrees(t.y),t.z=BABYLON.Tools.ToDegrees(t.z),t},t.ToEulerToRef=function(e,t){e.toEulerAnglesToRef(t),t.x=BABYLON.Tools.ToDegrees(t.x),t.y=BABYLON.Tools.ToDegrees(t.y),t.z=BABYLON.Tools.ToDegrees(t.z)},t.FromEuler=function(e,t,n){return BABYLON.Quaternion.FromEulerAngles(BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(n))},t.FromEulerToRef=function(e,t,n,o){BABYLON.Quaternion.FromEulerAnglesToRef(BABYLON.Tools.ToRadians(e),BABYLON.Tools.ToRadians(t),BABYLON.Tools.ToRadians(n),o)},t.QuaternionDiff=function(t,n){var o=new BABYLON.Quaternion(0,0,0,1);return e.Utilities.QuaternionDiffToRef(t,n,o),o},t.QuaternionDiffToRef=function(t,n,o){BABYLON.Quaternion.InverseToRef(n,e.Utilities.TempQuaternion),e.Utilities.TempQuaternion.multiplyToRef(t,o)},t.QuaternionSubtractToRef=function(e,t,n){n.set(e._x-t._x,e._y-t._y,e._z-t._z,e._w-t._w)},t.RotateVector=function(e,t){var n=2*(t.y*e.z-t.z*e.y),o=2*(t.z*e.x-t.x*e.z),i=2*(t.x*e.y-t.y*e.x);return new BABYLON.Vector3(e.x+t.w*n+(t.y*i-t.z*o),e.y+t.w*o+(t.z*n-t.x*i),e.z+t.w*i+(t.x*o-t.y*n))},t.RotateVectorToRef=function(e,t,n){var o=2*(t.y*e.z-t.z*e.y),i=2*(t.z*e.x-t.x*e.z),r=2*(t.x*e.y-t.y*e.x);n.x=e.x+t.w*o+(t.y*r-t.z*i),n.y=e.y+t.w*i+(t.z*o-t.x*r),n.z=e.z+t.w*r+(t.x*i-t.y*o)},t.LookRotation=function(t){var n=BABYLON.Quaternion.Zero();return e.Utilities.LookRotationToRef(t,n),n},t.LookRotationToRef=function(t,n){e.Utilities.TempMatrix.reset(),BABYLON.Matrix.LookAtLHToRef(e.Utilities.ZeroVector,t,e.Utilities.UpVector,e.Utilities.TempMatrix),e.Utilities.TempMatrix.invert(),BABYLON.Quaternion.FromRotationMatrixToRef(e.Utilities.TempMatrix,n)},t.Vector3Rad2Deg=function(t){var n=BABYLON.Vector3.Zero();return e.Utilities.Vector3Rad2DegToRef(t,n),n},t.Vector3Rad2DegToRef=function(e,t){t.x=BABYLON.Tools.ToDegrees(e.x),t.y=BABYLON.Tools.ToDegrees(e.y),t.z=BABYLON.Tools.ToDegrees(e.z)},t.MultiplyQuaternionByVector=function(t,n){var o=new BABYLON.Vector3(0,0,0);return e.Utilities.MultiplyQuaternionByVectorToRef(t,n,o),o},t.MultiplyQuaternionByVectorToRef=function(e,t,n){var o=2*e.x,i=2*e.y,r=2*e.z,a=e.x*o,l=e.y*i,s=e.z*r,u=e.x*i,c=e.x*r,d=e.y*r,p=e.w*o,h=e.w*i,m=e.w*r;n.x=(1-(l+s))*t.x+(u-m)*t.y+(c+h)*t.z,n.y=(u+m)*t.x+(1-(a+s))*t.y+(d-p)*t.z,n.z=(c-h)*t.x+(d+p)*t.y+(1-(a+l))*t.z},t.ValidateTransformRotation=function(e){null!=e.rotationQuaternion&&(e.rotation=e.rotationQuaternion.toEulerAngles(),e.rotationQuaternion=null)},t.ValidateTransformQuaternion=function(e){null==e.rotationQuaternion&&null!=e.rotation&&(e.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(e.rotation.x,e.rotation.y,e.rotation.z),e.rotation.set(0,0,0))},t.GetKeyboardInputValue=function(t,n,o){var i=o;return e.UserInputOptions.KeyboardSmoothing===!0&&(i=BABYLON.Scalar.MoveTowards(n,o,e.UserInputOptions.KeyboardMoveSensibility*e.SceneManager.GetDeltaSeconds(t)),Math.abs(i)<e.UserInputOptions.KeyboardMoveDeadZone&&(i=0)),i},t.GenerateRandonNumber=function(e,t,n){void 0===n&&(n=2);var o=(Math.random()*(t-e)+e).toFixed(n);return parseFloat(o)},t.ProjectVector=function(t,n){var o=new BABYLON.Vector3(0,0,0);return e.Utilities.ProjectVectorToRef(t,n,o),o},t.ProjectVectorToRef=function(t,n,o){var i=BABYLON.Vector3.Dot(n,n);if(i<e.System.Epsilon)o.set(0,0,0);else{var r=BABYLON.Vector3.Dot(t,n);o.set(n.x*r/i,n.y*r/i,n.z*r/i)}},t.ProjectVectorOnPlane=function(t,n){var o=new BABYLON.Vector3(0,0,0);return e.Utilities.ProjectVectorOnPlaneToRef(t,n,o),o},t.ProjectVectorOnPlaneToRef=function(t,n,o){var i=BABYLON.Vector3.Dot(n,n);if(i<e.System.Epsilon)o.copyFrom(t);else{var r=BABYLON.Vector3.Dot(t,n);o.set(t.x-n.x*r/i,t.y-n.y*r/i,t.z-n.z*r/i)}},t.AreVectorsEqual=function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n},t.GetVerticalSlopeAngle=function(t,n){void 0===n&&(n=0);var o=Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))*e.System.Rad2Deg;return o=null!=o&&Number.isNaN(o)===!1?o:0,n>0&&o>=n&&(o=0),o},t.DownloadEnvironment=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),BABYLON.EnvironmentTextureTools.CreateEnvTextureAsync(e).then(function(n){var o=e.name||"Environment",i=new Blob([n],{type:"octet/stream"});BABYLON.Tools.Download(i,o+".env"),null!=t&&t()})["catch"](function(e){console.error(e),null!=n&&n()})},t.HasOwnProperty=function(e,t){return null!=e&&null!=t&&""!==t&&t in e},t.FindMeshCollider=function(e,t){var n=null;if(t instanceof BABYLON.TransformNode){var o=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.renderer&&null!=t.metadata.unity.renderer.hasmeshcollider&&t.metadata.unity.renderer.hasmeshcollider===!0;if(o===!0){var i=t.id+"-collider";n=e.getMeshById(i)}}return n},t.ColliderInstances=function(){return null==e.SceneManager.GlobalOptions.colliderInstances||e.SceneManager.GlobalOptions.colliderInstances},t.ReparentColliders=function(){return null==e.SceneManager.GlobalOptions.reparentColliders||e.SceneManager.GlobalOptions.reparentColliders},t.UseTriangleNormals=function(){return null!=e.SceneManager.GlobalOptions.useTriangleNormals&&e.SceneManager.GlobalOptions.useTriangleNormals},t.UseConvexTriangles=function(){return null!=e.SceneManager.GlobalOptions.useConvexTriangles&&e.SceneManager.GlobalOptions.useConvexTriangles},t.DefaultRenderGroup=function(){return null!=e.SceneManager.GlobalOptions.defaultRenderGroup?e.SceneManager.GlobalOptions.defaultRenderGroup:0},t.ShowDebugColliders=function(){return e.SceneManager.EnableDebugMode===!0||null!=e.SceneManager.GlobalOptions.showDebugColliders&&e.SceneManager.GlobalOptions.showDebugColliders},t.ColliderVisibility=function(){return null!=e.SceneManager.GlobalOptions.colliderVisibility?e.SceneManager.GlobalOptions.colliderVisibility:0},t.ColliderRenderGroup=function(){return null!=e.SceneManager.GlobalOptions.colliderRenderGroup?e.SceneManager.GlobalOptions.colliderRenderGroup:0},t.CollisionWireframe=function(){return null!=e.SceneManager.GlobalOptions.collisionWireframe&&e.SceneManager.GlobalOptions.collisionWireframe},t.GetColliderMaterial=function(t){var n="Collider-Material",o=t.getMaterialByName(n);if(null==o){var i=new BABYLON.PBRMaterial(n,t);i.albedoColor=new BABYLON.Color3(0,.75,0),i.wireframe=e.Utilities.CollisionWireframe(),i.unlit=!0,o=i}return o},t.CalculateCombinedFriction=function(e,t){var n=10,o=e*t;return o<-n&&(o=-n),o>n&&(o=n),o},t.CalculateCombinedRestitution=function(e,t){return e*t},t.AddLoaderItemMarkedForDisposal=function(t){null==e.Utilities.LoaderItemsMarkedForDisposal&&(e.Utilities.LoaderItemsMarkedForDisposal=[]),e.Utilities.LoaderItemsMarkedForDisposal.push(t)},t.ResetLoaderItemsMarkedForDisposal=function(){e.Utilities.LoaderItemsMarkedForDisposal=[]},t.RemoveLoaderItemsMarkedForDisposal=function(){null!=e.Utilities.LoaderItemsMarkedForDisposal&&e.Utilities.LoaderItemsMarkedForDisposal.length>0&&e.Utilities.LoaderItemsMarkedForDisposal.forEach(function(e){try{e.dispose()}catch(t){console.warn(t)}}),e.Utilities.ResetLoaderItemsMarkedForDisposal()},t.GetDirectTargetAngle=function(t,n){return e.Utilities.TempVector3.set(0,0,0),e.Utilities.InverseTransformPointToRef(t,n,e.Utilities.TempVector3),Math.atan2(e.Utilities.TempVector3.x,e.Utilities.TempVector3.z)},t.GetSmoothTargetAngle=function(t,n){return e.Utilities.TempVector3.set(0,0,0),e.Utilities.InverseTransformPointToRef(t,n,e.Utilities.TempVector3),e.Utilities.TempVector3.x/e.Utilities.TempVector3.length()},t.CalculatCatmullRom=function(t,n,o,i,r){var a=new BABYLON.Vector3(0,0,0);return e.Utilities.CalculatCatmullRomToRef(t,n,o,i,r,a),a},t.CalculatCatmullRomToRef=function(e,t,n,o,i,r){},t.StartsWith=function(e,t){return 0===e.lastIndexOf(t,0)},t.EndsWith=function(e,t){return e.indexOf(t,e.length-t.length)!==-1},t.ReplaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},t.IsNullOrEmpty=function(e){return null==e||""===e},t.SafeStringPush=function(e,t){e.indexOf(t)===-1&&e.push(t)},t.ParseColor3=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var o=null;return o=null!=e&&null!=e.r&&null!=e.g&&null!=e.b?n===!0?new BABYLON.Color3(e.r,e.g,e.b).toLinearSpace():new BABYLON.Color3(e.r,e.g,e.b):t},t.ParseColor4=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var o=null;if(null!=e&&null!=e.r&&null!=e.g&&null!=e.b){var i=null!=e.a?e.a:1;o=n===!0?new BABYLON.Color4(e.r,e.g,e.b,i).toLinearSpace():new BABYLON.Color4(e.r,e.g,e.b,i)}else o=t;return o},t.ParseVector2=function(e,t){void 0===t&&(t=null);var n=null;return n=null!=e&&null!=e.x&&null!=e.y?new BABYLON.Vector2(e.x,e.y):t},t.ParseVector3=function(e,t){void 0===t&&(t=null);var n=null;return n=null!=e&&null!=e.x&&null!=e.y&&null!=e.z?new BABYLON.Vector3(e.x,e.y,e.z):t},t.ParseVector4=function(e,t){void 0===t&&(t=null);var n=null;return n=null!=e&&null!=e.x&&null!=e.y&&null!=e.z&&null!=e.w?new BABYLON.Vector4(e.x,e.y,e.z,e.w):t},t.ParseSound=function(t,n,o,i,r){var a=null;if(null!=t&&null!=t.filename&&""!==t.filename){var l=e.SceneManager.GetRootUrl(n),s=t.filename;a=new BABYLON.Sound(o,l+s,n,i,r)}return a},t.ParseTexture=function(t,n,o,i,r,a,l,s,u,c){var d=null;if(null!=t&&null!=t.filename&&""!==t.filename){var p=e.SceneManager.GetRootUrl(n),h=t.filename;d=new BABYLON.Texture(p+h,n,o,i,r,a,l,s,u,c)}return d},t.ParseCubemap=function(t,n){var o=null;
if(null!=t&&null!=t.info){var i=e.SceneManager.GetRootUrl(n),r=i+t.info.rooturl;o=BABYLON.CubeTexture.Parse(t.info,n,r),null!=o&&(o.gammaSpace=!1)}return o},t.ParseTextAsset=function(e,t){void 0===t&&(t=null);var n=null;return n=null!=e&&null!=e.base64&&""!==e.base64?window.atob(e.base64):t},t.ParseJsonAsset=function(t,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var i=e.Utilities.ParseTextAsset(t,n);return null!=i&&""!==i?JSON.parse(i,o):null},t.ParseTransformByID=function(t,n,o){void 0===o&&(o=null);var i=null;return i=null!=t&&null!=t.id?e.SceneManager.GetTransformNodeByID(n,t.id):o},t.ParseTransformByName=function(t,n,o){void 0===o&&(o=null);var i=null;return i=null!=t&&null!=t.id?e.SceneManager.GetTransformNode(n,t.id):o},t.ParseChildTransform=function(t,n,o){void 0===o&&(o=null);var i=null;return i=null!=n&&null!=n.name?e.SceneManager.FindChildTransformNode(t,n.name,e.SearchType.IndexOf,!1):o},t.SetAbsolutePosition=function(e,t){e.setAbsolutePosition(t)},t.GetAbsolutePosition=function(t,n,o){return void 0===n&&(n=null),void 0===o&&(o=!0),e.Utilities.TransformPoint(t,n||e.Utilities.ZeroVector,o)},t.GetAbsolutePositionToRef=function(t,n,o,i){void 0===o&&(o=null),void 0===i&&(i=!0),e.Utilities.TransformPointToRef(t,o||e.Utilities.ZeroVector,n,i)},t.SetAbsoluteRotation=function(t,n){null==t.rotationQuaternion&&(t.rotationQuaternion=t.rotation.toQuaternion()),null!=t.parent&&t.parent instanceof BABYLON.TransformNode?(e.Utilities.TempQuaternion2.set(0,0,0,1),e.Utilities.GetAbsoluteRotationToRef(t.parent,e.Utilities.TempQuaternion2),BABYLON.Quaternion.InverseToRef(e.Utilities.TempQuaternion2,e.Utilities.TempQuaternion2),e.Utilities.TempQuaternion2.multiplyInPlace(n),t.rotationQuaternion.copyFrom(e.Utilities.TempQuaternion2)):t.rotationQuaternion.copyFrom(n)},t.GetAbsoluteRotation=function(t){var n=new BABYLON.Quaternion(0,0,0,1);return e.Utilities.GetAbsoluteRotationToRef(t,n),n},t.GetAbsoluteRotationToRef=function(t,n){if(null!=t.parent&&t.parent instanceof BABYLON.TransformNode)return e.Utilities.GetAbsoluteRotationToRef(t.parent,n),null==t.rotationQuaternion&&(t.rotationQuaternion=t.rotation.toQuaternion()),void n.multiplyInPlace(t.rotationQuaternion);var o=t.scaling;if(1==o.x&&1==o.y&&1==o.z)n.copyFrom(t.absoluteRotationQuaternion);else{var i=1/o.x,r=1/o.y,a=1/o.z,l=t.getWorldMatrix()._m;e.Utilities.TempMatrix2.reset(),BABYLON.Matrix.FromValuesToRef(l[0]*i,l[1]*i,l[2]*i,0,l[4]*r,l[5]*r,l[6]*r,0,l[8]*a,l[9]*a,l[10]*a,0,0,0,0,1,e.Utilities.TempMatrix2),e.Utilities.TempQuaternion3.set(0,0,0,1),e.Utilities.TempMatrix2.decompose(void 0,e.Utilities.TempQuaternion3,void 0),n.copyFrom(e.Utilities.TempQuaternion3)}},t.TransformPoint=function(e,t,n){return void 0===n&&(n=!0),n===!0&&e.computeWorldMatrix(),BABYLON.Vector3.TransformCoordinates(t,e.getWorldMatrix())},t.InverseTransformPoint=function(t,n,o){return void 0===o&&(o=!0),o===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),BABYLON.Vector3.TransformCoordinates(n,e.Utilities.TempMatrix)},t.TransformPointToRef=function(e,t,n,o){void 0===o&&(o=!0),o===!0&&e.computeWorldMatrix(),BABYLON.Vector3.TransformCoordinatesToRef(t,e.getWorldMatrix(),n)},t.InverseTransformPointToRef=function(t,n,o,i){void 0===i&&(i=!0),i===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),BABYLON.Vector3.TransformCoordinatesToRef(n,e.Utilities.TempMatrix,o)},t.TransformDirection=function(e,t,n){return void 0===n&&(n=!0),n===!0&&e.computeWorldMatrix(),BABYLON.Vector3.TransformNormal(t,e.getWorldMatrix())},t.InverseTransformDirection=function(t,n,o){return void 0===o&&(o=!0),o===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),BABYLON.Vector3.TransformNormal(n,e.Utilities.TempMatrix)},t.TransformDirectionToRef=function(e,t,n,o){void 0===o&&(o=!0),o===!0&&e.computeWorldMatrix(),BABYLON.Vector3.TransformNormalToRef(t,e.getWorldMatrix(),n)},t.InverseTransformDirectionToRef=function(t,n,o,i){void 0===i&&(i=!0),i===!0&&t.computeWorldMatrix(),e.Utilities.TempMatrix.reset(),t.getWorldMatrix().invertToRef(e.Utilities.TempMatrix),BABYLON.Vector3.TransformNormalToRef(n,e.Utilities.TempMatrix,o)},t.RecomputeCenterPivotPoint=function(e){var t=e.getBoundingInfo().boundingSphere.center;e.setPivotMatrix(BABYLON.Matrix.Translation(-t.x,-t.y,-t.z))},t.GetDirectionVector=function(e,t){return e.getDirection(t)},t.GetDirectionVectorToRef=function(e,t,n){e.getDirectionToRef(t,n)},t.GetForwardVector=function(e){return e.getDirection(BABYLON.Vector3.Forward())},t.GetForwardVectorToRef=function(e,t){e.getDirectionToRef(BABYLON.Vector3.Forward(),t)},t.GetRightVector=function(e){return e.getDirection(BABYLON.Vector3.Right())},t.GetRightVectorToRef=function(e,t){e.getDirectionToRef(BABYLON.Vector3.Right(),t)},t.GetUpVector=function(e){return e.getDirection(BABYLON.Vector3.Up())},t.GetUpVectorToRef=function(e,t){e.getDirectionToRef(BABYLON.Vector3.Up(),t)},t.BlendFloatValue=function(e,t,n){var o=BABYLON.Scalar.Clamp(n,0,1);return o>0?BABYLON.Scalar.Lerp(e,t,o):e},t.BlendVector2Value=function(e,t,n){var o=BABYLON.Scalar.Clamp(n,0,1);if(o>0){var i=BABYLON.Vector2.Lerp(e,t,o);e.copyFrom(i)}},t.BlendVector3Value=function(e,t,n){var o=BABYLON.Scalar.Clamp(n,0,1);o>0&&BABYLON.Vector3.LerpToRef(e,t,o,e)},t.BlendQuaternionValue=function(e,t,n){var o=BABYLON.Scalar.Clamp(n,0,1);o>0&&BABYLON.Quaternion.SlerpToRef(e,t,o,e)},t.SetAnimationTargetProperty=function(e,t){null!=e&&(e.targetProperty=t,e.targetPropertyPath=e.targetProperty.split("."))},t.SampleAnimationFloat=function(t,n,o,i){void 0===o&&(o=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=0;return null!=t&&t.dataType===BABYLON.Animation.ANIMATIONTYPE_FLOAT&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:BABYLON.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationVector2=function(t,n,o,i){void 0===o&&(o=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===BABYLON.Animation.ANIMATIONTYPE_VECTOR2&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:BABYLON.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationVector3=function(t,n,o,i){void 0===o&&(o=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===BABYLON.Animation.ANIMATIONTYPE_VECTOR3&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:BABYLON.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationQuaternion=function(t,n,o,i){void 0===o&&(o=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===BABYLON.Animation.ANIMATIONTYPE_QUATERNION&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:BABYLON.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.SampleAnimationMatrix=function(t,n,o,i){void 0===o&&(o=BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),void 0===i&&(i=!1);var r=null;return null!=t&&t.dataType===BABYLON.Animation.ANIMATIONTYPE_MATRIX&&(null==t._state&&(t._state={key:0,repeatCount:0,loopMode:o,workValue:BABYLON.Matrix.Zero()}),r=e.Utilities.InterpolateAnimation(t,n,t._state,i)),r},t.CreateTweenAnimation=function(e,t,n,o,i,r){void 0===i&&(i=30),void 0===r&&(r=BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE);var a=[];a.push({frame:0,value:n}),a.push({frame:i,value:o});var l=new BABYLON.Animation(e,t,i,BABYLON.Animation.ANIMATIONTYPE_FLOAT,r);return l.setKeys(a),l},t.GetLastKeyFrameIndex=function(e){var t=0;if(null!=e){var n=e.getKeys();if(null!=n&&n.length>0){var o=n[n.length-1];null!=o&&(t=o.frame)}}return t},t.InterpolateAnimation=function(t,n,o,i){void 0===i&&(i=!1);var r=i===!0?n*e.SceneManager.AnimationTargetFps:n;return t._interpolate(r,o)},t.UpdateLoopBlendPositionSettings=function(e,t,n){var o=e;null!=o.metadata&&null!=o.metadata.unity&&null!=o.metadata.unity.settings&&(o.metadata.unity.settings.loopblendpositiony=t,o.metadata.unity.settings.loopblendpositionxz=n)},t.InitializeShaderMaterial=function(t,n,o){void 0===n&&(n=!0),void 0===o&&(o=!1);var i=t,r=e.Utilities.HasOwnProperty(i,"getShaderName")?i.getShaderName():"glsl",a=!!e.Utilities.HasOwnProperty(i,"getAlphaBlending")&&i.getAlphaBlending(),l=!!e.Utilities.HasOwnProperty(i,"getAlphaTesting")&&i.getAlphaTesting(),s=e.Utilities.HasOwnProperty(i,"getDefaultDefines")?i.getDefaultDefines():null,u=e.Utilities.HasOwnProperty(i,"getDefaultAttributes")?i.getDefaultAttributes():null,c=e.Utilities.HasOwnProperty(i,"getDefaultUniforms")?i.getDefaultUniforms():null;(null==s||s.length<=0)&&(s=["#define GAMETIME","#define DELTATIME","#define DIFFUSECOLOR","#define DIFFUSETEXTURE"]),(null==u||u.length<=0)&&(u=["position","normal","uv","uv2","color"]),(null==c||c.length<=0)&&(c=["world","worldView","worldViewProjection","view","projection","viewProjection","gameTime","deltaTime","diffuseColor","diffuseTexture","diffuseTextureInfos","diffuseTextureMatrix"]);var d={vertex:r,fragment:r},p={needAlphaBlending:a,needAlphaTesting:l,attributes:u,uniforms:c,defines:s,useClipPlane:o,samplers:[],uniformBuffers:[],externalTextures:[],samplerObjects:[],storageBuffers:[]};i._shaderPath=d,i._options=p,n===!0&&(i.fn_afterBind=i.bind,i.bind=function(e,n,o){if(void 0===o&&(o=null),null!=i.updateGlobalTime&&i.updateGlobalTime(),i.after&&i.after(),i.fn_afterBind)try{i.fn_afterBind(e,n,o)}catch(r){}var a=null!==o&&void 0!==o?o:i.getEffect(),l=t.getScene();if(l.texturesEnabled&&null!=a)for(var s in i._textures){var u=i._textures[s];null!=u&&(a.setFloat2(s+"Infos",u.coordinatesIndex,u.level),a.setMatrix(s+"Matrix",u.getTextureMatrix()))}}),i.awake&&i.awake()},t.WorldToScreenPoint=function(e,t,n){void 0===n&&(n=null);var o=null,i=null!=n?n.viewport:null!=e.activeCamera?e.activeCamera.viewport:null;return null!=i&&(o=BABYLON.Vector3.Project(t,BABYLON.Matrix.Identity(),e.getTransformMatrix(),i.toGlobal(e.getEngine().getRenderWidth(),e.getEngine().getRenderHeight()))),o},t.ScreenToWorldPoint=function(e,t){return BABYLON.Vector3.Unproject(t,e.getEngine().getRenderWidth(),e.getEngine().getRenderHeight(),BABYLON.Matrix.Identity(),e.getViewMatrix(),e.getProjectionMatrix())},t.LoadTextFile=function(e,t,n,o){return BABYLON.Tools.LoadFile(e,t,n,null,!1,o)},t.LoadTextFileAsync=function(e){return BABYLON.Tools.LoadFileAsync(e,!1)},t.GetHttpRequest=function(e,t,n,o,i,r,a){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=!1),void 0===a&&(a=null);var l=new XMLHttpRequest;return l.open("GET",e,!0),r===!0&&(l.responseType="arraybuffer"),null!=a&&l.overrideMimeType(a),null!=t&&t.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&l.setRequestHeader(e.name,e.value)}),l.onreadystatechange=function(){l.readyState===XMLHttpRequest.DONE&&null!=n&&n(l)},l.onprogress=function(e){null!=i&&i(e)},l.onerror=function(){null!=o&&o("Failed to get data from server.")},l.onabort=function(){null!=o&&o("Aborted get data from server.")},l.send(null),l},t.GetHttpRequestAsync=function(t,n,o,i,r){return void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=!1),void 0===r&&(r=null),new Promise(function(a,l){e.Utilities.GetHttpRequest(t,n,function(e){a(e)},function(e){l(e)},o,i,r)})},t.PostHttpRequest=function(e,t,n,o,i,r,a,l,s){void 0===n&&(n=null),void 0===o&&(o="application/x-www-form-urlencoded"),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=!1),void 0===s&&(s=null);var u=new XMLHttpRequest;return u.open("POST",e,!0),l===!0&&(u.responseType="arraybuffer"),null!=s&&u.overrideMimeType(s),null!=n&&n.forEach(function(e){null!=e&&null!=e.name&&""!==e.name&&u.setRequestHeader(e.name,e.value)}),u.setRequestHeader("Content-Type",o),u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&null!=i&&i(u)},u.onprogress=function(e){null!=a&&a(e)},u.onerror=function(){null!=r&&r("Failed to post data to server.")},u.onabort=function(){null!=r&&r("Aborted post data to server.")},u.send(t),u},t.PostHttpRequestAsync=function(t,n,o,i,r,a,l){return void 0===o&&(o=null),void 0===i&&(i="application/x-www-form-urlencoded"),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===l&&(l=null),new Promise(function(s,u){e.Utilities.PostHttpRequest(t,n,o,i,function(e){s(e)},function(e){u(e)},r,a,l)})},t.RemapValueToRange=function(e,t,n,o,i){return o+(e-t)*(i-o)/(n-t)},t.CloneSkeletonPrefab=function(e,t,n,o,i){void 0===i&&(i=null);var r=new BABYLON.Skeleton(n,o||n,e);r.needInitialSkinMatrix=t.needInitialSkinMatrix;for(var a=0;a<t.bones.length;a++){var l=t.bones[a],s=null,u=l.getParent();if(u){var c=t.bones.indexOf(u);s=r.bones[c]}var d=new BABYLON.Bone(l.name,r,s,l.getBaseMatrix().clone(),l.getRestPose().clone());d._index=l._index,d.metadata=l.metadata,l._linkedTransformNode&&d.linkTransformNode(l._linkedTransformNode),BABYLON.DeepCopier.DeepCopy(l.animations,d.animations)}var p=r,h=t;if(h._ranges){p._ranges={};for(var m in h._ranges){var f=h._ranges[m];f&&(p._ranges[m]=f.clone())}}return h._isDirty=!0,r},t.GetSceneTransforms=function(e){var t=null;return null!=e.transformNodes&&e.transformNodes.length>0&&e.transformNodes.forEach(function(e){null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.prefab&&e.metadata.unity.prefab===!1&&(null==t&&(t=[]),t.push(e))}),null!=e.meshes&&e.meshes.length>0&&e.meshes.forEach(function(e){null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.prefab&&e.metadata.unity.prefab===!1&&(null==t&&(t=[]),t.push(e))}),t},t.PostParseSceneComponents=function(t,n,o,i){var r=new e.MetadataParser(t);return null!=n&&n.length>0&&(n.forEach(function(e){r.parseSceneComponents(e)}),r.postProcessSceneComponents(o,i)),r},t.GetAssetContainerMesh=function(e,t){var n=null,o=t.toLowerCase();if(null==n&&null!=e.meshes&&e.meshes.length>0)for(var i=0;i<e.meshes.length;i++){var r=e.meshes[i];if(r instanceof BABYLON.Mesh&&r.name.toLowerCase()===o){n=r;break}}return n},t.GetAssetContainerNode=function(e,t){var n=null,o=t.toLowerCase();if(null==n&&null!=e.transformNodes&&e.transformNodes.length>0)for(var i=0;i<e.transformNodes.length;i++){var r=e.transformNodes[i];if(r.name.toLowerCase()===o){n=r;break}}return n},t.CloneAssetContainerItem=function(t,n,o,i,r,a){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===a&&(a=!0);var l=null,s={},u={},c={},d=null,p=null,h=[],m=[],f=n.toLowerCase(),g=null,y=function(t,n){null==g&&(g=n),s[t.uniqueId]=n.uniqueId,u[n.uniqueId]=n,o&&(n.name=o(t.name)),null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.entity&&(n.metadata=e.Utilities.CloneEntityMetadata(t.metadata));var i=null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.animator?n.metadata.unity.animator:null;if(null!=i&&""!==i&&(null==d&&(d=[]),d.indexOf(i)<0&&d.push(i),n.metadata.unity.animator=e.Utilities.CreateGuid(),c[i]=n.metadata.unity.animator),t instanceof BABYLON.AbstractMesh&&null!=t.skeleton&&(null==p&&(p=[]),p.indexOf(t.skeleton)<0&&p.push(t.skeleton)),n instanceof BABYLON.Mesh){var r=n;if(r.morphTargetManager){var a=t.morphTargetManager;r.morphTargetManager=a.clone();for(var l=0;l<a.numTargets;l++){var h=a.getTarget(l),m=r.morphTargetManager.getTarget(l);s[h.uniqueId]=m.uniqueId,u[m.uniqueId]=m}}}};if(null==l&&null!=t.transformNodes&&t.transformNodes.length>0)for(var v=0;v<t.transformNodes.length;v++){var _=t.transformNodes[v];if(_.name.toLowerCase()===f){var B=e.Utilities.InstantiateHierarchy(_,i,function(e,t){y(e,t)});if(B){l=B;break}}}if(null==l&&null!=t.meshes&&t.meshes.length>0)for(var b=function(n){var a=t.meshes[n];if(a.name.toLowerCase()===f){var c=e.Utilities.InstantiateHierarchy(a,i,function(e,n){y(e,n);var i=n;if(a.isWorldMatrixFrozen===!0&&i.freezeWorldMatrix&&i.freezeWorldMatrix(),n.material&&i.material)if(r===!0){var l=e.material;if(m.indexOf(l)===-1){var c=l.clone(o?o(l.name):"Clone of "+l.name);if(l.isFrozen===!0&&c.freeze&&c.freeze(),m.push(l),s[l.uniqueId]=c.uniqueId,u[c.uniqueId]=c,"MultiMaterial"===l.getClassName())for(var d=l,p=0,h=d.subMaterials;p<h.length;p++){var f=h[p];f&&(c=f.clone(o?o(f.name):"Clone of "+f.name),f.isFrozen===!0&&c.freeze&&c.freeze(),m.push(f),s[f.uniqueId]=c.uniqueId,u[c.uniqueId]=c)}}i.material=u[s[l.uniqueId]]}else"MultiMaterial"===i.material.getClassName()?t.scene.multiMaterials.indexOf(i.material)===-1&&t.scene.addMultiMaterial(i.material):t.scene.materials.indexOf(i.material)===-1&&t.scene.addMaterial(i.material)});if(c)return l=c,"break"}},v=0;v<t.meshes.length;v++){var C=b(v);if("break"===C)break}if(null!=p&&p.length>0&&p.forEach(function(n){for(var i=o?o(n.name):"Clone of "+n.name,r=e.Utilities.CloneSkeletonPrefab(t.scene,n,i,i,g),a=0,l=t.meshes;a<l.length;a++){var c=l[a];if(c.skeleton===n&&!c.isAnInstance){var d=u[s[c.uniqueId]];if(d.skeleton=r,h.indexOf(r)!==-1)continue;h.push(r);for(var p=0,m=r.bones;p<m.length;p++){var f=m[p];f._linkedTransformNode&&(f._linkedTransformNode=u[s[f._linkedTransformNode.uniqueId]])}}}}),a===!0){var T=null;t.animationGroups.forEach(function(e){var t=e,n=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.source&&""!==t.metadata.unity.source?t.metadata.unity.source:null;if(null!=n&&""!==n&&null!=d&&d.indexOf(n)>=0){var o=e.clone(e.name,function(e){var t=u[s[e.uniqueId]];return t||e}),i=c[n]||n;null!=t.metadata&&(o.metadata={},o.metadata.unity={},o.metadata.unity.id=t.metadata.unity.id,o.metadata.unity.clip=t.metadata.unity.clip,o.metadata.unity.source=i,o.metadata.unity.legacy=t.metadata.unity.legacy,o.metadata.unity.length=t.metadata.unity.length,o.metadata.unity.looping=t.metadata.unity.looping,o.metadata.unity.settings=t.metadata.unity.settings,o.metadata.unity.behavior=t.metadata.unity.behavior,o.metadata.unity.wrapmode=t.metadata.unity.wrapmode,o.metadata.unity.framerate=t.metadata.unity.framerate,o.metadata.unity.humanmotion=t.metadata.unity.humanmotion,o.metadata.unity.averagespeed=t.metadata.unity.averagespeed,o.metadata.unity.averageduration=t.metadata.unity.averageduration,o.metadata.unity.averageangularspeed=t.metadata.unity.averageangularspeed),null==T&&(T=[]),T.push(o)}}),null!=l&&null!=T&&e.Utilities.AssignAnimationGroupsToInstance(l,T)}return l},t.AssignAnimationGroupsToInstance=function(t,n){e.Utilities.AssignAnimationGroupsToNode(t,n);var o=t.getChildren(null,!1);null!=o&&o.length>0&&o.forEach(function(t){e.Utilities.AssignAnimationGroupsToNode(t,n)})},t.AssignAnimationGroupsToNode=function(e,t){if(null!=e&&null!=e.metadata&&e.metadata.unity){var n=e.metadata.unity;if(null!=n.components&&n.components.length>0)for(var o=0;o<n.components.length;o++){var i=n.components[o];if("UNITY.AnimationState"===i.klass){e.metadata.unity.sourceAnimationGroups=t;break}}}},t.InstantiateHierarchy=function(t,n,o){if(void 0===n&&(n=null),t instanceof BABYLON.Mesh){var i=null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.instance&&t.metadata.unity.instance===!0;return e.Utilities.InstantiateMeshHierarchy(t,n,i,o)}return e.Utilities.InstantiateNodeHierarchy(t,n,o)},t.InstantiateNodeHierarchy=function(t,n,o){void 0===n&&(n=null);var i=t.clone("Clone of "+(t.name||t.id),n,!0);i&&o&&o(t,i);for(var r=0,a=t.getChildTransformNodes(!0);r<a.length;r++){var l=a[r];e.Utilities.InstantiateHierarchy(l,i,o)}return i},t.InstantiateMeshHierarchy=function(t,n,o,i){void 0===n&&(n=null);var r=t.getTotalVertices()>0&&o===!0?t.createInstance("Instance of "+(t.name||t.id)):t.clone("Clone of "+(t.name||t.id),n||t.parent,!0);r&&(r.parent=n,r.position=t.position.clone(),r.scaling=t.scaling.clone(),t.rotationQuaternion?r.rotationQuaternion=t.rotationQuaternion.clone():r.rotation=t.rotation.clone(),i&&i(t,r));for(var a=0,l=t.getChildTransformNodes(!0);a<l.length;a++){var s=l[a];e.Utilities.InstantiateHierarchy(s,r,i)}return r},t.RetargetAnimationGroupSkeleton=function(e,t,n){void 0===n&&(n=null),null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,o){if(null!=e.target&&null!=e.target.name){var i=t.bones.filter(function(t){return t.name.toLowerCase()===e.target.name.toLowerCase()})[0];if(null!=i){var r=i.getTransformNode();null!=r&&(e.target=i.getTransformNode())}else"Armature"===e.target.name&&null!=n?e.target=n:console.warn("Failed to locate matching animation cloning target: "+e.target.name)}})},t.RetargetAnimationGroupBlendShapes=function(e,t){null!=e&&null!=t&&e.targetedAnimations.forEach(function(e,t){null!=e.target&&null!=e.target.name})},t.LinkSkeletonMeshes=function(t,n){if(null!=t&&null!=t.bones&&t.bones.length>0&&null!=n&&null!=n.bones&&n.bones.length>0)for(var o=n.bones.length,i=0;i<o;i++){var r=n.bones[i];if(null!=r){var a=e.Utilities.FindBoneByName(t,r.name);null!=a?r._linkedTransformNode=a._linkedTransformNode:console.warn("Failed to locate bone on mater rig: "+r.name)}}},t.FindBoneByName=function(e,t){var n=null;if(null!=e&&null!=e.bones)for(var o=0;o<e.bones.length;o++){var i=e.bones[o],r=i.name.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right"),a=t.toLowerCase().replace("mixamo:","").replace("left_","left").replace("right_","right");if(r===a){n=i;break}}return n},t.SwitchHandednessVector3=function(e){return new BABYLON.Vector3(e.x,e.y,(-e.z))},t.SwitchHandednessVector4=function(e){return new BABYLON.Vector4(e.x,e.y,(-e.z),(-e.w))},t.SwitchHandednessQuaternion=function(e){return new BABYLON.Quaternion(e.x,e.y,(-e.z),(-e.w))},t.ComputeBlendingSpeed=function(e,t,n){void 0===n&&(n=!1);var o=1/(e*t);return n===!0&&(o*=.5),o},t.CalculateCameraDistance=function(e,t,n){void 0===n&&(n=1);var o=1;return Math.round(e*n*t*o)},t.InstantiateClass=function(e){for(var t=e.split("."),n=window||this,o=0,i=t.length;o<i;o++)n=n[t[o]];return"function"==typeof n?n:null},t.GetSimpleClassName=function(e){if(e&&e.constructor&&e.constructor.toString){var t=e.constructor.toString().match(/function\s*(\w+)/);if(t&&2==t.length)return t[1]}},t.DisposeEntity=function(t){if(null!=t){if(null!=t.metadata&&t.metadata.unity){var n=t.metadata.unity;null!=n.components&&n.components.length>0&&n.components.forEach(function(t){if(null!=t.instance){try{e.SceneManager.DestroyScriptComponent(t.instance)}catch(n){}t.instance=null}}),delete t.metadata.unity}if(null!=t.metadata&&t.metadata.mixer&&delete t.metadata.mixer,null!=t.metadata&&null!=t.metadata.clone&&delete t.metadata.clone,null!=t.physicsImpostor){var o=t.physicsImpostor;null!=o.onCollideEvent&&(o.onCollideEvent=null),null!=o.tmpCollisionObjects&&delete o.tmpCollisionObjects,null!=t.physicsImpostor.physicsBody&&(null!=t.physicsImpostor.physicsBody.entity&&delete t.physicsImpostor.physicsBody.entity,null!=t.physicsImpostor.physicsBody.triangleMapInfo&&delete t.physicsImpostor.physicsBody.triangleMapInfo),t.physicsImpostor.dispose(),t.physicsImpostor=null}null!=t.skeleton&&(null!=t.skeleton._sockets&&delete t.skeleton._sockets,null!=t.skeleton.bones&&t.skeleton.bones.length>0&&t.skeleton.bones.forEach(function(e){null!=e&&null!=e.metadata&&(e.metadata=null)})),null!=t.cameraRig&&(t.cameraRig.dispose&&t.cameraRig.dispose(),delete t.cameraRig),null!=t.lightRig&&(t.lightRig.dispose&&t.lightRig.dispose(),delete t.lightRig),null!=t.shadowBox&&(t.shadowBox.dispose&&t.shadowBox.dispose(),delete t.shadowBox),null!=t._debugCollider&&(t._debugCollider.dispose&&t._debugCollider.dispose(),delete t._debugCollider),null!=t._meshCollider&&(t._meshCollider=null),null!=t._colliderType&&delete t._colliderType,null!=t._skinnedMesh&&delete t._skinnedMesh}},t.SearchTransformNodes=function(t,n,o){void 0===o&&(o=e.SearchType.ExactMatch);var i=null,r=null!=o?o:e.SearchType.ExactMatch;if(null!=n&&n.length>0)for(var a=0;a<n.length;a++){var l=n[a];if(r===e.SearchType.ExactMatch){if(l.name===t){i=l;break}}else if(r===e.SearchType.StartsWith){if(e.Utilities.StartsWith(l.name,t)){i=l;break}}else if(r===e.SearchType.EndsWith){if(e.Utilities.EndsWith(l.name,t)){i=l;break}}else if(r===e.SearchType.IndexOf){if(l.name.indexOf(t)>=0){i=l;break}}else if(l.name===t){i=l;break}}return i},t.SearchTransformNodeForTags=function(e,t){var n=null;if(null!=t&&t.length>0)for(var o=0;o<t.length;o++){var i=t[o];if(i instanceof BABYLON.TransformNode&&BABYLON.Tags.MatchesQuery(i,e)){n=i;break}}return n},t.SearchAllTransformNodesForTags=function(e,t){var n=null;if(null!=t&&t.length>0)for(var o=0;o<t.length;o++){var i=t[o];i instanceof BABYLON.TransformNode&&BABYLON.Tags.MatchesQuery(i,e)&&(null==n&&(n=[]),n.push(i))}return n},t.SearchTransformNodeForScript=function(t,n){var o=null;if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var r=n[i];if(r instanceof BABYLON.TransformNode){var a=e.SceneManager.FindScriptComponent(r,t);if(null!=a){o=r;break}}}return o},t.SearchAllTransformNodesForScript=function(t,n){var o=null;if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var r=n[i];if(r instanceof BABYLON.TransformNode){var a=e.SceneManager.FindScriptComponent(r,t);null!=a&&(null==o&&(o=[]),o.push(r))}}return o},t.CreateGuid=function(t){void 0===t&&(t=null);var n=BABYLON.Tools.RandomId();return e.Utilities.IsNullOrEmpty(t)||(n+="-"+t),n},t.ValidateTransformGuid=function(e){if(null!=e&&null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.guid&&""!==e.metadata.unity.guid){var t=e.metadata.unity.guid;e.id!==t&&(e.id=t),delete e.metadata.unity.guid}},t.AddShadowCastersToLight=function(e,t,n){void 0===n&&(n=!1);var o=e.getShadowGenerator();if(null!=o){var i=o.getShadowMap();if(null!=i)for(var r=0;r<t.length;r++){var a=t[r];if(a instanceof BABYLON.AbstractMesh&&(null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0&&e.includedOnlyMeshes.indexOf(a)<0&&e.includedOnlyMeshes.push(a),null==i.renderList&&(i.renderList=[]),i.renderList.indexOf(a)<0&&i.renderList.push(a)),n===!0){var l=a.getChildMeshes();null!=l&&l.length>0&&l.forEach(function(t){null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0&&e.includedOnlyMeshes.indexOf(t)<0&&e.includedOnlyMeshes.push(t),null==i.renderList&&(i.renderList=[]),i.renderList.indexOf(t)<0&&i.renderList.push(t)})}}}},t.RegisterInstancedMeshBuffers=function(e){var t=null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.buffers?e.metadata.unity.buffers:null;null!=t&&(null!=t.floats&&t.floats.length>0&&t.floats.forEach(function(t){null!=t.kind&&""!==t.kind&&null!=t.value&&(e.registerInstancedBuffer(t.kind,1),e.instancedBuffers[t.kind]=t.value)}),null!=t.colors&&t.colors.length>0&&t.colors.forEach(function(t){null!=t.kind&&""!==t.kind&&null!=t.value&&(e.registerInstancedBuffer(t.kind,4),e.instancedBuffers[t.kind]=new BABYLON.Color4(t.value.r||0,t.value.g||0,t.value.b||0,t.value.a||1).toLinearSpace())}),null!=t.vector2&&t.vector2.length>0&&t.vector2.forEach(function(t){null!=t.kind&&""!==t.kind&&null!=t.value&&(e.registerInstancedBuffer(t.kind,2),e.instancedBuffers[t.kind]=new BABYLON.Vector2(t.value.x||0,t.value.y||0))}),null!=t.vector3&&t.vector3.length>0&&t.vector3.forEach(function(t){null!=t.kind&&""!==t.kind&&null!=t.value&&(e.registerInstancedBuffer(t.kind,3),e.instancedBuffers[t.kind]=new BABYLON.Vector3(t.value.x||0,t.value.y||0,t.value.z||0))}),null!=t.vector4&&t.vector4.length>0&&t.vector4.forEach(function(t){null!=t.kind&&""!==t.kind&&null!=t.value&&(e.registerInstancedBuffer(t.kind,4),e.instancedBuffers[t.kind]=new BABYLON.Vector4(t.value.x||0,t.value.y||0,t.value.z||0,t.value.w||0))}))},t.CloneValue=function(e,t){return e?e instanceof BABYLON.Mesh?null:e instanceof BABYLON.SubMesh?e.clone(t):e.clone?e.clone():e:null},t.CloneEntityMetadata=function(t){var n=null;if(null!=t){var o=null;if(null!=t.unity){var i=null!=t.unity.instance&&t.unity.instance,r=null==t.unity.visible||t.unity.visible,a=null!=t.unity.visibility?t.unity.visibility:1,l=null!=t.unity.billboard?t.unity.billboard:0,s=null!=t.unity.tags?t.unity.tags:"Untagged Layer0",u=null!=t.unity.skin&&t.unity.skin,c=null!=t.unity.bone?t.unity.bone:null,d=null!=t.unity.rootbone&&t.unity.rootbone,p=null!=t.unity.rootpos?t.unity.rootpos:null,h=null!=t.unity.rootrot?t.unity.rootrot:null,m=null!=t.unity.group?t.unity.group:"Untagged",f=null!=t.unity.layer?t.unity.layer:0,g=null!=t.unity.layername?t.unity.layername:"Default",y=null!=t.unity.navigation?t.unity.navigation:null,v=null!=t.unity.lightmapped&&t.unity.lightmapped,_=null!=t.unity.lightmapuvs?t.unity.lightmapuvs:null,B=null!=t.unity.animator?t.unity.animator:null,b=null,C=null,T=null,I=null;t.unity.physics&&(b={},e.Utilities.DeepCopyProperties(t.unity.physics,b)),t.unity.renderer&&(C={},e.Utilities.DeepCopyProperties(t.unity.renderer,C)),t.unity.collision&&(T={},e.Utilities.DeepCopyProperties(t.unity.collision,T)),t.unity.properties&&(I={},e.Utilities.DeepCopyProperties(t.unity.properties,I));var S=null;null!=t.unity.wheels&&t.unity.wheels.length>0&&(S=[],t.unity.wheels.forEach(function(t){if(null!=t){var n={};e.Utilities.DeepCopyProperties(t,n),S.push(n)}}));var A=null;null!=t.unity.components&&t.unity.components.length>0&&(A=[],t.unity.components.forEach(function(t){if(null!=t){var n=e.Utilities.FastJsonCopy(t);n.instance=null,A.push(n)}})),o={},o.parsed=!1,o.prefab=!1,o.buffers=null,o.lods=null,o.coverages=null,o.distances=null,o.handlers=null,o.instance=i,o.visible=r,o.visibility=a,o.billboard=l,o.tags=s,o.skin=u,o.bone=c,o.rootbone=d,o.rootpos=p,o.rootrot=h,o.group=m,o.layer=f,o.layername=g,o.navigation=y,o.lightmapped=v,o.lightmapuvs=_,o.animator=B,o.renderer=C,o.physics=b,o.wheels=S,o.collision=T,o.properties=I,o.components=A}null!=o&&(n={unity:o})}return n},t.FastJsonCopy=function(t){if(!t)return t;if(Array.isArray(t)){for(var n=[],o=t.length,i=0;i<o;i++)n.push(e.Utilities.FastJsonCopy(t[i]));return n}if("object"==typeof t){for(var r=Object.keys(t),a={},i=r.length-1;i>-1;i--){var l=r[i];a[l]=e.Utilities.FastJsonCopy(t[l])}return a}return t},t.DeepCopyProperties=function(t,n,o,i){for(var r in t)if(("_"!==r[0]||i&&i.indexOf(r)!==-1)&&(!o||o.indexOf(r)===-1)){var a=t[r],l=typeof a;if("function"!==l)if("object"===l)if(a instanceof Array){if(n[r]=[],a.length>0)if("object"==typeof a[0])for(var s=0;s<a.length;s++){var u=e.Utilities.CloneValue(a[s],n);n[r].indexOf(u)===-1&&n[r].push(u)}else n[r]=a.slice(0)}else n[r]=e.Utilities.CloneValue(a,n);else n[r]=a}},t.ValidateTransformMetadata=function(t){null==t.metadata&&(t.metadata={}),null==t.metadata.unity&&(t.metadata.unity={});var n=t.metadata.unity;e.Utilities.HasOwnProperty(n,"entity")||(t.metadata.unity.entity=!0),e.Utilities.HasOwnProperty(n,"parsed")||(t.metadata.unity.parsed=!1),e.Utilities.HasOwnProperty(n,"prefab")||(t.metadata.unity.prefab=!1),e.Utilities.HasOwnProperty(n,"instance")||(t.metadata.unity.instance=!1),e.Utilities.HasOwnProperty(n,"buffers")||(t.metadata.unity.buffers=null),e.Utilities.HasOwnProperty(n,"visible")||(t.metadata.unity.visible=!0),e.Utilities.HasOwnProperty(n,"visibility")||(t.metadata.unity.visibility=1),e.Utilities.HasOwnProperty(n,"billboard")||(t.metadata.unity.billboard=0),e.Utilities.HasOwnProperty(n,"tags")||(t.metadata.unity.tags="Untagged Layer0"),e.Utilities.HasOwnProperty(n,"skin")||(t.metadata.unity.skin=!1),e.Utilities.HasOwnProperty(n,"bone")||(t.metadata.unity.bone=null),e.Utilities.HasOwnProperty(n,"rootbone")||(t.metadata.unity.rootbone=!1),e.Utilities.HasOwnProperty(n,"rootpos")||(t.metadata.unity.rootpos=null),e.Utilities.HasOwnProperty(n,"rootrot")||(t.metadata.unity.rootrot=null),e.Utilities.HasOwnProperty(n,"group")||(t.metadata.unity.group="Untagged"),e.Utilities.HasOwnProperty(n,"layer")||(t.metadata.unity.layer=0),e.Utilities.HasOwnProperty(n,"layername")||(t.metadata.unity.layername="Default"),e.Utilities.HasOwnProperty(n,"navigation")||(t.metadata.unity.navigation=null),e.Utilities.HasOwnProperty(n,"lightmapped")||(t.metadata.unity.lightmapped=!1),e.Utilities.HasOwnProperty(n,"lightmapuvs")||(t.metadata.unity.lightmapuvs=!1),e.Utilities.HasOwnProperty(n,"animator")||(t.metadata.unity.animator=null),e.Utilities.HasOwnProperty(n,"lods")||(t.metadata.unity.lods=null),e.Utilities.HasOwnProperty(n,"coverages")||(t.metadata.unity.coverages=null),e.Utilities.HasOwnProperty(n,"distances")||(t.metadata.unity.distances=null),
e.Utilities.HasOwnProperty(n,"handlers")||(t.metadata.unity.handlers=null),e.Utilities.HasOwnProperty(n,"physics")||(t.metadata.unity.physics=null),e.Utilities.HasOwnProperty(n,"wheels")||(t.metadata.unity.wheels=null),e.Utilities.HasOwnProperty(n,"renderer")||(t.metadata.unity.renderer=null),e.Utilities.HasOwnProperty(n,"collision")||(t.metadata.unity.collision=null),e.Utilities.HasOwnProperty(n,"properties")||(t.metadata.unity.properties=null),e.Utilities.HasOwnProperty(n,"components")||(t.metadata.unity.components=null)},t.UpVector=BABYLON.Vector3.Up(),t.AuxVector=BABYLON.Vector3.Zero(),t.ZeroVector=BABYLON.Vector3.Zero(),t.TempMatrix=BABYLON.Matrix.Zero(),t.TempMatrix2=BABYLON.Matrix.Zero(),t.TempVector2=BABYLON.Vector2.Zero(),t.TempVector3=BABYLON.Vector3.Zero(),t.TempQuaternion=BABYLON.Quaternion.Zero(),t.TempQuaternion2=BABYLON.Quaternion.Zero(),t.TempQuaternion3=BABYLON.Quaternion.Zero(),t.LoadingState=-1,t.OnPreloaderProgress=null,t.OnPreloaderComplete=null,t.LoaderItemsMarkedForDisposal=[],t}();e.Utilities=M}(UNITY||(UNITY={}));var UTIL=UNITY.Utilities;BABYLON.Bone.prototype.linkTransformNode=function(e){e._linkedBone=this,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++};var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),UNITY;!function(e){var t=function(){function e(){this._defines={},this._defines={}}return e.prototype.getDefines=function(){return this._defines},e.prototype.defineBoolean=function(e){this._defines[e]=!0},e.prototype.defineNumeric=function(e,t){this._defines[e]=t},e.ShaderIndexer=0,e}();e.UniversalShaderDefines=t;var n=function(){function e(){}return e}();e.UniversalAlbedoChunks=n;var o=function(t){function n(n,o,i){void 0===i&&(i=!1);var r=t.call(this,n,o)||this;r.universalMaterial=!0,r.locals=null,r.terrainInfo=null,r._defines=null,r._uniforms=[],r._samplers=[],r._attributes=[],r._textures={},r._vectors4={},r._floats={},r._enableTime=!1,r._timeInitialized=!1,r.dumpEffect=!1,r.locals=new e.UniversalShaderDefines,r._defines=null,r._createdShaderName=null,r.enableShaderChunks=!1,r.materialShaderChunks=new e.UniversalAlbedoChunks,r.customShaderNameResolve=r._buildCustomShader,r.customShaderChunkResolve();var a=r;return a.awake&&a.awake(),r}return __extends(n,t),n.prototype.updateShaderChunks=function(){},n.prototype.getShaderName=function(){return"pbr"},n.prototype.getShaderChunk=function(){return null},n.prototype.getShaderDefines=function(){return this._defines},n.prototype.getCustomAttributes=function(){return null},Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this._timeInitialized===!1?(this._timeInitialized=!0,this.setFloat("gameTime",e.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",e.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},n.prototype.getTexture=function(e){return this._textures[e]},n.prototype.getVector4=function(e){return this._vectors4[e]},n.prototype.getFloat=function(e){return this._floats[e]},n.prototype.setTexture=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkSampler(e),this._textures[e]=t,this},n.prototype.setVector4=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkUniform(e),this._vectors4[e]=t,this},n.prototype.setFloat=function(e,t,n){return void 0===n&&(n=!1),n===!0&&this.checkUniform(e),this._floats[e]=t,this},n.prototype.addAttribute=function(e){this._attributes.indexOf(e)===-1&&this._attributes.push(e)},n.prototype.checkUniform=function(e){this._uniforms.indexOf(e)===-1&&(this._uniforms.push(e),this.locals.defineBoolean(e.toUpperCase()))},n.prototype.checkSampler=function(e){this._samplers.indexOf(e)===-1&&(this._samplers.push(e),this.locals.defineBoolean(e.toUpperCase()),this.checkUniform(e+"Infos"),this.checkUniform(e+"Matrix"))},n.prototype.getAnimatables=function(){var e=t.prototype.getAnimatables.call(this);for(var n in this._textures){var o=this._textures[n];o&&o.animations&&o.animations.length>0&&e.push(o)}return e},n.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);for(var n in this._textures){var o=this._textures[n];o&&e.push(o)}return e},n.prototype.hasTexture=function(e){if(t.prototype.hasTexture.call(this,e))return!0;var n=!1;for(var o in this._textures){var i=this._textures[o];if(i===i){n=!0;break}}return n},n.prototype.dispose=function(e,n){if(n)for(var o in this._textures){var i=this._textures[o];i&&i.dispose(),this._textures[o]=null}this._textures={},t.prototype.dispose.call(this,e,n)},n.prototype.clone=function(t){var n,o=this,i=BABYLON.SerializationHelper.Clone(function(){return new e.UniversalAlbedoMaterial(t,o.getScene())},this);i._textures={};for(n in this._textures){var r=this._textures[n];r&&i.setTexture(n,r.clone(),!0)}i._vectors4={};for(n in this._vectors4)i.setVector4(n,this._vectors4[n].clone(),!0);i._floats={};for(n in this._floats)i.setFloat(n,this._floats[n],!0);return i},n.prototype.serialize=function(){var e,t=BABYLON.SerializationHelper.Serialize(this);t.customType="UNITY.UniversalAlbedoMaterial",t.textures={};for(e in this._textures){var n=this._textures[e];n&&(t.textures[e]=n.serialize())}t.vectors4={};for(e in this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();t.floats={};for(e in this._floats)t.floats[e]=this._floats[e];return t},n.Parse=function(t,n,o){var i,r=BABYLON.SerializationHelper.Parse(function(){return new e.UniversalAlbedoMaterial(t.name,n)},t,n,o);for(i in t.textures){var a=t.textures[i];a&&r.setTexture(i,BABYLON.Texture.Parse(a,n,o),!0)}for(i in t.vectors4)r.setVector4(i,BABYLON.Vector4.FromArray(t.vectors4[i]),!0);for(i in t.floats)r.setFloat(i,t.floats[i],!0);return r},n.prototype.customShaderChunkResolve=function(){var t=this.getShaderChunk();if(null!=t&&""!==t){var n=t+"ShaderChunks";if(null!=BABYLON.Effect.ShadersStore[n]){var o=BABYLON.Effect.ShadersStore[n],i=e.Utilities.HasOwnProperty(o,"VertexBegin")?o.VertexBegin:null;null!=i&&""!==i&&(this.materialShaderChunks.Vertex_Begin=i);var r=e.Utilities.HasOwnProperty(o,"VertexDefinitions")?o.VertexDefinitions:null;null!=r&&""!==r&&(this.materialShaderChunks.Vertex_Definitions=r);var a=e.Utilities.HasOwnProperty(o,"VertexMainBegin")?o.VertexMainBegin:null;null!=a&&""!==a&&(this.materialShaderChunks.Vertex_MainBegin=a);var l=e.Utilities.HasOwnProperty(o,"VertexUpdatePosition")?o.VertexUpdatePosition:null;null!=l&&""!==l&&(this.materialShaderChunks.Vertex_Before_PositionUpdated=l.replace("result","positionUpdated"));var s=e.Utilities.HasOwnProperty(o,"VertexUpdateNormal")?o.VertexUpdateNormal:null;null!=s&&""!==s&&(this.materialShaderChunks.Vertex_Before_NormalUpdated=s.replace("result","normalUpdated"));var u=e.Utilities.HasOwnProperty(o,"VertexWorldPos")?o.VertexWorldPos:null;null!=u&&""!==u&&(this.materialShaderChunks.Vertex_After_WorldPosComputed=u);var c=e.Utilities.HasOwnProperty(o,"VertexMainEnd")?o.VertexMainEnd:null;null!=c&&""!==c&&(this.materialShaderChunks.Vertex_MainEnd=c);var d=e.Utilities.HasOwnProperty(o,"FragmentBegin")?o.FragmentBegin:null;null!=d&&""!==d&&(this.materialShaderChunks.Fragment_Begin=d);var p=e.Utilities.HasOwnProperty(o,"FragmentDefinitions")?o.FragmentDefinitions:null;null!=p&&""!==p&&(this.materialShaderChunks.Fragment_Definitions=p);var h=e.Utilities.HasOwnProperty(o,"FragmentMainBegin")?o.FragmentMainBegin:null;null!=h&&""!==h&&(this.materialShaderChunks.Fragment_MainBegin=h);var m=e.Utilities.HasOwnProperty(o,"FragmentUpdateAlbedo")?o.FragmentUpdateAlbedo:null;null!=m&&""!==m&&(this.materialShaderChunks.Fragment_Custom_Albedo=m.replace("result","surfaceAlbedo"));var f=e.Utilities.HasOwnProperty(o,"FragmentUpdateAlpha")?o.FragmentUpdateAlpha:null;null!=f&&""!==f&&(this.materialShaderChunks.Fragment_Custom_Alpha=f.replace("result","alpha"));var g=e.Utilities.HasOwnProperty(o,"FragmentMetallicRoughness")?o.FragmentMetallicRoughness:null;null!=g&&""!==g&&(this.materialShaderChunks.Fragment_MetallicRoughness=g);var y=e.Utilities.HasOwnProperty(o,"FragmentMicroSurface")?o.FragmentMicroSurface:null;null!=y&&""!==y&&(this.materialShaderChunks.Fragment_MicroSurface=y);var v=e.Utilities.HasOwnProperty(o,"FragmentBeforeLights")?o.FragmentBeforeLights:null;null!=v&&""!==v&&(this.materialShaderChunks.Fragment_Before_Lights=v);var _=e.Utilities.HasOwnProperty(o,"FragmentBeforeFog")?o.FragmentBeforeFog:null;null!=_&&""!==_&&(this.materialShaderChunks.Fragment_Before_Fog=_);var B=e.Utilities.HasOwnProperty(o,"FragmentBeforeFragColor")?o.FragmentBeforeFragColor:null;null!=B&&""!==B&&(this.materialShaderChunks.Fragment_Before_FragColor=B.replace("result","color"))}else BABYLON.Tools.Warn("Failed To Locate Shader Chunk Base: "+n)}},n.prototype._buildCustomShader=function(e,t,n,o,i,r,a){var l=this;null==a||null!=a.processFinalCode&&void 0!=a.processFinalCode||(a.processFinalCode=function(e,t){if("vertex"===e)return t;var n=new BABYLON.ShaderCodeInliner(t);return n.inlineToken="#define pbr_inline",n.processCode(),n.code}),this._defines=i;var s=this.locals.getDefines();if(null!=s&&null!=this._defines){var u=Object.keys(s);if(null!=u&&u.length>0){for(var c=this._defines,d=0,p=u;d<p.length;d++){var h=p[d];c[h]=s[h]}this._defines.rebuild()}}var m=0;if(null!=this._uniforms&&this._uniforms.length>0)for(m=0;m<this._uniforms.length;m++){var f=this._uniforms[m];t.indexOf(f)===-1&&t.push(f)}if(m=0,null!=this._samplers&&this._samplers.length>0)for(m=0;m<this._samplers.length;m++){var g=this._samplers[m];o.indexOf(g)===-1&&o.push(g)}if(m=0,null!=this._attributes&&this._attributes.length>0)for(m=0;m<this._attributes.length;m++){var y=this._attributes[m];r.indexOf(y)===-1&&r.push(y)}m=0;var v=this.getCustomAttributes();if(null!=v&&v.length>0)for(m=0;m<v.length;m++){var _=v[m];r.indexOf(_)===-1&&r.push(_)}if(null!=this._createdShaderName&&""!==this._createdShaderName)return this._createdShaderName;var B=this.getShaderName();null!=B&&""!==B||(B=e),null!=B&&""!==B||(B="pbr");var b=this._afterBind.bind(this);return this._afterBind=function(e,t){if(t){l._attachAfterBind(e,t);try{b(e,t)}catch(t){}}},this._createdShaderName=this.enableShaderChunks===!0?this._createShaderChunks(B):B,this._createdShaderName},n.prototype._createShaderChunks=function(t){var n=this.getShaderChunk();null!=n&&""!==n||(n=t),e.UniversalShaderDefines.ShaderIndexer++;var o=(n+"Custom"+e.UniversalShaderDefines.ShaderIndexer).trim(),i=BABYLON.Effect.ShadersStore[t+"VertexShader"],r=BABYLON.Effect.ShadersStore[t+"PixelShader"];r=r.replace(/#include<pbrBlockAlbedoOpacity>/g,BABYLON.Effect.IncludesShadersStore.pbrBlockAlbedoOpacity),r=r.replace(/#include<pbrBlockReflectivity>/g,BABYLON.Effect.IncludesShadersStore.pbrBlockReflectivity),r=r.replace(/#include<pbrBlockFinalColorComposition>/g,BABYLON.Effect.IncludesShadersStore.pbrBlockFinalColorComposition),this.updateShaderChunks();var a=o+"VertexShader";BABYLON.Effect.ShadersStore[a]=i.replace("#define CUSTOM_VERTEX_BEGIN",this.materialShaderChunks.Vertex_Begin?this.materialShaderChunks.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions:"").replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.materialShaderChunks.Vertex_MainBegin?this.materialShaderChunks.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.materialShaderChunks.Vertex_Before_PositionUpdated?this.materialShaderChunks.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.materialShaderChunks.Vertex_Before_NormalUpdated?this.materialShaderChunks.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd:""),this.materialShaderChunks.Vertex_After_WorldPosComputed&&(BABYLON.Effect.ShadersStore[a]=BABYLON.Effect.ShadersStore[a].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS",this.materialShaderChunks.Vertex_After_WorldPosComputed));var l=o+"PixelShader";return BABYLON.Effect.ShadersStore[l]=r.replace("#define CUSTOM_FRAGMENT_BEGIN",this.materialShaderChunks.Fragment_Begin?this.materialShaderChunks.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.materialShaderChunks.Fragment_MainBegin?this.materialShaderChunks.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.materialShaderChunks.Fragment_Custom_Albedo?this.materialShaderChunks.Fragment_Custom_Albedo:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.materialShaderChunks.Fragment_Custom_Alpha?this.materialShaderChunks.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.materialShaderChunks.Fragment_MetallicRoughness?this.materialShaderChunks.Fragment_MetallicRoughness:"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.materialShaderChunks.Fragment_MicroSurface?this.materialShaderChunks.Fragment_MicroSurface:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.materialShaderChunks.Fragment_Before_Lights?this.materialShaderChunks.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog?this.materialShaderChunks.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.materialShaderChunks.Fragment_Before_FragColor?this.materialShaderChunks.Fragment_Before_FragColor:""),this.materialShaderChunks.Fragment_Before_Fog&&(BABYLON.Effect.ShadersStore[l]=BABYLON.Effect.ShadersStore[l].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog)),o},n.prototype._attachAfterBind=function(e,t){this.updateGlobalTime();var n=this;n.after&&n.after();var o,i=this.getScene();if(i.texturesEnabled)for(o in this._textures){var r=this._textures[o];null!=r&&r.isReady&&r.isReady()&&(null==r.isChecked&&(r.isChecked=!0,("detailsSampler"===o||"normalsSampler"===o||o.indexOf("(Atlas)")>=0)&&r.updateSamplingMode(8)),t.setTexture(o,r),t.setFloat2(o+"Infos",r.coordinatesIndex,r.level),t.setMatrix(o+"Matrix",r.getTextureMatrix()))}for(o in this._vectors4)t.setVector4(o,this._vectors4[o]);for(o in this._floats)t.setFloat(o,this._floats[o])},n}(BABYLON.PBRMaterial);e.UniversalAlbedoMaterial=o,BABYLON.RegisterClass("UNITY.UniversalAlbedoMaterial",o);var i=function(t){function n(e,n,o){var i=t.call(this,e,n,null,o)||this;return i._enableTime=!1,i}return __extends(n,t),Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this.setFloat("gameTime",e.SceneManager.GetGameTime()),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene())))},n}(BABYLON.ShaderMaterial);e.UniversalShaderMaterial=i,BABYLON.RegisterClass("UNITY.UniversalShaderMaterial",i);var r=function(t){function n(e,n,o){var i=t.call(this,e,n,o)||this;i._textures={},i._vectors4={},i._floats={},i._enableTime=!1,i._timeInitialized=!1;var r=i;return r.awake&&r.awake(),i.onBindObservable.add(function(){i.updateGlobalTime(),r.after&&r.after()}),i}return __extends(n,t),n.prototype.compile=function(){},Object.defineProperty(n.prototype,"enableTime",{get:function(){return this._enableTime},set:function(e){this._enableTime=e,this.updateGlobalTime()},enumerable:!1,configurable:!0}),n.prototype.updateGlobalTime=function(){this._enableTime===!0&&(this._timeInitialized===!1?(this._timeInitialized=!0,this.setFloat("gameTime",e.SceneManager.GetGameTime(),!0),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!0)):(this.setFloat("gameTime",e.SceneManager.GetGameTime(),!1),this.setFloat("deltaTime",e.SceneManager.GetDeltaSeconds(this.getScene()),!1)))},n.prototype.getTexture=function(e){return this._textures[e]},n.prototype.getVector4=function(e){return this._vectors4[e]},n.prototype.getFloat=function(e){return this._floats[e]},n.prototype.setTexture=function(e,t,n){return void 0===n&&(n=!1),this._textures[e]=t,this},n.prototype.setVector4=function(e,t,n){return void 0===n&&(n=!1),this._vectors4[e]=t,this},n.prototype.setFloat=function(e,t,n){return void 0===n&&(n=!1),this._floats[e]=t,this},n.prototype.dispose=function(e,n){if(n)for(var o in this._textures){var i=this._textures[o];i&&i.dispose(),this._textures[o]=null}this._textures={},t.prototype.dispose.call(this,e,n)},n.prototype.clone=function(t){var n,o=this,i=BABYLON.SerializationHelper.Clone(function(){return new e.UniversalNodeMaterial(t,o.getScene())},this);i._textures={};for(n in this._textures){var r=this._textures[n];r&&i.setTexture(n,r.clone(),!0)}i._vectors4={};for(n in this._vectors4)i.setVector4(n,this._vectors4[n].clone(),!0);i._floats={};for(n in this._floats)i.setFloat(n,this._floats[n],!0);return i},n.prototype.serialize=function(){var e,t=BABYLON.SerializationHelper.Serialize(this);t.customType="UNITY.UniversalNodeMaterial",t.textures={};for(e in this._textures){var n=this._textures[e];n&&(t.textures[e]=n.serialize())}t.vectors4={};for(e in this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();t.floats={};for(e in this._floats)t.floats[e]=this._floats[e];return t},n.Parse=function(t,n,o){var i,r=BABYLON.SerializationHelper.Parse(function(){return new e.UniversalNodeMaterial(t.name,n)},t,n,o);for(i in t.textures){var a=t.textures[i];a&&r.setTexture(i,BABYLON.Texture.Parse(a,n,o),!0)}for(i in t.vectors4)r.setVector4(i,BABYLON.Vector4.FromArray(t.vectors4[i]),!0);for(i in t.floats)r.setFloat(i,t.floats[i],!0);return r},n}(BABYLON.NodeMaterial);e.UniversalNodeMaterial=r,BABYLON.RegisterClass("UNITY.UniversalNodeMaterial",r);var a=function(t){function n(e,n){var o=t.call(this,e,n)||this;o.enableShaderChunks=!0;var i=o;return i.awake&&i.awake(),o.onBindObservable.add(function(){i.after&&i.after()}),o}return __extends(n,t),n.prototype.getShaderName=function(){return"pbr"},n.prototype.getShaderChunk=function(){return null},n.prototype.updateShaderChunks=function(){var t="surfaceAlbedo",n="splatmapSampler",o="detailsSampler",i="normalsSampler",r=e.SceneManager.TerrainColorCorrection;null!=this.materialShaderChunks.Vertex_Definitions&&""!==this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions()+this.materialShaderChunks.Vertex_Definitions:this.materialShaderChunks.Vertex_Definitions=this.formatTerrainVertexDefintions(),null!=this.materialShaderChunks.Vertex_MainEnd&&""!==this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd()+this.materialShaderChunks.Vertex_MainEnd:this.materialShaderChunks.Vertex_MainEnd=this.formatTerrainVertexMainEnd(),null!=this.materialShaderChunks.Fragment_Definitions&&""!==this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(n,o,i)+this.materialShaderChunks.Fragment_Definitions:this.materialShaderChunks.Fragment_Definitions=this.formatTerrainFragmentDefintions(n,o,i),null!=this.materialShaderChunks.Fragment_Custom_Albedo&&""!==this.materialShaderChunks.Fragment_Custom_Albedo?this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,t,n,o,i,r)+this.materialShaderChunks.Fragment_Custom_Albedo:this.materialShaderChunks.Fragment_Custom_Albedo=this.formatTerrainFragmentUpdateColor(this.terrainInfo,t,n,o,i,r)},n.prototype.formatTerrainVertexDefintions=function(){return"\r\n#define TERRAIN_VERTEX_DEFINITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\n\r\n"},n.prototype.formatTerrainVertexMainEnd=function(){return"\r\n#define TERRAIN_VERTEX_MAIN_END\r\n\r\n#ifdef UV1\r\nvSplatmapUV = uv;\r\n#endif\r\n\r\n"},n.prototype.formatTerrainFragmentDefintions=function(e,t,n){return"\r\n#define TERRAIN_FRAGMENT_DEFNITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\nuniform sampler2D "+e+";\r\nuniform sampler2D "+t+";\r\nuniform sampler2D "+n+";\r\n\r\nfloat calculateMipmapLevel(const in vec2 uvs, const in vec2 size)\r\n{\r\n    vec2 dx = dFdx(uvs * size.x);\r\n    vec2 dy = dFdy(uvs * size.y);\r\n    float d = max(dot(dx, dx), dot(dy, dy));\r\n    return 0.4 * log2(d);\r\n}\r\n\r\nvec4 sampleTextureAtlas2D(const in sampler2D atlas, const in float gamma, const in vec2 tile, const in vec4 rect, in vec2 uvs, in float lod)\r\n{\r\n    if (lod < 0.0) lod = clamp(calculateMipmapLevel(uvs, vec2(tile.x, tile.x)), 0.0, tile.y);   // Tile Info (tile.xy)\r\n    float size = pow(2.0, tile.y - lod);                                                        // Tile Bits (tile.y)\r\n    float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n    float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n    uvs = fract(uvs);                                                                           // Perfrom Tiling (fract)\r\n    uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n    uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    vec4 color = texture2DLodEXT(atlas, uvs, lod);\r\n    if (gamma != 1.0) {\r\n        color.r = pow(color.r, gamma);\r\n        color.g = pow(color.g, gamma);\r\n        color.b = pow(color.b, gamma);\r\n    }\r\n    return color;\r\n}\r\n\r\nvec4 sampleSplatmapAtlas2D(const in sampler2D atlas, const in vec2 tile, const in vec4 rect, in vec2 uvs)\r\n{\r\n    float size = pow(2.0, tile.y);                                                              // Tile Bits (tile.y)\r\n\t   float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n\t   float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n\t   uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n\t   uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    return texture2D(atlas, uvs);\r\n}\r\n\r\nvec3 blendSplatmapAtlasColors(const in vec4 splatmap, in vec4 color1, in vec4 color2, in vec4 color3, in vec4 color4, in vec3 mixbuffer)\r\n{\r\n    vec3 buffer1 = mix(mixbuffer, color1.rgb, splatmap.r);\r\n    vec3 buffer2 = mix(buffer1, color2.rgb, splatmap.g);\r\n    vec3 buffer3 = mix(buffer2, color3.rgb, splatmap.b);\r\n    return mix(buffer3, color4.rgb, splatmap.a);\r\n}\r\n\r\nvec3 perturbNormalSamplerColor(mat3 cotangentFrame, vec3 samplerColor, float scale)\r\n{\r\n    vec3 map = samplerColor.xyz;\r\n    map = map * 2.00787402 - 1.00787402;\r\n    #ifdef NORMALXYSCALE\r\n        map = normalize(map * vec3(scale, scale, 1.0));\r\n    #endif\r\n    return normalize(cotangentFrame * map);\r\n}\r\n\r\n\r\n"},n.prototype.formatTerrainFragmentUpdateColor=function(e,t,n,o,i,r){void 0===r&&(r=1);var a="";if(null!=e&&null!=e.textureAtlas&&null!=e.splatmapAtlas&&e.splatmapCount>0){a="\r\n#define TERRAIN_FRAGMENT_UPDATE_COLOR\r\n\r\nvec3 normalsColor = vec3(0.5, 0.5, 1.0);\r\nvec3 normalsBuffer = normalW.rgb;\r\nvec3 splatmapBuffer = "+t+".rgb;\r\nfloat autoMipMapLevel = -1.0;\r\nfloat normalCorrection = 1.0;\r\nfloat detailCorrection = "+r.toFixed(4)+";\r\n\r\n#if defined(ALBEDO) && defined("+n.toUpperCase()+") && defined("+o.toUpperCase()+")\r\n\r\n// Reset Normal Values\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    uvOffset = vec2(0.0, 0.0);\r\n    #ifdef NORMAL\r\n        normalW = normalize(vNormalW);\r\n    #else\r\n        normalW = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n    #endif\r\n    #ifdef CLEARCOAT\r\n        clearCoatNormalW = normalW;\r\n    #endif\r\n    #if defined(BUMP) || defined(PARALLAX)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV);\r\n        #endif\r\n    #elif defined(ANISOTROPIC)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV, vec2(1.0, 1.0));\r\n        #endif\r\n    #endif\r\n    #ifdef PARALLAX\r\n        invTBN = transposeMat3(TBN);\r\n    #endif\r\n    normalW = perturbNormalSamplerColor(TBN, normalsColor, 1.0);\r\n#endif\r\n\r\n// Global Atlas Values\r\nfloat splatTileSize = "+e.splatmapAtlas[2].toFixed(4)+";\r\nfloat splatTileBits = "+e.splatmapAtlas[3].toFixed(4)+";\r\nfloat detailTileSize = "+e.textureAtlas[2].toFixed(4)+";\r\nfloat detailTileBits = "+e.textureAtlas[3].toFixed(4)+";\r\n\r\n// Sample splatmap textures\r\n";for(var l=0,s=0;s<e.splatmapCount;s++){l=4*s;var u=e["splatmapRect"+s];if(a+="vec4 splatmapRect"+s+" = vec4("+u[0].toFixed(4)+", "+u[1].toFixed(4)+", "+u[2].toFixed(4)+", "+u[3].toFixed(4)+");\r\n",a+="vec4 splatmapAlbedo"+s+" = sampleSplatmapAtlas2D("+n+", vec2(splatTileSize, splatTileBits), splatmapRect"+s+", (vSplatmapUV + uvOffset));\r\n",a+="vec4 textureAlbedo"+(l+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="vec4 textureAlbedo"+(l+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="vec4 textureAlbedo"+(l+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="vec4 textureAlbedo"+(l+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(l+0)]){var c=e["textureRect"+(l+0)],d=e["textureInfo"+(l+0)];a+="vec4 textureRect"+(l+0)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+0)+" = vec2("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+0)+" = vec2("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+0)+" = ((vSplatmapUV + textureOffset"+(l+0)+") * textureScale"+(l+0)+");\r\n",a+="textureAlbedo"+(l+0)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+0)+", textureTileUV"+(l+0)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(l+1)]){var c=e["textureRect"+(l+1)],d=e["textureInfo"+(l+1)];a+="vec4 textureRect"+(l+1)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+1)+" = vec2("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+1)+" = vec2("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+1)+" = ((vSplatmapUV + textureOffset"+(l+1)+") * textureScale"+(l+1)+");\r\n",a+="textureAlbedo"+(l+1)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+1)+", textureTileUV"+(l+1)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(l+2)]){var c=e["textureRect"+(l+2)],d=e["textureInfo"+(l+2)];a+="vec4 textureRect"+(l+2)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+2)+" = vec2("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+2)+" = vec2("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+2)+" = ((vSplatmapUV + textureOffset"+(l+2)+") * textureScale"+(l+2)+");\r\n",a+="textureAlbedo"+(l+2)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+2)+", textureTileUV"+(l+2)+", autoMipMapLevel);\r\n"}if(e["textureRect"+(l+3)]){var c=e["textureRect"+(l+3)],d=e["textureInfo"+(l+3)];a+="vec4 textureRect"+(l+3)+" = vec4("+c[0].toFixed(4)+", "+c[1].toFixed(4)+", "+c[2].toFixed(4)+", "+c[3].toFixed(4)+");\r\n",a+="vec2 textureScale"+(l+3)+" = vec2("+d[0].toFixed(4)+", "+d[1].toFixed(4)+");\r\n",a+="vec2 textureOffset"+(l+3)+" = vec2("+d[2].toFixed(4)+", "+d[3].toFixed(4)+");\r\n",a+="vec2 textureTileUV"+(l+3)+" = ((vSplatmapUV + textureOffset"+(l+3)+") * textureScale"+(l+3)+");\r\n",a+="textureAlbedo"+(l+3)+" = sampleTextureAtlas2D("+o+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+3)+", textureTileUV"+(l+3)+", autoMipMapLevel);\r\n"}if(a+="splatmapBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", textureAlbedo"+(l+0)+", textureAlbedo"+(l+1)+", textureAlbedo"+(l+2)+", textureAlbedo"+(l+3)+", splatmapBuffer);\r\n",a+="#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n",a+="    #if defined("+i.toUpperCase()+")\r\n",a+="        vec4 normalColor"+(l+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="        vec4 normalColor"+(l+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="        vec4 normalColor"+(l+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",a+="        vec4 normalColor"+(l+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",e["textureRect"+(l+0)]){var p=e["normalsScale"+(l+0)];a+="        float normalScale"+(l+0)+" = "+p.toFixed(4)+";\r\n",a+="        normalColor"+(l+0)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+0)+", textureTileUV"+(l+0)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+0)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+0)+".rgb, normalScale"+(l+0)+");\r\n"}if(e["textureRect"+(l+1)]){var p=e["normalsScale"+(l+1)];a+="        float normalScale"+(l+1)+" = "+p.toFixed(4)+";\r\n",a+="        normalColor"+(l+1)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+1)+", textureTileUV"+(l+1)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+1)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+1)+".rgb, normalScale"+(l+1)+");\r\n"}if(e["textureRect"+(l+2)]){var p=e["normalsScale"+(l+2)];a+="        float normalScale"+(l+2)+" = "+p.toFixed(4)+";\r\n",a+="        normalColor"+(l+2)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+2)+", textureTileUV"+(l+2)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+2)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+2)+".rgb, normalScale"+(l+2)+");\r\n"}if(e["textureRect"+(l+3)]){var p=e["normalsScale"+(l+3)];a+="        float normalScale"+(l+3)+" = "+p.toFixed(4)+";\r\n",a+="        normalColor"+(l+3)+" = sampleTextureAtlas2D("+i+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(l+3)+", textureTileUV"+(l+3)+", autoMipMapLevel);\r\n",a+="        normalColor"+(l+3)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(l+3)+".rgb, normalScale"+(l+3)+");\r\n"}a+="        normalsBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+s+", normalColor"+(l+0)+", normalColor"+(l+1)+", normalColor"+(l+2)+", normalColor"+(l+3)+", normalsBuffer);\r\n",a+="    #endif\r\n",a+="#endif\r\n",a+="\r\n"}a+="// Update Color Values\r\n"+t+".rgb = splatmapBuffer.rgb;\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    #if defined("+i.toUpperCase()+")\r\n        normalW.rgb = normalsBuffer.rgb;\r\n    #endif\r\n    #if defined(FORCENORMALFORWARD) && defined(NORMAL)\r\n        vec3 faceNormal = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n        #if defined(TWOSIDEDLIGHTING)\r\n            faceNormal = gl_FrontFacing ? faceNormal : -faceNormal;\r\n        #endif\r\n        normalW *= sign(dot(normalW, faceNormal));\r\n    #endif\r\n    #if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\r\n        normalW = gl_FrontFacing ? normalW : -normalW;\r\n    #endif\r\n#endif\r\n\r\n#endif\r\n\r\n";
}return a},n}(e.UniversalAlbedoMaterial);e.UniversalTerrainMaterial=a,BABYLON.RegisterClass("UNITY.UniversalTerrainMaterial",a)}(UNITY||(UNITY={}));var UNITY;!function(e){var t=function(){function t(t,n,o){if(void 0===o&&(o={}),this._update=null,this._late=null,this._step=null,this._fixed=null,this._after=null,this._ready=null,this._lateUpdate=!1,this._properties=null,this._awoken=!1,this._started=!1,this._scene=null,this._delyed=!1,this._transform=null,this._scriptReady=!1,this._registeredClassname=null,this._lateUpdateObserver=null,this.resetScriptComponent=null,this._worldCollisionObserver=null,this._worldCollisionEndedObserver=null,this._worldTriggerEventObserver=null,this.onCollisionEnterObservable=new BABYLON.Observable,this.onCollisionStayObservable=new BABYLON.Observable,this.onCollisionExitObservable=new BABYLON.Observable,this.onTriggerEnterObservable=new BABYLON.Observable,this.onTriggerExitObservable=new BABYLON.Observable,null==t)throw new Error("Null transform object specified.");if(null==n)throw new Error("Null host scene object specified.");this._scene=n,this._transform=t,this._properties=o||{},this._registeredClassname=null;var i=this;i._update=function(){e.ScriptComponent.UpdateInstance(i)},i._late=function(){e.ScriptComponent.LateInstance(i)},i._step=function(){e.ScriptComponent.StepInstance(i)},i._fixed=function(){e.ScriptComponent.FixedInstance(i)},i._after=function(){e.ScriptComponent.AfterInstance(i)},i._ready=function(){e.ScriptComponent.ReadyInstance(i)},i.resetScriptComponent=function(){e.ScriptComponent.ResetInstance(i)},i.registerComponentInstance&&i.destroyComponentInstance||BABYLON.Tools.Warn("Invalid component registration handlers for: "+this._transform.name)}return t.prototype.isReady=function(){return this._scriptReady},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return this._registeredClassname},t.prototype.setProperty=function(e,t){null==this._properties&&(this._properties={}),this._properties[e]=t},t.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=this._properties&&(n=this._properties[e],null==n&&(n=this._properties["auto__"+e])),null==n&&(n=t),null!=n?n:null},t.prototype.getTime=function(){return e.SceneManager.GetTime()},t.prototype.getTimeMs=function(){return e.SceneManager.GetTimeMs()},t.prototype.getGameTime=function(){return e.SceneManager.GetGameTime()},t.prototype.getGameTimeMs=function(){return e.SceneManager.GetGameTimeMs()},t.prototype.getDeltaSeconds=function(){return e.SceneManager.GetDeltaSeconds(this.scene)},t.prototype.getDeltaMilliseconds=function(){return e.SceneManager.GetDeltaMilliseconds(this.scene)},t.prototype.getAnimationRatio=function(){return e.SceneManager.GetAnimationRatio(this.scene)},t.prototype.hasSkinnedMesh=function(){return null!=this.getSkinnedMesh()},t.prototype.getSkinnedMesh=function(){return e.SceneManager.GetSkinnedMesh(this.transform)},t.prototype.getTransformMesh=function(){return this._transform instanceof BABYLON.Mesh?this._transform:null},t.prototype.getAbstractMesh=function(){return this._transform instanceof BABYLON.AbstractMesh?this._transform:null},t.prototype.getInstancedMesh=function(){return this._transform instanceof BABYLON.InstancedMesh?this._transform:null},t.prototype.getPrimitiveMeshes=function(){return e.SceneManager.GetPrimitiveMeshes(this.transform)},t.prototype.getMetadata=function(){return e.SceneManager.FindSceneMetadata(this._transform)},t.prototype.getComponent=function(t){var n=e.SceneManager.FindScriptComponent(this._transform,t);return null!=n?n:null},t.prototype.getComponents=function(t){var n=e.SceneManager.FindAllScriptComponents(this._transform,t);return null!=n?n:null},t.prototype.getLightRig=function(){return e.SceneManager.FindSceneLightRig(this._transform)},t.prototype.getCameraRig=function(){return e.SceneManager.FindSceneCameraRig(this._transform)},t.prototype.getTransformTag=function(){return e.SceneManager.GetTransformTag(this.transform)},t.prototype.hasTransformTags=function(t){return e.SceneManager.HasTransformTags(this._transform,t)},t.prototype.getChildNode=function(t,n,o,i){return void 0===n&&(n=e.SearchType.ExactMatch),void 0===o&&(o=!0),void 0===i&&(i=null),e.SceneManager.FindChildTransformNode(this._transform,t,n,o,i)},t.prototype.getChildWithTags=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindChildTransformWithTags(this._transform,t,n,o)},t.prototype.getChildrenWithTags=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindAllChildTransformsWithTags(this._transform,t,n,o)},t.prototype.getChildWithScript=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindChildTransformWithScript(this._transform,t,n,o)},t.prototype.getChildrenWithScript=function(t,n,o){return void 0===n&&(n=!0),void 0===o&&(o=null),e.SceneManager.FindAllChildTransformsWithScript(this._transform,t,n,o)},t.prototype.enableCollisionEvents=function(){var e=this,t=window.havokPlugin;null!=t&&null!=this.transform.physicsBody&&(this.transform.physicsBody.setCollisionCallbackEnabled(!0),this.transform.physicsBody.setCollisionEndedCallbackEnabled(!0),null==this._worldCollisionObserver&&(this._worldCollisionObserver=t.onCollisionObservable.add(function(t){if(t.collider===e.transform.physicsBody||t.collidedAgainst===e.transform.physicsBody){var n=t.collider===e.transform.physicsBody?t.collidedAgainst:t.collider;"COLLISION_STARTED"===t.type?e.onCollisionEnterObservable.notifyObservers(n.transformNode):"COLLISION_CONTINUED"===t.type&&e.onCollisionStayObservable.notifyObservers(n.transformNode)}})),null==this._worldCollisionEndedObserver&&(this._worldCollisionEndedObserver=t.onCollisionEndedObservable.add(function(t){if(t.collider===e.transform.physicsBody||t.collidedAgainst===e.transform.physicsBody){var n=t.collider===e.transform.physicsBody?t.collidedAgainst:t.collider;"COLLISION_FINISHED"===t.type&&e.onCollisionExitObservable.notifyObservers(n.transformNode)}})),null==this._worldTriggerEventObserver&&(this._worldTriggerEventObserver=t.onTriggerCollisionObservable.add(function(t){if(t.collider===e.transform.physicsBody||t.collidedAgainst===e.transform.physicsBody){var n=t.collider===e.transform.physicsBody?t.collidedAgainst:t.collider;"TRIGGER_ENTERED"===t.type?e.onTriggerEnterObservable.notifyObservers(n.transformNode):"TRIGGER_EXITED"===t.type&&e.onTriggerExitObservable.notifyObservers(n.transformNode)}})))},t.prototype.disableCollisionEvents=function(){var e=window.havokPlugin;null!=e&&null!=this.transform.physicsBody&&(this.transform.physicsBody.setCollisionCallbackEnabled(!1),this.transform.physicsBody.setCollisionEndedCallbackEnabled(!1))},t.prototype.setTransformPosition=function(e){this.transform.physicsBody&&(this.transform.physicsBody.disablePreStep=!1),null!=this.transform.position&&this.transform.position.copyFrom(e)},t.prototype.setTransformRotation=function(e){this.transform.physicsBody&&(this.transform.physicsBody.disablePreStep=!1),null!=this.transform.rotationQuaternion&&this.transform.rotationQuaternion.copyFrom(e)},t.prototype.registerOnClickAction=function(t){var n=null;return this.transform instanceof BABYLON.AbstractMesh&&(n=e.SceneManager.RegisterClickAction(this.scene,this.transform,t)),n},t.prototype.unregisterOnClickAction=function(t){var n=!1;return this.transform instanceof BABYLON.AbstractMesh&&(n=e.SceneManager.UnregisterClickAction(this.transform,t)),n},t.prototype.registerComponentInstance=function(t,n,o){if(void 0===o&&(o=!0),o===!0){e.Utilities.ValidateTransformMetadata(this._transform);var i={alias:"script",order:0,klass:n,properties:null,instance:t};null==this._transform.metadata.unity.components&&(this._transform.metadata.unity.components=[]),this._transform.metadata.unity.components.push(i)}t._registeredClassname=n,e.ScriptComponent.RegisterInstance(t),o===!0&&t.scene.onAfterRenderObservable.addOnce(function(){t.delayComponentInstance(t)})},t.prototype.delayComponentInstance=function(t){e.SceneManager.SetTimeout(100,function(){t._delyed=!0})},t.prototype.destroyComponentInstance=function(t){e.ScriptComponent.DestroyInstance(t)},t.prototype.setupStepComponentInstance=function(e){e.scene.onBeforePhysicsObservable.add(e._step)},t.prototype.removeStepComponentInstance=function(e){e.scene.onBeforePhysicsObservable.removeCallback(e._step)},t.prototype.setupFixedComponentInstance=function(e){e.scene.onAfterPhysicsObservable.add(e._fixed)},t.prototype.removeFixedComponentInstance=function(e){e.scene.onAfterPhysicsObservable.removeCallback(e._fixed)},t.RegisterInstance=function(e){null!=e&&(null!=e._update&&e.scene.registerBeforeRender(e._update),e.late&&null!=e._late&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&(e._lateUpdateObserver=e.scene.onBeforeRenderTargetsRenderObservable.add(e._late)),e.after&&null!=e._after&&e.scene.registerAfterRender(e._after),e.step&&null!=e._step&&e.setupStepComponentInstance(e),e.fixed&&null!=e._fixed&&e.setupFixedComponentInstance(e))},t.UpdateInstance=function(t){null!=t&&null!=t.transform&&t.transform.isEnabled(!1)&&(t._awoken===!1?(t._awoken=!0,e.ScriptComponent.ParseAutoProperties(t),t.awake&&t.awake()):t._started===!1?(t._started=!0,t.start&&t.start()):t._awoken===!0&&t._started===!0&&(t._delyed===!0&&(t._delyed=!1,e.ScriptComponent.ReadyInstance(t)),t.update&&t.update(),t._lateUpdate=!0))},t.LateInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&e._lateUpdate===!0&&(e._lateUpdate=!1,e._started===!0&&e.late&&e.late())},t.AfterInstance=function(e){null!=e&&null!=e.transform&&e.transform.isEnabled(!1)&&e._started===!0&&e.after&&e.after()},t.StepInstance=function(e){null!=e&&null!=e.transform&&e._started===!0&&e.step&&e.step()},t.FixedInstance=function(e){null!=e&&null!=e.transform&&e._started===!0&&e.fixed&&e.fixed()},t.ReadyInstance=function(e){null!=e&&null!=e.transform&&e._scriptReady===!1&&(e._scriptReady=!0,e.ready&&e.ready())},t.ResetInstance=function(e){null!=e&&null!=e.transform&&e._started===!0&&e.reset&&e.reset()},t.DestroyInstance=function(e){if(null!=e){e.scene.unregisterBeforeRender(e._update),null!=e._lateUpdateObserver&&null!=e.scene.onBeforeRenderTargetsRenderObservable&&e.scene.onBeforeRenderTargetsRenderObservable.remove(e._lateUpdateObserver),e.after&&null!=e._after&&e.scene.unregisterAfterRender(e._after),e.step&&null!=e._step&&e.removeStepComponentInstance(e),e.fixed&&null!=e._fixed&&e.removeFixedComponentInstance(e);var t=window.havokPlugin;if(null!=t){if(null!=e._worldCollisionObserver)try{t.onCollisionObservable.remove(e._worldCollisionObserver)}catch(n){}if(null!=e._worldCollisionEndedObserver)try{t.onCollisionEndedObservable.remove(e._worldCollisionEndedObserver)}catch(n){}if(null!=e._worldTriggerEventObserver)try{t.onTriggerCollisionObservable.remove(e._worldTriggerEventObserver)}catch(n){}}try{e.onCollisionEnterObservable.clear()}catch(n){}try{e.onCollisionStayObservable.clear()}catch(n){}try{e.onCollisionExitObservable.clear()}catch(n){}try{e.onTriggerEnterObservable.clear()}catch(n){}try{e.onTriggerExitObservable.clear()}catch(n){}try{e.destroy&&e.destroy()}catch(n){}e._scriptReady=!1,e._transform=null,e._properties=null,e._started=!1,e._delyed=!1,e._update=null,e._late=null,e._step=null,e._fixed=null,e._after=null,e._ready=null,e._scene=null}},t.ParseAutoProperties=function(t){var n=Object.keys(t._properties);if(null!=n&&n.length>0)for(var o=function(o){var i=n[o];if(e.Utilities.StartsWith(i,"auto__")){var r=i.replace("auto__","");if(e.Utilities.HasOwnProperty(t,r)){var a=t.getProperty(i);if(null!=a){var l=typeof a;if(null!=l&&""!==l)if("object"===l)if(Array.isArray(a)){var s=[],u=a;u.forEach(function(n){if(null!=n){var o=typeof n;"object"===o?s.push(e.ScriptComponent.UnpackObjectProperty(n,t.scene)):s.push(n)}}),t[r]=s}else{var c=t[r],d=e.ScriptComponent.UnpackObjectProperty(a,t.scene);c instanceof BABYLON.Color3&&d instanceof BABYLON.Color4?t[r]=new BABYLON.Color3(d.r,d.g,d.b):t[r]=d}else t[r]=a;else t[r]=a}else t[r]=a}else BABYLON.Tools.Warn(t.getClassName()||"Unregistered Class: Auto property '"+r+"' not found for transform '"+t.transform.name+"'")}},i=0;i<n.length;i++)o(i)},t.UnpackObjectProperty=function(t,n){var o=null;if(null!=t)if(void 0!==t.x&&void 0!==t.y)o=void 0!==t.z?void 0!==t.w?new BABYLON.Vector4(t.x,t.y,t.z,t.w):new BABYLON.Vector3(t.x,t.y,t.z):new BABYLON.Vector2(t.x,t.y);else if(void 0!==t.r&&void 0!==t.g&&void 0!==t.b){var i=1;void 0!==t.a&&(i=t.a),o=new BABYLON.Color4(t.r,t.g,t.b,i)}else if(void 0!==t.type)switch(t.type){case"UnityEngine.AnimationCurve":var r=t;o=BABYLON.Animation.Parse(r.animation);break;case"UnityEngine.Transform":var a=t;o=e.Utilities.ParseTransformByID(a,n);break;case"UnityEngine.Material":var l=t;o=n.getMaterialByName(l.name);break;case"UnityEngine.Texture2D":var s=t;o=e.Utilities.ParseTexture(s,n);break;case"UnityEngine.Cubemap":var u=t;o=e.Utilities.ParseCubemap(u,n);break;case"UnityEngine.AudioClip":var c=t;o=c;break;case"UnityEngine.Video.VideoClip":var d=t;o=d;break;case"UnityEngine.Font":var p=t;o=p;break;case"UnityEngine.TextAsset":var h=t;o=null!=h.base64?h.json===!0?JSON.parse(window.atob(h.base64)):window.atob(h.base64):h;break;case"UnityEditor.DefaultAsset":var m=t;o=null!=m.base64?m.json===!0?JSON.parse(window.atob(m.base64)):window.atob(m.base64):m;break;default:o=t}else o=t;return o},t}();e.ScriptComponent=t}(UNITY||(UNITY={}));var UNITY;!function(e){var t=function(){function t(e){this._babylonScene=e,this._physicList=[],this._shadowList=[],this._scriptList=[],this._freezeList=[]}return t.prototype.parseSceneComponents=function(t){e.MetadataParser.DoParseSceneComponents(this._babylonScene,t,this._physicList,this._shadowList,this._scriptList,this._freezeList)},t.prototype.postProcessSceneComponents=function(t,n){e.MetadataParser.DoProcessPendingPhysics(this._babylonScene,this._physicList),e.MetadataParser.DoProcessPendingShadows(this._babylonScene,this._shadowList),e.MetadataParser.DoProcessPendingScripts(this._babylonScene,this._scriptList,t,n),e.MetadataParser.DoProcessPendingFreezes(this._freezeList),this._babylonScene=null,this._physicList=null,this._shadowList=null,this._scriptList=null,this._freezeList=null},t.DoParseSceneComponents=function(t,n,o,i,r,a){if(null!=n&&null!=n.metadata&&null!=n.metadata.unity&&null!=n.metadata.unity.parsed&&n.metadata.unity.parsed===!1){n.onDisposeObservable.addOnce(function(){e.Utilities.DisposeEntity(n)}),n.metadata.unity.parsed=!0,n.metadata.unity.prefab=!1;var l=n.metadata.unity,s=null==n.metadata.unity.visible||n.metadata.unity.visible,u=null!=n.metadata.unity.visibility?n.metadata.unity.visibility:1,c=null!=n.metadata.unity.billboard?n.metadata.unity.billboard:0,d=n instanceof BABYLON.AbstractMesh,p=(null!=n.metadata.unity.lightmapped&&n.metadata.unity.lightmapped,l.tags);if(null!=p&&""!==p&&(BABYLON.Tags.AddTagsTo(n,p),p.indexOf("NavigationMesh")>=0&&(n.isVisible=!1,n.isPickable=!1,n.useVertexColors=!1)),null!=l.physics&&null!=o&&o.push(n),n.renderingGroupId,null!=l.renderer)if(d===!0)n.isPickable=!0,n.useVertexColors=!1,n.isVisible=s,n.visibility=u,n.billboardMode=c,n.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(n.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=i&&i.push(n),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(n.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(n.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(n.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(n.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(n.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(n.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(n.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(n.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(n.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=a&&a.push(n);else{var h=e.SceneManager.GetSkinnedMesh(n);if(null!=h)h.isPickable=!0,h.useVertexColors=!1,h.isVisible=s,h.visibility=u,h.billboardMode=c,h.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,h.alwaysSelectAsActiveMesh=!0,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(h.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=i&&i.push(h),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(h.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(h.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(h.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(h.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(h.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(h.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(h.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(h.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(h.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=a&&a.push(h);else{var m=e.SceneManager.GetPrimitiveMeshes(n);null!=m&&m.length>0&&m.forEach(function(t){var n=e.SceneManager.GetSkinnedMesh(t);null!=n?(n.isPickable=!0,n.useVertexColors=!1,n.isVisible=s,n.visibility=u,n.billboardMode=c,n.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,n.alwaysSelectAsActiveMesh=!0,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(n.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=i&&i.push(n),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(n.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(n.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(n.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(n.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(n.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(n.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(n.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(n.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(n.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=a&&a.push(n)):(t.isPickable=!0,t.useVertexColors=!1,t.isVisible=s,t.visibility=u,t.billboardMode=c,t.cullingStrategy=BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD,null!=l.renderer.cullingstrategy&&l.renderer.cullingstrategy!==BABYLON.AbstractMesh.CULLINGSTRATEGY_STANDARD&&(t.cullingStrategy=l.renderer.cullingstrategy),null!=l.renderer.castshadows&&l.renderer.castshadows===!0&&null!=i&&i.push(t),null!=l.renderer.receiveshadows&&l.renderer.receiveshadows===!0&&(t.receiveShadows=!0),null!=l.renderer.checkcollisions&&l.renderer.checkcollisions===!0&&(t.checkCollisions=!0),null!=l.renderer.istriggervolume&&l.renderer.istriggervolume===!0&&(t.collisionResponse=!1),null!=l.renderer.usevertexcolors&&(t.useVertexColors=l.renderer.usevertexcolors),null!=l.renderer.setmeshpickable&&(t.isPickable=l.renderer.setmeshpickable),null!=l.renderer.showboundingbox&&(t.showBoundingBox=l.renderer.showboundingbox),null!=l.renderer.defaultellipsoid&&(t.ellipsoid=e.Utilities.ParseVector3(l.renderer.defaultellipsoid)),null!=l.renderer.ellipsoidoffset&&(t.ellipsoidOffset=e.Utilities.ParseVector3(l.renderer.ellipsoidoffset)),null!=l.renderer.rendergroupid&&(t.renderingGroupId=l.renderer.rendergroupid),null!=l.renderer.freezeworldmatrix&&l.renderer.freezeworldmatrix===!0&&null!=a&&a.push(t))})}}if(null!=l.components){var f=l.components;null!=f&&f.length>0&&f.forEach(function(o){if(null!=o)switch(o.alias){case"camera":e.MetadataParser.SetupCameraComponent(t,n,o);break;case"light":e.MetadataParser.SetupLightComponent(t,n,o);break;case"script":null!=r&&r.push({mesh:n,comp:o})}})}}},t.DoProcessPendingScripts=function(t,n,o,i){null!=n&&n.length>0&&(n.sort(function(e,t){return e.comp.order<t.comp.order?-1:e.comp.order>t.comp.order?1:0}),n.forEach(function(n){if(null!=n.comp.klass&&""!==n.comp.klass&&"UNITY.ScriptComponent"!==n.comp.klass){var r=e.Utilities.InstantiateClass(n.comp.klass);if(null!=r){var a=new r(n.mesh,t,n.comp.properties);if(null!=a){var l=a instanceof e.ScriptComponent;l===!0?(n.comp.instance=a,null!=i&&i.push(n.comp.instance),n.comp.instance.addPreloaderTasks&&null!=o&&o.push(n.comp.instance),e.SceneManager.AttachScriptComponent(n.comp.instance,n.comp.klass,!1)):BABYLON.Tools.Warn("Non script component instantiated class: "+n.comp.klass)}else BABYLON.Tools.Warn("Failed to instantiate script class: "+n.comp.klass)}else BABYLON.Tools.Warn("Failed to locate script class: "+n.comp.klass)}}))},t.DoProcessPendingShadows=function(e,t){null!=t&&t.length>0&&null!=e.lights&&e.lights.length>0&&e.lights.forEach(function(e){var n=e.getShadowGenerator();if(null!=n&&null!=e.metadata&&null!=e.metadata.unity&&e.metadata.unity.autorender===!0){var o=n.getShadowMap();null!=o&&t.forEach(function(t){var n=!1;n=!(null!=e.includedOnlyMeshes&&e.includedOnlyMeshes.length>0)||e.includedOnlyMeshes.indexOf(t)>=0,n===!0&&(null==o.renderList&&(o.renderList=[]),o.renderList.indexOf(t)<0&&o.renderList.push(t))})}})},t.DoProcessPendingPhysics=function(t,n){if(null!=n&&n.length>0){var o=t.isPhysicsEnabled(),i=o===!0?t.getPhysicsEngine():null,r=o===!0&&null!=i;r===!0?n.forEach(function(n){e.RigidbodyPhysics.SetupPhysicsComponent(t,n)}):BABYLON.Tools.Warn("Physics engine not loaded. Physics impostors will not be created.")}},t.DoProcessPendingFreezes=function(e){null!=e&&e.length>0&&e.forEach(function(e){e.freezeWorldMatrix()})},t.SetupCameraComponent=function(t,n,o){n.checkCollisions=!1;var i=0,r=n.name+".Rig",a=0,l=null!=o.culling?o.culling:-1,s=null!=o.camerabase?o.camerabase:0,u=(null!=o.clearflags?o.clearflags:0,null!=o.renderlist?o.renderlist:null),c=null!=o.maincamera&&o.maincamera,d=4===s?new BABYLON.FreeCamera(r,BABYLON.Vector3.Zero(),t):new BABYLON.UniversalCamera(r,BABYLON.Vector3.Zero(),t);d.checkCollisions=!1,d.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(0,a,0),d.parent=n,c===!0&&(t.activeCamera=d);var p=null!=o.type?o.type:0;switch(p){case 0:d.mode=BABYLON.Camera.PERSPECTIVE_CAMERA,null!=o.perspectiveyfov&&(d.fov=o.perspectiveyfov),null!=o.perspectiveznear&&(d.minZ=o.perspectiveznear),null!=o.perspectivezfar&&(d.maxZ=o.perspectivezfar);break;case 1:d.mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA,null!=o.orthoxmag&&(d.orthoLeft=-o.orthoxmag,d.orthoRight=o.orthoxmag),null!=o.orthoymag&&(d.orthoBottom=-o.orthoymag,d.orthoTop=o.orthoymag),null!=o.orthoznear&&(d.minZ=o.orthoznear),null!=o.orthozfar&&(d.maxZ=o.orthozfar)}if(l===-1);else if(0===l);else{var h=u;if(null!=h&&h.length>0){var m=function(){var n=h[i],o=e.SceneManager.GetMeshByID(t,n);if(null!=o){var r=o.name+".Detail",a=o.getChildren(function(e){return e.name===r},!0);null!=a&&a.length>0}};for(i=0;i<h.length;i++)m()}}n.cameraRig=d},t.SetupLightComponent=function(t,n,o){n.checkCollisions=!1;var i,r=n.name+".Rig",a=0,l=1,s=null!=o.culling?o.culling:-1,u=(null!=o.clearflags?o.clearflags:0,null!=o.renderlist?o.renderlist:null),c=null!=o.type?o.type:0,d=e.SceneManager.GetRenderQuality(),p=null!=o.exponentdecayspeed?o.exponentdecayspeed:1,h=!1;switch(c){case 0:var m=BABYLON.Vector3.Forward(),f=null!=o.orthoscale?o.orthoscale:.1,g=null!=o.ortholeft?o.ortholeft:Number.MAX_VALUE,y=null!=o.orthoright?o.orthoright:Number.MAX_VALUE,v=null!=o.orthotop?o.orthotop:Number.MAX_VALUE,_=null!=o.orthobottom?o.orthobottom:Number.MAX_VALUE,B=null!=o.calczbounds&&o.calczbounds,b=null!=o.updateextends&&o.updateextends,C=null!=o.shadowfrustumsize?o.shadowfrustumsize:0,T=new BABYLON.DirectionalLight(r,m,t);T.shadowFrustumSize=C,T.shadowOrthoScale=f,T.autoCalcShadowZBounds=B,T.autoUpdateExtends=b,T.orthoLeft=g,T.orthoRight=y,T.orthoTop=v,T.orthoBottom=_,i=T,i.falloffType=BABYLON.Light.FALLOFF_STANDARD,h=d===e.RenderQuality.High||d===e.RenderQuality.Medium,l=e.SceneManager.DirectionalLightIntensity;break;case 1:var I=i=new BABYLON.PointLight(r,BABYLON.Vector3.Zero(),t);i=I,i.falloffType=BABYLON.Light.FALLOFF_STANDARD,h=d===e.RenderQuality.High||d===e.RenderQuality.Medium,l=e.SceneManager.PointLightIntensity;break;case 2:var m=BABYLON.Vector3.Forward(),S=null!=o.spotangle?o.spotangle:Math.PI/4,A=new BABYLON.SpotLight(r,BABYLON.Vector3.Zero(),m,0,p,t);A.angle=.966*BABYLON.Tools.ToRadians(S),A.innerAngle=.8*A.angle,i=A,i.falloffType=BABYLON.Light.FALLOFF_GLTF,h=d===e.RenderQuality.High||d===e.RenderQuality.Medium,l=e.SceneManager.SpotLightIntensity}if(null!=i){var O=null!=o.range?o.range:Number.MAX_VALUE,x=null!=o.color?e.Utilities.ParseColor3(o.color,BABYLON.Color3.White()):BABYLON.Color3.White(),M=null!=o.specular?e.Utilities.ParseColor3(o.specular,BABYLON.Color3.White()):BABYLON.Color3.White();i.parent=n,i.range=O,i.diffuse=x,i.specular=M,i.intensity=(null!=o.intensity?o.intensity:1)*l,i.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT,i.intensityMode=BABYLON.Light.INTENSITYMODE_AUTOMATIC,i.shadowEnabled=!1;var N=null==o.autorender||o.autorender,L=null!=o.softshadows&&o.softshadows,w=null!=o.numcascades?o.numcascades:0,P=null!=o.cascadelambda?o.cascadelambda:1,U=null!=o.setdepthclamp&&o.setdepthclamp,R=null!=o.blendpertecntage?o.blendpertecntage:1e-8,k=null!=o.boundsrefreshrate?o.boundsrefreshrate:1,Y=null!=o.lightcontactratio?o.lightcontactratio:.1,D=null!=o.stabilizecascades&&o.stabilizecascades,F=null!=o.penumbradarkness?o.penumbradarkness:1,V=null!=o.softshadowsfilter?o.softshadowsfilter:99,E=null!=o.freezeshadows&&o.freezeshadows,G=null!=o.calcdepths&&o.calcdepths,H=null!=o.depthscaling?o.depthscaling:50,z=null!=o.blurscaling?o.blurscaling:2,W=null==o.kernelblur||o.kernelblur,Q=null!=o.blurkernelsize?o.blurkernelsize:1,X=null!=o.blurboxoffset?o.blurboxoffset:1,j=null!=o.shadowmapsize?o.shadowmapsize:1024,K=null!=o.generateshadows&&o.generateshadows,q=null!=o.shadowbiasfactor?o.shadowbiasfactor:.001,Z=null!=o.normalbiasfactor?o.normalbiasfactor:.1,J=null!=o.shadowmapbias?o.shadowmapbias:.05,$=null!=o.normalmapbias?o.normalmapbias:.4,ee=null!=o.shadowstrength?o.shadowstrength:1,te=null!=o.shadowdistance?o.shadowdistance:150,ne=null!=o.shadownearplane?o.shadownearplane:.2,oe=null!=o.shadowfilterquality?o.shadowfilterquality:"Medium",ie=null!=o.transparencyshadow&&o.transparencyshadow,re=null!=o.softtransparency&&o.softtransparency,ae=null==o.forcebackfacesonly||o.forcebackfacesonly,le=null!=o.frustumedgefalloff?o.frustumedgefalloff:0,se=null!=o.usefullfloatfirst&&o.usefullfloatfirst;if(h===!0&&K===!0){var ue=i,ce=e.SceneManager.GetWebGLVersionNumber(t),de=0===c&&w>=2&&ce>=2,pe=de===!0?new BABYLON.CascadedShadowGenerator(j,i,se):new BABYLON.ShadowGenerator(j,ue,se);if(pe.bias=J*q,pe.normalBias=$*Z,pe.depthScale=H,pe.useKernelBlur=W,pe.blurKernel=Q,pe.blurScale=z,pe.blurBoxOffset=X,pe.frustumEdgeFalloff=le,pe.forceBackFacesOnly=ae,pe.transparencyShadow=ie,pe.enableSoftTransparentShadow=re,pe.contactHardeningLightSizeUVRatio=Y,L===!0)if(ce<=1)pe.usePoissonSampling=!0;else if(de===!0)pe.usePercentageCloserFiltering=!0;else switch(V){case 0:pe.usePoissonSampling=!0;break;case 1:pe.useExponentialShadowMap=!0;break;case 2:pe.useBlurExponentialShadowMap=!0;break;case 3:pe.useCloseExponentialShadowMap=!0;break;case 4:pe.useBlurCloseExponentialShadowMap=!0;break;case 5:pe.useContactHardeningShadow=!0;break;case 99:pe.usePercentageCloserFiltering=!0;break;default:pe.usePoissonSampling=!0}switch(oe){case"High":pe.filteringQuality=BABYLON.ShadowGenerator.QUALITY_HIGH;break;case"Medium":pe.filteringQuality=BABYLON.ShadowGenerator.QUALITY_MEDIUM;break;case"Low":pe.filteringQuality=BABYLON.ShadowGenerator.QUALITY_LOW}if(de===!0){var he=pe;he.lambda=P,he.depthClamp=U,he.shadowMaxZ=te,he.numCascades=w,he.penumbraDarkness=F,he.autoCalcDepthBounds=G,he.stabilizeCascades=D,he.cascadeBlendPercentage=R,he.autoCalcDepthBoundsRefreshRate=k,he.freezeShadowCastersBoundingInfo=E,he.setDarkness(1-BABYLON.Scalar.Clamp(ee)),ue.shadowEnabled=!0,he.splitFrustum()}else{var me=pe;me.setDarkness(1-BABYLON.Scalar.Clamp(ee)),ue.shadowEnabled=!0,ue.shadowMinZ=ne,ue.shadowMaxZ=te}null==i.metadata&&(i.metadata={}),null==i.metadata.unity&&(i.metadata.unity={}),i.metadata.unity.autorender=N}var fe=n.name+".Holder";if(s===-1)i.includedOnlyMeshes=[];else if(0===s)i.includedOnlyMeshes=[new BABYLON.Mesh(fe,t)];else{i.includedOnlyMeshes=[new BABYLON.Mesh(fe,t)];var ge=u;if(null!=ge&&ge.length>0){var ye=function(){var n=ge[a],o=e.SceneManager.GetMeshByID(t,n);if(null!=o){var r=o.name+".Detail",l=o.getChildren(function(e){return e.name===r},!0);null!=l&&l.length>0?i.includedOnlyMeshes.push(l[0]):i.includedOnlyMeshes.push(o)}};for(a=0;a<ge.length;a++)ye()}}n.lightRig=i}},t}();e.MetadataParser=t}(UNITY||(UNITY={}));var CVTOOLS_NAME="CVTOOLS_unity_metadata",CVTOOLS_MESH="CVTOOLS_babylon_mesh",CVTOOLS_HAND="CVTOOLS_left_handed",CubeTextureLoader=function(){function e(){}return e}(),CVTOOLS_unity_metadata=function(){function e(e){this.name=CVTOOLS_NAME,this.enabled=!1,this._babylonScene=null,this._metadataParser=null,this._loaderScene=null,this._assetsManager=null,this._materialMap=null,this._lightmapMap=null,this._reflectionMap=null,this._reflectionCache=null,this._assetContainer=!1,this._activeMeshes=!1,this._parseScene=!1,this._leftHanded=!1,this._disposeRoot=!1,this._sceneParsed=!1,this._preWarmTime=1,this._hideLoader=!1,this._rootUrl=null,this._fileName="Unknown",this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND),this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._rootUrl=null,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._readyList=null,this._preloadList=null,this._materialMap=null,this._lightmapMap=null,this._preWarmTime=1,this._hideLoader=!1,this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._animationGroups=null,this._metadataParser=null,this._babylonScene=null,this.order=100}return e.prototype.dispose=function(){delete this._loader},e.prototype.onLoading=function(){var e=this;UNITY.Utilities.LoadingState=0,this._assetContainer=null!=this._loader._assetContainer,this._metadataParser=null,this._babylonScene=this._loader.babylonScene,this._loaderScene=null,this._assetsManager=null,this._rootUrl=this._loader._uniqueRootUrl?this._loader._uniqueRootUrl:"/",this._fileName=this._loader._fileName?this._loader._fileName:"Unknown",this._fileName.indexOf("?")>=0&&(this._fileName=this._fileName.split("?")[0]),this._loader.parent.onCompleteObservable.addOnce(function(){e.onComplete()}),this._loader.parent.onValidatedObservable.addOnce(function(){e.onValidate()}),this._parseScene=this._loader.isExtensionUsed(CVTOOLS_NAME)&&this._loader.isExtensionUsed(CVTOOLS_HAND)&&UNITY.SceneManager.IsSceneParsingEnabled()===!0,this._leftHanded=this._loader.isExtensionUsed(CVTOOLS_HAND),this._disposeRoot=this._sceneParsed=!1,this._animationGroups=[],this._masterList=[],this._detailList=[],
this._parserList=[],this._shaderList=[],this._readyList=[],this._preloadList=[],this._materialMap=new Map,this._lightmapMap=new Map,this._preWarmTime=1,this._hideLoader=!1,this._reflectionMap={},this._reflectionCache={},UNITY.Utilities.ResetLoaderItemsMarkedForDisposal(),this._babylonScene.getEngine().getCaps().supportSRGBBuffers=UNITY.SceneManager.SupportSRGBBuffers,this._leftHanded===!0&&null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.rotationQuaternion=BABYLON.Quaternion.Identity(),this._loader.rootBabylonMesh.scaling=BABYLON.Vector3.One()),this._parseScene===!0&&(UNITY.SceneManager.RenderLoopReady=!1,null!=this._loader.rootBabylonMesh&&(this._loader.rootBabylonMesh.name="Root."+this._fileName.replace(".gltf","").replace(".glb","")),this.setupLoader())},e.prototype.onReady=function(){this._parseScene===!0&&this._disposeRoot===!0&&null!=this._loader.rootBabylonMesh&&this._loader.rootBabylonMesh.dispose(!0)},e.prototype.onComplete=function(){this._parseScene===!0,this.finishComplete()},e.prototype.getScriptBundleTag=function(){var e=null,t=this._loaderScene,n=null!=t&&null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null;if(null!=n){var o=(null!=this._rootUrl?this._rootUrl:"/",null!=n.script?n.script:null),i=null!=n.project?n.project:null;null!=o&&""!==o&&null!=i&&""!==i&&(e=i.toLocaleLowerCase())}return e},e.prototype.getScriptBundleUrl=function(){var e=null,t=this._loaderScene,n=null!=t&&null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null;if(null!=n){var o=null!=this._rootUrl?this._rootUrl:"/",i=null!=n.script?n.script:null,r=null!=n.project?n.project:null;null!=i&&""!==i&&null!=r&&""!==r&&(e=o+r)}return e},e.prototype.finishComplete=function(){var e=this;this._parseScene===!0&&(this.startParsing(),UNITY.SceneManager.RenderLoopReady=!0,this._babylonScene.onAfterRenderObservable.addOnce(function(){UNITY.Utilities.LoadingState=3,e._processPreloadTimeout()}))},e.prototype.onValidate=function(){this._parseScene===!0},e.prototype.onCleanup=function(){this._fileName=null,this._rootUrl=null,this._parseScene=this._leftHanded=this._disposeRoot=this._sceneParsed=!1,this._masterList=null,this._detailList=null,this._parserList=null,this._shaderList=null,this._preWarmTime=1,this._readyList=null,this._preloadList=null,this._hideLoader=!1,this._animationGroups=null,null!=this._materialMap&&(this._materialMap.clear(),this._materialMap=null),null!=this._lightmapMap&&(this._lightmapMap.clear(),this._lightmapMap=null),this._loaderScene=null,this._assetsManager=null,this._reflectionMap=null,this._reflectionCache=null,this._metadataParser=null,this._babylonScene=null},e.prototype.setupLoader=function(){var e=this,t=this._fileName;this._parseScene===!0&&(this._assetsManager=new UNITY.PreloadAssetsManager(this._babylonScene),this._assetsManager.onProgress=function(e,t,n){if(UNITY.SceneManager.AutoUpdateProgress===!0){var o=1===t?" ASSET":" ASSETS",i="LOADING "+(t-e)+" OF "+t+o;UNITY.SceneManager.UpdateLoaderDetails(i,UNITY.Utilities.LoadingState)}else null!=UNITY.Utilities.OnPreloaderProgress&&UNITY.Utilities.OnPreloaderProgress(e,t,n)},this._assetsManager.onFinish=function(n){UNITY.SceneManager.SetTimeout(100,function(){UNITY.Utilities.LoadingState=4,UNITY.SceneManager.AutoUpdateProgress===!0&&UNITY.SceneManager.UpdateLoaderStatus("PLEASE WAIT","PREPARING SCENE VIEW",UNITY.Utilities.LoadingState);var o=e._preWarmTime>0?1e3*e._preWarmTime:100;UNITY.SceneManager.SetTimeout(o,function(){if(null!=UNITY.Utilities.OnPreloaderComplete&&UNITY.Utilities.OnPreloaderComplete(n),e._processShaderMaterials(e._babylonScene,e._shaderList),UNITY.Utilities.RemoveLoaderItemsMarkedForDisposal(),null!=e._readyList&&e._readyList.length>0)for(var o=0;o<e._readyList.length;o++){var i=e._readyList[o];null!=i&&i._ready&&i._ready()}e._babylonScene.onAfterRenderObservable.addOnce(function(){var n=null!=t&&""!==t?t:"Unknown";null!=UNITY.SceneManager.OnSceneReadyObservable&&UNITY.SceneManager.OnSceneReadyObservable.notifyObservers(n),1==e._hideLoader&&UNITY.SceneManager.HideSceneLoader(),e.onCleanup()})})})})},e.prototype.startParsing=function(){this._parseScene===!0&&(UNITY.Utilities.LoadingState=2,this._processLevelOfDetail(this._babylonScene,this._detailList),this._processActiveMeshes(this._babylonScene,this._activeMeshes),this._processUnityMeshes(this._masterList),null!=this._loaderScene&&(this.preProcessSceneProperties(this._loaderScene,this._babylonScene),this.postProcessSceneProperties(this._rootUrl,this._loaderScene,this._babylonScene)),this._assetContainer===!1&&null!=this._parserList&&this._parserList.length>0&&(this._metadataParser=UNITY.Utilities.PostParseSceneComponents(this._babylonScene,this._parserList,this._preloadList,this._readyList)))},e.prototype.loadSceneAsync=function(e,t){if(this._parseScene===!0&&(this._loaderScene=t),this._parseScene===!0&&null!=t.extras&&null!=t.extras.metadata){if(null!=t.extras.metadata.rawmaterials){var n=this._loader,o=t.extras.metadata.rawmaterials;this._preloadRawMaterialsAsync(e,n._gltf.materials,o)}UNITY.Utilities.LoadingState=1;var i=this._loader.loadSceneAsync(e,t);return this.loadSceneExAsync(e,t),i}return UNITY.Utilities.LoadingState=1,null},e.prototype.loadSceneExAsync=function(e,t){var n=this,o=this._loader,i=new Array;if(o._gltf.nodes)for(var r=0,a=o._gltf.nodes;r<a.length;r++){var l=a[r];l._babylonTransformNode&&this._animationGroups&&UNITY.Utilities.AssignAnimationGroupsToNode(l._babylonTransformNode,this._animationGroups)}if(null!=this._reflectionMap&&null!=this._reflectionCache){var s=0,u=function(e){if(s++,c._reflectionMap.hasOwnProperty(e)){var t=e;if(null!=c._assetsManager){var o=c._assetsManager.addBinaryFileTask("Material.ReflectionTextureTask"+s.toFixed(0),t);o.onSuccess=function(e){if(null!=e.data){var o=new Blob([e.data]),i=n._reflectionMap[t];null!=i&&i.forEach(function(e){if(null!=e&&null!=e.mapkey){var t=n._reflectionCache[e.mapkey];if(null!=t)null!=e.material&&UNITY.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=t);else{var i=n._babylonScene,r=URL.createObjectURL(o),a=function(){URL.revokeObjectURL(r)},l=new BABYLON.CubeTexture(r,i,null,null,null,a,a,null,e.prefiltered,e.extension);l.name=e.name,null!=e.boundingBoxSize&&(l.boundingBoxSize=e.boundingBoxSize),null!=e.boundingBoxPosition&&(l.boundingBoxPosition=e.boundingBoxPosition),n._reflectionCache[e.mapkey]=l,null!=e.material&&UNITY.Utilities.HasOwnProperty(e.material,"reflectionTexture")&&(e.material.reflectionTexture=l)}}})}else console.error("Failed to load reflection texture task: "+t)},o.onError=function(e,t,n){console.error(t,n)}}}},c=this;for(var d in this._reflectionMap)u(d)}return o.logClose(),Promise.all(i).then(function(){})},e.prototype._processActiveMeshes=function(e,t){t===!0&&e.freeActiveMeshes()},e.prototype._processUnityMeshes=function(e){null!=e&&e.length>0&&e.forEach(function(e){UNITY.Utilities.RegisterInstancedMeshBuffers(e)})},e.prototype._processPreloadTimeout=function(){if(null!=this._assetsManager){if(null!=this._preloadList&&this._preloadList.length>0)for(var e=0;e<this._preloadList.length;e++){var t=this._preloadList[e];null!=t&&t.addPreloaderTasks&&t.addPreloaderTasks(this._assetsManager)}this._babylonScene._preloaded=!0,this._assetsManager.load()}},e.prototype.loadNodeAsync=function(e,t,n){var o=this;return this._parseScene===!0&&null!=t.extras&&null!=t.extras.metadata?this._loader.loadNodeAsync(e,t,function(e){var i=e,r=t.extras.metadata;null==i.metadata&&(i.metadata={}),i.metadata.unity=r,UNITY.Utilities.ValidateTransformGuid(i),UNITY.Utilities.ValidateTransformMetadata(i),UNITY.Utilities.ValidateTransformQuaternion(i),i.isVisible=null==i.metadata.unity.visible||i.metadata.unity.visible,i.visibility=null!=i.metadata.unity.visibility?i.metadata.unity.visibility:1,i.billboardMode=null!=i.metadata.unity.billboard?i.metadata.unity.billboard:0,o._assetContainer===!0&&(i.metadata.unity.prefab=!0),i.metadata.unity.prefab===!0?i.setEnabled(!1):(o._parserList.push(i),null!=t.extras.metadata.lods&&null!=t.extras.metadata.distances&&null!=o._detailList&&o._detailList.push(i)),o._masterList.push(i),n(i)}):null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){if(this._parseScene===!0){var o=-1;t.index&&(o=t.index,o>=0&&null!=this._materialMap&&(this._materialMap.has(o)||this._materialMap.set(o,n))),n.gltfIndex=o;var i=this._loader,r=new Array;if(n instanceof BABYLON.NodeMaterial)r.push(this._parseNodeMaterialPropertiesAsync("".concat(e,"/nodeMaterial"),t,n));else if(n instanceof BABYLON.ShaderMaterial)r.push(this._parseShaderMaterialPropertiesAsync("".concat(e,"/shaderMaterial"),t,n));else if(n instanceof BABYLON.StandardMaterial)r.push(this._parseDiffuseMaterialPropertiesAsync("".concat(e,"/standardMaterial"),t,n));else{var a=i._extensionsLoadMaterialPropertiesAsync(e,t,n);a?this._parseCommonConstantProperties(r,"".concat(e,"/commonConstant"),t,n):(r.push(i.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&r.push(i._loadMaterialMetallicRoughnessPropertiesAsync("".concat(e,"/pbrMetallicRoughness"),t.pbrMetallicRoughness,n)),i.loadMaterialAlphaProperties(e,t,n),this._parseCommonConstantProperties(r,"".concat(e,"/commonConstant"),t,n))}return Promise.all(r).then(function(){})}return null},e.prototype._getCachedMaterialByIndex=function(e){var t=null;return e>=0&&null!=this._materialMap&&(t=this._materialMap.get(e)||null),t},e.prototype._getCachedLightmapByIndex=function(e){var t=null;return e>=0&&null!=this._lightmapMap&&(t=this._lightmapMap.get(e)||null),t},e.prototype.createMaterial=function(e,t,n){if(this._parseScene===!0&&t.index){var o=t.index;if(o>=0){var i=this._getCachedMaterialByIndex(o);if(null!=i)return i}}if(this._parseScene===!0){var r=null,a=t.name||"No Name";if(null!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.customMaterial){var l=t.extras.metadata,s=l.customMaterial,u=(l.customShader,UNITY.Utilities.InstantiateClass(s));if(null!=u){var c=new u(a,this._loader.babylonScene);if(null!=c){var d=c instanceof BABYLON.Material;d===!0?(r=c,r.fillMode=n,r instanceof BABYLON.ShaderMaterial&&UNITY.Utilities.InitializeShaderMaterial(r)):BABYLON.Tools.Warn("Non material instantiated class: "+s)}else BABYLON.Tools.Warn("Failed to instantiate material class: "+s)}else BABYLON.Tools.Warn("Failed to locate material class: "+s)}return r}return null},e.prototype.loadAnimationAsync=function(e,t){if(this._parseScene===!0){var n=(this._loader,t);this._babylonScene._blockEntityCollection=!!this._assetContainer;var o=new BABYLON.AnimationGroup(t.name||"animation".concat(n.index),this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n._babylonAnimationGroup=o,this._animationGroups.push(o);var i=new Array;BABYLON.GLTF2.ArrayItem.Assign(n.channels),BABYLON.GLTF2.ArrayItem.Assign(n.samplers);for(var r=0,a=t.channels;r<a.length;r++){var l=a[r],s=l;i.push(this._loader._loadAnimationChannelAsync("".concat(e,"/channels/").concat(s.index),e,t,l,function(e,t){e.animations=e.animations||[],e.animations.push(t),o.addTargetedAnimation(t,e)}))}return Promise.all(i).then(function(){if(null!=t.extras&&null!=t.extras.metadata){var e={};e.unity=t.extras.metadata,o.metadata=e,null!=e.label&&""!==e.label&&(o.name=e.label)}return o.normalize(0),o})}return null},e.prototype._loadMeshPrimitiveAsync=function(e,t,n,o,i,r){var a=this;if(this._parseScene===!0){var l=this._loader;l.logOpen("".concat(e));var s,u=0===l._disableInstancedMesh&&l._parent.createInstances&&void 0==n.skin&&!o.primitives[0].targets,c=void 0;if(u&&i._instanceData)l._babylonScene._blockEntityCollection=!!l._assetContainer,s=i._instanceData.babylonSourceMesh.createInstance(t),s._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1,c=i._instanceData.promise;else{var d=new Array;l._babylonScene._blockEntityCollection=!!l._assetContainer;var p=new BABYLON.Mesh(t,l._babylonScene);p._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1,this._leftHanded===!0?p.overrideMaterialSideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:p.overrideMaterialSideOrientation=l._babylonScene.useRightHandedSystem?BABYLON.Material.CounterClockWiseSideOrientation:BABYLON.Material.ClockWiseSideOrientation,l._createMorphTargets(e,n,o,i,p),d.push(l._loadVertexDataAsync(e,i,p).then(function(t){return l._loadMorphTargetsAsync(e,i,p,t).then(function(){l._disposed||(l._babylonScene._blockEntityCollection=!!l._assetContainer,t.applyToMesh(p),a._setupBabylonMesh(p,n,o,i),t._parentContainer=l._assetContainer,l._babylonScene._blockEntityCollection=!1)})}));var h=BABYLON.GLTF2.GLTFLoader._GetDrawMode(e,i.mode);if(null!=i.extras&&null!=i.extras.metadata&&null!=i.extras.metadata.multimaterial&&null!=i.extras.metadata.submeshes)this._setupBabylonMaterials(e,d,h,p,o,i);else if(void 0==i.material){var m=l._defaultBabylonMaterialData[h];m||(m=l._createDefaultMaterial("__GLTFLoader._default",h),l._parent.onMaterialLoadedObservable.notifyObservers(m),l._defaultBabylonMaterialData[h]=m),p.material=m}else if(!l.parent.skipMaterials){var f=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),l._gltf.materials,i.material);d.push(l._loadMaterialAsync("/materials/".concat(f.index),f,p,h,function(e){p.material=e}))}c=Promise.all(d),u&&(i._instanceData={babylonSourceMesh:p,promise:c}),s=p}return BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(s,e),l._parent.onMeshLoadedObservable.notifyObservers(s),r(s),l.logClose(),c.then(function(){return s})}return null},e.prototype._setupBabylonMesh=function(e,t,n,o){if(this._parseScene===!0){this._loader;if(null!=o.extras&&null!=o.extras.metadata&&null!=o.extras.metadata.multimaterial&&null!=o.extras.metadata.submeshes){var i=o.extras.metadata.submeshes;e.subMeshes=[];for(var r=0;r<i.length;r++){var a=i[r];BABYLON.SubMesh.AddToMesh(a.materialIndex,a.verticesStart,a.verticesCount,a.indexStart,a.indexCount,e)}}e.computeWorldMatrix(!0)}},e.prototype._setupBabylonMaterials=function(e,t,n,o,i,r){if(this._parseScene===!0){var a=this._loader,l=r.extras.metadata.multimaterial,s=l.materials,u=[],c=l.id||"MM_"+i.name,d=l.name||"MM_"+i.name,p=new BABYLON.MultiMaterial("["+d+"]",a._babylonScene);p.id=c,s.forEach(function(t){if(null!=t){var n=parseInt(t);if(n>=0){var i=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),a._gltf.materials,n);u.push(i)}else console.warn("Invalid Submesh Material Index Encountered For: "+o.name)}else console.warn("Null Submesh Material Encountered For: "+o.name)}),t.push(this._parseMultiMaterialAsync("/materials/".concat(d),u,o,n,function(e){p.subMaterials=e,o.material=p}))}},e.prototype._processLevelOfDetail=function(e,t){null!=t&&t.length>0&&t.forEach(function(e){if(null!=e.metadata&&null!=e.metadata.unity&&null!=e.metadata.unity.lods&&null!=e.metadata.unity.distances){var t=e.metadata.unity,n=t.lods,o=t.distances;if(o.length>=n.length){var i=null,r=null;if(n.forEach(function(t,n){var o="*"===t?e:SM.FindChildTransformNode(e,t,UNITY.SearchType.ExactMatch,!1);null!=o&&o instanceof BABYLON.AbstractMesh&&(0===n?i=o:(null==r&&(r=[]),r.push(o)))}),null!=i)if(i instanceof BABYLON.Mesh){var a=o.length>0?o[o.length-1]:0;a>=1/0&&(a=0),null!=r&&r.forEach(function(e,t){i.addLODLevel(o[t],e)}),a>0&&i.addLODLevel(a,null)}else i instanceof BABYLON.InstancedMesh&&null!=r&&r.forEach(function(t,n){try{t.dispose()}catch(o){}BABYLON.Tools.Warn("Destroyed Unused Level Detail: "+t.name+" --> For Transform: "+e.name)})}}})},e.prototype._processShaderMaterials=function(e,t){null!=t&&t.length>0&&t.forEach(function(e){e.freeze()})},e.prototype.preProcessSceneProperties=function(e,t){if(this._assetContainer!==!0&&this._sceneParsed===!1&&null!=e.extras&&null!=e.extras.metadata&&null!=e.extras.metadata.properties&&e.extras.metadata.properties===!0){this._sceneParsed=!0;var n=null!=this._rootUrl?this._rootUrl:"/",o=e.extras.metadata;if(null==t.metadata&&(t.metadata={}),null==t.metadata.unity&&(t.metadata.unity={}),t.metadata.unity=o,this._disposeRoot=null!=o.disposeroot&&o.disposeroot===!0,this._hideLoader=null!=o.hideloader&&o.hideloader===!0,this._preWarmTime=null!=o.prewarmup?o.prewarmup:0,UNITY.SceneManager.SetRootUrl(t,n),UNITY.SceneManager.SetSceneFile(t,this._fileName),UNITY.SceneManager.EnableUserInput=!0,UNITY.SceneManager.GlobalOptions.ktxtextures=null!=o.ktxtextures&&o.ktxtextures,UNITY.SceneManager.GlobalOptions.ktxlightmaps=null!=o.ktxlightmaps&&o.ktxlightmaps,UNITY.SceneManager.GlobalOptions.intensityFactor=null!=o.intensity?o.intensity:1,UNITY.SceneManager.GlobalOptions.debugModeEnabled=null!=o.debugging&&o.debugging,UNITY.SceneManager.GlobalOptions.showDebugColliders=null!=o.showdebugcolliders&&o.showdebugcolliders,UNITY.SceneManager.GlobalOptions.colliderVisibility=null!=o.collidervisibility?o.collidervisibility:0,UNITY.SceneManager.GlobalOptions.colliderRenderGroup=null!=o.colliderrendergroup?o.colliderrendergroup:0,UNITY.SceneManager.GlobalOptions.defaultRenderGroup=null!=o.defaultrendergroup?o.defaultrendergroup:0,UNITY.SceneManager.GlobalOptions.collisionWireframe=null!=o.collisionwireframe&&o.collisionwireframe,UNITY.SceneManager.GlobalOptions.useTriangleNormals=null!=o.trianglenormals&&o.trianglenormals,UNITY.SceneManager.GlobalOptions.useConvexTriangles=null==o.convextriangles||o.convextriangles,UNITY.SceneManager.GlobalOptions.colliderInstances=null==o.colliderinstances||o.colliderinstances,UNITY.SceneManager.GlobalOptions.reparentColliders=null==o.reparentcolliders||o.reparentcolliders,null!=o.clearcolor&&(t.clearColor=UNITY.Utilities.ParseColor4(o.clearcolor)),null!=o.autoclear&&o.autoclear===!0&&(t.autoClear=!0,t.autoClearDepthAndStencil=!0),null!=o.rendergroups&&(BABYLON.RenderingManager.MAX_RENDERINGGROUPS=o.rendergroups),null!=o.imageprocessing){var i=o.imageprocessing,r=null!=i.contrast?i.contrast:1,a=null!=i.exposure?i.exposure:1;null!=t.imageProcessingConfiguration&&(t.imageProcessingConfiguration.contrast=r,t.imageProcessingConfiguration.exposure=a)}var l=UNITY.SceneManager.AmbientLightIntensity;if(null!=o.ambientcoloring&&(t.ambientColor=UNITY.Utilities.ParseColor3(o.ambientcoloring)),null!=o.ambientlighting&&o.ambientlighting>0){var s=t;null==s._AmbientLight&&(s._AmbientLight=new BABYLON.HemisphericLight("Ambient Lighting",new BABYLON.Vector3(0,1,0),t),s._AmbientLight.falloffType=BABYLON.Light.FALLOFF_STANDARD,s._AmbientLight.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT),null!=s._AmbientLight&&(null!=o.ambientskycolor&&(s._AmbientLight.diffuse=UNITY.Utilities.ParseColor3(o.ambientskycolor,BABYLON.Color3.Gray())),null!=o.ambientspecularcolor&&(s._AmbientLight.specular=UNITY.Utilities.ParseColor3(o.ambientspecularcolor,BABYLON.Color3.White())),null!=o.ambientgroundcolor&&(s._AmbientLight.groundColor=UNITY.Utilities.ParseColor3(o.ambientgroundcolor,BABYLON.Color3.Gray())),null!=o.ambientlightintensity&&(s._AmbientLight.intensity=o.ambientlightintensity),s._AmbientLight.intensity*=l)}if(null!=o.fogmode){var u=o.fogmode;if(u>0){t.fogMode=u,t.fogEnabled=!0;var c=1;1===u?c=.5:2===u&&(c=.75),null!=o.fogdensity&&(t.fogDensity=o.fogdensity*c),null!=o.fogstart&&(t.fogStart=o.fogstart),null!=o.fogend&&(t.fogEnd=o.fogend),null!=o.fogcolor&&(t.fogColor=UNITY.Utilities.ParseColor3(o.fogcolor))}}var d=new BABYLON.Vector3(0,(-9.81),0),p=null!=o.defaultgravity?UNITY.Utilities.ParseVector3(o.defaultgravity,d):d;if(t.gravity=p.clone(),t.collisionsEnabled=!0,null!=o.enablephysics){var h=o.enablephysics;if(h===!0){var m=null==o.ccdenabled||o.ccdenabled,f=null!=o.ccdpenetration?o.ccdpenetration:1e-4,g=null!=o.subtimestep?o.subtimestep:0,y=null!=o.maxworldsweep?o.maxworldsweep:0,v=null==o.deltaworldstep||o.deltaworldstep;UNITY.RigidbodyPhysics.ConfigurePhysicsEngine(t,v,g,y,m,f,p)}}if(null!=o.userinput){var _=o.userinput;UNITY.UserInputOptions.KeyboardSmoothing=_.keyboardSmoothing,UNITY.UserInputOptions.KeyboardMoveSensibility=_.keyboardSensitivity,UNITY.UserInputOptions.KeyboardMoveDeadZone=_.keyboardDeadZone,UNITY.UserInputOptions.GamepadDeadStickValue=_.padDeadStick,UNITY.UserInputOptions.GamepadLStickXInverted=_.padLStickXInvert,UNITY.UserInputOptions.GamepadLStickYInverted=_.padLStickYInvert,UNITY.UserInputOptions.GamepadRStickXInverted=_.padRStickXInvert,UNITY.UserInputOptions.GamepadRStickYInverted=_.padRStickYInvert,UNITY.UserInputOptions.GamepadLStickSensibility=_.padLStickLevel,UNITY.UserInputOptions.GamepadRStickSensibility=_.padRStickLevel,UNITY.UserInputOptions.SupportedInputDevices=_.supportedDevices,UNITY.UserInputOptions.PointerAngularSensibility=_.mouseSensitivity,UNITY.UserInputOptions.PointerWheelDeadZone=_.wheelDeadZone,UNITY.UserInputOptions.PointerMouseDeadZone=_.mouseDeadZone,UNITY.UserInputOptions.PointerMouseInverted=_.mouseMoveInvert,UNITY.UserInputOptions.UseCanvasElement=_.useCanvasElement,UNITY.UserInputOptions.UseArrowKeyRotation=_.arrowKeyRotation}if(null!=o.enableinput){var B=o.enableinput;if(B===!0){var b=null==o.contextmenu||o.contextmenu,C=null!=o.pointerlock&&o.pointerlock,T=null!=o.preventdefault&&o.preventdefault,I=null!=o.usecapture&&o.usecapture,S={contextMenu:b,pointerLock:C,preventDefault:T,useCapture:I};UNITY.InputController.ConfigureUserInput(t,S)}}null!=o.freezeactivemeshes&&o.freezeactivemeshes===!0&&(this._activeMeshes=!0),null!=o.performancepriority&&(t.performancePriority=o.performancepriority)}},e.prototype.postProcessSceneProperties=function(e,t,n){var o=this;if(this._assetContainer!==!0&&null!=t.extras&&null!=t.extras.metadata&&null!=t.extras.metadata.properties&&t.extras.metadata.properties===!0){var i=t.extras.metadata;if(null!=i.skybox){var r=i.skybox,a=null!=r.skyfog&&r.skyfog,l=null!=r.skytags?r.skytags:"Untagged",s=null!=r.skysize?r.skysize:1e3,u=null!=r.rotation?r.rotation:0,c=null!=r.basename&&""!==r.basename?e+r.basename:null,d=null!=r.skyfaces?r.skyfaces:null,p=null!=r.rendergroup?r.rendergroup:0,h=null!=r.extensions&&r.extensions.length>0?r.extensions:null,m=null!=r.polynomial?r.polynomial:1;try{if(null!=d&&""!==d&&null!=c&&""!==c){var f=null;if("png"===d)f=new BABYLON.CubeTexture(c,n,h),c.indexOf("_rgbd")>=0?(f.isRGBD=!0,f.gammaSpace=!1):(f.isRGBD=!1,f.gammaSpace=!0);else if("jpg"===d)f=new BABYLON.CubeTexture(c,n,h),f.isRGBD=!1,f.gammaSpace=!0;else if("ktx2"===d)f=new BABYLON.CubeTexture(c,n,h),f.isRGBD=!1,f.gammaSpace=!0;else{var g=!0,y=c+"."+d;f=new BABYLON.CubeTexture(y,n,null,(!0),null,null,null,null,g),f.gammaSpace=!1}f.name=r.basename,f.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,f.rotationY=BABYLON.Tools.ToRadians(u);var v="Default Skybox",_=BABYLON.MeshBuilder.CreateBox(v,{size:s},n);_.renderingGroupId=UNITY.Utilities.DefaultRenderGroup(),_.id=v,_.infiniteDistance=!0,_.applyFog=a,_.renderingGroupId=p,null!=l&&""!==l&&BABYLON.Tags.AddTagsTo(_,l),n.useRightHandedSystem===!0&&(_.scaling.x*=-1);var B=new BABYLON.StandardMaterial("Skybox-Material",n);B.backFaceCulling=!1,B.disableLighting=!0,B.diffuseColor=new BABYLON.Color3(0,0,0),B.emissiveColor=new BABYLON.Color3(0,0,0),B.specularColor=new BABYLON.Color3(0,0,0),B.ambientColor=new BABYLON.Color3(0,0,0),B.reflectionTexture=f,_.material=B}}catch(b){console.warn(b)}if(null!=r.environment){var C=r.environment;n.environmentIntensity=null!=C.level?BABYLON.Scalar.Clamp(C.level,0,10):1;var T=null!=C.info&&""!==C.info?C.info:null;if(null!=T&&""!==T)try{var I=UNITY.SceneManager.GetRootUrl(n),S=I+T.rooturl,A=S+T.name;if(null!=this._assetsManager){var O=this._assetsManager.addBinaryFileTask("Global.EnvironmentTextureTask",A);O.onSuccess=function(e){if(null!=e.data){var t=new Blob([e.data]),n=o._babylonScene,i=URL.createObjectURL(t),r=function(){URL.revokeObjectURL(i)},a=new BABYLON.CubeTexture(i,n,null,null,null,r,r,null,(!0),".dds");n.environmentTexture=a,n.environmentTexture.name="assets/"+T.name,null!=n.environmentTexture&&null!=n.environmentTexture.sphericalPolynomial&&(n.isReady()?n.environmentTexture.sphericalPolynomial.scaleInPlace(m):n.onReadyObservable.addOnce(function(){n.environmentTexture.sphericalPolynomial.scaleInPlace(m)}))}else console.error("Failed to load environment texture task: "+A)},O.onError=function(e,t,n){console.error(t,n)}}}catch(x){console.warn(x)}}}if(null!=i.navigation&&null!=i.navigation.prebaked&&""!==i.navigation.prebaked){var M=null!=i.navigation.collision&&i.navigation.collision===!0,N=null!=i.navigation.showdebug&&i.navigation.showdebug===!0,L=null!=i.navigation.debugcolor?i.navigation.debugcolor:[.05,.225,.75],w=new BABYLON.Color3(L[0],L[1],L[2]),P=null!=i.navigation.timesteps?i.navigation.timesteps:0;if(null!=this._assetsManager){var U=i.navigation.prebaked,R=this._assetsManager.addBinaryFileTask("System.NavigationMeshTask",U);R.onSuccess=function(e){if(null!=e.data){var t=new Uint8Array(e.data);UNITY.SceneManager.LoadNavigationMesh(n,t,N,w,P,M)}else console.error("Failed to load navigation mesh task: "+U)},R.onError=function(e,t,n){console.error(t,n)}}}}},e.prototype._preloadRawMaterialsAsync=function(e,t,n){var o=this._loader,i=new Array,r=BABYLON.Material.TriangleFillMode;return n.forEach(function(n){var a=BABYLON.GLTF2.ArrayItem.Get("".concat(e,"/material"),t,n);if(null!=a){var l=o.createMaterial(e,a,r);BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(l,e),o._parent.onMaterialLoadedObservable.notifyObservers(l),i.push(o.loadMaterialPropertiesAsync(e,a,l))}}),Promise.all(i).then(function(){})},e.prototype._parseMultiMaterialAsync=function(e,t,n,o,i){var r=this;void 0===i&&(i=function(){});var a=this._loader,l=t;l._data=l._data||{};var s=l._data[o];if(!s){a.logOpen("".concat(e," ").concat(n.name||""));var u=[],c=new Array;t.forEach(function(t){var n=null;if(t.index){var i=t.index;i>=0&&(n=r._getCachedMaterialByIndex(i))}null==n&&(n=a.createMaterial(e,t,o),BABYLON.GLTF2.GLTFLoader.AddPointerMetadata(n,e),a._parent.onMaterialLoadedObservable.notifyObservers(n),c.push(a.loadMaterialPropertiesAsync(e,t,n))),u.push(n)}),s={babylonMaterials:u,babylonMeshes:[],promises:c},l._data[o]=s,a.logClose()}return s.babylonMeshes.push(n),n.onDisposeObservable.addOnce(function(){var e=s.babylonMeshes.indexOf(n);e!==-1&&s.babylonMeshes.splice(e,1)}),i(s.babylonMaterials),Promise.all(s.promises).then(function(){return s.babylonMaterials})},e.prototype._parseNodeMaterialPropertiesAsync=function(e,t,n){var o=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,i=n,r=new Array;i.backFaceCulling=null==o||null==o.backFaceCulling||o.backFaceCulling,t.doubleSided&&(i.backFaceCulling=!1);var a=1;if(t.pbrMetallicRoughness){var l=t.pbrMetallicRoughness;if(l){if(l.baseColorFactor){var s=BABYLON.Color4.FromArray(l.baseColorFactor);i.setVector4("_Color",new BABYLON.Vector4(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2),s.a)),a=s.a}else i.setVector4("_Color",new BABYLON.Vector4(1,1,1,1));l.baseColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),l.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)");var t=e;t.level=null!=o&&null!=o.diffuseIntensity?o.diffuseIntensity:1,i.setTexture("_MainTex",t)}))}}if(t.normalTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)");var o=e;void 0!=t.normalTexture.scale&&(o.level=t.normalTexture.scale),i.setTexture("_BumpMap",o)})),t.occlusionTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)");var o=e;void 0!=t.occlusionTexture.strength&&(o.level=t.occlusionTexture.strength),i.setTexture("_OcclusionMap",o)})),t.emissiveFactor){var u=BABYLON.Color4.FromArray(t.emissiveFactor);(u.r>0||u.g>0||u.b>0)&&i.setVector4("_EmissionColor",new BABYLON.Vector4(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2),u.a))}if(t.emissiveTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)");var t=e;i.setTexture("_EmissionMap",t)})),null!=o){if(i.wireframe=null!=o.useWireframe&&o.useWireframe,i.needDepthPrePass=null!=o.depthPrepass&&o.depthPrepass,o.customTextures){var c=function(t){var a=o.customTextures[t];null!=a&&r.push(d._loader.loadTextureInfoAsync(e+"/"+t,a,function(e){"detailsSampler"===t||"normalsSampler"===t?e.name="".concat(n.name," (Atlas)"):e.name="".concat(n.name," (Custom)"),i.setTexture(t,e)}))},d=this;for(var p in o.customTextures)c(p)}if(o.customVectors)for(var h in o.customVectors){var m=o.customVectors[h];null!=m&&i.setVector4(h,BABYLON.Vector4.FromArray(m))}if(o.customColors)for(var f in o.customColors){var g=o.customColors[f];null!=g&&i.setVector4(f,BABYLON.Vector4.FromArray(g))}if(o.customFloats)for(var y in o.customFloats){var v=o.customFloats[y];null!=v&&i.setFloat(y,v)}null!=o.freezeMaterial&&o.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(i)}var _=Promise.all(r).then(function(){});return i.compile(),_},e.prototype._parseShaderMaterialPropertiesAsync=function(e,t,n){var o=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,i=n,r=new Array;i.backFaceCulling=null==o||null==o.backFaceCulling||o.backFaceCulling,t.doubleSided&&(i.backFaceCulling=!1),UNITY.Utilities.HasOwnProperty(i,"ambientColor")&&(i.ambientColor=null!=o&&o.ambientColorFactor?BABYLON.Color3.FromArray(o.ambientColorFactor):BABYLON.Color3.Black());var a=1;if(t.pbrMetallicRoughness){var l=t.pbrMetallicRoughness;if(l){if(l.baseColorFactor){var s=BABYLON.Color4.FromArray(l.baseColorFactor);i.setVector4("diffuseColor",new BABYLON.Vector4(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2),s.a)),a=s.a}else i.setVector4("diffuseColor",new BABYLON.Vector4(1,1,1,1));l.baseColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),l.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)");var t=e;t.level=null!=o&&null!=o.diffuseIntensity?o.diffuseIntensity:1,i.setTexture("diffuseTexture",t)}))}}if(t.normalTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)");var o=e;void 0!=t.normalTexture.scale&&(o.level=t.normalTexture.scale),i.setTexture("bumpTexture",o)})),t.occlusionTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)");var o=e;void 0!=t.occlusionTexture.strength&&(o.level=t.occlusionTexture.strength),i.setTexture("ambientTexture",o)})),t.emissiveFactor){var u=BABYLON.Color4.FromArray(t.emissiveFactor);(u.r>0||u.g>0||u.b>0)&&i.setVector4("emissiveColor",new BABYLON.Vector4(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2),u.a))}t.emissiveTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)");var t=e;i.setTexture("emissiveTexture",t)})),i.alpha=a;var c=t.alphaMode||"OPAQUE";switch(c){case"OPAQUE":i.alpha=1,i.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_OPAQUE;break;case"MASK":i.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHATEST;break;case"BLEND":i.transparencyMode=BABYLON.ShaderMaterial.MATERIAL_ALPHABLEND;break;default:throw new Error("".concat(e,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}if(null!=o){if(i.wireframe=null!=o.useWireframe&&o.useWireframe,i.needDepthPrePass=null!=o.depthPrepass&&o.depthPrepass,o.customTextures){var d=function(t){var a=o.customTextures[t];null!=a&&r.push(p._loader.loadTextureInfoAsync(e+"/"+t,a,function(e){"detailsSampler"===t||"normalsSampler"===t?e.name="".concat(n.name," (Atlas)"):e.name="".concat(n.name," (Custom)"),i.setTexture(t,e)}))},p=this;for(var h in o.customTextures)d(h)}if(o.customVectors)for(var m in o.customVectors){var f=o.customVectors[m];null!=f&&i.setVector4(m,BABYLON.Vector4.FromArray(f))}if(o.customColors)for(var g in o.customColors){var y=o.customColors[g];null!=y&&i.setVector4(g,BABYLON.Vector4.FromArray(y))}if(o.customFloats)for(var v in o.customFloats){var _=o.customFloats[v];null!=_&&i.setFloat(v,_)}null!=o.freezeMaterial&&o.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(i);
}return Promise.all(r).then(function(){})},e.prototype._parseDiffuseMaterialPropertiesAsync=function(e,t,n){var o=null!=t.extras&&null!=t.extras.metadata?t.extras.metadata:null,i=n,r=new Array;UNITY.Utilities.HasOwnProperty(i,"ambientColor")&&(i.ambientColor=null!=o&&o.ambientColorFactor?BABYLON.Color3.FromArray(o.ambientColorFactor):BABYLON.Color3.Black()),UNITY.Utilities.HasOwnProperty(i,"backFaceCulling")&&(i.backFaceCulling=null==o||null==o.backFaceCulling||o.backFaceCulling),t.doubleSided&&(UNITY.Utilities.HasOwnProperty(i,"twoSidedLighting")&&(i.twoSidedLighting=!0),UNITY.Utilities.HasOwnProperty(i,"backFaceCulling")&&(i.backFaceCulling=!1));var a=1;if(t.pbrMetallicRoughness){var l=t.pbrMetallicRoughness;if(l){if(UNITY.Utilities.HasOwnProperty(i,"diffuseColor"))if(l.baseColorFactor){var s=BABYLON.Color4.FromArray(l.baseColorFactor);i.diffuseColor=new BABYLON.Color3(Math.pow(s.r,1/2.2),Math.pow(s.g,1/2.2),Math.pow(s.b,1/2.2)),a=s.a}else i.diffuseColor=BABYLON.Color3.White();UNITY.Utilities.HasOwnProperty(i,"diffuseTexture")&&l.baseColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),l.baseColorTexture,function(e){e.name="".concat(n.name," (Base Color)"),i.diffuseTexture=e,i.diffuseTexture.level=null!=o&&null!=o.diffuseIntensity?o.diffuseIntensity:1}))}}if(UNITY.Utilities.HasOwnProperty(i,"bumpTexture")&&t.normalTexture&&(r.push(this._loader.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(e){e.name="".concat(n.name," (Normal)"),i.bumpTexture=e,void 0!=t.normalTexture.scale&&(i.bumpTexture.level=t.normalTexture.scale)})),UNITY.Utilities.HasOwnProperty(i,"invertNormalMapX")&&(i.invertNormalMapX=!this._loader.babylonScene.useRightHandedSystem),UNITY.Utilities.HasOwnProperty(i,"invertNormalMapY")&&(i.invertNormalMapY=this._loader.babylonScene.useRightHandedSystem)),UNITY.Utilities.HasOwnProperty(i,"ambientTexture")&&t.occlusionTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(e){e.name="".concat(n.name," (Occlusion)"),i.ambientTexture=e,void 0!=t.occlusionTexture.strength&&(i.ambientTexture.level=t.occlusionTexture.strength)})),UNITY.Utilities.HasOwnProperty(i,"emissiveColor")){var u=t.emissiveFactor?BABYLON.Color4.FromArray(t.emissiveFactor):new BABYLON.Color4(0,0,0,1);i.emissiveColor=new BABYLON.Color3(Math.pow(u.r,1/2.2),Math.pow(u.g,1/2.2),Math.pow(u.b,1/2.2))}UNITY.Utilities.HasOwnProperty(i,"emissiveTexture")&&t.emissiveTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(e){e.name="".concat(n.name," (Emissive)"),i.emissiveTexture=e,UNITY.Utilities.HasOwnProperty(i,"useEmissiveAsIllumination")&&(i.useEmissiveAsIllumination=null!=o&&null!=o.useEmissiveAsIllumination&&o.useEmissiveAsIllumination)})),UNITY.Utilities.HasOwnProperty(i,"alpha")&&(i.alpha=a);var c=t.alphaMode||"OPAQUE";switch(c){case"OPAQUE":UNITY.Utilities.HasOwnProperty(i,"alpha")&&(i.alpha=1);break;case"MASK":i.alphaCutOff=void 0==t.alphaCutoff?.5:t.alphaCutoff,i.diffuseTexture&&UNITY.Utilities.HasOwnProperty(i,"diffuseTexture")&&(i.diffuseTexture.hasAlpha=!0);break;case"BLEND":i.diffuseTexture&&(UNITY.Utilities.HasOwnProperty(i,"diffuseTexture")&&(i.diffuseTexture.hasAlpha=!0),UNITY.Utilities.HasOwnProperty(i,"useAlphaFromDiffuseTexture")&&(i.useAlphaFromDiffuseTexture=!0));break;default:throw new Error("".concat(e,"/AlphaMode: Invalid value (").concat(t.alphaMode,")"))}return this._parseCommonConstantProperties(r,e,t,n),Promise.all(r).then(function(){})},e.prototype._parseCommonConstantProperties=function(e,t,n,o){var i=this,r=null!=n.extras&&null!=n.extras.metadata?n.extras.metadata:null;if(null!=r){var a=o;if(UNITY.Utilities.HasOwnProperty(a,"alphaMode")&&(a.alphaMode=null!=r&&r.alphaMode?r.alphaMode:BABYLON.Engine.ALPHA_COMBINE),UNITY.Utilities.HasOwnProperty(a,"ambientColor")&&(a.ambientColor=null!=r&&r.ambientColorFactor?BABYLON.Color3.FromArray(r.ambientColorFactor):BABYLON.Color3.Black()),UNITY.Utilities.HasOwnProperty(a,"backFaceCulling")&&(a.backFaceCulling=null==r||null==r.backFaceCulling||r.backFaceCulling),o instanceof BABYLON.PBRMaterial&&(o.useMetallnessFromMetallicTextureBlue=!0,o.useRoughnessFromMetallicTextureGreen=!0,o.useRoughnessFromMetallicTextureAlpha=!1,o.useAmbientOcclusionFromMetallicTextureRed=!1,o.directIntensity=null!=r.directIntensity?r.directIntensity:1,o.specularIntensity=null!=r.specularIntensity?r.specularIntensity:1,o.emissiveIntensity=null!=r.emissiveIntensity?r.emissiveIntensity:1,o.environmentIntensity=null!=r.environmentIntensity?r.environmentIntensity:1,o.indexOfRefraction=null!=r.indexOfRefraction?r.indexOfRefraction:1.5,null!=r.useAlphaFromAlbedoTexture&&(o.useAlphaFromAlbedoTexture=r.useAlphaFromAlbedoTexture),null!=r.parallaxBias&&r.parallaxBias>0&&(o.useParallax=!0,o.parallaxScaleBias=.9*r.parallaxBias,o.useParallaxOcclusion=null==r.parallaxOcclusion||r.parallaxOcclusion,o.useParallaxOcclusion===!0&&(o.parallaxScaleBias*=.5))),UNITY.Utilities.HasOwnProperty(a,"unlit")&&(a.unlit=null!=r.unlitMaterial&&r.unlitMaterial),UNITY.Utilities.HasOwnProperty(a,"wireframe")&&(a.wireframe=null!=r.useWireframe&&r.useWireframe),UNITY.Utilities.HasOwnProperty(a,"disableLighting")&&(a.disableLighting=null!=r.disableLighting&&r.disableLighting),UNITY.Utilities.HasOwnProperty(a,"maxSimultaneousLights")&&(a.maxSimultaneousLights=null!=r.maxSimultaneousLights?r.maxSimultaneousLights:4),UNITY.Utilities.HasOwnProperty(a,"needDepthPrePass")&&(a.needDepthPrePass=null!=r.depthPrepass&&r.depthPrepass),UNITY.Utilities.HasOwnProperty(a,"lightmapTexture")&&r.lightmapTexture){r.lightmapTexture.nonColorData=!0;var l=!0;UNITY.Utilities.HasOwnProperty(a,"useLightmapAsShadowmap")&&(l=null==r.useLightmapAsShadowmap||r.useLightmapAsShadowmap);var s=null,u=null!=r.lightmapTexture.index?r.lightmapTexture.index:-1;u>=0&&(s=this._getCachedLightmapByIndex(u)),null!=s?(a.lightmapTexture=s,a.useLightmapAsShadowmap=l,UNITY.Utilities.HasOwnProperty(a,"ambientColor")&&(a.ambientColor=BABYLON.Color3.White())):e.push(this._loader.loadTextureInfoAsync(t+"/lightmapTexture",r.lightmapTexture,function(e){e.name="assets/LightmapTexture-".concat(u),e.level=r.lightmapLevel?r.lightmapLevel:1;var t=e,n=null!=UNITY.SceneManager.GlobalOptions.ktxlightmaps&&UNITY.SceneManager.GlobalOptions.ktxlightmaps===!0;n===!0?e.gammaSpace=!0:(e.gammaSpace=!1,t.onLoadObservable.addOnce(function(){t.isReady()?t.isRGBD=!0:BABYLON.Tools.Warn("Failed to register texture as RGBD: "+t.name)})),a.lightmapTexture=e,u>=0&&null!=i._lightmapMap&&(i._lightmapMap.has(u)||i._lightmapMap.set(u,t)),a.useLightmapAsShadowmap=l,UNITY.Utilities.HasOwnProperty(a,"ambientColor")&&(a.ambientColor=BABYLON.Color3.White())}))}o instanceof BABYLON.PBRMaterial&&r.detailMapTexture&&e.push(this._loader.loadTextureInfoAsync(t+"/detailMapTexture",r.detailMapTexture,function(e){e.name="".concat(o.name," (Detail Map)"),e.level=1,o.detailMap.texture=e,o.detailMap.bumpLevel=r.detailBumpLevel?r.detailBumpLevel:1,o.detailMap.diffuseBlendLevel=r.detailBlendLevel?r.detailBlendLevel:.75,o.detailMap.roughnessBlendLevel=r.detailRoughLevel?r.detailRoughLevel:.5,o.detailMap.isEnabled=!0}));var c=UNITY.SceneManager.GetRenderQuality(),d=c===UNITY.RenderQuality.High||c===UNITY.RenderQuality.Medium;if(d===!0&&UNITY.Utilities.HasOwnProperty(a,"reflectionColor")&&(a.reflectionColor=null!=r&&r.reflectionColorFactor?BABYLON.Color3.FromArray(r.reflectionColorFactor):BABYLON.Color3.White()),d===!0&&UNITY.Utilities.HasOwnProperty(a,"reflectionTexture")&&r.reflectionCubemapInfo){var p=this._loader._rootUrl,h=(p+r.reflectionCubemapInfo.rooturl+r.reflectionCubemapInfo.name).toLowerCase(),m=h.lastIndexOf("."),f=m>-1?h.substring(m).toLowerCase():"",g=!0,y=new CubeTextureLoader;y.name="assets/"+r.reflectionCubemapInfo.name,y.mapkey=h,y.material=a,y.extension=f,y.prefiltered=g,r.reflectionCubemapInfo.boundingBoxSize&&(y.boundingBoxSize=BABYLON.Vector3.FromArray(r.reflectionCubemapInfo.boundingBoxSize),y.name+=" ("+y.boundingBoxSize.x.toString()+" "+y.boundingBoxSize.y.toString()+" "+y.boundingBoxSize.z.toString()+")",y.mapkey+="_"+y.boundingBoxSize.x.toString()+"_"+y.boundingBoxSize.y.toString()+"_"+y.boundingBoxSize.z.toString()),r.reflectionCubemapInfo.boundingBoxPosition&&(y.boundingBoxPosition=BABYLON.Vector3.FromArray(r.reflectionCubemapInfo.boundingBoxPosition),y.name+=" ("+y.boundingBoxPosition.x.toString()+" "+y.boundingBoxPosition.y.toString()+" "+y.boundingBoxPosition.z.toString()+")",y.mapkey+="_"+y.boundingBoxPosition.x.toString()+"_"+y.boundingBoxPosition.y.toString()+"_"+y.boundingBoxPosition.z.toString());var v=this._reflectionMap[h];null==v?(v=[y],this._reflectionMap[h]=v):v.push(y)}if(UNITY.Utilities.HasOwnProperty(a,"terrainInfo")&&(a.terrainInfo=null!=r.terrainInfo?r.terrainInfo:null),UNITY.Utilities.HasOwnProperty(o,"universalMaterial")){var _=o;if(r.customTextures){var B=function(n){var i=r.customTextures[n];null!=i&&(_.checkSampler(n),e.push(b._loader.loadTextureInfoAsync(t+"/"+n,i,function(e){"detailsSampler"===n||"normalsSampler"===n?e.name="".concat(o.name," (Atlas)"):e.name="".concat(o.name," (Custom)"),_.setTexture(n,e,!0)})))},b=this;for(var C in r.customTextures)B(C)}if(r.customVectors)for(var T in r.customVectors){var I=r.customVectors[T];null!=I&&_.setVector4(T,BABYLON.Vector4.FromArray(I),!0)}if(r.customColors)for(var S in r.customColors){var A=r.customColors[S];null!=A&&_.setVector4(S,BABYLON.Vector4.FromArray(A),!0)}if(r.customFloats)for(var O in r.customFloats){var x=r.customFloats[O];null!=x&&_.setFloat(O,x,!0)}}else{if(r.customTextures){var M=function(n){var i=r.customTextures[n];null!=i&&UNITY.Utilities.HasOwnProperty(a,n)&&e.push(N._loader.loadTextureInfoAsync(t+"/"+n,i,function(e){"detailsSampler"===n||"normalsSampler"===n?e.name="".concat(o.name," (Atlas)"):e.name="".concat(o.name," (Custom)"),a[n]=e}))},N=this;for(var C in r.customTextures)M(C)}if(r.customVectors)for(var T in r.customVectors){var I=r.customVectors[T];null!=I&&UNITY.Utilities.HasOwnProperty(a,T)&&(a[T]=BABYLON.Vector4.FromArray(I))}if(r.customColors)for(var S in r.customColors){var A=r.customColors[S];null!=A&&UNITY.Utilities.HasOwnProperty(a,S)&&(a[S]instanceof BABYLON.Vector4?a[S]=BABYLON.Vector4.FromArray(A):a[S]instanceof BABYLON.Color4?a[S]=BABYLON.Color4.FromArray(A):a[S]=BABYLON.Color3.FromArray(A))}if(r.customFloats)for(var O in r.customFloats){var x=r.customFloats[O];null!=x&&UNITY.Utilities.HasOwnProperty(a,O)&&(a[O]instanceof Boolean?a[O]=x>0:a[O]=x)}}null!=r.freezeMaterial&&r.freezeMaterial===!0&&null!=this._shaderList&&this._shaderList.push(o)}},e.ScriptBundleCache={},e}(),CVTOOLS_babylon_mesh=function(){function e(e){this.name=CVTOOLS_MESH,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_MESH),this.order=101}return e.prototype.dispose=function(){delete this._loader},e}(),CVTOOLS_left_handed=function(){function e(e){this.name=CVTOOLS_HAND,this.enabled=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(CVTOOLS_HAND),this.order=102}return e.prototype.dispose=function(){delete this._loader},e}();BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_NAME,function(e){return new CVTOOLS_unity_metadata(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_MESH,function(e){return new CVTOOLS_babylon_mesh(e)}),BABYLON.GLTF2.GLTFLoader.RegisterExtension(CVTOOLS_HAND,function(e){return new CVTOOLS_left_handed(e)}),BABYLON.SceneLoader.OnPluginActivatedObservable.add(function(e){"gltf"===e.name&&e instanceof BABYLON.GLTFFileLoader&&(e.animationStartMode=UNITY.SceneManager.AnimationStartMode,e.targetFps=UNITY.SceneManager.AnimationTargetFps,e.onSkinLoadedObservable.add(function(e){if(null!=e){try{null!=e.skinnedNode&&(e.skinnedNode.id+=".Skin")}catch(t){console.warn(t)}try{null!=e.skinnedNode&&(e.skinnedNode.name+=".Skin")}catch(n){console.warn(n)}try{if(null!=e.node&&null!=e.skinnedNode){var o=BABYLON.Tags.GetTags(e.node);null!=o&&BABYLON.Tags.AddTagsTo(e.skinnedNode,o),e.node._skinnedMesh=e.skinnedNode}}catch(i){console.warn(i)}}}))});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),UNITY;!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n._looptime=!1,n._loopblend=!1,n._frametime=0,n._layercount=0,n._updatemode=0,n._hasrootmotion=!1,n._animationplaying=!1,n._initialtargetblending=!1,n._hastransformhierarchy=!1,n._leftfeetbottomheight=0,n._rightfeetbottomheight=0,n._runtimecontroller=null,n._executed=!1,n._awakened=!1,n._initialized=!1,n._checkers=new e.TransitionCheck,n._source="",n._machine=null,n._animationmode=0,n._animationrig=null,n._deltaPosition=new BABYLON.Vector3(0,0,0),n._deltaRotation=new BABYLON.Quaternion(0,0,0,0),n._angularVelocity=new BABYLON.Vector3(0,0,0),n._rootMotionSpeed=0,n._lastMotionSpeed=0,n._loopMotionSpeed=0,n._lastRotateSpeed=0,n._loopRotateSpeed=0,n._lastMotionRotation=new BABYLON.Quaternion(0,0,0,0),n._lastMotionPosition=new BABYLON.Vector3(0,0,0),n._positionWeight=!1,n._rootBoneWeight=!1,n._rotationWeight=!1,n._rootQuatWeight=!1,n._rootBoneTransform=null,n._positionHolder=new BABYLON.Vector3(0,0,0),n._rootBoneHolder=new BABYLON.Vector3(0,0,0),n._rotationHolder=new BABYLON.Quaternion(0,0,0,0),n._rootQuatHolder=new BABYLON.Quaternion(0,0,0,0),n._rootMotionMatrix=BABYLON.Matrix.Zero(),n._rootMotionScaling=new BABYLON.Vector3(0,0,0),n._rootMotionRotation=new BABYLON.Quaternion(0,0,0,0),n._rootMotionPosition=new BABYLON.Vector3(0,0,0),n._dirtyMotionMatrix=null,n._dirtyBlenderMatrix=null,n._targetPosition=new BABYLON.Vector3(0,0,0),n._targetRotation=new BABYLON.Quaternion(0,0,0,0),n._targetScaling=new BABYLON.Vector3(1,1,1),n._updateMatrix=BABYLON.Matrix.Zero(),n._blenderMatrix=BABYLON.Matrix.Zero(),n._blendWeights=new e.BlendingWeights,n._emptyScaling=new BABYLON.Vector3(1,1,1),n._emptyPosition=new BABYLON.Vector3(0,0,0),n._emptyRotation=new BABYLON.Quaternion(0,0,0,0),n._ikFrameEanbled=!1,n._data=new Map,n._anims=new Map,n._clips=null,n._timers=new Map,n._starts=new Map,n._stops=new Map,n._numbers=new Map,n._booleans=new Map,n._triggers=new Map,n._parameters=new Map,n.speedRatio=1,n.delayUpdateUntilReady=!0,n.enableAnimation=!0,n.applyRootMotion=!1,n.onAnimationAwakeObservable=new BABYLON.Observable,n.onAnimationInitObservable=new BABYLON.Observable,n.onAnimationIKObservable=new BABYLON.Observable,n.onAnimationEndObservable=new BABYLON.Observable,n.onAnimationLoopObservable=new BABYLON.Observable,n.onAnimationEventObservable=new BABYLON.Observable,n.onAnimationUpdateObservable=new BABYLON.Observable,n.onAnimationTransitionObservable=new BABYLON.Observable,n.m_zeroVector=new BABYLON.Vector3(0,0,0),n.m_defaultGroup=null,n.m_animationTargets=null,n.m_rotationIdentity=new BABYLON.Quaternion(0,0,0,0),n.sourceAnimationGroups=null,n}return __extends(n,t),n.prototype.awakened=function(){return this._awakened},n.prototype.initialized=function(){return this._initialized},n.prototype.hasRootMotion=function(){return this._hasrootmotion},n.prototype.isFirstFrame=function(){return 0===this._frametime},n.prototype.isLastFrame=function(){return this._frametime>=.985},n.prototype.ikFrameEnabled=function(){return this._ikFrameEanbled},n.prototype.getAnimationTime=function(){return this._frametime},n.prototype.getFrameLoopTime=function(){return this._looptime},n.prototype.getFrameLoopBlend=function(){return this._loopblend},n.prototype.getAnimationPlaying=function(){return this._animationplaying},n.prototype.getRuntimeController=function(){return this._runtimecontroller},n.prototype.getRootBoneTransform=function(){return this._rootBoneTransform},n.prototype.getDeltaRootMotionAngle=function(){return this._angularVelocity.y},n.prototype.getDeltaRootMotionSpeed=function(){return this._rootMotionSpeed},n.prototype.getDeltaRootMotionPosition=function(){return this._deltaPosition},n.prototype.getDeltaRootMotionRotation=function(){return this._deltaRotation},n.prototype.getFixedRootMotionPosition=function(){return null!=this._dirtyMotionMatrix?this._rootMotionPosition:null},n.prototype.getFixedRootMotionRotation=function(){return null!=this._dirtyMotionMatrix?this._rootMotionRotation:null},n.prototype.awake=function(){this.awakeStateMachine()},n.prototype.update=function(){this.updateStateMachine()},n.prototype.destroy=function(){this.destroyStateMachine()},n.prototype.playDefaultAnimation=function(t,n,o){void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=null);var i=!1;if(this._initialized===!0)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>n){var r=this._machine.layers[n],a=null!=r.animationStateMachine?r.animationStateMachine.rate||e.AnimationState.FPS:e.AnimationState.FPS,l=t>0?e.Utilities.ComputeBlendingSpeed(o||a,t):0;this.playCurrentAnimationState(r,r.entry,l),i=!0}else BABYLON.Tools.Warn("No animation state layers on "+this.transform.name);else BABYLON.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return i},n.prototype.playAnimation=function(t,n,o,i){void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=null);var r=!1;if(this._initialized===!0)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>o){var a=this._machine.layers[o],l=null!=a.animationStateMachine?a.animationStateMachine.rate||e.AnimationState.FPS:e.AnimationState.FPS,s=n>0?e.Utilities.ComputeBlendingSpeed(i||l,n):0;this.playCurrentAnimationState(a,t,s),r=!0}else BABYLON.Tools.Warn("No animation state layers on "+this.transform.name);else BABYLON.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return r},n.prototype.stopAnimation=function(e){void 0===e&&(e=0);var t=!1;if(this._initialized===!0)if(null!=this._machine&&null!=this._machine.layers&&this._machine.layers.length>e){var n=this._machine.layers[e];this.stopCurrentAnimationState(n),t=!0}else BABYLON.Tools.Warn("No animation state layers on "+this.transform.name);else BABYLON.Tools.Warn("Animation state machine not initialized for "+this.transform.name);return t},n.prototype.hasBool=function(e){return null!=this._booleans.get(e)},n.prototype.getBool=function(e){return this._booleans.get(e)||!1},n.prototype.setBool=function(e,t){this._booleans.set(e,t)},n.prototype.hasFloat=function(e){return null!=this._numbers.get(e)},n.prototype.getFloat=function(e){return this._numbers.get(e)||0},n.prototype.setFloat=function(e,t){this._numbers.set(e,t)},n.prototype.hasInteger=function(e){return null!=this._numbers.get(e)},n.prototype.getInteger=function(e){return this._numbers.get(e)||0},n.prototype.setInteger=function(e,t){this._numbers.set(e,t)},n.prototype.hasTrigger=function(e){return null!=this._triggers.get(e)},n.prototype.getTrigger=function(e){return this._triggers.get(e)||!1},n.prototype.setTrigger=function(e){this._triggers.set(e,!0)},n.prototype.resetTrigger=function(e){this._triggers.set(e,!1)},n.prototype.setSmoothFloat=function(e,t,n,o){var i=this._timers.get(e)||-1,r=this._starts.get(e)||null,a=this._stops.get(e)||null;if(null!=a&&null!=t&&a!=t&&(i=-1),i<0&&(i=0,r=null,a=null),null==r&&(r=this.getFloat(e)),null==a&&(a=t),i>=0&&null!=r&&null!=a){var l=0;i<n?(l=BABYLON.Scalar.Lerp(r,a,i/n),i+=o):(l=a,i=-1,r=null,a=null),this._numbers.set(e,l)}this._timers.set(e,i),this._starts.set(e,r),this._stops.set(e,a)},n.prototype.setSmoothInteger=function(e,t,n,o){this.setSmoothFloat(e,t,n,o)},n.prototype.resetSmoothProperty=function(e){this._timers["delete"](e),this._starts["delete"](e),this._stops["delete"](e),this._numbers["delete"](e)},n.prototype.getMachineState=function(e){return this._data.get(e)},n.prototype.setMachineState=function(e,t){this._data.set(e,t)},n.prototype.getCurrentState=function(e){return null!=this._machine.layers&&this._machine.layers.length>e?this._machine.layers[e].animationStateMachine:null},n.prototype.getDefaultClips=function(){return this._clips},n.prototype.getDefaultSource=function(){return this._source},n.prototype.fixAnimationGroup=function(e){var t=null;if(null!=this._clips&&this._clips.length>0)for(var n=0;n<this._clips.length;n++){var o=this._clips[n];if(null!=o.clip){var i=("."+o.clip).toLowerCase();if(e.name.toLowerCase().endsWith(i)){null==e.metadata&&(e.metadata={}),null==e.metadata.unity&&(e.metadata.unity=o),e.metadata.unity.source=this._source,t=o;break}}}return t},n.prototype.getAnimationGroup=function(e){return this._anims.get(e)},n.prototype.getAnimationGroups=function(){return this.sourceAnimationGroups},n.prototype.setAnimationGroups=function(e){null==this.transform.metadata&&(this.transform.metadata={}),null==this.transform.metadata.unity&&(this.transform.metadata.unity={}),this.transform.metadata.unity.sourceAnimationGroups=e,this.setupSourceAnimationGroups()},n.prototype.updateAnimationGroups=function(t){var n=this;null!=t&&t.length>0&&(this._anims=new Map,this.m_animationTargets=[],this.m_defaultGroup=null,this.sourceAnimationGroups=null,t.forEach(function(t){var o=!1,i=t;if(null!=i&&null!=i.metadata&&null!=i.metadata.unity&&null!=i.metadata.unity.source&&""!==i.metadata.unity.source&&i.metadata.unity.source===n._source&&(o=!0),o===!0&&null!=i&&null!=i.metadata&&null!=i.metadata.unity&&null!=i.metadata.unity.clip&&""!==i.metadata.unity.clip){try{t.stop()}catch(r){}null==n.sourceAnimationGroups&&(n.sourceAnimationGroups=[]),n.sourceAnimationGroups.push(t),n._anims.set(i.metadata.unity.clip,t),null==n.m_defaultGroup&&(n.m_defaultGroup=t),null!=t.targetedAnimations&&t.targetedAnimations.length>0&&t.targetedAnimations.forEach(function(t){for(var o=-1,i=0;i<n.m_animationTargets.length;i++)if(n.m_animationTargets[i].target===t.target){o=i;break}if(o<0)if(n.m_animationTargets.push(t),null==t.target.metadata&&(t.target.metadata={}),t.target instanceof BABYLON.TransformNode){e.Utilities.ValidateTransformQuaternion(t.target);for(var r=[],a=0;a<n._layercount;a++){var l=new e.AnimationMixer;l.positionBuffer=null,l.rotationBuffer=null,l.scalingBuffer=null,l.originalMatrix=null,l.blendingFactor=0,l.blendingSpeed=0,l.rootPosition=null,l.rootRotation=null,r.push(l)}t.target.metadata.mixer=r}else if(t.target instanceof BABYLON.MorphTarget){for(var s=[],a=0;a<n._layercount;a++){var u=new e.AnimationMixer;u.influenceBuffer=null,s.push(u)}t.target.metadata.mixer=s}})}}))},n.prototype.awakeStateMachine=function(){var t=this;if(e.Utilities.ValidateTransformQuaternion(this.transform),this.m_animationTargets=[],this.m_defaultGroup=null,this.m_rotationIdentity=BABYLON.Quaternion.Identity(),this._source=null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.animator&&""!==this.transform.metadata.unity.animator?this.transform.metadata.unity.animator:null,this._clips=this.getProperty("clips",this._clips),this._machine=this.getProperty("machine",this._machine),this._updatemode=this.getProperty("updatemode",this._updatemode),this._animationrig=this.getProperty("animationrig",this._animationrig),this._animationmode=this.getProperty("animationmode",this._animationmode),this._hasrootmotion=this.getProperty("hasrootmotion",this._hasrootmotion),this._runtimecontroller=this.getProperty("runtimecontroller",this._runtimecontroller),this._hastransformhierarchy=this.getProperty("hastransformhierarchy",this._hastransformhierarchy),this._leftfeetbottomheight=this.getProperty("leftfeetbottomheight",this._leftfeetbottomheight),this._rightfeetbottomheight=this.getProperty("rightfeetbottomheight",this._rightfeetbottomheight),this.applyRootMotion=this.getProperty("applyrootmotion",this.applyRootMotion),null!=this._machine){if(null!=this._machine.owner&&void 0!=this._machine.owner&&""!==this._machine.owner&&"*"!==this._machine.owner||(this._machine.owner=null!=this.transform.parent?this.transform.parent.name:this.transform.name),null!=this._machine.speed&&(this.speedRatio=this._machine.speed),null!=this._machine.parameters&&this._machine.parameters.length>0){var n=this._machine.parameters;n.forEach(function(n){var o=n.name,i=n.type,r=(n.curve,n.defaultFloat),a=n.defaultBool,l=n.defaultInt;t._parameters.set(o,i),i===e.AnimatorParameterType.Bool?t.setBool(o,a):i===e.AnimatorParameterType.Float?t.setFloat(o,r):i===e.AnimatorParameterType.Int?t.setInteger(o,l):i===e.AnimatorParameterType.Trigger&&t.resetTrigger(o)})}null!=this._machine.layers&&this._machine.layers.length>0&&(this._layercount=this._machine.layers.length,this._machine.layers.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this._machine.layers.forEach(function(e){if(null==e.owner||void 0==e.owner||""===e.owner||"*"===e.owner,e.animationMaskMap=new Map,null!=e.avatarMask&&null!=e.avatarMask.transformPaths&&e.avatarMask.transformPaths.length>0)for(var t=0;t<e.avatarMask.transformPaths.length;t++)e.animationMaskMap.set(e.avatarMask.transformPaths[t],t)}))}this._awakened=!0,this.onAnimationAwakeObservable&&this.onAnimationAwakeObservable.hasObservers()&&this.onAnimationAwakeObservable.notifyObservers(this.transform)},n.prototype.updateStateMachine=function(e){var t=this;if(void 0===e&&(e=null),(this.delayUpdateUntilReady===!1||this.delayUpdateUntilReady===!0&&this.isReady())&&(null==this.sourceAnimationGroups&&this.setupSourceAnimationGroups(),null!=this.sourceAnimationGroups&&(this._executed===!1&&(this._executed=!0,null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(e){t.playCurrentAnimationState(e,e.entry,0)}),this._initialized=!0,this.onAnimationInitObservable&&this.onAnimationInitObservable.hasObservers()&&this.onAnimationInitObservable.notifyObservers(this.transform)),this.enableAnimation===!0))){var n=e||this.getDeltaSeconds();this.updateAnimationState(n),this.updateAnimationTargets(n),this.onAnimationUpdateObservable&&this.onAnimationUpdateObservable.hasObservers()&&this.onAnimationUpdateObservable.notifyObservers(this.transform)}},n.prototype.setupSourceAnimationGroups=function(){var e=this,t=null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.sourceAnimationGroups?this.transform.metadata.unity.sourceAnimationGroups:null;null!=t&&(this.updateAnimationGroups(t),null!=this.sourceAnimationGroups&&null!=this._machine&&null!=this._machine.states&&this._machine.states.length>0&&this._machine.states.forEach(function(t){null!=t&&null!=t.name&&(null!=t.ccurves&&t.ccurves.length>0&&t.ccurves.forEach(function(e){if(null!=e.animation){var n=BABYLON.Animation.Parse(e.animation);null!=n&&(null==t.tcurves&&(t.tcurves=[]),t.tcurves.push(n))}}),e.setupTreeBranches(t.blendtree),e.setMachineState(t.name,t))}))},n.prototype.destroyStateMachine=function(){this._data=null,this._clips=null,this._anims=null,this._numbers=null,this._booleans=null,this._triggers=null,this._parameters=null,this._checkers=null,this._machine=null,this.sourceAnimationGroups=null,this.onAnimationAwakeObservable.clear(),this.onAnimationAwakeObservable=null,this.onAnimationInitObservable.clear(),this.onAnimationInitObservable=null,this.onAnimationIKObservable.clear(),this.onAnimationIKObservable=null,this.onAnimationEndObservable.clear(),this.onAnimationEndObservable=null,this.onAnimationLoopObservable.clear(),this.onAnimationLoopObservable=null,this.onAnimationEventObservable.clear(),this.onAnimationEventObservable=null,this.onAnimationUpdateObservable.clear(),this.onAnimationUpdateObservable=null,this.onAnimationTransitionObservable.clear(),this.onAnimationTransitionObservable=null},n.prototype.updateAnimationState=function(e){var t=this;null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(n){t.checkStateMachine(n,e)})},n.prototype.updateAnimationTargets=function(t){var n=this;this._looptime=!1,this._loopblend=!1,this._ikFrameEanbled=!1,this._animationplaying=!1,null!=this._machine.layers&&this._machine.layers.length>0&&this._machine.layers.forEach(function(o){if(0===o.index&&(n._frametime=o.animationTime),null!=o.animationStateMachine&&null!=o.animationStateMachine.blendtree){o.animationStateMachine.iKOnFeet===!0&&(n._ikFrameEanbled=!0),o.iKPass===!0&&n.onAnimationIKObservable&&n.onAnimationIKObservable.hasObservers()&&n.onAnimationIKObservable.notifyObservers(o.index);var i=o.animationStateMachine;if(i.type===e.MotionType.Clip&&i.played!==-1&&(i.played+=t),null!=i.blendtree.children&&i.blendtree.children.length>0){var r=i.blendtree.children[0];if(null!=r)if(i.blendtree.blendType==e.BlendTreeType.Clip){var a=r.track;if(null!=a){var l=a.metadata.unity.length,s=e.AnimationState.TIME/l;o.animationTime+=t*s*Math.abs(i.speed)*Math.abs(n.speedRatio)*e.AnimationState.SPEED,o.animationTime>e.AnimationState.TIME&&(o.animationTime=e.AnimationState.TIME),o.animationNormal=o.animationTime>0?BABYLON.Scalar.Clamp(o.animationTime/e.AnimationState.TIME,0,1):0;var u=o.animationNormal>=.99?1:o.animationNormal,c=parseFloat(u.toFixed(3));i.speed<0&&(o.animationNormal=1-o.animationNormal);var d=l*o.animationNormal,p=0,h=0,m=0,f=!1,g=!1,y=0,v=!0,_=!0,B=!0,b=a;null!=b.metadata&&null!=b.metadata.unity&&(null!=b.metadata.unity.averagespeed&&(h=null!=b.metadata.unity.averagespeed.x?b.metadata.unity.averagespeed.x:0,m=null!=b.metadata.unity.averagespeed.z?b.metadata.unity.averagespeed.z:0),null!=b.metadata.unity.settings&&(p=null!=b.metadata.unity.settings.level?b.metadata.unity.settings.level:0,f=null!=b.metadata.unity.settings.looptime&&b.metadata.unity.settings.looptime,g=null!=b.metadata.unity.settings.loopblend&&b.metadata.unity.settings.loopblend,y=null!=b.metadata.unity.settings.orientationoffsety?b.metadata.unity.settings.orientationoffsety:0,v=null==b.metadata.unity.settings.loopblendorientation||b.metadata.unity.settings.loopblendorientation,_=null==b.metadata.unity.settings.loopblendpositiony||b.metadata.unity.settings.loopblendpositiony,B=null==b.metadata.unity.settings.loopblendpositionxz||b.metadata.unity.settings.loopblendpositionxz)),0===o.index&&(n._looptime=f,n._loopblend=g),y=BABYLON.Tools.ToRadians(y),h=Math.abs(h),m=Math.abs(m),p*=-1,o.animationTime>=e.AnimationState.TIME&&(o.animationFirstRun=!1,o.animationLoopFrame=!0,f===!0?(o.animationLoopCount++,n.onAnimationLoopObservable&&n.onAnimationLoopObservable.hasObservers()&&n.onAnimationLoopObservable.notifyObservers(o.index)):o.animationEndFrame===!1&&(o.animationEndFrame=!0,n.onAnimationEndObservable&&n.onAnimationEndObservable.hasObservers()&&n.onAnimationEndObservable.notifyObservers(o.index))),o.animationFirstRun!==!0&&f!==!0||(n._animationplaying=!0,a.targetedAnimations.forEach(function(t){if(t.target instanceof BABYLON.TransformNode){var i=t.target;if(0===o.index||null==o.avatarMask||n.filterTargetAvatarMask(o,i)){var r=null!=i.metadata&&null!=i.metadata.unity&&null!=i.metadata.unity.rootbone&&i.metadata.unity.rootbone;if(r===!0&&null==n._rootBoneTransform&&(n._rootBoneTransform=i),null!=i.metadata&&null!=i.metadata.mixer){var a=i.metadata.mixer[o.index];if(null!=a)if("position"===t.animation.targetProperty)n._targetPosition=e.Utilities.SampleAnimationVector3(t.animation,d,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),r===!0&&null!=n._rootBoneTransform?(n._positionWeight=!0,n._positionHolder.set(0,0,0),n._rootBoneWeight=!1,n._rootBoneHolder.set(0,0,0),n.applyRootMotion===!0?_===!0&&B===!0?(n._positionWeight=!0,n._positionHolder.set(n._targetPosition.x,n._targetPosition.y+p,n._targetPosition.z)):_===!1&&B===!1?(n._rootBoneWeight=!0,n._rootBoneHolder.set(n._targetPosition.x,n._targetPosition.y+p,n._targetPosition.z)):_===!0&&B===!1?(n._positionWeight=!0,n._positionHolder.set(n.m_zeroVector.x,n._targetPosition.y+p,n.m_zeroVector.z),n._rootBoneWeight=!0,n._rootBoneHolder.set(n._targetPosition.x,n.m_zeroVector.y,n._targetPosition.z)):B===!0&&_===!1&&(n._positionWeight=!0,
n._positionHolder.set(n._targetPosition.x,n.m_zeroVector.y,n._targetPosition.z),n._rootBoneWeight=!0,n._rootBoneHolder.set(n.m_zeroVector.x,n._targetPosition.y+p,n.m_zeroVector.z)):(n._positionWeight=!0,n._positionHolder.set(n._targetPosition.x,n._targetPosition.y+p,n._targetPosition.z)),n._positionWeight===!0&&(null==a.positionBuffer&&(a.positionBuffer=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.positionBuffer,n._positionHolder,1)),n._rootBoneWeight===!0&&(null==a.rootPosition&&(a.rootPosition=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.rootPosition,n._rootBoneHolder,1))):(null==a.positionBuffer&&(a.positionBuffer=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.positionBuffer,n._targetPosition,1));else if("rotationQuaternion"===t.animation.targetProperty)if(n._targetRotation=e.Utilities.SampleAnimationQuaternion(t.animation,d,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),r===!0&&null!=n._rootBoneTransform){n._rotationWeight=!1,n._rotationHolder.copyFrom(n.m_rotationIdentity),n._rootQuatWeight=!1,n._rootQuatHolder.copyFrom(n.m_rotationIdentity);var l=n._targetRotation.toEulerAngles(),s=l.y;n.applyRootMotion===!0?v===!0?(n._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(l.x,s+y,l.z,n._rotationHolder)):(n._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(l.x,n.m_zeroVector.y,l.z,n._rotationHolder),n._rootQuatWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(n.m_zeroVector.x,s+y,n.m_zeroVector.z,n._rootQuatHolder)):(n._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(l.x,s+y,l.z,n._rotationHolder)),n._rotationWeight===!0&&(null==a.rotationBuffer&&(a.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rotationBuffer,n._rotationHolder,1)),n._rootQuatWeight===!0&&(null==a.rootRotation&&(a.rootRotation=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rootRotation,n._rootQuatHolder,1))}else null==a.rotationBuffer&&(a.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rotationBuffer,n._targetRotation,1);else"scaling"===t.animation.targetProperty&&(n._targetScaling=e.Utilities.SampleAnimationVector3(t.animation,d,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==a.scalingBuffer&&(a.scalingBuffer=new BABYLON.Vector3(1,1,1)),e.Utilities.BlendVector3Value(a.scalingBuffer,n._targetScaling,1))}}}else if(t.target instanceof BABYLON.MorphTarget){var u=t.target;if(null!=u.metadata&&null!=u.metadata.mixer){var c=u.metadata.mixer[o.index];if("influence"===t.animation.targetProperty){var h=e.Utilities.SampleAnimationFloat(t.animation,d,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0);null==c.influenceBuffer&&(c.influenceBuffer=0),c.influenceBuffer=e.Utilities.BlendFloatValue(c.influenceBuffer,h,1)}}}})),1==n._animationplaying&&(null!=o.animationStateMachine.tcurves&&o.animationStateMachine.tcurves.length>0&&o.animationStateMachine.tcurves.forEach(function(t){if(null!=t.targetProperty&&""!==t.targetProperty){var i=e.Utilities.SampleAnimationFloat(t,o.animationNormal,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0);n.setFloat(t.targetProperty,i)}}),null!=o.animationStateMachine.events&&o.animationStateMachine.events.length>0&&o.animationStateMachine.events.forEach(function(e){if(c>=e.time-.01&&c<=e.time+.01){var t=e["function"]+"_"+e.time;null==o.animationLoopEvents&&(o.animationLoopEvents={}),o.animationLoopEvents[t]||(o.animationLoopEvents[t]=!0,n.onAnimationEventObservable&&n.onAnimationEventObservable.hasObservers()&&n.onAnimationEventObservable.notifyObservers(e))}})),o.animationLoopFrame===!0&&(o.animationTime=0,o.animationNormal=0,o.animationLoopFrame=!1,o.animationLoopEvents=null)}}else{n._animationplaying=!0,n._blendWeights.primary=null,n._blendWeights.secondary=null;var C=[],T=i.blendtree;n.parseTreeBranches(o,T,1,C);var s=n.computeWeightedFrameRatio(C);o.animationTime+=t*s*Math.abs(i.speed)*Math.abs(n.speedRatio)*e.AnimationState.SPEED,o.animationTime>e.AnimationState.TIME&&(o.animationTime=e.AnimationState.TIME),o.animationNormal=o.animationTime>0?BABYLON.Scalar.Clamp(o.animationTime/e.AnimationState.TIME,0,1):0;var u=o.animationNormal>=.99?1:o.animationNormal,I=parseFloat(u.toFixed(3));i.speed<0&&(o.animationNormal=1-o.animationNormal);var S=o.animationNormal;o.animationTime>=e.AnimationState.TIME&&(o.animationFirstRun=!1,o.animationLoopFrame=!0,o.animationLoopCount++);var A=null!=C&&C.length>0&&null!=C[0].track?C[0].track:null;if(null!=A)for(var O=A.targetedAnimations.length,x=0;x<O;x++){var M=A.targetedAnimations[x];if(M.target instanceof BABYLON.TransformNode){var N=M.target;if(0===o.index||null==o.avatarMask||n.filterTargetAvatarMask(o,N)){var L=null!=N.metadata&&null!=N.metadata.unity&&null!=N.metadata.unity.rootbone&&N.metadata.unity.rootbone;if(L===!0&&null==n._rootBoneTransform&&(n._rootBoneTransform=N),null!=N.metadata&&null!=N.metadata.mixer){n._initialtargetblending=!0;var w=N.metadata.mixer[o.index];n.updateBlendableTargets(t,o,T,M,x,w,S,L,N)}}}}null!=o.animationStateMachine.tcurves&&o.animationStateMachine.tcurves.length>0&&o.animationStateMachine.tcurves.forEach(function(t){if(null!=t.targetProperty&&""!==t.targetProperty){var i=e.Utilities.SampleAnimationFloat(t,o.animationNormal,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0);n.setFloat(t.targetProperty,i)}}),null!=o.animationStateMachine.events&&o.animationStateMachine.events.length>0&&o.animationStateMachine.events.forEach(function(e){if(I>=e.time-.01&&I<=e.time+.01){var t=e["function"]+"_"+e.time;null==o.animationLoopEvents&&(o.animationLoopEvents={}),o.animationLoopEvents[t]||(o.animationLoopEvents[t]=!0,n.onAnimationEventObservable&&n.onAnimationEventObservable.hasObservers()&&n.onAnimationEventObservable.notifyObservers(e))}}),o.animationLoopFrame===!0&&(o.animationTime=0,o.animationNormal=0,o.animationLoopFrame=!1,o.animationLoopEvents=null)}}}}),this.finalizeAnimationTargets(t)},n.prototype.updateBlendableTargets=function(t,n,o,i,r,a,l,s,u){if(null!=a&&null!=o.children&&o.children.length>0)for(var c=0;c<o.children.length;c++){var d=o.children[c];if(d.weight>0)if(d.type===e.MotionType.Clip){if(null!=d.track){var p=0,h=0,m=0,f=!1,g=0,y=!0,v=!0,_=!0,B=d.track;null!=B.metadata&&null!=B.metadata.unity&&(null!=B.metadata.unity.averagespeed&&(h=null!=B.metadata.unity.averagespeed.x?B.metadata.unity.averagespeed.x:0,m=null!=B.metadata.unity.averagespeed.z?B.metadata.unity.averagespeed.z:0),null!=B.metadata.unity.settings&&(p=null!=B.metadata.unity.settings.level?B.metadata.unity.settings.level:0,f=null!=B.metadata.unity.settings.loopblend&&B.metadata.unity.settings.loopblend,g=null!=B.metadata.unity.settings.orientationoffsety?B.metadata.unity.settings.orientationoffsety:0,y=null==B.metadata.unity.settings.loopblendorientation||B.metadata.unity.settings.loopblendorientation,v=null==B.metadata.unity.settings.loopblendpositiony||B.metadata.unity.settings.loopblendpositiony,_=null==B.metadata.unity.settings.loopblendpositionxz||B.metadata.unity.settings.loopblendpositionxz)),0===n.index&&(this._looptime=!0,this._loopblend=f),g=BABYLON.Tools.ToRadians(g),h=Math.abs(h),m=Math.abs(m),p*=-1;var b=d.track.targetedAnimations[r],C=this._initialtargetblending===!0?1:parseFloat(d.weight.toFixed(2));if(this._initialtargetblending=!1,b.target===i.target&&b.animation.targetProperty===i.animation.targetProperty){var T=l;d.timescale<0&&(T=1-T);var I=d.track.metadata.unity.length,S=I*T;if("position"===i.animation.targetProperty)this._targetPosition=e.Utilities.SampleAnimationVector3(b.animation,S,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),s===!0&&null!=this._rootBoneTransform?(this._positionWeight=!0,this._positionHolder.set(0,0,0),this._rootBoneWeight=!1,this._rootBoneHolder.set(0,0,0),this.applyRootMotion===!0?v===!0&&_===!0?(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+p,this._targetPosition.z)):v===!1&&_===!1?(this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this._targetPosition.y+p,this._targetPosition.z)):v===!0&&_===!1?(this._positionWeight=!0,this._positionHolder.set(this.m_zeroVector.x,this._targetPosition.y+p,this.m_zeroVector.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this.m_zeroVector.y,this._targetPosition.z)):_===!0&&v===!1&&(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this.m_zeroVector.y,this._targetPosition.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(this.m_zeroVector.x,this._targetPosition.y+p,this.m_zeroVector.z)):(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+p,this._targetPosition.z)),this._positionWeight===!0&&(null==a.positionBuffer&&(a.positionBuffer=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.positionBuffer,this._positionHolder,C)),this._rootBoneWeight===!0&&(null==a.rootPosition&&(a.rootPosition=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.rootPosition,this._rootBoneHolder,C))):(null==a.positionBuffer&&(a.positionBuffer=new BABYLON.Vector3(0,0,0)),e.Utilities.BlendVector3Value(a.positionBuffer,this._targetPosition,C));else if("rotationQuaternion"===i.animation.targetProperty)if(this._targetRotation=e.Utilities.SampleAnimationQuaternion(b.animation,S,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),s===!0&&null!=this._rootBoneTransform){this._rotationWeight=!1,this._rotationHolder.copyFrom(this.m_rotationIdentity),this._rootQuatWeight=!1,this._rootQuatHolder.copyFrom(this.m_rotationIdentity);var A=this._targetRotation.toEulerAngles(),O=A.y;this.applyRootMotion===!0?y===!0?(this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(A.x,O+g,A.z,this._rotationHolder)):(this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(A.x,this.m_zeroVector.y,A.z,this._rotationHolder),this._rootQuatWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(this.m_zeroVector.x,O+g,this.m_zeroVector.z,this._rootQuatHolder)):(this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(A.x,O+g,A.z,this._rotationHolder)),this._rotationWeight===!0&&(null==a.rotationBuffer&&(a.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rotationBuffer,this._rotationHolder,C)),this._rootQuatWeight===!0&&(null==a.rootRotation&&(a.rootRotation=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rootRotation,this._rootQuatHolder,C))}else null==a.rotationBuffer&&(a.rotationBuffer=new BABYLON.Quaternion(0,0,0,0)),e.Utilities.BlendQuaternionValue(a.rotationBuffer,this._targetRotation,C);else"scaling"===i.animation.targetProperty&&(this._targetScaling=e.Utilities.SampleAnimationVector3(b.animation,S,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE,!0),null==a.scalingBuffer&&(a.scalingBuffer=new BABYLON.Vector3(1,1,1)),e.Utilities.BlendVector3Value(a.scalingBuffer,this._targetScaling,C))}else BABYLON.Tools.Warn(o.name+" - "+d.track.name+" blend tree mismatch ("+r+"): "+i.target.name+" >>> "+b.target.name)}}else d.type===e.MotionType.Tree&&this.updateBlendableTargets(t,n,d.subtree,i,r,a,l,s,u)}},n.prototype.finalizeAnimationTargets=function(t){var n=this;if(this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(t){var o=t.target;null!=o.metadata&&null!=o.metadata.mixer&&null!=n._machine.layers&&n._machine.layers.length>0&&(n._blenderMatrix.reset(),n._dirtyBlenderMatrix=null,n._machine.layers.forEach(function(t){var i=o.metadata.mixer[t.index];null!=i&&(o instanceof BABYLON.TransformNode?(null==i.positionBuffer&&null==i.rotationBuffer&&null==i.scalingBuffer||(BABYLON.Matrix.ComposeToRef(i.scalingBuffer||o.scaling,i.rotationBuffer||o.rotationQuaternion,i.positionBuffer||o.position,n._updateMatrix),i.blendingSpeed>0&&(i.blendingFactor<=1&&null==i.originalMatrix&&(i.originalMatrix=BABYLON.Matrix.Compose(o.scaling,o.rotationQuaternion,o.position)),i.blendingFactor<=1&&null!=i.originalMatrix&&(e.Utilities.FastMatrixSlerp(i.originalMatrix,n._updateMatrix,i.blendingFactor,n._updateMatrix),i.blendingFactor+=i.blendingSpeed)),e.Utilities.FastMatrixSlerp(n._blenderMatrix,n._updateMatrix,t.defaultWeight,n._blenderMatrix),n._dirtyBlenderMatrix=!0,i.positionBuffer=null,i.rotationBuffer=null,i.scalingBuffer=null),null==i.rootPosition&&null==i.rootRotation||(BABYLON.Matrix.ComposeToRef(n._emptyScaling,i.rootRotation||n._emptyRotation,i.rootPosition||n._emptyPosition,n._updateMatrix),e.Utilities.FastMatrixSlerp(n._rootMotionMatrix,n._updateMatrix,t.defaultWeight,n._rootMotionMatrix),n._dirtyMotionMatrix=!0,i.rootPosition=null,i.rootRotation=null)):o instanceof BABYLON.MorphTarget&&null!=i.influenceBuffer&&(o.influence=BABYLON.Scalar.Lerp(o.influence,i.influenceBuffer,t.defaultWeight),i.influenceBuffer=null))}),null!=n._dirtyBlenderMatrix&&n._blenderMatrix.decompose(o.scaling,o.rotationQuaternion,o.position))}),this.applyRootMotion===!0&&null!=this._dirtyMotionMatrix){if(this._rootMotionMatrix.decompose(this._rootMotionScaling,this._rootMotionRotation,this._rootMotionPosition),this.isFirstFrame()===!0)this._deltaPosition.copyFrom(this._rootMotionPosition),this._deltaRotation.copyFrom(this._rootMotionRotation);else if(this.isLastFrame()===!0){if(this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),e.Utilities.QuaternionDiffToRef(this._rootMotionRotation,this._lastMotionRotation,this._deltaRotation),this._looptime===!0&&this._loopblend===!0){var o=this._loopMotionSpeed+this._lastMotionSpeed;0!==o&&(o/=2),this._deltaPosition.normalize(),this._deltaPosition.scaleInPlace(o*t);var i=this._loopRotateSpeed+this._lastRotateSpeed;0!==i&&(i/=2),this._deltaRotation.toEulerAnglesToRef(this._angularVelocity),BABYLON.Quaternion.FromEulerAnglesToRef(this._angularVelocity.x,i,this._angularVelocity.z,this._deltaRotation)}}else this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),e.Utilities.QuaternionDiffToRef(this._rootMotionRotation,this._lastMotionRotation,this._deltaRotation);var r=this._deltaPosition.length();this._rootMotionSpeed=r>0?r/t:r,this._deltaRotation.toEulerAnglesToRef(this._angularVelocity),this._lastMotionPosition.copyFrom(this._rootMotionPosition),this._lastMotionRotation.copyFrom(this._rootMotionRotation),this._lastMotionSpeed=this._rootMotionSpeed,this._lastRotateSpeed=this._angularVelocity.y,0===this._frametime&&(this._loopMotionSpeed=this._rootMotionSpeed,this._loopRotateSpeed=this._angularVelocity.y)}},n.prototype.checkStateMachine=function(e,t){var n=this;this._checkers.result=null,this._checkers.offest=0,this._checkers.blending=0,this._checkers.triggered=[],null!=e.animationStateMachine&&(e.animationStateMachine.time+=t,this.checkStateTransitions(e,e.animationStateMachine.transitions),null==this._checkers.result&&null!=this._machine.transitions&&this.checkStateTransitions(e,this._machine.transitions)),null!=this._checkers.triggered&&this._checkers.triggered.length>0&&(this._checkers.triggered.forEach(function(e){n.resetTrigger(e)}),this._checkers.triggered=null),null!=this._checkers.result&&(this.onAnimationTransitionObservable&&this.onAnimationTransitionObservable.hasObservers()&&this.onAnimationTransitionObservable.notifyObservers(this.transform),this.playCurrentAnimationState(e,this._checkers.result,this._checkers.blending,this._checkers.offest))},n.prototype.checkStateTransitions=function(t,n){var o=this,i=t.animationStateMachine.rate,r=t.animationStateMachine.length;if(null!=n&&n.length>0){var a=0,l=-1;for(a=0;a<n.length;a++)if(n[a].solo===!0&&n[a].mute===!1){l=a;break}var s=function(){var s=n[a];if(s.layerIndex!==t.index)return"continue";if(s.mute===!0)return"continue";if(l>=0&&l!==a)return"continue";var c=!1,d=0,p=!0;if(s.exitTime>0&&(d=r*s.exitTime/u.speedRatio,p=s.hasExitTime!==!0||t.animationStateMachine.time>=d),s.hasExitTime===!0&&s.intSource==e.InterruptionSource.None&&p===!1)return"continue";if(null!=s.conditions&&s.conditions.length>0){var h=0,m=s.conditions.length;s.conditions.forEach(function(t){var n=o._parameters.get(t.parameter);if(null!=n)if(n==e.AnimatorParameterType.Float||n==e.AnimatorParameterType.Int){var i=parseFloat(o.getFloat(t.parameter).toFixed(2));t.mode===e.ConditionMode.Greater&&i>t.threshold?h++:t.mode===e.ConditionMode.Less&&i<t.threshold?h++:t.mode===e.ConditionMode.Equals&&i===t.threshold?h++:t.mode===e.ConditionMode.NotEqual&&i!==t.threshold&&h++}else if(n==e.AnimatorParameterType.Bool){var r=o.getBool(t.parameter);t.mode===e.ConditionMode.If&&r===!0?h++:t.mode===e.ConditionMode.IfNot&&r===!1&&h++}else if(n==e.AnimatorParameterType.Trigger){var a=o.getTrigger(t.parameter);if(a===!0){h++;for(var l=-1,s=0;s<o._checkers.triggered.length;s++)if(o._checkers.triggered[s]===t.parameter){l=s;break}l<0&&o._checkers.triggered.push(t.parameter)}}}),c=s.hasExitTime===!0?p===!0&&h===m:h===m}else c=s.hasExitTime===!0&&p===!0;if(c===!0){s.hasExitTime===!0&&p===!0&&u.onAnimationEndObservable&&u.onAnimationEndObservable.hasObservers()&&u.onAnimationEndObservable.notifyObservers(t.index);var f=i>0?i:e.AnimationState.FPS,g=s.isExit===!1?s.destination:e.AnimationState.EXIT,y=s.fixedDuration===!0?s.duration:BABYLON.Scalar.Denormalize(s.duration,0,r),v=e.Utilities.ComputeBlendingSpeed(f,y),_=s.offset;return u._checkers.result=g,u._checkers.offest=_,u._checkers.blending=v,"break"}},u=this;for(a=0;a<n.length;a++){var c=s();if("break"===c)break}}},n.prototype.playCurrentAnimationState=function(t,n,o,i){if(void 0===i&&(i=0),null!=t&&null!=n&&""!==n&&n!==e.AnimationState.EXIT&&(null==t.animationStateMachine||t.animationStateMachine.name!==n)){null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(e){var n=e.target;if(null!=n.metadata&&null!=n.metadata.mixer){var i=n.metadata.mixer[t.index];null!=i&&(i.originalMatrix=null,i.blendingFactor=0,i.blendingSpeed=o)}});var r=this.getMachineState(n);null!=r&&r.layerIndex===t.index&&(r.time=0,r.played=0,r.interrupted=!1,t.animationTime=BABYLON.Scalar.Clamp(i),t.animationNormal=0,t.animationFirstRun=!0,t.animationEndFrame=!1,t.animationLoopFrame=!1,t.animationLoopCount=0,t.animationLoopEvents=null,t.animationStateMachine=r,this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),this._lastMotionPosition.set(0,0,0),this._lastMotionRotation.set(0,0,0,0))}},n.prototype.stopCurrentAnimationState=function(e){null!=e&&(null!=this.m_animationTargets&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(t){var n=t.target;if(null!=n.metadata&&null!=n.metadata.mixer){var o=n.metadata.mixer[e.index];null!=o&&(o.originalMatrix=null,o.blendingFactor=0,o.blendingSpeed=0)}}),e.animationTime=0,e.animationNormal=0,e.animationFirstRun=!0,e.animationEndFrame=!1,e.animationLoopFrame=!1,e.animationLoopCount=0,e.animationLoopEvents=null,e.animationStateMachine=null,this._deltaPosition.set(0,0,0),this._deltaRotation.set(0,0,0,0),this._angularVelocity.set(0,0,0),this._rootMotionSpeed=0,this._rootMotionMatrix.reset(),this._dirtyMotionMatrix=null,this._rootMotionPosition.set(0,0,0),this._rootMotionRotation.set(0,0,0,0),this._lastMotionPosition.set(0,0,0),this._lastMotionRotation.set(0,0,0,0))},n.prototype.checkAvatarTransformPath=function(e,t){var n=!1;if(null!=e.animationMaskMap){var o=e.animationMaskMap.get(t);null!=o&&o>=0&&(n=!0)}return n},n.prototype.filterTargetAvatarMask=function(e,t){var n=!1;if(null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.bone&&""!==t.metadata.unity.bone){var o=t.metadata.unity.bone;n=this.checkAvatarTransformPath(e,o)}return n},n.prototype.sortWeightedBlendingList=function(e){null!=e&&e.length>0&&e.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0})},n.prototype.computeWeightedFrameRatio=function(e){var t=1;if(null!=e&&e.length>0){this.sortWeightedBlendingList(e),this._blendWeights.primary=e[0];var n=this._blendWeights.primary.weight;if(n<1&&e.length>1&&(this._blendWeights.secondary=e[1]),null!=this._blendWeights.primary&&null!=this._blendWeights.secondary){var o=BABYLON.Scalar.Clamp(this._blendWeights.primary.weight);t=BABYLON.Scalar.Lerp(this._blendWeights.secondary.ratio,this._blendWeights.primary.ratio,o)}else null!=this._blendWeights.primary&&null==this._blendWeights.secondary&&(t=this._blendWeights.primary.ratio)}return t},n.prototype.setupTreeBranches=function(t){var n=this;null!=t&&null!=t.children&&t.children.length>0&&t.children.forEach(function(t){if(t.type===e.MotionType.Tree)n.setupTreeBranches(t.subtree);else if(t.type===e.MotionType.Clip&&null!=t.motion&&""!==t.motion&&(t.weight=0,t.ratio=0,t.track=n.getAnimationGroup(t.motion),null!=t.track)){var o=t.track.metadata.unity.length;t.ratio=e.AnimationState.TIME/o}})},n.prototype.parseTreeBranches=function(t,n,o,i){if(null!=n)switch(n.valueParameterX=null!=n.blendParameterX?parseFloat(this.getFloat(n.blendParameterX).toFixed(2)):0,n.valueParameterY=null!=n.blendParameterY?parseFloat(this.getFloat(n.blendParameterY).toFixed(2)):0,n.blendType){case e.BlendTreeType.Simple1D:this.parse1DSimpleTreeBranches(t,n,o,i);break;case e.BlendTreeType.SimpleDirectional2D:this.parse2DSimpleDirectionalTreeBranches(t,n,o,i);break;case e.BlendTreeType.FreeformDirectional2D:this.parse2DFreeformDirectionalTreeBranches(t,n,o,i);break;case e.BlendTreeType.FreeformCartesian2D:this.parse2DFreeformCartesianTreeBranches(t,n,o,i)}},n.prototype.parse1DSimpleTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.threshold,posY:e.threshold,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate1DSimpleBlendTree(n.valueParameterX,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.prototype.parse2DSimpleDirectionalTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate2DFreeformDirectional(n.valueParameterX,n.valueParameterY,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.prototype.parse2DFreeformDirectionalTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate2DFreeformDirectional(n.valueParameterX,n.valueParameterY,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.prototype.parse2DFreeformCartesianTreeBranches=function(t,n,o,i){var r=this;if(null!=n&&null!=n.children&&n.children.length>0){var a=[];n.children.forEach(function(e){e.weight=0;var t={source:e,motion:e.motion,posX:e.positionX,posY:e.positionY,weight:e.weight};a.push(t)}),e.BlendTreeSystem.Calculate2DFreeformCartesian(n.valueParameterX,n.valueParameterY,a),a.forEach(function(e){null!=e.source&&(e.source.weight=e.weight)}),n.children.forEach(function(n){n.weight*=o,n.type===e.MotionType.Clip&&n.weight>0&&i.push(n),n.type===e.MotionType.Tree&&r.parseTreeBranches(t,n.subtree,n.weight,i)})}},n.FPS=30,n.EXIT="[EXIT]",n.TIME=1,n.SPEED=1,n}(e.ScriptComponent);e.AnimationState=t;var n=function(){function e(e){this.source=e.source,this.motion=e.motion,this.posX=e.posX||0,this.posY=e.posY||0,this.weight=e.weight||0}return e}();e.BlendTreeValue=n;var o=function(){function e(){}return e.ClampValue=function(e,t,n){return e<=t?t:e>=n?n:e},e.GetSignedAngle=function(e,t){return Math.atan2(e.x*t.y-e.y*t.x,e.x*t.x+e.y*t.y)},e.GetLinearInterpolation=function(e,t,n,o,i){return t+(i-e)*((o-t)/(n-e))},e.GetRightNeighbourIndex=function(e,t){t.sort(function(e,t){return e.posX-t.posX});for(var n=0;n<t.length;++n)if(t[n].posX>e)return n;return-1},e}();e.BlendTreeUtils=o;var i=function(){function t(){}return t.Calculate1DSimpleBlendTree=function(t,n){var o=n[0],i=n[n.length-1];if(t<=o.posX)o.weight=1;else if(t>=i.posX)i.weight=1;else{var r=e.BlendTreeUtils.GetRightNeighbourIndex(t,n),a=n[r-1],l=n[r],s=e.BlendTreeUtils.GetLinearInterpolation(a.posX,1,l.posX,0,t);a.weight=s,l.weight=1-a.weight}},t.Calculate2DFreeformDirectional=function(t,n,o){e.BlendTreeSystem.TempVector2_IP.set(t,n),e.BlendTreeSystem.TempVector2_POSI.set(0,0),e.BlendTreeSystem.TempVector2_POSJ.set(0,0),e.BlendTreeSystem.TempVector2_POSIP.set(0,0),e.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var i=2,r=0,a=e.BlendTreeSystem.TempVector2_IP.length(),l=0;l<o.length;++l){var s=o[l];e.BlendTreeSystem.TempVector2_POSI.set(s.posX,s.posY);for(var u=e.BlendTreeSystem.TempVector2_POSI.length(),c=a-u,d=e.BlendTreeUtils.GetSignedAngle(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_IP),p=1,h=0;h<o.length;++h)if(h!==l){e.BlendTreeSystem.TempVector2_POSJ.set(o[h].posX,o[h].posY);var m=e.BlendTreeSystem.TempVector2_POSJ.length(),f=(u+m)/2,g=c/f,y=(m-u)/f,v=e.BlendTreeUtils.GetSignedAngle(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSJ);e.BlendTreeSystem.TempVector2_POSIP.set(g,d*i),e.BlendTreeSystem.TempVector2_POSIJ.set(y,v*i);var _=e.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),B=BABYLON.Vector2.Dot(e.BlendTreeSystem.TempVector2_POSIP,e.BlendTreeSystem.TempVector2_POSIJ)/_;B=1-B,B=e.BlendTreeUtils.ClampValue(B,0,1),p=Math.min(B,p)}s.weight=p,r+=p}for(var b=0,C=o;b<C.length;b++){var s=C[b];s.weight/=r}},t.Calculate2DFreeformCartesian=function(t,n,o){e.BlendTreeSystem.TempVector2_IP.set(t,n),e.BlendTreeSystem.TempVector2_POSI.set(0,0),e.BlendTreeSystem.TempVector2_POSJ.set(0,0),e.BlendTreeSystem.TempVector2_POSIP.set(0,0),e.BlendTreeSystem.TempVector2_POSIJ.set(0,0);for(var i=0,r=0;r<o.length;++r){var a=o[r];e.BlendTreeSystem.TempVector2_POSI.set(a.posX,a.posY),e.BlendTreeSystem.TempVector2_IP.subtractToRef(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSIP);for(var l=1,s=0;s<o.length;++s)if(s!==r){e.BlendTreeSystem.TempVector2_POSJ.set(o[s].posX,o[s].posY),e.BlendTreeSystem.TempVector2_POSJ.subtractToRef(e.BlendTreeSystem.TempVector2_POSI,e.BlendTreeSystem.TempVector2_POSIJ);var u=e.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),c=BABYLON.Vector2.Dot(e.BlendTreeSystem.TempVector2_POSIP,e.BlendTreeSystem.TempVector2_POSIJ)/u;c=1-c,c=e.BlendTreeUtils.ClampValue(c,0,1),l=Math.min(l,c)}a.weight=l,i+=l}for(var d=0,p=o;d<p.length;d++){var a=p[d];a.weight/=i}},t.TempVector2_IP=new BABYLON.Vector2(0,0),t.TempVector2_POSI=new BABYLON.Vector2(0,0),t.TempVector2_POSJ=new BABYLON.Vector2(0,0),t.TempVector2_POSIP=new BABYLON.Vector2(0,0),t.TempVector2_POSIJ=new BABYLON.Vector2(0,0),t}();e.BlendTreeSystem=i;var r=function(){function e(){}return e}();e.MachineState=r;var a=function(){function e(){}return e}();e.TransitionCheck=a;var l=function(){function e(){}return e}();e.AnimationMixer=l;var s=function(){function e(){}return e}();e.BlendingWeights=s;var u;!function(e){e[e.Clip=0]="Clip",e[e.Tree=1]="Tree"}(u=e.MotionType||(e.MotionType={}));var c;!function(e){e[e.If=1]="If",e[e.IfNot=2]="IfNot",e[e.Greater=3]="Greater",e[e.Less=4]="Less",e[e.Equals=6]="Equals",e[e.NotEqual=7]="NotEqual"}(c=e.ConditionMode||(e.ConditionMode={}));var d;!function(e){e[e.None=0]="None",e[e.Source=1]="Source",e[e.Destination=2]="Destination",e[e.SourceThenDestination=3]="SourceThenDestination",e[e.DestinationThenSource=4]="DestinationThenSource"}(d=e.InterruptionSource||(e.InterruptionSource={}));var p;!function(e){e[e.Simple1D=0]="Simple1D",e[e.SimpleDirectional2D=1]="SimpleDirectional2D",e[e.FreeformDirectional2D=2]="FreeformDirectional2D",e[e.FreeformCartesian2D=3]="FreeformCartesian2D",e[e.Direct=4]="Direct",e[e.Clip=5]="Clip"}(p=e.BlendTreeType||(e.BlendTreeType={}));var h;!function(e){e[e.Lower=0]="Lower",e[e.Upper=1]="Upper"}(h=e.BlendTreePosition||(e.BlendTreePosition={}));var m;!function(e){e[e.Float=1]="Float",e[e.Int=3]="Int",e[e.Bool=4]="Bool",e[e.Trigger=9]="Trigger"}(m=e.AnimatorParameterType||(e.AnimatorParameterType={}))}(UNITY||(UNITY={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),UNITY;!function(e){var t=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._audio=null,e._name=null,e._loop=!1,e._mute=!1,e._pitch=1,e._volume=1,e._preload=!1,e._playonawake=!0,e._spatialblend=0,e._preloaderUrl=null,e._lastmutedvolume=null,e._priority=128,e._panstereo=0,e._mindistance=10,e._maxdistance=50,e._rolloffmode="linear",e._reverbzonemix=1,e._bypasseffects=!1,e._bypassreverbzones=!1,e._bypasslistenereffects=!1,e._initializedReadyInstance=!1,e.onReadyObservable=new BABYLON.Observable,e}return __extends(n,t),n.prototype.getSoundClip=function(){return this._audio},n.prototype.getAudioElement=function(){return null!=this._audio?this._audio._htmlAudioElement:null},n.prototype.awake=function(){this.awakeAudioSource()},n.prototype.start=function(){this.startAudioSource()},n.prototype.destroy=function(){this.destroyAudioSource()},n.prototype.awakeAudioSource=function(){this._name=this.getProperty("name",this._name),this._loop=this.getProperty("loop",this._loop),this._mute=this.getProperty("mute",this._mute),this._pitch=this.getProperty("pitch",this._pitch),this._volume=this.getProperty("volume",this._volume),this._preload=this.getProperty("preload",this._preload),this._priority=this.getProperty("priority",this._priority),this._panstereo=this.getProperty("panstereo",this._panstereo),this._playonawake=this.getProperty("playonawake",this._playonawake),this._mindistance=this.getProperty("mindistance",this._mindistance),this._maxdistance=this.getProperty("maxdistance",this._maxdistance),this._rolloffmode=this.getProperty("rolloffmode",this._rolloffmode),this._spatialblend=this.getProperty("spatialblend",this._spatialblend),this._reverbzonemix=this.getProperty("reverbzonemix",this._reverbzonemix),this._bypasseffects=this.getProperty("bypasseffects",this._bypasseffects),this._bypassreverbzones=this.getProperty("bypassreverbzones",this._bypassreverbzones),this._bypasslistenereffects=this.getProperty("bypasslistenereffects",this._bypasslistenereffects),null!=this._name&&""!==this._name||(this._name="Unknown");var t=this.getProperty("file");if(null!=t&&""!==t){var n=e.SceneManager.GetRootUrl(this.scene),o=n+t;null!=o&&""!==o&&(this._preload===!0?this._preloaderUrl=o:this.setDataSource(o))}},n.prototype.startAudioSource=function(){this._volume>=e.AudioSource.MAX_VOLUME&&(this._volume=e.AudioSource.DEFAULT_LEVEL)},n.prototype.destroyAudioSource=function(){this.onReadyObservable.clear(),this.onReadyObservable=null,null!=this._audio&&(this._audio.dispose(),this._audio=null)},n.prototype.isReady=function(){var e=!1;return null!=this._audio&&(e=this._audio.isReady()),
e},n.prototype.isPlaying=function(){var e=!1;return null!=this._audio&&(e=this._audio.isPlaying),e},n.prototype.isPaused=function(){var e=!1;return null!=this._audio&&(e=this._audio.isPaused),e},n.prototype.play=function(t,n,o){var i=this;return e.SceneManager.HasAudioContext()?this.internalPlay(t,n,o):BABYLON.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){i.internalPlay(t,n,o)}),!0},n.prototype.internalPlay=function(e,t,n){var o=this;null!=this._audio&&(this._initializedReadyInstance===!0?this._audio.play(e,t,n):this.onReadyObservable.addOnce(function(){o._audio.play(e,t,n)}))},n.prototype.pause=function(){var e=!1;return null!=this._audio&&(this._audio.pause(),e=!0),e},n.prototype.stop=function(e){var t=!1;return null!=this._audio&&(this._audio.stop(e),t=!0),t},n.prototype.mute=function(e){var t=!1;return null!=this._audio&&(this._lastmutedvolume=this._audio.getVolume(),this._audio.setVolume(0,e)),t},n.prototype.unmute=function(e){var t=!1;return null!=this._audio&&null!=this._lastmutedvolume&&(this._audio.setVolume(this._lastmutedvolume,e),this._lastmutedvolume=null),t},n.prototype.getVolume=function(){var e=0;return e=null!=this._audio?this._audio.getVolume():this._volume},n.prototype.setVolume=function(e,t){var n=!1;return this._volume=e,null!=this._audio&&this._audio.setVolume(this._volume,t),n=!0},n.prototype.getSpatialSound=function(){var e=!1;return null!=this._audio&&(e=this._audio.spatialSound),e},n.prototype.setSpatialSound=function(e){null!=this._audio&&(this._audio.spatialSound=e)},n.prototype.setPlaybackSpeed=function(e){null!=this._audio&&this._audio.setPlaybackRate(e)},n.prototype.getCurrentTrackTime=function(){var e=0;return null!=this._audio&&(e=this._audio.currentTime),e},n.prototype.setDataSource=function(t){var n=this;null!=this._audio&&(this._audio.dispose(),this._audio=null);var o=this._spatialblend>=.1,i="logarithmic"===this._rolloffmode?"exponential":"linear",r=null!=this.transform.metadata&&null!=this.transform.metadata.vtt&&this.transform.metadata.vtt===!0;this._initializedReadyInstance=!1,this._audio=new BABYLON.Sound(this._name,t,this.scene,function(){n._lastmutedvolume=n._volume,n._audio.setVolume(n._mute===!0?0:n._volume),n._audio.setPlaybackRate(n._pitch),n._initializedReadyInstance=!0,n.onReadyObservable&&n.onReadyObservable.hasObservers()&&n.onReadyObservable.notifyObservers(n._audio),n._playonawake===!0&&n.play()},{loop:this._loop,autoplay:!1,refDistance:this._mindistance,maxDistance:this._maxdistance,rolloffFactor:e.AudioSource.DEFAULT_ROLLOFF,spatialSound:o,distanceModel:i,streaming:r}),this._audio.setPosition(this.transform.position.clone()),o===!0&&this._audio.attachToMesh(this.transform)},n.prototype.addPreloaderTasks=function(e){var t=this;if(this._preload===!0){var n=e.addBinaryFileTask(this.transform.name+".AudioTask",this._preloaderUrl);n.onSuccess=function(e){t.setDataSource(e.data)},n.onError=function(e,t,n){console.error(t,n)}}},n.MAX_VOLUME=1,n.DEFAULT_LEVEL=1,n.DEFAULT_ROLLOFF=1,n}(e.ScriptComponent);e.AudioSource=t}(UNITY||(UNITY={}));var UNITY;!function(e){var t=function(){function t(e){this.chassisBody=null,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=0,this.indexForwardAxis=2,this.indexUpAxis=1,this.smoothFlyingImpulse=0,this.currentVehicleSpeedKmHour=0,this.chassisBody=e.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis="undefined"!=typeof e.indexRightAxis?e.indexRightAxis:0,this.indexForwardAxis="undefined"!=typeof e.indexForwardAxis?e.indexForwardAxis:2,this.indexUpAxis="undefined"!=typeof e.indexUpAxis?e.indexUpAxis:1}return t.prototype.addWheel=function(t){t=t||{};var n=new e.HavokWheelInfo(t),o=this.wheelInfos.length;return this.wheelInfos.push(n),o},t.prototype.getNumWheels=function(){return this.wheelInfos.length},t.prototype.getWheelInfo=function(e){return this.wheelInfos[e]},t.prototype.getSteeringValue=function(e){var t=this.wheelInfos[e];return t.steering},t.prototype.setSteeringValue=function(e,t){var n=this.wheelInfos[t];n.steering=e},t.prototype.applyEngineForce=function(e,t){this.wheelInfos[t].engineForce=e},t.prototype.setBrake=function(e,t){this.wheelInfos[t].brake=e},t.prototype.addToWorld=function(e){this.world=e},t.prototype.getVehicleAxisWorld=function(t,n){return n.set(0===t?1:0,1===t?1:0,2===t?1:0),BABYLON.Vector3.TransformCoordinatesToRef(n,e.HavokVehicleUtilities.bodyTransform(this.chassisBody,new BABYLON.Matrix),n),n},t.prototype.getCurrentSpeedKmHour=function(){return this.currentVehicleSpeedKmHour},t.prototype.updateVehicle=function(t){for(var n=this.wheelInfos,o=n.length,i=this.chassisBody,r=0;r<o;r++)this.updateWheelTransform(r);var a=e.HavokVehicleUtilities.bodyLinearVelocity(i,new BABYLON.Vector3),l=BABYLON.Vector3.TransformNormalToRef(a,e.HavokVehicleUtilities.bodyTransform(i,new BABYLON.Matrix).invert(),new BABYLON.Vector3);this.currentVehicleSpeedKmHour=l.z;var s=new BABYLON.Vector3;this.getVehicleAxisWorld(this.indexForwardAxis,s),BABYLON.Vector3.Dot(s,e.HavokVehicleUtilities.bodyLinearVelocity(i,new BABYLON.Vector3))<0;for(var r=0;r<o;r++)this.castRay(n[r]);for(var u=0,r=0;r<o;r++){var c=n[r],d=c.raycastResult.body;d&&u++}0==u&&this.smoothFlyingImpulse>0,this.updateSuspension(t);for(var p=new BABYLON.Vector3,r=0;r<o;r++){var c=n[r],h=c.suspensionForce;h>c.maxSuspensionForce&&(h=c.maxSuspensionForce),p.copyFrom(c.raycastResult.hitNormalWorld).scaleInPlace(h*t),e.HavokVehicleUtilities.addImpulseAt(i,p,c.raycastResult.hitPointWorld)}this.updateFriction(t);var m=new BABYLON.Vector3,f=new BABYLON.Vector3,g=new BABYLON.Vector3;for(r=0;r<o;r++){var c=n[r];e.HavokVehicleUtilities.velocityAt(i,c.chassisConnectionPointWorld,g);var y=1;switch(this.indexUpAxis){case 1:y=-1}if(c.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,f);var v=BABYLON.Vector3.Dot(f,c.raycastResult.hitNormalWorld);m.copyFrom(c.raycastResult.hitNormalWorld).scaleInPlace(v),f.subtractToRef(m,f);var _=BABYLON.Vector3.Dot(f,g);c.deltaRotation=y*_*t/c.radius}!c.sliding&&c.isInContact||0===c.engineForce||!c.useCustomSlidingRotationalSpeed||(c.deltaRotation=(c.engineForce>0?1:-1)*c.customSlidingRotationalSpeed*t),c.locked===!0&&(c.deltaRotation=0),c.rotation+=c.deltaRotation,c.deltaRotation*=.99}},t.prototype.updateSuspension=function(t){for(var n=this.chassisBody,o=e.HavokVehicleUtilities.bodyMass(n),i=this.wheelInfos,r=i.length,a=0;a<r;a++){var l=i[a];if(l.isInContact){var s,u=l.suspensionRestLength,c=l.suspensionLength,d=u-c;s=l.suspensionStiffness*d*l.clippedInvContactDotSuspension;var p,h=l.suspensionRelativeVelocity;p=h<0?l.dampingCompression:l.dampingRelaxation,s-=p*h,l.suspensionForce=s*o,l.suspensionForce<0&&(l.suspensionForce=0)}else l.suspensionForce=0}},t.prototype.removeFromWorld=function(e){e.removeBody(this.chassisBody),this.world=null},t.prototype.castRay2=function(t){var n=e.HavokVehicleUtilities.castRay_rayvector,o=e.HavokVehicleUtilities.castRay_target;this.updateWheelTransformWorld(t);var i=this.chassisBody,r=-1,a=t.suspensionRestLength+t.radius;t.directionWorld.scaleToRef(a,n);var l=t.chassisConnectionPointWorld;l.addToRef(n,o);var s=t.raycastResult;s.reset(),this.world.raycastToRef(l,o,s);var u=s.body;if(t.raycastResult.groundObject=0,u){s.distance=BABYLON.Vector3.Distance(l,s.hitPointWorld),r=s.distance,t.isInContact=!0;var c=s.distance;t.suspensionLength=c-t.radius;var d=t.suspensionRestLength-t.maxSuspensionTravel,p=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<d&&(t.suspensionLength=d),t.suspensionLength>p&&(t.suspensionLength=p,t.raycastResult.reset());var h=BABYLON.Vector3.Dot(t.raycastResult.hitNormalWorld,t.directionWorld),m=new BABYLON.Vector3;e.HavokVehicleUtilities.velocityAt(i,t.raycastResult.hitPointWorld,m);var f=BABYLON.Vector3.Dot(t.raycastResult.hitNormalWorld,m);if(h>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var g=-1/h;t.suspensionRelativeVelocity=f*g,t.clippedInvContactDotSuspension=g}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scaleToRef(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return r},t.prototype.castRay=function(t){var n=e.HavokVehicleUtilities.castRay_rayvector,o=e.HavokVehicleUtilities.castRay_target;this.updateWheelTransformWorld(t);var i=this.chassisBody,r=-1,a=t.suspensionRestLength+t.radius;n.copyFrom(t.directionWorld).scaleInPlace(a);var l=t.chassisConnectionPointWorld;o.copyFrom(l).addInPlace(n);var s=t.raycastResult;s.reset(),this.world.raycastToRef(l,o,s);var u=s.body;if(t.raycastResult.groundObject=0,u){var c=BABYLON.Vector3.Distance(l,s.hitPointWorld);r=c,t.raycastResult.hitNormalWorld.copyFrom(s.hitNormalWorld),t.isInContact=!0;var d=c;t.suspensionLength=d-t.radius;var p=t.suspensionRestLength-t.maxSuspensionTravel,h=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<p&&(t.suspensionLength=p),t.suspensionLength>h&&(t.suspensionLength=h,t.raycastResult.reset());var m=BABYLON.Vector3.Dot(t.raycastResult.hitNormalWorld,t.directionWorld),f=new BABYLON.Vector3;e.HavokVehicleUtilities.velocityAt(i,t.raycastResult.hitPointWorld,f);var g=BABYLON.Vector3.Dot(t.raycastResult.hitNormalWorld,f);if(m>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var y=-1/m;t.suspensionRelativeVelocity=g*y,t.clippedInvContactDotSuspension=y}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.raycastResult.hitNormalWorld.copyFrom(t.directionWorld).scaleInPlace(-1),t.clippedInvContactDotSuspension=1;return r},t.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var n=this.chassisBody,o=e.HavokVehicleUtilities.bodyTransform(n,new BABYLON.Matrix);BABYLON.Vector3.TransformCoordinatesToRef(t.chassisConnectionPointLocal,o,t.chassisConnectionPointWorld),BABYLON.Vector3.TransformNormalToRef(t.directionLocal,o,t.directionWorld),BABYLON.Vector3.TransformNormalToRef(t.axleLocal,o,t.axleWorld)},t.prototype.updateWheelTransform=function(t){var n=e.HavokVehicleUtilities.tmpVec4,o=e.HavokVehicleUtilities.tmpVec5,i=e.HavokVehicleUtilities.tmpVec6,r=this.wheelInfos[t];this.updateWheelTransformWorld(r),r.directionLocal.scaleToRef(-1,n),o.copyFrom(r.axleLocal),BABYLON.Vector3.CrossToRef(n,o,i),i.normalize(),o.normalize();var a=r.steering,l=new BABYLON.Quaternion;BABYLON.Quaternion.RotationAxisToRef(n,a,l);var s=new BABYLON.Quaternion;BABYLON.Quaternion.RotationAxisToRef(o,r.rotation,s);var u=r.worldTransform.rotationQuaternion;e.HavokVehicleUtilities.bodyOrientation(this.chassisBody,new BABYLON.Quaternion).multiplyToRef(l,u),u.multiplyToRef(s,u),u.normalize();var c=r.worldTransform.position;c.copyFrom(r.directionWorld),c.scaleToRef(r.suspensionLength,c),c.addToRef(r.chassisConnectionPointWorld,c),r.worldTransform.computeWorldMatrix(!0)},t.prototype.getWheelTransformWorld=function(e){return this.wheelInfos[e].worldTransform},t.prototype.updateFriction=function(t){for(var n=e.HavokVehicleUtilities.updateFriction_surfNormalWS_scaled_proj,o=this.wheelInfos,i=o.length,r=this.chassisBody,a=e.HavokVehicleUtilities.updateFriction_forwardWS,l=e.HavokVehicleUtilities.updateFriction_axle,s=0,u=0;u<i;u++){var c=o[u],d=c.raycastResult.body;d&&s++,c.sideImpulse=0,c.forwardImpulse=0,a[u]||(a[u]=new BABYLON.Vector3),l[u]||(l[u]=new BABYLON.Vector3)}for(var u=0;u<i;u++){var c=o[u],d=c.raycastResult.body;if(d){var p=l[u],h=this.getWheelTransformWorld(u);BABYLON.Vector3.TransformNormalToRef(e.HavokVehicleUtilities.directions[this.indexRightAxis],h.getWorldMatrix(),p);var m=c.raycastResult.hitNormalWorld,f=BABYLON.Vector3.Dot(p,m);m.scaleToRef(f,n),p.subtractToRef(n,p),p.normalize(),BABYLON.Vector3.CrossToRef(m,p,a[u]),a[u].normalize(),c.sideImpulse=e.HavokVehicleUtilities.resolveSingleBilateral(r,c.raycastResult.hitPointWorld,d,c.raycastResult.hitPointWorld,p),c.sideImpulse*=e.HavokVehicleUtilities.sideFrictionStiffness2}}var g=1,y=.5;this.sliding=!1;for(var u=0;u<i;u++){var c=o[u],d=c.raycastResult.body,v=0;if(c.slipInfo=1,d){var _=0,B=c.brake?c.brake:_;v=e.HavokVehicleUtilities.calcRollingFriction(r,d,c.raycastResult.hitPointWorld,a[u],B),v+=c.engineForce*t;var b=B/v;c.slipInfo*=b}if(c.forwardImpulse=0,c.skidInfo=1,d){c.skidInfo=1;var C=c.suspensionForce*t*c.frictionSlip,T=C,I=C*T;c.forwardImpulse=v;var S=c.forwardImpulse*y,A=c.sideImpulse*g,O=S*S+A*A;if(c.sliding=!1,O>I){this.sliding=!0,c.sliding=!0;var b=C/Math.sqrt(O);c.skidInfo*=b}}}if(this.sliding)for(var u=0;u<i;u++){var c=o[u];0!==c.sideImpulse&&c.skidInfo<1&&(c.forwardImpulse*=c.skidInfo,c.sideImpulse*=c.skidInfo)}for(var u=0;u<i;u++){var c=o[u],x=new BABYLON.Vector3;if(c.raycastResult.hitPointWorld.subtractToRef(e.HavokVehicleUtilities.bodyPosition(r,new BABYLON.Vector3),x),0!==c.forwardImpulse){var M=new BABYLON.Vector3;M.copyFrom(a[u]).scaleInPlace(c.forwardImpulse),e.HavokVehicleUtilities.addImpulseAt(r,M,c.raycastResult.hitPointWorld)}if(0!==c.sideImpulse){var d=c.raycastResult.body,N=new BABYLON.Vector3;c.raycastResult.hitPointWorld.subtractToRef(e.HavokVehicleUtilities.bodyPosition(d,new BABYLON.Vector3),N);var L=new BABYLON.Vector3;L.copyFrom(l[u]).scaleInPlace(c.sideImpulse),BABYLON.Vector3.TransformNormalToRef(x,e.HavokVehicleUtilities.bodyTransform(r,new BABYLON.Matrix).invert(),x),x["xyz"[this.indexUpAxis]]*=c.rollInfluence,BABYLON.Vector3.TransformNormalToRef(x,e.HavokVehicleUtilities.bodyTransform(r,new BABYLON.Matrix),x),e.HavokVehicleUtilities.addImpulseAt(r,L,e.HavokVehicleUtilities.bodyPosition(r,new BABYLON.Vector3).add(x)),L.scaleToRef(-1,L),e.HavokVehicleUtilities.addImpulseAt(d,L,c.raycastResult.hitPointWorld)}}},t}();e.HavokRaycastVehicle=t;var n=function(){function t(t){this.maxSuspensionTravel=0,this.customSlidingRotationalSpeed=0,this.useCustomSlidingRotationalSpeed=0,this.sliding=!1,this.isInContact=!1,this.hub=null,this.spinner=null,this.defaultFriction=10,this.steeringAngle=0,this.rotationBoost=0,this.locked=!1,t=e.HavokVehicleUtilities.Utilsdefaults(t,{chassisConnectionPointLocal:new BABYLON.Vector3,chassisConnectionPointWorld:new BABYLON.Vector3,directionLocal:new BABYLON.Vector3,directionWorld:new BABYLON.Vector3,axleLocal:new BABYLON.Vector3,axleWorld:new BABYLON.Vector3,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointLocal.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionLocal.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleLocal.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new BABYLON.PhysicsRaycastResult,this.raycastResult.directionWorld=new BABYLON.Vector3,this.worldTransform=new BABYLON.TransformNode(""),this.worldTransform.rotationQuaternion=new BABYLON.Quaternion,this.isInContact=!1}return t.prototype.updateWheel=function(t){var n=this.raycastResult;if(this.isInContact){var o=BABYLON.Vector3.Dot(n.hitNormalWorld,this.raycastResult.directionWorld);n.hitPointWorld.subtractToRef(e.HavokVehicleUtilities.bodyPosition(t,new BABYLON.Vector3),e.HavokVehicleUtilities.relpos),e.HavokVehicleUtilities.velocityAt(t,e.HavokVehicleUtilities.relpos,e.HavokVehicleUtilities.chassis_velocity_at_contactPoint);var i=BABYLON.Vector3.Dot(n.hitNormalWorld,e.HavokVehicleUtilities.chassis_velocity_at_contactPoint);if(o>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var r=-1/o;this.suspensionRelativeVelocity=i*r,this.clippedInvContactDotSuspension=r}}else this.raycastResult.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,n.hitNormalWorld.copyFrom(this.raycastResult.directionWorld).scaleInPlace(-1),this.clippedInvContactDotSuspension=1},t}();e.HavokWheelInfo=n;var o=function(){function t(){}return t.calcRollingFriction=function(t,n,o,i,r){var a=0,l=o,s=e.HavokVehicleUtilities.calcRollingFriction_vel1,u=e.HavokVehicleUtilities.calcRollingFriction_vel2,c=e.HavokVehicleUtilities.calcRollingFriction_vel;e.HavokVehicleUtilities.velocityAt(t,l,s),e.HavokVehicleUtilities.velocityAt(n,l,u),s.subtractToRef(u,c);var d=BABYLON.Vector3.Dot(i,c),p=e.HavokVehicleUtilities.computeImpulseDenominator(t,o,i),h=e.HavokVehicleUtilities.computeImpulseDenominator(n,o,i),m=1,f=m/(p+h);return a=-d*f,r<a&&(a=r),a<-r&&(a=-r),a},t.computeImpulseDenominator=function(t,n,o){var i=e.HavokVehicleUtilities.computeImpulseDenominator_r0,r=e.HavokVehicleUtilities.computeImpulseDenominator_c0,a=e.HavokVehicleUtilities.computeImpulseDenominator_vec,l=e.HavokVehicleUtilities.computeImpulseDenominator_m;return n.subtractToRef(e.HavokVehicleUtilities.bodyPosition(t,new BABYLON.Vector3),i),BABYLON.Vector3.CrossToRef(i,o,r),e.HavokVehicleUtilities.bodyInertiaWorld(t,new BABYLON.Vector3).multiplyToRef(r,l),BABYLON.Vector3.CrossToRef(l,i,a),e.HavokVehicleUtilities.bodyInvMass(t)+BABYLON.Vector3.Dot(o,a)},t.resolveSingleBilateral=function(t,n,o,i,r){var a=r.lengthSquared();if(a>1.1)return 0;var l=e.HavokVehicleUtilities.resolveSingleBilateral_vel1,s=e.HavokVehicleUtilities.resolveSingleBilateral_vel2,u=e.HavokVehicleUtilities.resolveSingleBilateral_vel;e.HavokVehicleUtilities.velocityAt(t,n,l),e.HavokVehicleUtilities.velocityAt(o,i,s),l.subtractToRef(s,u);var c=BABYLON.Vector3.Dot(r,u),d=.1,p=1/(e.HavokVehicleUtilities.bodyInvMass(t)+e.HavokVehicleUtilities.bodyInvMass(o)),h=-d*c*p;return h},t.directions=[new BABYLON.Vector3(1,0,0),new BABYLON.Vector3(0,1,0),new BABYLON.Vector3(0,0,1)],t.calcRollingFriction_vel1=new BABYLON.Vector3,t.calcRollingFriction_vel2=new BABYLON.Vector3,t.calcRollingFriction_vel=new BABYLON.Vector3,t.updateFriction_surfNormalWS_scaled_proj=new BABYLON.Vector3,t.updateFriction_axle=[],t.updateFriction_forwardWS=[],t.sideFrictionStiffness2=1,t.castRay_rayvector=new BABYLON.Vector3,t.castRay_target=new BABYLON.Vector3,t.torque=new BABYLON.Vector3,t.tmpVec1=new BABYLON.Vector3,t.tmpVec2=new BABYLON.Vector3,t.tmpVec3=new BABYLON.Vector3,t.tmpVec4=new BABYLON.Vector3,t.tmpVec5=new BABYLON.Vector3,t.tmpVec6=new BABYLON.Vector3,t.tmpVel2=new BABYLON.Vector3,t.tmpMat1=new BABYLON.Matrix,t.velocityAt=function(t,n,o){return t.getObjectCenterWorldToRef(e.HavokVehicleUtilities.tmpVel2),n.subtractToRef(e.HavokVehicleUtilities.tmpVel2,o),t.getAngularVelocityToRef(e.HavokVehicleUtilities.tmpVel2),BABYLON.Vector3.CrossToRef(e.HavokVehicleUtilities.tmpVel2,o,o),t.getLinearVelocityToRef(e.HavokVehicleUtilities.tmpVel2),o.addInPlace(e.HavokVehicleUtilities.tmpVel2),o},t.bodyPosition=function(e,t){return e.getObjectCenterWorldToRef(t),t},t.bodyLinearVelocity=function(e,t){return e.getLinearVelocityToRef(t),t},t.bodyAngularVelocity=function(e,t){return e.getAngularVelocityToRef(t),t},t.bodyTransform=function(e,t){return t.copyFrom(e.transformNode.getWorldMatrix()),t},t.addImpulseAt=function(e,t,n){e.applyImpulse(t,n)},t.addForceAt=function(e,t,n){e.applyForce(t,n)},t.bodyOrientation=function(e,t){return t.copyFrom(e.transformNode.rotationQuaternion),t},t.bodyMass=function(e){return e.getMassProperties().mass},t.bodyInvMass=function(e){var t=e.getMassProperties().mass;return t>0?1/t:0},t.bodyInertiaWorld=function(e,t){var n=e.getMassProperties();return t.copyFrom(n.inertia),BABYLON.Vector3.TransformNormalToRef(t,e.transformNode.getWorldMatrix(),t),t.x=t.x>0?1/t.x:0,t.y=t.y>0?1/t.y:0,t.z=t.z>0?1/t.z:0,t},t.computeImpulseDenominator_r0=new BABYLON.Vector3,t.computeImpulseDenominator_c0=new BABYLON.Vector3,t.computeImpulseDenominator_vec=new BABYLON.Vector3,t.computeImpulseDenominator_m=new BABYLON.Vector3,t.resolveSingleBilateral_vel1=new BABYLON.Vector3,t.resolveSingleBilateral_vel2=new BABYLON.Vector3,t.resolveSingleBilateral_vel=new BABYLON.Vector3,t.chassis_velocity_at_contactPoint=new BABYLON.Vector3,t.relpos=new BABYLON.Vector3,t.Utilsdefaults=function(e,t){e=e||{};for(var n in t)n in e||(e[n]=t[n]);return e},t}();e.HavokVehicleUtilities=o}(UNITY||(UNITY={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),UNITY;!function(e){var t=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.distanceToTarget=0,e.teleporting=!1,e.moveDirection=new BABYLON.Vector3(0,0,0),e.resetPosition=new BABYLON.Vector3(0,0,0),e.lastPosition=new BABYLON.Vector3(0,0,0),e.distancePosition=new BABYLON.Vector3(0,0,0),e.currentPosition=new BABYLON.Vector3(0,0,0),e.currentRotation=new BABYLON.Quaternion(0,0,0,1),e.currentVelocity=new BABYLON.Vector3(0,0,0),e.currentWaypoint=new BABYLON.Vector3(0,0,0),e.heightOffset=0,e.angularSpeed=0,e.updatePosition=!0,e.updateRotation=!0,e.distanceEpsilon=.1,e.velocityEpsilon=1.1,e.offMeshVelocity=1.5,e.stoppingDistance=0,e.onReadyObservable=new BABYLON.Observable,e.onPreUpdateObservable=new BABYLON.Observable,e.onPostUpdateObservable=new BABYLON.Observable,e.onNavCompleteObservable=new BABYLON.Observable,e.m_agentState=0,e.m_agentIndex=-1,e.m_agentReady=!1,e.m_agentGhost=null,e.m_agentParams=null,e.m_agentMovement=new BABYLON.Vector3(0,0,0),e.m_agentDirection=new BABYLON.Vector3(0,0,1),e.m_agentQuaternion=new BABYLON.Quaternion(0,0,0,1),e.m_agentDestination=null,e}return __extends(n,t),n.prototype.isReady=function(){return this.m_agentReady},n.prototype.isNavigating=function(){return null!=this.m_agentDestination},n.prototype.isTeleporting=function(){return this.teleporting},n.prototype.isOnOffMeshLink=function(){return this.m_agentState===e.CrowdAgentState.DT_CROWDAGENT_STATE_OFFMESH},n.prototype.getAgentType=function(){return this.type},n.prototype.getAgentState=function(){return this.m_agentState},n.prototype.getAgentIndex=function(){return this.m_agentIndex},n.prototype.getAgentOffset=function(){return this.baseOffset},n.prototype.getTargetDistance=function(){return this.distanceToTarget},n.prototype.getCurrentPosition=function(){return this.currentPosition},n.prototype.getCurrentRotation=function(){return this.currentRotation},n.prototype.getCurrentVelocity=function(){return this.currentVelocity},n.prototype.getAgentParameters=function(){return this.m_agentParams},n.prototype.setAgentParameters=function(e){this.m_agentParams=e,this.updateAgentParameters()},n.prototype.awake=function(){this.awakeNavigationAgent()},n.prototype.update=function(){this.updateNavigationAgent()},n.prototype.destroy=function(){this.destroyNavigationAgent()},n.prototype.awakeNavigationAgent=function(){this.type=this.getProperty("type",this.type),this.speed=this.getProperty("speed",this.speed),this.baseOffset=this.getProperty("offset",this.baseOffset),this.angularSpeed=this.getProperty("angularspeed",this.angularSpeed),this.acceleration=this.getProperty("acceleration",this.acceleration),this.stoppingDistance=this.getProperty("stoppingdistance",this.stoppingDistance),this.autoBraking=this.getProperty("autobraking",this.autoBraking),this.avoidRadius=this.getProperty("avoidradius",this.avoidRadius),this.avoidHeight=this.getProperty("avoidheight",this.avoidHeight),this.obstacleAvoidanceType=this.getProperty("avoidquality",this.obstacleAvoidanceType),this.avoidancePriority=this.getProperty("avoidpriority",this.avoidancePriority),this.autoTraverseOffMeshLink=this.getProperty("autotraverse",this.autoTraverseOffMeshLink),this.autoRepath=this.getProperty("autopepath",this.autoRepath),this.areaMask=this.getProperty("areamask",this.areaMask),e.Utilities.ValidateTransformQuaternion(this.transform),this.m_agentGhost=new BABYLON.TransformNode(this.transform.name+".Agent",this.scene),this.m_agentGhost.position=new BABYLON.Vector3(0,0,0),this.m_agentGhost.rotation=new BABYLON.Vector3(0,0,0),e.Utilities.ValidateTransformQuaternion(this.m_agentGhost),this.m_agentGhost.position.copyFrom(this.transform.position),this.lastPosition.copyFrom(this.transform.position)},n.prototype.updateNavigationAgent=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);if(null!=t){if(this.m_agentIndex<0)return this.m_agentParams={radius:this.avoidRadius,height:this.avoidHeight,maxSpeed:this.speed,maxAcceleration:this.acceleration,collisionQueryRange:2,pathOptimizationRange:20,separationWeight:1},e.Utilities.GetAbsolutePositionToRef(this.transform,this.resetPosition),this.m_agentIndex=t.addAgent(this.resetPosition,this.m_agentParams,this.m_agentGhost),void(this.m_agentIndex>=0&&(this.m_agentReady=!0,this.onReadyObservable&&this.onReadyObservable.hasObservers()&&this.onReadyObservable.notifyObservers(this.transform)));if(this.m_agentState=t.getAgentState(this.m_agentIndex),this.getAgentWaypointToRef(this.currentWaypoint),this.getAgentPositionToRef(this.currentPosition),this.distancePosition.copyFrom(this.currentPosition),this.isOnOffMeshLink()?(this.currentPosition.subtractToRef(this.lastPosition,this.currentVelocity),this.currentVelocity.scaleInPlace(this.speed*this.offMeshVelocity)):this.getAgentVelocityToRef(this.currentVelocity),this.onPreUpdateObservable&&this.onPreUpdateObservable.hasObservers()&&this.onPreUpdateObservable.notifyObservers(this.transform),this.currentPosition.y+=this.baseOffset+this.heightOffset,this.currentVelocity.length()>=this.velocityEpsilon){this.currentVelocity.normalize();var n=this.angularSpeed*e.NavigationAgent.ANGULAR_SPEED_RATIO*this.getDeltaSeconds();if(this.isOnOffMeshLink()){this.moveDirection.copyFrom(this.m_agentDirection),this.m_agentDirection.set(this.moveDirection.x+(this.currentVelocity.x-this.moveDirection.x),this.moveDirection.y+(this.currentVelocity.y-this.moveDirection.y),this.moveDirection.z+(this.currentVelocity.z-this.moveDirection.z)),this.m_agentDirection.normalize();var o=e.NavigationAgent.TARGET_ANGLE_FACTOR-Math.atan2(this.m_agentDirection.x,this.m_agentDirection.z);BABYLON.Quaternion.FromEulerAnglesToRef(0,o,0,this.currentRotation),this.isNavigating()&&this.updateRotation===!0&&BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.currentRotation,n,this.transform.rotationQuaternion)}else this.m_agentQuaternion.copyFrom(this.transform.rotationQuaternion),this.isNavigating()&&this.updateRotation===!0&&this.transform.lookAt(this.currentWaypoint),this.transform.rotationQuaternion.toEulerAnglesToRef(this.m_agentDirection),BABYLON.Quaternion.FromEulerAnglesToRef(0,this.m_agentDirection.y,0,this.currentRotation),this.isNavigating()&&this.updateRotation===!0&&BABYLON.Quaternion.SlerpToRef(this.m_agentQuaternion,this.currentRotation,n,this.transform.rotationQuaternion)}this.isNavigating()&&this.updatePosition===!0&&this.transform.position.copyFrom(this.currentPosition),this.isNavigating()?(this.distanceToTarget=BABYLON.Vector3.Distance(this.distancePosition,this.m_agentDestination),this.distanceToTarget<=Math.max(this.distanceEpsilon,this.stoppingDistance)&&(this.cancelNavigation(),this.onNavCompleteObservable&&this.onNavCompleteObservable.hasObservers()&&this.onNavCompleteObservable.notifyObservers(this.transform))):this.distanceToTarget=0,this.lastPosition.copyFrom(this.currentPosition),this.onPostUpdateObservable&&this.onPostUpdateObservable.hasObservers()&&this.onPostUpdateObservable.notifyObservers(this.transform),this.teleporting=!1}},n.prototype.updateAgentParameters=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);null!=t&&this.m_agentIndex>=0&&t.updateAgentParameters(this.m_agentIndex,this.m_agentParams)},n.prototype.destroyNavigationAgent=function(){this.m_agentIndex=-1,this.m_agentReady=!1,this.m_agentMovement=null,this.m_agentDirection=null,this.m_agentDestination=null,this.moveDirection=null,this.resetPosition=null,this.lastPosition=null,this.currentPosition=null,this.currentRotation=null,this.currentVelocity=null,this.currentWaypoint=null,this.onReadyObservable.clear(),this.onReadyObservable=null,this.onPreUpdateObservable.clear(),this.onPreUpdateObservable=null,this.onPostUpdateObservable.clear(),this.onPostUpdateObservable=null,this.onNavCompleteObservable.clear(),this.onNavCompleteObservable=null,null!=this.m_agentGhost&&(this.m_agentGhost.dispose(),this.m_agentGhost=null)},n.prototype.move=function(t,n){void 0===n&&(n=!0);var o=e.SceneManager.GetNavigationTools(),i=e.SceneManager.GetCrowdInterface(this.scene);null!=o&&null!=i?(i.getAgentPosition(this.m_agentIndex).addToRef(t,this.m_agentMovement),n===!0?this.m_agentDestination=o.getClosestPoint(this.m_agentMovement):this.m_agentDestination=this.m_agentMovement.clone(),this.m_agentIndex>=0&&i.agentGoto(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.teleport=function(t,n){void 0===n&&(n=!0);var o=e.SceneManager.GetNavigationTools(),i=e.SceneManager.GetCrowdInterface(this.scene);null!=o&&null!=i?(this.teleporting=!0,n===!0?this.m_agentDestination=o.getClosestPoint(t):this.m_agentDestination=t.clone(),this.m_agentIndex>=0&&i.agentTeleport(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.setDestination=function(t,n){void 0===n&&(n=!0);var o=e.SceneManager.GetNavigationTools(),i=e.SceneManager.GetCrowdInterface(this.scene);null!=o&&null!=i?(n===!0?this.m_agentDestination=o.getClosestPoint(t):this.m_agentDestination=t.clone(),this.m_agentIndex>=0&&i.agentGoto(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},n.prototype.getAgentVelocity=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);return null!=t&&this.m_agentIndex>=0?t.getAgentVelocity(this.m_agentIndex):null},n.prototype.getAgentVelocityToRef=function(t){var n=e.SceneManager.GetCrowdInterface(this.scene);null!=n&&this.m_agentIndex>=0&&n.getAgentVelocityToRef(this.m_agentIndex,t)},n.prototype.getAgentPosition=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);return null!=t&&this.m_agentIndex>=0?t.getAgentPosition(this.m_agentIndex):null},n.prototype.getAgentPositionToRef=function(t){var n=e.SceneManager.GetCrowdInterface(this.scene);null!=n&&this.m_agentIndex>=0&&n.getAgentPositionToRef(this.m_agentIndex,t)},n.prototype.getAgentWaypoint=function(){var t=e.SceneManager.GetCrowdInterface(this.scene);return null!=t&&this.m_agentIndex>=0?t.getAgentNextTargetPath(this.m_agentIndex):null},n.prototype.getAgentWaypointToRef=function(t){var n=e.SceneManager.GetCrowdInterface(this.scene);null!=n&&this.m_agentIndex>=0&&n.getAgentNextTargetPathToRef(this.m_agentIndex,t)},n.prototype.cancelNavigation=function(){this.m_agentDestination=null;
var t=e.SceneManager.GetCrowdInterface(this.scene),n=this.getAgentPosition();null!=n&&null!=t&&this.m_agentIndex>=0&&t.agentTeleport(this.m_agentIndex,n)},n.TARGET_ANGLE_FACTOR=.5*Math.PI,n.ANGULAR_SPEED_RATIO=.05,n}(e.ScriptComponent);e.NavigationAgent=t;var n;!function(e){e[e.DT_CROWDAGENT_STATE_INVALID=0]="DT_CROWDAGENT_STATE_INVALID",e[e.DT_CROWDAGENT_STATE_WALKING=1]="DT_CROWDAGENT_STATE_WALKING",e[e.DT_CROWDAGENT_STATE_OFFMESH=2]="DT_CROWDAGENT_STATE_OFFMESH"}(n=e.CrowdAgentState||(e.CrowdAgentState={}))}(UNITY||(UNITY={}));var UNITY;!function(e){var t=function(){function t(t,n,o){this._centerMass=new BABYLON.Vector3(0,0,0),this._chassisMesh=null,this._tempVectorPos=new BABYLON.Vector3(0,0,0),this.lockedWheelIndexes=null,this.m_vehicleColliders=null,this.m_vehicle=null,this.m_scene=null,this._chassisMesh=n,this._centerMass=o,this.m_vehicleColliders=null!=this._chassisMesh.metadata&&null!=this._chassisMesh.metadata.unity&&null!=this._chassisMesh.metadata.unity.wheels?this._chassisMesh.metadata.unity.wheels:null,this.m_vehicle=new e.HavokRaycastVehicle({chassisBody:this._chassisMesh.physicsBody}),this.m_scene=t,this.setupWheelInformation();var i=this.m_scene.getPhysicsEngine();null!=i&&this.m_vehicle.addToWorld(i)}return t.prototype.getNumWheels=function(){if(null!=this.m_vehicle)return this.m_vehicle.getNumWheels()},t.prototype.getWheelInfo=function(e){if(null!=this.m_vehicle)return this.m_vehicle.getWheelInfo(e)},t.prototype.setEngineForce=function(e,t){null!=this.m_vehicle&&this.m_vehicle.applyEngineForce(-e,t)},t.prototype.setBrakingForce=function(e,t){null!=this.m_vehicle&&this.m_vehicle.setBrake(e,t)},t.prototype.getWheelTransform=function(e){if(null!=this.m_vehicle)return this.m_vehicle.getWheelTransformWorld(e)},t.prototype.updateWheelTransform=function(e){null!=this.m_vehicle&&this.m_vehicle.updateWheelTransform(e)},t.prototype.getRawCurrentSpeedKph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()},t.prototype.getRawCurrentSpeedMph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()*e.System.Kph2Mph},t.prototype.getAbsCurrentSpeedKph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())},t.prototype.getAbsCurrentSpeedMph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())*e.System.Kph2Mph},t.prototype.dispose=function(){this.deleteWheelInformation(),this.m_vehicleColliders=null},t.prototype.getWheelIndexByID=function(e){var t=-1;if(null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0)for(var n=0;n<this.m_vehicleColliders.length;n++){var o=this.m_vehicleColliders[n];if(e.toLowerCase()===o.id.toLowerCase()){t=n;break}}return t},t.prototype.getWheelIndexByName=function(e){var t=-1;if(null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0)for(var n=0;n<this.m_vehicleColliders.length;n++){var o=this.m_vehicleColliders[n];if(e.toLowerCase()===o.name.toLowerCase()){t=n;break}}return t},t.prototype.getWheelColliderInfo=function(e){var t=-1;return null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0&&this.m_vehicleColliders.length>e&&(t=this.m_vehicleColliders[e]),t},t.prototype.getVisualSteeringAngle=function(e){var t=0,n=this.getWheelInfo(e);return null!=n&&null!=n.steeringAngle&&(t=n.steeringAngle),t},t.prototype.setVisualSteeringAngle=function(e,t){var n=this.getWheelInfo(t);null!=n&&(n.steeringAngle=e)},t.prototype.getPhysicsSteeringAngle=function(e){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getSteeringValue(e))},t.prototype.setPhysicsSteeringAngle=function(e,t){null!=this.m_vehicle&&this.m_vehicle.setSteeringValue(e,t)},t.prototype.getStabilizingForce=function(){var e=-1;return null!=this.m_vehicle&&null!=this.m_vehicle.chassisBody&&(e=this.m_vehicle.chassisBody.getGravityFactor()),e},t.prototype.setStabilizingForce=function(e){null!=this.m_vehicle&&null!=this.m_vehicle.chassisBody&&this.m_vehicle.chassisBody.setGravityFactor(e)},t.prototype.getSmoothFlyingImpulse=function(){var e=-1;return null!=this.m_vehicle&&(e=this.m_vehicle.smoothFlyingImpulse),e},t.prototype.setSmoothFlyingImpulse=function(e){null!=this.m_vehicle&&(this.m_vehicle.smoothFlyingImpulse=e)},t.prototype.setupWheelInformation=function(){if(null!=this.m_vehicle&&null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0){var e=-1,t=0;for(e=0;e<this.m_vehicleColliders.length;e++){var n=this.m_vehicleColliders[e],o=null!=n.name?n.name:"Unknown",i=null!=n.radius?n.radius:.35,r=null!=n.position&&n.position.length>=3?n.position[0]:1,a=null!=n.position&&n.position.length>=3?n.position[2]:-1,l=null!=n.wheelconnectionpoint?n.wheelconnectionpoint:.5,s=null!=n.suspensionrestlength?n.suspensionrestlength:.3,u=null!=n.frontwheel||o.toLowerCase().indexOf("front")>=0,c=a,d=r,p=-this._centerMass.x,h=-this._centerMass.z;t=null!=n.frictionslip?n.frictionslip:10;var m=null!=n.totalsuspensionforces?n.totalsuspensionforces:1e5,f=null!=n.suspensiontravelcm?n.suspensiontravelcm:100,g=null!=n.rollinfluence?n.rollinfluence:.2,y=null!=n.suspensionstiffness?n.suspensionstiffness:50,v=null!=n.dampingcompression?n.dampingcompression:2.5,_=null!=n.dampingrelaxation?n.dampingrelaxation:4.5,B=new BABYLON.Vector3(d+p,l,c+h);this.m_vehicle.addWheel({radius:i,isFrontWheel:u,directionLocal:new BABYLON.Vector3(0,(-1),0),suspensionStiffness:y,suspensionRestLength:s,frictionSlip:t,dampingRelaxation:_,dampingCompression:v,maxSuspensionForce:m,rollInfluence:g,axleLocal:new BABYLON.Vector3((-1),0,0),chassisConnectionPointLocal:B,maxSuspensionTravel:f})}if(this.m_vehicle.getNumWheels()===this.m_vehicleColliders.length)for(e=0;e<this.m_vehicleColliders.length;e++){var b=this.m_vehicle.getWheelInfo(e);null!=b&&(b.steeringAngle=0,b.rotationBoost=0,b.defaultFriction=t)}else BABYLON.Tools.Warn("Failed to create proper number of wheels for: "+this._chassisMesh.name)}},t.prototype.tickVehicleController=function(e){null!=this.m_vehicle&&this.m_vehicle.updateVehicle(e)},t.prototype.updateWheelInformation=function(){var t=this.m_vehicle.getCurrentSpeedKmHour(),n=this.getNumWheels();if(n>0)for(var o=0;o<n;o++){var i=this.getWheelInfo(o);if(null!=i){i.locked=this.lockedWheelInformation(o),this.updateWheelTransform(o);var r=this.getWheelTransform(o);if(null!=r&&this._tempVectorPos.copyFrom(r.position),null!=i.hub){var a=i.hub;if(null!=a.parent){e.Utilities.InverseTransformPointToRef(a.parent,this._tempVectorPos,this._tempVectorPos),a.position.y=this._tempVectorPos.y;var l=null!=i.steeringAngle?i.steeringAngle:0;if(BABYLON.Quaternion.FromEulerAnglesToRef(0,l,0,a.rotationQuaternion),null!=i.spinner&&i.locked===!1){var s=this.m_scene.getEngine().getDeltaTime()/1e3,u=t*s,c=2*Math.PI*i.radius,d=u/c*360,p=null!=i.rotationBoost?i.rotationBoost:0,h=BABYLON.Tools.ToRadians(d)+p*Math.sign(t);i.spinner.addRotation(h,0,0)}}}}}},t.prototype.lockedWheelInformation=function(e){var t=!1;if(null!=this.lockedWheelIndexes&&this.lockedWheelIndexes.length>0)for(var n=0;n<this.lockedWheelIndexes.length;n++)if(this.lockedWheelIndexes[n]===e){t=!0;break}return t},t.prototype.deleteWheelInformation=function(){var e=this.getNumWheels();if(e>0)for(var t=0;t<e;t++){var n=this.getWheelInfo(t);null!=n&&(n.hub=null,n.spinner=null,n.steeringAngle=0,n.rotationBoost=0,n.defaultFriction=0)}},t}();e.RaycastVehicle=t}(UNITY||(UNITY={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,r){function a(e){try{s(o.next(e))}catch(t){r(t)}}function l(e){try{s(o["throw"](e))}catch(t){r(t)}}function s(e){e.done?n(e.value):i(e.value).then(a,l)}s((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(i)throw new TypeError("Generator is already executing.");for(;l&&(l=0,n[0]&&(s=0)),s;)try{if(i=1,r&&(a=2&n[0]?r["return"]:n[0]?r["throw"]||((a=r["return"])&&a.call(r),0):r.next)&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(o){n=[6,o],r=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,r,a,l,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l},UNITY;!function(e){var t=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._isKinematic=!1,e._centerOfMass=new BABYLON.Vector3(0,0,0),e.m_raycastVehicle=null,e}return __extends(n,t),n.prototype.awake=function(){this.awakeRigidbodyState()},n.prototype.update=function(){this.updateRigidbodyState()},n.prototype.late=function(){this.lateRigidbodyState()},n.prototype.destroy=function(){this.destroyRigidbodyState()},n.prototype.awakeRigidbodyState=function(){this._isKinematic=this.getProperty("isKinematic",this._isKinematic),null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.physics&&(this._centerOfMass=null!=this.transform.metadata.unity.physics.center?e.Utilities.ParseVector3(this.transform.metadata.unity.physics.center,this._centerOfMass):this._centerOfMass),this.hasWheelColliders()&&(this.m_raycastVehicle=new e.RaycastVehicle(this.scene,this.transform,this._centerOfMass),e.Utilities.ShowDebugColliders()&&console.log("Raycase Vehicle Created For: "+this.transform.name))},n.prototype.updateRigidbodyState=function(){null!=this.m_raycastVehicle&&this.m_raycastVehicle.updateWheelInformation()},n.prototype.lateRigidbodyState=function(){null!=this.m_raycastVehicle&&this.m_raycastVehicle.tickVehicleController(e.RigidbodyPhysics.PHYSICS_STEP_TIME)},n.prototype.destroyRigidbodyState=function(){null!=this.m_raycastVehicle&&(this.m_raycastVehicle.dispose(),this.m_raycastVehicle=null)},n.prototype.isKinematic=function(){return this._isKinematic},n.prototype.hasWheelColliders=function(){return null!=this.transform.metadata&&null!=this.transform.metadata.unity&&null!=this.transform.metadata.unity.wheels},n.prototype.getRaycastVehicle=function(){return this.m_raycastVehicle},n.GetHavokInstance=function(){return globalThis.HK},n.GetHavokPlugin=function(){return globalThis.HKP},n.RaycastToRef=function(t,n,o,i){var r=e.RigidbodyPhysics.GetHavokPlugin();return r?void r.raycast(t,n,o,i):void BABYLON.Tools.Warn("Havok.js physics library not loaded")},n.SetMaxVelocities=function(t,n){var o=e.RigidbodyPhysics.GetHavokPlugin();if(!o)return void BABYLON.Tools.Warn("Havok.js physics library not loaded");var i=o._hknp.HEAP8.buffer,r=new Int32Array(i,Number(o.world),100),a=new Int32Array(i,r[8],500),l=new Int32Array(i,a[428],100),s=new Float32Array(i,l[8],300);s[32]=t,s[33]=n,s[60]=t,s[61]=n,s[88]=t,s[89]=n,s[144]=t,s[145]=n,s[172]=t,s[173]=n,s[200]=t,s[201]=n,s[228]=t},n.ConfigurePhysicsEngine=function(t,n,o,i,r,a,l){var s;return void 0===n&&(n=!0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===r&&(r=!0),void 0===a&&(a=1e-4),void 0===l&&(l=null),__awaiter(this,void 0,void 0,function(){var i,r,a,u,c,d;return __generator(this,function(p){switch(p.label){case 0:if(!BABYLON.HavokPlugin)return[3,8];BABYLON.Tools.Log("Havok.js physics engine initializing..."),p.label=1;case 1:return p.trys.push([1,6,7,8]),t.isPhysicsEnabled()?[3,4]:(i=e.RigidbodyPhysics.GetHavokInstance(),null!=i?[3,3]:(r=globalThis,[4,BABYLON.HavokPhysics()]));case 2:r.HK=p.sent(),i=globalThis.HK,p.label=3;case 3:return a=new BABYLON.Vector3(0,(-9.81),0),u=null!=l?l:a,globalThis.HKP=new BABYLON.HavokPlugin(n,i),t.enablePhysics(u,globalThis.HKP),[3,5];case 4:BABYLON.Tools.Warn("Havok.js physics plugin already enabled"),p.label=5;case 5:return[3,8];case 6:return c=p.sent(),console.warn(c),[3,8];case 7:e.RigidbodyPhysics.PhysicsShapeCache={},e.RigidbodyPhysics.NewPhysicsShapeCount=0,e.RigidbodyPhysics.CachedPhysicsShapeCount=0;try{o>0&&(null===(s=t.getPhysicsEngine())||void 0===s?void 0:s.setSubTimeStep(o)),d=e.RigidbodyPhysics.GetPhysicsHeapSize(),BABYLON.Tools.Log("Havok.js initialized with a heap size of "+d+" MB")}catch(h){console.warn(h)}try{null!=e.RigidbodyPhysics.OnSetupPhysicsPlugin&&e.RigidbodyPhysics.OnSetupPhysicsPlugin(t)}catch(m){console.warn(m)}return[7];case 8:return[2]}})})},n.SetupPhysicsComponent=function(t,n){var o=null!=n.metadata&&null!=n.metadata.unity?n.metadata.unity:null,i=null!=o.layermask?o.layermask:-1;if(null!=o&&(null!=o.physics||null!=o.collision)){var r=null!=o.physics,a=null!=o.physics&&null!=o.physics.filter?o.physics.filter:-1,l=null!=o.physics&&null!=o.physics.vehicle&&o.physics.vehicle,s=null!=o.physics&&null!=o.physics.root&&o.physics.root,u=null!=o.collision&&null!=o.collision.compoundcolliders,c=null!=o.physics&&null!=o.physics.mass?o.physics.mass:0,d=null!=o.physics&&null!=o.physics.center?o.physics.center:{x:0,y:0,z:0},p=null==o.physics||null==o.physics.kinematic||o.physics.kinematic,h=null==o.physics||null==o.physics.truestatic||o.physics.truestatic,m=BABYLON.PhysicsMotionType.DYNAMIC;if(m=h===!0?BABYLON.PhysicsMotionType.STATIC:p===!0?BABYLON.PhysicsMotionType.ANIMATED:BABYLON.PhysicsMotionType.DYNAMIC,r===!0){if(l){var f=null,g=n.getChildren(null,!1);null!=g&&g.length>0&&g.forEach(function(t){if(null!=t.metadata&&null!=t.metadata.unity&&null!=t.metadata.unity.collision){var o=t.metadata.unity.collision,i=null!=o.wheelinformation?o.wheelinformation:null;null!=i&&(e.Utilities.ShowDebugColliders()&&console.log("Setup raycast wheel collider: "+t.name+" --> on to: "+n.name,n),null==f&&(f=[]),f.push(i))}}),null!=f&&f.length>0&&(null==n.metadata&&(n.metadata={}),null==n.metadata.unity&&(n.metadata.unity={}),n.metadata.unity.wheels=f)}if(u){var y=o.collision.compoundcolliders;if(null!=y&&y.length>0){var v=0,_=0,B=0,b=!1,C=[];if(y.forEach(function(o){var r=null!=o.type?o.type:"BoxCollider",l=null!=o.dynamicfriction?o.dynamicfriction:.6,s=null!=o.staticfriction?o.staticfriction:.6,u=null!=o.restitution?o.restitution:0,c=null!=o.trigger&&o.trigger;l>v&&(v=l),s>_&&(_=s),u>B&&(B=u),1==c&&(b=!0);var d=BABYLON.PhysicsImpostor.BoxImpostor;d="MeshCollider"===r?BABYLON.PhysicsImpostor.ConvexHullImpostor:"CapsuleCollider"===r?BABYLON.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===r?BABYLON.PhysicsImpostor.SphereImpostor:BABYLON.PhysicsImpostor.BoxImpostor;var p=o,h=null!=p.center?p.center:{x:0,y:0,z:0},m=null!=p.persist&&p.persist,f=new e.PhyscisContainerData;e.Utilities.ShowDebugColliders()&&console.log("Setup simple compound child collider type ("+r+") --> on to: "+n.name,n),e.RigidbodyPhysics.CreateCompoundPhysicsShapeAndBody(t,n,n,p,d,l,u,C,f,h,!1,c,m,i,a)}),C.length>0){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var T=new BABYLON.Vector3(d.x,d.y,d.z),I=new BABYLON.PhysicsShapeContainer(t);C.forEach(function(e){I.addChild(e.shape,e.translation,e.rotation,e.scale)});var S=new BABYLON.PhysicsBody(n,m,(!1),t);S.shape=I,e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,b,o.physics,c,T),e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(S))}}}else if(s){var A=0,O=0,x=0,M=!1,N=[],L=null!=o.physics&&null!=o.physics.center?e.Utilities.ParseVector3(o.physics.center,BABYLON.Vector3.Zero()):BABYLON.Vector3.Zero(),w=n.getChildren(null,!0);null!=w&&w.length>0&&w.forEach(function(e){e.position.subtractInPlace(L)});var P=n.getChildren(null,!1);if(null!=P&&P.length>0&&P.forEach(function(o){if(null!=o.metadata&&null!=o.metadata.unity&&null!=o.metadata.unity.collision){var r=o.metadata.unity.collision,l=null!=r.dynamicfriction?r.dynamicfriction:.6,u=null!=r.staticfriction?r.staticfriction:.6,c=null!=r.restitution?r.restitution:0,d=null!=r.trigger&&r.trigger,p=null!=r.type?r.type:"BoxCollider";l>A&&(A=l),u>O&&(O=u),c>x&&(x=c),1==d&&(M=!0);var h=BABYLON.PhysicsImpostor.BoxImpostor;h="MeshCollider"===p?BABYLON.PhysicsImpostor.ConvexHullImpostor:"CapsuleCollider"===p?BABYLON.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===p?BABYLON.PhysicsImpostor.SphereImpostor:BABYLON.PhysicsImpostor.BoxImpostor;var m=r,f=null!=m.center?m.center:{x:0,y:0,z:0},g=null!=m.persist&&m.persist,y=new e.PhyscisContainerData;e.Utilities.ShowDebugColliders()&&console.log("Setup complex compound child collider type ("+p+") --> on to: "+n.name,n),e.RigidbodyPhysics.CreateCompoundPhysicsShapeAndBody(t,n,o,m,h,l,c,N,y,f,s,d,g,i,a)}}),N.length>0){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var T=new BABYLON.Vector3(d.x,d.y,d.z),U=new BABYLON.PhysicsShapeContainer(t);N.forEach(function(e){U.addChild(e.shape,e.translation,e.rotation,e.scale)});var R=new BABYLON.PhysicsBody(n,m,(!1),t);R.shape=U,e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,M,o.physics,c,T),e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(R))}}else if(null!=o.collision){var k=null!=o.collision.type?o.collision.type:"BoxCollider",Y=null!=o.collision.convexmesh&&o.collision.convexmesh,D=null!=o.collision.dynamicfriction?o.collision.dynamicfriction:.6,F=null!=o.collision.staticfriction?o.collision.staticfriction:.6,V=null!=o.collision.restitution?o.collision.restitution:0,E=null!=o.collision.terraindata?o.collision.terraindata:null,G=null!=o.collision.trigger&&o.collision.trigger,H=null!=o.collision.persist&&o.collision.persist,z=BABYLON.PhysicsImpostor.BoxImpostor;z="MeshCollider"===k?Y===!0?BABYLON.PhysicsImpostor.ConvexHullImpostor:BABYLON.PhysicsImpostor.MeshImpostor:"TerrainCollider"===k?BABYLON.PhysicsImpostor.HeightmapImpostor:"CapsuleCollider"===k?BABYLON.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===k?BABYLON.PhysicsImpostor.SphereImpostor:BABYLON.PhysicsImpostor.BoxImpostor,e.RigidbodyPhysics.CreateStandardPhysicsShapeAndBody(t,n,o,z,G,h,m,c,F,D,V,E,d,H,i,a)}}}},n.GetCachedPhysicsMeshShape=function(t,n,o,i,r,a,l){if(null==o||""===o)return console.warn("Invalid mesh key specfifed for child collider: "+n.name),null;o+="_F"+i+"_R"+r+"_T0_L"+a+"_X"+l;var s=e.RigidbodyPhysics.PhysicsShapeCache[o];return null==s?(s=new BABYLON.PhysicsShapeMesh(n,t),s.material={friction:i,restitution:r},s.isTrigger=!1,s.filterMembershipMask=a,s.filterCollideMask=l,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[o]=s):e.RigidbodyPhysics.CachedPhysicsShapeCount++,s},n.GetCachedPhysicsConvexHullShape=function(t,n,o,i,r,a,l){if(null==o||""===o)return console.warn("Invalid mesh key specfifed for child collider: "+n.name),null;o+="_F"+i+"_R"+r+"_T0_L"+a+"_X"+l;var s=e.RigidbodyPhysics.PhysicsShapeCache[o];return null==s?(s=new BABYLON.PhysicsShapeConvexHull(n,t),s.material={friction:i,restitution:r},s.isTrigger=!1,s.filterMembershipMask=a,s.filterCollideMask=l,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[o]=s):e.RigidbodyPhysics.CachedPhysicsShapeCount++,s},n.GetCachedPhysicsBoxShape=function(t,n,o,i,r,a){var l="SHAPE_BOX_F"+o+"_R"+i+"_T"+(1==n?"1":"0")+"_L"+r+"_X"+a,s=e.RigidbodyPhysics.PhysicsShapeCache[l];return null==s?(s=new BABYLON.PhysicsShapeBox(new BABYLON.Vector3(0,0,0),new BABYLON.Quaternion(0,0,0,1),new BABYLON.Vector3(1,1,1),t),s.material={friction:o,restitution:i},s.isTrigger=n,s.filterMembershipMask=r,s.filterCollideMask=a,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[l]=s):e.RigidbodyPhysics.CachedPhysicsShapeCount++,s},n.GetCachedPhysicsSphereShape=function(t,n,o,i,r,a){var l="SHAPE_SPHERE_F"+o+"_R"+i+"_T"+(1==n?"1":"0")+"_L"+r+"_X"+a,s=e.RigidbodyPhysics.PhysicsShapeCache[l],u=1;return null==s?(s=new BABYLON.PhysicsShapeSphere(new BABYLON.Vector3(0,0,0),u,t),s.material={friction:o,restitution:i},s.isTrigger=n,s.filterMembershipMask=r,s.filterCollideMask=a,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[l]=s):e.RigidbodyPhysics.CachedPhysicsShapeCount++,s},n.GetCachedPhysicsCapsuleShape=function(t,n,o,i,r,a){var l="SHAPE_CAPSULE_F"+o+"_R"+i+"_T"+(1==n?"1":"0")+"_L"+r+"_X"+a,s=e.RigidbodyPhysics.PhysicsShapeCache[l],u=1,c=1,d=-(.5*(u+c)),p=.5*(u+c),h=1;return null==s?(s=new BABYLON.PhysicsShapeCapsule(new BABYLON.Vector3(0,d,0),new BABYLON.Vector3(0,p,0),h,t),s.material={friction:o,restitution:i},s.isTrigger=n,s.filterMembershipMask=r,s.filterCollideMask=a,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[l]=s):e.RigidbodyPhysics.CachedPhysicsShapeCount++,s},n.GetCachedPhysicsCylinderShape=function(t,n,o,i,r,a){var l="SHAPE_CYLINDER_F"+o+"_R"+i+"_T"+(1==n?"1":"0")+"_L"+r+"_X"+a,s=e.RigidbodyPhysics.PhysicsShapeCache[l],u=1,c=-(.5*u),d=.5*u,p=1;return null==s?(s=new BABYLON.PhysicsShapeCylinder(new BABYLON.Vector3(0,c,0),new BABYLON.Vector3(0,d,0),p,t),s.material={friction:o,restitution:i},s.isTrigger=n,s.filterMembershipMask=r,s.filterCollideMask=a,e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[l]=s):e.RigidbodyPhysics.CachedPhysicsShapeCount++,s},n.CreateStandardPhysicsShapeAndBody=function(t,n,o,i,r,a,l,s,u,c,d,p,h,m,f,g){var y=o.collision,v=null!=y.meshkey?y.meshkey:null,_=null!=y.center?y.center:{x:0,y:0,z:0};if(i==BABYLON.PhysicsImpostor.HeightmapImpostor)if(null!=p){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var B=n,b=p.index,C=p.segments,T=p.resolution,I=p.width,S=(p.height,p.length),A=1,O=1,x=0,M=0;if(1===C)A=I/(T-1),O=S/(T-1),x=.5*(I+A),M=.5*(S-O);else if(2===C){var N=I/C,L=S/C;A=I/(T-1),O=S/(T-1),0===b?(x=.5*(N+A)+0,M=.5*(L-O)+0):1===b?(x=.5*(1*N+A)+0,M=.5*(L-O)+L):2===b?(x=.5*(1*N+A)+N,M=.5*(L-O)+0):3===b&&(x=.5*(1*N+A)+N,M=.5*(L-O)+L)}var w=e.RigidbodyPhysics.CreateHeightFieldTerrainShapeFromMesh(B,A,O),P=new BABYLON.PhysicsShape({type:BABYLON.PhysicsShapeType.HEIGHTFIELD,pluginData:w},t);P.filterMembershipMask=f,P.filterCollideMask=g,P.material={friction:u,restitution:d};var U="TERRAIN_MESH_ID"+B.uniqueId+"_F"+u+"_R"+d+"_T0_L"+f+"_X"+g;e.RigidbodyPhysics.NewPhysicsShapeCount++,e.RigidbodyPhysics.PhysicsShapeCache[U]=P;var R=new BABYLON.Vector3(x,0,M),k=new BABYLON.Quaternion(0,0,0,1),Y=new BABYLON.Vector3(1,1,1),D=new BABYLON.PhysicsShapeContainer(t);e.Utilities.FromEulerToRef(0,90,0,k),P.isTrigger=!1,D.addChild(P,R,k,Y);var F=new BABYLON.PhysicsBody(n,BABYLON.PhysicsMotionType.STATIC,(!1),t);F.shape=D,e.Utilities.ShowDebugColliders()&&console.log("Setup standard terrain heightmap physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,r,o.physics,0,new BABYLON.Vector3(h.x,h.y,h.z)),e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(F))}else BABYLON.Tools.Warn("No terrain collision data found for: "+n.name+". No terrain collision impostor will be created.");else if(i==BABYLON.PhysicsImpostor.MeshImpostor){var V=e.SceneManager.FindChildTransformNode(n,n.name+".Collider",e.SearchType.ExactMatch,!0);if(null!=V){m===!1&&e.Utilities.AddLoaderItemMarkedForDisposal(V),e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var E=e.RigidbodyPhysics.GetCachedPhysicsMeshShape(t,V,v,u,d,f,g),G=new BABYLON.PhysicsShapeContainer(t);e.RigidbodyPhysics.AddChildShapeFromParent(G,n,E,V);var H=new BABYLON.PhysicsBody(n,BABYLON.PhysicsMotionType.STATIC,(!1),t);H.shape=G,e.Utilities.ShowDebugColliders()&&console.log("Setup standard mesh physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,r,o.physics,0,new BABYLON.Vector3(h.x,h.y,h.z)),e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(H))}else BABYLON.Tools.Warn("No mesh collider found for: "+n.name+".")}else if(i==BABYLON.PhysicsImpostor.ConvexHullImpostor){var z=e.SceneManager.FindChildTransformNode(n,n.name+".Collider",e.SearchType.ExactMatch,!0);if(null!=z){m===!1&&e.Utilities.AddLoaderItemMarkedForDisposal(z),e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var W=e.RigidbodyPhysics.GetCachedPhysicsConvexHullShape(t,z,v,a?u:c,d,f,g),Q=new BABYLON.PhysicsShapeContainer(t);e.RigidbodyPhysics.AddChildShapeFromParent(Q,n,W,z);var X=new BABYLON.PhysicsBody(n,l,(!1),t);X.shape=Q,e.Utilities.ShowDebugColliders()&&console.log("Setup standard convex hull physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!0,!1,o.physics,s,new BABYLON.Vector3(h.x,h.y,h.z)),e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(X))}else BABYLON.Tools.Warn("No convex hull child mesh collider found for: "+n.name+".")}else if(i==BABYLON.PhysicsImpostor.BoxImpostor){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var j=null!=y.boxsize?y.boxsize:{x:1,y:1,z:1},K=j.x*parseFloat(n.scaling.x.toFixed(4)),q=j.y*parseFloat(n.scaling.y.toFixed(4)),Z=j.z*parseFloat(n.scaling.z.toFixed(4)),J=_.x*parseFloat(n.scaling.x.toFixed(4)),$=_.y*parseFloat(n.scaling.y.toFixed(4)),ee=_.z*parseFloat(n.scaling.z.toFixed(4)),te=new BABYLON.Vector3(J,$,ee),ne=e.RigidbodyPhysics.GetCachedPhysicsBoxShape(t,r,a?u:c,d,f,g);ne.material={friction:a?u:c,restitution:d};var oe=new BABYLON.PhysicsShapeContainer(t);oe.addChild(ne,te,new BABYLON.Quaternion(0,0,0,1),new BABYLON.Vector3(K,q,Z));var ie=new BABYLON.PhysicsBody(n,l,(!1),t);ie.shape=oe,e.Utilities.ShowDebugColliders()&&console.log("Setup standard box physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,!1,o.physics,s,te.add(new BABYLON.Vector3(h.x,h.y,h.z))),e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(ie))}else if(i==BABYLON.PhysicsImpostor.SphereImpostor){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var re=null!=y.sphereradius?y.sphereradius:.5,ae=parseFloat(n.scaling.x.toFixed(4)),le=parseFloat(n.scaling.y.toFixed(4)),se=parseFloat(n.scaling.z.toFixed(4)),ue=Math.max(ae,le,se)*re,J=_.x*parseFloat(n.scaling.x.toFixed(4)),$=_.y*parseFloat(n.scaling.y.toFixed(4)),ee=_.z*parseFloat(n.scaling.z.toFixed(4)),te=new BABYLON.Vector3(J,$,ee),ce=e.RigidbodyPhysics.GetCachedPhysicsSphereShape(t,r,a?u:c,d,f,g);ce.material={friction:a?u:c,restitution:d};var de=new BABYLON.PhysicsShapeContainer(t);de.addChild(ce,te,new BABYLON.Quaternion(0,0,0,1),new BABYLON.Vector3(ue,ue,ue));var pe=new BABYLON.PhysicsBody(n,l,(!1),t);pe.shape=de,e.Utilities.ShowDebugColliders()&&console.log("Setup standard sphere physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,!1,o.physics,s,te.add(new BABYLON.Vector3(h.x,h.y,h.z))),e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(pe))}else if(i==BABYLON.PhysicsImpostor.CapsuleImpostor){e.Utilities.ReparentColliders()||n.setParent(null,!0,!0);var he=null!=y.cylinder&&y.cylinder,me=null!=y.capsulesize?y.capsulesize:{x:.5,y:2,z:1},fe=me.x*parseFloat(n.scaling.x.toFixed(4)),ge=me.y*parseFloat(n.scaling.y.toFixed(4)),ye=(parseFloat(n.scaling.z.toFixed(4)),null);ye=he===!0?e.RigidbodyPhysics.GetCachedPhysicsCylinderShape(t,r,a?u:c,d,f,g):e.RigidbodyPhysics.GetCachedPhysicsCapsuleShape(t,r,a?u:c,d,f,g),ye.material={friction:a?u:c,restitution:d};var ve=new BABYLON.Quaternion(0,0,0,1);0!==me.z&&2!==me.z||(0===me.z?e.Utilities.FromEulerToRef(0,0,90,ve):2===me.z&&e.Utilities.FromEulerToRef(90,0,0,ve));var J=_.x*parseFloat(n.scaling.x.toFixed(4)),$=_.y*parseFloat(n.scaling.y.toFixed(4)),ee=_.z*parseFloat(n.scaling.z.toFixed(4)),te=new BABYLON.Vector3(J,$,ee),_e=new BABYLON.PhysicsShapeContainer(t);he===!0?_e.addChild(ye,te,ve,new BABYLON.Vector3(fe,ge,fe)):_e.addChild(ye,te,ve,new BABYLON.Vector3(fe,ge,fe));var Be=new BABYLON.PhysicsBody(n,l,(!1),t);Be.shape=_e,e.Utilities.ShowDebugColliders()&&console.log("Setup standard "+(he===!0?"cylinder":"capsule")+" physics collider for: "+n.name,n),e.RigidbodyPhysics.ConfigRigidbodyPhysics(t,n,!1,!1,o.physics,s,te.add(new BABYLON.Vector3(h.x,h.y,h.z))),e.Utilities.ShowDebugColliders()||"CenterBox-Material"===n.material.name&&(n.isVisible=!1),e.Utilities.ShowDebugColliders()&&(null==e.RigidbodyPhysics.DebugPhysicsViewer&&(e.RigidbodyPhysics.DebugPhysicsViewer=new BABYLON.PhysicsViewer),null!=e.RigidbodyPhysics.DebugPhysicsViewer&&e.RigidbodyPhysics.DebugPhysicsViewer.showBody(Be))}},n.CreateCompoundPhysicsShapeAndBody=function(t,n,o,i,r,a,l,s,u,c,d,p,h,m,f){var g=0,y=0,v=0,_=new BABYLON.Vector3(0,0,0),B=new BABYLON.Quaternion(0,0,0,1),b=new BABYLON.Vector3(1,1,1);if(h===!1&&d===!0&&e.Utilities.AddLoaderItemMarkedForDisposal(o),r==BABYLON.PhysicsImpostor.ConvexHullImpostor){var C=e.SceneManager.FindChildTransformNode(o,o.name+".Collider",e.SearchType.ExactMatch,!0);if(null!=C){var T=1,I=1,S=1;if(C instanceof BABYLON.InstancedMesh){d===!0&&(T*=parseFloat(n.scaling.x.toFixed(4)),I*=parseFloat(n.scaling.y.toFixed(4)),S*=parseFloat(n.scaling.z.toFixed(4))),b.set(T,I,S);var A=C.sourceMesh;if(null!=A){var O=null!=C.metadata&&null!=C.metadata.unity&&null!=C.metadata.unity.collision&&null!=C.metadata.unity.collision.sourcescale?C.metadata.unity.collision.sourcescale:null,x=null!=A.metadata&&null!=A.metadata.unity&&null!=A.metadata.unity.collision&&null!=A.metadata.unity.collision.sourcescale?A.metadata.unity.collision.sourcescale:null;if(null!=x&&null!=O){var M=new BABYLON.Vector3(1,1,1),N=new BABYLON.Vector3(O.x,O.y,O.z),L=new BABYLON.Vector3(x.x,x.y,x.z);N.divideToRef(L,M),b.multiplyInPlace(M)}}}else b.set(T,I,S);var w=null!=i.meshkey?i.meshkey:null,P=e.RigidbodyPhysics.GetCachedPhysicsConvexHullShape(t,C,w,a,l,m,f);if(d===!0){var U=o.position.x*parseFloat(n.scaling.x.toFixed(4)),R=o.position.y*parseFloat(n.scaling.y.toFixed(4)),k=o.position.z*parseFloat(n.scaling.z.toFixed(4));_.set(U,R,k),B.multiplyInPlace(o.rotationQuaternion);
}else g=c.x*parseFloat(o.scaling.x.toFixed(4)),y=c.y*parseFloat(o.scaling.y.toFixed(4)),v=c.z*parseFloat(o.scaling.z.toFixed(4)),_.set(g,y,v);u.shape=P,u.translation=_,u.rotation=B,u.scale=b,s.push(u)}}else if(r==BABYLON.PhysicsImpostor.CapsuleImpostor){var Y=null!=i.cylinder&&i.cylinder,D=null!=i.capsulesize?i.capsulesize:{x:.5,y:2,z:1},F=D.x*parseFloat(o.scaling.x.toFixed(4)),V=D.y*parseFloat(o.scaling.y.toFixed(4)),E=parseFloat(o.scaling.z.toFixed(4));d===!0&&(F*=parseFloat(n.scaling.x.toFixed(4)),V*=parseFloat(n.scaling.y.toFixed(4)),E*=parseFloat(n.scaling.z.toFixed(4))),b.set(F,V,F);var G=null;if(G=Y===!0?e.RigidbodyPhysics.GetCachedPhysicsCylinderShape(t,p,a,l,m,f):e.RigidbodyPhysics.GetCachedPhysicsCapsuleShape(t,p,a,l,m,f),0!==D.z&&2!==D.z||(0===D.z?e.Utilities.FromEulerToRef(0,0,90,B):2===D.z&&e.Utilities.FromEulerToRef(90,0,0,B)),d===!0){0===c.x&&0===c.y&&0===c.z||console.warn("WARNING: Center offset not supported for complex compound item: "+o.name);var U=o.position.x*parseFloat(n.scaling.x.toFixed(4)),R=o.position.y*parseFloat(n.scaling.y.toFixed(4)),k=o.position.z*parseFloat(n.scaling.z.toFixed(4));_.set(U,R,k),B.multiplyInPlace(o.rotationQuaternion)}else g=c.x*parseFloat(o.scaling.x.toFixed(4)),y=c.y*parseFloat(o.scaling.y.toFixed(4)),v=c.z*parseFloat(o.scaling.z.toFixed(4)),_.set(g,y,v);u.shape=G,u.translation=_,u.rotation=B,u.scale=b,s.push(u)}else if(r==BABYLON.PhysicsImpostor.SphereImpostor){var H=null!=i.sphereradius?i.sphereradius:.5,z=parseFloat(o.scaling.x.toFixed(4)),W=parseFloat(o.scaling.y.toFixed(4)),Q=parseFloat(o.scaling.z.toFixed(4)),X=Math.max(z,W,Q)*H;if(d===!0){var j=parseFloat(n.scaling.x.toFixed(4)),K=parseFloat(n.scaling.y.toFixed(4)),q=parseFloat(n.scaling.z.toFixed(4));X*=Math.max(j,K,q)}b.set(X,X,X);var Z=e.RigidbodyPhysics.GetCachedPhysicsSphereShape(t,p,a,l,m,f);if(d===!0){0===c.x&&0===c.y&&0===c.z||console.warn("WARNING: Center offset not supported for complex compound item: "+o.name);var U=o.position.x*parseFloat(n.scaling.x.toFixed(4)),R=o.position.y*parseFloat(n.scaling.y.toFixed(4)),k=o.position.z*parseFloat(n.scaling.z.toFixed(4));_.set(U,R,k),B.multiplyInPlace(o.rotationQuaternion)}else g=c.x*parseFloat(o.scaling.x.toFixed(4)),y=c.y*parseFloat(o.scaling.y.toFixed(4)),v=c.z*parseFloat(o.scaling.z.toFixed(4)),_.set(g,y,v);u.shape=Z,u.translation=_,u.rotation=B,u.scale=b,s.push(u)}else if(r==BABYLON.PhysicsImpostor.BoxImpostor){var J=null!=i.boxsize?i.boxsize:{x:1,y:1,z:1},$=J.x*parseFloat(o.scaling.x.toFixed(4)),ee=J.y*parseFloat(o.scaling.y.toFixed(4)),te=J.z*parseFloat(o.scaling.z.toFixed(4));d===!0&&($*=parseFloat(n.scaling.x.toFixed(4)),ee*=parseFloat(n.scaling.y.toFixed(4)),te*=parseFloat(n.scaling.z.toFixed(4))),b.set($,ee,te);var ne=e.RigidbodyPhysics.GetCachedPhysicsBoxShape(t,p,a,l,m,f);if(d===!0){0===c.x&&0===c.y&&0===c.z||console.warn("WARNING: Center offset not supported for complex compound item: "+o.name);var U=o.position.x*parseFloat(n.scaling.x.toFixed(4)),R=o.position.y*parseFloat(n.scaling.y.toFixed(4)),k=o.position.z*parseFloat(n.scaling.z.toFixed(4));_.set(U,R,k),B.multiplyInPlace(o.rotationQuaternion)}else g=c.x*parseFloat(o.scaling.x.toFixed(4)),y=c.y*parseFloat(o.scaling.y.toFixed(4)),v=c.z*parseFloat(o.scaling.z.toFixed(4)),_.set(g,y,v);u.shape=ne,u.translation=_,u.rotation=B,u.scale=b,s.push(u)}},n.CreateHeightFieldTerrainShapeFromMesh=function(t,n,o){var i=e.RigidbodyPhysics.GetHavokInstance();if(!i)return BABYLON.Tools.Warn("Havok.js physics library not loaded"),null;var r=t.getVerticesData(BABYLON.VertexBuffer.PositionKind),a=r.length/3,l=i._malloc(4*a),s=Math.sqrt(a),u=s;if(s%1!==0)return console.error("Terrain mesh does not seem to be a regular square grid: "+t.name),null;for(var c=0,d=u-1;d>=0;d--)for(var p=0;p<s;p++){var h=d*s+p;i.HEAPF32[l+c>>2]=r[3*h+1],c+=4}var m=i.HP_Shape_CreateHeightField(s,u,[n,1,o],l)[1];return i._free(l),m},n.GetPhysicsHeapSize=function(){var t=e.RigidbodyPhysics.GetHavokInstance();if(!t)return BABYLON.Tools.Warn("Havok.js physics library not loaded"),0;var n=0;return t.HEAP8&&t.HEAP8.length&&(n=t.HEAP8.length/1048576),n},n.ConfigRigidbodyPhysics=function(e,t,n,o,i,r,a){if(null!=t&&null!=t.physicsBody){var l=null==i||null==i.gravity||i.gravity;l===!1&&t.physicsBody.setGravityFactor(0);var s=null!=i&&null!=i.ldrag?i.ldrag:0,u=null!=i&&null!=i.adrag?i.adrag:.05;t.physicsBody.setLinearDamping(s),t.physicsBody.setAngularDamping(u);var c=null!=i&&null!=i.freeze?i.freeze:null,d=1,p=1,h=1,m=1,f=1,g=1;null!=c&&(d=null!=c.positionx&&c.positionx===!0?0:1,p=null!=c.positiony&&c.positiony===!0?0:1,h=null!=c.positionz&&c.positionz===!0?0:1,m=null!=c.rotationx&&c.rotationx===!0?0:1,f=null!=c.rotationy&&c.rotationy===!0?0:1,g=null!=c.rotationz&&c.rotationz===!0?0:1),t.physicsBody.setMassProperties({mass:r,centerOfMass:a,inertia:new BABYLON.Vector3(m,f,g)})}},n.CreatePhysicsMetadata=function(e,t,n,o){void 0===t&&(t=0),void 0===n&&(n=.05),void 0===o&&(o=null);var i=null!=o?o:new BABYLON.Vector3(0,0,0);return{type:"rigidbody",mass:e,ldrag:t,adrag:n,center:{x:i.x,y:i.y,z:i.z}}},n.CreateCollisionMetadata=function(e,t,n,o,i,r){return void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===o&&(o=0),void 0===i&&(i=.6),void 0===r&&(r=.6),{type:e,trigger:t,convexmesh:n,restitution:o,dynamicfriction:i,staticfriction:r,wheelinformation:null}},n.CreatePhysicsProperties=function(e,t,n,o,i){return void 0===t&&(t=0),void 0===n&&(n=.05),void 0===o&&(o=!0),void 0===i&&(i=!1),{mass:e,drag:t,angularDrag:n,useGravity:o,isKinematic:i}},n.AddChildShapeFromParent=function(t,n,o,i){var r,a=i.computeWorldMatrix(!0),l=n.computeWorldMatrix(!0),s=BABYLON.TmpVectors.Matrix[0];a.multiplyToRef(BABYLON.Matrix.Invert(l),s);var u=BABYLON.TmpVectors.Vector3[0],c=BABYLON.TmpVectors.Quaternion[0],d=BABYLON.TmpVectors.Vector3[1];s.decompose(d,c,u);var p=new BABYLON.Vector3(d.x,d.y,d.z);if(i instanceof BABYLON.InstancedMesh){var h=i.sourceMesh;if(null!=h){var m=null!=i.metadata&&null!=i.metadata.unity&&null!=i.metadata.unity.collision&&null!=i.metadata.unity.collision.sourcescale?i.metadata.unity.collision.sourcescale:null,f=null!=h.metadata&&null!=h.metadata.unity&&null!=h.metadata.unity.collision&&null!=h.metadata.unity.collision.sourcescale?h.metadata.unity.collision.sourcescale:null;if(null!=f&&null!=m){var g=new BABYLON.Vector3(1,1,1),y=new BABYLON.Vector3(m.x,m.y,m.z),v=new BABYLON.Vector3(f.x,f.y,f.z);y.divideToRef(v,g),p.multiplyInPlace(g)}}}null===(r=e.RigidbodyPhysics.GetHavokPlugin())||void 0===r?void 0:r.addChild(t,o,u,c,p)},n.PHYSICS_STEP_TIME=.016,n.PhysicsShapeCache={},n.NewPhysicsShapeCount=0,n.CachedPhysicsShapeCount=0,n.DebugPhysicsViewer=null,n.OnSetupPhysicsPlugin=null,n}(e.ScriptComponent);e.RigidbodyPhysics=t;var n=function(){function e(){}return e}();e.PhyscisContainerData=n}(UNITY||(UNITY={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),UNITY;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.awake=function(){},t.prototype.start=function(){},t.prototype.ready=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.step=function(){},t.prototype.fixed=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(e.ScriptComponent);e.ShurikenParticles=t}(UNITY||(UNITY={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),UNITY;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.awake=function(){},t.prototype.start=function(){},t.prototype.fixed=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.ready=function(){},t.prototype.destroy=function(){},t}(e.ScriptComponent);e.TerrainGenerator=t}(UNITY||(UNITY={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),UNITY;!function(e){var t=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.videoLoop=!1,e.videoMuted=!1,e.videoAlpha=!1,e.videoFaded=!1,e.videoPoster=null,e.videoInvert=!0,e.videoSample=3,e.videoVolume=1,e.videoMipmaps=!1,e.videoPlayback=1,e.videoPlayOnAwake=!0,e.videoPreloaderUrl=null,e.videoBlobUrl=null,e.videoPreload=!1,e._initializedReadyInstance=!1,e.onReadyObservable=new BABYLON.Observable,e.m_abstractMesh=null,e.m_videoTexture=null,e.m_videoMaterial=null,e.m_diffuseIntensity=1,e}return __extends(n,t),n.prototype.getVideoMaterial=function(){return this.m_videoMaterial},n.prototype.getVideoTexture=function(){return this.m_videoTexture},n.prototype.getVideoElement=function(){return null!=this.m_videoTexture?this.m_videoTexture.video:null},n.prototype.getVideoScreen=function(){return this.m_abstractMesh},n.prototype.getVideoBlobUrl=function(){return this.videoBlobUrl},n.prototype.awake=function(){this.awakeWebVideoPlayer()},n.prototype.destroy=function(){this.destroyWebVideoPlayer()},n.prototype.awakeWebVideoPlayer=function(){this.videoLoop=this.getProperty("looping",!1),this.videoMuted=this.getProperty("muted",!1),this.videoInvert=this.getProperty("inverty",!0),this.videoSample=this.getProperty("sampling",3),this.videoVolume=this.getProperty("volume",1),this.videoMipmaps=this.getProperty("mipmaps",!1),this.videoAlpha=this.getProperty("texturealpha",!1),this.videoFaded=this.getProperty("diffusealpha",!1),this.videoPlayback=this.getProperty("playbackspeed",1),this.videoPlayOnAwake=this.getProperty("playonawake",!0),this.videoPreload=this.getProperty("preload",this.videoPreload),this.m_diffuseIntensity=this.getProperty("intensity",1),this.m_abstractMesh=this.getAbstractMesh();var t=this.getProperty("poster");t===!0&&null!=this.m_abstractMesh&&null!=this.m_abstractMesh.material&&(this.m_abstractMesh.material instanceof BABYLON.PBRMaterial?null!=this.m_abstractMesh.material.albedoTexture&&null!=this.m_abstractMesh.material.albedoTexture.url&&""!==this.m_abstractMesh.material.albedoTexture.url&&(this.videoPoster=this.m_abstractMesh.material.albedoTexture.url.replace("data:","")):this.m_abstractMesh.material instanceof BABYLON.StandardMaterial&&null!=this.m_abstractMesh.material.diffuseTexture&&null!=this.m_abstractMesh.material.diffuseTexture.url&&""!==this.m_abstractMesh.material.diffuseTexture.url&&(this.videoPoster=this.m_abstractMesh.material.diffuseTexture.url.replace("data:","")));var n=this.getProperty("url",null),o=this.getProperty("source",null),i=n;if(null!=o&&null!=o.filename&&""!==o.filename){var r=e.SceneManager.GetRootUrl(this.scene);i=r+o.filename}null!=i&&""!==i&&(this.videoPreload===!0?this.videoPreloaderUrl=i:this.setDataSource(i))},n.prototype.destroyWebVideoPlayer=function(){this.m_abstractMesh=null,null!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),null!=this.m_videoMaterial&&(this.m_videoMaterial.dispose(),this.m_videoMaterial=null),this.revokeVideoBlobUrl()},n.prototype.isReady=function(){return null!=this.getVideoElement()},n.prototype.isPlaying=function(){var e=!1,t=this.getVideoElement();return null!=t&&(e=t.paused===!1),e},n.prototype.isPaused=function(){var e=!1,t=this.getVideoElement();return null!=t&&(e=t.paused===!0),e},n.prototype.play=function(){var t=this;return e.SceneManager.HasAudioContext()?this.internalPlay():BABYLON.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){t.internalPlay()}),!0},n.prototype.internalPlay=function(){var e=this;this._initializedReadyInstance===!0?this.checkedPlay():this.onReadyObservable.addOnce(function(){e.checkedPlay()})},n.prototype.checkedPlay=function(){var e=this,t=this.getVideoElement();null!=t&&t.play().then(function(){t.paused===!0&&e.checkedRePlay()})},n.prototype.checkedRePlay=function(){var e=this.getVideoElement();null!=e&&e.play().then(function(){})},n.prototype.pause=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.pause(),e=!0),e},n.prototype.mute=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.muted=!0,e=!0),e},n.prototype.unmute=function(){var e=!1,t=this.getVideoElement();return null!=t&&(t.muted=!1,e=!0),e},n.prototype.getVolume=function(){var e=0,t=this.getVideoElement();return null!=t&&(e=t.volume),e},n.prototype.setVolume=function(e){var t=!1,n=this.getVideoElement();return null!=n&&(n.volume=e,t=!0),t},n.prototype.setDataSource=function(e){var t=this;null!=this.m_abstractMesh&&(null==this.m_videoMaterial&&(this.m_videoMaterial=new BABYLON.StandardMaterial(this.transform.name+".VideoMat",this.scene),this.m_videoMaterial.roughness=1,this.m_videoMaterial.diffuseColor=new BABYLON.Color3(1,1,1),this.m_videoMaterial.emissiveColor=new BABYLON.Color3(1,1,1),this.m_videoMaterial.useAlphaFromDiffuseTexture=this.videoFaded,this.m_abstractMesh.material=this.m_videoMaterial),null!=this.m_videoMaterial?(this.m_videoMaterial.diffuseTexture=null,null!=this.m_videoTexture&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),this._initializedReadyInstance=!1,this.m_videoTexture=new BABYLON.VideoTexture(this.transform.name+".VideoTex",e,this.scene,this.videoMipmaps,this.videoInvert,this.videoSample,{autoUpdateTexture:!0,poster:this.videoPoster}),null!=this.m_videoTexture&&(this.m_videoTexture.hasAlpha=this.videoAlpha,null!=this.m_videoTexture.video&&(this.m_videoTexture.video.loop=this.videoLoop,this.m_videoTexture.video.muted=this.videoMuted,this.m_videoTexture.video.volume=this.videoVolume,this.m_videoTexture.video.playbackRate=this.videoPlayback,this.m_videoTexture.video.addEventListener("loadeddata",function(){t._initializedReadyInstance=!0,t.onReadyObservable&&t.onReadyObservable.hasObservers()&&t.onReadyObservable.notifyObservers(t.m_videoTexture),t.videoPlayOnAwake===!0&&t.play()}),this.m_videoTexture.video.load())),null!=this.m_videoTexture&&(this.m_videoTexture.level=this.m_diffuseIntensity,this.m_videoMaterial.diffuseTexture=this.m_videoTexture)):BABYLON.Tools.Warn("No video mesh or material available for: "+this.transform.name))},n.prototype.revokeVideoBlobUrl=function(){null!=this.videoBlobUrl&&(URL.revokeObjectURL(this.videoBlobUrl),this.videoBlobUrl=null)},n.prototype.addPreloaderTasks=function(e){var t=this;if(this.videoPreload===!0){var n=e.addBinaryFileTask(this.transform.name+".VideoTask",this.videoPreloaderUrl);n.onSuccess=function(e){t.revokeVideoBlobUrl(),t.videoBlobUrl=URL.createObjectURL(new Blob([e.data])),t.setDataSource(t.videoBlobUrl)},n.onError=function(e,t,n){console.error(t,n)}}},n}(e.ScriptComponent);e.WebVideoPlayer=t}(UNITY||(UNITY={}));var UNITY;!function(e){var t=function(){function t(){}return t.ConfigureUserInput=function(t,n){void 0===n&&(n=null);var o=null==n||null==n.contextMenu||n.contextMenu,i=null!=n&&null!=n.pointerLock&&n.pointerLock,r=null!=n&&null!=n.preventDefault&&n.preventDefault,a=null!=n&&null!=n.useCapture&&n.useCapture;if(e.InputController.resetUserInput(),!e.InputController.input){document.documentElement.tabIndex=1,document.documentElement.addEventListener("keyup",e.InputController.inputKeyUpHandler,a),document.documentElement.addEventListener("pointerup",e.InputController.inputPointerUpHandler,a);var l=document.getElementById("renderingCanvas")||t.getEngine().getRenderingCanvas();null!=l&&(o===!0?(BABYLON.Tools.Log("Canvas element context menu enabled."),l.oncontextmenu=null):(l.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation()},BABYLON.Tools.Log("Canvas element context menu disabled."))),e.UserInputOptions.UseCanvasElement===!0?(l.tabIndex=2,l.addEventListener("focusout",e.InputController.resetKeyMapHandler,a),l.addEventListener("keydown",e.InputController.inputKeyDownHandler,a),l.addEventListener("pointerdown",e.InputController.inputPointerDownHandler,a),l.addEventListener("pointermove",e.InputController.inputPointerMoveHandler,a),l.addEventListener("onwheel"in document?"wheel":"mousewheel",e.InputController.inputPointerWheelHandler,a)):(document.documentElement.addEventListener("focusout",e.InputController.resetKeyMapHandler,a),document.documentElement.addEventListener("keydown",e.InputController.inputKeyDownHandler,a),document.documentElement.addEventListener("pointerdown",e.InputController.inputPointerDownHandler,a),document.documentElement.addEventListener("pointermove",e.InputController.inputPointerMoveHandler,a),document.documentElement.addEventListener("onwheel"in document?"wheel":"mousewheel",e.InputController.inputPointerWheelHandler,a)),e.InputController.preventDefault=r,null==e.InputController.GamepadManager&&(e.InputController.GamepadManager=new BABYLON.GamepadManager,e.InputController.GamepadManager.onGamepadConnectedObservable.add(e.InputController.inputManagerGamepadConnected),e.InputController.GamepadManager.onGamepadDisconnectedObservable.add(e.InputController.inputManagerGamepadDisconnected)),e.InputController.input=!0,document.documentElement.focus(),i===!0&&e.InputController.LockMousePointer(t,!0)}t.registerAfterRender(function(){e.InputController.updateUserInput(t)})},t.SetLeftJoystickBuffer=function(t,n,o){void 0===o&&(o=!0),e.InputController.j_horizontal=t,e.InputController.j_vertical=o===!0?-n:n},t.SetRightJoystickBuffer=function(t,n,o){void 0===o&&(o=!0),e.InputController.j_mousex=t,e.InputController.j_mousey=o===!0?-n:n},t.DisableUserInput=function(t,n){void 0===n&&(n=!1),e.InputController.LockMousePointer(t,!1),e.InputController.resetUserInput()},t.LockMousePointer=function(t,n){n===!0?e.InputController.LockMousePointerObserver=t.onPointerObservable.add(function(e,n){e.type==BABYLON.PointerEventTypes.POINTERDOWN&&(document.pointerLockElement||t.getEngine().enterPointerlock())}):e.InputController.IsPointerLockHandled()&&(t.onPointerObservable.remove(e.InputController.LockMousePointerObserver),e.InputController.LockMousePointerObserver=null)},t.IsPointerLocked=function(){return e.InputController.PointerLockedFlag},t.IsPointerLockHandled=function(){return null!=e.InputController.LockMousePointerObserver},t.GetUserInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=0;if(e.InputController.input)switch(t){case e.UserInputAxis.Vertical:case e.UserInputAxis.Horizontal:o=n===e.PlayerNumber.Four?t===e.UserInputAxis.Horizontal?e.InputController.horizontal4:e.InputController.vertical4:n===e.PlayerNumber.Three?t===e.UserInputAxis.Horizontal?e.InputController.horizontal3:e.InputController.vertical3:n===e.PlayerNumber.Two?t===e.UserInputAxis.Horizontal?e.InputController.horizontal2:e.InputController.vertical2:t===e.UserInputAxis.Horizontal?e.InputController.horizontal:e.InputController.vertical;break;case e.UserInputAxis.MouseX:case e.UserInputAxis.MouseY:o=n===e.PlayerNumber.Four?t===e.UserInputAxis.MouseX?e.InputController.mousex4:e.InputController.mousey4:n===e.PlayerNumber.Three?t===e.UserInputAxis.MouseX?e.InputController.mousex3:e.InputController.mousey3:n===e.PlayerNumber.Two?t===e.UserInputAxis.MouseX?e.InputController.mousex2:e.InputController.mousey2:t===e.UserInputAxis.MouseX?e.InputController.mousex:e.InputController.mousey;break;case e.UserInputAxis.Wheel:n===e.PlayerNumber.One&&(o=e.InputController.wheel)}return o},t.OnKeyboardUp=function(t){e.InputController.input&&e.InputController.keyButtonUp.push(t)},t.OnKeyboardDown=function(t){e.InputController.input&&e.InputController.keyButtonDown.push(t)},t.OnKeyboardPress=function(t,n){e.InputController.input&&e.InputController.keyButtonPress.push({index:t,action:n})},t.GetKeyboardInput=function(t){var n=!1;if(e.InputController.input){var o="k:"+t.toString();null!=e.InputController.keymap[o]&&(n=e.InputController.keymap[o])}return n},t.OnPointerUp=function(t){e.InputController.input&&e.InputController.mouseButtonUp.push(t)},t.OnPointerDown=function(t){e.InputController.input&&e.InputController.mouseButtonDown.push(t)},t.OnPointerPress=function(t,n){e.InputController.input&&e.InputController.mouseButtonPress.push({index:t,action:n})},t.GetPointerInput=function(t){var n=!1;if(e.InputController.input){var o="p:"+t.toString();null!=e.InputController.keymap[o]&&(n=e.InputController.keymap[o])}return n},t.IsWheelScrolling=function(){return 0!==e.InputController.scroll},t.OnGamepadButtonUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1ButtonUp.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonUp.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonUp.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonUp.push(t)}},t.OnGamepadButtonDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1ButtonDown.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonDown.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonDown.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonDown.push(t)}},t.OnGamepadButtonPress=function(t,n,o){if(void 0===o&&(o=e.PlayerNumber.One),e.InputController.input)switch(o){case e.PlayerNumber.One:e.InputController.gamepad1ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.InputController.gamepad2ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.InputController.gamepad3ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.InputController.gamepad4ButtonPress.push({index:t,action:n})}},t.GetGamepadButtonInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="b1:"+t.toString();break;case e.PlayerNumber.Two:i="b2:"+t.toString();break;case e.PlayerNumber.Three:i="b3:"+t.toString();break;case e.PlayerNumber.Four:i="b4:"+t.toString()}null!=i&&null!=e.InputController.keymap[i]&&(o=e.InputController.keymap[i])}return o},t.OnGamepadDirectionUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1DpadUp.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadUp.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadUp.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadUp.push(t)}},t.OnGamepadDirectionDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1DpadDown.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadDown.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadDown.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadDown.push(t)}},t.OnGamepadDirectionPress=function(t,n,o){if(void 0===o&&(o=e.PlayerNumber.One),e.InputController.input)switch(o){case e.PlayerNumber.One:e.InputController.gamepad1DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.InputController.gamepad2DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.InputController.gamepad3DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.InputController.gamepad4DpadPress.push({index:t,action:n})}},t.GetGamepadDirectionInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=!1;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="d1:"+t.toString();break;case e.PlayerNumber.Two:i="d2:"+t.toString();break;case e.PlayerNumber.Three:i="d3:"+t.toString();break;case e.PlayerNumber.Four:i="d4:"+t.toString()}null!=i&&null!=e.InputController.keymap[i]&&(o=e.InputController.keymap[i])}return o},t.OnGamepadTriggerLeft=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1LeftTrigger.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2LeftTrigger.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3LeftTrigger.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4LeftTrigger.push(t)}},t.OnGamepadTriggerRight=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),e.InputController.input)switch(n){case e.PlayerNumber.One:e.InputController.gamepad1RightTrigger.push(t);break;case e.PlayerNumber.Two:e.InputController.gamepad2RightTrigger.push(t);break;case e.PlayerNumber.Three:e.InputController.gamepad3RightTrigger.push(t);break;case e.PlayerNumber.Four:e.InputController.gamepad4RightTrigger.push(t)}},t.GetGamepadTriggerInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var o=0;if(e.InputController.input){var i=null;switch(n){case e.PlayerNumber.One:i="t1:"+t.toString();break;case e.PlayerNumber.Two:i="t2:"+t.toString();break;case e.PlayerNumber.Three:i="t3:"+t.toString();break;case e.PlayerNumber.Four:i="t4:"+t.toString()}null!=i&&null!=e.InputController.keymap[i]&&(o=e.InputController.keymap[i])}return o},t.GetGamepadType=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=e.GamepadType.None;if(e.InputController.input)switch(t){case e.PlayerNumber.One:n=e.InputController.gamepad1Type;break;case e.PlayerNumber.Two:n=e.InputController.gamepad2Type;break;case e.PlayerNumber.Three:n=e.InputController.gamepad3Type;break;case e.PlayerNumber.Four:n=e.InputController.gamepad4Type}return n},t.GetGamepad=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(e.InputController.input)switch(t){case e.PlayerNumber.One:n=e.InputController.gamepad1;break;case e.PlayerNumber.Two:n=e.InputController.gamepad2;break;case e.PlayerNumber.Three:n=e.InputController.gamepad3;break;case e.PlayerNumber.Four:n=e.InputController.gamepad4}return n},t.tickKeyboardInput=function(t){if(e.SceneManager.EnableUserInput!==!1){var n=e.InputController.GetKeyboardInput(e.UserInputKey.W)||e.InputController.GetKeyboardInput(e.UserInputKey.UpArrow),o=e.InputController.GetKeyboardInput(e.UserInputKey.A),i=e.InputController.GetKeyboardInput(e.UserInputKey.S)||e.InputController.GetKeyboardInput(e.UserInputKey.DownArrow),r=e.InputController.GetKeyboardInput(e.UserInputKey.D),a=e.InputController.GetKeyboardInput(e.UserInputKey.LeftArrow),l=e.InputController.GetKeyboardInput(e.UserInputKey.RightArrow);n===!0?e.InputController.k_vertical=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_vertical,1):i===!0?e.InputController.k_vertical=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_vertical,-1):e.InputController.k_vertical=0,e.UserInputOptions.UseArrowKeyRotation===!0?(r===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,1):o===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,-1):e.InputController.k_horizontal=0,l===!0?e.InputController.a_mousex=1:a===!0?e.InputController.a_mousex=-1:e.InputController.a_mousex=0):r===!0||l===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,1):o===!0||a===!0?e.InputController.k_horizontal=e.Utilities.GetKeyboardInputValue(t,e.InputController.k_horizontal,-1):e.InputController.k_horizontal=0}},t.updateUserInput=function(t){e.SceneManager.EnableUserInput!==!1&&(e.InputController.PointerLockedFlag=t.getEngine().isPointerLock,e.InputController.tickKeyboardInput(t),e.InputController.x_horizontal=0,e.InputController.x_vertical=0,e.InputController.x_mousex=0,e.InputController.x_mousey=0,0!==e.InputController.j_horizontal?e.InputController.x_horizontal=e.InputController.j_horizontal:0!==e.InputController.g_horizontal1?e.InputController.x_horizontal=e.InputController.g_horizontal1:0!==e.InputController.k_horizontal&&(e.InputController.x_horizontal=e.InputController.k_horizontal),0!==e.InputController.j_vertical?e.InputController.x_vertical=e.InputController.j_vertical:0!==e.InputController.g_vertical1?e.InputController.x_vertical=e.InputController.g_vertical1:0!==e.InputController.k_vertical&&(e.InputController.x_vertical=e.InputController.k_vertical),0!==e.InputController.j_mousex?e.InputController.x_mousex=e.InputController.j_mousex:0!==e.InputController.g_mousex1?e.InputController.x_mousex=e.InputController.g_mousex1:0!==e.InputController.a_mousex?e.InputController.x_mousex=e.InputController.a_mousex:0!==e.InputController.k_mousex&&(e.InputController.x_mousex=e.InputController.k_mousex),0!==e.InputController.j_mousey?e.InputController.x_mousey=e.InputController.j_mousey:0!==e.InputController.g_mousey1?e.InputController.x_mousey=e.InputController.g_mousey1:0!==e.InputController.k_mousey&&(e.InputController.x_mousey=e.InputController.k_mousey),e.InputController.horizontal=e.InputController.x_horizontal,e.InputController.vertical=e.InputController.x_vertical,e.InputController.mousex=e.InputController.x_mousex,e.InputController.mousey=e.InputController.x_mousey,e.InputController.scroll=e.InputController.x_scroll,e.InputController.wheel=e.InputController.x_wheel,e.InputController.horizontal2=e.InputController.g_horizontal2,e.InputController.vertical2=e.InputController.g_vertical2,e.InputController.mousex2=e.InputController.g_mousex2,e.InputController.mousey2=e.InputController.g_mousey2,e.InputController.horizontal3=e.InputController.g_horizontal3,e.InputController.vertical3=e.InputController.g_vertical3,e.InputController.mousex3=e.InputController.g_mousex3,e.InputController.mousey3=e.InputController.g_mousey3,e.InputController.horizontal4=e.InputController.g_horizontal4,e.InputController.vertical4=e.InputController.g_vertical4,e.InputController.mousex4=e.InputController.g_mousex4,e.InputController.mousey4=e.InputController.g_mousey4,e.InputController.k_mousex=0,e.InputController.k_mousey=0,e.InputController.x_mousey=0,e.InputController.x_scroll=0)},t.resetUserInput=function(){e.InputController.input=!1,e.InputController.keymap={},e.InputController.scroll=0,e.InputController.wheel=0,e.InputController.mousex=0,e.InputController.mousey=0,e.InputController.vertical=0,e.InputController.horizontal=0,e.InputController.mousex2=0,e.InputController.mousey2=0,e.InputController.vertical2=0,e.InputController.horizontal2=0,e.InputController.mousex3=0,e.InputController.mousey3=0,e.InputController.vertical3=0,e.InputController.horizontal3=0,e.InputController.mousex4=0,e.InputController.mousey4=0,e.InputController.vertical4=0,e.InputController.horizontal4=0,e.InputController.a_mousex=0,e.InputController.x_scroll=0,e.InputController.x_wheel=0,e.InputController.x_mousex=0,e.InputController.x_mousey=0,e.InputController.x_vertical=0,e.InputController.x_horizontal=0,e.InputController.k_mousex=0,e.InputController.k_mousey=0,e.InputController.k_vertical=0,e.InputController.k_horizontal=0,e.InputController.j_mousex=0,e.InputController.j_mousey=0,e.InputController.j_vertical=0,e.InputController.j_horizontal=0,e.InputController.g_mousex1=0,e.InputController.g_mousey1=0,e.InputController.g_vertical1=0,e.InputController.g_horizontal1=0,e.InputController.g_mousex2=0,e.InputController.g_mousey2=0,e.InputController.g_vertical2=0,
e.InputController.g_horizontal2=0,e.InputController.g_mousex3=0,e.InputController.g_mousey3=0,e.InputController.g_vertical3=0,e.InputController.g_horizontal3=0,e.InputController.g_mousex4=0,e.InputController.g_mousey4=0,e.InputController.g_vertical4=0,e.InputController.g_horizontal4=0,e.InputController.preventDefault=!1,e.InputController.mouseButtonUp=[],e.InputController.mouseButtonDown=[],e.InputController.mouseButtonPress=[],e.InputController.keyButtonUp=[],e.InputController.keyButtonDown=[],e.InputController.keyButtonPress=[],e.InputController.gamepad1ButtonUp=[],e.InputController.gamepad1ButtonDown=[],e.InputController.gamepad1ButtonPress=[],e.InputController.gamepad1DpadUp=[],e.InputController.gamepad1DpadDown=[],e.InputController.gamepad1DpadPress=[],e.InputController.gamepad1LeftTrigger=[],e.InputController.gamepad1RightTrigger=[],e.InputController.gamepad2ButtonUp=[],e.InputController.gamepad2ButtonDown=[],e.InputController.gamepad2ButtonPress=[],e.InputController.gamepad2DpadUp=[],e.InputController.gamepad2DpadDown=[],e.InputController.gamepad2DpadPress=[],e.InputController.gamepad2LeftTrigger=[],e.InputController.gamepad2RightTrigger=[],e.InputController.gamepad3ButtonUp=[],e.InputController.gamepad3ButtonDown=[],e.InputController.gamepad3ButtonPress=[],e.InputController.gamepad3DpadUp=[],e.InputController.gamepad3DpadDown=[],e.InputController.gamepad3DpadPress=[],e.InputController.gamepad3LeftTrigger=[],e.InputController.gamepad3RightTrigger=[],e.InputController.gamepad4ButtonUp=[],e.InputController.gamepad4ButtonDown=[],e.InputController.gamepad4ButtonPress=[],e.InputController.gamepad4DpadUp=[],e.InputController.gamepad4DpadDown=[],e.InputController.gamepad4DpadPress=[],e.InputController.gamepad4LeftTrigger=[],e.InputController.gamepad4RightTrigger=[],e.InputController.previousPosition=null},t.resetKeyMapHandler=function(t){e.InputController.keymap={}},t.inputKeyDownHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n="k:"+t.keyCode.toString(),o=!1;return null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.keyButtonDown&&e.InputController.keyButtonDown.length>0&&e.InputController.keyButtonDown.forEach(function(e){e(t.keyCode)}),o||null!=e.InputController.keyButtonPress&&e.InputController.keyButtonPress.length>0&&e.InputController.keyButtonPress.forEach(function(e){e.index===t.keyCode&&e.action()}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputKeyUpHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n="k:"+t.keyCode.toString();return e.InputController.keymap[n]=!1,null!=e.InputController.keyButtonUp&&e.InputController.keyButtonUp.length>0&&e.InputController.keyButtonUp.forEach(function(e){e(t.keyCode)}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerWheelHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;var n=t.deltaY?-t.deltaY:t.wheelDelta/40;return e.InputController.x_scroll=1,e.InputController.x_wheel=Math.abs(n)>e.UserInputOptions.PointerWheelDeadZone?0+n:0,e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerDownHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;e.InputController.previousPosition={x:t.clientX,y:t.clientY};var n="p:"+t.button.toString(),o=!1;return null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.mouseButtonDown&&e.InputController.mouseButtonDown.length>0&&e.InputController.mouseButtonDown.forEach(function(e){e(t.button)}),o||null!=e.InputController.mouseButtonPress&&e.InputController.mouseButtonPress.length>0&&e.InputController.mouseButtonPress.forEach(function(e){e.index===t.button&&e.action()}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerUpHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;e.InputController.previousPosition=null,e.InputController.k_mousex=0,e.InputController.k_mousey=0;var n="p:"+t.button.toString();return e.InputController.keymap[n]=!1,null!=e.InputController.mouseButtonUp&&e.InputController.mouseButtonUp.length>0&&e.InputController.mouseButtonUp.forEach(function(e){e(t.button)}),e.InputController.preventDefault&&t.preventDefault(),!0},t.inputPointerMoveHandler=function(t){if(e.SceneManager.EnableUserInput===!1)return!1;if(e.SceneManager.VirtualJoystickEnabled===!1){var n=0,o=0;e.InputController.IsPointerLocked()?(n=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,o=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0,e.InputController.previousPosition=null):null!=e.InputController.previousPosition&&(n=t.clientX-e.InputController.previousPosition.x,o=t.clientY-e.InputController.previousPosition.y,e.InputController.previousPosition={x:t.clientX,y:t.clientY}),e.UserInputOptions.PointerMouseInverted===!0&&(n*=-1,o*=-1),e.InputController.rightHanded&&(n*=-1);var i=n*e.UserInputOptions.PointerAngularSensibility*e.InputController.MOUSE_DAMPENER,r=o*e.UserInputOptions.PointerAngularSensibility*e.InputController.MOUSE_DAMPENER;Math.abs(n)<=e.UserInputOptions.PointerMouseDeadZone&&(i=0),Math.abs(o)<=e.UserInputOptions.PointerMouseDeadZone&&(r=0),i=BABYLON.Scalar.Clamp(i,-1,1),r=BABYLON.Scalar.Clamp(r,-1,1),e.InputController.k_mousex+=i,e.InputController.k_mousey+=r}return e.InputController.preventDefault&&t.preventDefault(),!0},t.inputOneButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="b1:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1ButtonDown&&e.InputController.gamepad1ButtonDown.length>0&&e.InputController.gamepad1ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad1ButtonPress&&e.InputController.gamepad1ButtonPress.length>0&&e.InputController.gamepad1ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="b1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1ButtonUp&&e.InputController.gamepad1ButtonUp.length>0&&e.InputController.gamepad1ButtonUp.forEach(function(e){e(t)})}},t.inputOneXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1DpadDown&&e.InputController.gamepad1DpadDown.length>0&&e.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad1DpadPress&&e.InputController.gamepad1DpadPress.length>0&&e.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad1DpadDown&&e.InputController.gamepad1DpadDown.length>0&&e.InputController.gamepad1DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad1DpadPress&&e.InputController.gamepad1DpadPress.length>0&&e.InputController.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1DpadUp&&e.InputController.gamepad1DpadUp.length>0&&e.InputController.gamepad1DpadUp.forEach(function(e){e(t)})}},t.inputOneShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n="d1:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad1DpadUp&&e.InputController.gamepad1DpadUp.length>0&&e.InputController.gamepad1DpadUp.forEach(function(e){e(t)})}},t.inputOneXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1&&(e.InputController.keymap["t1:0"]=t,null!=e.InputController.gamepad1LeftTrigger&&e.InputController.gamepad1LeftTrigger.length>0&&e.InputController.gamepad1LeftTrigger.forEach(function(e){e(t)}))},t.inputOneXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1&&(e.InputController.keymap["t1:1"]=t,null!=e.InputController.gamepad1RightTrigger&&e.InputController.gamepad1RightTrigger.length>0&&e.InputController.gamepad1RightTrigger.forEach(function(e){e(t)}))},t.inputOneLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal1=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical1=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputOneRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad1){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex1=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey1=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputTwoButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="b2:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2ButtonDown&&e.InputController.gamepad2ButtonDown.length>0&&e.InputController.gamepad2ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad2ButtonPress&&e.InputController.gamepad2ButtonPress.length>0&&e.InputController.gamepad2ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="b2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2ButtonUp&&e.InputController.gamepad2ButtonUp.length>0&&e.InputController.gamepad2ButtonUp.forEach(function(e){e(t)})}},t.inputTwoXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2DpadDown&&e.InputController.gamepad2DpadDown.length>0&&e.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad2DpadPress&&e.InputController.gamepad2DpadPress.length>0&&e.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad2DpadDown&&e.InputController.gamepad2DpadDown.length>0&&e.InputController.gamepad2DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad2DpadPress&&e.InputController.gamepad2DpadPress.length>0&&e.InputController.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2DpadUp&&e.InputController.gamepad2DpadUp.length>0&&e.InputController.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n="d2:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad2DpadUp&&e.InputController.gamepad2DpadUp.length>0&&e.InputController.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2&&(e.InputController.keymap["t2:0"]=t,null!=e.InputController.gamepad2LeftTrigger&&e.InputController.gamepad2LeftTrigger.length>0&&e.InputController.gamepad2LeftTrigger.forEach(function(e){e(t)}))},t.inputTwoXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2&&(e.InputController.keymap["t2:1"]=t,null!=e.InputController.gamepad2RightTrigger&&e.InputController.gamepad2RightTrigger.length>0&&e.InputController.gamepad2RightTrigger.forEach(function(e){e(t)}))},t.inputTwoLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal2=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical2=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputTwoRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad2){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex2=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey2=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputThreeButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="b3:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3ButtonDown&&e.InputController.gamepad3ButtonDown.length>0&&e.InputController.gamepad3ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad3ButtonPress&&e.InputController.gamepad3ButtonPress.length>0&&e.InputController.gamepad3ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="b3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3ButtonUp&&e.InputController.gamepad3ButtonUp.length>0&&e.InputController.gamepad3ButtonUp.forEach(function(e){e(t)})}},t.inputThreeXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3DpadDown&&e.InputController.gamepad3DpadDown.length>0&&e.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad3DpadPress&&e.InputController.gamepad3DpadPress.length>0&&e.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad3DpadDown&&e.InputController.gamepad3DpadDown.length>0&&e.InputController.gamepad3DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad3DpadPress&&e.InputController.gamepad3DpadPress.length>0&&e.InputController.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3DpadUp&&e.InputController.gamepad3DpadUp.length>0&&e.InputController.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n="d3:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad3DpadUp&&e.InputController.gamepad3DpadUp.length>0&&e.InputController.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3&&(e.InputController.keymap["t3:0"]=t,null!=e.InputController.gamepad3LeftTrigger&&e.InputController.gamepad3LeftTrigger.length>0&&e.InputController.gamepad3LeftTrigger.forEach(function(e){e(t)}))},t.inputThreeXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3&&(e.InputController.keymap["t3:1"]=t,null!=e.InputController.gamepad3RightTrigger&&e.InputController.gamepad3RightTrigger.length>0&&e.InputController.gamepad3RightTrigger.forEach(function(e){e(t)}))},t.inputThreeLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal3=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical3=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputThreeRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad3){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex3=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey3=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputFourButtonDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="b4:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4ButtonDown&&e.InputController.gamepad4ButtonDown.length>0&&e.InputController.gamepad4ButtonDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad4ButtonPress&&e.InputController.gamepad4ButtonPress.length>0&&e.InputController.gamepad4ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourButtonUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="b4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4ButtonUp&&e.InputController.gamepad4ButtonUp.length>0&&e.InputController.gamepad4ButtonUp.forEach(function(e){e(t)})}},t.inputFourXboxDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4DpadDown&&e.InputController.gamepad4DpadDown.length>0&&e.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad4DpadPress&&e.InputController.gamepad4DpadPress.length>0&&e.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourShockDPadDownHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString(),o=!1;null!=e.InputController.keymap[n]&&(o=e.InputController.keymap[n]),e.InputController.keymap[n]=!0,null!=e.InputController.gamepad4DpadDown&&e.InputController.gamepad4DpadDown.length>0&&e.InputController.gamepad4DpadDown.forEach(function(e){e(t)}),o||null!=e.InputController.gamepad4DpadPress&&e.InputController.gamepad4DpadPress.length>0&&e.InputController.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourXboxDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4DpadUp&&e.InputController.gamepad4DpadUp.length>0&&e.InputController.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourShockDPadUpHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n="d4:"+t.toString();e.InputController.keymap[n]=!1,null!=e.InputController.gamepad4DpadUp&&e.InputController.gamepad4DpadUp.length>0&&e.InputController.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourXboxLeftTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4&&(e.InputController.keymap["t4:0"]=t,null!=e.InputController.gamepad4LeftTrigger&&e.InputController.gamepad4LeftTrigger.length>0&&e.InputController.gamepad4LeftTrigger.forEach(function(e){e(t)}))},t.inputFourXboxRightTriggerHandler=function(t){e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4&&(e.InputController.keymap["t4:1"]=t,null!=e.InputController.gamepad4RightTrigger&&e.InputController.gamepad4RightTrigger.length>0&&e.InputController.gamepad4RightTrigger.forEach(function(e){e(t)}))},t.inputFourLeftStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n=t,o=n.x*e.UserInputOptions.GamepadLStickSensibility,i=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_horizontal4=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.InputController.g_vertical4=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputFourRightStickHandler=function(t){if(e.SceneManager.EnableUserInput!==!1&&null!=e.InputController.gamepad4){var n=t,o=n.x*e.UserInputOptions.GamepadRStickSensibility,i=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(o)>e.UserInputOptions.GamepadDeadStickValue?o:0,n.y=Math.abs(i)>e.UserInputOptions.GamepadDeadStickValue?i:0,n.x=BABYLON.Scalar.Clamp(n.x,-1,1),n.y=BABYLON.Scalar.Clamp(n.y,-1,1),e.InputController.g_mousex4=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.InputController.g_mousey4=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputManagerGamepadConnected=function(t,n){if(null==e.InputController.gamepad1&&0===t.index)if(e.InputController.gamepad1=t,BABYLON.Tools.Log("Gamepad One Connected: "+e.InputController.gamepad1.id),e.InputController.gamepad1 instanceof BABYLON.Xbox360Pad){e.InputController.gamepad1Type=e.GamepadType.Xbox360;var o=e.InputController.gamepad1;o.onbuttonup(e.InputController.inputOneButtonUpHandler),o.onbuttondown(e.InputController.inputOneButtonDownHandler),o.onleftstickchanged(e.InputController.inputOneLeftStickHandler),o.onrightstickchanged(e.InputController.inputOneRightStickHandler),o.ondpadup(e.InputController.inputOneXboxDPadUpHandler),o.ondpaddown(e.InputController.inputOneXboxDPadDownHandler),o.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),o.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else if(e.InputController.gamepad1 instanceof BABYLON.DualShockPad){e.InputController.gamepad1Type=e.GamepadType.DualShock;var i=e.InputController.gamepad1;i.onbuttonup(e.InputController.inputOneButtonUpHandler),i.onbuttondown(e.InputController.inputOneButtonDownHandler),i.onleftstickchanged(e.InputController.inputOneLeftStickHandler),i.onrightstickchanged(e.InputController.inputOneRightStickHandler),i.ondpadup(e.InputController.inputOneShockDPadUpHandler),i.ondpaddown(e.InputController.inputOneShockDPadDownHandler),i.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),i.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad1Type=e.GamepadType.Generic;var r=e.InputController.gamepad1;r.onbuttonup(e.InputController.inputOneButtonUpHandler),r.onbuttondown(e.InputController.inputOneButtonDownHandler),r.onleftstickchanged(e.InputController.inputOneLeftStickHandler),r.onrightstickchanged(e.InputController.inputOneRightStickHandler)}if(null==e.InputController.gamepad2&&1===t.index)if(e.InputController.gamepad2=t,BABYLON.Tools.Log("Gamepad Two Connected: "+e.InputController.gamepad2.id),e.InputController.gamepad2 instanceof BABYLON.Xbox360Pad){e.InputController.gamepad2Type=e.GamepadType.Xbox360;var a=e.InputController.gamepad2;a.onbuttonup(e.InputController.inputTwoButtonUpHandler),a.onbuttondown(e.InputController.inputTwoButtonDownHandler),a.onleftstickchanged(e.InputController.inputTwoLeftStickHandler),a.onrightstickchanged(e.InputController.inputTwoRightStickHandler),a.ondpadup(e.InputController.inputTwoXboxDPadUpHandler),a.ondpaddown(e.InputController.inputTwoXboxDPadDownHandler),a.onlefttriggerchanged(e.InputController.inputTwoXboxLeftTriggerHandler),a.onrighttriggerchanged(e.InputController.inputTwoXboxRightTriggerHandler)}else if(e.InputController.gamepad2 instanceof BABYLON.DualShockPad){e.InputController.gamepad2Type=e.GamepadType.DualShock;var l=e.InputController.gamepad2;l.onbuttonup(e.InputController.inputOneButtonUpHandler),l.onbuttondown(e.InputController.inputOneButtonDownHandler),l.onleftstickchanged(e.InputController.inputOneLeftStickHandler),l.onrightstickchanged(e.InputController.inputOneRightStickHandler),l.ondpadup(e.InputController.inputOneShockDPadUpHandler),l.ondpaddown(e.InputController.inputOneShockDPadDownHandler),l.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),l.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad2Type=e.GamepadType.Generic;var s=e.InputController.gamepad2;s.onbuttonup(e.InputController.inputTwoButtonUpHandler),s.onbuttondown(e.InputController.inputTwoButtonDownHandler),s.onleftstickchanged(e.InputController.inputTwoLeftStickHandler),s.onrightstickchanged(e.InputController.inputTwoRightStickHandler)}if(null==e.InputController.gamepad3&&2===t.index)if(e.InputController.gamepad3=t,BABYLON.Tools.Log("Gamepad Three Connected: "+e.InputController.gamepad3.id),e.InputController.gamepad3 instanceof BABYLON.Xbox360Pad){e.InputController.gamepad3Type=e.GamepadType.Xbox360;var u=e.InputController.gamepad3;u.onbuttonup(e.InputController.inputThreeButtonUpHandler),u.onbuttondown(e.InputController.inputThreeButtonDownHandler),u.onleftstickchanged(e.InputController.inputThreeLeftStickHandler),u.onrightstickchanged(e.InputController.inputThreeRightStickHandler),u.ondpadup(e.InputController.inputThreeXboxDPadUpHandler),u.ondpaddown(e.InputController.inputThreeXboxDPadDownHandler),u.onlefttriggerchanged(e.InputController.inputThreeXboxLeftTriggerHandler),u.onrighttriggerchanged(e.InputController.inputThreeXboxRightTriggerHandler)}else if(e.InputController.gamepad3 instanceof BABYLON.DualShockPad){var c=e.InputController.gamepad3;c.onbuttonup(e.InputController.inputOneButtonUpHandler),c.onbuttondown(e.InputController.inputOneButtonDownHandler),c.onleftstickchanged(e.InputController.inputOneLeftStickHandler),c.onrightstickchanged(e.InputController.inputOneRightStickHandler),c.ondpadup(e.InputController.inputOneShockDPadUpHandler),c.ondpaddown(e.InputController.inputOneShockDPadDownHandler),c.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),c.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad3Type=e.GamepadType.Generic;var d=e.InputController.gamepad3;d.onbuttonup(e.InputController.inputThreeButtonUpHandler),d.onbuttondown(e.InputController.inputThreeButtonDownHandler),d.onleftstickchanged(e.InputController.inputThreeLeftStickHandler),d.onrightstickchanged(e.InputController.inputThreeRightStickHandler)}if(null==e.InputController.gamepad4&&3===t.index)if(e.InputController.gamepad4=t,BABYLON.Tools.Log("Gamepad Four Connected: "+e.InputController.gamepad4.id),e.InputController.gamepad4 instanceof BABYLON.Xbox360Pad){e.InputController.gamepad4Type=e.GamepadType.Xbox360;var p=e.InputController.gamepad4;p.onbuttonup(e.InputController.inputFourButtonUpHandler),p.onbuttondown(e.InputController.inputFourButtonDownHandler),p.onleftstickchanged(e.InputController.inputFourLeftStickHandler),p.onrightstickchanged(e.InputController.inputFourRightStickHandler),p.ondpadup(e.InputController.inputFourXboxDPadUpHandler),p.ondpaddown(e.InputController.inputFourXboxDPadDownHandler),p.onlefttriggerchanged(e.InputController.inputFourXboxLeftTriggerHandler),p.onrighttriggerchanged(e.InputController.inputFourXboxRightTriggerHandler)}else if(e.InputController.gamepad4 instanceof BABYLON.DualShockPad){var h=e.InputController.gamepad4;h.onbuttonup(e.InputController.inputOneButtonUpHandler),h.onbuttondown(e.InputController.inputOneButtonDownHandler),h.onleftstickchanged(e.InputController.inputOneLeftStickHandler),h.onrightstickchanged(e.InputController.inputOneRightStickHandler),h.ondpadup(e.InputController.inputOneShockDPadUpHandler),h.ondpaddown(e.InputController.inputOneShockDPadDownHandler),h.onlefttriggerchanged(e.InputController.inputOneXboxLeftTriggerHandler),h.onrighttriggerchanged(e.InputController.inputOneXboxRightTriggerHandler)}else{e.InputController.gamepad4Type=e.GamepadType.Generic;var m=e.InputController.gamepad4;m.onbuttonup(e.InputController.inputFourButtonUpHandler),m.onbuttondown(e.InputController.inputFourButtonDownHandler),m.onleftstickchanged(e.InputController.inputFourLeftStickHandler),m.onrightstickchanged(e.InputController.inputFourRightStickHandler)}null!=e.InputController.GamepadConnected&&e.InputController.GamepadConnected(t,n)},t.inputManagerGamepadDisconnected=function(t,n){null!=e.InputController.GamepadDisconnected&&e.InputController.GamepadDisconnected(t,n)},t.MOUSE_DAMPENER=.5,t.GamepadManager=null,t.GamepadConnected=null,t.GamepadDisconnected=null,t.PointerLockedFlag=!1,t.LockMousePointerObserver=null,t.input=!1,t.keymap={},t.scroll=0,t.wheel=0,t.mousex=0,t.mousey=0,t.vertical=0,t.horizontal=0,t.mousex2=0,t.mousey2=0,t.vertical2=0,t.horizontal2=0,t.mousex3=0,t.mousey3=0,t.vertical3=0,t.horizontal3=0,t.mousex4=0,t.mousey4=0,t.vertical4=0,t.horizontal4=0,t.a_mousex=0,t.x_scroll=0,t.x_wheel=0,t.x_mousex=0,t.x_mousey=0,t.x_vertical=0,t.x_horizontal=0,t.k_mousex=0,t.k_mousey=0,t.k_vertical=0,t.k_horizontal=0,t.j_mousex=0,t.j_mousey=0,t.j_vertical=0,t.j_horizontal=0,t.g_mousex1=0,t.g_mousey1=0,t.g_vertical1=0,t.g_horizontal1=0,t.g_mousex2=0,t.g_mousey2=0,t.g_vertical2=0,t.g_horizontal2=0,t.g_mousex3=0,t.g_mousey3=0,t.g_vertical3=0,t.g_horizontal3=0,t.g_mousex4=0,t.g_mousey4=0,t.g_vertical4=0,t.g_horizontal4=0,t.mouseButtonPress=[],t.mouseButtonDown=[],t.mouseButtonUp=[],t.keyButtonPress=[],t.keyButtonDown=[],t.keyButtonUp=[],t.previousPosition=null,t.preventDefault=!1,t.rightHanded=!0,t.gamepad1=null,t.gamepad1Type=-1,t.gamepad1ButtonPress=[],t.gamepad1ButtonDown=[],t.gamepad1ButtonUp=[],t.gamepad1DpadPress=[],t.gamepad1DpadDown=[],t.gamepad1DpadUp=[],t.gamepad1LeftTrigger=[],t.gamepad1RightTrigger=[],t.gamepad2=null,
t.gamepad2Type=-1,t.gamepad2ButtonPress=[],t.gamepad2ButtonDown=[],t.gamepad2ButtonUp=[],t.gamepad2DpadPress=[],t.gamepad2DpadDown=[],t.gamepad2DpadUp=[],t.gamepad2LeftTrigger=[],t.gamepad2RightTrigger=[],t.gamepad3=null,t.gamepad3Type=-1,t.gamepad3ButtonPress=[],t.gamepad3ButtonDown=[],t.gamepad3ButtonUp=[],t.gamepad3DpadPress=[],t.gamepad3DpadDown=[],t.gamepad3DpadUp=[],t.gamepad3LeftTrigger=[],t.gamepad3RightTrigger=[],t.gamepad4=null,t.gamepad4Type=-1,t.gamepad4ButtonPress=[],t.gamepad4ButtonDown=[],t.gamepad4ButtonUp=[],t.gamepad4DpadPress=[],t.gamepad4DpadDown=[],t.gamepad4DpadUp=[],t.gamepad4LeftTrigger=[],t.gamepad4RightTrigger=[],t}();e.InputController=t;var n=function(){function e(e,t,n){var o=this;this.active=!1,this.touchId=null,this.dragStart=null,this.maxDistance=0,this.deadZone=0,this.xvalue=0,this.yvalue=0,this.stick=null,this.touchId=null,this.dragStart=null,this.active=!1,this.xvalue=0,this.yvalue=0,this.deadZone=n,this.maxDistance=t,this.stick=document.getElementById(e),null!=this.stick?(this.stick.addEventListener("mousedown",function(e){o.handleDown(e)}),this.stick.addEventListener("touchstart",function(e){o.handleDown(e)}),document.addEventListener("mousemove",function(e){o.handleMove(e)},{passive:!1}),document.addEventListener("touchmove",function(e){o.handleMove(e)},{passive:!1}),document.addEventListener("mouseup",function(e){o.handleUp(e)}),document.addEventListener("touchend",function(e){o.handleUp(e)})):console.warn("Failed to locate joystick element: "+e)}return e.prototype.getValueX=function(){return this.xvalue},e.prototype.getValueY=function(){return this.yvalue},e.prototype.getStickElement=function(){return this.stick},e.prototype.dispose=function(){},e.prototype.handleDown=function(e){this.active=!0,this.stick.style.transition="0s",e.preventDefault(),e.changedTouches?this.dragStart={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:this.dragStart={x:e.clientX,y:e.clientY},e.changedTouches&&(this.touchId=e.changedTouches[0].identifier)},e.prototype.handleMove=function(e){if(this.active){var t=null;if(e.changedTouches){for(var n=0;n<e.changedTouches.length;n++)this.touchId==e.changedTouches[n].identifier&&(t=n,e.clientX=e.changedTouches[n].clientX,e.clientY=e.changedTouches[n].clientY);if(null==t)return}var o=e.clientX-this.dragStart.x,i=e.clientY-this.dragStart.y,r=Math.atan2(i,o),a=Math.min(this.maxDistance,Math.hypot(o,i)),l=a*Math.cos(r),s=a*Math.sin(r);this.stick.style.transform="translate3d(".concat(l,"px, ").concat(s,"px, 0px)");var u=a<this.deadZone?0:this.maxDistance/(this.maxDistance-this.deadZone)*(a-this.deadZone),c=u*Math.cos(r),d=u*Math.sin(r),p=parseFloat((c/this.maxDistance).toFixed(4)),h=parseFloat((d/this.maxDistance).toFixed(4));this.xvalue=p,this.yvalue=h}},e.prototype.handleUp=function(e){this.active&&(e.changedTouches&&this.touchId!=e.changedTouches[0].identifier||(this.stick.style.transition=".2s",this.stick.style.transform="translate3d(0px, 0px, 0px)",this.xvalue=0,this.yvalue=0,this.touchId=null,this.active=!1))},e}();e.TouchJoystickHandler=n}(UNITY||(UNITY={}));var IC=UNITY.InputController,UNITY;!function(e){var t=function(){function t(){}return t.IsWindows=function(){return"undefined"!=typeof Windows&&"undefined"!=typeof Windows.UI&&"undefined"!=typeof Windows.System&&"undefined"!=typeof Windows.Foundation},t.IsCordova=function(){return null!=window.cordova},t.IsWebAssembly=function(){return window.WebAssembly},t.IsOculusBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/OculusBrowser/i)&&(e=!0),e},t.IsSamsungBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/SamsungBrowser/i)&&(e=!0),e},t.IsWindowsPhone=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Windows Phone/i)&&(e=!0),e},t.IsBlackBerry=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/BlackBerry/i)&&(e=!0),e},t.IsOperaMini=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Opera Mini/i)&&(e=!0),e},t.IsAndroid=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Android/i)&&(e=!0),e},t.IsWebOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/webOS/i)&&(e=!0),e},t.IsIOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone|iPad|iPod/i)&&(e=!0),e},t.IsIPHONE=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone/i)&&(e=!0),e},t.IsIPAD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPad/i)&&(e=!0),e},t.IsIPOD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPod/i)&&(e=!0),e},t.IsIE11=function(){return void 0!==navigator.maxTouchPoints},t.IsMobile=function(){var e=!1;if(null!=navigator&&null!=navigator.userAgent){var t=navigator.userAgent;(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone|iPad|iPod/i)||t.match(/BlackBerry/i)||t.match(/Opera Mini/i)||t.match(/Windows Phone/i))&&(e=!0)}return e},t.IsPlaystation=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Playstation/i)&&(e=!0),e},t.IsXboxConsole=function(){var t=!1;if(e.WindowManager.IsWindows()&&"undefined"!=typeof Windows.System.Profile&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily){var n=Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily;n.match(/Xbox/i)&&(t=!0)}return t},t.IsXboxLive=function(){return e.WindowManager.IsWindows()&&"undefined"!=typeof Microsoft&&"undefined"!=typeof Microsoft.Xbox&&"undefined"!=typeof Microsoft.Xbox.Services},t.IsFrameWindow=function(){return null!=window.parent&&window!==window.parent},t.AlertMessage=function(t,n){void 0===n&&(n="Babylon.js");var o=null;return e.WindowManager.IsWindows()?o=new Windows.UI.Popups.MessageDialog(t,n).showAsync():window.alert(t),o},t.GetQueryStringParam=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=n.exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null},t.PostWindowMessage=function(e,t,n){void 0===t&&(t="*"),void 0===n&&(n=!1),n===!0?window.postMessage(e,t):window.top?window.top.postMessage(e,t):console.warn("No Valid Top Window")},t.SetGameWindowState=function(e,t){null!=window.parent&&null!=window.parent.gameState?window.parent.gameState[e]=t:BABYLON.Tools.Warn("Game window required to set state for: "+e)},t.GetGameWindowState=function(e){var t=null;return null!=window.parent&&null!=window.parent.gameState&&null!=window.parent.gameState[e]?t=window.parent.gameState[e]:BABYLON.Tools.Warn("Game window required to get state for: "+e),null!=t?t:null},t.IsGameWindowEnabled=function(){return null!=window.parent&&null!=window.parent.setGameWindow},t.LoadSceneFile=function(t,n){if(void 0===n&&(n=null),e.WindowManager.IsGameWindowEnabled()){var o=window.location.protocol+"//"+window.location.host+window.location.pathname+"?scene="+t;null!=n&&""!==n&&(o+=n),null!=window.parent&&null!=window.parent.setGameWindow?window.parent.setGameWindow(o):BABYLON.Tools.Warn("Invalid scene viewer set game window function found to load scene file: "+t)}else BABYLON.Tools.Warn("Scene viewer game window required to load scene file: "+t)},t.PopupDebug=function(e){e.debugLayer&&(e.debugLayer.hide(),e.debugLayer.show({enablePopup:!0,globalRoot:null}))},t.ToggleDebug=function(t,n,o){if(void 0===n&&(n=!1),void 0===o&&(o=null),t.debugLayer){var i=window;e.WindowManager.debugLayerVisible===!0?(e.WindowManager.debugLayerVisible=!1,i.METER&&i.METER.show&&i.METER.show(),t.debugLayer.hide()):(e.WindowManager.debugLayerVisible=!0,i.METER&&i.METER.hide&&i.METER.hide(),t.debugLayer.show({embedMode:n,globalRoot:o}))}},t.GetLocalStorageItem=function(e){return null!=window.localStorage?window.localStorage.getItem(e):null},t.SetLocalStorageItem=function(e,t){null!=window.localStorage&&window.localStorage.setItem(e,t)},t.GetSessionStorageItem=function(e){return null!=window.sessionStorage?window.sessionStorage.getItem(e):null},t.SetSessionStorageItem=function(e,t){null!=window.sessionStorage&&window.sessionStorage.setItem(e,t)},t.GetFilenameFromUrl=function(e){return e.substring(e.lastIndexOf("/")+1)},t.GetUrlParameter=function(e){var t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\?&]"+t+"=([^&#]*)"),o=n.exec(window.location.search);return null!==o?decodeURIComponent(o[1].replace(/\+/g," ")):null},t.GetVirtualRealityEnabled=function(){var t=e.WindowManager.GetLocalStorageItem("virtualReality");return null!=t&&"true"===t},t.SetVirtualRealityEnabled=function(t){e.WindowManager.SetLocalStorageItem("virtualReality",t.toString().toLowerCase())},t.SetWindowsLaunchMode=function(t){void 0===t&&(t=1),e.WindowManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationView&&(Windows.UI.ViewManagement.ApplicationView.preferredLaunchWindowingMode=t)},t.QuitWindowsApplication=function(){e.WindowManager.IsWindows()&&window.close()},t.PrintToScreen=function(t,n){if(void 0===n&&(n="white"),e.WindowManager.PrintElement=document.getElementById("print"),null==e.WindowManager.PrintElement){var o=document.createElement("div");o.id="print",o.style.position="absolute",o.style.left="6px",o.style.bottom="3px",o.style.fontSize="12px",o.style.zIndex="10000",o.style.color="#0c0",document.body.appendChild(o),e.WindowManager.PrintElement=o}null!=e.WindowManager.PrintElement&&e.WindowManager.PrintElement.innerHTML!==t&&(e.WindowManager.PrintElement.style.color!==n&&(e.WindowManager.PrintElement.style.color=n),e.WindowManager.PrintElement.innerHTML=t)},t.debugLayerVisible=!1,t.PrintElement=null,t}();e.WindowManager=t}(UNITY||(UNITY={})),UNITY.WindowManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow&&Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow),UNITY.WindowManager.IsXboxConsole()&&navigator.gamepadInputEmulation&&(navigator.gamepadInputEmulation="gamepad");var WM=UNITY.WindowManager;